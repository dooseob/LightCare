# 시설 이미지 JS 파일 리팩토링 계획

## 📋 현재 상태 분석

### 분석 날짜: 2025-01-08

### 발견된 문제점
1. **크롭퍼 파일 분산**: `facility-image-cropper.js` (3,916줄) + `facility-image-cropper-fixed.js` (1,201줄) = 총 5,117줄
2. **코드 중복**: 동일한 기능이 두 파일에 중복 구현됨
3. **네임스페이스 불일치**: 한 파일은 네임스페이스 적용, 다른 파일은 전역 변수 사용
4. **파일 분산**: 시설 이미지 관련 JS 파일이 11개로 분산되어 있음

### 현재 시설 이미지 관련 파일 현황
```
src/main/resources/static/js/
├── facility-image-cropper.js (3,916줄) - 메인 크롭퍼 
├── facility-image-cropper-fixed.js (1,201줄) - 수정된 크롭퍼
├── facility-image-cropper.backup.js - 백업 파일
├── facility-image-manage.js - 이미지 관리
├── facility-image-master-controller.js - 마스터 컨트롤러
├── facility-image-step1-load.js - 1단계 로딩
├── facility-image-step1-pure.js - 1단계 순수 버전
├── facility-image-step3-manage.js - 3단계 관리
├── facility-image-data-manager.js - 데이터 관리
├── facility-image-seo-keywords.js - SEO 키워드
├── facility-image-uploader.js - 업로더
└── facility-image-folder-selection.js - 폴더 선택
```

### 추가 발견: 프로필 이미지 크롭퍼 중복 문제
```
프로필 이미지 크롭퍼 (약 2,600줄 중복):
├── crop-image.js (1,500줄) - 독립 파일
├── crop-image.html 내부 스크립트 (1,100줄) - 인라인 코드
└── advanced-image-cropper.js - 고급 크롭퍼
```

**총 중복 코드량**: 시설 이미지 5,117줄 + 프로필 이미지 2,600줄 = **7,717줄**

### 이전 작업 진행 상태
- `build/resources/main/static/js/facility-image-cropper-unified.js` 파일 발견
- 부분적인 통합 작업이 진행되었으나 완료되지 않음
- 추가 모듈 파일들 생성: `facility-image-dom-validator.js`, `facility-image-event-coordinator.js`

---

## 🎯 리팩토링 목표

### 1차 목표 (크롭퍼 통합)
- [ ] **시설 이미지 크롭퍼 통합**: 5,117줄 → 3,500줄 이하로 감소
- [ ] **프로필 이미지 크롭퍼 통합**: 2,600줄 → 1,500줄 이하로 감소
- [ ] **코드 중복 제거**: 동일 기능 통합
- [ ] **네임스페이스 통일**: 완전한 네임스페이스 격리 적용
- [ ] **기능 보존**: 모든 기존 기능 유지

### 2차 목표 (전체 모듈화)
- [ ] **모듈 분리**: 기능별 모듈 구조 설계
- [ ] **의존성 관리**: 모듈 간 의존성 최소화
- [ ] **API 통합**: 일관된 API 인터페이스 제공

### 3차 목표 (최적화)
- [ ] **성능 최적화**: 로딩 시간 단축
- [ ] **메모리 최적화**: 메모리 사용량 감소
- [ ] **에러 핸들링**: 통합된 에러 처리 시스템

---

## 📝 단계별 실행 계획

### Phase 1: 크롭퍼 통합 (우선순위: 높음)
**목표**: 중복된 크롭퍼 파일들을 통합하여 코드 중복 제거

#### Step 1-1: 코드 분석 및 매핑 ✅
- [x] `facility-image-cropper.js` 구조 분석
- [x] `facility-image-cropper-fixed.js` 구조 분석  
- [x] `crop-image.js` 구조 분석
- [x] `crop-image.html` 인라인 스크립트 분석
- [x] 중복 코드 식별 및 매핑
- [x] 네임스페이스 차이점 분석

#### Step 1-2: 시설 이미지 크롭퍼 통합 (진행 중)
- [ ] **작업 내용**: 기존 `facility-image-cropper-unified.js` 검토 및 완성
- [ ] **중복 제거**: 동일 기능 함수 통합
- [ ] **네임스페이스 통일**: `FacilityCropperNamespace` 적용
- [ ] **테스트**: 기본 크롭 기능 동작 확인

#### Step 1-3: 프로필 이미지 크롭퍼 통합 (신규)
- [ ] **인라인 스크립트 분리**: `crop-image.html`에서 스크립트 분리
- [ ] **중복 코드 제거**: `crop-image.js`와 인라인 스크립트 통합
- [ ] **네임스페이스 적용**: `ProfileCropperNamespace` 적용
- [ ] **템플릿 수정**: 외부 스크립트 파일 참조로 변경

#### Step 1-4: 기존 파일 교체
- [ ] **백업**: 기존 파일들 백업 폴더로 이동
- [ ] **참조 수정**: HTML 템플릿에서 통합 파일 참조
- [ ] **테스트**: 전체 기능 동작 확인

### Phase 2: 모듈 구조 설계 (우선순위: 중간)
**목표**: 기능별 모듈 분리를 통한 유지보수성 향상

#### Step 2-1: 모듈 구조 설계
- [ ] **Core Module**: 기본 초기화 및 상태 관리
- [ ] **Cropper Module**: 크롭 기능 전용
- [ ] **Upload Module**: 파일 업로드 및 드래그앤드롭
- [ ] **UI Module**: DOM 조작 및 이벤트 처리
- [ ] **Data Module**: 서버 통신 및 데이터 관리

#### Step 2-2: 모듈 분리 구현
- [ ] 각 모듈별 독립 파일 생성
- [ ] 모듈 간 인터페이스 정의
- [ ] 의존성 주입 시스템 구현

#### Step 2-3: 모듈 로더 구현
- [ ] 동적 모듈 로딩 시스템
- [ ] 초기화 순서 관리
- [ ] 에러 핸들링 시스템

### Phase 3: 기존 파일 정리 (우선순위: 낮음)
**목표**: 불필요한 파일 정리 및 구조 최적화

#### Step 3-1: 파일 분석
- [ ] 각 파일의 기능 및 의존성 분석
- [ ] 중복 기능 식별
- [ ] 사용되지 않는 파일 식별

#### Step 3-2: 통합 및 정리
- [ ] 유사 기능 파일 통합
- [ ] 사용되지 않는 파일 제거
- [ ] 폴더 구조 재정리

---

## 🔍 진행 상황 추적

### 완료된 작업 ✅
1. **현재 상태 분석**: 11개 파일, 5,117줄 크롭퍼 파일 확인
2. **이전 작업 확인**: `facility-image-cropper-unified.js` 부분 완성 상태
3. **코드 비교 분석**: 두 크롭퍼 파일의 차이점 파악

### 진행 중인 작업 🔄
1. **Step 1-2**: 통합 파일 생성 - 기존 unified 파일 검토 필요

### 예정된 작업 ⏳
1. **Step 1-2 완료**: 통합 크롭퍼 파일 완성
2. **Step 1-3**: 기존 파일 교체 및 테스트
3. **Phase 2**: 모듈 구조 설계 착수

---

## ⚠️ 주의사항

### 기능 보존
- **모든 기존 기능 유지**: 크롭, 업로드, 압축, SEO 등
- **하위 호환성**: 기존 HTML 템플릿과 호환
- **에러 처리**: 기존 에러 핸들링 로직 보존

### 테스트 전략
- **단계별 테스트**: 각 단계 완료 후 기능 테스트
- **회귀 테스트**: 기존 기능 동작 확인
- **브라우저 테스트**: 다양한 브라우저에서 동작 확인

### 백업 전략
- **원본 보존**: 모든 원본 파일 백업 유지
- **단계별 백업**: 각 단계 완료 시점 백업
- **롤백 계획**: 문제 발생 시 즉시 롤백 가능

---

## 🛠️ 다음 단계 실행 가이드

### 즉시 실행 가능한 작업
1. **기존 unified 파일 검토**: 현재 상태 확인 후 완성도 평가
2. **기능 테스트**: 통합 파일의 기본 동작 확인
3. **코드 품질 개선**: 중복 코드 제거 및 최적화

### 순차 실행 권장 작업
1. **Step 1-2 완료**: 크롭퍼 통합 완성
2. **Step 1-3 진행**: 기존 파일 교체
3. **Phase 2 시작**: 모듈 구조 설계

---

## 📊 예상 결과

### 코드 품질 개선
- **줄 수 감소**: 5,117줄 → 3,500줄 이하 (약 30% 감소)
- **중복 제거**: 동일 기능 통합으로 유지보수성 향상
- **구조 개선**: 모듈화를 통한 코드 가독성 향상

### 성능 개선
- **로딩 시간**: 파일 수 감소로 초기 로딩 속도 향상
- **메모리 사용량**: 중복 코드 제거로 메모리 효율성 증대
- **런타임 성능**: 최적화된 코드 구조로 실행 속도 향상

### 유지보수성 향상
- **코드 탐색**: 모듈화된 구조로 코드 찾기 용이
- **버그 수정**: 중복 코드 제거로 버그 수정 범위 최소화
- **기능 추가**: 모듈 구조로 새 기능 추가 용이

---

*이 계획서는 작업 진행에 따라 지속적으로 업데이트됩니다.*
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/header :: header}">
    <title>ì‹œì„¤ ì •ë³´ ìˆ˜ì • - ë¼ì´íŠ¸ì¼€ì–´</title>
</head>

<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="container my-4">
    <!-- ë¸Œë ˆë“œí¬ëŸ¼ -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">í™ˆ</a></li>
            <li class="breadcrumb-item"><a href="/facility/search">ì‹œì„¤ ì°¾ê¸°</a></li>
            <li class="breadcrumb-item"><a href="/facility/manage">ë‚´ ì‹œì„¤ ê´€ë¦¬</a></li>
            <li class="breadcrumb-item active" aria-current="page">ì‹œì„¤ ì •ë³´ ìˆ˜ì •</li>
        </ol>
    </nav>
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-edit me-2"></i>ì‹œì„¤ ì •ë³´ ìˆ˜ì •
                    </h3>
                </div>
                <div class="card-body">
                    <form id="facilityEditForm" th:action="@{/facility/edit/{id}(id=${facility.facilityId})}" 
                          method="post" enctype="multipart/form-data" th:object="${facility}">
                        
                        <!-- ì‹œì„¤ëª… -->
                        <div class="mb-3">
                            <label for="facilityName" class="form-label">
                                <i class="fas fa-building me-1"></i>ì‹œì„¤ëª… <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="facilityName" th:field="*{facilityName}"
                                   placeholder="ì‹œì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        </div>

                        <!-- ì‹œì„¤ ìœ í˜• -->
                        <div class="mb-3">
                            <label for="facilityType" class="form-label">
                                <i class="fas fa-tag me-1"></i>ì‹œì„¤ ìœ í˜• <span class="text-danger">*</span>
                            </label>
                            <select class="form-select" id="facilityType" th:field="*{facilityType}" required>
                                <option value="">ì‹œì„¤ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="NURSING_HOME">ìš”ì–‘ì›</option>
                                <option value="HOSPITAL">ìš”ì–‘ë³‘ì›</option>
                                <option value="DAY_CARE">ë°ì´ì¼€ì–´ì„¼í„°</option>
                            </select>
                        </div>

                        <!-- ì£¼ì†Œ -->
                        <div class="mb-3">
                            <label for="facilityAddress" class="form-label">
                                <i class="fas fa-map-marker-alt me-1"></i>ì£¼ì†Œ <span class="text-danger">*</span>
                            </label>
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" id="facilityAddress" th:field="*{address}"
                                       placeholder="ì£¼ì†Œ ê²€ìƒ‰ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”" readonly required>
                                <button type="button" class="btn btn-outline-primary" onclick="searchFacilityAddress()">
                                    <i class="fas fa-search me-1"></i>ì£¼ì†Œ ê²€ìƒ‰
                                </button>
                                <button type="button" class="btn btn-outline-info ms-1" onclick="simpleAddressTest()">
                                    <i class="fas fa-vial me-1"></i>í…ŒìŠ¤íŠ¸
                                </button>
                                <button type="button" class="btn btn-outline-success ms-1" onclick="checkCoordinates()">
                                    <i class="fas fa-map-marked-alt me-1"></i>ì¢Œí‘œí™•ì¸
                                </button>
                            </div>
                            <input type="text" class="form-control" id="detailAddress" th:field="*{detailAddress}"
                                   placeholder="ìƒì„¸ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 101í˜¸, 2ì¸µ)">
                            <!-- ìœ„ë„/ê²½ë„ íˆë“  í•„ë“œ -->
                            <input type="hidden" id="latitude" th:field="*{latitude}">
                            <input type="hidden" id="longitude" th:field="*{longitude}">
                        </div>
                        
                        <!-- ìœ„ì¹˜ ë¯¸ë¦¬ë³´ê¸° ì§€ë„ -->
                        <div class="mb-3" id="mapPreviewContainer" style="display: none;">
                            <label class="form-label">
                                <i class="fas fa-map me-1"></i>ìœ„ì¹˜ ë¯¸ë¦¬ë³´ê¸°
                            </label>
                            <div id="previewMap" style="width:100%; height:200px; border-radius: 8px; border: 1px solid #dee2e6;"></div>
                            <small class="form-text text-muted">ì„ íƒëœ ì£¼ì†Œì˜ ìœ„ì¹˜ê°€ ì§€ë„ì— í‘œì‹œë©ë‹ˆë‹¤.</small>
                        </div>

                        <!-- ì‹œì„¤ ì „í™”ë²ˆí˜¸ -->
                        <div class="mb-3">
                            <label for="phone" class="form-label">
                                <i class="fas fa-phone me-1"></i>ì‹œì„¤ ì „í™”ë²ˆí˜¸ <span class="text-danger">*</span>
                            </label>
                            <input type="tel" class="form-control" id="phone" th:field="*{phone}"
                                   placeholder="ìˆ«ìë§Œ ì…ë ¥í•˜ì„¸ìš” (ìë™ìœ¼ë¡œ í•˜ì´í”ˆ ì¶”ê°€ë¨)" required>
                            <small class="form-text text-muted">ì¼ë°˜ ì „í™”ë²ˆí˜¸(02-1234-5678) ë˜ëŠ” íœ´ëŒ€í° ë²ˆí˜¸ ëª¨ë‘ ê°€ëŠ¥í•©ë‹ˆë‹¤</small>
                        </div>

                        <!-- í˜„ì¬ ì‹œì„¤ ì´ë¯¸ì§€ -->
                        <div class="mb-3" th:if="${facility.facilityImage}">
                            <label class="form-label">
                                <i class="fas fa-image me-1"></i>í˜„ì¬ ì‹œì„¤ ì‚¬ì§„
                            </label>
                            <div class="mb-2">
                                <img th:src="@{${facility.facilityImage}}" alt="í˜„ì¬ ì‹œì„¤ ì‚¬ì§„" 
                                     style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid #dee2e6;">
                            </div>
                        </div>

                        <!-- ìƒˆ ì‹œì„¤ ì´ë¯¸ì§€ -->
                        <div class="mb-3">
                            <label for="facilityImageFile" class="form-label">
                                <i class="fas fa-image me-1"></i>ì‹œì„¤ ì‚¬ì§„ <span th:if="${facility.facilityImage == null}" class="text-danger">*</span>
                                <span th:if="${facility.facilityImage != null}" class="text-muted">(ë³€ê²½í•˜ë ¤ë©´ ìƒˆ íŒŒì¼ ì„ íƒ)</span>
                            </label>
                            <input type="file" class="form-control" id="facilityImageFile" name="facilityImageFile"
                                   accept="image/*" onchange="previewFacilityImage(this)"
                                   th:required="${facility.facilityImage == null}">
                            <small class="form-text text-muted">JPG, PNG íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥ (ìµœëŒ€ 5MB)</small>
                            <div id="facilityImagePreview" class="mt-2" style="display: none;">
                                <img id="facilityImagePreviewImg" src="" alt="ì‹œì„¤ ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°" 
                                     style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid #dee2e6;">
                            </div>
                        </div>

                        <!-- ìˆ˜ìš© ì¸ì› -->
                        <div class="mb-3">
                            <label for="capacity" class="form-label">
                                <i class="fas fa-users me-1"></i>ìˆ˜ìš© ì¸ì›
                            </label>
                            <input type="number" class="form-control" id="capacity" th:field="*{capacity}"
                                   placeholder="ìˆ˜ìš© ê°€ëŠ¥ ì¸ì›ì„ ì…ë ¥í•˜ì„¸ìš”" min="1">
                        </div>

                        <!-- ìš´ì˜ ì‹œê°„ -->
                        <div class="mb-3">
                            <label for="operatingHours" class="form-label">
                                <i class="fas fa-clock me-1"></i>ìš´ì˜ ì‹œê°„
                            </label>
                            <div class="row g-2">
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operatingType" id="operating24" 
                                               value="24ì‹œê°„" th:checked="${facility.operatingHours == '24ì‹œê°„'}">
                                        <label class="form-check-label fw-bold text-success" for="operating24">
                                            <i class="fas fa-clock me-1"></i>24ì‹œê°„ ìš´ì˜
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operatingType" id="operatingCustom" 
                                               value="custom" th:checked="${facility.operatingHours != '24ì‹œê°„' && facility.operatingHours != null}">
                                        <label class="form-check-label" for="operatingCustom">
                                            <i class="fas fa-clock me-1"></i>ì‹œê°„ ì§ì ‘ ì„¤ì •
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operatingType" id="operatingWeekly" value="weekly">
                                        <label class="form-check-label" for="operatingWeekly">
                                            <i class="fas fa-calendar-week me-1"></i>ìš”ì¼ë³„ ì‹œê°„ ì„¤ì •
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ê°„ë‹¨í•œ ì‹œê°„ ì„¤ì • -->
                            <div id="simpleTimeContainer" class="mt-3" style="display: none;">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title mb-3">ìš´ì˜ ì‹œê°„ ì„¤ì •</h6>
                                        <div class="row g-2">
                                            <div class="col-md-6">
                                                <label class="form-label small">ì‹œì‘ ì‹œê°„</label>
                                                <select class="form-select" id="startHour">
                                                    <option value="">ì‹œ</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label small">ì¢…ë£Œ ì‹œê°„</label>
                                                <select class="form-select" id="endHour">
                                                    <option value="">ì‹œ</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle me-1"></i>
                                                ë§¤ì¼ ë™ì¼í•œ ì‹œê°„ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ìš”ì¼ë³„ ì‹œê°„ ì„¤ì • -->
                            <div id="weeklyTimeContainer" class="mt-3" style="display: none;">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title mb-3">ìš”ì¼ë³„ ìš´ì˜ ì‹œê°„</h6>
                                        <div id="weeklySchedule">
                                            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                                        </div>
                                        
                                        <div class="mt-3">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle me-1"></i>
                                                ìš´ì˜í•˜ì§€ ì•ŠëŠ” ìš”ì¼ì€ ì²´í¬ë¥¼ í•´ì œí•˜ì„¸ìš”
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ì§ì ‘ ì…ë ¥ -->
                            <div id="customTimeContainer" class="mt-3" style="display: none;">
                                <input type="text" class="form-control" id="customOperatingHours" 
                                       placeholder="ì˜ˆ: 09:00-18:00, í‰ì¼ 09:00-18:00 ì£¼ë§ 10:00-16:00"
                                       th:value="${facility.operatingHours != '24ì‹œê°„' ? facility.operatingHours : ''}">
                                <small class="form-text text-muted">
                                    ììœ  í˜•ì‹ìœ¼ë¡œ ìš´ì˜ ì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš”
                                </small>
                            </div>
                            
                            <input type="hidden" id="operatingHours" th:field="*{operatingHours}">
                        </div>

                        <!-- í™ˆí˜ì´ì§€ -->
                        <div class="mb-3">
                            <label for="homepage" class="form-label">
                                <i class="fas fa-globe me-1"></i>í™ˆí˜ì´ì§€ URL
                            </label>
                            <input type="url" class="form-control" id="homepage" th:field="*{homepage}"
                                   placeholder="https://www.example.com">
                        </div>

                        <!-- ì‹œì„¤ ì„¤ëª… -->
                        <div class="mb-3">
                            <label for="description" class="form-label">
                                <i class="fas fa-info-circle me-1"></i>ì‹œì„¤ ì„¤ëª…
                            </label>
                            <textarea class="form-control" id="description" th:field="*{description}" rows="4"
                                      placeholder="ì‹œì„¤ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                        </div>

                        <!-- ì‹œì„¤ íŠ¹ì§• -->
                        <div class="mb-3">
                            <label for="features" class="form-label">
                                <i class="fas fa-star me-1"></i>ì‹œì„¤ íŠ¹ì§•
                            </label>
                            <input type="text" class="form-control" id="features" th:field="*{features}"
                                   placeholder="ì‹œì„¤ì˜ ì£¼ìš” íŠ¹ì§•ì„ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 24ì‹œê°„ ê°„ë³‘ì„œë¹„ìŠ¤, ë¬¼ë¦¬ì¹˜ë£Œì‹¤, ì¹´í˜)">
                            <small class="form-text text-muted">ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ì—¬ëŸ¬ íŠ¹ì§•ì„ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</small>
                        </div>

                        <!-- ë²„íŠ¼ -->
                        <div class="d-flex gap-2 justify-content-end">
                            <a th:href="@{/facility/manage}" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>ì·¨ì†Œ
                            </a>
                            <button type="submit" class="btn btn-primary" id="submitButton">
                                <i class="fas fa-save me-2"></i>ìˆ˜ì • ì™„ë£Œ
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<!-- ì¹´ì¹´ì˜¤ ì£¼ì†Œ ê²€ìƒ‰ API -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<!-- ì¹´ì¹´ì˜¤ë§µ API (ì¢Œí‘œ ë³€í™˜ìš©) -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=3c4987cb946a721903add5fc474941a3&libraries=services"></script>
<!-- ì¹´ì¹´ì˜¤ë§µ ìœ í‹¸ë¦¬í‹° -->
<script src="/js/kakaomap.js"></script>
<script src="/js/facility-edit.js"></script>

<script>
$(document).ready(function() {
    console.log('Initializing operating hours...');
    
    // ì‹œê°„ ì˜µì…˜ ë™ì  ìƒì„±
    initializeTimeOptions();
    
    // ìš”ì¼ë³„ ìŠ¤ì¼€ì¤„ ë¯¸ë¦¬ ìƒì„±
    generateWeeklySchedule();
    
    // ì§ì ‘ ì…ë ¥ ë³€ê²½ ì´ë²¤íŠ¸
    $('#customOperatingHours').on('input', function() {
        updateOperatingHours();
    });
    
    // ì´ˆê¸° ìƒíƒœ ì„¤ì •
    initializeOperatingHours();
});

function initializeTimeOptions() {
    // ì‹œì‘ ì‹œê°„ ì˜µì…˜ ìƒì„±
    for (let i = 0; i <= 23; i++) {
        const hour = String(i).padStart(2, '0');
        $('#startHour').append(`<option value="${hour}">${hour}ì‹œ</option>`);
        $('#endHour').append(`<option value="${hour}">${hour}ì‹œ</option>`);
    }
}

function generateWeeklySchedule() {
    console.log('Generating weekly schedule...');
    const days = ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼', 'ì¼ìš”ì¼'];
    let html = '';
    
    days.forEach((day, index) => {
        html += `
            <div class="row g-2 mb-2">
                <div class="col-3">
                    <div class="form-check">
                        <input class="form-check-input day-check" type="checkbox" id="day${index}" checked>
                        <label class="form-check-label" for="day${index}">${day}</label>
                    </div>
                </div>
                <div class="col-9 time-controls">
                    <div class="d-flex align-items-center gap-2">
                        <select class="form-select form-select-sm day-start" id="start${index}" style="width: 80px;">
                            <option value="">ì‹œì‘</option>
                        </select>
                        <span>ì‹œ ~</span>
                        <select class="form-select form-select-sm day-end" id="end${index}" style="width: 80px;">
                            <option value="">ì¢…ë£Œ</option>
                        </select>
                        <span>ì‹œ</span>
                    </div>
                    <div class="rest-day-notice text-muted small mt-1" style="display: none;">
                        <i class="fas fa-moon me-1"></i>íœ´ë¬´ì¼
                    </div>
                </div>
            </div>
        `;
    });
    
    $('#weeklySchedule').html(html);
    
    // ì‹œê°„ ì˜µì…˜ ì¶”ê°€
    for (let i = 0; i <= 23; i++) {
        const hour = String(i).padStart(2, '0');
        days.forEach((day, index) => {
            $(`#start${index}`).append(`<option value="${hour}">${hour}</option>`);
            $(`#end${index}`).append(`<option value="${hour}">${hour}</option>`);
        });
    }
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    setTimeout(function() {
        $('.day-check').off('change').on('change', function() {
            const index = $(this).attr('id').replace('day', '');
            const timeControls = $(this).closest('.row').find('.time-controls');
            const restNotice = timeControls.find('.rest-day-notice');
            const selects = timeControls.find('select');
            
            if ($(this).is(':checked')) {
                selects.show();
                timeControls.find('span').show();
                restNotice.hide();
            } else {
                selects.hide();
                timeControls.find('span').hide();
                restNotice.show();
            }
            
            updateOperatingHours();
        });
        
        $('.day-start, .day-end').off('change').on('change', function() {
            updateOperatingHours();
        });
        
        // ê°„ë‹¨í•œ ì‹œê°„ ì„¤ì • ì´ë²¤íŠ¸ë„ ì—¬ê¸°ì„œ ë“±ë¡
        $('#startHour, #endHour').off('change').on('change', function() {
            updateOperatingHours();
        });
    }, 100);
}

function initializeOperatingHours() {
    const currentHours = $('#operatingHours').val();
    
    if (currentHours === '24ì‹œê°„') {
        $('#operating24').prop('checked', true);
    } else if (currentHours && currentHours !== '') {
        $('#operatingCustom').prop('checked', true);
        $('#customTimeContainer').show();
        $('#customOperatingHours').val(currentHours);
    }
}

function updateOperatingHours() {
    const operatingType = $('input[name="operatingType"]:checked').val();
    let operatingHours = '';
    
    if (operatingType === '24ì‹œê°„') {
        operatingHours = '24ì‹œê°„';
    } else if (operatingType === 'simple') {
        const startHour = $('#startHour').val();
        const endHour = $('#endHour').val();
        
        if (startHour && endHour) {
            operatingHours = `${startHour}:00-${endHour}:00`;
        }
    } else if (operatingType === 'weekly') {
        const weeklyHours = [];
        const days = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];
        
        $('.day-check').each(function(index) {
            if ($(this).is(':checked')) {
                const startHour = $(`#start${index}`).val();
                const endHour = $(`#end${index}`).val();
                
                if (startHour && endHour) {
                    weeklyHours.push(`${days[index]} ${startHour}:00-${endHour}:00`);
                }
            } else {
                weeklyHours.push(`${days[index]} íœ´ë¬´`);
            }
        });
        
        operatingHours = weeklyHours.join(', ');
    } else if (operatingType === 'custom') {
        operatingHours = $('#customOperatingHours').val();
    }
    
    $('#operatingHours').val(operatingHours);
}

// ê°„ë‹¨í•œ ì£¼ì†Œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ (Daum API ì§ì ‘ í˜¸ì¶œ)
function simpleAddressTest() {
    console.log('ê°„ë‹¨í•œ ì£¼ì†Œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
    
    if (typeof daum === 'undefined') {
        console.error('Daum APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        alert('Daum APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        return;
    }
    
    new daum.Postcode({
        oncomplete: function(data) {
            console.log('ì£¼ì†Œ ì„ íƒë¨:', data);
            
            const selectedAddress = data.roadAddress || data.jibunAddress;
            
            // ì£¼ì†Œ ì§ì ‘ ì„¤ì •
            const addressInput = document.getElementById('facilityAddress');
            if (addressInput) {
                addressInput.removeAttribute('readonly');
                addressInput.value = selectedAddress;
                addressInput.setAttribute('readonly', 'readonly');
                addressInput.style.backgroundColor = '#d4edda';
                
                setTimeout(function() {
                    addressInput.style.backgroundColor = '';
                }, 2000);
                
                console.log('ì£¼ì†Œ ì„¤ì • ì™„ë£Œ:', selectedAddress);
            } else {
                alert('facilityAddress í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                return;
            }
            
            // ìœ„ë„/ê²½ë„ ë³€í™˜ ë° ì„¤ì •
            if (typeof kakao !== 'undefined' && kakao.maps && kakao.maps.services) {
                const geocoder = new kakao.maps.services.Geocoder();
                
                geocoder.addressSearch(selectedAddress, function(result, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        const latitude = parseFloat(result[0].y);
                        const longitude = parseFloat(result[0].x);
                        
                        // ìœ„ë„/ê²½ë„ íˆë“  í•„ë“œì— ì„¤ì •
                        const latitudeInput = document.getElementById('latitude');
                        const longitudeInput = document.getElementById('longitude');
                        
                        if (latitudeInput) {
                            latitudeInput.value = latitude;
                            console.log('ìœ„ë„ ì„¤ì •:', latitude);
                        }
                        
                        if (longitudeInput) {
                            longitudeInput.value = longitude;
                            console.log('ê²½ë„ ì„¤ì •:', longitude);
                        }
                        
                        alert('ì£¼ì†Œì™€ ìœ„ì¹˜ ì¢Œí‘œ ì„¤ì • ì™„ë£Œ!\nì£¼ì†Œ: ' + selectedAddress + '\nìœ„ë„: ' + latitude + '\nê²½ë„: ' + longitude);
                    } else {
                        console.error('ìœ„ë„/ê²½ë„ ë³€í™˜ ì‹¤íŒ¨:', status);
                        alert('ì£¼ì†ŒëŠ” ì„¤ì •ë˜ì—ˆì§€ë§Œ ìœ„ë„/ê²½ë„ ë³€í™˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                });
            } else {
                console.error('ì¹´ì¹´ì˜¤ë§µ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                alert('ì£¼ì†ŒëŠ” ì„¤ì •ë˜ì—ˆì§€ë§Œ ì¹´ì¹´ì˜¤ë§µ APIê°€ ì—†ì–´ ìœ„ë„/ê²½ë„ë¥¼ ì„¤ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        },
        onclose: function(state) {
            console.log('ì£¼ì†Œ ê²€ìƒ‰ ì°½ ë‹«í˜:', state);
        },
        onerror: function(error) {
            console.error('ì£¼ì†Œ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
            alert('ì£¼ì†Œ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
        }
    }).open();
}

// í˜„ì¬ ì„¤ì •ëœ ìœ„ë„/ê²½ë„ í™•ì¸ í•¨ìˆ˜
function checkCoordinates() {
    console.log('ì¢Œí‘œí™•ì¸ í•¨ìˆ˜ ì‹¤í–‰ë¨');
    
    const addressInput = document.getElementById('facilityAddress');
    const latitudeInput = document.getElementById('latitude');
    const longitudeInput = document.getElementById('longitude');
    
    const address = addressInput ? addressInput.value : 'í•„ë“œ ì—†ìŒ';
    const latitude = latitudeInput ? latitudeInput.value : 'í•„ë“œ ì—†ìŒ';
    const longitude = longitudeInput ? longitudeInput.value : 'í•„ë“œ ì—†ìŒ';
    
    console.log('í˜„ì¬ ê°’:');
    console.log('- ì£¼ì†Œ:', address);
    console.log('- ìœ„ë„:', latitude);
    console.log('- ê²½ë„:', longitude);
    
    // ë¹ˆ ê°’ ì²´í¬
    const displayAddress = address || 'ì„¤ì •ë˜ì§€ ì•ŠìŒ';
    const displayLatitude = latitude || 'ì„¤ì •ë˜ì§€ ì•ŠìŒ';
    const displayLongitude = longitude || 'ì„¤ì •ë˜ì§€ ì•ŠìŒ';
    
    const message = `ğŸ“ í˜„ì¬ ì„¤ì •ëœ ì •ë³´:\n\nğŸ  ì£¼ì†Œ: ${displayAddress}\nğŸŒ ìœ„ë„: ${displayLatitude}\nğŸ—ºï¸ ê²½ë„: ${displayLongitude}`;
    
    alert(message);
    
    // ì¶”ê°€ ì§„ë‹¨ ì •ë³´
    if (!latitude || !longitude || latitude === '' || longitude === '') {
        setTimeout(function() {
            alert('âš ï¸ ìœ„ë„/ê²½ë„ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!\n\ní•´ê²° ë°©ë²•:\n1. "í…ŒìŠ¤íŠ¸" ë²„íŠ¼ìœ¼ë¡œ ì£¼ì†Œ ë‹¤ì‹œ ê²€ìƒ‰\n2. ì£¼ì†Œ ì„ íƒ í›„ ìë™ìœ¼ë¡œ ì¢Œí‘œ ì„¤ì •ë¨\n3. "ìˆ˜ì • ì™„ë£Œ"ë¡œ ì €ì¥');
        }, 100);
    }
}

// ê°„ë‹¨í•œ ì‹œê°„ ì„¤ì • ë¼ë””ì˜¤ ë²„íŠ¼ ë™ì  ì¶”ê°€
$(document).ready(function() {
    const simpleOption = `
        <div class="col-12">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="operatingType" id="operatingSimple" value="simple">
                <label class="form-check-label" for="operatingSimple">
                    <i class="fas fa-clock me-1"></i>ê°„ë‹¨í•œ ì‹œê°„ ì„¤ì •
                </label>
            </div>
        </div>
    `;
    
    $('#operatingCustom').closest('.col-12').after(simpleOption);
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë‹¤ì‹œ ë“±ë¡
    setTimeout(function() {
        $('input[name="operatingType"]').off('change').on('change', function() {
            const value = $(this).val();
            console.log('Operating type changed:', value);
            
            // ëª¨ë“  ì»¨í…Œì´ë„ˆ ìˆ¨ê¸°ê¸°
            $('#simpleTimeContainer, #weeklyTimeContainer, #customTimeContainer').hide();
            
            if (value === 'custom') {
                $('#customTimeContainer').show();
            } else if (value === 'weekly') {
                $('#weeklyTimeContainer').show();
                generateWeeklySchedule();
            } else if (value === 'simple') {
                $('#simpleTimeContainer').show();
            }
            
            updateOperatingHours();
        });
    }, 100);
});
</script>

</body>
</html>
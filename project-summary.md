This file is a merged representation of a subset of the codebase, containing specifically included files and files not matching ignore patterns, combined into a single document by Repomix.
The content has been processed where comments have been removed, empty lines have been removed, content has been compressed (code blocks are separated by ⋮---- delimiter).

# File Summary

## Purpose
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  a. A header with the file path (## File: path/to/file)
  b. The full contents of the file in a code block

## Usage Guidelines
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
- Pay special attention to the Repository Description. These contain important context and guidelines specific to this project.

## Notes
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: src/main/java/**/*.java, src/main/resources/application.yml, src/main/resources/mapper/*.xml, build.gradle, README.md, CLAUDE.md, **/*.java, **/*.xml, **/*.yml, **/*.html, **/*.js, **/*.css, **/*.md, **/*.sql, **/*.properties
- Files matching these patterns are excluded: **/test/**, **/static/js/bootstrap*, **/static/js/jquery*, **/static/css/bootstrap*, **/*.html, **/backup/**, **/images/**, **/*.png, **/*.jpg, **/deploy-*.sh, **/facility-image-*.js, **/crop-*.html, **/edit.html, build/**, node_modules/**, .git/**, *.class, *.jar, *.war, *.log, target/**
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Code comments have been removed from supported file types
- Empty lines have been removed from all files
- Content has been compressed - code blocks are separated by ⋮---- delimiter
- Files are sorted by Git change count (files with more changes are at the bottom)

# User Provided Header
LightCare 요양원 구인구직 플랫폼 - 프로젝트 요약

# Directory Structure
```
gradle/
  wrapper/
    gradle-wrapper.properties
src/
  main/
    java/
      com/
        example/
          carelink/
            common/
              BaseDTO.java
              Constants.java
              CustomMultipartFile.java
              PageInfo.java
            config/
              DevSecurityConfig.java
              KakaoApiConfig.java
              ProdSecurityConfig.java
              SecurityConfig.java
              WebConfig.java
            controller/
              AdminController.java
              BoardController.java
              FacilityController.java
              FacilityImageApiController.java
              HomeController.java
              JobController.java
              MemberController.java
              ReviewController.java
            dao/
              BoardImageMapper.java
              BoardMapper.java
              FacilityImageMapper.java
              FacilityMapper.java
              JobApplicationMapper.java
              JobMapper.java
              MemberMapper.java
              ReviewImageMapper.java
              ReviewMapper.java
            dto/
              BoardDTO.java
              BoardImageDTO.java
              FacilityDTO.java
              FacilityImageDTO.java
              JobApplicationDTO.java
              JobDTO.java
              LoginDTO.java
              MemberDTO.java
              ReviewDTO.java
              ReviewImageDTO.java
            service/
              BoardImageService.java
              BoardService.java
              FacilityImageService.java
              FacilityService.java
              ImageOptimizationService.java
              JobService.java
              MemberService.java
              ReviewImageService.java
              ReviewService.java
            validation/
              groups/
                OnFacilityJoin.java
            CarelinkApplication.java
      Crolling.java
    resources/
      mapper/
        boardImageMapper.xml
        boardMapper.xml
        facilityImageMapper.xml
        facilityMapper.xml
        JobApplicationMapper.xml
        jobMapper.xml
        MemberMapper.xml
        reviewImageMapper.xml
        reviewMapper.xml
      static/
        css/
          advanced-image-cropper.css
          common.css
          facility-image-uploader.css
          image-compressor.css
          rich-text-editor.css
        js/
          board-detail.js
          board-navigation.js
          change-password.js
          common.js
          delete-member.js
          facility-edit.js
          facility-manage.js
          image-compressor.js
          job-detail.js
          job-edit.js
          kakaomap.js
          my-posts.js
          myinfo.js
          phone-formatter.js
          review-detail.js
          review-write.js
          rich-text-editor-v2.js
          rich-text-editor.js
          smart-scroll-utility.js
      application.yml
      db_performance_indexes.sql
      mybatis-config.xml
      schema-image-attachments.sql
      schema.sql
build.gradle
CLAUDE.md
docker-compose.aws.yml
docker-compose.yml
IMAGE_UPLOAD_TEST_CHECKLIST.md
lightcare-ai-summary.md
lightcare-summary.md
README.md
reset_all_data.sql
reset_facility_images.sql
schema-postgresql.sql
SECURITY_NOTICE.md
SETUP_GUIDE.md
system.properties
tomorrow-checklist.md
```

# Files

## File: gradle/wrapper/gradle-wrapper.properties
`````
distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-8.13-bin.zip
networkTimeout=10000
validateDistributionUrl=true
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists
`````

## File: src/main/java/com/example/carelink/dao/BoardImageMapper.java
`````java
public interface BoardImageMapper {
List<BoardImageDTO> getImagesByBoardId(@Param("boardId") Long boardId);
BoardImageDTO getImageById(@Param("imageId") Long imageId);
int countActiveImagesByBoardId(@Param("boardId") Long boardId);
int insertImage(BoardImageDTO imageDTO);
int insertImages(@Param("images") List<BoardImageDTO> images);
int updateImage(BoardImageDTO imageDTO);
int updateImageOrder(@Param("imageId") Long imageId,
⋮----
int updateImageAltText(@Param("imageId") Long imageId,
⋮----
int deleteImage(@Param("imageId") Long imageId);
int deactivateImage(@Param("imageId") Long imageId);
int deleteImagesByBoardId(@Param("boardId") Long boardId);
int getTotalImageCountByBoardType(@Param("boardType") String boardType);
Long getTotalImageSize();
`````

## File: src/main/java/com/example/carelink/dao/ReviewImageMapper.java
`````java
public interface ReviewImageMapper {
List<ReviewImageDTO> getImagesByReviewId(@Param("reviewId") Long reviewId);
ReviewImageDTO getImageById(@Param("imageId") Long imageId);
int countActiveImagesByReviewId(@Param("reviewId") Long reviewId);
List<ReviewImageDTO> getImagesByFacilityId(@Param("facilityId") Long facilityId);
int insertImage(ReviewImageDTO imageDTO);
int insertImages(@Param("images") List<ReviewImageDTO> images);
int updateImage(ReviewImageDTO imageDTO);
int updateImageOrder(@Param("imageId") Long imageId,
⋮----
int updateImageAltText(@Param("imageId") Long imageId,
⋮----
int deleteImage(@Param("imageId") Long imageId);
int deactivateImage(@Param("imageId") Long imageId);
int deleteImagesByReviewId(@Param("reviewId") Long reviewId);
int getTotalImageCountByFacilityId(@Param("facilityId") Long facilityId);
Long getTotalImageSize();
int getImageCountByMemberId(@Param("memberId") Long memberId);
`````

## File: src/main/java/com/example/carelink/dto/BoardImageDTO.java
`````java
public class BoardImageDTO {
⋮----
public String getBestImagePath() {
if (webpPath != null && !webpPath.isEmpty()) {
⋮----
if (fallbackJpgPath != null && !fallbackJpgPath.isEmpty()) {
⋮----
public String getThumbnailBySize(String size) {
switch (size.toLowerCase()) {
⋮----
return getBestImagePath();
⋮----
public String getReadableFileSize() {
⋮----
return String.format("%d %s", size, units[unitIndex]);
⋮----
public double getCompressionRate() {
`````

## File: src/main/java/com/example/carelink/dto/LoginDTO.java
`````java
public class LoginDTO {
`````

## File: src/main/java/com/example/carelink/dto/ReviewImageDTO.java
`````java
public class ReviewImageDTO {
⋮----
public String getBestImagePath() {
if (webpPath != null && !webpPath.isEmpty()) {
⋮----
if (fallbackJpgPath != null && !fallbackJpgPath.isEmpty()) {
⋮----
public String getThumbnailBySize(String size) {
switch (size.toLowerCase()) {
⋮----
return getBestImagePath();
⋮----
public String getReadableFileSize() {
⋮----
return String.format("%d %s", size, units[unitIndex]);
⋮----
public double getCompressionRate() {
`````

## File: src/main/java/com/example/carelink/service/BoardImageService.java
`````java
public class BoardImageService {
⋮----
public List<BoardImageDTO> getImagesByBoardId(Long boardId) {
log.info("게시글 이미지 조회: boardId={}", boardId);
return boardImageMapper.getImagesByBoardId(boardId);
⋮----
public List<BoardImageDTO> uploadImages(Long boardId, List<MultipartFile> imageFiles,
⋮----
int existingCount = boardImageMapper.countActiveImagesByBoardId(boardId);
if (existingCount + imageFiles.size() > MAX_BOARD_IMAGES) {
throw new IllegalArgumentException(
String.format("게시글 이미지는 최대 %d개까지 업로드 가능합니다. 현재 %d개, 추가 요청 %d개",
MAX_BOARD_IMAGES, existingCount, imageFiles.size())
⋮----
for (int i = 0; i < imageFiles.size(); i++) {
MultipartFile file = imageFiles.get(i);
String altText = (altTexts != null && i < altTexts.size()) ? altTexts.get(i) : null;
⋮----
BoardImageDTO imageDTO = processAndSaveImage(boardId, file, existingCount + i, altText);
uploadedImages.add(imageDTO);
⋮----
log.error("이미지 업로드 실패: boardId={}, fileName={}",
boardId, file.getOriginalFilename(), e);
⋮----
if (!uploadedImages.isEmpty()) {
boardImageMapper.insertImages(uploadedImages);
log.info("게시글 이미지 {} 개 업로드 완료: boardId={}", uploadedImages.size(), boardId);
⋮----
public BoardImageDTO uploadImage(Long boardId, MultipartFile imageFile, String altText) {
⋮----
String.format("게시글 이미지는 최대 %d개까지 업로드 가능합니다.", MAX_BOARD_IMAGES)
⋮----
BoardImageDTO imageDTO = processAndSaveImage(boardId, imageFile, existingCount, altText);
boardImageMapper.insertImage(imageDTO);
log.info("게시글 이미지 업로드 완료: boardId={}, imageId={}", boardId, imageDTO.getImageId());
⋮----
private BoardImageDTO processAndSaveImage(Long boardId, MultipartFile file,
⋮----
if (!imageOptimizationService.isSupportedImageFormat(file.getOriginalFilename())) {
throw new IllegalArgumentException("지원하지 않는 이미지 형식입니다. (JPG, PNG, GIF, WebP, BMP, TIFF만 가능)");
⋮----
if (!imageOptimizationService.isValidImageMimeType(file.getContentType())) {
throw new IllegalArgumentException("올바른 이미지 파일이 아닙니다. 파일을 다시 확인해주세요.");
⋮----
if (file.isEmpty() || file.getSize() == 0) {
throw new IllegalArgumentException("비어있는 파일은 업로드할 수 없습니다.");
⋮----
String baseFileName = String.format("board_%d_%d_%s",
boardId, imageOrder, UUID.randomUUID().toString().substring(0, 8));
log.info("게시판 이미지 WebP 변환 시작: boardId={}, order={}, file={}",
boardId, imageOrder, file.getOriginalFilename());
⋮----
imageOptimizationService.processImage(file, baseFileName, BOARD_UPLOAD_PATH);
BoardImageDTO imageDTO = BoardImageDTO.builder()
.boardId(boardId)
.imagePath(result.getOriginalWebPPath())
.webpPath(result.getOriginalWebPPath())
.thumbnailSmall(result.getThumbnails().get("small"))
.thumbnailMedium(result.getThumbnails().get("medium"))
.thumbnailLarge(result.getThumbnails().get("large"))
.fallbackJpgPath(result.getFallbackJpgPath())
.originalFilename(file.getOriginalFilename())
.fileSize(result.getOriginalSize())
.fileSizeWebp(result.getWebpSize())
.width(result.getOriginalWidth())
.height(result.getOriginalHeight())
.altText(altText != null ? altText : generateDefaultAltText(boardId, imageOrder))
.imageOrder(imageOrder)
.isActive(true)
.build();
log.info("게시판 이미지 WebP 변환 완료: boardId={}, webpPath={}",
boardId, imageDTO.getWebpPath());
⋮----
private String generateDefaultAltText(Long boardId, int imageOrder) {
return String.format("게시글 #%d의 이미지 %d", boardId, imageOrder + 1);
⋮----
public void updateImageOrder(Long imageId, Integer newOrder) {
boardImageMapper.updateImageOrder(imageId, newOrder);
log.info("이미지 순서 변경: imageId={}, newOrder={}", imageId, newOrder);
⋮----
public void updateImageAltText(Long imageId, String altText) {
boardImageMapper.updateImageAltText(imageId, altText);
log.info("이미지 대체 텍스트 수정: imageId={}", imageId);
⋮----
public void deleteImage(Long imageId) {
BoardImageDTO image = boardImageMapper.getImageById(imageId);
⋮----
boardImageMapper.deleteImage(imageId);
log.info("이미지 삭제 완료: imageId={}", imageId);
⋮----
public void deleteAllImagesByBoardId(Long boardId) {
List<BoardImageDTO> images = boardImageMapper.getImagesByBoardId(boardId);
boardImageMapper.deleteImagesByBoardId(boardId);
log.info("게시글의 모든 이미지 삭제: boardId={}, count={}", boardId, images.size());
`````

## File: src/main/java/com/example/carelink/service/ReviewImageService.java
`````java
public class ReviewImageService {
⋮----
public List<ReviewImageDTO> getImagesByReviewId(Long reviewId) {
log.info("리뷰 이미지 조회: reviewId={}", reviewId);
return reviewImageMapper.getImagesByReviewId(reviewId);
⋮----
public List<ReviewImageDTO> getImagesByFacilityId(Long facilityId) {
log.info("시설 리뷰 이미지 조회: facilityId={}", facilityId);
return reviewImageMapper.getImagesByFacilityId(facilityId);
⋮----
public List<ReviewImageDTO> uploadImages(Long reviewId, List<MultipartFile> imageFiles,
⋮----
int existingCount = reviewImageMapper.countActiveImagesByReviewId(reviewId);
if (existingCount + imageFiles.size() > MAX_REVIEW_IMAGES) {
throw new IllegalArgumentException(
String.format("리뷰 이미지는 최대 %d개까지 업로드 가능합니다. 현재 %d개, 추가 요청 %d개",
MAX_REVIEW_IMAGES, existingCount, imageFiles.size())
⋮----
for (int i = 0; i < imageFiles.size(); i++) {
MultipartFile file = imageFiles.get(i);
String altText = (altTexts != null && i < altTexts.size()) ? altTexts.get(i) : null;
⋮----
ReviewImageDTO imageDTO = processAndSaveImage(reviewId, file, existingCount + i, altText);
uploadedImages.add(imageDTO);
⋮----
log.error("리뷰 이미지 업로드 실패: reviewId={}, fileName={}",
reviewId, file.getOriginalFilename(), e);
⋮----
if (!uploadedImages.isEmpty()) {
reviewImageMapper.insertImages(uploadedImages);
log.info("리뷰 이미지 {} 개 업로드 완료: reviewId={}", uploadedImages.size(), reviewId);
⋮----
public ReviewImageDTO uploadImage(Long reviewId, MultipartFile imageFile, String altText) {
⋮----
String.format("리뷰 이미지는 최대 %d개까지 업로드 가능합니다.", MAX_REVIEW_IMAGES)
⋮----
ReviewImageDTO imageDTO = processAndSaveImage(reviewId, imageFile, existingCount, altText);
reviewImageMapper.insertImage(imageDTO);
log.info("리뷰 이미지 업로드 완료: reviewId={}, imageId={}", reviewId, imageDTO.getImageId());
⋮----
private ReviewImageDTO processAndSaveImage(Long reviewId, MultipartFile file,
⋮----
if (!imageOptimizationService.isSupportedImageFormat(file.getOriginalFilename())) {
throw new IllegalArgumentException("지원하지 않는 이미지 형식입니다.");
⋮----
String baseFileName = String.format("review_%d_%d_%s",
reviewId, imageOrder, UUID.randomUUID().toString().substring(0, 8));
log.info("리뷰 이미지 WebP 변환 시작: reviewId={}, order={}, file={}",
reviewId, imageOrder, file.getOriginalFilename());
⋮----
imageOptimizationService.processImage(file, baseFileName, REVIEW_UPLOAD_PATH);
ReviewImageDTO imageDTO = ReviewImageDTO.builder()
.reviewId(reviewId)
.imagePath("/uploads/review/" + baseFileName + "_original.jpg")
.webpPath("/uploads/review/" + result.getOriginalWebPPath())
.thumbnailSmall("/uploads/review/" + result.getThumbnails().get("small"))
.thumbnailMedium("/uploads/review/" + result.getThumbnails().get("medium"))
.thumbnailLarge("/uploads/review/" + result.getThumbnails().get("large"))
.fallbackJpgPath("/uploads/review/" + result.getFallbackJpgPath())
.originalFilename(file.getOriginalFilename())
.fileSize(file.getSize())
.fileSizeWebp((long)(file.getSize() * 0.3))
.width(result.getOriginalWidth())
.height(result.getOriginalHeight())
.altText(altText != null ? altText : generateDefaultAltText(reviewId, imageOrder))
.imageOrder(imageOrder)
.isActive(true)
.build();
log.info("리뷰 이미지 WebP 변환 완료: reviewId={}, webpPath={}",
reviewId, imageDTO.getWebpPath());
⋮----
private String generateDefaultAltText(Long reviewId, int imageOrder) {
return String.format("리뷰 #%d의 이미지 %d", reviewId, imageOrder + 1);
⋮----
public void updateImageOrder(Long imageId, Integer newOrder) {
reviewImageMapper.updateImageOrder(imageId, newOrder);
log.info("리뷰 이미지 순서 변경: imageId={}, newOrder={}", imageId, newOrder);
⋮----
public void updateImageAltText(Long imageId, String altText) {
reviewImageMapper.updateImageAltText(imageId, altText);
log.info("리뷰 이미지 대체 텍스트 수정: imageId={}", imageId);
⋮----
public void deleteImage(Long imageId) {
ReviewImageDTO image = reviewImageMapper.getImageById(imageId);
⋮----
reviewImageMapper.deleteImage(imageId);
log.info("리뷰 이미지 삭제 완료: imageId={}", imageId);
⋮----
public void deleteAllImagesByReviewId(Long reviewId) {
List<ReviewImageDTO> images = reviewImageMapper.getImagesByReviewId(reviewId);
reviewImageMapper.deleteImagesByReviewId(reviewId);
log.info("리뷰의 모든 이미지 삭제: reviewId={}, count={}", reviewId, images.size());
⋮----
public int getTotalImageCountByFacilityId(Long facilityId) {
return reviewImageMapper.getTotalImageCountByFacilityId(facilityId);
⋮----
public int getImageCountByMemberId(Long memberId) {
return reviewImageMapper.getImageCountByMemberId(memberId);
`````

## File: src/main/resources/mapper/boardImageMapper.xml
`````xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.BoardImageMapper">
    <resultMap id="boardImageResultMap" type="com.example.carelink.dto.BoardImageDTO">
        <id property="imageId" column="image_id"/>
        <result property="boardId" column="board_id"/>
        <result property="imagePath" column="image_path"/>
        <result property="webpPath" column="webp_path"/>
        <result property="thumbnailSmall" column="thumbnail_small"/>
        <result property="thumbnailMedium" column="thumbnail_medium"/>
        <result property="thumbnailLarge" column="thumbnail_large"/>
        <result property="fallbackJpgPath" column="fallback_jpg_path"/>
        <result property="originalFilename" column="original_filename"/>
        <result property="fileSize" column="file_size"/>
        <result property="fileSizeWebp" column="file_size_webp"/>
        <result property="width" column="width"/>
        <result property="height" column="height"/>
        <result property="altText" column="alt_text"/>
        <result property="caption" column="caption"/>
        <result property="imageOrder" column="image_order"/>
        <result property="isActive" column="is_active"/>
        <result property="uploadDate" column="upload_date"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>
    <select id="getImagesByBoardId" resultMap="boardImageResultMap">
        SELECT *
        FROM board_images
        WHERE board_id = #{boardId}
          AND is_active = TRUE
        ORDER BY image_order ASC
    </select>
    <select id="getImageById" resultMap="boardImageResultMap">
        SELECT *
        FROM board_images
        WHERE image_id = #{imageId}
    </select>
    <select id="countActiveImagesByBoardId" resultType="int">
        SELECT COUNT(*)
        FROM board_images
        WHERE board_id = #{boardId}
          AND is_active = TRUE
    </select>
    <insert id="insertImage" parameterType="com.example.carelink.dto.BoardImageDTO"
            useGeneratedKeys="true" keyProperty="imageId">
        INSERT INTO board_images (
            board_id, image_path, webp_path,
            thumbnail_small, thumbnail_medium, thumbnail_large,
            fallback_jpg_path, original_filename,
            file_size, file_size_webp, width, height,
            alt_text, caption, image_order, is_active
        ) VALUES (
            #{boardId}, #{imagePath}, #{webpPath},
            #{thumbnailSmall}, #{thumbnailMedium}, #{thumbnailLarge},
            #{fallbackJpgPath}, #{originalFilename},
            #{fileSize}, #{fileSizeWebp}, #{width}, #{height},
            #{altText}, #{caption}, #{imageOrder}, #{isActive}
        )
    </insert>
    <insert id="insertImages" parameterType="list">
        INSERT INTO board_images (
            board_id, image_path, webp_path,
            thumbnail_small, thumbnail_medium, thumbnail_large,
            fallback_jpg_path, original_filename,
            file_size, file_size_webp, width, height,
            alt_text, caption, image_order, is_active
        ) VALUES
        <foreach collection="images" item="image" separator=",">
        (
            #{image.boardId}, #{image.imagePath}, #{image.webpPath},
            #{image.thumbnailSmall}, #{image.thumbnailMedium}, #{image.thumbnailLarge},
            #{image.fallbackJpgPath}, #{image.originalFilename},
            #{image.fileSize}, #{image.fileSizeWebp}, #{image.width}, #{image.height},
            #{image.altText}, #{image.caption}, #{image.imageOrder}, #{image.isActive}
        )
        </foreach>
    </insert>
    <update id="updateImage" parameterType="com.example.carelink.dto.BoardImageDTO">
        UPDATE board_images
        SET alt_text = #{altText},
            caption = #{caption},
            image_order = #{imageOrder},
            updated_at = CURRENT_TIMESTAMP
        WHERE image_id = #{imageId}
    </update>
    <update id="updateImageOrder">
        UPDATE board_images
        SET image_order = #{imageOrder},
            updated_at = CURRENT_TIMESTAMP
        WHERE image_id = #{imageId}
    </update>
    <update id="updateImageAltText">
        UPDATE board_images
        SET alt_text = #{altText},
            updated_at = CURRENT_TIMESTAMP
        WHERE image_id = #{imageId}
    </update>
    <delete id="deleteImage">
        DELETE FROM board_images
        WHERE image_id = #{imageId}
    </delete>
    <update id="deactivateImage">
        UPDATE board_images
        SET is_active = FALSE,
            updated_at = CURRENT_TIMESTAMP
        WHERE image_id = #{imageId}
    </update>
    <delete id="deleteImagesByBoardId">
        DELETE FROM board_images
        WHERE board_id = #{boardId}
    </delete>
    <select id="getTotalImageCountByBoardType" resultType="int">
        SELECT COUNT(bi.image_id)
        FROM board_images bi
        INNER JOIN board b ON bi.board_id = b.board_id
        WHERE b.board_type = #{boardType}
          AND bi.is_active = TRUE
    </select>
    <select id="getTotalImageSize" resultType="long">
        SELECT COALESCE(SUM(file_size), 0)
        FROM board_images
        WHERE is_active = TRUE
    </select>
</mapper>
`````

## File: src/main/resources/mapper/reviewImageMapper.xml
`````xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.ReviewImageMapper">
    <resultMap id="reviewImageResultMap" type="com.example.carelink.dto.ReviewImageDTO">
        <id property="imageId" column="image_id"/>
        <result property="reviewId" column="review_id"/>
        <result property="imagePath" column="image_path"/>
        <result property="webpPath" column="webp_path"/>
        <result property="thumbnailSmall" column="thumbnail_small"/>
        <result property="thumbnailMedium" column="thumbnail_medium"/>
        <result property="thumbnailLarge" column="thumbnail_large"/>
        <result property="fallbackJpgPath" column="fallback_jpg_path"/>
        <result property="originalFilename" column="original_filename"/>
        <result property="fileSize" column="file_size"/>
        <result property="fileSizeWebp" column="file_size_webp"/>
        <result property="width" column="width"/>
        <result property="height" column="height"/>
        <result property="altText" column="alt_text"/>
        <result property="caption" column="caption"/>
        <result property="imageOrder" column="image_order"/>
        <result property="isActive" column="is_active"/>
        <result property="uploadDate" column="upload_date"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>
    <select id="getImagesByReviewId" resultMap="reviewImageResultMap">
        SELECT *
        FROM review_images
        WHERE review_id = #{reviewId}
          AND is_active = TRUE
        ORDER BY image_order ASC
    </select>
    <select id="getImageById" resultMap="reviewImageResultMap">
        SELECT *
        FROM review_images
        WHERE image_id = #{imageId}
    </select>
    <select id="countActiveImagesByReviewId" resultType="int">
        SELECT COUNT(*)
        FROM review_images
        WHERE review_id = #{reviewId}
          AND is_active = TRUE
    </select>
    <select id="getImagesByFacilityId" resultMap="reviewImageResultMap">
        SELECT ri.*
        FROM review_images ri
        INNER JOIN review r ON ri.review_id = r.review_id
        WHERE r.facility_id = #{facilityId}
          AND ri.is_active = TRUE
          AND r.is_visible = TRUE
        ORDER BY ri.upload_date DESC
    </select>
    <insert id="insertImage" parameterType="com.example.carelink.dto.ReviewImageDTO"
            useGeneratedKeys="true" keyProperty="imageId">
        INSERT INTO review_images (
            review_id, image_path, webp_path,
            thumbnail_small, thumbnail_medium, thumbnail_large,
            fallback_jpg_path, original_filename,
            file_size, file_size_webp, width, height,
            alt_text, caption, image_order, is_active
        ) VALUES (
            #{reviewId}, #{imagePath}, #{webpPath},
            #{thumbnailSmall}, #{thumbnailMedium}, #{thumbnailLarge},
            #{fallbackJpgPath}, #{originalFilename},
            #{fileSize}, #{fileSizeWebp}, #{width}, #{height},
            #{altText}, #{caption}, #{imageOrder}, #{isActive}
        )
    </insert>
    <insert id="insertImages" parameterType="list">
        INSERT INTO review_images (
            review_id, image_path, webp_path,
            thumbnail_small, thumbnail_medium, thumbnail_large,
            fallback_jpg_path, original_filename,
            file_size, file_size_webp, width, height,
            alt_text, caption, image_order, is_active
        ) VALUES
        <foreach collection="images" item="image" separator=",">
        (
            #{image.reviewId}, #{image.imagePath}, #{image.webpPath},
            #{image.thumbnailSmall}, #{image.thumbnailMedium}, #{image.thumbnailLarge},
            #{image.fallbackJpgPath}, #{image.originalFilename},
            #{image.fileSize}, #{image.fileSizeWebp}, #{image.width}, #{image.height},
            #{image.altText}, #{image.caption}, #{image.imageOrder}, #{image.isActive}
        )
        </foreach>
    </insert>
    <update id="updateImage" parameterType="com.example.carelink.dto.ReviewImageDTO">
        UPDATE review_images
        SET alt_text = #{altText},
            caption = #{caption},
            image_order = #{imageOrder},
            updated_at = CURRENT_TIMESTAMP
        WHERE image_id = #{imageId}
    </update>
    <update id="updateImageOrder">
        UPDATE review_images
        SET image_order = #{imageOrder},
            updated_at = CURRENT_TIMESTAMP
        WHERE image_id = #{imageId}
    </update>
    <update id="updateImageAltText">
        UPDATE review_images
        SET alt_text = #{altText},
            updated_at = CURRENT_TIMESTAMP
        WHERE image_id = #{imageId}
    </update>
    <delete id="deleteImage">
        DELETE FROM review_images
        WHERE image_id = #{imageId}
    </delete>
    <update id="deactivateImage">
        UPDATE review_images
        SET is_active = FALSE,
            updated_at = CURRENT_TIMESTAMP
        WHERE image_id = #{imageId}
    </update>
    <delete id="deleteImagesByReviewId">
        DELETE FROM review_images
        WHERE review_id = #{reviewId}
    </delete>
    <select id="getTotalImageCountByFacilityId" resultType="int">
        SELECT COUNT(ri.image_id)
        FROM review_images ri
        INNER JOIN review r ON ri.review_id = r.review_id
        WHERE r.facility_id = #{facilityId}
          AND ri.is_active = TRUE
    </select>
    <select id="getTotalImageSize" resultType="long">
        SELECT COALESCE(SUM(file_size), 0)
        FROM review_images
        WHERE is_active = TRUE
    </select>
    <select id="getImageCountByMemberId" resultType="int">
        SELECT COUNT(ri.image_id)
        FROM review_images ri
        INNER JOIN review r ON ri.review_id = r.review_id
        WHERE r.member_id = #{memberId}
          AND ri.is_active = TRUE
    </select>
</mapper>
`````

## File: src/main/resources/mybatis-config.xml
`````xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <settings>
        <setting name="mapUnderscoreToCamelCase" value="true"/>
        <setting name="callSettersOnNulls" value="true"/>
        <setting name="lazyLoadingEnabled" value="false"/>
    </settings>
    <typeAliases>
        <package name="com.example.carelink.dto"/>
    </typeAliases>
</configuration>
`````

## File: src/main/resources/schema-image-attachments.sql
`````sql
CREATE TABLE IF NOT EXISTS board_images (
    image_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '이미지 ID',
    board_id BIGINT NOT NULL COMMENT '게시글 ID',
    image_path VARCHAR(500) NOT NULL COMMENT '원본 이미지 경로',
    webp_path VARCHAR(500) COMMENT 'WebP 변환 이미지 경로',
    thumbnail_small VARCHAR(500) COMMENT '작은 썸네일 경로 (300x200)',
    thumbnail_medium VARCHAR(500) COMMENT '중간 썸네일 경로 (600x400)',
    thumbnail_large VARCHAR(500) COMMENT '큰 썸네일 경로 (1200x800)',
    fallback_jpg_path VARCHAR(500) COMMENT 'JPG fallback 경로',
    original_filename VARCHAR(255) COMMENT '원본 파일명',
    file_size BIGINT COMMENT '파일 크기 (bytes)',
    file_size_webp BIGINT COMMENT 'WebP 파일 크기 (bytes)',
    width INT COMMENT '이미지 너비',
    height INT COMMENT '이미지 높이',
    alt_text VARCHAR(255) COMMENT '이미지 대체 텍스트 (SEO/접근성)',
    caption VARCHAR(500) COMMENT '이미지 설명',
    image_order INT DEFAULT 0 COMMENT '이미지 순서',
    is_active BOOLEAN DEFAULT TRUE COMMENT '활성 상태',
    upload_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '업로드 일시',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 일시',
    FOREIGN KEY (board_id) REFERENCES board(board_id) ON DELETE CASCADE,
    INDEX idx_board_images_board_id (board_id),
    INDEX idx_board_images_order (board_id, image_order)
) COMMENT='게시판 이미지 첨부파일 (WebP 지원)';
CREATE TABLE IF NOT EXISTS review_images (
    image_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '이미지 ID',
    review_id BIGINT NOT NULL COMMENT '리뷰 ID',
    image_path VARCHAR(500) NOT NULL COMMENT '원본 이미지 경로',
    webp_path VARCHAR(500) COMMENT 'WebP 변환 이미지 경로',
    thumbnail_small VARCHAR(500) COMMENT '작은 썸네일 경로 (300x200)',
    thumbnail_medium VARCHAR(500) COMMENT '중간 썸네일 경로 (600x400)',
    thumbnail_large VARCHAR(500) COMMENT '큰 썸네일 경로 (1200x800)',
    fallback_jpg_path VARCHAR(500) COMMENT 'JPG fallback 경로',
    original_filename VARCHAR(255) COMMENT '원본 파일명',
    file_size BIGINT COMMENT '파일 크기 (bytes)',
    file_size_webp BIGINT COMMENT 'WebP 파일 크기 (bytes)',
    width INT COMMENT '이미지 너비',
    height INT COMMENT '이미지 높이',
    alt_text VARCHAR(255) COMMENT '이미지 대체 텍스트 (SEO/접근성)',
    caption VARCHAR(500) COMMENT '이미지 설명',
    image_order INT DEFAULT 0 COMMENT '이미지 순서',
    is_active BOOLEAN DEFAULT TRUE COMMENT '활성 상태',
    upload_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '업로드 일시',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 일시',
    FOREIGN KEY (review_id) REFERENCES review(review_id) ON DELETE CASCADE,
    INDEX idx_review_images_review_id (review_id),
    INDEX idx_review_images_order (review_id, image_order)
) COMMENT='리뷰 이미지 첨부파일 (WebP 지원)';
ALTER TABLE board
ADD COLUMN IF NOT EXISTS image_count INT DEFAULT 0 COMMENT '첨부 이미지 개수',
ADD COLUMN IF NOT EXISTS has_images BOOLEAN DEFAULT FALSE COMMENT '이미지 포함 여부';
ALTER TABLE review
ADD COLUMN IF NOT EXISTS image_count INT DEFAULT 0 COMMENT '첨부 이미지 개수',
ADD COLUMN IF NOT EXISTS has_images BOOLEAN DEFAULT FALSE COMMENT '이미지 포함 여부';
DELIMITER $$
CREATE TRIGGER update_board_image_count
AFTER INSERT ON board_images
FOR EACH ROW
BEGIN
    UPDATE board
    SET image_count = (
        SELECT COUNT(*) FROM board_images
        WHERE board_id = NEW.board_id AND is_active = TRUE
    ),
    has_images = TRUE
    WHERE board_id = NEW.board_id;
END$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER update_review_image_count
AFTER INSERT ON review_images
FOR EACH ROW
BEGIN
    UPDATE review
    SET image_count = (
        SELECT COUNT(*) FROM review_images
        WHERE review_id = NEW.review_id AND is_active = TRUE
    ),
    has_images = TRUE
    WHERE review_id = NEW.review_id;
END$$
DELIMITER ;
`````

## File: docker-compose.aws.yml
`````yaml
version: '3.8'
services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: carelink-app
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - DB_URL=${DB_URL:-jdbc:mysql://localhost:3306/carelink?useSSL=false&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=UTF-8}
      - DB_USERNAME=${DB_USERNAME:-root}
      - DB_PASSWORD=${DB_PASSWORD:-mysql}
      - KAKAO_APP_KEY=${KAKAO_APP_KEY:-your_kakao_app_key}
      - KAKAO_REST_API_KEY=${KAKAO_REST_API_KEY:-your_kakao_rest_api_key}
      - UPLOAD_BASE_PATH=${UPLOAD_BASE_PATH:-/carelink-uploads/}
      - LOGGING_LEVEL_ROOT=INFO
      - LOGGING_LEVEL_COM_EXAMPLE_CARELINK=DEBUG
      - JAVA_OPTS=-Xms512m -Xmx1024m -XX:+UseContainerSupport -XX:MaxRAMPercentage=75.0
    volumes:
      - carelink-uploads:/carelink-uploads
      - ./logs:/app/logs
    restart: unless-stopped
    networks:
      - carelink-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
volumes:
  carelink-uploads:
    name: carelink-uploads
    driver: local
networks:
  carelink-network:
    name: carelink-network
    driver: bridge
`````

## File: IMAGE_UPLOAD_TEST_CHECKLIST.md
`````markdown
# 🧪 이미지 업로드 기능 테스트 체크리스트

## 📋 테스트 준비사항

### ✅ 사전 준비
- [ ] Java 11+ 설치 확인 (`java -version`)
- [ ] MySQL 서버 실행 상태 확인
- [ ] 데이터베이스 스키마 적용 (`schema-image-attachments.sql`)
- [ ] 업로드 디렉토리 생성 (`setup-directories.bat` 실행)
- [ ] Spring Boot 애플리케이션 실행 (`quick-test.bat` 또는 `gradlew.bat bootRun`)

---

## 🎯 게시글 이미지 업로드 테스트

### URL: `http://localhost:8080/board/write`

#### 기본 업로드 기능
- [ ] **드래그 앤 드롭**: 이미지 파일을 드래그해서 업로드 영역에 드롭
- [ ] **파일 선택**: 업로드 영역 클릭 → 파일 선택 대화상자 → 이미지 선택
- [ ] **다중 선택**: Ctrl 키를 누르고 여러 이미지 동시 선택
- [ ] **실시간 미리보기**: 선택한 이미지가 즉시 미리보기로 표시됨

#### 제한사항 테스트
- [ ] **파일 개수 제한**: 10개 초과 선택 시 경고 메시지 표시
- [ ] **파일 크기 제한**: 5MB 초과 파일 업로드 시 경고 메시지 표시
- [ ] **파일 형식 제한**: JPG, PNG, GIF, WebP 외 형식 업로드 시 거부

#### UI/UX 테스트
- [ ] **호버 효과**: 업로드 영역에 마우스 올릴 때 색상 변화
- [ ] **드래그오버 효과**: 파일 드래그 중 영역 강조 표시
- [ ] **이미지 카운터**: 우하단에 "현재개수/10개" 표시
- [ ] **개별 삭제**: 각 이미지의 X 버튼으로 개별 삭제 가능
- [ ] **alt text 입력**: 각 이미지마다 설명 텍스트 입력 가능

#### 백엔드 연동 테스트
- [ ] **게시글 작성**: 이미지와 함께 게시글 정상 등록
- [ ] **데이터베이스 저장**: `board_images` 테이블에 이미지 정보 저장 확인
- [ ] **파일 시스템**: `C:/carelink-uploads/board/` 폴더에 파일 저장 확인

---

## ⭐ 리뷰 이미지 업로드 테스트

### URL: `http://localhost:8080/review/write`

#### 기본 업로드 기능
- [ ] **드래그 앤 드롭**: 이미지 파일을 드래그해서 업로드 영역에 드롭
- [ ] **파일 선택**: 업로드 영역 클릭 → 파일 선택 대화상자 → 이미지 선택
- [ ] **다중 선택**: 최대 5개까지 이미지 동시 선택
- [ ] **실시간 미리보기**: 선택한 이미지가 즉시 미리보기로 표시됨

#### 제한사항 테스트
- [ ] **파일 개수 제한**: 5개 초과 선택 시 경고 메시지 표시
- [ ] **파일 크기 제한**: 5MB 초과 파일 업로드 시 경고 메시지 표시
- [ ] **파일 형식 제한**: 이미지 파일만 허용

#### WebP 변환 테스트
- [ ] **자동 변환**: JPG/PNG → WebP 자동 변환
- [ ] **썸네일 생성**: Small(300x200), Medium(600x400), Large(1200x800) 썸네일 생성
- [ ] **폴백 JPG**: 브라우저 호환성을 위한 JPG 폴백 파일 생성
- [ ] **파일 크기 절약**: WebP 변환으로 50-70% 용량 절약 확인

#### 백엔드 연동 테스트
- [ ] **리뷰 작성**: 이미지와 함께 리뷰 정상 등록
- [ ] **데이터베이스 저장**: `review_images` 테이블에 이미지 정보 저장 확인
- [ ] **파일 시스템**: `C:/carelink-uploads/review/` 폴더에 파일 저장 확인

---

## 🔧 AJAX API 테스트 (고급)

### 개발자 도구(F12) 네트워크 탭에서 확인

#### 게시글 이미지 API
- [ ] **POST** `/board/api/upload-images/{boardId}`: 이미지 업로드 API
- [ ] **DELETE** `/board/api/delete-image/{imageId}`: 이미지 삭제 API
- [ ] **응답 상태**: 200 OK (성공), 400/401/403 (오류)
- [ ] **응답 데이터**: JSON 형태로 업로드된 이미지 정보 반환

#### 리뷰 이미지 API
- [ ] **POST** `/review/api/upload-images/{reviewId}`: 이미지 업로드 API
- [ ] **DELETE** `/review/api/delete-image/{imageId}`: 이미지 삭제 API
- [ ] **응답 처리**: 성공/실패 메시지 적절히 표시

---

## 🗄️ 데이터베이스 검증

### `board_images` 테이블 확인
```sql
SELECT * FROM board_images WHERE board_id = [게시글ID];
```
- [ ] `webp_path`: WebP 변환 파일 경로
- [ ] `thumbnail_small/medium/large`: 썸네일 경로들
- [ ] `fallback_jpg_path`: JPG 폴백 경로
- [ ] `alt_text`: 사용자 입력 설명 텍스트
- [ ] `file_size_webp < file_size`: WebP 압축 효과 확인

### `review_images` 테이블 확인
```sql
SELECT * FROM review_images WHERE review_id = [리뷰ID];
```
- [ ] 동일한 구조로 데이터 저장 확인

### 카운트 업데이트 확인
```sql
SELECT board_id, image_count, has_images FROM board WHERE image_count > 0;
SELECT review_id, image_count, has_images FROM review WHERE image_count > 0;
```
- [ ] 트리거로 자동 업데이트되는 카운트 확인

---

## 📱 반응형 테스트

### 다양한 화면 크기에서 테스트
- [ ] **데스크톱** (1920x1080): 정상 표시
- [ ] **태블릿** (768x1024): 레이아웃 조정 확인
- [ ] **모바일** (375x667): 터치 인터페이스 동작 확인

---

## 🐛 오류 상황 테스트

### 예상 오류 상황들
- [ ] **네트워크 오류**: 인터넷 연결 끊김 시 적절한 오류 메시지
- [ ] **서버 오류**: 서버 다운 시 사용자 친화적 오류 처리
- [ ] **권한 오류**: 디렉토리 쓰기 권한 없을 때 오류 처리
- [ ] **디스크 용량 부족**: 충분한 저장 공간이 없을 때 처리

---

## ✅ 테스트 완료 후 확인사항

### 파일 시스템 확인
```
C:/carelink-uploads/
├── board/
│   ├── board_1_0_a1b2c3d4_original.jpg
│   ├── board_1_0_a1b2c3d4.webp
│   ├── board_1_0_a1b2c3d4_small.webp
│   ├── board_1_0_a1b2c3d4_medium.webp
│   └── board_1_0_a1b2c3d4_large.webp
└── review/
    ├── review_1_0_e5f6g7h8_original.jpg
    ├── review_1_0_e5f6g7h8.webp
    ├── review_1_0_e5f6g7h8_small.webp
    ├── review_1_0_e5f6g7h8_medium.webp
    └── review_1_0_e5f6g7h8_large.webp
```

### 성능 확인
- [ ] **페이지 로딩 속도**: WebP 이미지로 빠른 로딩 확인
- [ ] **업로드 속도**: 대용량 이미지의 원활한 업로드
- [ ] **메모리 사용량**: 다중 이미지 처리 시 메모리 누수 없음

---

## 🎉 테스트 성공 기준

모든 체크박스가 ✅로 완료되면 이미지 업로드 기능이 완전히 구현된 것입니다!

### 🚀 추가 개선 아이디어
- [ ] 이미지 순서 변경 (드래그 앤 드롭)
- [ ] 이미지 편집 기능 (크롭, 회전)
- [ ] 진행률 표시 바
- [ ] 이미지 압축 옵션
- [ ] 워터마크 추가
- [ ] 이미지 메타데이터 표시
`````

## File: lightcare-ai-summary.md
`````markdown
This file is a merged representation of a subset of the codebase, containing specifically included files and files not matching ignore patterns, combined into a single document by Repomix.
The content has been processed where comments have been removed, empty lines have been removed.

# File Summary

## Purpose
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  a. A header with the file path (## File: path/to/file)
  b. The full contents of the file in a code block

## Usage Guidelines
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
- Pay special attention to the Repository Description. These contain important context and guidelines specific to this project.

## Notes
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: src/main/java/**/*.java, src/main/resources/application.yml, src/main/resources/mapper/*.xml, build.gradle, README.md, CLAUDE.md
- Files matching these patterns are excluded: **/test/**, **/static/js/bootstrap*, **/static/js/jquery*, **/static/css/bootstrap*, **/*.html, **/backup/**, **/images/**, **/*.png, **/*.jpg, **/deploy-*.sh, **/facility-image-*.js, **/crop-*.html, **/edit.html
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Code comments have been removed from supported file types
- Empty lines have been removed from all files
- Files are sorted by Git change count (files with more changes are at the bottom)

# User Provided Header
LightCare Project Summary for AI Analysis

# Directory Structure
```
src/
  main/
    java/
      com/
        example/
          carelink/
            common/
              BaseDTO.java
              Constants.java
              CustomMultipartFile.java
              PageInfo.java
            config/
              DevSecurityConfig.java
              KakaoApiConfig.java
              ProdSecurityConfig.java
              SecurityConfig.java
              WebConfig.java
            controller/
              AdminController.java
              BoardController.java
              FacilityController.java
              FacilityImageApiController.java
              HomeController.java
              JobController.java
              MemberController.java
              ReviewController.java
            dao/
              BoardMapper.java
              FacilityImageMapper.java
              FacilityMapper.java
              JobApplicationMapper.java
              JobMapper.java
              MemberMapper.java
              ReviewMapper.java
            dto/
              BoardDTO.java
              FacilityDTO.java
              FacilityImageDTO.java
              JobApplicationDTO.java
              JobDTO.java
              LoginDTO.java
              MemberDTO.java
              ReviewDTO.java
            service/
              BoardService.java
              FacilityImageService.java
              FacilityService.java
              JobService.java
              MemberService.java
              ReviewService.java
            validation/
              groups/
                OnFacilityJoin.java
            CarelinkApplication.java
      Crolling.java
    resources/
      mapper/
        boardMapper.xml
        facilityImageMapper.xml
        facilityMapper.xml
        JobApplicationMapper.xml
        jobMapper.xml
        MemberMapper.xml
        reviewMapper.xml
      application.yml
build.gradle
CLAUDE.md
README.md
```

# Files

## File: src/main/java/com/example/carelink/dto/LoginDTO.java
````java
package com.example.carelink.dto;
import lombok.Data;
import javax.validation.constraints.NotBlank;
@Data
public class LoginDTO {
    @NotBlank(message = "사용자 ID를 입력해주세요")
    private String userId;
    @NotBlank(message = "비밀번호를 입력해주세요")
    private String password;
    private boolean rememberMe;
}
````

## File: src/main/java/com/example/carelink/common/CustomMultipartFile.java
````java
package com.example.carelink.common;
import org.springframework.web.multipart.MultipartFile;
import java.io.*;
public class CustomMultipartFile implements MultipartFile {
    private final String name;
    private final String originalFilename;
    private final String contentType;
    private final byte[] content;
    public CustomMultipartFile(String name, String originalFilename, String contentType, byte[] content) {
        this.name = name;
        this.originalFilename = originalFilename;
        this.contentType = contentType;
        this.content = content;
    }
    @Override
    public String getName() {
        return name;
    }
    @Override
    public String getOriginalFilename() {
        return originalFilename;
    }
    @Override
    public String getContentType() {
        return contentType;
    }
    @Override
    public boolean isEmpty() {
        return content == null || content.length == 0;
    }
    @Override
    public long getSize() {
        return content != null ? content.length : 0;
    }
    @Override
    public byte[] getBytes() throws IOException {
        return content;
    }
    @Override
    public InputStream getInputStream() throws IOException {
        return new ByteArrayInputStream(content);
    }
    @Override
    public void transferTo(File dest) throws IOException, IllegalStateException {
        try (FileOutputStream fos = new FileOutputStream(dest)) {
            fos.write(content);
        }
    }
}
````

## File: src/main/java/com/example/carelink/common/PageInfo.java
````java
package com.example.carelink.common;
import lombok.Getter;
import lombok.Setter;
import java.util.List;
@Getter
@Setter
public class PageInfo<T> {
    private List<T> list;
    private int currentPage;
    private int pageSize;
    private int totalCount;
    private int totalPages;
    private int startPage;
    private int endPage;
    private boolean hasPrevious;
    private boolean hasNext;
    private boolean firstPage;
    private boolean lastPage;
    public PageInfo(List<T> list, int currentPage, int pageSize, int totalCount) {
        this.list = list;
        this.currentPage = currentPage;
        this.pageSize = pageSize;
        this.totalCount = totalCount;
        this.totalPages = (int) Math.ceil((double) totalCount / pageSize);
        this.startPage = Math.max(1, currentPage - 4);
        this.endPage = Math.min(totalPages, currentPage + 4);
        this.hasPrevious = currentPage > 1;
        this.hasNext = currentPage < totalPages;
        this.firstPage = currentPage == 1;
        this.lastPage = currentPage == totalPages;
    }
    public int getOffset() {
        return (currentPage - 1) * pageSize;
    }
    public boolean isFirstPage() {
        return currentPage == 1;
    }
    public boolean isLastPage() {
        return currentPage == totalPages;
    }
}
````

## File: src/main/java/com/example/carelink/config/DevSecurityConfig.java
````java
package com.example.carelink.config;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Profile;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.web.SecurityFilterChain;
@Configuration
@EnableWebSecurity
@Profile("dev")
public class DevSecurityConfig {
    @Bean
    public SecurityFilterChain devFilterChain(HttpSecurity http) throws Exception {
        http
            .csrf(csrf -> csrf.disable())
            .authorizeHttpRequests(auth -> auth
                .anyRequest().permitAll()
            )
            .formLogin(formLogin -> formLogin.disable())
            .httpBasic(httpBasic -> httpBasic.disable());
        return http.build();
    }
}
````

## File: src/main/java/com/example/carelink/config/KakaoApiConfig.java
````java
package com.example.carelink.config;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.springframework.web.servlet.HandlerInterceptor;
import org.springframework.web.servlet.ModelAndView;
@Configuration
public class KakaoApiConfig implements WebMvcConfigurer {
    @Value("${api.kakao.app-key:#{null}}")
    private String kakaoAppKey;
    private String getKakaoAppKey() {
        String key = kakaoAppKey;
        if (key == null || key.isEmpty()) {
            key = System.getenv("KAKAO_APP_KEY");
            System.out.println("환경변수에서 직접 읽은 API 키: " + (key != null ? "존재함" : "없음"));
        }
        return key;
    }
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new KakaoApiInterceptor());
    }
    public class KakaoApiInterceptor implements HandlerInterceptor {
        @Override
        public void postHandle(HttpServletRequest request, HttpServletResponse response,
                             Object handler, ModelAndView modelAndView) throws Exception {
            if (modelAndView != null && !modelAndView.getViewName().startsWith("redirect:")) {
                String apiKey = getKakaoAppKey();
                System.out.println("뷰에 전달할 API 키: " + (apiKey != null && !apiKey.isEmpty() ? "존재함" : "없음"));
                modelAndView.addObject("KAKAO_APP_KEY", apiKey);
            }
        }
    }
}
````

## File: src/main/java/com/example/carelink/config/ProdSecurityConfig.java
````java
package com.example.carelink.config;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Profile;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.util.matcher.AntPathRequestMatcher;
@Configuration
@EnableWebSecurity
@Profile("prod")
public class ProdSecurityConfig {
    @Bean
    public SecurityFilterChain prodFilterChain(HttpSecurity http) throws Exception {
        http
            .csrf(csrf -> csrf
                .csrfTokenRepository(org.springframework.security.web.csrf.CookieCsrfTokenRepository.withHttpOnlyFalse())
            )
            .authorizeHttpRequests(auth -> auth
                .requestMatchers(
                    new AntPathRequestMatcher("/css/**"),
                    new AntPathRequestMatcher("/js/**"),
                    new AntPathRequestMatcher("/images/**"),
                    new AntPathRequestMatcher("/favicon.ico")
                ).permitAll()
                .requestMatchers(
                    new AntPathRequestMatcher("/"),
                    new AntPathRequestMatcher("/member/login"),
                    new AntPathRequestMatcher("/member/join"),
                    new AntPathRequestMatcher("/member/checkUserId"),
                    new AntPathRequestMatcher("/facility/**"),
                    new AntPathRequestMatcher("/board/**"),
                    new AntPathRequestMatcher("/review/**"),
                    new AntPathRequestMatcher("/job/**"),
                    new AntPathRequestMatcher("/api/**"),
                    new AntPathRequestMatcher("/error")
                ).permitAll()
                .requestMatchers(new AntPathRequestMatcher("/admin/**")).hasRole("ADMIN")
                .anyRequest().authenticated()
            )
            .formLogin(formLogin -> formLogin
                .loginPage("/member/login")
                .defaultSuccessUrl("/")
                .failureUrl("/member/login?error=true")
                .permitAll()
            )
            .logout(logout -> logout
                .logoutRequestMatcher(new AntPathRequestMatcher("/member/logout"))
                .logoutSuccessUrl("/")
                .invalidateHttpSession(true)
                .deleteCookies("JSESSIONID")
                .permitAll()
            )
            .sessionManagement(session -> session
                .maximumSessions(1)
                .maxSessionsPreventsLogin(false)
            );
        return http.build();
    }
}
````

## File: src/main/java/com/example/carelink/controller/HomeController.java
````java
package com.example.carelink.controller;
import com.example.carelink.service.BoardService;
import com.example.carelink.service.FacilityService;
import com.example.carelink.service.JobService;
import com.example.carelink.service.MemberService;
import com.example.carelink.service.ReviewService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
@Slf4j
@Controller
@RequiredArgsConstructor
public class HomeController {
    private final MemberService memberService;
    private final FacilityService facilityService;
    private final JobService jobService;
    private final ReviewService reviewService;
    private final BoardService boardService;
    @GetMapping("/")
    public String home(Model model) {
        model.addAttribute("pageTitle", "메인");
        try {
            int facilityCount = facilityService.getFacilityCount();
            int jobCount = jobService.getJobCount();
            int reviewCount = reviewService.getReviewCount();
            int memberCount = memberService.getMemberCount();
            int boardCount = boardService.getBoardCount();
            model.addAttribute("facilityCount", facilityCount);
            model.addAttribute("jobCount", jobCount);
            model.addAttribute("reviewCount", reviewCount);
            model.addAttribute("memberCount", memberCount);
            model.addAttribute("boardCount", boardCount);
            log.info("통계 데이터 - 시설: {}, 구인구직: {}, 리뷰: {}, 회원: {}, 게시글: {}",
                    facilityCount, jobCount, reviewCount, memberCount, boardCount);
        } catch (Exception e) {
            log.error("통계 데이터 조회 실패", e);
            model.addAttribute("facilityCount", 0);
            model.addAttribute("jobCount", 0);
            model.addAttribute("reviewCount", 0);
            model.addAttribute("memberCount", 0);
            model.addAttribute("boardCount", 0);
        }
        log.info("메인 페이지 접속");
        return "index";
    }
    @GetMapping("/about")
    public String about(Model model) {
        model.addAttribute("pageTitle", "소개");
        return "about";
    }
    @GetMapping("/error")
    public String error() {
        return "error";
    }
}
````

## File: src/main/java/com/example/carelink/dao/JobApplicationMapper.java
````java
package com.example.carelink.dao;
import com.example.carelink.dto.JobApplicationDTO;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
@Mapper
public interface JobApplicationMapper {
    int insertJobApplication(JobApplicationDTO jobApplication);
    int countByJobIdAndApplicantMemberId(@Param("jobId") Long jobId, @Param("applicantMemberId") Long applicantMemberId);
}
````

## File: src/main/java/com/example/carelink/dto/FacilityImageDTO.java
````java
package com.example.carelink.dto;
import lombok.Data;
import java.time.LocalDateTime;
@Data
public class FacilityImageDTO {
    private Long imageId;
    private Long facilityId;
    private String imagePath;
    private String imageAltText;
    private Integer imageOrder;
    private Boolean isMainImage;
    private LocalDateTime uploadDate;
    private LocalDateTime updatedAt;
}
````

## File: src/main/java/com/example/carelink/dto/JobApplicationDTO.java
````java
package com.example.carelink.dto;
import lombok.Data;
import lombok.NoArgsConstructor;
import lombok.AllArgsConstructor;
import java.time.LocalDateTime;
@Data
@NoArgsConstructor
@AllArgsConstructor
public class JobApplicationDTO {
    private Long id;
    private Long jobId;
    private Long applicantMemberId;
    private LocalDateTime applicationDate;
    private String status;
}
````

## File: src/main/java/com/example/carelink/validation/groups/OnFacilityJoin.java
````java
package com.example.carelink.validation.groups;
public interface OnFacilityJoin {
}
````

## File: src/main/resources/mapper/JobApplicationMapper.xml
````xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.JobApplicationMapper">
    <insert id="insertJobApplication" parameterType="com.example.carelink.dto.JobApplicationDTO"
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO job_application (
            job_id,
            applicant_member_id,
            application_date,
            status
        ) VALUES (
            #{jobId},
            #{applicantMemberId},
            #{applicationDate},
            #{status}
        )
    </insert>
    <select id="countByJobIdAndApplicantMemberId" resultType="int">
        SELECT COUNT(*)
        FROM job_application
        WHERE job_id = #{jobId} AND applicant_member_id = #{applicantMemberId}
    </select>
    </mapper>
````

## File: src/main/java/com/example/carelink/common/Constants.java
````java
package com.example.carelink.common;
public class Constants {
    public static final String SESSION_MEMBER = "loginMember";
    public static final int MAX_LOGIN_ATTEMPTS = 5;
    public static final String MEMBER_ROLE_USER = "USER";
    public static final String MEMBER_ROLE_FACILITY = "FACILITY";
    public static final String MEMBER_ROLE_ADMIN = "ADMIN";
    public static final int DEFAULT_PAGE_SIZE = 10;
    public static final int DEFAULT_PAGE_BLOCK = 5;
    public static final String UPLOAD_BASE_PATH = "C:/carelink-uploads/";
    public static final String FACILITY_UPLOAD_PATH = UPLOAD_BASE_PATH + "facility/";
    public static final String PROFILE_UPLOAD_PATH = UPLOAD_BASE_PATH + "profile/";
    public static final String TEMP_UPLOAD_PATH = UPLOAD_BASE_PATH + "temp/";
    public static final String TEST_IMAGES_PATH = "/test-images/";
    public static final long MAX_FILE_SIZE = 10 * 1024 * 1024;
    public static final int MAX_FACILITY_IMAGES = 5;
    public static final int MAX_PROFILE_IMAGES = 1;
    public static final String[] ALLOWED_IMAGE_EXTENSIONS = {"jpg", "jpeg", "png", "webp"};
    public static final String JOB_TYPE_RECRUIT = "RECRUIT";
    public static final String JOB_TYPE_SEARCH = "SEARCH";
    public static final String JOB_STATUS_ACTIVE = "ACTIVE";
    public static final String JOB_STATUS_CLOSED = "CLOSED";
    public static final String FACILITY_TYPE_NURSING_HOME = "NURSING_HOME";
    public static final String FACILITY_TYPE_HOSPITAL = "HOSPITAL";
    public static final String FACILITY_TYPE_DAY_CARE = "DAY_CARE";
    public static final String SUCCESS = "success";
    public static final String ERROR = "error";
    public static final String DUPLICATE_ID = "duplicate_id";
    public static final String LOGIN_REQUIRED = "login_required";
}
````

## File: src/main/java/com/example/carelink/controller/AdminController.java
````java
package com.example.carelink.controller;
import com.example.carelink.common.Constants;
import com.example.carelink.dto.FacilityDTO;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.service.FacilityService;
import com.example.carelink.service.MemberService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;
import javax.servlet.http.HttpSession;
import java.util.ArrayList;
import java.util.List;
@Controller
@RequestMapping("/admin")
@RequiredArgsConstructor
@Slf4j
public class AdminController {
    private final FacilityService facilityService;
    private final MemberService memberService;
    private boolean isAdmin(HttpSession session) {
        MemberDTO sessionMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        return sessionMember != null && "ADMIN".equals(sessionMember.getRole());
    }
    @GetMapping("")
    public String adminDashboard(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        if (!isAdmin(session)) {
            redirectAttributes.addFlashAttribute("errorMessage", "관리자 권한이 필요합니다.");
            return "redirect:/";
        }
        try {
            int pendingFacilities = facilityService.countPendingFacilities();
            int totalMembers = memberService.getTotalMemberCount();
            int facilityMembers = memberService.getFacilityMemberCount();
            int userMembers = totalMembers - facilityMembers;
            model.addAttribute("pendingFacilities", pendingFacilities);
            model.addAttribute("totalMembers", totalMembers);
            model.addAttribute("facilityMembers", facilityMembers);
            model.addAttribute("userMembers", userMembers);
            log.info("관리자 대시보드 접근 - 승인대기: {}, 전체회원: {}", pendingFacilities, totalMembers);
        } catch (Exception e) {
            log.error("관리자 대시보드 로딩 중 오류 발생", e);
            redirectAttributes.addFlashAttribute("errorMessage", "대시보드 정보를 불러오는 중 오류가 발생했습니다.");
        }
        return "admin/dashboard";
    }
    @GetMapping("/facilities")
    public String facilityManagement(@RequestParam(defaultValue = "PENDING") String status,
                                   HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        if (!isAdmin(session)) {
            redirectAttributes.addFlashAttribute("errorMessage", "관리자 권한이 필요합니다.");
            return "redirect:/";
        }
        try {
            log.info("시설 승인 관리 페이지 접근 시도 - 상태: {}", status);
            List<FacilityDTO> facilities = facilityService.getFacilitiesByApprovalStatus(status);
            log.info("시설 목록 조회 완료 - 상태: {}, 개수: {}", status, facilities != null ? facilities.size() : "null");
            if (facilities == null) {
                facilities = new ArrayList<>();
                log.warn("시설 목록이 null이어서 빈 리스트로 초기화했습니다.");
            }
            model.addAttribute("facilities", facilities);
            model.addAttribute("currentStatus", status);
        } catch (Exception e) {
            log.error("시설 목록 조회 중 오류 발생 - 상태: {}", status, e);
            model.addAttribute("facilities", new ArrayList<>());
            model.addAttribute("currentStatus", status);
            redirectAttributes.addFlashAttribute("errorMessage", "시설 목록을 불러오는 중 오류가 발생했습니다: " + e.getMessage());
        }
        return "admin/facilities";
    }
    @PostMapping("/facilities/{facilityId}/approve")
    @ResponseBody
    public String approveFacility(@PathVariable Long facilityId,
                                @RequestParam String action,
                                @RequestParam(required = false) String reason,
                                HttpSession session) {
        if (!isAdmin(session)) {
            return "UNAUTHORIZED";
        }
        try {
            String newStatus;
            if ("approve".equals(action)) {
                newStatus = "APPROVED";
                facilityService.updateFacilityApprovalStatus(facilityId, newStatus, null);
                log.info("시설 승인 완료 - ID: {}", facilityId);
            } else if ("reject".equals(action)) {
                newStatus = "REJECTED";
                facilityService.updateFacilityApprovalStatus(facilityId, newStatus, reason);
                log.info("시설 승인 거부 - ID: {}, 사유: {}", facilityId, reason);
            } else {
                return "INVALID_ACTION";
            }
            return "SUCCESS";
        } catch (Exception e) {
            log.error("시설 승인 처리 중 오류 발생 - ID: {}", facilityId, e);
            return "ERROR";
        }
    }
    @GetMapping("/members")
    public String memberManagement(@RequestParam(defaultValue = "ALL") String role,
                                 @RequestParam(defaultValue = "1") int page,
                                 HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        if (!isAdmin(session)) {
            redirectAttributes.addFlashAttribute("errorMessage", "관리자 권한이 필요합니다.");
            return "redirect:/";
        }
        try {
            List<MemberDTO> members = memberService.getMembersByRole(role, page, 20);
            int totalCount = memberService.getMemberCountByRole(role);
            int totalPages = (int) Math.ceil((double) totalCount / 20);
            model.addAttribute("members", members);
            model.addAttribute("currentRole", role);
            model.addAttribute("currentPage", page);
            model.addAttribute("totalPages", totalPages);
            model.addAttribute("totalCount", totalCount);
            log.info("회원 관리 페이지 접근 - 역할: {}, 페이지: {}, 총 개수: {}", role, page, totalCount);
        } catch (Exception e) {
            log.error("회원 목록 조회 중 오류 발생", e);
            redirectAttributes.addFlashAttribute("errorMessage", "회원 목록을 불러오는 중 오류가 발생했습니다.");
        }
        return "admin/members";
    }
    @PostMapping("/members/{memberId}/toggle-active")
    @ResponseBody
    public String toggleMemberActive(@PathVariable Long memberId, HttpSession session) {
        if (!isAdmin(session)) {
            return "UNAUTHORIZED";
        }
        try {
            boolean result = memberService.toggleMemberActive(memberId);
            log.info("회원 활성화 상태 변경 - ID: {}, 결과: {}", memberId, result);
            return result ? "SUCCESS" : "FAILED";
        } catch (Exception e) {
            log.error("회원 활성화 상태 변경 중 오류 발생 - ID: {}", memberId, e);
            return "ERROR";
        }
    }
    @GetMapping("/facilities/{facilityId}/detail")
    @ResponseBody
    public FacilityDTO getFacilityDetail(@PathVariable Long facilityId, HttpSession session) {
        if (!isAdmin(session)) {
            return null;
        }
        try {
            return facilityService.getFacilityById(facilityId);
        } catch (Exception e) {
            log.error("시설 상세 정보 조회 중 오류 발생 - ID: {}", facilityId, e);
            return null;
        }
    }
    @GetMapping("/statistics")
    public String statistics(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        if (!isAdmin(session)) {
            redirectAttributes.addFlashAttribute("errorMessage", "관리자 권한이 필요합니다.");
            return "redirect:/";
        }
        try {
            model.addAttribute("totalMembers", memberService.getTotalMemberCount());
            model.addAttribute("facilityMembers", memberService.getFacilityMemberCount());
            model.addAttribute("approvedFacilities", facilityService.countApprovedFacilities());
            model.addAttribute("pendingFacilities", facilityService.countPendingFacilities());
            model.addAttribute("rejectedFacilities", facilityService.countRejectedFacilities());
            log.info("관리자 통계 페이지 접근");
        } catch (Exception e) {
            log.error("통계 데이터 조회 중 오류 발생", e);
            redirectAttributes.addFlashAttribute("errorMessage", "통계 데이터를 불러오는 중 오류가 발생했습니다.");
        }
        return "admin/statistics";
    }
}
````

## File: src/main/java/com/example/carelink/dto/JobDTO.java
````java
package com.example.carelink.dto;
import com.example.carelink.common.BaseDTO;
import lombok.Data;
import lombok.EqualsAndHashCode;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;
import java.math.BigDecimal;
import java.time.LocalDate;
@Data
@EqualsAndHashCode(callSuper = true)
public class JobDTO extends BaseDTO {
    private Long jobId;
    @NotBlank(message = "제목은 필수입니다")
    private String title;
    @NotBlank(message = "내용은 필수입니다")
    private String content;
    @NotBlank(message = "구인구직 유형은 필수입니다")
    private String jobType;
    @NotBlank(message = "근무 형태는 필수입니다")
    private String workType;
    private String position;
    private Integer recruitCount;
    private String salaryType;
    private BigDecimal salaryMin;
    private BigDecimal salaryMax;
    private String salaryDescription;
    private String workLocation;
    private String workHours;
    private String experience;
    private String education;
    private String qualifications;
    private String benefits;
    private LocalDate startDate;
    private LocalDate endDate;
    private String contactName;
    private String contactPhone;
    private String contactEmail;
    @NotBlank(message = "게시글 상태는 필수입니다")
    private String status;
    private Integer viewCount;
    private Integer applyCount;
    @NotNull(message = "작성자 정보는 필수입니다")
    private Long memberId;
    private String memberName;
    private Long facilityId;
    private String facilityName;
    private String searchKeyword;
    private String searchJobType;
    private String searchWorkType;
    private String searchLocation;
    private String searchPosition;
    private String attachmentPath;
    private String attachmentName;
    private Integer priority;
    private boolean isHighlight;
}
````

## File: src/main/java/com/example/carelink/dto/ReviewDTO.java
````java
package com.example.carelink.dto;
import com.example.carelink.common.BaseDTO;
import lombok.Data;
import lombok.EqualsAndHashCode;
import javax.validation.constraints.Max;
import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;
@Data
@EqualsAndHashCode(callSuper = true)
public class ReviewDTO extends BaseDTO {
    private Long reviewId;
    @NotNull(message = "시설 정보는 필수입니다")
    private Long facilityId;
    private String facilityName;
    @NotNull(message = "작성자 정보는 필수입니다")
    private Long memberId;
    private String memberName;
    @NotBlank(message = "리뷰 제목은 필수입니다")
    private String title;
    @NotBlank(message = "리뷰 내용은 필수입니다")
    private String content;
    @NotNull(message = "평점은 필수입니다")
    @Min(value = 1, message = "평점은 1점 이상이어야 합니다")
    @Max(value = 5, message = "평점은 5점 이하여야 합니다")
    private Integer rating;
    private Integer serviceRating;
    private Integer facilityRating;
    private Integer staffRating;
    private Integer priceRating;
    private String reviewImage1;
    private String reviewImage2;
    private String reviewImage3;
    private String reviewImage1AltText;
    private String reviewImage2AltText;
    private String reviewImage3AltText;
    private Integer likeCount;
    private Integer dislikeCount;
    private Integer viewCount;
    private boolean isVisible;
    private String status;
    private Long parentReviewId;
    private Integer replyCount;
    private Integer replyDepth;
    private String searchKeyword;
    private Integer minRating;
    private Integer maxRating;
    private String sortBy;
    private Double facilityAverageRating;
    private Integer facilityReviewCount;
}
````

## File: src/main/java/com/example/carelink/CarelinkApplication.java
````java
package com.example.carelink;
import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
@SpringBootApplication
@MapperScan(basePackages = {"com.example.carelink.dao"})
public class CarelinkApplication {
    public static void main(String[] args) {
        SpringApplication.run(CarelinkApplication.class, args);
        System.out.println("========================================");
        System.out.println("    요양원 구인구직 사이트 시작됨!        ");
        System.out.println("    포트: http://localhost:8080         ");
        System.out.println("========================================");
    }
}
````

## File: src/main/resources/mapper/jobMapper.xml
````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.JobMapper">
    <resultMap id="jobResultMap" type="com.example.carelink.dto.JobDTO">
        <id property="jobId" column="job_id"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="jobType" column="job_type"/>
        <result property="workType" column="work_type"/>
        <result property="position" column="position"/>
        <result property="recruitCount" column="recruit_count"/>
        <result property="salaryType" column="salary_type"/>
        <result property="salaryMin" column="salary_min"/>
        <result property="salaryMax" column="salary_max"/>
        <result property="salaryDescription" column="salary_description"/>
        <result property="workLocation" column="work_location"/>
        <result property="workHours" column="work_hours"/>
        <result property="experience" column="experience"/>
        <result property="education" column="education"/>
        <result property="qualifications" column="qualifications"/>
        <result property="benefits" column="benefits"/>
        <result property="startDate" column="start_date"/>
        <result property="endDate" column="end_date"/>
        <result property="contactName" column="contact_name"/>
        <result property="contactPhone" column="contact_phone"/>
        <result property="contactEmail" column="contact_email"/>
        <result property="status" column="status"/>
        <result property="viewCount" column="view_count"/>
        <result property="applyCount" column="apply_count"/>
        <result property="memberId" column="member_id"/>
        <result property="memberName" column="member_name"/>
        <result property="facilityId" column="facility_id"/>
        <result property="facilityName" column="facility_name"/>
        <result property="attachmentPath" column="attachment_path"/>
        <result property="attachmentName" column="attachment_name"/>
        <result property="priority" column="priority"/>
        <result property="isHighlight" column="is_highlight"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="isDeleted" column="is_deleted"/>
    </resultMap>
    <select id="findJobsWithSearch" parameterType="com.example.carelink.dto.JobDTO" resultMap="jobResultMap">
        SELECT
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.is_deleted = false
        <if test="searchKeyword != null and searchKeyword != ''">
            AND (j.title LIKE CONCAT('%', #{searchKeyword}, '%')
                 OR j.content LIKE CONCAT('%', #{searchKeyword}, '%')
                 OR j.position LIKE CONCAT('%', #{searchKeyword}, '%'))
        </if>
        <if test="searchJobType != null and searchJobType != ''">
            AND j.job_type = #{searchJobType}
        </if>
        <if test="searchWorkType != null and searchWorkType != ''">
            AND j.work_type = #{searchWorkType}
        </if>
        <if test="searchLocation != null and searchLocation != ''">
            AND j.work_location LIKE CONCAT('%', #{searchLocation}, '%')
        </if>
        <if test="searchPosition != null and searchPosition != ''">
            AND j.position LIKE CONCAT('%', #{searchPosition}, '%')
        </if>
        ORDER BY j.priority DESC, j.created_at DESC
        <if test="size != null and size > 0">
            LIMIT #{size}
        </if>
        <if test="offset != null and offset >= 0">
            OFFSET #{offset}
        </if>
    </select>
    <select id="countJobsWithSearch" parameterType="com.example.carelink.dto.JobDTO" resultType="int">
        SELECT COUNT(*)
        FROM job_posting j
        WHERE j.is_deleted = false
        <if test="searchKeyword != null and searchKeyword != ''">
            AND (j.title LIKE CONCAT('%', #{searchKeyword}, '%')
                 OR j.content LIKE CONCAT('%', #{searchKeyword}, '%')
                 OR j.position LIKE CONCAT('%', #{searchKeyword}, '%'))
        </if>
        <if test="searchJobType != null and searchJobType != ''">
            AND j.job_type = #{searchJobType}
        </if>
        <if test="searchWorkType != null and searchWorkType != ''">
            AND j.work_type = #{searchWorkType}
        </if>
        <if test="searchLocation != null and searchLocation != ''">
            AND j.work_location LIKE CONCAT('%', #{searchLocation}, '%')
        </if>
        <if test="searchPosition != null and searchPosition != ''">
            AND j.position LIKE CONCAT('%', #{searchPosition}, '%')
        </if>
    </select>
    <select id="findJobById" parameterType="long" resultMap="jobResultMap">
        SELECT
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.job_id = #{jobId} AND j.is_deleted = false
    </select>
    <insert id="insertJob" parameterType="com.example.carelink.dto.JobDTO" useGeneratedKeys="true" keyProperty="jobId">
        INSERT INTO job_posting (
            title, content, job_type, work_type, position, recruit_count,
            salary_type, salary_min, salary_max, salary_description,
            work_location, work_hours, experience, education, qualifications, benefits,
            start_date, end_date, contact_name, contact_phone, contact_email,
            status, member_id, facility_id, attachment_path, attachment_name,
            priority, is_highlight, created_at
        ) VALUES (
            #{title}, #{content}, #{jobType}, #{workType}, #{position}, #{recruitCount},
            #{salaryType}, #{salaryMin}, #{salaryMax}, #{salaryDescription},
            #{workLocation}, #{workHours}, #{experience}, #{education}, #{qualifications}, #{benefits},
            #{startDate}, #{endDate}, #{contactName}, #{contactPhone}, #{contactEmail},
            #{status}, #{memberId}, #{facilityId}, #{attachmentPath}, #{attachmentName},
            #{priority}, #{isHighlight}, NOW()
        )
    </insert>
    <update id="updateJob" parameterType="com.example.carelink.dto.JobDTO">
        UPDATE job_posting SET
            title = #{title},
            content = #{content},
            job_type = #{jobType},
            work_type = #{workType},
            position = #{position},
            recruit_count = #{recruitCount},
            salary_type = #{salaryType},
            salary_min = #{salaryMin},
            salary_max = #{salaryMax},
            salary_description = #{salaryDescription},
            work_location = #{workLocation},
            work_hours = #{workHours},
            experience = #{experience},
            education = #{education},
            qualifications = #{qualifications},
            benefits = #{benefits},
            start_date = #{startDate},
            end_date = #{endDate},
            contact_name = #{contactName},
            contact_phone = #{contactPhone},
            contact_email = #{contactEmail},
            status = #{status},
            facility_id = #{facilityId},
            attachment_path = #{attachmentPath},
            attachment_name = #{attachmentName},
            priority = #{priority},
            is_highlight = #{isHighlight},
            updated_at = NOW()
        WHERE job_id = #{jobId}
    </update>
    <update id="deleteJob" parameterType="long">
        UPDATE job_posting SET
            is_deleted = true,
            updated_at = NOW()
        WHERE job_id = #{jobId}
    </update>
    <update id="incrementViewCount" parameterType="long">
        UPDATE job_posting SET
            view_count = view_count + 1,
            updated_at = NOW()
        WHERE job_id = #{jobId}
    </update>
    <update id="incrementApplyCount" parameterType="long">
        UPDATE job_posting SET
            apply_count = apply_count + 1,
            updated_at = NOW()
        WHERE job_id = #{jobId}
    </update>
    <select id="findJobsByMemberId" parameterType="long" resultMap="jobResultMap">
        SELECT
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.member_id = #{memberId} AND j.is_deleted = false
        ORDER BY j.created_at DESC
    </select>
    <select id="findJobsByFacilityId" parameterType="long" resultMap="jobResultMap">
        SELECT
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.facility_id = #{facilityId} AND j.is_deleted = false
        ORDER BY j.created_at DESC
    </select>
    <select id="getJobList" parameterType="com.example.carelink.dto.JobDTO" resultMap="jobResultMap">
        SELECT
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.is_deleted = false
        ORDER BY j.priority DESC, j.created_at DESC
        <if test="size != null and size > 0">
            LIMIT #{size}
        </if>
        <if test="page != null and page >= 0">
            OFFSET #{page}
        </if>
    </select>
    <select id="getJobById" parameterType="long" resultMap="jobResultMap">
        SELECT
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.job_id = #{jobId} AND j.is_deleted = false
    </select>
    <select id="getPopularJobs" resultMap="jobResultMap">
        SELECT
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.is_deleted = false AND j.status = 'ACTIVE'
        ORDER BY j.view_count DESC, j.apply_count DESC
        LIMIT 10
    </select>
    <select id="getJobCount" resultType="int">
        SELECT COUNT(*)
        FROM job_posting
        WHERE is_deleted = false AND status = 'ACTIVE'
    </select>
    <delete id="deleteByMemberId" parameterType="long">
        DELETE FROM job_posting WHERE member_id = #{memberId}
    </delete>
    <delete id="deleteByFacilityMemberId" parameterType="long">
        DELETE FROM job_posting
        WHERE facility_id IN (
            SELECT facility_id FROM facility WHERE registered_member_id = #{memberId}
        )
    </delete>
</mapper>
````

## File: CLAUDE.md
````markdown
# CLAUDE.md

이 문서는 이 저장소에서 Claude Code (claude.ai/code)가 코드를 다룰 때 참고할 가이드입니다.

---

## 📌 프로젝트 개요

이 프로젝트는 한국 팀원 4명이 개발하는 \*\*요양원 구인구직 웹사이트 "라이트케어(LightCare)"\*\*입니다. 이 플랫폼은 요양 시설과 요양업계 구직자를 연결해주는 서비스입니다.

---

## 🛠 기술 스택

* **백엔드**: Spring Boot 2.7.18, MyBatis, MySQL
* **프론트엔드**: Thymeleaf 템플릿, Bootstrap 5, JavaScript
* **빌드 도구**: Gradle (Java 11 사용)
* **데이터베이스**: MySQL (문자 인코딩 utf8mb4)

---

## ⚙️ 공통 개발 명령어

### 빌드 및 실행

```bash
# 프로젝트 빌드
./gradlew build

# 애플리케이션 실행
./gradlew bootRun

# 빌드 결과물 정리
./gradlew clean

# 테스트 실행
./gradlew test

# 코드 품질 검사
./gradlew check
```

### 데이터베이스 설정

```bash
# MySQL 접속 및 DB 생성
mysql -u root -p
CREATE DATABASE carelink CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 스키마 초기화
# src/main/resources/schema.sql 파일을 MySQL에서 실행
```

### 개발 서버 정보

* 실행 주소: `http://localhost:8080`
* DB 연결 주소: `jdbc:mysql://localhost:3306/carelink`
* DevTools를 통한 핫 리로드(Hot Reload) 적용됨

---

## 🧱 아키텍처 개요

### 팀 구조 (4인 협업)

기능 중심의 분업 구조로 운영됩니다:

* **팀원 A**: 회원 관리 (로그인, 회원가입, 내 정보)
* **팀원 B**: 시설 검색 및 지도 연동 (카카오맵)
* **팀원 C**: 구인구직 게시판 (공고 작성, 지원)
* **팀원 D**: 리뷰 시스템 및 정보 게시판

### 패키지 구조

```
com.example.carelink/
├── controller/          # 컨트롤러 계층
├── service/            # 서비스 계층 (비즈니스 로직)
├── dao/               # DAO 계층 (MyBatis 매퍼)
├── dto/               # DTO 객체
└── common/            # 공통 유틸 및 상수
```

### 데이터베이스 설계

관계형 테이블 기반으로 외래키(FK)를 적절히 사용:

* **member**: 사용자 계정 및 인증 정보
* **facility**: 요양시설 정보 (위치 좌표 포함)
* **job\_posting**: 구인공고 정보
* **review**: 시설 리뷰 및 평점
* **board**: 커뮤니티/정보 게시판

### MyBatis 구성

* 설정 파일: `src/main/resources/mybatis-config.xml`
* 매퍼 XML: `src/main/resources/mapper/*.xml`
* camelCase → underscore 자동 매핑 설정
* DTO용 typeAlias 사용

---

## 🎨 프론트엔드 구조

* **Thymeleaf**: Spring Boot 연동 서버사이드 템플릿
* **레이아웃 시스템**: `templates/layout/` 폴더에 header/footer 분리
* **정적 리소스**: `src/main/resources/static/` 폴더에 CSS/JS 저장
* **Bootstrap 5**: 반응형 UI 프레임워크 적용

---

## 🧾 주요 설정 파일

### application.yml

* 서버 포트: 8080
* 데이터베이스 연결 정보
* 개발 시 Thymeleaf 캐시 비활성화
* 파일 업로드 최대 용량 10MB
* MyBatis 매퍼 위치 지정

### 기타 설정 사항

* UTF-8 한글 지원 활성화
* MyBatis 및 Spring Web 로그 출력 설정
* DB 타임존: Asia/Seoul

---

## 🔄 개발 패턴

### 컨트롤러 패턴

Spring MVC 구조를 따름:

* `@Controller` 사용
* Model로 View 데이터 전달
* HTTP Method (@GetMapping, @PostMapping 등) 명확히 구분
* `@Slf4j`로 로깅

### 서비스 계층

컨트롤러와 로직 분리:

* 트랜잭션 처리
* 입력 검증
* 횡단 관심사 관리

### MyBatis 매퍼

XML 기반 SQL 정의:

* `#{}` 사용한 파라미터 바인딩
* DTO 매핑 설정
* JOIN 활용한 복합 조회 처리

---

## ✅ 테스트

### 테스트 구조

* 단위 테스트: JUnit 5
* 통합 테스트: Spring Boot Test
* 테스트 설정은 운영과 별도 구성

### 테스트 명령어

```bash
# 전체 테스트 실행
./gradlew test

# 특정 클래스만 실행
./gradlew test --tests "ClassName"
```

---

## 🤝 팀 협업 규칙

### Git 워크플로우

* 기능 브랜치 명: `feature/member-기능명`
* 커밋 메시지: `[feat] 기능 설명`
* PR을 통한 코드 리뷰 진행

### 코드 컨벤션

* 클래스명: PascalCase
* 메서드명: camelCase
* 상수명: UPPER\_SNAKE\_CASE
* 패키지명: 모두 소문자

---

## ⚠️ 특이 사항

### 한글 지원

* 모든 텍스트 콘텐츠는 한글로 작성
* UTF-8 인코딩 유지
* 주석/문서도 한글 기반

### 지도 연동

* 카카오맵 API 연동 예정
* 위도/경도 기반 시설 검색 기능 포함

### 사용자 역할

* `USER`: 일반 구직자
* `FACILITY`: 요양시설 관리자
* `ADMIN`: 시스템 관리자

---

## 🌐 환경 변수

환경 설정 시 아래 항목 필요:

* `spring.datasource.password`: MySQL 비밀번호
* DB 주소가 다를 경우 `spring.datasource.url` 수정
* 추후 지도 API 키 등록 필요 (예정)

### 🟢 팀원 D (리뷰/게시판) - 진행률: 100%

#### ✅ **완료된 작업**
**백엔드 완전 구현**:
- ✅ `ReviewService.java` (238줄) - **완전 구현**
  - 리뷰 CRUD 로직
  - 트랜잭션 처리
  - 로깅 추가
  - 유효성 검증
  - 평점 시스템
  - 추천/비추천 기능

- ✅ `BoardService.java` (253줄) - **완전 구현**
  - 게시글 CRUD 로직
  - 페이징 처리
  - 검색 및 카테고리 필터링
  - 인기 게시글 기능
  - 조회수 증가 로직

- ✅ `ReviewMapper.java` & `reviewMapper.xml` - **완전 구현**
  - 모든 필요 메서드 정의
  - XML 쿼리 매핑 완료

- ✅ `BoardMapper.java` & `boardMapper.xml` - **완전 구현**
  - 모든 필요 메서드 정의
  - XML 쿼리 매핑 완료

**프론트엔드 완성**:
- ✅ `templates/review/list.html` (108줄) - **완전 구현**
- ✅ `templates/review/write.html` (122줄) - **완전 구현**
- ✅ `templates/board/list.html` - **완전 구현**
- ✅ `templates/board/write.html` - **완전 구현**
- ✅ `templates/board/detail.html` - **완전 구현**

#### 📊 **실제 Story Point 달성률**
- **완료**: LC-010 (리뷰 작성) - 13/13 SP ✅
- **완료**: LC-011 (리뷰 목록 관리) - 13/13 SP ✅
- **완료**: LC-012 (정보 게시판) - 13/13 SP ✅

**총 달성**: 39/39 SP (100%)

#### 🚀 **다음 단계**
1. **단위 테스트 작성**
   - ReviewService 테스트
   - BoardService 테스트
   - 통합 테스트

2. **성능 최적화**
   - 쿼리 최적화
   - 캐싱 적용
   - N+1 문제 해결

3. **추가 기능 개발**
   - 댓글 시스템 고도화
   - 파일 첨부 기능
   - 에디터 기능 강화
````

## File: README.md
````markdown
# LightCare (라이트케어) - 요양원 구인구직 플랫폼

![Spring Boot](https://img.shields.io/badge/Spring%20Boot-2.7.18-brightgreen.svg)
![Java](https://img.shields.io/badge/Java-11-orange.svg)
![MySQL](https://img.shields.io/badge/MySQL-8.0-blue.svg)
![MyBatis](https://img.shields.io/badge/MyBatis-2.3.1-red.svg)
![Build Status](https://img.shields.io/badge/Build-Passing-success.svg)

## 📖 프로젝트 개요

LightCare는 한국의 요양원 및 노인요양시설과 구직자를 연결하는 전문 구인구직 플랫폼입니다. 고령화 사회에 필요한 요양 서비스 인력을 효율적으로 매칭하고, 시설과 근로자 모두에게 최적화된 환경을 제공합니다.

### 🎯 주요 기능

- **👥 회원 관리**: 구직자 및 시설 관리자 회원가입/로그인
- **🏥 시설 검색**: 카카오맵 연동 시설 위치 검색 및 상세 정보
- **💼 구인구직**: 채용공고 등록/검색, 지원 시스템
- **⭐ 리뷰 시스템**: 시설 평가 및 후기 공유
- **📋 정보 게시판**: 업계 정보 및 공지사항

## 🛠 기술 스택

### Backend
- **Framework**: Spring Boot 2.7.18
- **Language**: Java 11
- **Database**: MySQL 8.0
- **ORM**: MyBatis 2.3.1
- **Build Tool**: Gradle
- **Template Engine**: Thymeleaf

### Frontend
- **Template**: Thymeleaf
- **Styling**: Bootstrap 5, CSS3
- **JavaScript**: Vanilla JS
- **Maps**: Kakao Maps API

### Development Tools
- **IDE**: IntelliJ IDEA
- **Version Control**: Git/GitHub
- **Database Tool**: MySQL Workbench

## 🚀 빠른 시작

### 사전 요구사항

- Java 11 이상
- MySQL 8.0 이상
- Git

### 설치 및 실행

1. **레포지토리 클론**
   ```bash
   git clone https://github.com/dooseob/lightcare.git
   cd lightcare
   ```

2. **데이터베이스 설정**
   ```sql
   CREATE DATABASE carelink CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

3. **데이터베이스 연결 설정** (`src/main/resources/application.yml`)
   ```yaml
   spring:
     datasource:
       url: jdbc:mysql://localhost:3306/carelink
       username: root
       password: mysql
   ```

4. **스키마 초기화**
   ```bash
   # MySQL에서 schema.sql 실행
   mysql -u root -p carelink < src/main/resources/schema.sql
   ```

5. **애플리케이션 실행**
   ```bash
   ./gradlew bootRun
   ```

6. **브라우저에서 접속**
   ```
   http://localhost:8080
   ```

## 📁 프로젝트 구조

```
src/
├── main/
│   ├── java/com/example/carelink/
│   │   ├── controller/          # 웹 요청 처리
│   │   │   ├── HomeController.java
│   │   │   ├── MemberController.java
│   │   │   ├── FacilityController.java
│   │   │   ├── JobController.java
│   │   │   ├── ReviewController.java
│   │   │   └── BoardController.java
│   │   ├── service/             # 비즈니스 로직
│   │   │   ├── MemberService.java
│   │   │   ├── FacilityService.java
│   │   │   ├── JobService.java
│   │   │   ├── ReviewService.java
│   │   │   └── BoardService.java
│   │   ├── dao/                 # 데이터 접근 계층
│   │   │   ├── MemberMapper.java
│   │   │   ├── FacilityMapper.java
│   │   │   ├── JobMapper.java
│   │   │   ├── ReviewMapper.java
│   │   │   └── BoardMapper.java
│   │   ├── dto/                 # 데이터 전송 객체
│   │   │   ├── MemberDTO.java
│   │   │   ├── FacilityDTO.java
│   │   │   ├── JobDTO.java
│   │   │   ├── ReviewDTO.java
│   │   │   └── BoardDTO.java
│   │   └── common/              # 공통 유틸리티
│   │       ├── BaseDTO.java
│   │       ├── PageInfo.java
│   │       └── Constants.java
│   └── resources/
│       ├── static/              # 정적 리소스
│       │   ├── css/
│       │   └── js/
│       ├── templates/           # Thymeleaf 템플릿
│       │   ├── layout/
│       │   ├── member/
│       │   ├── facility/
│       │   ├── job/
│       │   ├── review/
│       │   └── board/
│       ├── mapper/              # MyBatis SQL 매퍼
│       │   ├── memberMapper.xml
│       │   ├── facilityMapper.xml
│       │   ├── jobMapper.xml
│       │   ├── reviewMapper.xml
│       │   └── boardMapper.xml
│       ├── application.yml      # 애플리케이션 설정
│       ├── mybatis-config.xml   # MyBatis 설정
│       └── schema.sql          # 데이터베이스 스키마
```

## 👥 팀 구성 및 역할

| 팀원 | 담당 기능 | 주요 구현 사항 |
|------|----------|---------------|
| **팀원 A** | 회원 관리 | 로그인, 회원가입, 프로필 관리, 세션 관리 |
| **팀원 B** | 시설 검색 | 카카오맵 연동, 시설 정보 관리, 위치 기반 검색 |
| **팀원 C** | 구인구직 | 채용공고 게시판, 지원 시스템, 채용 관리 |
| **팀원 D** | 리뷰 & 게시판 | 시설 리뷰, 평점 시스템, 정보 게시판 |

## 🗄 데이터베이스 설계

### 주요 테이블

- **member**: 회원 정보 (구직자, 시설 관리자)
- **facility**: 요양시설 정보 및 위치 데이터
- **job_posting**: 채용공고 정보
- **review**: 시설 리뷰 및 평점
- **board**: 정보 게시판

### ERD
```sql
-- 주요 테이블 관계
-- member (1) ←→ (N) job_posting
-- member (1) ←→ (N) review
-- facility (1) ←→ (N) job_posting
-- facility (1) ←→ (N) review
```

## 🔧 개발 가이드

### 코딩 컨벤션

- **클래스명**: PascalCase (`MemberController`)
- **메서드명**: camelCase (`getMemberInfo`)
- **상수**: UPPER_SNAKE_CASE (`DEFAULT_PAGE_SIZE`)
- **패키지명**: 소문자 (`com.example.carelink`)

### Git 브랜치 전략

```
main                 # 메인 브랜치
├── feature/member   # 팀원 A - 회원 관리
├── feature/facility # 팀원 B - 시설 검색
├── feature/job      # 팀원 C - 구인구직
└── feature/review   # 팀원 D - 리뷰 시스템
```

### 커밋 메시지 형식

```
[feat] 새로운 기능 추가
[fix] 버그 수정
[docs] 문서 수정
[style] 코드 스타일 수정
[refactor] 코드 리팩토링
[test] 테스트 코드 추가
```

## 🧪 테스트

```bash
# 전체 테스트 실행
./gradlew test

# 빌드 및 테스트
./gradlew build

# 코드 품질 검사
./gradlew check
```

## 📝 API 문서

### 주요 엔드포인트

| Method | URL | 설명 |
|--------|-----|------|
| GET | `/` | 메인 페이지 |
| GET/POST | `/member/login` | 로그인 |
| GET/POST | `/member/join` | 회원가입 |
| GET | `/facility/search` | 시설 검색 |
| GET | `/job/list` | 채용공고 목록 |
| GET | `/review/list` | 리뷰 목록 |
| GET | `/board/list` | 게시판 목록 |

## 🐛 트러블슈팅

### 자주 발생하는 문제

1. **데이터베이스 연결 오류**
   ```
   해결: application.yml의 데이터베이스 설정 확인
   ```

2. **MyBatis 매퍼 오류**
   ```
   해결: mapper XML의 namespace와 인터페이스 경로 일치 확인
   ```

3. **Thymeleaf 템플릿 오류**
   ```
   해결: templates 폴더 경로와 컨트롤러 반환값 일치 확인
   ```

## 🔄 최근 업데이트

### v1.0.0 (2025-06-22)
- ✅ 프로젝트 기본 구조 완성
- ✅ 전체 파일 에러 디버깅 완료
- ✅ 페이징 로직 오류 수정
- ✅ Gradle 빌드 설정 개선
- ✅ 코드 품질 개선 (NPE 방지, 중복 코드 제거)

## 🚀 향후 개발 계획

- [ ] **v1.1**: 보안 강화 (비밀번호 암호화, CSRF 보호)
- [ ] **v1.2**: 카카오맵 API 연동 완성
- [ ] **v1.3**: 실시간 알림 시스템
- [ ] **v1.4**: 모바일 반응형 UI 개선
- [ ] **v2.0**: AI 기반 매칭 시스템

## 🤝 기여 방법

1. Fork 프로젝트
2. Feature 브랜치 생성 (`git checkout -b feature/새기능`)
3. 변경사항 커밋 (`git commit -m '[feat] 새기능 추가'`)
4. 브랜치에 Push (`git push origin feature/새기능`)
5. Pull Request 생성

## 📞 지원

- **팀 이메일**: lightcare-team@gmail.com
- **이슈 트래킹**: [GitHub Issues](https://github.com/dooseob/lightcare/issues)
- **위키**: [프로젝트 위키](https://github.com/dooseob/lightcare/wiki)

## 📄 라이센스

이 프로젝트는 MIT 라이센스 하에 있습니다. 자세한 내용은 [LICENSE](LICENSE) 파일을 참조하세요.

---

**LightCare 팀** - 요양 서비스의 미래를 밝히는 플랫폼 💡

### 🟢 팀원 D (리뷰/게시판) - 진행률: 100%

#### ✅ **완료된 작업**
**백엔드 완전 구현**:
- ✅ `ReviewService.java` (238줄) - **완전 구현**
  - 리뷰 CRUD 로직
  - 트랜잭션 처리
  - 로깅 추가
  - 유효성 검증
  - 평점 시스템
  - 추천/비추천 기능

- ✅ `BoardService.java` (253줄) - **완전 구현**
  - 게시글 CRUD 로직
  - 페이징 처리
  - 검색 및 카테고리 필터링
  - 인기 게시글 기능
  - 조회수 증가 로직

- ✅ `ReviewMapper.java` & `reviewMapper.xml` - **완전 구현**
  - 모든 필요 메서드 정의
  - XML 쿼리 매핑 완료

- ✅ `BoardMapper.java` & `boardMapper.xml` - **완전 구현**
  - 모든 필요 메서드 정의
  - XML 쿼리 매핑 완료

**프론트엔드 완성**:
- ✅ `templates/review/list.html` (108줄) - **완전 구현**
- ✅ `templates/review/write.html` (122줄) - **완전 구현**
- ✅ `templates/board/list.html` - **완전 구현**
- ✅ `templates/board/write.html` - **완전 구현**
- ✅ `templates/board/detail.html` - **완전 구현**

#### 📊 **실제 Story Point 달성률**
- **완료**: LC-010 (리뷰 작성) - 13/13 SP ✅
- **완료**: LC-011 (리뷰 목록 관리) - 13/13 SP ✅
- **완료**: LC-012 (정보 게시판) - 13/13 SP ✅

**총 달성**: 39/39 SP (100%)

#### 🚀 **다음 단계**
1. **단위 테스트 작성**
   - ReviewService 테스트
   - BoardService 테스트
   - 통합 테스트

2. **성능 최적화**
   - 쿼리 최적화
   - 캐싱 적용
   - N+1 문제 해결

3. **추가 기능 개발**
   - 댓글 시스템 고도화
   - 파일 첨부 기능
   - 에디터 기능 강화
````

## File: src/main/java/com/example/carelink/config/SecurityConfig.java
````java
package com.example.carelink.config;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.firewall.HttpFirewall;
import org.springframework.security.web.firewall.StrictHttpFirewall;
import org.springframework.security.web.util.matcher.AntPathRequestMatcher;
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
    @Bean
    public HttpFirewall httpFirewall() {
        StrictHttpFirewall firewall = new StrictHttpFirewall();
        firewall.setAllowUrlEncodedDoubleSlash(true);
        return firewall;
    }
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .csrf(csrf -> csrf.disable())
                .authorizeHttpRequests(authorize -> authorize
                        .requestMatchers(
                                new AntPathRequestMatcher("/css/**"),
                                new AntPathRequestMatcher("/js/**"),
                                new AntPathRequestMatcher("/images/**"),
                                new AntPathRequestMatcher("/favicon.ico")
                        ).permitAll()
                        .requestMatchers(
                                new AntPathRequestMatcher("/"),
                                new AntPathRequestMatcher("/member/login"),
                                new AntPathRequestMatcher("/member/join"),
                                new AntPathRequestMatcher("/member/checkUserId"),
                                new AntPathRequestMatcher("/facility/**"),
                                new AntPathRequestMatcher("/board/**"),
                                new AntPathRequestMatcher("/review/**"),
                                new AntPathRequestMatcher("/job/**"),
                                new AntPathRequestMatcher("/api/**"),
                                new AntPathRequestMatcher("/error")
                        ).permitAll()
                        .anyRequest().permitAll()
                )
                .formLogin(formLogin -> formLogin.disable())
                .logout(logout -> logout
                        .logoutRequestMatcher(new AntPathRequestMatcher("/member/logout"))
                        .logoutSuccessUrl("/")
                        .invalidateHttpSession(true)
                        .deleteCookies("JSESSIONID")
                        .permitAll()
                );
        return http.build();
    }
}
````

## File: src/main/java/com/example/carelink/config/WebConfig.java
````java
package com.example.carelink.config;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
@Configuration
public class WebConfig implements WebMvcConfigurer {
    @Value("${file.upload-dir.facility}")
    private String facilityUploadDir;
    @Value("${file.upload-dir.profile}")
    private String profileUploadDir;
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/uploads/facility/**")
                .addResourceLocations("file:" + facilityUploadDir);
        registry.addResourceHandler("/uploads/profile/**")
                .addResourceLocations("file:" + profileUploadDir);
        String projectRoot = System.getProperty("user.dir");
        registry.addResourceHandler("/test-images/facilities/**")
                .addResourceLocations("file:" + projectRoot + "/images/facilities/");
        registry.addResourceHandler("/test-images/profiles/**")
                .addResourceLocations("file:" + projectRoot + "/images/profiles/");
    }
}
````

## File: src/main/java/com/example/carelink/controller/FacilityImageApiController.java
````java
package com.example.carelink.controller;
import com.example.carelink.dto.FacilityImageDTO;
import com.example.carelink.dto.FacilityDTO;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.service.FacilityImageService;
import com.example.carelink.service.FacilityService;
import com.example.carelink.common.Constants;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;
import javax.servlet.http.HttpSession;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
@RestController
@RequestMapping("/facility/facility-images")
@RequiredArgsConstructor
@Slf4j
public class FacilityImageApiController {
    private final FacilityImageService facilityImageService;
    private final FacilityService facilityService;
    @PostMapping("/reorder/{facilityId}")
    public ResponseEntity<Map<String, Object>> reorderImages(
            @PathVariable Long facilityId,
            @RequestBody List<Long> imageIds) {
        Map<String, Object> response = new HashMap<>();
        try {
            log.info("🔄 시설 이미지 순서 재정렬 API 요청 - facilityId: {}, imageIds: {}", facilityId, imageIds);
            boolean success = facilityImageService.updateImageOrdersBatch(facilityId, imageIds);
            if (success) {
                response.put("success", true);
                response.put("message", "이미지 순서가 성공적으로 업데이트되었습니다.");
                List<FacilityImageDTO> updatedImages = facilityImageService.getImagesByFacilityId(facilityId);
                response.put("images", updatedImages);
                log.info("✅ 시설 이미지 순서 재정렬 API 성공 - facilityId: {}", facilityId);
                return ResponseEntity.ok(response);
            } else {
                response.put("success", false);
                response.put("message", "이미지 순서 업데이트에 실패했습니다.");
                log.warn("⚠️ 시설 이미지 순서 재정렬 API 실패 - facilityId: {}", facilityId);
                return ResponseEntity.badRequest().body(response);
            }
        } catch (Exception e) {
            log.error("❌ 시설 이미지 순서 재정렬 API 오류 - facilityId: {}", facilityId, e);
            response.put("success", false);
            response.put("message", "서버 오류가 발생했습니다: " + e.getMessage());
            return ResponseEntity.internalServerError().body(response);
        }
    }
    @PostMapping("/auto-reorder/{facilityId}")
    public ResponseEntity<Map<String, Object>> autoReorderImages(@PathVariable Long facilityId) {
        Map<String, Object> response = new HashMap<>();
        try {
            log.info("🔄 시설 이미지 자동 순서 재정렬 API 요청 - facilityId: {}", facilityId);
            boolean success = facilityImageService.reorderAllFacilityImages(facilityId);
            if (success) {
                response.put("success", true);
                response.put("message", "이미지 순서가 자동으로 재정렬되었습니다.");
                List<FacilityImageDTO> reorderedImages = facilityImageService.getImagesByFacilityId(facilityId);
                response.put("images", reorderedImages);
                response.put("imageCount", reorderedImages.size());
                log.info("✅ 시설 이미지 자동 순서 재정렬 API 성공 - facilityId: {}, 총 {}장", facilityId, reorderedImages.size());
                return ResponseEntity.ok(response);
            } else {
                response.put("success", false);
                response.put("message", "이미지 순서 재정렬에 실패했습니다.");
                log.warn("⚠️ 시설 이미지 자동 순서 재정렬 API 실패 - facilityId: {}", facilityId);
                return ResponseEntity.badRequest().body(response);
            }
        } catch (Exception e) {
            log.error("❌ 시설 이미지 자동 순서 재정렬 API 오류 - facilityId: {}", facilityId, e);
            response.put("success", false);
            response.put("message", "서버 오류가 발생했습니다: " + e.getMessage());
            return ResponseEntity.internalServerError().body(response);
        }
    }
    @GetMapping("/{facilityId}")
    public ResponseEntity<Map<String, Object>> getFacilityImages(@PathVariable Long facilityId, HttpSession session) {
        Map<String, Object> response = new HashMap<>();
        try {
            log.info("📋 시설 이미지 목록 조회 API 요청 - facilityId: {}", facilityId);
            MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (member == null) {
                response.put("success", false);
                response.put("message", "로그인이 필요합니다.");
                return ResponseEntity.status(401).body(response);
            }
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                response.put("success", false);
                response.put("message", "시설을 찾을 수 없습니다.");
                return ResponseEntity.badRequest().body(response);
            }
            if (!facility.getRegisteredMemberId().equals(member.getMemberId())
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                response.put("success", false);
                response.put("message", "해당 시설 이미지를 조회할 권한이 없습니다.");
                return ResponseEntity.status(403).body(response);
            }
            List<FacilityImageDTO> images = facilityImageService.getImagesByFacilityId(facilityId);
            FacilityImageDTO mainImage = facilityImageService.getMainImageByFacilityId(facilityId);
            response.put("success", true);
            response.put("images", images);
            response.put("mainImage", mainImage);
            response.put("imageCount", images.size());
            response.put("maxImages", 5);
            log.info("✅ 시설 이미지 목록 조회 API 성공 - facilityId: {}, 총 {}장, memberId: {}", facilityId, images.size(), member.getMemberId());
            return ResponseEntity.ok(response);
        } catch (Exception e) {
            log.error("❌ 시설 이미지 목록 조회 API 오류 - facilityId: {}", facilityId, e);
            response.put("success", false);
            response.put("message", "서버 오류가 발생했습니다: " + e.getMessage());
            return ResponseEntity.internalServerError().body(response);
        }
    }
    @PutMapping("/{imageId}/order")
    public ResponseEntity<Map<String, Object>> updateImageOrder(
            @PathVariable Long imageId,
            @RequestParam Integer order) {
        Map<String, Object> response = new HashMap<>();
        try {
            log.info("🔢 개별 이미지 순서 업데이트 API 요청 - imageId: {}, order: {}", imageId, order);
            boolean success = facilityImageService.updateImageOrder(imageId, order);
            if (success) {
                response.put("success", true);
                response.put("message", "이미지 순서가 업데이트되었습니다.");
                log.info("✅ 개별 이미지 순서 업데이트 API 성공 - imageId: {}, order: {}", imageId, order);
                return ResponseEntity.ok(response);
            } else {
                response.put("success", false);
                response.put("message", "이미지 순서 업데이트에 실패했습니다.");
                log.warn("⚠️ 개별 이미지 순서 업데이트 API 실패 - imageId: {}, order: {}", imageId, order);
                return ResponseEntity.badRequest().body(response);
            }
        } catch (Exception e) {
            log.error("❌ 개별 이미지 순서 업데이트 API 오류 - imageId: {}, order: {}", imageId, order, e);
            response.put("success", false);
            response.put("message", "서버 오류가 발생했습니다: " + e.getMessage());
            return ResponseEntity.internalServerError().body(response);
        }
    }
    @DeleteMapping("/{imageId}")
    public ResponseEntity<Map<String, Object>> deleteImage(@PathVariable Long imageId) {
        Map<String, Object> response = new HashMap<>();
        try {
            log.info("🗑️ 이미지 삭제 API 요청 - imageId: {}", imageId);
            boolean success = facilityImageService.deleteFacilityImage(imageId);
            if (success) {
                response.put("success", true);
                response.put("message", "이미지가 삭제되었습니다.");
                log.info("✅ 이미지 삭제 API 성공 - imageId: {}", imageId);
                return ResponseEntity.ok(response);
            } else {
                response.put("success", false);
                response.put("message", "이미지 삭제에 실패했습니다.");
                return ResponseEntity.badRequest().body(response);
            }
        } catch (Exception e) {
            log.error("❌ 이미지 삭제 API 오류 - imageId: {}", imageId, e);
            response.put("success", false);
            response.put("message", "서버 오류가 발생했습니다: " + e.getMessage());
            return ResponseEntity.internalServerError().body(response);
        }
    }
    @PostMapping("/{imageId}/set-main")
    public ResponseEntity<Map<String, Object>> setMainImage(@PathVariable Long imageId) {
        Map<String, Object> response = new HashMap<>();
        try {
            log.info("⭐ 메인 이미지 설정 API 요청 - imageId: {}", imageId);
            FacilityImageDTO imageInfo = facilityImageService.getImageById(imageId);
            if (imageInfo == null) {
                response.put("success", false);
                response.put("message", "이미지를 찾을 수 없습니다.");
                return ResponseEntity.badRequest().body(response);
            }
            boolean success = facilityImageService.setMainImage(imageInfo.getFacilityId(), imageId);
            if (success) {
                response.put("success", true);
                response.put("message", "메인 이미지가 설정되었습니다.");
                log.info("✅ 메인 이미지 설정 API 성공 - imageId: {}", imageId);
                return ResponseEntity.ok(response);
            } else {
                response.put("success", false);
                response.put("message", "메인 이미지 설정에 실패했습니다.");
                return ResponseEntity.badRequest().body(response);
            }
        } catch (Exception e) {
            log.error("❌ 메인 이미지 설정 API 오류 - imageId: {}", imageId, e);
            response.put("success", false);
            response.put("message", "서버 오류가 발생했습니다: " + e.getMessage());
            return ResponseEntity.internalServerError().body(response);
        }
    }
    @PostMapping("/upload")
    public ResponseEntity<Map<String, Object>> uploadImages(
            @RequestParam("facilityId") Long facilityId,
            @RequestParam("images") List<MultipartFile> images,
            HttpSession session) {
        Map<String, Object> response = new HashMap<>();
        try {
            log.info("📤 시설 이미지 업로드 API 요청 - facilityId: {}, 이미지 수: {}", facilityId, images.size());
            MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (member == null) {
                response.put("success", false);
                response.put("message", "로그인이 필요합니다.");
                return ResponseEntity.status(401).body(response);
            }
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                response.put("success", false);
                response.put("message", "시설을 찾을 수 없습니다.");
                return ResponseEntity.badRequest().body(response);
            }
            if (!facility.getRegisteredMemberId().equals(member.getMemberId())
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                response.put("success", false);
                response.put("message", "해당 시설 이미지를 업로드할 권한이 없습니다.");
                return ResponseEntity.status(403).body(response);
            }
            if (images == null || images.isEmpty()) {
                response.put("success", false);
                response.put("message", "업로드할 이미지가 없습니다.");
                return ResponseEntity.badRequest().body(response);
            }
            final long MAX_FILE_SIZE = 10 * 1024 * 1024;
            final int MAX_FILES = 5;
            if (images.size() > MAX_FILES) {
                response.put("success", false);
                response.put("message", "최대 " + MAX_FILES + "장까지만 업로드할 수 있습니다.");
                return ResponseEntity.badRequest().body(response);
            }
            for (MultipartFile image : images) {
                if (image.getSize() > MAX_FILE_SIZE) {
                    response.put("success", false);
                    response.put("message", "파일 크기가 10MB를 초과할 수 없습니다: " + image.getOriginalFilename());
                    return ResponseEntity.badRequest().body(response);
                }
                String contentType = image.getContentType();
                if (contentType == null || !contentType.startsWith("image/")) {
                    response.put("success", false);
                    response.put("message", "이미지 파일만 업로드할 수 있습니다: " + image.getOriginalFilename());
                    return ResponseEntity.badRequest().body(response);
                }
            }
            List<FacilityImageDTO> uploadedImages = facilityImageService.uploadMultipleImages(facilityId, images);
            response.put("success", true);
            response.put("message", images.size() + "개의 이미지가 성공적으로 업로드되었습니다.");
            response.put("uploadedImages", uploadedImages);
            response.put("uploadCount", uploadedImages.size());
            log.info("✅ 시설 이미지 업로드 API 성공 - facilityId: {}, 업로드 수: {}, memberId: {}",
                    facilityId, uploadedImages.size(), member.getMemberId());
            return ResponseEntity.ok(response);
        } catch (Exception e) {
            log.error("❌ 시설 이미지 업로드 API 오류 - facilityId: {}", facilityId, e);
            response.put("success", false);
            response.put("message", "서버 오류가 발생했습니다: " + e.getMessage());
            return ResponseEntity.internalServerError().body(response);
        }
    }
}
````

## File: src/main/java/com/example/carelink/dao/FacilityImageMapper.java
````java
package com.example.carelink.dao;
import com.example.carelink.dto.FacilityImageDTO;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import java.util.List;
@Mapper
public interface FacilityImageMapper {
    List<FacilityImageDTO> getImagesByFacilityId(@Param("facilityId") Long facilityId);
    FacilityImageDTO getMainImageByFacilityId(@Param("facilityId") Long facilityId);
    int insertFacilityImage(FacilityImageDTO facilityImageDTO);
    int updateFacilityImage(FacilityImageDTO facilityImageDTO);
    int deleteFacilityImage(@Param("imageId") Long imageId);
    int deleteAllImagesByFacilityId(@Param("facilityId") Long facilityId);
    int countImagesByFacilityId(@Param("facilityId") Long facilityId);
    int updateMainImage(@Param("facilityId") Long facilityId, @Param("imageId") Long imageId);
    int clearMainImages(@Param("facilityId") Long facilityId);
    FacilityImageDTO getImageById(@Param("imageId") Long imageId);
    int updateImageOrder(@Param("imageId") Long imageId, @Param("imageOrder") Integer imageOrder);
}
````

## File: src/main/java/com/example/carelink/dao/ReviewMapper.java
````java
package com.example.carelink.dao;
import com.example.carelink.dto.ReviewDTO;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import java.util.List;
@Mapper
public interface ReviewMapper {
    List<ReviewDTO> getReviewList(ReviewDTO searchDTO);
    List<ReviewDTO> findReviewsWithSearch(ReviewDTO searchDTO);
    int countReviewsWithSearch(ReviewDTO searchDTO);
    ReviewDTO getReviewById(@Param("reviewId") Long reviewId);
    ReviewDTO findReviewById(@Param("reviewId") Long reviewId);
    int insertReview(ReviewDTO reviewDTO);
    int updateReview(ReviewDTO reviewDTO);
    int deleteReview(@Param("reviewId") Long reviewId);
    int incrementViewCount(@Param("reviewId") Long reviewId);
    int incrementLikeCount(@Param("reviewId") Long reviewId);
    int incrementDislikeCount(@Param("reviewId") Long reviewId);
    List<ReviewDTO> getReviewsByFacilityId(@Param("facilityId") Long facilityId);
    List<ReviewDTO> findReviewsByFacilityId(@Param("facilityId") Long facilityId);
    List<ReviewDTO> findReviewsByMemberId(@Param("memberId") Long memberId);
    Double getAverageRating(@Param("facilityId") Long facilityId);
    List<ReviewDTO> getRecentReviews();
    int getReviewCount(ReviewDTO searchDTO);
    int getReviewCount();
    int deleteByMemberId(@Param("memberId") Long memberId);
    int deleteByFacilityMemberId(@Param("memberId") Long memberId);
}
````

## File: src/main/java/Crolling.java
````java
import java.io.*;
import java.util.*;
public class Crolling {
    public static void main(String[] args) {
        String rootDirectory = "D:\\cch\\project_2\\LightCare\\src\\main";
        String outputFilePath = "D:/LightCare.txt";
        try (BufferedWriter writer = new BufferedWriter(new FileWriter(outputFilePath))) {
            List<File> files = getAllFilesWithExtensions(rootDirectory, Arrays.asList(".java", ".jsp", ".xml", ".js", ".html", ".css"));
            for (File file : files) {
                System.out.println("파일 읽기: " + file.getAbsolutePath());
                writeFileContentToFile(file, writer);
            }
            System.out.println("모든 파일을 크롤링하여 " + outputFilePath + "에 저장했습니다.");
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    public static List<File> getAllFilesWithExtensions(String directoryPath, List<String> extensions) {
        List<File> matchedFiles = new ArrayList<>();
        File rootDirectory = new File(directoryPath);
        File[] files = rootDirectory.listFiles();
        if (files != null) {
            for (File file : files) {
                if (file.isDirectory()) {
                    matchedFiles.addAll(getAllFilesWithExtensions(file.getAbsolutePath(), extensions));
                } else {
                    for (String ext : extensions) {
                        if (file.getName().toLowerCase().endsWith(ext)) {
                            matchedFiles.add(file);
                            break;
                        }
                    }
                }
            }
        }
        return matchedFiles;
    }
    public static void writeFileContentToFile(File file, BufferedWriter writer) throws IOException {
        try (BufferedReader reader = new BufferedReader(new FileReader(file))) {
            writer.write("파일명: " + file.getName() + "\n");
            writer.write("경로: " + file.getAbsolutePath() + "\n");
            writer.write("----------------------------------------------------\n");
            String line;
            while ((line = reader.readLine()) != null) {
                writer.write(line + "\n");
            }
            writer.write("\n\n");
        }
    }
}
````

## File: src/main/resources/mapper/facilityImageMapper.xml
````xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.FacilityImageMapper">
    <resultMap id="FacilityImageResultMap" type="com.example.carelink.dto.FacilityImageDTO">
        <id property="imageId" column="image_id"/>
        <result property="facilityId" column="facility_id"/>
        <result property="imagePath" column="image_path"/>
        <result property="imageAltText" column="image_alt_text"/>
        <result property="imageOrder" column="image_order"/>
        <result property="isMainImage" column="is_main_image"/>
        <result property="uploadDate" column="upload_date"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>
    <select id="getImagesByFacilityId" resultMap="FacilityImageResultMap">
        SELECT
            image_id,
            facility_id,
            image_path,
            image_alt_text,
            image_order,
            is_main_image,
            upload_date,
            updated_at
        FROM facility_images
        WHERE facility_id = #{facilityId}
        ORDER BY image_order ASC, upload_date ASC
    </select>
    <select id="getMainImageByFacilityId" resultMap="FacilityImageResultMap">
        SELECT
            image_id,
            facility_id,
            image_path,
            image_alt_text,
            image_order,
            is_main_image,
            upload_date,
            updated_at
        FROM facility_images
        WHERE facility_id = #{facilityId}
        AND is_main_image = TRUE
        LIMIT 1
    </select>
    <insert id="insertFacilityImage" useGeneratedKeys="true" keyProperty="imageId">
        INSERT INTO facility_images (
            facility_id,
            image_path,
            image_alt_text,
            image_order,
            is_main_image,
            upload_date
        ) VALUES (
            #{facilityId},
            #{imagePath},
            #{imageAltText},
            #{imageOrder},
            #{isMainImage},
            NOW()
        )
    </insert>
    <update id="updateFacilityImage">
        UPDATE facility_images
        SET
            image_path = #{imagePath},
            image_alt_text = #{imageAltText},
            image_order = #{imageOrder},
            is_main_image = #{isMainImage},
            updated_at = NOW()
        WHERE image_id = #{imageId}
    </update>
    <delete id="deleteFacilityImage">
        DELETE FROM facility_images
        WHERE image_id = #{imageId}
    </delete>
    <delete id="deleteAllImagesByFacilityId">
        DELETE FROM facility_images
        WHERE facility_id = #{facilityId}
    </delete>
    <select id="countImagesByFacilityId" resultType="int">
        SELECT COUNT(*)
        FROM facility_images
        WHERE facility_id = #{facilityId}
    </select>
    <update id="clearMainImages">
        UPDATE facility_images
        SET is_main_image = FALSE, updated_at = NOW()
        WHERE facility_id = #{facilityId}
    </update>
    <update id="updateMainImage">
        UPDATE facility_images
        SET is_main_image = TRUE, updated_at = NOW()
        WHERE facility_id = #{facilityId} AND image_id = #{imageId}
    </update>
    <select id="getImageById" resultMap="FacilityImageResultMap">
        SELECT
            image_id,
            facility_id,
            image_path,
            image_alt_text,
            image_order,
            is_main_image,
            upload_date,
            updated_at
        FROM facility_images
        WHERE image_id = #{imageId}
    </select>
    <update id="updateImageOrder">
        UPDATE facility_images
        SET image_order = #{imageOrder}, updated_at = NOW()
        WHERE image_id = #{imageId}
    </update>
</mapper>
````

## File: src/main/resources/mapper/reviewMapper.xml
````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.ReviewMapper">
    <resultMap id="reviewResultMap" type="com.example.carelink.dto.ReviewDTO">
        <id property="reviewId" column="review_id"/>
        <result property="facilityId" column="facility_id"/>
        <result property="facilityName" column="facility_name"/>
        <result property="memberId" column="member_id"/>
        <result property="memberName" column="member_name"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="rating" column="rating"/>
        <result property="serviceRating" column="service_rating"/>
        <result property="facilityRating" column="facility_rating"/>
        <result property="staffRating" column="staff_rating"/>
        <result property="priceRating" column="price_rating"/>
        <result property="reviewImage1" column="review_image1"/>
        <result property="reviewImage2" column="review_image2"/>
        <result property="reviewImage3" column="review_image3"/>
        <result property="likeCount" column="like_count"/>
        <result property="dislikeCount" column="dislike_count"/>
        <result property="viewCount" column="view_count"/>
        <result property="isVisible" column="is_visible"/>
        <result property="status" column="status"/>
        <result property="parentReviewId" column="parent_review_id"/>
        <result property="replyCount" column="reply_count"/>
        <result property="replyDepth" column="reply_depth"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="isDeleted" column="is_deleted"/>
    </resultMap>
    <select id="findReviewsWithSearch" parameterType="com.example.carelink.dto.ReviewDTO" resultMap="reviewResultMap">
        SELECT
            r.*,
            m.name as member_name,
            f.facility_name
        FROM review r
        LEFT JOIN member m ON r.member_id = m.member_id
        LEFT JOIN facility f ON r.facility_id = f.facility_id
        WHERE r.is_deleted = false AND r.is_visible = true
        <if test="facilityId != null">
            AND r.facility_id = #{facilityId}
        </if>
        <if test="searchKeyword != null and searchKeyword != ''">
            AND (r.title LIKE CONCAT('%', #{searchKeyword}, '%')
                 OR r.content LIKE CONCAT('%', #{searchKeyword}, '%'))
        </if>
        <if test="minRating != null">
            AND r.rating >= #{minRating}
        </if>
        <if test="maxRating != null">
            AND r.rating &lt;= #{maxRating}
        </if>
        <choose>
            <when test="sortBy != null and sortBy == 'RATING_HIGH'">
                ORDER BY r.rating DESC, r.created_at DESC
            </when>
            <when test="sortBy != null and sortBy == 'RATING_LOW'">
                ORDER BY r.rating ASC, r.created_at DESC
            </when>
            <when test="sortBy != null and sortBy == 'LIKE_COUNT'">
                ORDER BY r.like_count DESC, r.created_at DESC
            </when>
            <otherwise>
                ORDER BY r.created_at DESC
            </otherwise>
        </choose>
        <if test="size != null and size > 0 and offset != null and offset >= 0">
            LIMIT #{size} OFFSET #{offset}
        </if>
    </select>
    <select id="countReviewsWithSearch" parameterType="com.example.carelink.dto.ReviewDTO" resultType="int">
        SELECT COUNT(*)
        FROM review r
        WHERE r.is_deleted = false AND r.is_visible = true
        <if test="facilityId != null">
            AND r.facility_id = #{facilityId}
        </if>
        <if test="searchKeyword != null and searchKeyword != ''">
            AND (r.title LIKE CONCAT('%', #{searchKeyword}, '%')
                 OR r.content LIKE CONCAT('%', #{searchKeyword}, '%'))
        </if>
        <if test="minRating != null">
            AND r.rating >= #{minRating}
        </if>
        <if test="maxRating != null">
            AND r.rating &lt;= #{maxRating}
        </if>
    </select>
    <select id="findReviewById" parameterType="long" resultMap="reviewResultMap">
        SELECT
            r.*,
            m.name as member_name,
            f.facility_name
        FROM review r
        LEFT JOIN member m ON r.member_id = m.member_id
        LEFT JOIN facility f ON r.facility_id = f.facility_id
        WHERE r.review_id = #{reviewId} AND r.is_deleted = false
    </select>
    <insert id="insertReview" parameterType="com.example.carelink.dto.ReviewDTO" useGeneratedKeys="true" keyProperty="reviewId">
        INSERT INTO review (
            facility_id, member_id, title, content, rating,
            service_rating, facility_rating, staff_rating, price_rating,
            review_image1, review_image2, review_image3,
            is_visible, status, parent_review_id, reply_depth,
            is_deleted, created_at
        ) VALUES (
            #{facilityId}, #{memberId}, #{title}, #{content}, #{rating},
            #{serviceRating}, #{facilityRating}, #{staffRating}, #{priceRating},
            #{reviewImage1}, #{reviewImage2}, #{reviewImage3},
            #{isVisible}, #{status}, #{parentReviewId}, #{replyDepth},
            #{isDeleted}, NOW()
        )
    </insert>
    <update id="updateReview" parameterType="com.example.carelink.dto.ReviewDTO">
        UPDATE review SET
            title = #{title},
            content = #{content},
            rating = #{rating},
            service_rating = #{serviceRating},
            facility_rating = #{facilityRating},
            staff_rating = #{staffRating},
            price_rating = #{priceRating},
            review_image1 = #{reviewImage1},
            review_image2 = #{reviewImage2},
            review_image3 = #{reviewImage3},
            is_visible = #{isVisible},
            status = #{status},
            updated_at = NOW()
        WHERE review_id = #{reviewId}
    </update>
    <update id="deleteReview" parameterType="long">
        UPDATE review SET
            is_deleted = true,
            updated_at = NOW()
        WHERE review_id = #{reviewId}
    </update>
    <update id="incrementViewCount" parameterType="long">
        UPDATE review SET
            view_count = view_count + 1,
            updated_at = NOW()
        WHERE review_id = #{reviewId}
    </update>
    <update id="incrementLikeCount" parameterType="long">
        UPDATE review SET
            like_count = like_count + 1,
            updated_at = NOW()
        WHERE review_id = #{reviewId}
    </update>
    <update id="incrementDislikeCount" parameterType="long">
        UPDATE review SET
            dislike_count = dislike_count + 1,
            updated_at = NOW()
        WHERE review_id = #{reviewId}
    </update>
    <select id="findReviewsByMemberId" parameterType="long" resultMap="reviewResultMap">
        SELECT
            r.*,
            m.name as member_name,
            f.facility_name
        FROM review r
        LEFT JOIN member m ON r.member_id = m.member_id
        LEFT JOIN facility f ON r.facility_id = f.facility_id
        WHERE r.member_id = #{memberId} AND r.is_deleted = false
        ORDER BY r.created_at DESC
    </select>
    <select id="findReviewsByFacilityId" parameterType="long" resultMap="reviewResultMap">
        SELECT
            r.*,
            m.name as member_name,
            f.facility_name
        FROM review r
        LEFT JOIN member m ON r.member_id = m.member_id
        LEFT JOIN facility f ON r.facility_id = f.facility_id
        WHERE r.facility_id = #{facilityId} AND r.is_deleted = false AND r.is_visible = true
        ORDER BY r.created_at DESC
    </select>
    <select id="getAverageRatingByFacilityId" parameterType="long" resultType="float">
        SELECT ROUND(AVG(rating), 1)
        FROM review
        WHERE facility_id = #{facilityId} AND is_deleted = false AND is_visible = true
    </select>
    <select id="getReviewCountByFacilityId" parameterType="long" resultType="int">
        SELECT COUNT(*)
        FROM review
        WHERE facility_id = #{facilityId} AND is_deleted = false AND is_visible = true
    </select>
    <select id="getReviewCount" resultType="int">
        SELECT COUNT(*)
        FROM review
        WHERE is_deleted = false AND is_visible = true
    </select>
    <select id="getAverageRating" parameterType="long" resultType="double">
        SELECT AVG(rating)
        FROM review
        WHERE facility_id = #{facilityId}
          AND is_deleted = false
          AND is_visible = true
    </select>
    <delete id="deleteByMemberId" parameterType="long">
        DELETE FROM review WHERE member_id = #{memberId}
    </delete>
    <delete id="deleteByFacilityMemberId" parameterType="long">
        DELETE FROM review
        WHERE facility_id IN (
            SELECT facility_id FROM facility WHERE registered_member_id = #{memberId}
        )
    </delete>
</mapper>
````

## File: src/main/java/com/example/carelink/common/BaseDTO.java
````java
package com.example.carelink.common;
import lombok.Data;
import java.time.LocalDateTime;
import com.fasterxml.jackson.annotation.JsonFormat;
@Data
public class BaseDTO {
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime createdAt;
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime updatedAt;
    private boolean isDeleted;
    private Integer page;
    private Integer pageSize;
    private Integer offset;
    private Integer size;
    public BaseDTO() {
        this.page = 1;
        this.pageSize = Constants.DEFAULT_PAGE_SIZE;
        this.offset = (this.page - 1) * this.pageSize;
        this.size = this.pageSize;
    }
}
````

## File: src/main/java/com/example/carelink/dao/MemberMapper.java
````java
package com.example.carelink.dao;
import com.example.carelink.dto.MemberDTO;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import java.util.List;
@Mapper
public interface MemberMapper {
    MemberDTO findByUserId(@Param("userId") String userId);
    MemberDTO findById(@Param("memberId") Long memberId);
    MemberDTO findByEmail(@Param("email") String email);
    int insertMember(MemberDTO memberDTO);
    int updateMember(MemberDTO memberDTO);
    int softDeleteMember(@Param("userId") String userId);
    int updatePassword(MemberDTO memberDTO);
    int updateLoginSuccess(@Param("memberId") Long memberId);
    int updateLoginFail(@Param("memberId") Long memberId);
    int getTotalCount();
    List<MemberDTO> findMembersWithPaging(MemberDTO searchDTO);
    List<MemberDTO> findMembersByRole(@Param("role") String role);
    void updateMemberStatus(@Param("memberId") Long memberId, @Param("isActive") boolean isActive);
    int getMemberCount();
    boolean existsByUserId(@Param("userId") String userId);
    boolean existsByEmail(@Param("email") String email);
    int anonymizeMember(@Param("userId") String userId);
    int hardDeleteMember(@Param("userId") String userId);
    int getFacilityMemberCount();
    int getUserMemberCount();
    int getMemberCountByRole(@Param("role") String role);
}
````

## File: src/main/resources/mapper/MemberMapper.xml
````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.MemberMapper">
    <resultMap id="memberResultMap" type="com.example.carelink.dto.MemberDTO">
        <id property="memberId" column="member_id"/>
        <result property="userId" column="user_id"/>
        <result property="password" column="password"/>
        <result property="name" column="name"/>
        <result property="email" column="email"/>
        <result property="phone" column="phone"/>
        <result property="role" column="role"/>
        <result property="address" column="address"/>
        <result property="detailAddress" column="detail_address"/>
        <result property="profileImage" column="profile_image"/>
        <result property="profileImageAltText" column="profile_image_alt_text"/>
        <result property="isActive" column="is_active"/>
        <result property="loginFailCount" column="login_fail_count"/>
        <result property="lastLoginAt" column="last_login_at"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="isDeleted" column="is_deleted"/>
    </resultMap>
    <select id="findByUserId" resultMap="memberResultMap">
        SELECT *
        FROM member
        WHERE user_id = #{userId}
          AND is_deleted = false
    </select>
    <select id="findById" resultMap="memberResultMap">
        SELECT *
        FROM member
        WHERE member_id = #{memberId}
          AND is_deleted = false
    </select>
    <select id="findByEmail" resultMap="memberResultMap">
        SELECT *
        FROM member
        WHERE email = #{email}
          AND is_deleted = false
    </select>
    <insert id="insertMember" parameterType="com.example.carelink.dto.MemberDTO" useGeneratedKeys="true" keyProperty="memberId">
        INSERT INTO member (
        member_id,
        user_id,
        password,
        name,
        email,
        phone,
        role,
        address,
        detail_address,
        profile_image,
        is_active,
        login_fail_count,
        last_login_at,
        is_deleted
        ) VALUES (
        #{memberId},
        #{userId, jdbcType=VARCHAR},
        #{password, jdbcType=VARCHAR},
        #{name, jdbcType=VARCHAR},
        #{email, jdbcType=VARCHAR},
        #{phone, jdbcType=VARCHAR},
        #{role, jdbcType=VARCHAR},
        #{address, jdbcType=VARCHAR},
        #{detailAddress, jdbcType=VARCHAR},
        #{profileImage, jdbcType=VARCHAR},
        #{isActive, jdbcType=BOOLEAN},
        #{loginFailCount, jdbcType=INTEGER},
        #{lastLoginAt, jdbcType=TIMESTAMP},
        #{isDeleted, jdbcType=BOOLEAN}
        )
    </insert>
    <select id="existsByUserId" resultType="boolean">
        SELECT COUNT(*) > 0 FROM member WHERE user_id = #{userId}
    </select>
    <select id="existsByEmail" resultType="boolean">
        SELECT COUNT(*) > 0 FROM member WHERE email = #{email}
    </select>
    <update id="updateMember" parameterType="MemberDTO">
        UPDATE member
        SET
            name = #{name},
            email = #{email},
            phone = #{phone},
            address = #{address},
            detail_address = #{detailAddress},
            profile_image = #{profileImage},
            profile_image_alt_text = #{profileImageAltText},
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>
    <update id="softDeleteMember">
        UPDATE member
        SET
            is_deleted = TRUE,
            is_active = FALSE,
            updated_at = NOW()
        WHERE user_id = #{userId}
    </update>
    <update id="anonymizeMember">
        UPDATE member
        SET
            name = '탈퇴회원',
            email = NULL,
            phone = NULL,
            address = NULL,
            profile_image = NULL,
            password = 'DELETED',
            is_deleted = TRUE,
            is_active = FALSE,
            updated_at = NOW()
        WHERE user_id = #{userId}
    </update>
    <delete id="hardDeleteMember">
        DELETE FROM member WHERE user_id = #{userId}
    </delete>
    <update id="updatePassword" parameterType="MemberDTO">
        UPDATE member
        SET
            password = #{password},
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>
    <update id="updateLoginSuccess">
        UPDATE member
        SET login_fail_count = 0,
            last_login_at = NOW(),
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>
    <update id="updateLoginFail">
        UPDATE member
        SET login_fail_count = login_fail_count + 1,
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>
    <select id="getTotalCount" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE is_deleted = FALSE
    </select>
    <select id="findMembersWithPaging" resultMap="memberResultMap">
        SELECT *
        FROM member
        WHERE is_deleted = FALSE
        <if test="role != null and !role.isEmpty()">
            AND role = #{role}
        </if>
        ORDER BY created_at DESC
        LIMIT #{pageSize} OFFSET #{offset}
    </select>
    <select id="findMembersByRole" resultMap="memberResultMap">
        SELECT *
        FROM member
        WHERE is_deleted = FALSE
        <if test="role != null and role != ''">
            AND role = #{role}
        </if>
        ORDER BY created_at DESC
    </select>
    <update id="updateMemberStatus">
        UPDATE member
        SET is_active = #{isActive},
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>
    <select id="getMemberCount" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE is_deleted = false AND is_active = true
    </select>
    <select id="getFacilityMemberCount" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE is_deleted = false
        AND role = 'FACILITY'
    </select>
    <select id="getUserMemberCount" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE is_deleted = false
        AND role = 'USER'
    </select>
    <select id="getMemberCountByRole" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE is_deleted = false
        <if test="role != null and role != ''">
            AND role = #{role}
        </if>
    </select>
</mapper>
````

## File: src/main/java/com/example/carelink/dao/BoardMapper.java
````java
package com.example.carelink.dao;
import com.example.carelink.dto.BoardDTO;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import java.util.List;
@Mapper
public interface BoardMapper {
    List<BoardDTO> getBoardList(BoardDTO searchDTO);
    BoardDTO getBoardById(@Param("boardId") Long boardId);
    BoardDTO getBoardByIdIncludeDeleted(@Param("boardId") Long boardId);
    int insertBoard(BoardDTO boardDTO);
    int updateBoard(BoardDTO boardDTO);
    int deleteBoard(@Param("boardId") Long boardId);
    void increaseViewCount(@Param("boardId") Long boardId);
    void incrementViewCount(@Param("boardId") Long boardId);
    List<BoardDTO> getPopularBoards();
    List<BoardDTO> getBoardsByCategory(@Param("category") String category);
    int getBoardCount(BoardDTO searchDTO);
    List<BoardDTO> getPopularBoardsByCategory(@Param("category") String category);
    void incrementLikeCount(@Param("boardId") Long boardId);
    void decrementLikeCount(@Param("boardId") Long boardId);
    BoardDTO getPreviousBoard(@Param("boardId") Long boardId);
    BoardDTO getNextBoard(@Param("boardId") Long boardId);
    List<BoardDTO> findBoardsByMemberId(@Param("memberId") Long memberId);
    int deleteByMemberId(@Param("memberId") Long memberId);
}
````

## File: src/main/java/com/example/carelink/dao/FacilityMapper.java
````java
package com.example.carelink.dao;
import com.example.carelink.dto.FacilityDTO;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import java.util.List;
@Mapper
public interface FacilityMapper {
    List<FacilityDTO> searchFacilities(FacilityDTO searchDTO);
    FacilityDTO getFacilityById(@Param("facilityId") Long facilityId);
    List<FacilityDTO> getAllFacilities();
    List<FacilityDTO> getAllActiveFacilities();
    int insertFacility(FacilityDTO facilityDTO);
    int updateFacility(FacilityDTO facilityDTO);
    int deleteFacility(@Param("facilityId") Long facilityId);
    int countFacilitiesByRegion(@Param("region") String region);
    int getFacilityCount();
    int deleteByMemberId(@Param("memberId") Long memberId);
    List<FacilityDTO> getFacilitiesByMemberId(@Param("memberId") Long memberId);
    FacilityDTO getFacilityByMemberId(@Param("memberId") Long memberId);
    int updateFacilityMainImage(@Param("facilityId") Long facilityId,
                               @Param("mainImagePath") String mainImagePath,
                               @Param("imageCount") Integer imageCount);
    List<FacilityDTO> getFacilitiesByApprovalStatus(@Param("approvalStatus") String approvalStatus);
    int updateFacilityApprovalStatus(@Param("facilityId") Long facilityId,
                                   @Param("approvalStatus") String approvalStatus,
                                   @Param("rejectionReason") String rejectionReason);
    int countFacilitiesByStatus(@Param("approvalStatus") String approvalStatus);
}
````

## File: src/main/java/com/example/carelink/dao/JobMapper.java
````java
package com.example.carelink.dao;
import com.example.carelink.dto.JobDTO;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import java.util.List;
@Mapper
public interface JobMapper {
    List<JobDTO> findJobsWithSearch(JobDTO searchDTO);
    List<JobDTO> getJobList(JobDTO searchDTO);
    JobDTO findJobById(@Param("jobId") Long jobId);
    int insertJob(JobDTO jobDTO);
    int updateJob(JobDTO jobDTO);
    int deleteJob(@Param("jobId") Long jobId);
    List<JobDTO> getPopularJobs();
    List<JobDTO> searchJobs(JobDTO searchDTO);
    int countJobsWithSearch(JobDTO searchDTO);
    int getJobCount();
    void incrementApplyCount(@Param("jobId") Long jobId);
    List<JobDTO> findJobsByMemberId(@Param("memberId") Long memberId);
    int deleteByMemberId(@Param("memberId") Long memberId);
    int deleteByFacilityMemberId(@Param("memberId") Long memberId);
}
````

## File: src/main/java/com/example/carelink/dto/BoardDTO.java
````java
package com.example.carelink.dto;
import com.example.carelink.common.BaseDTO;
import lombok.Data;
import lombok.EqualsAndHashCode;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;
import java.time.LocalDateTime;
@Data
@EqualsAndHashCode(callSuper = true)
public class BoardDTO extends BaseDTO {
    private Long boardId;
    @NotBlank(message = "게시판 유형은 필수입니다")
    private String boardType;
    @NotBlank(message = "제목은 필수입니다")
    private String title;
    @NotBlank(message = "내용은 필수입니다")
    private String content;
    @NotNull(message = "작성자 정보는 필수입니다")
    private Long memberId;
    private String memberName;
    private String author;
    private Integer viewCount;
    private Integer likeCount;
    private Integer commentCount;
    private String attachmentPath;
    private String attachmentName;
    private Long attachmentSize;
    private Boolean isNotice;
    private Boolean isSecret;
    private Boolean isActive;
    private Boolean isDeleted;
    private String status;
    private String category;
    private String subCategory;
    private Integer priority = 1;
    private Boolean isPinned;
    private Long parentBoardId;
    private Integer replyDepth;
    private Integer replyOrder;
    private String qaType;
    private Boolean isAnswered;
    private Integer answerCount;
    private String searchKeyword;
    private String searchType;
    private String searchCategory;
    private String sortBy;
    private String sortOrder;
    private String tags;
    private String metaDescription;
    private String metaKeywords;
    private Integer page = 1;
    private Integer size = 10;
    private Integer offset = 0;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
    public void setAuthor(String author) {
        this.author = (this.memberName != null && !this.memberName.isEmpty()) ? this.memberName : author;
    }
    public String getAuthor() {
        return (this.memberName != null && !this.memberName.isEmpty()) ? this.memberName : this.author;
    }
    public boolean getIsNew() {
        if (this.getCreatedAt() == null) return false;
        return this.getCreatedAt().isAfter(java.time.LocalDateTime.now().minusDays(1));
    }
    public boolean getIsHot() {
        return (this.viewCount != null && this.viewCount >= 100) ||
               (this.likeCount != null && this.likeCount >= 10);
    }
    public boolean getHasComments() {
        return this.commentCount != null && this.commentCount > 0;
    }
}
````

## File: src/main/java/com/example/carelink/service/BoardService.java
````java
package com.example.carelink.service;
import com.example.carelink.common.PageInfo;
import com.example.carelink.dao.BoardMapper;
import com.example.carelink.dto.BoardDTO;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import java.util.List;
import java.util.Map;
import java.util.HashMap;
@Slf4j
@Service
@RequiredArgsConstructor
public class BoardService {
    private final BoardMapper boardMapper;
    private static final int DEFAULT_PAGE_SIZE = 10;
    public PageInfo<BoardDTO> getBoardList(int page, String keyword, String category) {
        log.info("게시글 목록 조회 시작 - page: {}, keyword: {}, category: {}", page, keyword, category);
        try {
            BoardDTO searchDTO = new BoardDTO();
            searchDTO.setPage(page);
            searchDTO.setSize(DEFAULT_PAGE_SIZE);
            searchDTO.setOffset((page - 1) * DEFAULT_PAGE_SIZE);
            if (keyword != null && !keyword.trim().isEmpty()) {
                searchDTO.setSearchKeyword(keyword.trim());
            }
            if (category != null && !category.trim().isEmpty() && !"all".equals(category)) {
                searchDTO.setCategory(category.trim());
            }
            log.info("검색 조건 - searchDTO: page={}, size={}, offset={}, keyword={}, category={}",
                searchDTO.getPage(), searchDTO.getSize(), searchDTO.getOffset(),
                searchDTO.getSearchKeyword(), searchDTO.getCategory());
            int totalCount = boardMapper.getBoardCount(searchDTO);
            log.info("전체 게시글 수: {}", totalCount);
            List<BoardDTO> boardList = boardMapper.getBoardList(searchDTO);
            log.info("조회된 게시글 수: {}", boardList != null ? boardList.size() : 0);
            if (boardList != null && !boardList.isEmpty()) {
                log.info("첫 번째 게시글 정보 - ID: {}, 제목: {}, 작성자: {}, is_active: {}, is_deleted: {}",
                    boardList.get(0).getBoardId(),
                    boardList.get(0).getTitle(),
                    boardList.get(0).getMemberName(),
                    boardList.get(0).getIsActive(),
                    boardList.get(0).getIsDeleted());
            } else {
                log.warn("조회된 게시글이 없습니다.");
            }
            PageInfo<BoardDTO> pageInfo = new PageInfo<>(boardList, page, DEFAULT_PAGE_SIZE, totalCount);
            log.info("페이징 정보 - 현재페이지: {}, 전체페이지: {}, 전체건수: {}",
                pageInfo.getCurrentPage(), pageInfo.getTotalPages(), pageInfo.getTotalCount());
            return pageInfo;
        } catch (Exception e) {
            log.error("게시글 목록 조회 중 오류 발생", e);
            throw new RuntimeException("게시글 목록을 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional
    public BoardDTO getBoardById(Long id) {
        log.info("게시글 상세 조회 시작 - boardId: {}", id);
        try {
            BoardDTO board = boardMapper.getBoardById(id);
            if (board == null) {
                throw new RuntimeException("해당 게시글을 찾을 수 없습니다. ID: " + id);
            }
            log.info("게시글 상세 조회 완료 - boardId: {}, title: {}", id, board.getTitle());
            return board;
        } catch (Exception e) {
            log.error("게시글 상세 조회 중 오류 발생 - boardId: {}", id, e);
            throw new RuntimeException("게시글 상세 정보를 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    public BoardDTO getBoardByIdIncludeDeleted(Long id) {
        log.info("게시글 상세 조회 (삭제 포함) 시작 - boardId: {}", id);
        try {
            BoardDTO board = boardMapper.getBoardByIdIncludeDeleted(id);
            if (board != null) {
                log.info("📄 게시글 조회 성공 (삭제 포함) - boardId: {}, title: {}", id, board.getTitle());
                log.info("   🔍 DB에서 조회된 isDeleted 원본값: {}", board.getIsDeleted());
                log.info("   🔍 isDeleted null 체크: {}", board.getIsDeleted() == null ? "NULL" : "NOT NULL");
                if (board.getIsDeleted() != null) {
                    log.info("   🔍 isDeleted boolean 값: {} ({})", board.getIsDeleted(),
                        board.getIsDeleted() ? "삭제됨" : "정상");
                }
            } else {
                log.warn("존재하지 않는 게시글 조회 시도 (삭제 포함) - boardId: {}", id);
            }
            return board;
        } catch (Exception e) {
            log.error("게시글 상세 조회 (삭제 포함) 중 오류 발생 - boardId: {}", id, e);
            throw new RuntimeException("게시글을 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional
    public int insertBoard(BoardDTO boardDTO) {
        log.info("게시글 등록 시작 - title: {}, memberId: {}", boardDTO.getTitle(), boardDTO.getMemberId());
        try {
            validateBoardData(boardDTO);
            if (boardDTO.getStatus() == null) {
                boardDTO.setStatus("ACTIVE");
            }
            if (boardDTO.getPriority() == null) {
                boardDTO.setPriority(0);
            }
            if (boardDTO.getReplyDepth() == null) {
                boardDTO.setReplyDepth(0);
            }
            if (boardDTO.getReplyOrder() == null) {
                boardDTO.setReplyOrder(0);
            }
            if (boardDTO.getIsNotice() == null) {
                boardDTO.setIsNotice(false);
            }
            if (boardDTO.getIsSecret() == null) {
                boardDTO.setIsSecret(false);
            }
            if (boardDTO.getIsActive() == null) {
                boardDTO.setIsActive(true);
            }
            if (boardDTO.getIsDeleted() == null) {
                boardDTO.setIsDeleted(false);
            }
            if (boardDTO.getIsPinned() == null) {
                boardDTO.setIsPinned(false);
            }
            if (boardDTO.getCategory() != null && "NOTICE".equals(boardDTO.getCategory())) {
                boardDTO.setIsNotice(true);
            }
            if (boardDTO.getBoardType() == null) {
                String category = boardDTO.getCategory();
                if ("NOTICE".equals(category)) {
                    boardDTO.setBoardType("NOTICE");
                } else if ("INFO".equals(category)) {
                    boardDTO.setBoardType("INFO");
                } else if ("QNA".equals(category)) {
                    boardDTO.setBoardType("QNA");
                } else if ("FAQ".equals(category)) {
                    boardDTO.setBoardType("FAQ");
                } else {
                    boardDTO.setBoardType("GENERAL");
                }
            }
            log.info("📝 등록 전 상태 확인 - isDeleted: {}, isActive: {}",
                boardDTO.getIsDeleted(), boardDTO.getIsActive());
            int result = boardMapper.insertBoard(boardDTO);
            log.info("✅ 게시글 등록 완료 - boardId: {}", boardDTO.getBoardId());
            if (boardDTO.getBoardId() != null) {
                BoardDTO savedBoard = boardMapper.getBoardByIdIncludeDeleted(boardDTO.getBoardId());
                if (savedBoard != null) {
                    log.info("🔍 등록 직후 DB 상태 확인 - boardId: {}, isDeleted: {}, isActive: {}",
                        savedBoard.getBoardId(), savedBoard.getIsDeleted(), savedBoard.getIsActive());
                } else {
                    log.warn("⚠️ 등록 직후 게시글을 찾을 수 없습니다. boardId: {}", boardDTO.getBoardId());
                }
            }
            return result;
        } catch (Exception e) {
            log.error("게시글 등록 중 오류 발생", e);
            throw new RuntimeException("게시글 등록 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional
    public int updateBoard(BoardDTO boardDTO) {
        log.info("게시글 수정 시작 - boardId: {}, title: {}", boardDTO.getBoardId(), boardDTO.getTitle());
        try {
            BoardDTO existingBoard = boardMapper.getBoardByIdIncludeDeleted(boardDTO.getBoardId());
            if (existingBoard == null) {
                throw new RuntimeException("수정할 게시글을 찾을 수 없습니다. ID: " + boardDTO.getBoardId());
            }
            validateBoardData(boardDTO);
            if (boardDTO.getPriority() == null) {
                boardDTO.setPriority(1);
            }
            int result = boardMapper.updateBoard(boardDTO);
            log.info("게시글 수정 완료 - boardId: {}", boardDTO.getBoardId());
            return result;
        } catch (Exception e) {
            log.error("게시글 수정 중 오류 발생 - boardId: {}", boardDTO.getBoardId(), e);
            throw new RuntimeException("게시글 수정 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional
    public Map<String, Object> deleteBoard(Long id) {
        log.info("게시글 삭제 시작 - boardId: {}", id);
        Map<String, Object> result = new HashMap<>();
        try {
            BoardDTO existingBoard = boardMapper.getBoardByIdIncludeDeleted(id);
            if (existingBoard == null) {
                log.warn("삭제 요청된 게시글을 찾을 수 없습니다. ID: {}", id);
                result.put("success", false);
                result.put("code", "NOT_FOUND");
                result.put("message", "게시글을 찾을 수 없습니다.");
                return result;
            }
            log.info("🔍 게시글 상태 확인 - boardId: {}", id);
            log.info("   - title: {}", existingBoard.getTitle());
            log.info("   - isDeleted 값: {}", existingBoard.getIsDeleted());
            log.info("   - isDeleted 타입: {}", existingBoard.getIsDeleted() != null ? existingBoard.getIsDeleted().getClass().getSimpleName() : "null");
            log.info("🔍 삭제 상태 상세 분석:");
            log.info("   - isDeleted 원본값: {}", existingBoard.getIsDeleted());
            log.info("   - isDeleted == null: {}", existingBoard.getIsDeleted() == null);
            log.info("   - isDeleted != null: {}", existingBoard.getIsDeleted() != null);
            if (existingBoard.getIsDeleted() != null) {
                log.info("   - isDeleted.booleanValue(): {}", existingBoard.getIsDeleted().booleanValue());
                log.info("   - Boolean.TRUE.equals(isDeleted): {}", Boolean.TRUE.equals(existingBoard.getIsDeleted()));
            }
            boolean isAlreadyDeleted = existingBoard.getIsDeleted() != null && existingBoard.getIsDeleted();
            log.info("🔍 최종 삭제 판정: {}", isAlreadyDeleted);
            if (isAlreadyDeleted) {
                log.info("❌ 이미 삭제된 게시글입니다. boardId: {}, isDeleted: {}", id, existingBoard.getIsDeleted());
                result.put("success", false);
                result.put("code", "ALREADY_DELETED");
                result.put("message", "이미 삭제된 게시글입니다.");
                return result;
            }
            log.info("✅ 삭제 가능한 게시글입니다. boardId: {}, isDeleted: {}", id, existingBoard.getIsDeleted());
            int deleteResult = boardMapper.deleteBoard(id);
            if (deleteResult > 0) {
                log.info("게시글 삭제 완료 - boardId: {}, 영향받은 행: {}", id, deleteResult);
                result.put("success", true);
                result.put("code", "DELETED");
                result.put("message", "게시글이 삭제되었습니다.");
            } else {
                log.warn("게시글 삭제 실패 - boardId: {}, 영향받은 행: {}", id, deleteResult);
                result.put("success", false);
                result.put("code", "DELETE_FAILED");
                result.put("message", "게시글 삭제에 실패했습니다.");
            }
            return result;
        } catch (Exception e) {
            log.error("게시글 삭제 중 오류 발생 - boardId: {}", id, e);
            result.put("success", false);
            result.put("code", "ERROR");
            result.put("message", "게시글 삭제 중 오류가 발생했습니다: " + e.getMessage());
            return result;
        }
    }
    @Transactional
    public void incrementViewCount(Long id) {
        log.info("조회수 증가 시작 - boardId: {}", id);
        try {
            boardMapper.incrementViewCount(id);
            log.info("조회수 증가 완료 - boardId: {}", id);
        } catch (Exception e) {
            log.warn("조회수 증가 중 오류 발생 - boardId: {} (무시하고 진행)", id, e);
        }
    }
    public List<BoardDTO> getPopularBoards() {
        log.info("인기 게시글 목록 조회 시작");
        try {
            List<BoardDTO> popularBoards = boardMapper.getPopularBoards();
            log.info("인기 게시글 목록 조회 완료 - 조회된 건수: {}", popularBoards.size());
            return popularBoards;
        } catch (Exception e) {
            log.error("인기 게시글 목록 조회 중 오류 발생", e);
            throw new RuntimeException("인기 게시글을 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    public List<BoardDTO> getBoardsByCategory(String category) {
        log.info("카테고리별 게시글 목록 조회 시작 - category: {}", category);
        try {
            List<BoardDTO> boards = boardMapper.getBoardsByCategory(category);
            log.info("카테고리별 게시글 목록 조회 완료 - category: {}, 조회된 건수: {}", category, boards.size());
            return boards;
        } catch (Exception e) {
            log.error("카테고리별 게시글 목록 조회 중 오류 발생 - category: {}", category, e);
            throw new RuntimeException("카테고리별 게시글을 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    public List<BoardDTO> getNoticeBoards() {
        log.info("공지사항 목록 조회 시작");
        try {
            BoardDTO searchDTO = new BoardDTO();
            searchDTO.setCategory("NOTICE");
            searchDTO.setSize(5);
            searchDTO.setPage(1);
            List<BoardDTO> notices = boardMapper.getBoardList(searchDTO);
            log.info("공지사항 목록 조회 완료 - 조회된 건수: {}", notices.size());
            return notices;
        } catch (Exception e) {
            log.error("공지사항 목록 조회 중 오류 발생", e);
            throw new RuntimeException("공지사항을 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    private void validateBoardData(BoardDTO boardDTO) {
        if (boardDTO.getMemberId() == null) {
            throw new IllegalArgumentException("작성자 ID는 필수입니다.");
        }
        if (boardDTO.getTitle() == null || boardDTO.getTitle().trim().isEmpty()) {
            throw new IllegalArgumentException("게시글 제목은 필수입니다.");
        }
        if (boardDTO.getContent() == null || boardDTO.getContent().trim().isEmpty()) {
            throw new IllegalArgumentException("게시글 내용은 필수입니다.");
        }
        if (boardDTO.getTitle().length() > 200) {
            throw new IllegalArgumentException("게시글 제목은 200자를 초과할 수 없습니다.");
        }
    }
    public List<BoardDTO> getPopularBoardsByCategory(String category) {
        log.info("카테고리별 인기 게시글 목록 조회 시작 - category: {}", category);
        try {
            List<BoardDTO> popularBoards;
            if (category == null || category.trim().isEmpty()) {
                popularBoards = boardMapper.getPopularBoards();
            } else {
                popularBoards = boardMapper.getPopularBoardsByCategory(category);
            }
            log.info("카테고리별 인기 게시글 목록 조회 완료 - 조회된 건수: {}", popularBoards.size());
            return popularBoards;
        } catch (Exception e) {
            log.error("카테고리별 인기 게시글 목록 조회 중 오류 발생", e);
            throw new RuntimeException("인기 게시글을 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    public BoardDTO getPreviousBoard(Long currentId) {
        log.info("이전 게시글 조회 시작 - currentId: {}", currentId);
        try {
            BoardDTO prevBoard = boardMapper.getPreviousBoard(currentId);
            log.info("이전 게시글 조회 완료 - prevBoardId: {}", prevBoard != null ? prevBoard.getBoardId() : "없음");
            return prevBoard;
        } catch (Exception e) {
            log.error("이전 게시글 조회 중 오류 발생", e);
            return null;
        }
    }
    public BoardDTO getNextBoard(Long currentId) {
        log.info("다음 게시글 조회 시작 - currentId: {}", currentId);
        try {
            BoardDTO nextBoard = boardMapper.getNextBoard(currentId);
            log.info("다음 게시글 조회 완료 - nextBoardId: {}", nextBoard != null ? nextBoard.getBoardId() : "없음");
            return nextBoard;
        } catch (Exception e) {
            log.error("다음 게시글 조회 중 오류 발생", e);
            return null;
        }
    }
    @Transactional
    public void incrementLikeCount(Long id) {
        log.info("게시글 추천수 증가 시작 - boardId: {}", id);
        try {
            boardMapper.incrementLikeCount(id);
            log.info("게시글 추천수 증가 완료 - boardId: {}", id);
        } catch (Exception e) {
            log.error("게시글 추천수 증가 중 오류 발생 - boardId: {}", id, e);
            throw new RuntimeException("추천 처리 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional
    public void decrementLikeCount(Long id) {
        log.info("게시글 추천수 감소 시작 - boardId: {}", id);
        try {
            boardMapper.decrementLikeCount(id);
            log.info("게시글 추천수 감소 완료 - boardId: {}", id);
        } catch (Exception e) {
            log.error("게시글 추천수 감소 중 오류 발생 - boardId: {}", id, e);
            throw new RuntimeException("추천 취소 처리 중 오류가 발생했습니다.", e);
        }
    }
    public int getBoardCount() {
        log.info("전체 게시글 수 조회 시작");
        try {
            BoardDTO searchDTO = new BoardDTO();
            int count = boardMapper.getBoardCount(searchDTO);
            log.info("전체 게시글 수 조회 완료 - 총 {}건", count);
            return count;
        } catch (Exception e) {
            log.error("전체 게시글 수 조회 중 오류 발생", e);
            return 0;
        }
    }
}
````

## File: src/main/resources/mapper/boardMapper.xml
````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.BoardMapper">
    <resultMap id="boardResultMap" type="com.example.carelink.dto.BoardDTO">
        <id property="boardId" column="board_id"/>
        <result property="boardType" column="board_type"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="memberId" column="member_id"/>
        <result property="memberName" column="member_name"/>
        <result property="viewCount" column="view_count"/>
        <result property="likeCount" column="like_count"/>
        <result property="commentCount" column="comment_count"/>
        <result property="attachmentPath" column="attachment_path"/>
        <result property="attachmentName" column="attachment_name"/>
        <result property="attachmentSize" column="attachment_size"/>
        <result property="isNotice" column="is_notice"/>
        <result property="isSecret" column="is_secret"/>
        <result property="isDeleted" column="is_deleted"/>
        <result property="status" column="status"/>
        <result property="category" column="category"/>
        <result property="subCategory" column="sub_category"/>
        <result property="priority" column="priority"/>
        <result property="isPinned" column="is_pinned"/>
        <result property="parentBoardId" column="parent_board_id"/>
        <result property="replyDepth" column="reply_depth"/>
        <result property="replyOrder" column="reply_order"/>
        <result property="tags" column="tags"/>
        <result property="metaDescription" column="meta_description"/>
        <result property="metaKeywords" column="meta_keywords"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>
    <select id="getBoardList" parameterType="com.example.carelink.dto.BoardDTO" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.board_type,
            b.title,
            b.content,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.is_notice,
            b.is_secret,
            COALESCE(b.is_active, true) as is_active,
            COALESCE(b.is_deleted, false) as is_deleted,
            b.status,
            b.category,
            b.sub_category,
            b.priority,
            b.is_pinned,
            b.tags,
            b.created_at,
            b.updated_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            <if test="searchKeyword != null and searchKeyword != ''">
                AND (b.title LIKE CONCAT('%', #{searchKeyword}, '%') OR b.content LIKE CONCAT('%', #{searchKeyword}, '%'))
            </if>
            <if test="category != null and category != ''">
                AND b.category = #{category}
            </if>
        ORDER BY
            b.is_notice DESC,
            b.created_at DESC
        LIMIT #{size} OFFSET #{offset}
    </select>
    <select id="getBoardCount" parameterType="com.example.carelink.dto.BoardDTO" resultType="int">
        SELECT COUNT(*)
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            <if test="searchKeyword != null and searchKeyword != ''">
                AND (b.title LIKE CONCAT('%', #{searchKeyword}, '%') OR b.content LIKE CONCAT('%', #{searchKeyword}, '%'))
            </if>
            <if test="category != null and category != ''">
                AND b.category = #{category}
            </if>
    </select>
    <select id="getBoardById" parameterType="long" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.board_type,
            b.title,
            b.content,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.attachment_path,
            b.attachment_name,
            b.attachment_size,
            b.is_notice,
            b.is_secret,
            COALESCE(b.is_active, true) as is_active,
            COALESCE(b.is_deleted, false) as is_deleted,
            b.status,
            b.category,
            b.sub_category,
            b.priority,
            b.is_pinned,
            b.parent_board_id,
            b.reply_depth,
            b.reply_order,
            b.tags,
            b.meta_description,
            b.meta_keywords,
            b.created_at,
            b.updated_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            b.board_id = #{boardId}
            AND COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
    </select>
    <select id="getBoardByIdIncludeDeleted" parameterType="long" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.board_type,
            b.title,
            b.content,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.attachment_path,
            b.attachment_name,
            b.attachment_size,
            b.is_notice,
            b.is_secret,
            COALESCE(b.is_active, true) as is_active,
            COALESCE(b.is_deleted, false) as is_deleted,
            b.status,
            b.category,
            b.sub_category,
            b.priority,
            b.is_pinned,
            b.parent_board_id,
            b.reply_depth,
            b.reply_order,
            b.tags,
            b.meta_description,
            b.meta_keywords,
            b.created_at,
            b.updated_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            b.board_id = #{boardId}
    </select>
    <insert id="insertBoard" parameterType="com.example.carelink.dto.BoardDTO" useGeneratedKeys="true" keyProperty="boardId">
        INSERT INTO board (
            board_type,
            title,
            content,
            member_id,
            attachment_path,
            attachment_name,
            attachment_size,
            is_notice,
            is_secret,
            is_active,
            is_deleted,
            category,
            sub_category,
            priority,
            is_pinned,
            parent_board_id,
            reply_depth,
            reply_order,
            tags,
            meta_description,
            meta_keywords,
            created_at,
            updated_at
        ) VALUES (
            #{boardType},
            #{title},
            #{content},
            #{memberId},
            #{attachmentPath},
            #{attachmentName},
            #{attachmentSize},
            #{isNotice},
            #{isSecret},
            #{isActive},
            #{isDeleted},
            #{category},
            #{subCategory},
            COALESCE(#{priority}, 1),
            #{isPinned},
            #{parentBoardId},
            #{replyDepth},
            #{replyOrder},
            #{tags},
            #{metaDescription},
            #{metaKeywords},
            NOW(),
            NOW()
        )
    </insert>
    <update id="updateBoard" parameterType="com.example.carelink.dto.BoardDTO">
        UPDATE board
        SET
            board_type = #{boardType},
            title = #{title},
            content = #{content},
            attachment_path = #{attachmentPath},
            attachment_name = #{attachmentName},
            attachment_size = #{attachmentSize},
            is_notice = #{isNotice},
            is_secret = #{isSecret},
            category = #{category},
            sub_category = #{subCategory},
            priority = COALESCE(#{priority}, 1),
            is_pinned = #{isPinned},
            tags = #{tags},
            meta_description = #{metaDescription},
            meta_keywords = #{metaKeywords},
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
    </update>
    <update id="deleteBoard" parameterType="long">
        UPDATE board
        SET
            is_deleted = true,
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
            AND COALESCE(is_deleted, false) = false
    </update>
    <update id="incrementViewCount" parameterType="long">
        UPDATE board
        SET
            view_count = view_count + 1,
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
            AND COALESCE(is_active, true) = true
            AND COALESCE(is_deleted, false) = false
    </update>
    <update id="increaseViewCount" parameterType="long">
        UPDATE board
        SET
            view_count = view_count + 1,
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
            AND COALESCE(is_active, true) = true
            AND COALESCE(is_deleted, false) = false
    </update>
    <select id="getPopularBoards" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.title,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.category,
            b.is_notice,
            b.is_pinned,
            b.created_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            AND b.created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)
        ORDER BY
            (b.view_count * 0.4 + b.like_count * 0.4 + b.comment_count * 0.2) DESC
        LIMIT 5
    </select>
    <select id="getBoardsByCategory" parameterType="string" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.title,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.category,
            b.is_notice,
            b.is_pinned,
            b.created_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            AND b.category = #{category}
        ORDER BY
            b.created_at DESC
        LIMIT 10
    </select>
    <select id="getPopularBoardsByCategory" parameterType="string" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.title,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.category,
            b.is_notice,
            b.is_pinned,
            b.created_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            AND b.created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)
            <if test="category != null and category != ''">
                AND b.category = #{category}
            </if>
        ORDER BY
            (b.view_count * 0.4 + b.like_count * 0.4 + b.comment_count * 0.2) DESC
        LIMIT 5
    </select>
    <select id="getPreviousBoard" parameterType="long" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.title
        FROM
            board b
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            AND b.board_id &lt; #{boardId}
        ORDER BY
            b.board_id DESC
        LIMIT 1
    </select>
    <select id="getNextBoard" parameterType="long" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.title
        FROM
            board b
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            AND b.board_id &gt; #{boardId}
        ORDER BY
            b.board_id ASC
        LIMIT 1
    </select>
    <update id="incrementLikeCount" parameterType="long">
        UPDATE board
        SET
            like_count = like_count + 1,
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
            AND COALESCE(is_active, true) = true
            AND COALESCE(is_deleted, false) = false
    </update>
    <update id="decrementLikeCount" parameterType="long">
        UPDATE board
        SET
            like_count = GREATEST(0, like_count - 1),
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
            AND COALESCE(is_active, true) = true
            AND COALESCE(is_deleted, false) = false
    </update>
    <select id="findBoardsByMemberId" resultMap="boardResultMap">
        SELECT b.*, m.name as author_name
        FROM board b
        LEFT JOIN member m ON b.member_id = m.member_id
        WHERE b.member_id = #{memberId}
          AND b.is_deleted = false
        ORDER BY b.created_at DESC
    </select>
    <delete id="deleteByMemberId" parameterType="long">
        DELETE FROM board WHERE member_id = #{memberId}
    </delete>
</mapper>
````

## File: src/main/java/com/example/carelink/controller/BoardController.java
````java
package com.example.carelink.controller;
import com.example.carelink.common.PageInfo;
import com.example.carelink.common.Constants;
import com.example.carelink.dto.BoardDTO;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.service.BoardService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
@Slf4j
@Controller
@RequestMapping("/board")
@RequiredArgsConstructor
public class BoardController {
    private final BoardService boardService;
    private final Map<String, Map<String, String>> boardTypeInfo = Map.of(
        "notice", Map.of("title", "공지사항", "description", "중요한 공지사항을 확인하세요", "category", "NOTICE"),
        "info", Map.of("title", "정보공유", "description", "유용한 정보를 공유하고 함께 나누세요", "category", "INFO"),
        "qna", Map.of("title", "Q&A", "description", "궁금한 점을 질문하고 답변을 받아보세요", "category", "QNA"),
        "faq", Map.of("title", "자주묻는질문", "description", "자주 묻는 질문과 답변을 확인하세요", "category", "FAQ"),
        "all", Map.of("title", "전체 게시판", "description", "모든 게시판의 글을 한번에 확인하세요", "category", "")
    );
    /**
     * 게시판 목록 페이지 (타입별 구분 지원)
     */
    @GetMapping
    public String listPage(Model model,
                          @RequestParam(defaultValue = "1") int page,
                          @RequestParam(defaultValue = "") String keyword,
                          @RequestParam(defaultValue = "") String category,
                          @RequestParam(defaultValue = "all") String type,
                          HttpServletResponse response) {
        response.setHeader("Cache-Control", "no-cache, no-store, must-revalidate");
        response.setHeader("Pragma", "no-cache");
        response.setDateHeader("Expires", 0);
        Map<String, String> currentBoardInfo = boardTypeInfo.getOrDefault(type, boardTypeInfo.get("all"));
        String actualCategory = currentBoardInfo.get("category");
        if (category.isEmpty() && !actualCategory.isEmpty()) {
            category = actualCategory;
        }
        try {
            PageInfo<BoardDTO> pageInfo = boardService.getBoardList(page, keyword, category);
            List<BoardDTO> popularBoards = boardService.getPopularBoardsByCategory(category);
            model.addAttribute("pageInfo", pageInfo);
            model.addAttribute("boardList", pageInfo.getList());
            model.addAttribute("popularBoards", popularBoards != null ? popularBoards : List.of());
            model.addAttribute("keyword", keyword != null ? keyword : "");
            model.addAttribute("category", category != null ? category : "");
            model.addAttribute("type", type);
            model.addAttribute("currentPage", page);
        } catch (Exception e) {
            model.addAttribute("pageInfo", new PageInfo<>(List.of(), page, 10, 0));
            model.addAttribute("boardList", List.of());
            model.addAttribute("popularBoards", List.of());
            model.addAttribute("keyword", keyword != null ? keyword : "");
            model.addAttribute("category", category != null ? category : "");
            model.addAttribute("type", type);
            model.addAttribute("currentPage", page);
            model.addAttribute("error", "게시글을 불러오는 중 오류가 발생했습니다: " + e.getMessage());
        }
        model.addAttribute("boardTitle", currentBoardInfo.get("title"));
        model.addAttribute("boardDescription", currentBoardInfo.get("description"));
        model.addAttribute("pageTitle", currentBoardInfo.get("title"));
        if ("faq".equals(type)) {
            return "board/faq-list";
        } else if ("notice".equals(type)) {
            return "board/notice-list";
        } else if ("qna".equals(type)) {
            return "board/qna-list";
        }
        return "board/list";
    }
    @GetMapping("/write")
    public String writePage(Model model,
                          @RequestParam(defaultValue = "all") String type,
                          @RequestParam(required = false) String qaType,
                          HttpSession session,
                          RedirectAttributes redirectAttributes) {
        Long memberId = (Long) session.getAttribute("memberId");
        if (memberId == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        MemberDTO loginMember = (MemberDTO) session.getAttribute("loginMember");
        if (("notice".equals(type) || "faq".equals(type)) &&
            (loginMember == null || !"ADMIN".equals(loginMember.getRole()))) {
            redirectAttributes.addFlashAttribute("error", "해당 게시판에 글을 작성할 권한이 없습니다.");
            return "redirect:/board?type=" + type;
        }
        if ("qna".equals(type) && "ANSWER".equals(qaType) &&
            (loginMember == null || !"ADMIN".equals(loginMember.getRole()))) {
            redirectAttributes.addFlashAttribute("error", "답변하기는 관리자만 가능합니다.");
            return "redirect:/board?type=" + type;
        }
        BoardDTO boardDTO = new BoardDTO();
        boardDTO.setMemberId(memberId);
        Map<String, String> currentBoardInfo = boardTypeInfo.getOrDefault(type, boardTypeInfo.get("all"));
        String defaultCategory = currentBoardInfo.get("category");
        if (!defaultCategory.isEmpty()) {
            boardDTO.setCategory(defaultCategory);
        }
        if ("qna".equals(type) && qaType != null) {
            boardDTO.setQaType(qaType);
            if ("QUESTION".equals(qaType)) {
                boardDTO.setIsAnswered(false);
                boardDTO.setAnswerCount(0);
            }
        }
        model.addAttribute("boardDTO", boardDTO);
        model.addAttribute("type", type);
        model.addAttribute("qaType", qaType);
        model.addAttribute("boardTitle", currentBoardInfo.get("title"));
        String pageTitle = currentBoardInfo.get("title");
        if ("qna".equals(type) && qaType != null) {
            pageTitle += ("QUESTION".equals(qaType) ? " - 질문하기" : " - 답변하기");
        } else {
            pageTitle += " 작성";
        }
        model.addAttribute("pageTitle", pageTitle);
        if ("faq".equals(type)) {
            return "board/faq-write";
        } else if ("notice".equals(type)) {
            return "board/write";
        } else if ("qna".equals(type)) {
            return "board/write";
        } else if ("info".equals(type)) {
            return "board/write";
        }
        return "board/write";
    }
    @PostMapping("/write")
    public String writeBoard(@ModelAttribute BoardDTO boardDTO,
                           @RequestParam(defaultValue = "all") String type,
                           @RequestParam(required = false) String qaType,
                           HttpSession session,
                           RedirectAttributes redirectAttributes) {
        try {
            Long memberId = (Long) session.getAttribute("memberId");
            if (memberId == null) {
                redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
                return "redirect:/member/login";
            }
            MemberDTO loginMember = (MemberDTO) session.getAttribute("loginMember");
            if (("notice".equals(type) || "faq".equals(type)) &&
                (loginMember == null || !"ADMIN".equals(loginMember.getRole()))) {
                redirectAttributes.addFlashAttribute("error", "해당 게시판에 글을 작성할 권한이 없습니다.");
                return "redirect:/board?type=" + type;
            }
            if ("qna".equals(type) && "ANSWER".equals(qaType) &&
                (loginMember == null || !"ADMIN".equals(loginMember.getRole()))) {
                redirectAttributes.addFlashAttribute("error", "답변하기는 관리자만 가능합니다.");
                return "redirect:/board?type=" + type;
            }
            boardDTO.setMemberId(memberId);
            if ("qna".equals(type) && qaType != null) {
                boardDTO.setQaType(qaType);
                if ("QUESTION".equals(qaType)) {
                    boardDTO.setIsAnswered(false);
                    boardDTO.setAnswerCount(0);
                } else if ("ANSWER".equals(qaType)) {
                    boardDTO.setIsAnswered(null);
                    boardDTO.setAnswerCount(null);
                }
            }
            if (boardDTO.getIsNotice() == null) {
                boardDTO.setIsNotice(false);
            }
            if (boardDTO.getIsSecret() == null) {
                boardDTO.setIsSecret(false);
            }
            if (boardDTO.getIsActive() == null) {
                boardDTO.setIsActive(true);
            }
            if (boardDTO.getIsDeleted() == null) {
                boardDTO.setIsDeleted(false);
            }
            boardService.insertBoard(boardDTO);
            String successMessage = "게시글이 성공적으로 등록되었습니다.";
            if ("qna".equals(type) && qaType != null) {
                successMessage = "QUESTION".equals(qaType) ? "질문이 성공적으로 등록되었습니다." : "답변이 성공적으로 등록되었습니다.";
            }
            redirectAttributes.addFlashAttribute("message", successMessage);
            if ("all".equals(type)) {
                return "redirect:/board";
            } else {
                return "redirect:/board?type=" + type;
            }
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("error", "게시글 등록 중 오류가 발생했습니다: " + e.getMessage());
            String redirectUrl = "redirect:/board/write?type=" + type;
            if (qaType != null) {
                redirectUrl += "&qaType=" + qaType;
            }
            return redirectUrl;
        }
    }
    @GetMapping("/detail/{id}")
    public String detailPage(@PathVariable Long id,
                           @RequestParam(defaultValue = "all") String type,
                           @RequestParam(defaultValue = "1") int page,
                           Model model,
                           RedirectAttributes redirectAttributes) {
        try {
            BoardDTO board = boardService.getBoardById(id);
            boardService.incrementViewCount(id);
            BoardDTO prevBoard = boardService.getPreviousBoard(id);
            BoardDTO nextBoard = boardService.getNextBoard(id);
            model.addAttribute("board", board);
            model.addAttribute("prevBoard", prevBoard);
            model.addAttribute("nextBoard", nextBoard);
            model.addAttribute("type", type);
            model.addAttribute("page", page);
            model.addAttribute("pageTitle", board.getTitle());
            return "board/detail";
        } catch (Exception e) {
            log.error("게시글 상세보기 오류 - boardId: {}", id, e);
            redirectAttributes.addFlashAttribute("error", "게시글을 불러올 수 없습니다: " + e.getMessage());
            return "redirect:/board?type=" + type;
        }
    }
    @GetMapping("/edit/{id}")
    public String editPage(@PathVariable Long id,
                          @RequestParam(name = "type", required = false) String type,
                         HttpSession session,
                         Model model,
                         RedirectAttributes redirectAttributes) {
        try {
            Long memberId = (Long) session.getAttribute("memberId");
            if (memberId == null) {
                redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
                return "redirect:/member/login";
            }
            BoardDTO board = boardService.getBoardByIdIncludeDeleted(id);
            if (board == null) {
                redirectAttributes.addFlashAttribute("error", "수정할 게시글을 찾을 수 없습니다.");
                return "redirect:/board?type=" + (type != null ? type : "all");
            }
            if (board.getIsDeleted() != null && board.getIsDeleted()) {
                redirectAttributes.addFlashAttribute("error", "삭제된 게시글은 수정할 수 없습니다.");
                return "redirect:/board/detail/" + id + "?type=" + (type != null ? type : "all");
            }
            log.info("수정 페이지 접근 - 게시글 ID: {}, 작성자 ID: {}, 요청자 ID: {}", id, board.getMemberId(), memberId);
            MemberDTO loginMember = (MemberDTO) session.getAttribute("loginMember");
            boolean isAdmin = loginMember != null && "ADMIN".equals(loginMember.getRole());
            boolean isAuthor = board.getMemberId().equals(memberId);
            if (("NOTICE".equals(board.getCategory()) || "FAQ".equals(board.getCategory())) && !isAdmin) {
                log.warn("권한 없는 수정 시도 - 공지사항/FAQ 수정 권한 없음. 요청자: {}", memberId);
                redirectAttributes.addFlashAttribute("error", "해당 게시글을 수정할 권한이 없습니다.");
                return "redirect:/board/detail/" + id + "?type=" + (type != null ? type : "all");
            }
            if (!isAuthor && !isAdmin) {
                log.warn("권한 없는 수정 시도 - 게시글 작성자: {}, 요청자: {}", board.getMemberId(), memberId);
                redirectAttributes.addFlashAttribute("error", "작성자만 수정할 수 있습니다.");
                return "redirect:/board/detail/" + id + "?type=" + (type != null ? type : "all");
            }
            Map<String, String> currentBoardInfo = boardTypeInfo.getOrDefault(type != null ? type : "all", boardTypeInfo.get("all"));
            model.addAttribute("boardDTO", board);
            model.addAttribute("type", type != null ? type : "all");
            model.addAttribute("boardTitle", currentBoardInfo.get("title"));
            model.addAttribute("pageTitle", currentBoardInfo.get("title") + " 수정");
            return "board/edit";
        } catch (Exception e) {
            log.error("수정 페이지 로드 중 오류 발생 - boardId: {}", id, e);
            redirectAttributes.addFlashAttribute("error", "수정 페이지를 불러오는 중 오류가 발생했습니다: " + e.getMessage());
            return "redirect:/board?type=" + (type != null ? type : "all");
        }
    }
    @PostMapping("/edit/{id}")
    public String editBoard(@PathVariable Long id,
                          @ModelAttribute BoardDTO boardDTO,
                          @RequestParam(defaultValue = "all") String type,
                          HttpSession session,
                          RedirectAttributes redirectAttributes) {
        try {
            Long memberId = (Long) session.getAttribute("memberId");
            if (memberId == null) {
                redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
                return "redirect:/member/login";
            }
            BoardDTO existingBoard = boardService.getBoardByIdIncludeDeleted(id);
            if (existingBoard == null) {
                redirectAttributes.addFlashAttribute("error", "수정할 게시글을 찾을 수 없습니다.");
                return getRedirectUrl(type);
            }
            if (existingBoard.getIsDeleted() != null && existingBoard.getIsDeleted()) {
                redirectAttributes.addFlashAttribute("error", "삭제된 게시글은 수정할 수 없습니다.");
                return getRedirectUrl(type);
            }
            log.info("수정 요청 - 게시글 ID: {}, 작성자 ID: {}, 요청자 ID: {}", id, existingBoard.getMemberId(), memberId);
            MemberDTO loginMember = (MemberDTO) session.getAttribute("loginMember");
            boolean isAdmin = loginMember != null && "ADMIN".equals(loginMember.getRole());
            boolean isAuthor = existingBoard.getMemberId().equals(memberId);
            if (("NOTICE".equals(existingBoard.getCategory()) || "FAQ".equals(existingBoard.getCategory())) && !isAdmin) {
                log.warn("권한 없는 수정 시도 - 공지사항/FAQ 수정 권한 없음. 요청자: {}", memberId);
                redirectAttributes.addFlashAttribute("error", "해당 게시글을 수정할 권한이 없습니다.");
                return "redirect:/board/detail/" + id + "?type=" + type;
            }
            if (!isAuthor && !isAdmin) {
                log.warn("권한 없는 수정 시도 - 게시글 작성자: {}, 요청자: {}", existingBoard.getMemberId(), memberId);
                redirectAttributes.addFlashAttribute("error", "작성자만 수정할 수 있습니다.");
                return "redirect:/board/detail/" + id + "?type=" + type;
            }
            boardDTO.setBoardId(id);
            boardDTO.setMemberId(memberId);
            if (boardDTO.getIsNotice() == null) {
                boardDTO.setIsNotice(false);
            }
            if (boardDTO.getIsSecret() == null) {
                boardDTO.setIsSecret(false);
            }
            if (boardDTO.getIsActive() == null) {
                boardDTO.setIsActive(true);
            }
            if (boardDTO.getIsDeleted() == null) {
                boardDTO.setIsDeleted(false);
            }
            boardService.updateBoard(boardDTO);
            log.info("수정 완료 - 게시글 ID: {}", id);
            redirectAttributes.addFlashAttribute("message", "✅ 게시글이 성공적으로 수정되었습니다.");
            return "redirect:/board/detail/" + id + "?type=" + type;
        } catch (Exception e) {
            log.error("수정 처리 중 오류 발생 - boardId: {}", id, e);
            redirectAttributes.addFlashAttribute("error", "❌ 게시글 수정 중 오류가 발생했습니다: " + e.getMessage());
            return "redirect:/board/edit/" + id + "?type=" + type;
        }
    }
    @PostMapping("/delete/{id}")
    public String deleteBoard(@PathVariable Long id,
                             @RequestParam(name = "type", required = false) String type,
                            HttpSession session,
                            RedirectAttributes redirectAttributes) {
        try {
            log.info("🚀 삭제 요청 시작 - 게시글 ID: {}", id);
            Long memberId = (Long) session.getAttribute("memberId");
            log.info("🔍 세션 확인 - memberId: {}", memberId);
            if (memberId == null) {
                log.warn("❌ 로그인 안됨 - 삭제 실패");
                redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
                return "redirect:/member/login";
            }
            BoardDTO board = boardService.getBoardByIdIncludeDeleted(id);
            log.info("🔍 게시글 조회 결과 - board: {}", board != null ? "존재함" : "없음");
            if (board == null) {
                log.warn("❌ 게시글 없음 - 삭제 실패");
                redirectAttributes.addFlashAttribute("error", "게시글을 찾을 수 없습니다.");
                return getRedirectUrl(type);
            }
            log.info("🔍 권한 체크 - 게시글 작성자: {}, 요청자: {}", board.getMemberId(), memberId);
            log.info("삭제 요청 - 게시글 ID: {}, 작성자 ID: {}, 요청자 ID: {}", id, board.getMemberId(), memberId);
            MemberDTO loginMember = (MemberDTO) session.getAttribute("loginMember");
            boolean isAdmin = loginMember != null && "ADMIN".equals(loginMember.getRole());
            boolean isAuthor = board.getMemberId().equals(memberId);
            if (("NOTICE".equals(board.getCategory()) || "FAQ".equals(board.getCategory())) && !isAdmin) {
                log.warn("❌ 권한 없는 삭제 시도 - 공지사항/FAQ 삭제 권한 없음. 요청자: {}", memberId);
                redirectAttributes.addFlashAttribute("error", "해당 게시글을 삭제할 권한이 없습니다.");
                return getRedirectUrl(type);
            }
            if (!isAuthor && !isAdmin) {
                log.warn("❌ 권한 없는 삭제 시도 - 게시글 작성자: {}, 요청자: {}", board.getMemberId(), memberId);
                redirectAttributes.addFlashAttribute("error", "작성자만 삭제할 수 있습니다.");
                return getRedirectUrl(type);
            }
            log.info("✅ 권한 체크 통과 - 삭제 진행");
            Map<String, Object> deleteResult = boardService.deleteBoard(id);
            Boolean success = (Boolean) deleteResult.get("success");
            String message = (String) deleteResult.get("message");
            log.info("삭제 결과 - 성공: {}, 메시지: {}", success, message);
            if (success) {
                redirectAttributes.addFlashAttribute("message", "✅ " + message);
            } else {
                redirectAttributes.addFlashAttribute("error", "❌ " + message);
            }
            return getRedirectUrl(type);
        } catch (Exception e) {
            log.error("게시글 삭제 처리 중 오류 발생 - boardId: {}", id, e);
            redirectAttributes.addFlashAttribute("error", "❌ 게시글 삭제 중 오류가 발생했습니다: " + e.getMessage());
            return getRedirectUrl(type);
        }
    }
    private String getRedirectUrl(String type) {
        if ("all".equals(type)) {
            return "redirect:/board";
        } else {
            return "redirect:/board?type=" + type;
        }
    }
    @PostMapping("/like/{id}")
    @ResponseBody
    public Map<String, Object> toggleLike(@PathVariable Long id,
                                        @RequestParam String action) {
        Map<String, Object> result = new HashMap<>();
        try {
            if ("like".equals(action)) {
                boardService.incrementLikeCount(id);
                result.put("success", true);
                result.put("message", "추천되었습니다.");
            } else if ("dislike".equals(action)) {
                boardService.decrementLikeCount(id);
                result.put("success", true);
                result.put("message", "추천이 취소되었습니다.");
            }
        } catch (Exception e) {
            result.put("success", false);
            result.put("message", "처리 중 오류가 발생했습니다.");
        }
        return result;
    }
    @GetMapping("/debug/board/{id}")
    @ResponseBody
    public Map<String, Object> debugBoardStatus(@PathVariable Long id) {
        Map<String, Object> result = new HashMap<>();
        try {
            log.info("🔧 디버그 API 호출 - boardId: {}", id);
            BoardDTO board = boardService.getBoardByIdIncludeDeleted(id);
            if (board == null) {
                result.put("error", "게시글을 찾을 수 없습니다");
                log.warn("🔧 디버그 - 게시글을 찾을 수 없음: {}", id);
                return result;
            }
            result.put("boardId", board.getBoardId());
            result.put("title", board.getTitle());
            result.put("isDeleted", board.getIsDeleted());
            result.put("isDeletedType", board.getIsDeleted() != null ? board.getIsDeleted().getClass().getSimpleName() : "null");
            result.put("isDeletedValue", board.getIsDeleted() != null ? board.getIsDeleted().toString() : "null");
            result.put("isActive", board.getIsActive());
            result.put("isActiveType", board.getIsActive() != null ? board.getIsActive().getClass().getSimpleName() : "null");
            result.put("createdAt", board.getCreatedAt());
            boolean wouldBeDeleted = board.getIsDeleted() != null && board.getIsDeleted();
            result.put("wouldBeConsideredDeleted", wouldBeDeleted);
            log.info("🔧 디버그 결과 - boardId: {}, isDeleted: {}, wouldBeDeleted: {}",
                id, board.getIsDeleted(), wouldBeDeleted);
            return result;
        } catch (Exception e) {
            log.error("🔧 디버그 API 오류 - boardId: {}", id, e);
            result.put("error", "오류 발생: " + e.getMessage());
            return result;
        }
    }
    private MemberDTO getCurrentMember(HttpSession session) {
        return (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
    }
    private Long getCurrentMemberId(HttpSession session) {
        return (Long) session.getAttribute("memberId");
    }
    private boolean isAdmin(HttpSession session) {
        MemberDTO loginMember = getCurrentMember(session);
        return loginMember != null && "ADMIN".equals(loginMember.getRole());
    }
    private boolean hasEditPermission(HttpSession session, Long authorMemberId) {
        Long currentMemberId = getCurrentMemberId(session);
        return (currentMemberId != null && currentMemberId.equals(authorMemberId)) || isAdmin(session);
    }
}
````

## File: src/main/java/com/example/carelink/controller/ReviewController.java
````java
package com.example.carelink.controller;
import com.example.carelink.common.PageInfo;
import com.example.carelink.common.Constants;
import com.example.carelink.dto.ReviewDTO;
import com.example.carelink.dto.FacilityDTO;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.service.ReviewService;
import com.example.carelink.service.FacilityService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;
import javax.servlet.http.HttpSession;
import java.util.List;
import java.util.Map;
import java.util.HashMap;
@Slf4j
@Controller
@RequestMapping("/review")
@RequiredArgsConstructor
public class ReviewController {
    private final ReviewService reviewService;
    private final FacilityService facilityService;
    @GetMapping
    public String listPage(Model model,
                          @RequestParam(defaultValue = "1") int page,
                          @RequestParam(defaultValue = "") String keyword,
                          @RequestParam(required = false) Integer minRating,
                          @RequestParam(required = false) Long facilityId) {
        try {
            log.info("리뷰 목록 페이지 접속 - page: {}, keyword: {}, minRating: {}, facilityId: {}",
                    page, keyword, minRating, facilityId);
            PageInfo<ReviewDTO> pageInfo = reviewService.getReviewList(page, keyword, minRating, facilityId);
            model.addAttribute("pageInfo", pageInfo);
            model.addAttribute("reviewList", pageInfo.getList());
            model.addAttribute("keyword", keyword != null ? keyword : "");
            model.addAttribute("minRating", minRating);
            model.addAttribute("facilityId", facilityId);
            model.addAttribute("currentPage", page);
            model.addAttribute("pageTitle", "시설 리뷰");
            if (facilityId != null) {
                try {
                    FacilityDTO facility = facilityService.getFacilityById(facilityId);
                    model.addAttribute("selectedFacility", facility);
                    model.addAttribute("pageTitle", facility.getFacilityName() + " 리뷰");
                } catch (Exception e) {
                    log.warn("시설 정보 조회 실패 - facilityId: {}", facilityId, e);
                }
            }
            return "review/list";
        } catch (Exception e) {
            log.error("리뷰 목록 조회 중 오류 발생", e);
            model.addAttribute("pageInfo", new PageInfo<>(List.of(), page, 10, 0));
            model.addAttribute("reviewList", List.of());
            model.addAttribute("keyword", keyword != null ? keyword : "");
            model.addAttribute("minRating", minRating);
            model.addAttribute("facilityId", facilityId);
            model.addAttribute("currentPage", page);
            model.addAttribute("error", "리뷰를 불러오는 중 오류가 발생했습니다: " + e.getMessage());
            return "review/list";
        }
    }
    @GetMapping("/write")
    public String writePage(Model model,
                           @RequestParam(required = false) Long facilityId,
                           HttpSession session,
                           RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            log.warn("로그인하지 않은 사용자의 리뷰 작성 페이지 접속 시도");
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        try {
            log.info("리뷰 작성 페이지 접속 - facilityId: {}", facilityId);
            ReviewDTO reviewDTO = new ReviewDTO();
            List<FacilityDTO> facilityList = facilityService.getAllActiveFacilities();
            log.info("활성화된 시설 목록 조회 완료 - 조회된 건수: {}", facilityList.size());
            if (facilityId != null) {
                FacilityDTO selectedFacility = facilityService.getFacilityById(facilityId);
                if (selectedFacility != null) {
                    log.info("선택된 시설 정보 조회 성공 - facilityId: {}, facilityName: {}, status: {}",
                            facilityId, selectedFacility.getFacilityName(), selectedFacility.getStatus());
                    if ("삭제됨".equals(selectedFacility.getStatus())) {
                        model.addAttribute("error", "선택하신 시설은 삭제되어 리뷰를 작성할 수 없습니다.");
                    } else if ("승인대기".equals(selectedFacility.getStatus())) {
                        model.addAttribute("error", "선택하신 시설은 아직 승인되지 않아 리뷰를 작성할 수 없습니다.");
                    } else {
                        reviewDTO.setFacilityId(facilityId);
                        model.addAttribute("selectedFacility", selectedFacility);
                    }
                } else {
                    log.warn("선택된 시설을 찾을 수 없음 - facilityId: {}", facilityId);
                    model.addAttribute("error", "선택하신 시설을 찾을 수 없습니다.");
                }
            }
            model.addAttribute("reviewDTO", reviewDTO);
            model.addAttribute("facilityList", facilityList);
            model.addAttribute("pageTitle", "리뷰 작성");
            return "review/write";
        } catch (Exception e) {
            log.error("리뷰 작성 페이지 로딩 중 오류 발생", e);
            model.addAttribute("error", "리뷰 작성 페이지를 불러오는 중 오류가 발생했습니다: " + e.getMessage());
            return "review/write";
        }
    }
    @PostMapping("/write")
    public String writeReview(@ModelAttribute ReviewDTO reviewDTO,
                             HttpSession session,
                             RedirectAttributes redirectAttributes) {
        try {
            log.info("리뷰 등록 요청 - title: {}, facilityId: {}", reviewDTO.getTitle(), reviewDTO.getFacilityId());
            MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (loginMember == null) {
                log.warn("로그인하지 않은 사용자의 리뷰 작성 시도");
                redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
                return "redirect:/member/login";
            }
            reviewDTO.setMemberId(loginMember.getMemberId());
            log.info("리뷰 작성자 설정 - memberId: {}, userId: {}", loginMember.getMemberId(), loginMember.getUserId());
            if (reviewDTO.getFacilityId() == null) {
                log.warn("시설이 선택되지 않음");
                redirectAttributes.addFlashAttribute("error", "시설을 선택해주세요.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/write";
            }
            FacilityDTO facility = facilityService.getFacilityById(reviewDTO.getFacilityId());
            if (facility == null) {
                log.warn("선택된 시설을 찾을 수 없음 - facilityId: {}", reviewDTO.getFacilityId());
                redirectAttributes.addFlashAttribute("error", "선택한 시설을 찾을 수 없습니다.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/write";
            }
            if (!facilityService.validateFacilityStatus(facility)) {
                log.warn("유효하지 않은 시설 상태 - facilityId: {}, status: {}",
                        facility.getFacilityId(), facility.getStatus());
                redirectAttributes.addFlashAttribute("error", facility.getStatusMessage());
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/write";
            }
            log.info("시설 정보 확인 완료 - facilityId: {}, facilityName: {}, status: {}",
                    facility.getFacilityId(), facility.getFacilityName(), facility.getStatus());
            if (reviewDTO.getTitle() == null || reviewDTO.getTitle().trim().isEmpty()) {
                log.warn("제목이 입력되지 않음");
                redirectAttributes.addFlashAttribute("error", "제목을 입력해주세요.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/write?facilityId=" + reviewDTO.getFacilityId();
            }
            if (reviewDTO.getContent() == null || reviewDTO.getContent().trim().length() < 10) {
                log.warn("내용이 10자 미만임");
                redirectAttributes.addFlashAttribute("error", "내용을 10자 이상 입력해주세요.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/write?facilityId=" + reviewDTO.getFacilityId();
            }
            if (reviewDTO.getRating() == null || reviewDTO.getRating() < 1 || reviewDTO.getRating() > 5) {
                log.warn("평점이 유효하지 않음 - rating: {}", reviewDTO.getRating());
                redirectAttributes.addFlashAttribute("error", "평점을 선택해주세요.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/write?facilityId=" + reviewDTO.getFacilityId();
            }
            reviewService.insertReview(reviewDTO);
            log.info("리뷰 등록 성공 - reviewId: {}", reviewDTO.getReviewId());
            redirectAttributes.addFlashAttribute("message", "리뷰가 성공적으로 등록되었습니다.");
            return "redirect:/review";
        } catch (Exception e) {
            log.error("리뷰 등록 중 오류 발생", e);
            redirectAttributes.addFlashAttribute("error", "리뷰 등록 중 오류가 발생했습니다: " + e.getMessage());
            redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
            return "redirect:/review/write?facilityId=" + reviewDTO.getFacilityId();
        }
    }
    @GetMapping("/detail/{id}")
    public String detailPage(@PathVariable Long id, Model model, HttpSession session) {
        try {
            ReviewDTO review = reviewService.getReviewById(id);
            if (review == null) {
                model.addAttribute("error", "리뷰를 찾을 수 없습니다.");
                return "redirect:/review";
            }
            reviewService.incrementViewCount(id);
            List<ReviewDTO> otherReviews = reviewService.getReviewsByFacilityId(review.getFacilityId())
                    .stream()
                    .filter(r -> !r.getReviewId().equals(id))
                    .limit(5)
                    .collect(java.util.stream.Collectors.toList());
            model.addAttribute("review", review);
            model.addAttribute("otherReviews", otherReviews);
            model.addAttribute("pageTitle", review.getTitle());
            model.addAttribute("currentMemberId", getCurrentMemberId(session));
            return "review/detail";
        } catch (Exception e) {
            log.error("리뷰 상세보기 중 오류 발생 - reviewId: {}", id, e);
            model.addAttribute("error", "리뷰를 불러올 수 없습니다: " + e.getMessage());
            return "redirect:/review";
        }
    }
    @GetMapping("/edit/{id}")
    public String editPage(@PathVariable Long id, Model model, HttpSession session, RedirectAttributes redirectAttributes) {
        try {
            ReviewDTO review = reviewService.getReviewById(id);
            if (review == null) {
                redirectAttributes.addFlashAttribute("error", "수정할 리뷰를 찾을 수 없습니다.");
                return "redirect:/review";
            }
            if (!hasEditPermission(session, review.getMemberId())) {
                redirectAttributes.addFlashAttribute("error", "작성자 또는 관리자만 수정할 수 있습니다.");
                return "redirect:/review/detail/" + id;
            }
            model.addAttribute("reviewDTO", review);
            model.addAttribute("pageTitle", "리뷰 수정");
            return "review/edit";
        } catch (Exception e) {
            log.error("리뷰 수정 페이지 로딩 중 오류 발생 - reviewId: {}", id, e);
            redirectAttributes.addFlashAttribute("error", "수정 페이지를 불러오는 중 오류가 발생했습니다: " + e.getMessage());
            return "redirect:/review";
        }
    }
    @PostMapping("/update")
    public String updateReview(@ModelAttribute ReviewDTO reviewDTO, HttpSession session, RedirectAttributes redirectAttributes) {
        try {
            log.info("리뷰 수정 요청 - reviewId: {}, title: {}", reviewDTO.getReviewId(), reviewDTO.getTitle());
            ReviewDTO existingReview = reviewService.getReviewById(reviewDTO.getReviewId());
            if (existingReview == null) {
                redirectAttributes.addFlashAttribute("error", "수정할 리뷰를 찾을 수 없습니다.");
                return "redirect:/review";
            }
            if (!hasEditPermission(session, existingReview.getMemberId())) {
                redirectAttributes.addFlashAttribute("error", "작성자 또는 관리자만 수정할 수 있습니다.");
                return "redirect:/review/detail/" + reviewDTO.getReviewId();
            }
            if (reviewDTO.getTitle() == null || reviewDTO.getTitle().trim().isEmpty()) {
                redirectAttributes.addFlashAttribute("error", "제목을 입력해주세요.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/edit/" + reviewDTO.getReviewId();
            }
            if (reviewDTO.getContent() == null || reviewDTO.getContent().trim().length() < 10) {
                redirectAttributes.addFlashAttribute("error", "내용을 10자 이상 입력해주세요.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/edit/" + reviewDTO.getReviewId();
            }
            if (reviewDTO.getRating() == null || reviewDTO.getRating() < 1 || reviewDTO.getRating() > 5) {
                redirectAttributes.addFlashAttribute("error", "평점을 선택해주세요.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/edit/" + reviewDTO.getReviewId();
            }
            reviewDTO.setFacilityId(existingReview.getFacilityId());
            reviewDTO.setMemberId(existingReview.getMemberId());
            reviewDTO.setViewCount(existingReview.getViewCount());
            reviewDTO.setLikeCount(existingReview.getLikeCount());
            reviewDTO.setDislikeCount(existingReview.getDislikeCount());
            reviewDTO.setCreatedAt(existingReview.getCreatedAt());
            reviewService.updateReview(reviewDTO);
            log.info("리뷰 수정 성공 - reviewId: {}", reviewDTO.getReviewId());
            redirectAttributes.addFlashAttribute("message", "리뷰가 성공적으로 수정되었습니다.");
            return "redirect:/review/detail/" + reviewDTO.getReviewId();
        } catch (Exception e) {
            log.error("리뷰 수정 중 오류 발생 - reviewId: {}", reviewDTO.getReviewId(), e);
            redirectAttributes.addFlashAttribute("error", "리뷰 수정 중 오류가 발생했습니다: " + e.getMessage());
            redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
            return "redirect:/review/edit/" + reviewDTO.getReviewId();
        }
    }
    @PostMapping("/delete/{id}")
    public String deleteReview(@PathVariable Long id, HttpSession session, RedirectAttributes redirectAttributes) {
        try {
            ReviewDTO existingReview = reviewService.getReviewById(id);
            if (existingReview == null) {
                redirectAttributes.addFlashAttribute("error", "삭제할 리뷰를 찾을 수 없습니다.");
                return "redirect:/review";
            }
            if (!hasEditPermission(session, existingReview.getMemberId())) {
                redirectAttributes.addFlashAttribute("error", "작성자 또는 관리자만 삭제할 수 있습니다.");
                return "redirect:/review/detail/" + id;
            }
            reviewService.deleteReview(id);
            redirectAttributes.addFlashAttribute("message", "리뷰가 성공적으로 삭제되었습니다.");
        } catch (Exception e) {
            log.error("리뷰 삭제 중 오류 발생 - reviewId: {}", id, e);
            redirectAttributes.addFlashAttribute("error", "리뷰 삭제 중 오류가 발생했습니다: " + e.getMessage());
        }
        return "redirect:/review";
    }
    @PostMapping("/report/{id}")
    @ResponseBody
    public Map<String, Object> reportReview(@PathVariable Long id, @RequestBody Map<String, String> request, HttpSession session) {
        Map<String, Object> result = new HashMap<>();
        try {
            String reason = request.get("reason");
            if (reason == null || reason.trim().isEmpty()) {
                result.put("success", false);
                result.put("message", "신고 사유를 입력해주세요.");
                return result;
            }
            ReviewDTO review = reviewService.getReviewById(id);
            if (review == null) {
                result.put("success", false);
                result.put("message", "신고할 리뷰를 찾을 수 없습니다.");
                return result;
            }
            Long currentMemberId = getCurrentMemberId(session);
            if (review.getMemberId().equals(currentMemberId)) {
                result.put("success", false);
                result.put("message", "본인이 작성한 리뷰는 신고할 수 없습니다.");
                return result;
            }
            log.info("리뷰 신고 접수 - reviewId: {}, reason: {}, reporter: {}", id, reason, currentMemberId);
            result.put("success", true);
            result.put("message", "신고가 접수되었습니다. 검토 후 적절한 조치를 취하겠습니다.");
        } catch (Exception e) {
            log.error("리뷰 신고 처리 중 오류 발생 - reviewId: {}", id, e);
            result.put("success", false);
            result.put("message", "신고 처리 중 오류가 발생했습니다.");
        }
        return result;
    }
    @PostMapping("/view/{id}")
    @ResponseBody
    public Map<String, Object> incrementViewCount(@PathVariable Long id) {
        Map<String, Object> result = new HashMap<>();
        try {
            reviewService.incrementViewCount(id);
            result.put("success", true);
        } catch (Exception e) {
            log.error("조회수 증가 중 오류 발생 - reviewId: {}", id, e);
            result.put("success", false);
            result.put("message", "조회수 업데이트 중 오류가 발생했습니다.");
        }
        return result;
    }
    @GetMapping("/api/facility/{facilityId}")
    @ResponseBody
    public Map<String, Object> getReviewsByFacility(@PathVariable Long facilityId,
                                                   @RequestParam(defaultValue = "1") int page) {
        Map<String, Object> result = new HashMap<>();
        try {
            List<ReviewDTO> reviews = reviewService.getReviewsByFacilityId(facilityId);
            Double averageRating = reviewService.getAverageRating(facilityId);
            result.put("success", true);
            result.put("reviews", reviews);
            result.put("averageRating", averageRating);
            result.put("reviewCount", reviews.size());
        } catch (Exception e) {
            result.put("success", false);
            result.put("message", "리뷰를 불러오는 중 오류가 발생했습니다.");
        }
        return result;
    }
    @PostMapping("/like/{id}")
    @ResponseBody
    public Map<String, Object> likeReview(@PathVariable Long id) {
        Map<String, Object> result = new HashMap<>();
        try {
            reviewService.likeReview(id);
            ReviewDTO review = reviewService.getReviewById(id);
            result.put("success", true);
            result.put("likeCount", review.getLikeCount());
            result.put("message", "추천하였습니다.");
        } catch (Exception e) {
            result.put("success", false);
            result.put("message", "추천 처리 중 오류가 발생했습니다.");
        }
        return result;
    }
    @PostMapping("/dislike/{id}")
    @ResponseBody
    public Map<String, Object> dislikeReview(@PathVariable Long id) {
        Map<String, Object> result = new HashMap<>();
        try {
            reviewService.dislikeReview(id);
            ReviewDTO review = reviewService.getReviewById(id);
            result.put("success", true);
            result.put("dislikeCount", review.getDislikeCount());
            result.put("message", "비추천하였습니다.");
        } catch (Exception e) {
            result.put("success", false);
            result.put("message", "비추천 처리 중 오류가 발생했습니다.");
        }
        return result;
    }
    private Long getCurrentMemberId(HttpSession session) {
        return (Long) session.getAttribute("memberId");
    }
    private boolean isAdmin(HttpSession session) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        return loginMember != null && "ADMIN".equals(loginMember.getRole());
    }
    private boolean hasEditPermission(HttpSession session, Long authorMemberId) {
        Long currentMemberId = getCurrentMemberId(session);
        return (currentMemberId != null && currentMemberId.equals(authorMemberId)) || isAdmin(session);
    }
}
````

## File: src/main/java/com/example/carelink/dto/FacilityDTO.java
````java
package com.example.carelink.dto;
import com.example.carelink.common.BaseDTO;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.NoArgsConstructor;
import lombok.AllArgsConstructor;
@Data
@EqualsAndHashCode(callSuper = true)
@NoArgsConstructor
@AllArgsConstructor
public class FacilityDTO extends BaseDTO {
    private Long facilityId;
    private String facilityName;
    private String facilityType;
    private String address;
    private String detailAddress;
    private String phone;
    private Double longitude;
    private Double latitude;
    private String description;
    private String facilityImage;
    private String facilityImageAltText;
    private String homepage;
    private Integer capacity;
    private Integer currentOccupancy;
    private String operatingHours;
    private String features;
    private Boolean isApproved;
    private Boolean isDeleted;
    private String approvalStatus;
    private String rejectionReason;
    private Long registeredMemberId;
    private String registeredMemberName;
    private String registeredUserName;
    private Double averageRating;
    private Integer reviewCount;
    private Integer gradeRating;
    private String region;
    private Double swLat;
    private Double swLng;
    private Double neLat;
    private Double neLng;
    private String status;
    public boolean isNormalStatus() {
        return "정상".equals(status);
    }
    public boolean isDeletedStatus() {
        return "삭제됨".equals(status);
    }
    public boolean isPendingStatus() {
        return "승인대기".equals(status);
    }
    public String getStatusMessage() {
        if (isDeletedStatus()) {
            return "삭제된 시설입니다.";
        } else if (isPendingStatus()) {
            return "승인 대기 중인 시설입니다.";
        }
        return "";
    }
}
````

## File: src/main/java/com/example/carelink/dto/MemberDTO.java
````java
package com.example.carelink.dto;
import com.example.carelink.common.BaseDTO;
import com.example.carelink.validation.groups.OnFacilityJoin;
import lombok.Data;
import lombok.EqualsAndHashCode;
import org.springframework.web.multipart.MultipartFile;
import javax.validation.constraints.Email;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.Pattern;
import javax.validation.constraints.Size;
@Data
@EqualsAndHashCode(callSuper = true)
public class MemberDTO extends BaseDTO {
    private Long memberId;
    @NotBlank(message = "사용자 ID는 필수입니다.")
    @Pattern(regexp = "^[a-zA-Z0-9]{4,20}$", message = "사용자 ID는 4-20자의 영문, 숫자만 가능합니다.")
    private String userId;
    @NotBlank(message = "비밀번호는 필수입니다.")
    @Pattern(regexp = "^(?=.*[A-Za-z])(?=.*\\d)[A-Za-z\\d@$!%*#?&]{8,20}$",
            message = "비밀번호는 8-20자의 영문, 숫자, 특수문자를 1개 이상 포함해야 합니다.")
    private String password;
    @NotBlank(message = "이름은 필수입니다.")
    @Size(max = 50, message = "이름은 50자를 초과할 수 없습니다.")
    private String name;
    @NotBlank(message = "이메일은 필수 입력 항목입니다.")
    @Email(message = "올바른 이메일 형식이 아닙니다.")
    @Size(max = 100, message = "이메일은 100자를 초과할 수 없습니다.")
    private String email;
    @Pattern(regexp = "^$|^01(?:0|1|[6-9])-(?:\\d{3}|\\d{4})-\\d{4}$",
            message = "올바른 휴대폰 번호 형식이 아닙니다.")
    private String phone;
    private String role;
    @NotBlank(message = "시설 주소는 필수 입력 항목입니다.", groups = OnFacilityJoin.class)
    private String address;
    private String profileImage;
    private String profileImageAltText;
    private String facilityName;
    private String facilityType;
    private String facilityAddress;
    private String detailAddress;
    private String facilityPhone;
    private String description;
    private String homepage;
    private Integer capacity;
    private String operatingHours;
    private String features;
    private Double latitude;
    private Double longitude;
    private Boolean isActive;
    private Boolean isDeleted;
    private transient String passwordConfirm;
    private int loginFailCount;
    private java.time.LocalDateTime lastLoginAt;
    private transient MultipartFile profileImageFile;
}
````

## File: src/main/java/com/example/carelink/service/FacilityImageService.java
````java
package com.example.carelink.service;
import com.example.carelink.dao.FacilityImageMapper;
import com.example.carelink.dao.FacilityMapper;
import com.example.carelink.dto.FacilityImageDTO;
import com.example.carelink.common.Constants;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.multipart.MultipartFile;
import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.UUID;
@Service
public class FacilityImageService {
    private final FacilityImageMapper facilityImageMapper;
    private final FacilityMapper facilityMapper;
    private static final Logger log = LoggerFactory.getLogger(FacilityImageService.class);
    @Autowired
    public FacilityImageService(FacilityImageMapper facilityImageMapper, FacilityMapper facilityMapper) {
        this.facilityImageMapper = facilityImageMapper;
        this.facilityMapper = facilityMapper;
    }
    @Transactional(readOnly = true)
    public List<FacilityImageDTO> getImagesByFacilityId(Long facilityId) {
        log.info("시설 이미지 목록 조회 시작 - facilityId: {}", facilityId);
        List<FacilityImageDTO> images = facilityImageMapper.getImagesByFacilityId(facilityId);
        log.info("시설 이미지 목록 조회 완료 - facilityId: {}, 이미지 수: {}", facilityId, images.size());
        return images;
    }
    @Transactional(readOnly = true)
    public FacilityImageDTO getMainImageByFacilityId(Long facilityId) {
        log.info("시설 메인 이미지 조회 - facilityId: {}", facilityId);
        return facilityImageMapper.getMainImageByFacilityId(facilityId);
    }
    @Transactional
    public void saveFacilityImages(Long facilityId, List<MultipartFile> imageFiles, List<String> altTexts) {
        try {
            log.info("📸 다중 시설 이미지 저장 시작 - facilityId: {}, 요청 이미지 수: {}", facilityId, imageFiles.size());
            int existingImageCount = facilityImageMapper.countImagesByFacilityId(facilityId);
            List<MultipartFile> validFiles = new ArrayList<>();
            for (MultipartFile file : imageFiles) {
                if (!file.isEmpty() && validFiles.size() + existingImageCount < Constants.MAX_FACILITY_IMAGES) {
                    validateImageFile(file);
                    validFiles.add(file);
                }
            }
            if (validFiles.isEmpty()) {
                throw new IllegalArgumentException("저장할 유효한 이미지 파일이 없습니다.");
            }
            if (existingImageCount + validFiles.size() > Constants.MAX_FACILITY_IMAGES) {
                log.warn("⚠️ 일부 이미지는 5장 제한으로 인해 저장되지 않습니다. 기존: {}장, 요청: {}장, 저장 가능: {}장",
                    existingImageCount, imageFiles.size(), validFiles.size());
            }
            log.info("📊 이미지 저장 계획 - 기존: {}장, 새로 저장: {}장, 총: {}장",
                existingImageCount, validFiles.size(), existingImageCount + validFiles.size());
            for (int i = 0; i < validFiles.size(); i++) {
                MultipartFile file = validFiles.get(i);
                String altText = (altTexts != null && i < altTexts.size()) ? altTexts.get(i) : null;
                String imagePath = saveImageFile(file, facilityId.toString(), existingImageCount + i);
                FacilityImageDTO imageDTO = new FacilityImageDTO();
                imageDTO.setFacilityId(facilityId);
                imageDTO.setImagePath(imagePath);
                imageDTO.setImageAltText(altText);
                imageDTO.setImageOrder(existingImageCount + i);
                imageDTO.setIsMainImage(existingImageCount == 0 && i == 0);
                facilityImageMapper.insertFacilityImage(imageDTO);
                log.info("✅ 시설 이미지 저장 완료 - order: {}, path: {}", existingImageCount + i, imagePath);
            }
            updateFacilityMainImageInfo(facilityId);
            log.info("🎉 다중 시설 이미지 저장 완료 - facilityId: {}, 총 {}장 저장", facilityId, validFiles.size());
        } catch (Exception e) {
            log.error("❌ 시설 이미지 저장 중 오류 발생 - facilityId: {}", facilityId, e);
            throw new RuntimeException("시설 이미지 저장에 실패했습니다.", e);
        }
    }
    @Transactional
    public FacilityImageDTO saveSingleFacilityImage(Long facilityId, MultipartFile imageFile, String altText, Integer imageOrder) {
        return saveSingleFacilityImage(facilityId, imageFile, altText, imageOrder, null);
    }
    @Transactional
    public FacilityImageDTO saveSingleFacilityImage(Long facilityId, MultipartFile imageFile, String altText, Integer imageOrder, String customFileName) {
        try {
            log.info("📸 단일 시설 이미지 저장 시작 - facilityId: {}, order: {}, customFileName: '{}'", facilityId, imageOrder, customFileName);
            if (imageFile.isEmpty()) {
                throw new IllegalArgumentException("업로드된 이미지 파일이 비어있습니다.");
            }
            int existingImageCount = facilityImageMapper.countImagesByFacilityId(facilityId);
            if (existingImageCount >= Constants.MAX_FACILITY_IMAGES) {
                throw new IllegalArgumentException(String.format("시설 이미지는 최대 %d장까지만 등록할 수 있습니다. 현재 %d장 등록됨",
                    Constants.MAX_FACILITY_IMAGES, existingImageCount));
            }
            validateImageFile(imageFile);
            String imagePath = saveImageFileWithCustomName(imageFile, facilityId.toString(),
                imageOrder != null ? imageOrder : existingImageCount, customFileName);
            FacilityImageDTO imageDTO = new FacilityImageDTO();
            imageDTO.setFacilityId(facilityId);
            imageDTO.setImagePath(imagePath);
            imageDTO.setImageAltText(altText);
            imageDTO.setImageOrder(imageOrder != null ? imageOrder : existingImageCount);
            imageDTO.setIsMainImage(existingImageCount == 0);
            facilityImageMapper.insertFacilityImage(imageDTO);
            log.info("✅ facility_images 테이블에 저장 완료 - imageId: {}, path: {}, 현재 총 {}장",
                imageDTO.getImageId(), imagePath, existingImageCount + 1);
            updateFacilityMainImageInfo(facilityId);
            return imageDTO;
        } catch (Exception e) {
            log.error("❌ 단일 시설 이미지 저장 중 오류 발생 - facilityId: {}", facilityId, e);
            throw new RuntimeException("시설 이미지 저장에 실패했습니다.", e);
        }
    }
    private void updateFacilityMainImageInfo(Long facilityId) {
        try {
            int imageCount = facilityImageMapper.countImagesByFacilityId(facilityId);
            FacilityImageDTO mainImage = facilityImageMapper.getMainImageByFacilityId(facilityId);
            String mainImagePath = mainImage != null ? mainImage.getImagePath() : null;
            log.info("🔄 시설 테이블 메인 이미지 정보 업데이트 시작 - facilityId: {}, imageCount: {}, mainImagePath: {}",
                    facilityId, imageCount, mainImagePath);
            int updateResult = facilityMapper.updateFacilityMainImage(facilityId, mainImagePath, imageCount);
            if (updateResult > 0) {
                log.info("✅ 시설 테이블 업데이트 성공 - facilityId: {}, 업데이트된 행: {}", facilityId, updateResult);
            } else {
                log.warn("⚠️ 시설 테이블 업데이트 실패 - facilityId: {}, 업데이트된 행: {}", facilityId, updateResult);
            }
        } catch (Exception e) {
            log.error("❌ 시설 테이블 메인 이미지 정보 업데이트 중 오류 - facilityId: {}", facilityId, e);
            throw new RuntimeException("시설 메인 이미지 정보 업데이트에 실패했습니다.", e);
        }
    }
    private String saveImageFileWithCustomName(MultipartFile file, String facilityId, int index, String customFileName) {
        try {
            String uploadDir = Constants.FACILITY_UPLOAD_PATH;
            File uploadDirFile = new File(uploadDir);
            if (!uploadDirFile.exists()) {
                boolean created = uploadDirFile.mkdirs();
                log.info("업로드 디렉토리 생성: {} - {}", uploadDir, created ? "성공" : "실패");
            }
            String originalFilename = file.getOriginalFilename();
            String extension = "";
            String baseName = "";
            if (originalFilename != null && originalFilename.contains(".")) {
                extension = originalFilename.substring(originalFilename.lastIndexOf("."));
                baseName = originalFilename.substring(0, originalFilename.lastIndexOf("."));
            } else if (originalFilename != null) {
                baseName = originalFilename;
                extension = ".jpg";
            }
            String finalFileName;
            if (customFileName != null && !customFileName.trim().isEmpty()) {
                String userFileName = customFileName.trim();
                String userBaseName = userFileName;
                String userExtension = extension;
                if (userFileName.contains(".")) {
                    userBaseName = userFileName.substring(0, userFileName.lastIndexOf("."));
                    userExtension = userFileName.substring(userFileName.lastIndexOf("."));
                }
                String englishBaseName = convertKoreanToEnglish(userBaseName);
                String cleanBaseName = sanitizeFilename(englishBaseName);
                finalFileName = String.format("facility_%s_%d_%s_%s%s",
                        facilityId, index, cleanBaseName,
                        UUID.randomUUID().toString().substring(0, 8), userExtension);
                log.info("📝 사용자 지정 파일명 적용: '{}' → '{}'", customFileName, finalFileName);
            } else {
                return saveImageFile(file, facilityId, index);
            }
            File savedFile = new File(uploadDir + finalFileName);
            file.transferTo(savedFile);
            log.info("시설 이미지 파일 저장 완료: {}", savedFile.getAbsolutePath());
            return "/uploads/facility/" + finalFileName;
        } catch (IOException e) {
            log.error("시설 이미지 파일 저장 중 오류 발생: facilityId={}, index={}, customFileName={}", facilityId, index, customFileName, e);
            throw new RuntimeException("이미지 파일 저장에 실패했습니다.", e);
        }
    }
    private String saveImageFile(MultipartFile file, String facilityId, int index) {
        try {
            String uploadDir = Constants.FACILITY_UPLOAD_PATH;
            File uploadDirFile = new File(uploadDir);
            if (!uploadDirFile.exists()) {
                boolean created = uploadDirFile.mkdirs();
                log.info("업로드 디렉토리 생성: {} - {}", uploadDir, created ? "성공" : "실패");
            }
            String originalFilename = file.getOriginalFilename();
            String extension = "";
            String baseName = "";
            if (originalFilename != null && originalFilename.contains(".")) {
                extension = originalFilename.substring(originalFilename.lastIndexOf("."));
                baseName = originalFilename.substring(0, originalFilename.lastIndexOf("."));
            } else if (originalFilename != null) {
                baseName = originalFilename;
            }
            // 한글 파일명을 영문으로 변환
            String englishBaseName = convertKoreanToEnglish(baseName);
            String cleanBaseName = sanitizeFilename(englishBaseName);
            // 최종 파일명 생성
            String savedFilename;
            if (!cleanBaseName.isEmpty() && !cleanBaseName.equals("facility_image")) {
                savedFilename = String.format("facility_%s_%d_%s_%s%s",
                        facilityId, index, cleanBaseName, UUID.randomUUID().toString().substring(0, 8), extension);
            } else {
                savedFilename = String.format("facility_%s_%d_%s%s",
                        facilityId, index, UUID.randomUUID().toString(), extension);
            }
            log.info("📝 파일명 변환: '{}' → '{}'", originalFilename, savedFilename);
            File savedFile = new File(uploadDir + savedFilename);
            file.transferTo(savedFile);
            log.info("시설 이미지 파일 저장 완료: {}", savedFile.getAbsolutePath());
            return "/uploads/facility/" + savedFilename;
        } catch (IOException e) {
            log.error("시설 이미지 파일 저장 중 오류 발생: facilityId={}, index={}", facilityId, index, e);
            throw new RuntimeException("이미지 파일 저장에 실패했습니다.", e);
        }
    }
    @Transactional
    public void updateMainImage(Long facilityId, Long imageId) {
        try {
            log.info("메인 이미지 변경 시작 - facilityId: {}, imageId: {}", facilityId, imageId);
            facilityImageMapper.clearMainImages(facilityId);
            int result = facilityImageMapper.updateMainImage(facilityId, imageId);
            if (result == 0) {
                throw new RuntimeException("메인 이미지 설정에 실패했습니다.");
            }
            log.info("메인 이미지 변경 완료 - facilityId: {}, imageId: {}", facilityId, imageId);
        } catch (Exception e) {
            log.error("메인 이미지 변경 중 오류 발생 - facilityId: {}, imageId: {}", facilityId, imageId, e);
            throw new RuntimeException("메인 이미지 변경에 실패했습니다.", e);
        }
    }
    @Transactional
    public boolean deleteFacilityImage(Long imageId) {
        try {
            log.info("🗑️ 시설 이미지 완전 삭제 시작 - imageId: {}", imageId);
            FacilityImageDTO imageToDelete = facilityImageMapper.getImageById(imageId);
            if (imageToDelete == null) {
                log.warn("⚠️ 삭제할 이미지를 찾을 수 없음 - imageId: {}", imageId);
                return false;
            }
            String imagePath = imageToDelete.getImagePath();
            log.info("📁 삭제 대상 파일: {}", imagePath);
            int result = facilityImageMapper.deleteFacilityImage(imageId);
            boolean dbDeleteSuccess = result > 0;
            if (dbDeleteSuccess) {
                log.info("✅ DB에서 이미지 삭제 완료 - imageId: {}", imageId);
                boolean fileDeleteSuccess = deleteImageFile(imagePath);
                if (fileDeleteSuccess) {
                    log.info("✅ 파일 시스템에서 이미지 삭제 완료 - path: {}", imagePath);
                } else {
                    log.warn("⚠️ 파일 삭제 실패하였지만 DB 삭제는 성공 - path: {}", imagePath);
                }
                return true;
            } else {
                log.warn("❌ DB에서 이미지 삭제 실패 - imageId: {} (결과: {})", imageId, result);
                return false;
            }
        } catch (Exception e) {
            log.error("❌ 시설 이미지 삭제 중 오류 발생 - imageId: {}", imageId, e);
            return false;
        }
    }
    private boolean deleteImageFile(String imagePath) {
        try {
            if (imagePath == null || imagePath.trim().isEmpty()) {
                log.warn("⚠️ 삭제할 파일 경로가 비어있음");
                return false;
            }
            String actualFilePath;
            if (imagePath.startsWith("/uploads/facility/")) {
                String filename = imagePath.substring("/uploads/facility/".length());
                actualFilePath = Constants.FACILITY_UPLOAD_PATH + filename;
            } else {
                log.warn("⚠️ 예상치 못한 파일 경로 형식: {}", imagePath);
                return false;
            }
            log.info("🔍 실제 파일 경로: {}", actualFilePath);
            File fileToDelete = new File(actualFilePath);
            if (fileToDelete.exists()) {
                boolean deleted = fileToDelete.delete();
                if (deleted) {
                    log.info("✅ 파일 삭제 성공: {}", actualFilePath);
                    return true;
                } else {
                    log.error("❌ 파일 삭제 실패: {}", actualFilePath);
                    return false;
                }
            } else {
                log.warn("⚠️ 삭제할 파일이 존재하지 않음: {}", actualFilePath);
                return true;
            }
        } catch (Exception e) {
            log.error("❌ 파일 삭제 중 오류 발생 - imagePath: {}", imagePath, e);
            return false;
        }
    }
    @Transactional(readOnly = true)
    public int getImageCountByFacilityId(Long facilityId) {
        return facilityImageMapper.countImagesByFacilityId(facilityId);
    }
    @Transactional
    public boolean setMainImage(Long facilityId, Long imageId) {
        try {
            log.info("메인 이미지 설정 시작 - facilityId: {}, imageId: {}", facilityId, imageId);
            facilityImageMapper.clearMainImages(facilityId);
            int result = facilityImageMapper.updateMainImage(facilityId, imageId);
            boolean success = result > 0;
            if (success) {
                log.info("메인 이미지 설정 완료 - facilityId: {}, imageId: {}", facilityId, imageId);
            } else {
                log.warn("메인 이미지 설정 실패 - facilityId: {}, imageId: {} (결과: {})", facilityId, imageId, result);
            }
            return success;
        } catch (Exception e) {
            log.error("메인 이미지 설정 중 오류 발생 - facilityId: {}, imageId: {}", facilityId, imageId, e);
            return false;
        }
    }
    @Transactional(readOnly = true)
    public FacilityImageDTO getImageById(Long imageId) {
        log.info("시설 이미지 조회 - imageId: {}", imageId);
        return facilityImageMapper.getImageById(imageId);
    }
    @Transactional(readOnly = true)
    public List<FacilityImageDTO> getAllImages() {
        log.info("모든 시설 이미지 목록 조회 (임시)");
        return java.util.Collections.emptyList();
    }
    private String convertKoreanToEnglish(String korean) {
        if (korean == null || korean.trim().isEmpty()) {
            return "facility_image";
        }
        String input = korean.toLowerCase().trim();
        String result = input;
        java.util.Map<String, String> koreanToEnglish = java.util.Map.ofEntries(
            java.util.Map.entry("시설", "facility"),
            java.util.Map.entry("요양원", "nursing_home"),
            java.util.Map.entry("요양병원", "nursing_hospital"),
            java.util.Map.entry("병원", "hospital"),
            java.util.Map.entry("의원", "clinic"),
            java.util.Map.entry("데이케어", "daycare"),
            java.util.Map.entry("센터", "center"),
            java.util.Map.entry("홈", "home"),
            java.util.Map.entry("케어", "care"),
            java.util.Map.entry("외관", "exterior"),
            java.util.Map.entry("외부", "exterior"),
            java.util.Map.entry("건물", "building"),
            java.util.Map.entry("입구", "entrance"),
            java.util.Map.entry("현관", "entrance"),
            java.util.Map.entry("내부", "interior"),
            java.util.Map.entry("로비", "lobby"),
            java.util.Map.entry("복도", "corridor"),
            java.util.Map.entry("홀", "hall"),
            java.util.Map.entry("방", "room"),
            java.util.Map.entry("객실", "room"),
            java.util.Map.entry("침실", "bedroom"),
            java.util.Map.entry("생활실", "living_room"),
            java.util.Map.entry("휴게실", "rest_room"),
            java.util.Map.entry("식당", "dining_room"),
            java.util.Map.entry("주방", "kitchen"),
            java.util.Map.entry("카페", "cafe"),
            java.util.Map.entry("화장실", "restroom"),
            java.util.Map.entry("욕실", "bathroom"),
            java.util.Map.entry("세탁실", "laundry"),
            java.util.Map.entry("치료실", "treatment_room"),
            java.util.Map.entry("의무실", "medical_room"),
            java.util.Map.entry("상담실", "consultation_room"),
            java.util.Map.entry("간호사실", "nurses_station"),
            java.util.Map.entry("재활실", "rehabilitation_room"),
            java.util.Map.entry("물리치료실", "physical_therapy_room"),
            java.util.Map.entry("운동실", "exercise_room"),
            java.util.Map.entry("헬스장", "gym"),
            java.util.Map.entry("프로그램실", "program_room"),
            java.util.Map.entry("강당", "auditorium"),
            java.util.Map.entry("도서실", "library"),
            java.util.Map.entry("오락실", "recreation_room"),
            java.util.Map.entry("정원", "garden"),
            java.util.Map.entry("마당", "yard"),
            java.util.Map.entry("테라스", "terrace"),
            java.util.Map.entry("발코니", "balcony"),
            java.util.Map.entry("주차장", "parking_lot"),
            java.util.Map.entry("산책로", "walking_path"),
            java.util.Map.entry("엘리베이터", "elevator"),
            java.util.Map.entry("계단", "stairs"),
            java.util.Map.entry("사무실", "office"),
            java.util.Map.entry("접수처", "reception"),
            java.util.Map.entry("간호", "nursing"),
            java.util.Map.entry("간병", "care"),
            java.util.Map.entry("치료", "treatment"),
            java.util.Map.entry("재활", "rehabilitation"),
            java.util.Map.entry("물리치료", "physical_therapy"),
            java.util.Map.entry("건강관리", "health_care"),
            java.util.Map.entry("깨끗한", "clean"),
            java.util.Map.entry("밝은", "bright"),
            java.util.Map.entry("넓은", "spacious"),
            java.util.Map.entry("안전한", "safe"),
            java.util.Map.entry("편안한", "comfortable"),
            java.util.Map.entry("현대적", "modern"),
            java.util.Map.entry("고급", "premium"),
            java.util.Map.entry("아침", "morning"),
            java.util.Map.entry("점심", "lunch"),
            java.util.Map.entry("저녁", "evening"),
            java.util.Map.entry("앞", "front"),
            java.util.Map.entry("뒤", "back"),
            java.util.Map.entry("층", "floor"),
            java.util.Map.entry("1층", "first_floor"),
            java.util.Map.entry("2층", "second_floor"),
            java.util.Map.entry("1", "one"),
            java.util.Map.entry("2", "two"),
            java.util.Map.entry("3", "three"),
            java.util.Map.entry("4", "four"),
            java.util.Map.entry("5", "five"),
            java.util.Map.entry("첫번째", "first"),
            java.util.Map.entry("두번째", "second"),
            java.util.Map.entry("세번째", "third")
        );
        for (java.util.Map.Entry<String, String> entry : koreanToEnglish.entrySet()) {
            result = result.replace(entry.getKey(), entry.getValue());
        }
        if (containsKorean(result)) {
            result = convertKoreanToRomanization(result);
        }
        return result;
    }
    private String convertKoreanToRomanization(String korean) {
        if (korean == null || korean.trim().isEmpty()) {
            return "korean_text";
        }
        java.util.Map<String, String> koreanRomanization = java.util.Map.ofEntries(
            java.util.Map.entry("ㄱ", "g"), java.util.Map.entry("ㄴ", "n"), java.util.Map.entry("ㄷ", "d"),
            java.util.Map.entry("ㄹ", "r"), java.util.Map.entry("ㅁ", "m"), java.util.Map.entry("ㅂ", "b"),
            java.util.Map.entry("ㅅ", "s"), java.util.Map.entry("ㅇ", ""), java.util.Map.entry("ㅈ", "j"),
            java.util.Map.entry("ㅊ", "ch"), java.util.Map.entry("ㅋ", "k"), java.util.Map.entry("ㅌ", "t"),
            java.util.Map.entry("ㅍ", "p"), java.util.Map.entry("ㅎ", "h"),
            java.util.Map.entry("ㅏ", "a"), java.util.Map.entry("ㅑ", "ya"), java.util.Map.entry("ㅓ", "eo"),
            java.util.Map.entry("ㅕ", "yeo"), java.util.Map.entry("ㅗ", "o"), java.util.Map.entry("ㅛ", "yo"),
            java.util.Map.entry("ㅜ", "u"), java.util.Map.entry("ㅠ", "yu"), java.util.Map.entry("ㅡ", "eu"),
            java.util.Map.entry("ㅣ", "i"), java.util.Map.entry("ㅐ", "ae"), java.util.Map.entry("ㅔ", "e"),
            java.util.Map.entry("가", "ga"), java.util.Map.entry("나", "na"), java.util.Map.entry("다", "da"),
            java.util.Map.entry("라", "ra"), java.util.Map.entry("마", "ma"), java.util.Map.entry("바", "ba"),
            java.util.Map.entry("사", "sa"), java.util.Map.entry("자", "ja"), java.util.Map.entry("차", "cha"),
            java.util.Map.entry("카", "ka"), java.util.Map.entry("타", "ta"), java.util.Map.entry("파", "pa"),
            java.util.Map.entry("하", "ha"),
            java.util.Map.entry("김", "kim"), java.util.Map.entry("이", "lee"), java.util.Map.entry("박", "park"),
            java.util.Map.entry("최", "choi"), java.util.Map.entry("정", "jung"), java.util.Map.entry("강", "kang"),
            java.util.Map.entry("조", "cho"), java.util.Map.entry("윤", "yoon"), java.util.Map.entry("장", "jang"),
            java.util.Map.entry("임", "lim"), java.util.Map.entry("한", "han"), java.util.Map.entry("오", "oh"),
            java.util.Map.entry("서", "seo"), java.util.Map.entry("신", "shin"), java.util.Map.entry("권", "kwon"),
            java.util.Map.entry("황", "hwang"), java.util.Map.entry("안", "ahn"), java.util.Map.entry("송", "song"),
            java.util.Map.entry("류", "ryu"), java.util.Map.entry("전", "jeon"), java.util.Map.entry("홍", "hong")
        );
        String result = korean;
        for (java.util.Map.Entry<String, String> entry : koreanRomanization.entrySet()) {
            result = result.replace(entry.getKey(), entry.getValue());
        }
        if (containsKorean(result)) {
            result = "korean_" + System.currentTimeMillis() % 10000;
        }
        return result;
    }
    private String sanitizeFilename(String filename) {
        if (filename == null || filename.trim().isEmpty()) {
            return "facility_image";
        }
        String sanitized = filename.replaceAll("[^a-zA-Z0-9_-]", "_")
                                  .replaceAll("_{2,}", "_")
                                  .replaceAll("^_+|_+$", ""); // 앞뒤 언더스코어 제거
        // 너무 길면 자르기 (최대 30자)
        if (sanitized.length() > 30) {
            sanitized = sanitized.substring(0, 30);
        }
        // 비어있으면 기본값
        if (sanitized.isEmpty()) {
            sanitized = "facility_image";
        }
        return sanitized;
    }
    private boolean containsKorean(String text) {
        if (text == null) return false;
        return text.matches(".*[ㄱ-ㅎㅏ-ㅣ가-힣]+.*");
    }
    private void validateImageFile(MultipartFile file) {
        if (file == null || file.isEmpty()) {
            throw new IllegalArgumentException("이미지 파일이 비어있습니다.");
        }
        if (file.getSize() > Constants.MAX_FILE_SIZE) {
            throw new IllegalArgumentException(String.format("파일 크기가 너무 큽니다. 최대 %dMB까지 업로드 가능합니다.",
                Constants.MAX_FILE_SIZE / (1024 * 1024)));
        }
        String originalFilename = file.getOriginalFilename();
        if (originalFilename == null || !originalFilename.contains(".")) {
            throw new IllegalArgumentException("유효하지 않은 파일입니다.");
        }
        String extension = originalFilename.substring(originalFilename.lastIndexOf(".") + 1).toLowerCase();
        boolean isValidExtension = false;
        for (String allowedExt : Constants.ALLOWED_IMAGE_EXTENSIONS) {
            if (allowedExt.equals(extension)) {
                isValidExtension = true;
                break;
            }
        }
        if (!isValidExtension) {
            throw new IllegalArgumentException(String.format("지원하지 않는 파일 형식입니다. 지원 형식: %s",
                String.join(", ", Constants.ALLOWED_IMAGE_EXTENSIONS)));
        }
        String contentType = file.getContentType();
        if (contentType == null || !contentType.startsWith("image/")) {
            throw new IllegalArgumentException("이미지 파일만 업로드 가능합니다.");
        }
        log.debug("✅ 이미지 파일 검증 통과 - 파일명: {}, 크기: {}KB, 타입: {}",
            originalFilename, file.getSize() / 1024, contentType);
    }
    @Transactional
    public boolean updateImageOrder(Long imageId, Integer imageOrder) {
        try {
            log.info("🔢 이미지 순서 업데이트 - imageId: {}, newOrder: {}", imageId, imageOrder);
            int result = facilityImageMapper.updateImageOrder(imageId, imageOrder);
            boolean success = result > 0;
            if (success) {
                log.info("✅ 이미지 순서 업데이트 성공 - imageId: {}, newOrder: {}", imageId, imageOrder);
            } else {
                log.warn("⚠️ 이미지 순서 업데이트 실패 - imageId: {}, newOrder: {}", imageId, imageOrder);
            }
            return success;
        } catch (Exception e) {
            log.error("❌ 이미지 순서 업데이트 중 오류 발생 - imageId: {}, newOrder: {}", imageId, imageOrder, e);
            return false;
        }
    }
    @Transactional
    public boolean reorderAllFacilityImages(Long facilityId) {
        try {
            log.info("🔄 시설 이미지 순서 재정렬 시작 - facilityId: {}", facilityId);
            List<FacilityImageDTO> images = facilityImageMapper.getImagesByFacilityId(facilityId);
            if (images.isEmpty()) {
                log.info("ℹ️ 재정렬할 이미지가 없음 - facilityId: {}", facilityId);
                return true;
            }
            log.info("📊 재정렬할 이미지 수: {} - facilityId: {}", images.size(), facilityId);
            for (int i = 0; i < images.size(); i++) {
                FacilityImageDTO image = images.get(i);
                int newOrder = i;
                if (image.getImageOrder() == null || !image.getImageOrder().equals(newOrder)) {
                    int updateResult = facilityImageMapper.updateImageOrder(image.getImageId(), newOrder);
                    if (updateResult > 0) {
                        log.debug("✅ 이미지 순서 재정렬 - imageId: {}, 기존: {} → 새로운: {}",
                            image.getImageId(), image.getImageOrder(), newOrder);
                    } else {
                        log.warn("⚠️ 이미지 순서 재정렬 실패 - imageId: {}, 새로운 순서: {}",
                            image.getImageId(), newOrder);
                    }
                }
            }
            log.info("✅ 시설 이미지 순서 재정렬 완료 - facilityId: {}", facilityId);
            return true;
        } catch (Exception e) {
            log.error("❌ 시설 이미지 순서 재정렬 중 오류 발생 - facilityId: {}", facilityId, e);
            return false;
        }
    }
    @Transactional
    public boolean updateImageOrdersBatch(Long facilityId, List<Long> imageIds) {
        try {
            log.info("🔢 배치 이미지 순서 업데이트 시작 - facilityId: {}, imageIds: {}", facilityId, imageIds);
            if (imageIds == null || imageIds.isEmpty()) {
                log.warn("⚠️ 업데이트할 이미지 ID 목록이 비어있음 - facilityId: {}", facilityId);
                return false;
            }
            int existingImageCount = facilityImageMapper.countImagesByFacilityId(facilityId);
            if (imageIds.size() > existingImageCount) {
                log.warn("⚠️ 전달받은 이미지 ID 수가 기존 이미지 수보다 많음 - facilityId: {}, 전달받은: {}, 기존: {}",
                    facilityId, imageIds.size(), existingImageCount);
                return false;
            }
            int successCount = 0;
            for (int i = 0; i < imageIds.size(); i++) {
                Long imageId = imageIds.get(i);
                int newOrder = i;
                FacilityImageDTO existingImage = facilityImageMapper.getImageById(imageId);
                if (existingImage == null || !existingImage.getFacilityId().equals(facilityId)) {
                    log.warn("⚠️ 잘못된 이미지 ID 또는 시설 불일치 - imageId: {}, facilityId: {}",
                        imageId, facilityId);
                    continue;
                }
                int updateResult = facilityImageMapper.updateImageOrder(imageId, newOrder);
                if (updateResult > 0) {
                    successCount++;
                    log.debug("✅ 이미지 순서 업데이트 - imageId: {}, 새로운 순서: {}", imageId, newOrder);
                } else {
                    log.warn("⚠️ 이미지 순서 업데이트 실패 - imageId: {}, 새로운 순서: {}", imageId, newOrder);
                }
            }
            boolean success = successCount == imageIds.size();
            if (success) {
                log.info("✅ 배치 이미지 순서 업데이트 완료 - facilityId: {}, 성공: {}/{}",
                    facilityId, successCount, imageIds.size());
            } else {
                log.warn("⚠️ 배치 이미지 순서 업데이트 부분 실패 - facilityId: {}, 성공: {}/{}",
                    facilityId, successCount, imageIds.size());
            }
            return success;
        } catch (Exception e) {
            log.error("❌ 배치 이미지 순서 업데이트 중 오류 발생 - facilityId: {}", facilityId, e);
            return false;
        }
    }
    @Transactional
    public boolean deleteAllFacilityImages(Long facilityId) {
        try {
            log.info("🗑️ 시설의 모든 이미지 완전 삭제 시작 - facilityId: {}", facilityId);
            List<FacilityImageDTO> imagesToDelete = facilityImageMapper.getImagesByFacilityId(facilityId);
            if (imagesToDelete.isEmpty()) {
                log.info("ℹ️ 삭제할 이미지가 없음 - facilityId: {}", facilityId);
                return true;
            }
            log.info("📊 삭제할 이미지 수: {}", imagesToDelete.size());
            List<String> imagePaths = new ArrayList<>();
            for (FacilityImageDTO image : imagesToDelete) {
                if (image.getImagePath() != null && !image.getImagePath().trim().isEmpty()) {
                    imagePaths.add(image.getImagePath());
                }
            }
            int deletedCount = facilityImageMapper.deleteAllImagesByFacilityId(facilityId);
            log.info("✅ DB에서 {} 개 이미지 삭제 완료 - facilityId: {}", deletedCount, facilityId);
            int fileDeletedCount = 0;
            for (String imagePath : imagePaths) {
                if (deleteImageFile(imagePath)) {
                    fileDeletedCount++;
                }
            }
            log.info("✅ 파일 시스템에서 {}/{} 개 파일 삭제 완료", fileDeletedCount, imagePaths.size());
            return deletedCount > 0;
        } catch (Exception e) {
            log.error("❌ 시설의 모든 이미지 삭제 중 오류 발생 - facilityId: {}", facilityId, e);
            return false;
        }
    }
    @Transactional
    public List<FacilityImageDTO> uploadMultipleImages(Long facilityId, List<MultipartFile> images) {
        List<FacilityImageDTO> uploadedImages = new ArrayList<>();
        try {
            log.info("📤 다중 이미지 업로드 시작 - facilityId: {}, 이미지 수: {}", facilityId, images.size());
            List<FacilityImageDTO> existingImages = facilityImageMapper.getImagesByFacilityId(facilityId);
            int currentCount = existingImages.size();
            int nextOrderNum = currentCount + 1;
            log.info("기존 이미지 수: {}, 시작 순서 번호: {}", currentCount, nextOrderNum);
            String uploadDir = Constants.FACILITY_UPLOAD_PATH;
            File directory = new File(uploadDir);
            if (!directory.exists()) {
                boolean created = directory.mkdirs();
                log.info("업로드 디렉토리 생성: {} (성공: {})", uploadDir, created);
            }
            for (int i = 0; i < images.size(); i++) {
                MultipartFile image = images.get(i);
                try {
                    String originalFilename = image.getOriginalFilename();
                    String extension = "";
                    if (originalFilename != null && originalFilename.contains(".")) {
                        extension = originalFilename.substring(originalFilename.lastIndexOf("."));
                    }
                    String uniqueFilename = UUID.randomUUID().toString() + extension;
                    String filePath = uploadDir + uniqueFilename;
                    // 파일 저장
                    File destinationFile = new File(filePath);
                    image.transferTo(destinationFile);
                    log.info("파일 저장 완료: {} -> {}", originalFilename, uniqueFilename);
                    // DTO 생성
                    FacilityImageDTO imageDTO = new FacilityImageDTO();
                    imageDTO.setFacilityId(facilityId);
                    imageDTO.setImagePath("/uploads/facility/" + uniqueFilename);
                    imageDTO.setImageAltText(originalFilename); // ALT 텍스트에 원본 파일명 저장
                    imageDTO.setImageOrder(nextOrderNum + i);
                    imageDTO.setIsMainImage(currentCount == 0 && i == 0); // 첫 번째 이미지가 메인
                    // DB 저장
                    int result = facilityImageMapper.insertFacilityImage(imageDTO);
                    if (result > 0) {
                        uploadedImages.add(imageDTO);
                        log.info("이미지 DB 저장 완료: {} (순서: {})", uniqueFilename, imageDTO.getImageOrder());
                    } else {
                        log.warn("이미지 DB 저장 실패: {}", uniqueFilename);
                        // 실패한 파일 삭제
                        destinationFile.delete();
                    }
                } catch (IOException e) {
                    log.error("이미지 파일 저장 실패: {}", image.getOriginalFilename(), e);
                } catch (Exception e) {
                    log.error("이미지 처리 중 오류: {}", image.getOriginalFilename(), e);
                }
            }
            log.info("✅ 다중 이미지 업로드 완료 - facilityId: {}, 성공: {}/{}",
                    facilityId, uploadedImages.size(), images.size());
            return uploadedImages;
        } catch (Exception e) {
            log.error("❌ 다중 이미지 업로드 중 오류 발생 - facilityId: {}", facilityId, e);
            // 실패 시 업로드된 파일들 롤백
            for (FacilityImageDTO uploadedImage : uploadedImages) {
                try {
                    if (uploadedImage.getImageId() != null) {
                        facilityImageMapper.deleteFacilityImage(uploadedImage.getImageId());
                    }
                    deleteImageFile(uploadedImage.getImagePath());
                } catch (Exception rollbackException) {
                    log.error("롤백 중 오류:", rollbackException);
                }
            }
            throw new RuntimeException("이미지 업로드 중 오류가 발생했습니다.", e);
        }
    }
}
````

## File: src/main/java/com/example/carelink/service/ReviewService.java
````java
package com.example.carelink.service;
import com.example.carelink.common.PageInfo;
import com.example.carelink.dao.ReviewMapper;
import com.example.carelink.dto.ReviewDTO;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import java.util.List;
@Slf4j
@Service
@RequiredArgsConstructor
public class ReviewService {
    private final ReviewMapper reviewMapper;
    private static final int DEFAULT_PAGE_SIZE = 10;
    public PageInfo<ReviewDTO> getReviewList(int page, String keyword) {
        return getReviewList(page, keyword, null, null);
    }
    public PageInfo<ReviewDTO> getReviewList(int page, String keyword, Integer minRating) {
        return getReviewList(page, keyword, minRating, null);
    }
    public PageInfo<ReviewDTO> getReviewList(int page, String keyword, Integer minRating, Long facilityId) {
        log.info("리뷰 목록 조회 시작 - page: {}, keyword: {}, minRating: {}, facilityId: {}", page, keyword, minRating, facilityId);
        try {
            ReviewDTO searchDTO = new ReviewDTO();
            searchDTO.setPage(page);
            searchDTO.setSize(DEFAULT_PAGE_SIZE);
            if (keyword != null && !keyword.trim().isEmpty()) {
                searchDTO.setSearchKeyword(keyword.trim());
            }
            if (minRating != null) {
                searchDTO.setMinRating(minRating);
            }
            if (facilityId != null) {
                searchDTO.setFacilityId(facilityId);
            }
            int totalCount = reviewMapper.countReviewsWithSearch(searchDTO);
            List<ReviewDTO> reviewList = reviewMapper.findReviewsWithSearch(searchDTO);
            log.info("리뷰 목록 조회 완료 - 조회된 건수: {}, 전체: {}", reviewList.size(), totalCount);
            return new PageInfo<>(reviewList, page, DEFAULT_PAGE_SIZE, totalCount);
        } catch (Exception e) {
            log.error("리뷰 목록 조회 중 오류 발생", e);
            throw new RuntimeException("리뷰 목록을 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional
    public ReviewDTO getReviewById(Long id) {
        log.info("리뷰 상세 조회 시작 - reviewId: {}", id);
        try {
            ReviewDTO review = reviewMapper.findReviewById(id);
            if (review == null) {
                throw new RuntimeException("해당 리뷰를 찾을 수 없습니다. ID: " + id);
            }
            reviewMapper.incrementViewCount(id);
            log.info("리뷰 상세 조회 완료 - reviewId: {}, title: {}", id, review.getTitle());
            return review;
        } catch (Exception e) {
            log.error("리뷰 상세 조회 중 오류 발생 - reviewId: {}", id, e);
            throw new RuntimeException("리뷰 상세 정보를 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional
    public int insertReview(ReviewDTO reviewDTO) {
        log.info("리뷰 등록 시작 - title: {}, facilityId: {}", reviewDTO.getTitle(), reviewDTO.getFacilityId());
        try {
            validateReviewData(reviewDTO);
            if (reviewDTO.getStatus() == null) {
                reviewDTO.setStatus("ACTIVE");
            }
            if (reviewDTO.getReplyDepth() == null) {
                reviewDTO.setReplyDepth(0);
            }
            reviewDTO.setVisible(true);
            reviewDTO.setDeleted(false);
            int result = reviewMapper.insertReview(reviewDTO);
            log.info("리뷰 등록 완료 - reviewId: {}", reviewDTO.getReviewId());
            return result;
        } catch (Exception e) {
            log.error("리뷰 등록 중 오류 발생", e);
            throw new RuntimeException("리뷰 등록 중 오류가 발생했습니다.", e);
        }
    }
    public List<ReviewDTO> getReviewsByFacilityId(Long facilityId) {
        log.info("시설별 리뷰 조회 시작 - facilityId: {}", facilityId);
        try {
            List<ReviewDTO> reviews = reviewMapper.findReviewsByFacilityId(facilityId);
            log.info("시설별 리뷰 조회 완료 - facilityId: {}, 조회된 건수: {}", facilityId, reviews.size());
            return reviews;
        } catch (Exception e) {
            log.error("시설별 리뷰 조회 중 오류 발생 - facilityId: {}", facilityId, e);
            throw new RuntimeException("시설별 리뷰를 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional
    public int deleteReview(Long id) {
        log.info("리뷰 삭제 시작 - reviewId: {}", id);
        try {
            ReviewDTO existingReview = reviewMapper.findReviewById(id);
            if (existingReview == null) {
                throw new RuntimeException("삭제할 리뷰를 찾을 수 없습니다. ID: " + id);
            }
            int result = reviewMapper.deleteReview(id);
            log.info("리뷰 삭제 완료 - reviewId: {}", id);
            return result;
        } catch (Exception e) {
            log.error("리뷰 삭제 중 오류 발생 - reviewId: {}", id, e);
            throw new RuntimeException("리뷰 삭제 중 오류가 발생했습니다.", e);
        }
    }
    public Double getAverageRating(Long facilityId) {
        log.info("평균 평점 조회 시작 - facilityId: {}", facilityId);
        try {
            Double averageRating = reviewMapper.getAverageRating(facilityId);
            if (averageRating == null) {
                averageRating = 0.0;
            }
            log.info("평균 평점 조회 완료 - facilityId: {}, 평균 평점: {}", facilityId, averageRating);
            return averageRating;
        } catch (Exception e) {
            log.error("평균 평점 조회 중 오류 발생 - facilityId: {}", facilityId, e);
            return 0.0;
        }
    }
    @Transactional
    public int likeReview(Long reviewId) {
        log.info("리뷰 추천 시작 - reviewId: {}", reviewId);
        try {
            int result = reviewMapper.incrementLikeCount(reviewId);
            log.info("리뷰 추천 완료 - reviewId: {}", reviewId);
            return result;
        } catch (Exception e) {
            log.error("리뷰 추천 중 오류 발생 - reviewId: {}", reviewId, e);
            throw new RuntimeException("리뷰 추천 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional
    public int dislikeReview(Long reviewId) {
        log.info("리뷰 비추천 시작 - reviewId: {}", reviewId);
        try {
            int result = reviewMapper.incrementDislikeCount(reviewId);
            log.info("리뷰 비추천 완료 - reviewId: {}", reviewId);
            return result;
        } catch (Exception e) {
            log.error("리뷰 비추천 중 오류 발생 - reviewId: {}", reviewId, e);
            throw new RuntimeException("리뷰 비추천 중 오류가 발생했습니다.", e);
        }
    }
    public List<ReviewDTO> getReviewsByMemberId(Long memberId) {
        log.info("회원별 리뷰 조회 시작 - memberId: {}", memberId);
        try {
            List<ReviewDTO> reviews = reviewMapper.findReviewsByMemberId(memberId);
            log.info("회원별 리뷰 조회 완료 - memberId: {}, 조회된 건수: {}", memberId, reviews.size());
            return reviews;
        } catch (Exception e) {
            log.error("회원별 리뷰 조회 중 오류 발생 - memberId: {}", memberId, e);
            throw new RuntimeException("회원별 리뷰를 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    private void validateReviewData(ReviewDTO reviewDTO) {
        if (reviewDTO.getFacilityId() == null) {
            throw new IllegalArgumentException("시설 ID는 필수입니다.");
        }
        if (reviewDTO.getMemberId() == null) {
            throw new IllegalArgumentException("회원 ID는 필수입니다.");
        }
        if (reviewDTO.getTitle() == null || reviewDTO.getTitle().trim().isEmpty()) {
            throw new IllegalArgumentException("리뷰 제목은 필수입니다.");
        }
        if (reviewDTO.getContent() == null || reviewDTO.getContent().trim().isEmpty()) {
            throw new IllegalArgumentException("리뷰 내용은 필수입니다.");
        }
        if (reviewDTO.getRating() == null || reviewDTO.getRating() < 1 || reviewDTO.getRating() > 5) {
            throw new IllegalArgumentException("평점은 1~5 사이의 값이어야 합니다.");
        }
    }
    @Transactional(readOnly = true)
    public int getReviewCount() {
        try {
            return reviewMapper.getReviewCount();
        } catch (Exception e) {
            log.error("리뷰 수 조회 중 오류 발생", e);
            return 0;
        }
    }
    @Transactional
    public int updateReview(ReviewDTO reviewDTO) {
        log.info("리뷰 수정 시작 - reviewId: {}, title: {}", reviewDTO.getReviewId(), reviewDTO.getTitle());
        try {
            ReviewDTO existingReview = reviewMapper.findReviewById(reviewDTO.getReviewId());
            if (existingReview == null) {
                throw new RuntimeException("수정할 리뷰를 찾을 수 없습니다. ID: " + reviewDTO.getReviewId());
            }
            validateReviewData(reviewDTO);
            if (reviewDTO.getStatus() == null || reviewDTO.getStatus().isEmpty()) {
                reviewDTO.setStatus("ACTIVE");
            }
            int result = reviewMapper.updateReview(reviewDTO);
            log.info("리뷰 수정 완료 - reviewId: {}", reviewDTO.getReviewId());
            return result;
        } catch (Exception e) {
            log.error("리뷰 수정 중 오류 발생 - reviewId: {}", reviewDTO.getReviewId(), e);
            throw new RuntimeException("리뷰 수정 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional
    public int incrementViewCount(Long id) {
        log.info("조회수 증가 시작 - reviewId: {}", id);
        try {
            int result = reviewMapper.incrementViewCount(id);
            log.info("조회수 증가 완료 - reviewId: {}", id);
            return result;
        } catch (Exception e) {
            log.error("조회수 증가 중 오류 발생 - reviewId: {}", id, e);
            return 0;
        }
    }
}
````

## File: src/main/java/com/example/carelink/controller/JobController.java
````java
package com.example.carelink.controller;
import com.example.carelink.common.Constants;
import com.example.carelink.dto.JobDTO;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.service.JobService;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;
import javax.servlet.http.HttpSession;
import java.util.List;
@Controller
@RequestMapping("/job")
@RequiredArgsConstructor
public class JobController {
    private final JobService jobService;
    @GetMapping
    public String listPage(Model model,
                          @RequestParam(defaultValue = "1") int page,
                          @RequestParam(defaultValue = "") String keyword,
                          @RequestParam(defaultValue = "") String jobType) {
        List<JobDTO> jobList = jobService.getJobList(page, keyword, jobType);
        model.addAttribute("jobList", jobList);
        model.addAttribute("keyword", keyword);
        model.addAttribute("jobType", jobType);
        model.addAttribute("currentPage", page);
        return "job/list";
    }
    @GetMapping("/write")
    public String writePage(@RequestParam(defaultValue = "RECRUIT") String type, Model model, HttpSession session) {
        MemberDTO loggedInMember = getCurrentMember(session);
        if (loggedInMember == null) {
            session.setAttribute("errorMessage", "로그인 후 이용해주세요.");
            return "redirect:/member/login";
        }
        String defaultType = type;
        if ("FACILITY".equals(loggedInMember.getRole())) {
            defaultType = "RECRUIT";
        } else if ("USER".equals(loggedInMember.getRole())) {
            defaultType = "SEARCH";
        }
        JobDTO jobDTO = new JobDTO();
        jobDTO.setJobType(defaultType);
        model.addAttribute("jobDTO", jobDTO);
        model.addAttribute("selectedType", defaultType);
        model.addAttribute("currentMember", loggedInMember);
        return "job/write";
    }
    @PostMapping("/write")
    public String writeJob(@ModelAttribute JobDTO jobDTO, HttpSession session) {
        MemberDTO loggedInMember = getCurrentMember(session);
        if (loggedInMember == null) {
            session.setAttribute("errorMessage", "로그인 후 이용해주세요.");
            return "redirect:/member/login";
        }
        String jobType = jobDTO.getJobType();
        String userRole = loggedInMember.getRole();
        if ("FACILITY".equals(userRole) && "SEARCH".equals(jobType)) {
            session.setAttribute("errorMessage", "시설회원은 구인공고만 작성할 수 있습니다.");
            return "redirect:/job/write?type=RECRUIT";
        }
        if ("USER".equals(userRole) && "RECRUIT".equals(jobType)) {
            session.setAttribute("errorMessage", "일반회원은 구직공고만 작성할 수 있습니다.");
            return "redirect:/job/write?type=SEARCH";
        }
        if (jobDTO.getStatus() == null || jobDTO.getStatus().isEmpty()) {
            jobDTO.setStatus("ACTIVE");
        }
        jobDTO.setMemberId(loggedInMember.getMemberId());
        if (jobDTO.getPriority() == null) {
            jobDTO.setPriority(0);
        }
        try {
            jobService.insertJob(jobDTO);
            session.setAttribute("successMessage", "공고가 성공적으로 등록되었습니다.");
            return "redirect:/job";
        } catch (Exception e) {
            session.setAttribute("errorMessage", "공고 등록 중 오류가 발생했습니다. 다시 시도해주세요.");
            return "redirect:/job/write?type=" + jobType;
        }
    }
    @GetMapping("/detail/{id}")
    public String detailPage(@PathVariable Long id, Model model, HttpSession session) {
        try {
            JobDTO job = jobService.getJobById(id);
            if (job == null) {
                session.setAttribute("errorMessage", "해당 구인공고를 찾을 수 없습니다.");
                return "redirect:/job";
            }
            String formattedContent = "";
            if (job.getContent() != null) {
                formattedContent = job.getContent().replace(System.lineSeparator(), "<br>");
                formattedContent = formattedContent.replace("\n", "<br>");
            }
            model.addAttribute("formattedJobContent", formattedContent);
            MemberDTO loggedInMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (loggedInMember == null || !job.getMemberId().equals(loggedInMember.getMemberId())) {
            }
            model.addAttribute("job", job);
            return "job/detail";
        } catch (Exception e) {
            e.printStackTrace();
            session.setAttribute("errorMessage", "구인공고 조회 중 오류가 발생했습니다.");
            return "redirect:/job";
        }
    }
    @GetMapping("/edit/{id}")
    public String editPage(@PathVariable Long id, Model model, HttpSession session) {
        MemberDTO loggedInMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loggedInMember == null) {
            return "redirect:/member/login";
        }
        JobDTO job = jobService.getJobById(id);
        if (job == null) {
            session.setAttribute("errorMessage", "해당 구인공고를 찾을 수 없습니다.");
            return "redirect:/job";
        }
        if (!canEditJob(loggedInMember, job.getMemberId())) {
            session.setAttribute("errorMessage", "수정 권한이 없습니다. 작성자 또는 관리자만 수정할 수 있습니다.");
            return "redirect:/job/detail/" + id;
        }
        model.addAttribute("jobDTO", job);
        return "job/edit";
    }
    @PostMapping("/edit/{id}")
    public String editJob(@PathVariable Long id, @ModelAttribute JobDTO jobDTO, HttpSession session) {
        MemberDTO loggedInMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loggedInMember == null) {
            return "redirect:/member/login";
        }
        JobDTO existingJob = jobService.getJobById(id);
        if (existingJob == null) {
            session.setAttribute("errorMessage", "해당 구인공고를 찾을 수 없습니다.");
            return "redirect:/job";
        }
        if (!canEditJob(loggedInMember, existingJob.getMemberId())) {
            session.setAttribute("errorMessage", "수정 권한이 없습니다. 작성자 또는 관리자만 수정할 수 있습니다.");
            return "redirect:/job/detail/" + id;
        }
        jobDTO.setJobId(id);
        jobDTO.setMemberId(loggedInMember.getMemberId());
        jobService.updateJob(jobDTO);
        return "redirect:/job/detail/" + id;
    }
    @PostMapping("/delete/{id}")
    public String deleteJob(@PathVariable Long id, HttpSession session) {
        MemberDTO loggedInMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loggedInMember == null) {
            return "redirect:/member/login";
        }
        JobDTO existingJob = jobService.getJobById(id);
        if (existingJob == null) {
            session.setAttribute("errorMessage", "해당 구인공고를 찾을 수 없습니다.");
            return "redirect:/job";
        }
        boolean isOwner = existingJob.getMemberId().equals(loggedInMember.getMemberId());
        boolean isAdmin = "ADMIN".equals(loggedInMember.getRole());
        if (!isOwner && !isAdmin) {
            session.setAttribute("errorMessage", "삭제 권한이 없습니다. 작성자만 삭제할 수 있습니다.");
            return "redirect:/job/detail/" + id;
        }
        jobService.deleteJob(id);
        session.setAttribute("successMessage", "구인공고가 삭제되었습니다.");
        return "redirect:/job";
    }
    @PostMapping("/{id}/apply")
    public String applyForJob(@PathVariable Long id, HttpSession session, RedirectAttributes redirectAttributes) {
        MemberDTO loggedInMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loggedInMember == null) {
            redirectAttributes.addFlashAttribute("errorMessage", "로그인 후 이용해주세요.");
            return "redirect:/member/login";
        }
        if (!"USER".equals(loggedInMember.getRole())) {
            redirectAttributes.addFlashAttribute("errorMessage", "개인 회원만 구인공고에 지원할 수 있습니다.");
            return "redirect:/job/detail/" + id;
        }
        try {
            jobService.applyForJob(id, loggedInMember.getMemberId());
            redirectAttributes.addFlashAttribute("successMessage", "구인공고 지원이 완료되었습니다!");
            return "redirect:/job/detail/" + id;
        } catch (IllegalArgumentException e) {
            redirectAttributes.addFlashAttribute("errorMessage", e.getMessage());
            return "redirect:/job/detail/" + id;
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("errorMessage", "구인공고 지원 중 오류가 발생했습니다. 다시 시도해주세요.");
            return "redirect:/job/detail/" + id;
        }
    }
    private MemberDTO getCurrentMember(HttpSession session) {
        return (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
    }
    private boolean canWriteRecruit(MemberDTO member) {
        return member != null && ("FACILITY".equals(member.getRole()) || "ADMIN".equals(member.getRole()));
    }
    private boolean canWriteSearch(MemberDTO member) {
        return member != null && ("USER".equals(member.getRole()) || "ADMIN".equals(member.getRole()));
    }
    private boolean canEditJob(MemberDTO member, Long authorId) {
        return member != null && (member.getMemberId().equals(authorId) || "ADMIN".equals(member.getRole()));
    }
    private boolean canApplyOrContact(MemberDTO member, Long authorId) {
        return member != null && !member.getMemberId().equals(authorId);
    }
    private boolean isAdmin(MemberDTO member) {
        return member != null && "ADMIN".equals(member.getRole());
    }
}
````

## File: src/main/java/com/example/carelink/service/JobService.java
````java
package com.example.carelink.service;
import com.example.carelink.dao.JobMapper;
import com.example.carelink.dto.JobApplicationDTO;
import com.example.carelink.dto.JobDTO;
import com.example.carelink.dao.JobApplicationMapper;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;
@Slf4j
@Service
@RequiredArgsConstructor
public class JobService {
    private final JobMapper jobMapper;
    private final JobApplicationMapper jobApplicationMapper;
    public List<JobDTO> getJobList(int currentPage, String keyword, String jobType) {
        log.info("구인구직 목록 조회 시작 - page: {}, keyword: {}, jobType: {}", currentPage, keyword, jobType);
        try {
            JobDTO searchDTO = new JobDTO();
            int pageSize = 10;
            searchDTO.setSize(pageSize);
            searchDTO.setPage((currentPage - 1) * pageSize);
            if (keyword != null && !keyword.trim().isEmpty()) {
                searchDTO.setSearchKeyword(keyword.trim());
            }
            if (jobType != null && !jobType.trim().isEmpty()) {
                searchDTO.setJobType(jobType.trim());
            }
            List<JobDTO> jobList = jobMapper.getJobList(searchDTO);
            log.info("구인구직 목록 조회 완료 - 조회된 건수: {}", jobList.size());
            return jobList;
        } catch (Exception e) {
            log.error("구인구직 목록 조회 중 오류 발생", e);
            return new ArrayList<>();
        }
    }
    public JobDTO getJobById(Long id) {
        log.info("구인구직 상세 조회 시작 - jobId: {}", id);
        try {
            JobDTO job = jobMapper.findJobById(id);
            if (job == null) {
                log.warn("구인구직 정보를 찾을 수 없습니다 - jobId: {}", id);
                throw new RuntimeException("해당 구인구직 정보를 찾을 수 없습니다. ID: " + id);
            }
            log.info("구인구직 상세 조회 완료 - jobId: {}, title: {}", id, job.getTitle());
            return job;
        } catch (Exception e) {
            log.error("구인구직 상세 조회 중 오류 발생 - jobId: {}", id, e);
            JobDTO job = new JobDTO();
            job.setJobId(id);
            job.setTitle("구인구직 정보를 불러오는 중 오류가 발생했습니다");
            job.setContent("시스템 오류로 인해 상세 정보를 불러올 수 없습니다. 잠시 후 다시 시도해주세요.");
            job.setJobType("RECRUIT");
            job.setWorkType("FULL_TIME");
            job.setPosition("미정");
            job.setSalaryMin(java.math.BigDecimal.ZERO);
            job.setSalaryMax(java.math.BigDecimal.ZERO);
            job.setWorkLocation("미정");
            job.setStatus("ACTIVE");
            job.setMemberId(1L);
            job.setViewCount(0);
            return job;
        }
    }
    public int insertJob(JobDTO jobDTO) {
        log.info("구인구직 등록 시작 - title: {}, jobType: {}", jobDTO.getTitle(), jobDTO.getJobType());
        try {
            validateJobData(jobDTO);
            cleanAndValidateJobData(jobDTO);
            if (jobDTO.getStatus() == null) {
                jobDTO.setStatus("ACTIVE");
            }
            if (jobDTO.getPriority() == null) {
                jobDTO.setPriority(0);
            }
            int result = jobMapper.insertJob(jobDTO);
            log.info("구인구직 등록 완료 - jobId: {}", jobDTO.getJobId());
            return result;
        } catch (Exception e) {
            log.error("구인구직 등록 중 오류 발생", e);
            throw new RuntimeException("구인구직 등록 중 오류가 발생했습니다.", e);
        }
    }
    public int updateJob(JobDTO jobDTO) {
        log.info("구인구직 수정 시작 - jobId: {}, title: {}", jobDTO.getJobId(), jobDTO.getTitle());
        try {
            JobDTO existingJob = jobMapper.findJobById(jobDTO.getJobId());
            if (existingJob == null) {
                throw new RuntimeException("수정할 구인구직을 찾을 수 없습니다. ID: " + jobDTO.getJobId());
            }
            validateJobData(jobDTO);
            cleanAndValidateJobData(jobDTO);
            if (jobDTO.getPriority() == null) {
                jobDTO.setPriority(0);
                log.warn("priority 값이 null이어서 0으로 자동 설정되었습니다. jobId: {}", jobDTO.getJobId());
            }
            int result = jobMapper.updateJob(jobDTO);
            log.info("구인구직 수정 완료 - jobId: {}", jobDTO.getJobId());
            return result;
        } catch (Exception e) {
            log.error("구인구직 수정 중 오류 발생 - jobId: {}", jobDTO.getJobId(), e);
            throw new RuntimeException("구인구직 수정 중 오류가 발생했습니다.", e);
        }
    }
    public int deleteJob(Long id) {
        log.info("구인구직 삭제 시작 - jobId: {}", id);
        try {
            int result = jobMapper.deleteJob(id);
            log.info("구인구직 삭제 완료 - jobId: {}", id);
            return result;
        } catch (Exception e) {
            log.error("구인구직 삭제 중 오류 발생 - jobId: {}", id, e);
            throw new RuntimeException("구인구직 삭제 중 오류가 발생했습니다.", e);
        }
    }
    public List<JobDTO> getPopularJobs() {
        try {
            return jobMapper.getPopularJobs();
        } catch (Exception e) {
            log.error("인기 구인구직 조회 중 오류 발생", e);
            return new ArrayList<>();
        }
    }
    public int getJobCount() {
        try {
            return jobMapper.getJobCount();
        } catch (Exception e) {
            log.error("구인구직 수 조회 중 오류 발생", e);
            return 0;
        }
    }
    private void validateJobData(JobDTO jobDTO) {
        if (jobDTO.getTitle() == null || jobDTO.getTitle().trim().isEmpty()) {
            throw new IllegalArgumentException("제목은 필수 입력값입니다.");
        }
        if (jobDTO.getContent() == null || jobDTO.getContent().trim().isEmpty()) {
            throw new IllegalArgumentException("내용은 필수 입력값입니다.");
        }
        if (jobDTO.getJobType() == null || jobDTO.getJobType().trim().isEmpty()) {
            throw new IllegalArgumentException("구인구직 유형은 필수 입력값입니다.");
        }
        if (jobDTO.getMemberId() == null) {
            throw new IllegalArgumentException("작성자 정보가 필요합니다.");
        }
    }
    private void cleanAndValidateJobData(JobDTO jobDTO) {
        log.info("데이터 정리 시작 - jobId: {}", jobDTO.getJobId());
        if (jobDTO.getTitle() != null) {
            jobDTO.setTitle(jobDTO.getTitle().trim());
        }
        if (jobDTO.getContent() != null) {
            jobDTO.setContent(jobDTO.getContent().trim());
        }
        if (jobDTO.getSalaryDescription() != null && !jobDTO.getSalaryDescription().trim().isEmpty()) {
            String cleanSalaryDesc = cleanDuplicateValues(jobDTO.getSalaryDescription());
            jobDTO.setSalaryDescription(cleanSalaryDesc);
            log.debug("급여 설명 정리됨: {} -> {}", jobDTO.getSalaryDescription(), cleanSalaryDesc);
        }
        if (jobDTO.getWorkHours() != null && !jobDTO.getWorkHours().trim().isEmpty()) {
            String cleanWorkHours = cleanDuplicateValues(jobDTO.getWorkHours());
            jobDTO.setWorkHours(cleanWorkHours);
            log.debug("근무시간 정리됨: {} -> {}", jobDTO.getWorkHours(), cleanWorkHours);
        }
        if (jobDTO.getFacilityName() != null) {
            jobDTO.setFacilityName(jobDTO.getFacilityName().trim());
        }
        if (jobDTO.getWorkLocation() != null) {
            jobDTO.setWorkLocation(jobDTO.getWorkLocation().trim());
        }
        if (jobDTO.getContactPhone() != null) {
            jobDTO.setContactPhone(jobDTO.getContactPhone().trim());
        }
        if (jobDTO.getQualifications() != null && !jobDTO.getQualifications().trim().isEmpty()) {
            String cleanQualifications = cleanDuplicateValues(jobDTO.getQualifications());
            jobDTO.setQualifications(cleanQualifications);
        }
        log.info("데이터 정리 완료 - jobId: {}", jobDTO.getJobId());
    }
    private String cleanDuplicateValues(String input) {
        if (input == null || input.trim().isEmpty()) {
            return input;
        }
        try {
            String[] values = input.split(",");
            return java.util.Arrays.stream(values)
                    .map(String::trim)
                    .filter(s -> !s.isEmpty())
                    .distinct()
                    .collect(java.util.stream.Collectors.joining(", "));
        } catch (Exception e) {
            log.warn("값 정리 중 오류 발생, 원본 값 반환: {}", input, e);
            return input.trim();
        }
    }
    @Transactional
    public void applyForJob(Long jobId, Long applicantMemberId) {
        log.info("구인공고 지원 로직 시작 - jobId: {}, applicantMemberId: {}", jobId, applicantMemberId);
        JobDTO jobDTO = jobMapper.findJobById(jobId);
        if (jobDTO == null) {
            log.warn("지원할 구인공고를 찾을 수 없습니다 - jobId: {}", jobId);
            throw new IllegalArgumentException("지원할 구인공고를 찾을 수 없습니다.");
        }
        int existingApplications = jobApplicationMapper.countByJobIdAndApplicantMemberId(jobId, applicantMemberId);
        if (existingApplications > 0) {
            log.warn("이미 지원한 구인공고입니다 - jobId: {}, applicantMemberId: {}", jobId, applicantMemberId);
            throw new IllegalArgumentException("이미 지원한 구인공고입니다.");
        }
        JobApplicationDTO jobApplication = new JobApplicationDTO();
        jobApplication.setJobId(jobId);
        jobApplication.setApplicantMemberId(applicantMemberId);
        jobApplication.setApplicationDate(LocalDateTime.now());
        jobApplication.setStatus("PENDING");
        jobApplicationMapper.insertJobApplication(jobApplication);
        jobMapper.incrementApplyCount(jobId);
        log.info("구인공고 지원 로직 완료 - jobId: {}, applicantMemberId: {}, 생성된 지원 ID: {}",
                jobId, applicantMemberId, jobApplication.getId());
    }
}
````

## File: build.gradle
````
plugins {
    id 'org.springframework.boot' version '2.7.18'
    id 'io.spring.dependency-management' version '1.0.15.RELEASE'
    id 'java'
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'

java {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}

repositories {
    mavenCentral()
}

dependencies {
    // Spring Boot 기본 의존성
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-actuator'
    developmentOnly 'org.springframework.boot:spring-boot-devtools'

    // Thymeleaf 템플릿 엔진
    implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'

    // MySQL 데이터베이스 연결 (로컬 개발용)
    runtimeOnly 'com.mysql:mysql-connector-j'
    
    // PostgreSQL 데이터베이스 연결 (Heroku용)
    runtimeOnly 'org.postgresql:postgresql'

    // MyBatis 연동
    implementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter:2.3.1'

    // Lombok (코드 자동 생성)
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'

    // 유효성 검증
    implementation 'org.springframework.boot:spring-boot-starter-validation'

    // JSON 처리
    implementation 'com.fasterxml.jackson.core:jackson-databind'
    implementation 'com.fasterxml.jackson.datatype:jackson-datatype-jsr310'

    // 테스트 의존성
    testImplementation 'org.springframework.boot:spring-boot-starter-test'

    // Spring Security
    implementation 'org.springframework.boot:spring-boot-starter-security'

    // Thymeleaf와 Spring Security 연동을 위한 확장 라이브러리
    implementation 'org.thymeleaf.extras:thymeleaf-extras-springsecurity5'

    // SpringDoc OpenAPI 의존성 추가 (임시 비활성화 - 기능 구현 완료 후 활성화 예정)
    // implementation 'org.springdoc:springdoc-openapi-ui:1.7.0'
    // implementation 'org.springdoc:springdoc-openapi-security:1.7.0'

}

tasks.named('test') {
    useJUnitPlatform()
}
````

## File: src/main/java/com/example/carelink/service/FacilityService.java
````java
package com.example.carelink.service;
import com.example.carelink.dao.FacilityMapper;
import com.example.carelink.dto.FacilityDTO;
import com.example.carelink.dto.FacilityImageDTO;
import com.example.carelink.common.Constants;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.multipart.MultipartFile;
import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.UUID;
@Service
public class FacilityService {
    private final FacilityMapper facilityMapper;
    private final FacilityImageService facilityImageService;
    private static final Logger log = LoggerFactory.getLogger(FacilityService.class);
    @Autowired
    public FacilityService(FacilityMapper facilityMapper, FacilityImageService facilityImageService) {
        this.facilityMapper = facilityMapper;
        this.facilityImageService = facilityImageService;
    }
    public List<FacilityDTO> searchFacilities(FacilityDTO searchDTO) {
        log.info("시설 검색 서비스 호출 - facilityName: {}, address: {}, facilityType: {}",
                searchDTO.getFacilityName(), searchDTO.getAddress(), searchDTO.getFacilityType());
        List<FacilityDTO> results = facilityMapper.searchFacilities(searchDTO);
        log.info("시설 검색 결과 - 총 {}개 시설 발견", results.size());
        for (FacilityDTO facility : results) {
            try {
                FacilityImageDTO mainImage = facilityImageService.getMainImageByFacilityId(facility.getFacilityId());
                if (mainImage != null && mainImage.getImagePath() != null) {
                    facility.setFacilityImage(mainImage.getImagePath());
                }
            } catch (Exception e) {
                log.warn("시설 검색 중 메인 이미지 조회 실패 - facilityId: {}", facility.getFacilityId(), e);
                facility.setFacilityImage(null);
            }
        }
        return results;
    }
    @Transactional(readOnly = true)
    public FacilityDTO getFacilityById(Long facilityId) {
        if (facilityId == null) {
            log.warn("시설 ID가 null입니다.");
            return null;
        }
        log.info("시설 상세 정보 조회 시작 - facilityId: {}", facilityId);
        FacilityDTO facility = facilityMapper.getFacilityById(facilityId);
        if (facility == null) {
            log.warn("시설을 찾을 수 없음 - facilityId: {}", facilityId);
            return null;
        }
        try {
            FacilityImageDTO mainImage = facilityImageService.getMainImageByFacilityId(facilityId);
            if (mainImage != null && mainImage.getImagePath() != null) {
                facility.setFacilityImage(mainImage.getImagePath());
                log.info("✅ 시설 메인 이미지 설정 완료 - imagePath: {}", mainImage.getImagePath());
            } else {
                log.info("⚠️ 시설 메인 이미지 없음 - facilityId: {}", facilityId);
                facility.setFacilityImage(null);
            }
        } catch (Exception e) {
            log.error("❌ 시설 메인 이미지 조회 중 오류 발생 - facilityId: {}", facilityId, e);
            facility.setFacilityImage(null);
        }
        log.info("시설 상세 정보 조회 완료 - facilityName: {}, status: {}, mainImage: {}",
                facility.getFacilityName(), facility.getStatus(), facility.getFacilityImage());
        return facility;
    }
    public List<FacilityDTO> getAllFacilities() {
        try {
            log.info("전체 시설 목록 조회 시작");
            List<FacilityDTO> facilities = facilityMapper.getAllFacilities();
            log.info("전체 시설 목록 조회 완료 - 조회된 건수: {}", facilities.size());
            return facilities;
        } catch (Exception e) {
            log.error("전체 시설 목록 조회 중 오류 발생", e);
            throw new RuntimeException("시설 목록을 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    public int insertFacility(FacilityDTO facilityDTO) {
        return facilityMapper.insertFacility(facilityDTO);
    }
    public int updateFacility(FacilityDTO facilityDTO) {
        return facilityMapper.updateFacility(facilityDTO);
    }
    public int deleteFacility(Long facilityId) {
        return facilityMapper.deleteFacility(facilityId);
    }
    public int countFacilitiesByRegion(String region) {
        return facilityMapper.countFacilitiesByRegion(region);
    }
    public int getFacilityCount() {
        try {
            return facilityMapper.getFacilityCount();
        } catch (Exception e) {
            return 3;
        }
    }
    @Transactional(readOnly = true)
    public List<FacilityDTO> getAllActiveFacilities() {
        log.info("활성화된 시설 목록 조회 시작");
        List<FacilityDTO> facilities = facilityMapper.getAllActiveFacilities();
        if (!facilities.isEmpty()) {
            FacilityDTO firstFacility = facilities.get(0);
            log.info("첫 번째 시설 정보 - ID: {}, 이름: {}, 승인상태: {}",
                    firstFacility.getFacilityId(),
                    firstFacility.getFacilityName(),
                    firstFacility.getStatus());
        }
        log.info("활성화된 시설 목록 조회 완료 - 조회된 건수: {}", facilities.size());
        return facilities;
    }
    public boolean validateFacilityStatus(FacilityDTO facility) {
        if (facility == null) {
            log.warn("시설 정보가 null입니다.");
            return false;
        }
        if (facility.isDeletedStatus()) {
            log.warn("삭제된 시설입니다 - facilityId: {}", facility.getFacilityId());
            return false;
        }
        if (facility.isPendingStatus()) {
            log.warn("승인되지 않은 시설입니다 - facilityId: {}", facility.getFacilityId());
            return false;
        }
        return true;
    }
    public List<FacilityDTO> getFacilitiesByMemberId(Long memberId) {
        try {
            log.info("회원의 시설 목록 조회 시작 - memberId: {}", memberId);
            List<FacilityDTO> facilities = facilityMapper.getFacilitiesByMemberId(memberId);
            if (!facilities.isEmpty()) {
                log.info("회원의 시설 목록 조회 완료 - memberId: {}, 시설 수: {}",
                        memberId, facilities.size());
            } else {
                log.info("회원의 시설 정보 없음 - memberId: {}", memberId);
            }
            return facilities;
        } catch (Exception e) {
            log.error("회원의 시설 목록 조회 중 오류 발생 - memberId: {}", memberId, e);
            throw new RuntimeException("시설 정보 조회에 실패했습니다.", e);
        }
    }
    public FacilityDTO getFacilityByMemberId(Long memberId) {
        try {
            log.info("회원의 첫 번째 시설 정보 조회 시작 - memberId: {}", memberId);
            List<FacilityDTO> facilities = facilityMapper.getFacilitiesByMemberId(memberId);
            if (!facilities.isEmpty()) {
                FacilityDTO facility = facilities.get(0);
                log.info("회원의 첫 번째 시설 정보 조회 완료 - memberId: {}, facilityId: {}, facilityName: {}",
                        memberId, facility.getFacilityId(), facility.getFacilityName());
                return facility;
            } else {
                log.info("회원의 시설 정보 없음 - memberId: {}", memberId);
                return null;
            }
        } catch (Exception e) {
            log.error("회원의 시설 정보 조회 중 오류 발생 - memberId: {}", memberId, e);
            throw new RuntimeException("시설 정보 조회에 실패했습니다.", e);
        }
    }
    @Transactional
    public void updateFacility(FacilityDTO facilityDTO, MultipartFile facilityImageFile) {
        try {
            log.info("시설 정보 수정 시작 - facilityId: {}, facilityName: {}",
                    facilityDTO.getFacilityId(), facilityDTO.getFacilityName());
            if (facilityImageFile != null && !facilityImageFile.isEmpty()) {
                String imagePath = saveFacilityImage(facilityImageFile, facilityDTO.getFacilityId().toString());
                facilityDTO.setFacilityImage(imagePath);
                log.info("시설 이미지 업데이트 - facilityId: {}, imagePath: {}",
                        facilityDTO.getFacilityId(), imagePath);
            }
            int result = facilityMapper.updateFacility(facilityDTO);
            if (result == 0) {
                throw new RuntimeException("시설 정보 수정에 실패했습니다.");
            }
            log.info("시설 정보 수정 완료 - facilityId: {}", facilityDTO.getFacilityId());
        } catch (Exception e) {
            log.error("시설 정보 수정 중 오류 발생 - facilityId: {}", facilityDTO.getFacilityId(), e);
            throw new RuntimeException("시설 정보 수정에 실패했습니다.", e);
        }
    }
    private String saveFacilityImage(MultipartFile file, String facilityId) {
        try {
            String uploadDir = Constants.FACILITY_UPLOAD_PATH;
            File uploadDirFile = new File(uploadDir);
            if (!uploadDirFile.exists()) {
                boolean created = uploadDirFile.mkdirs();
                log.info("업로드 디렉토리 생성: {} - {}", uploadDir, created ? "성공" : "실패");
            }
            String originalFilename = file.getOriginalFilename();
            String extension = "";
            if (originalFilename != null && originalFilename.contains(".")) {
                extension = originalFilename.substring(originalFilename.lastIndexOf("."));
            }
            String savedFilename = "facility_" + facilityId + "_" + UUID.randomUUID().toString() + extension;
            File savedFile = new File(uploadDir + savedFilename);
            file.transferTo(savedFile);
            log.info("시설 이미지 저장 완료: {}", savedFile.getAbsolutePath());
            return "/uploads/facility/" + savedFilename;
        } catch (IOException e) {
            log.error("시설 이미지 저장 중 오류 발생: facilityId={}", facilityId, e);
            throw new RuntimeException("이미지 파일 저장에 실패했습니다.", e);
        }
    }
    @Transactional(readOnly = true)
    public List<FacilityDTO> getFacilitiesByApprovalStatus(String status) {
        try {
            log.info("승인 상태별 시설 목록 조회 - status: {}", status);
            List<FacilityDTO> facilities = facilityMapper.getFacilitiesByApprovalStatus(status);
            log.info("승인 상태별 시설 목록 조회 완료 - status: {}, count: {}", status, facilities.size());
            return facilities;
        } catch (Exception e) {
            log.error("승인 상태별 시설 목록 조회 중 오류 발생 - status: {}", status, e);
            throw new RuntimeException("시설 목록 조회에 실패했습니다.", e);
        }
    }
    @Transactional
    public void updateFacilityApprovalStatus(Long facilityId, String newStatus, String reason) {
        try {
            log.info("시설 승인 상태 업데이트 - facilityId: {}, newStatus: {}, reason: {}",
                    facilityId, newStatus, reason);
            int result = facilityMapper.updateFacilityApprovalStatus(facilityId, newStatus, reason);
            if (result == 0) {
                throw new RuntimeException("시설 승인 상태 업데이트에 실패했습니다.");
            }
            log.info("시설 승인 상태 업데이트 완료 - facilityId: {}, newStatus: {}", facilityId, newStatus);
        } catch (Exception e) {
            log.error("시설 승인 상태 업데이트 중 오류 발생 - facilityId: {}", facilityId, e);
            throw new RuntimeException("시설 승인 상태 업데이트에 실패했습니다.", e);
        }
    }
    @Transactional(readOnly = true)
    public int countPendingFacilities() {
        try {
            int count = facilityMapper.countFacilitiesByStatus("PENDING");
            log.info("승인 대기 시설 수 조회 완료 - count: {}", count);
            return count;
        } catch (Exception e) {
            log.error("승인 대기 시설 수 조회 중 오류 발생", e);
            return 0;
        }
    }
    @Transactional(readOnly = true)
    public int countApprovedFacilities() {
        try {
            int count = facilityMapper.countFacilitiesByStatus("APPROVED");
            log.info("승인된 시설 수 조회 완료 - count: {}", count);
            return count;
        } catch (Exception e) {
            log.error("승인된 시설 수 조회 중 오류 발생", e);
            return 0;
        }
    }
    @Transactional(readOnly = true)
    public int countRejectedFacilities() {
        try {
            int count = facilityMapper.countFacilitiesByStatus("REJECTED");
            log.info("거부된 시설 수 조회 완료 - count: {}", count);
            return count;
        } catch (Exception e) {
            log.error("거부된 시설 수 조회 중 오류 발생", e);
            return 0;
        }
    }
}
````

## File: src/main/java/com/example/carelink/service/MemberService.java
````java
package com.example.carelink.service;
import com.example.carelink.dao.MemberMapper;
import com.example.carelink.dao.FacilityMapper;
import com.example.carelink.dao.BoardMapper;
import com.example.carelink.dao.ReviewMapper;
import com.example.carelink.dao.JobMapper;
import com.example.carelink.dto.LoginDTO;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.dto.FacilityDTO;
import org.springframework.web.multipart.MultipartFile;
import java.io.File;
import java.io.IOException;
import java.util.UUID;
import com.example.carelink.dto.BoardDTO;
import com.example.carelink.dto.ReviewDTO;
import com.example.carelink.dto.JobDTO;
import com.example.carelink.common.Constants;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import java.util.List;
import java.util.Map;
import java.util.HashMap;
import java.util.ArrayList;
import java.util.UUID;
@Slf4j
@Service
@RequiredArgsConstructor
public class MemberService {
    private final MemberMapper memberMapper;
    private final FacilityMapper facilityMapper;
    private final BoardMapper boardMapper;
    private final ReviewMapper reviewMapper;
    private final JobMapper jobMapper;
    private final PasswordEncoder passwordEncoder;
    public MemberDTO login(LoginDTO loginDTO) {
        try {
            MemberDTO member = memberMapper.findByUserId(loginDTO.getUserId());
            if (member == null) {
                log.warn("로그인 실패: 존재하지 않는 사용자 ID: {}", loginDTO.getUserId());
                return null;
            }
            if (member.getIsDeleted() != null && member.getIsDeleted()) {
                log.warn("로그인 실패: 삭제 처리된 계정입니다. ID: {}", loginDTO.getUserId());
                return null;
            }
            if (member.getIsActive() != null && !member.getIsActive()) {
                log.warn("로그인 실패: 비활성화된 계정: {}", loginDTO.getUserId());
                return null;
            }
            if (member.getLoginFailCount() >= Constants.MAX_LOGIN_ATTEMPTS) {
                log.warn("로그인 실패: 로그인 시도 횟수 초과. ID: {}", loginDTO.getUserId());
                return null;
            }
            log.info("=== 비밀번호 검증 디버그 ===");
            log.info("DB 저장된 비밀번호: {}", member.getPassword());
            log.info("입력된 비밀번호: {}", loginDTO.getPassword());
            boolean passwordMatches = loginDTO.getPassword().equals(member.getPassword());
            log.info("비밀번호 매칭 결과: {}", passwordMatches);
            if (passwordMatches) {
                memberMapper.updateLoginSuccess(member.getMemberId());
                log.info("로그인 성공: {}", loginDTO.getUserId());
                return member;
            } else {
                memberMapper.updateLoginFail(member.getMemberId());
                log.warn("로그인 실패: 비밀번호 불일치. ID: {}, DB 비밀번호 시작: {}",
                    loginDTO.getUserId(), member.getPassword().substring(0, Math.min(10, member.getPassword().length())));
                return null;
            }
        } catch (Exception e) {
            log.error("로그인 처리 중 오류 발생: {}", loginDTO.getUserId(), e);
            throw new RuntimeException("로그인 처리 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional
    public void join(MemberDTO memberDTO) {
        join(memberDTO, null);
    }
    @Transactional
    public void join(MemberDTO memberDTO, MultipartFile facilityImageFile) {
        try {
            log.info("회원가입 처리 시작 - userId: {}, address: {}, detailAddress: {}",
                    memberDTO.getUserId(), memberDTO.getAddress(), memberDTO.getDetailAddress());
            if (isUserIdDuplicate(memberDTO.getUserId())) {
                throw new IllegalArgumentException("이미 사용중인 아이디입니다.");
            }
            if (memberDTO.getEmail() != null && !memberDTO.getEmail().trim().isEmpty()) {
                if (memberMapper.existsByEmail(memberDTO.getEmail())) {
                    throw new IllegalArgumentException("이미 사용중인 이메일입니다.");
                }
            }
            memberDTO.setMemberId(null);
            if (memberDTO.getRole() == null || memberDTO.getRole().isEmpty()) {
                memberDTO.setRole(Constants.MEMBER_ROLE_USER);
            }
            memberDTO.setIsActive(true);
            memberDTO.setLoginFailCount(0);
            memberDTO.setIsDeleted(false);
            if (memberDTO.getPhone() != null && memberDTO.getPhone().isEmpty()) {
                memberDTO.setPhone(null);
            }
            if (memberDTO.getAddress() != null && memberDTO.getAddress().isEmpty()) {
                memberDTO.setAddress(null);
            }
            if (memberDTO.getDetailAddress() != null && memberDTO.getDetailAddress().isEmpty()) {
                memberDTO.setDetailAddress(null);
            }
            memberDTO.setProfileImage(null);
            memberDTO.setLastLoginAt(null);
            log.info("DB 저장 전 memberDTO - address: {}, detailAddress: {}",
                    memberDTO.getAddress(), memberDTO.getDetailAddress());
            int result = memberMapper.insertMember(memberDTO);
            if (result == 0) {
                throw new RuntimeException("회원가입 데이터 저장에 실패했습니다. (영향받은 행 없음)");
            }
            log.info("회원가입 DB 저장 성공 - memberId: {}", memberDTO.getMemberId());
            if (Constants.MEMBER_ROLE_FACILITY.equals(memberDTO.getRole()) && memberDTO.getFacilityName() != null) {
                FacilityDTO facilityDTO = new FacilityDTO();
                facilityDTO.setFacilityName(memberDTO.getFacilityName());
                facilityDTO.setFacilityType(memberDTO.getFacilityType());
                facilityDTO.setAddress(memberDTO.getAddress());
                facilityDTO.setDetailAddress(memberDTO.getDetailAddress());
                facilityDTO.setPhone(memberDTO.getFacilityPhone());
                facilityDTO.setDescription(memberDTO.getDescription());
                facilityDTO.setHomepage(memberDTO.getHomepage());
                facilityDTO.setCapacity(memberDTO.getCapacity());
                facilityDTO.setOperatingHours(memberDTO.getOperatingHours());
                facilityDTO.setFeatures(memberDTO.getFeatures());
                facilityDTO.setLatitude(memberDTO.getLatitude());
                facilityDTO.setLongitude(memberDTO.getLongitude());
                facilityDTO.setRegisteredMemberId(memberDTO.getMemberId());
                facilityDTO.setIsApproved(false);
                facilityDTO.setApprovalStatus("PENDING");
                if (facilityImageFile != null && !facilityImageFile.isEmpty()) {
                    String imagePath = saveFacilityImage(facilityImageFile, memberDTO.getUserId());
                    facilityDTO.setFacilityImage(imagePath);
                }
                int facilityResult = facilityMapper.insertFacility(facilityDTO);
                if (facilityResult == 0) {
                    throw new RuntimeException("시설 정보 저장에 실패했습니다.");
                }
                log.info("시설 정보 저장 성공: {}", facilityDTO.getFacilityName());
            }
            log.info("회원가입 성공: {}", memberDTO.getUserId());
        } catch (IllegalArgumentException e) {
            log.warn("회원가입 실패 (비즈니스 로직): {}", e.getMessage());
            throw e;
        } catch (Exception e) {
            log.error("회원가입 처리 중 알 수 없는 오류 발생: {}", memberDTO.getUserId(), e);
            throw new RuntimeException("회원가입 처리 중 알 수 없는 오류가 발생했습니다. 잠시 후 다시 시도해주세요.", e);
        }
    }
    @Transactional(readOnly = true)
    public boolean isUserIdDuplicate(String userId) {
        try {
            return memberMapper.existsByUserId(userId);
        } catch (Exception e) {
            log.error("사용자 ID 중복 체크 중 오류 발생: {}", userId, e);
            throw new RuntimeException("중복 체크 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional(readOnly = true)
    public MemberDTO findById(Long memberId) {
        try {
            return memberMapper.findById(memberId);
        } catch (Exception e) {
            log.error("회원 정보 조회 중 오류 발생: {}", memberId, e);
            throw new RuntimeException("회원 정보 조회 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional(readOnly = true)
    public MemberDTO getMemberByUserId(String userId) {
        try {
            return memberMapper.findByUserId(userId);
        } catch (Exception e) {
            log.error("사용자 ID로 회원 정보 조회 중 오류 발생: {}", userId, e);
            throw new RuntimeException("회원 정보 조회 중 오류가 발생했습니다.", e);
        }
    }
    public void updateMember(MemberDTO memberDTO, MultipartFile profileImageFile) throws Exception {
        log.info("회원정보 수정 요청: memberId={}, name={}, email={}",
                memberDTO.getMemberId(), memberDTO.getName(), memberDTO.getEmail());
        MemberDTO existingMember = memberMapper.findById(memberDTO.getMemberId());
        if (existingMember == null) {
            throw new IllegalArgumentException("존재하지 않는 회원입니다.");
        }
        log.info("기존 회원 정보: memberId={}, name={}, email={}",
                existingMember.getMemberId(), existingMember.getName(), existingMember.getEmail());
        memberDTO.setPassword(existingMember.getPassword());
        memberDTO.setRole(existingMember.getRole());
        memberDTO.setIsActive(existingMember.getIsActive());
        memberDTO.setIsDeleted(existingMember.getIsDeleted());
        memberDTO.setLoginFailCount(existingMember.getLoginFailCount());
        memberDTO.setLastLoginAt(existingMember.getLastLoginAt());
        memberDTO.setCreatedAt(existingMember.getCreatedAt());
        if (profileImageFile != null && !profileImageFile.isEmpty()) {
            String profileImagePath = saveProfileImage(profileImageFile, existingMember.getUserId());
            memberDTO.setProfileImage(profileImagePath);
            if (existingMember.getProfileImage() != null && !existingMember.getProfileImage().isEmpty()) {
                try {
                    String projectRoot = System.getProperty("user.dir");
                    String oldImagePath = existingMember.getProfileImage();
                    if (oldImagePath.startsWith("/uploads/profile/")) {
                        String oldFileName = oldImagePath.substring("/uploads/profile/".length());
                        File oldFile = new File(projectRoot + "/src/main/resources/static" + oldImagePath);
                        if (oldFile.exists() && oldFile.delete()) {
                            log.info("기존 프로필 이미지 삭제 성공: {}", oldFile.getAbsolutePath());
                        }
                    }
                } catch (Exception e) {
                    log.warn("기존 프로필 이미지 삭제 실패: {}", e.getMessage());
                }
            }
        } else {
            memberDTO.setProfileImage(existingMember.getProfileImage());
            log.debug("새로운 프로필 이미지가 없어 기존 이미지 유지: {}", existingMember.getProfileImage());
        }
        log.info("업데이트할 회원 정보: memberId={}, name={}, email={}, phone={}, address={}",
                memberDTO.getMemberId(), memberDTO.getName(), memberDTO.getEmail(),
                memberDTO.getPhone(), memberDTO.getAddress());
        int result = memberMapper.updateMember(memberDTO);
        log.info("회원정보 업데이트 쿼리 실행 결과: {} 행이 영향받음", result);
        if (result == 0) {
            throw new RuntimeException("회원 정보 수정에 실패했습니다. 영향받은 행: 0");
        }
        log.info("회원정보 수정 완료: userId={}, memberId={}", memberDTO.getUserId(), memberDTO.getMemberId());
    }
    @Transactional
    public void changePassword(String userId, String currentPassword, String newPassword, String confirmNewPassword) {
        MemberDTO member = memberMapper.findByUserId(userId);
        if (member == null) {
            throw new IllegalArgumentException("사용자를 찾을 수 없습니다.");
        }
        if (!currentPassword.equals(member.getPassword())) {
            throw new IllegalArgumentException("현재 비밀번호가 일치하지 않습니다.");
        }
        if (!newPassword.equals(confirmNewPassword)) {
            throw new IllegalArgumentException("새 비밀번호와 확인 비밀번호가 일치하지 않습니다.");
        }
        if (newPassword.length() < 8) {
            throw new IllegalArgumentException("새 비밀번호는 최소 8자 이상이어야 합니다.");
        }
        member.setPassword(newPassword);
        int result = memberMapper.updatePassword(member);
        if (result == 0) {
            throw new RuntimeException("비밀번호 변경에 실패했습니다.");
        }
        log.info("비밀번호 변경 서비스: {} 사용자의 비밀번호가 성공적으로 변경됨.", userId);
    }
    @Transactional(readOnly = true)
    public Map<String, Integer> getUserContentCounts(Long memberId) {
        Map<String, Integer> counts = new HashMap<>();
        try {
            List<BoardDTO> boards = boardMapper.findBoardsByMemberId(memberId);
            List<ReviewDTO> reviews = reviewMapper.findReviewsByMemberId(memberId);
            List<JobDTO> jobs = jobMapper.findJobsByMemberId(memberId);
            int boardCount = boards != null ? boards.size() : 0;
            int reviewCount = reviews != null ? reviews.size() : 0;
            int jobCount = jobs != null ? jobs.size() : 0;
            counts.put("board", boardCount);
            counts.put("review", reviewCount);
            counts.put("job", jobCount);
            counts.put("total", boardCount + reviewCount + jobCount);
            log.info("사용자 콘텐츠 개수 조회: memberId={}, 결과={}", memberId, counts);
            return counts;
        } catch (Exception e) {
            log.error("콘텐츠 개수 조회 중 오류: memberId={}", memberId, e);
            counts.put("board", 0);
            counts.put("review", 0);
            counts.put("job", 0);
            counts.put("total", 0);
            return counts;
        }
    }
    @Transactional(readOnly = true)
    public Map<String, Object> getMyPosts(Long memberId, String type, int page, int pageSize, int offset) {
        Map<String, Object> result = new HashMap<>();
        List<Map<String, Object>> posts = new ArrayList<>();
        try {
            Map<String, Integer> contentCounts = getUserContentCounts(memberId);
            result.put("contentCounts", contentCounts);
            if ("board".equals(type)) {
                List<BoardDTO> boards = boardMapper.findBoardsByMemberId(memberId);
                for (BoardDTO board : boards) {
                    Map<String, Object> post = new HashMap<>();
                    post.put("id", board.getBoardId());
                    post.put("title", board.getTitle());
                    post.put("content", board.getContent());
                    post.put("createdAt", board.getCreatedAt());
                    post.put("viewCount", board.getViewCount() != null ? board.getViewCount() : 0);
                    post.put("likeCount", board.getLikeCount() != null ? board.getLikeCount() : 0);
                    post.put("rating", null);
                    post.put("salary", null);
                    post.put("type", "board");
                    post.put("category", board.getBoardType());
                    post.put("url", "/board/detail/" + board.getBoardId());
                    posts.add(post);
                }
            } else if ("review".equals(type)) {
                List<ReviewDTO> reviews = reviewMapper.findReviewsByMemberId(memberId);
                for (ReviewDTO review : reviews) {
                    Map<String, Object> post = new HashMap<>();
                    post.put("id", review.getReviewId());
                    post.put("title", review.getTitle());
                    post.put("content", review.getContent());
                    post.put("createdAt", review.getCreatedAt());
                    post.put("viewCount", null);
                    post.put("likeCount", review.getLikeCount() != null ? review.getLikeCount() : 0);
                    post.put("rating", review.getRating());
                    post.put("salary", null);
                    post.put("type", "review");
                    post.put("category", "리뷰");
                    post.put("url", "/review/detail/" + review.getReviewId());
                    posts.add(post);
                }
            } else if ("job".equals(type)) {
                List<JobDTO> jobs = jobMapper.findJobsByMemberId(memberId);
                for (JobDTO job : jobs) {
                    Map<String, Object> post = new HashMap<>();
                    post.put("id", job.getJobId());
                    post.put("title", job.getTitle());
                    post.put("content", job.getContent());
                    post.put("createdAt", job.getCreatedAt());
                    post.put("viewCount", job.getViewCount() != null ? job.getViewCount() : 0);
                    post.put("likeCount", null);
                    post.put("rating", null);
                    post.put("salary", job.getSalaryDescription());
                    post.put("type", "job");
                    post.put("category", job.getJobType());
                    post.put("url", "/job/detail/" + job.getJobId());
                    posts.add(post);
                }
            } else {
                List<BoardDTO> boards = boardMapper.findBoardsByMemberId(memberId);
                List<ReviewDTO> reviews = reviewMapper.findReviewsByMemberId(memberId);
                List<JobDTO> jobs = jobMapper.findJobsByMemberId(memberId);
                for (BoardDTO board : boards) {
                    Map<String, Object> post = new HashMap<>();
                    post.put("id", board.getBoardId());
                    post.put("title", board.getTitle());
                    post.put("content", board.getContent());
                    post.put("createdAt", board.getCreatedAt());
                    post.put("viewCount", board.getViewCount() != null ? board.getViewCount() : 0);
                    post.put("likeCount", board.getLikeCount() != null ? board.getLikeCount() : 0);
                    post.put("rating", null);
                    post.put("salary", null);
                    post.put("type", "board");
                    post.put("category", board.getBoardType());
                    post.put("url", "/board/detail/" + board.getBoardId());
                    posts.add(post);
                }
                for (ReviewDTO review : reviews) {
                    Map<String, Object> post = new HashMap<>();
                    post.put("id", review.getReviewId());
                    post.put("title", review.getTitle());
                    post.put("content", review.getContent());
                    post.put("createdAt", review.getCreatedAt());
                    post.put("viewCount", null);
                    post.put("likeCount", review.getLikeCount() != null ? review.getLikeCount() : 0);
                    post.put("rating", review.getRating());
                    post.put("salary", null);
                    post.put("type", "review");
                    post.put("category", "리뷰");
                    post.put("url", "/review/detail/" + review.getReviewId());
                    posts.add(post);
                }
                for (JobDTO job : jobs) {
                    Map<String, Object> post = new HashMap<>();
                    post.put("id", job.getJobId());
                    post.put("title", job.getTitle());
                    post.put("content", job.getContent());
                    post.put("createdAt", job.getCreatedAt());
                    post.put("viewCount", job.getViewCount() != null ? job.getViewCount() : 0);
                    post.put("likeCount", null);
                    post.put("rating", null);
                    post.put("salary", job.getSalaryDescription());
                    post.put("type", "job");
                    post.put("category", job.getJobType());
                    post.put("url", "/job/detail/" + job.getJobId());
                    posts.add(post);
                }
            }
            posts.sort((a, b) -> ((java.time.LocalDateTime) b.get("createdAt")).compareTo((java.time.LocalDateTime) a.get("createdAt")));
            int totalCount = posts.size();
            int startIndex = Math.min(offset, totalCount);
            int endIndex = Math.min(offset + pageSize, totalCount);
            List<Map<String, Object>> pagedPosts = posts.subList(startIndex, endIndex);
            result.put("posts", pagedPosts);
            result.put("totalCount", totalCount);
            log.info("내가 쓴 글 조회 완료: memberId={}, type={}, 총{}\uac1c, 현재페이지 {}\uac1c",
                    memberId, type, totalCount, pagedPosts.size());
            return result;
        } catch (Exception e) {
            log.error("내가 쓴 글 조회 중 오류: memberId={}, type={}", memberId, type, e);
            result.put("posts", new ArrayList<>());
            result.put("totalCount", 0);
            result.put("contentCounts", Map.of("board", 0, "review", 0, "job", 0, "total", 0));
            return result;
        }
    }
    @Transactional
    public String deleteMemberWithOption(String userId, String deleteOption) {
        try {
            if ("anonymous".equals(deleteOption)) {
                int result = memberMapper.anonymizeMember(userId);
                if (result == 0) {
                    throw new RuntimeException("회원 익명화 처리 중 오류가 발생했습니다.");
                }
                log.info("회원 익명화 처리 완료: {}", userId);
                return "회원 탈퇴가 완료되었습니다. 작성하신 게시글은 '탈퇴회원'으로 표시됩니다.";
            } else if ("complete".equals(deleteOption)) {
                deleteAllUserContent(userId);
                int result = memberMapper.hardDeleteMember(userId);
                if (result == 0) {
                    throw new RuntimeException("회원 완전삭제 처리 중 오류가 발생했습니다.");
                }
                log.info("회원 완전삭제 처리 완료: {}", userId);
                return "회원 탈퇴가 완료되었습니다. 모든 개인정보와 작성 콘텐츠가 완전히 삭제되었습니다.";
            } else {
                int result = memberMapper.softDeleteMember(userId);
                if (result == 0) {
                    throw new RuntimeException("회원 탈퇴 처리 중 오류가 발생했습니다.");
                }
                log.info("회원 논리삭제 처리 완료: {}", userId);
                return "회원 탈퇴가 완료되었습니다.";
            }
        } catch (Exception e) {
            log.error("회원 탈퇴 처리 중 오류 발생: userId={}, option={}", userId, deleteOption, e);
            throw new RuntimeException("회원 탈퇴 처리 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional
    public void deleteAllUserContent(String userId) {
        try {
            MemberDTO member = memberMapper.findByUserId(userId);
            if (member == null) {
                throw new RuntimeException("회원 정보를 찾을 수 없습니다.");
            }
            Long memberId = member.getMemberId();
            if (Constants.MEMBER_ROLE_FACILITY.equals(member.getRole())) {
                jobMapper.deleteByFacilityMemberId(memberId);
                log.info("시설 구인공고 삭제 완료: memberId={}", memberId);
                reviewMapper.deleteByFacilityMemberId(memberId);
                log.info("시설 리뷰 삭제 완료: memberId={}", memberId);
                facilityMapper.deleteByMemberId(memberId);
                log.info("시설 정보 삭제 완료: memberId={}", memberId);
            }
            boardMapper.deleteByMemberId(memberId);
            reviewMapper.deleteByMemberId(memberId);
            jobMapper.deleteByMemberId(memberId);
            log.info("사용자 콘텐츠 삭제 완료: userId={}, memberId={}", userId, memberId);
        } catch (Exception e) {
            log.error("사용자 콘텐츠 삭제 중 오류: userId={}", userId, e);
            throw e;
        }
    }
    @Transactional
    public void deleteMember(String userId) {
        int result = memberMapper.softDeleteMember(userId);
        if (result == 0) {
            throw new RuntimeException("회원 탈퇴 처리 중 오류가 발생했습니다.");
        }
        log.info("회원 탈퇴 처리 완료: {}", userId);
    }
    private String saveProfileImage(MultipartFile file, String userId) {
        try {
            String uploadDir = Constants.PROFILE_UPLOAD_PATH;
            File uploadDirFile = new File(uploadDir);
            if (!uploadDirFile.exists()) {
                boolean created = uploadDirFile.mkdirs();
                log.info("프로필 이미지 업로드 디렉토리 생성: {} - {}", uploadDir, created ? "성공" : "실패");
            }
            String originalFilename = file.getOriginalFilename();
            String extension = "";
            if (originalFilename != null && originalFilename.contains(".")) {
                extension = originalFilename.substring(originalFilename.lastIndexOf("."));
            }
            String savedFilename = "profile_" + userId + "_" + UUID.randomUUID().toString() + extension;
            File savedFile = new File(uploadDir + savedFilename);
            file.transferTo(savedFile);
            log.info("프로필 이미지 저장 완료: {}", savedFile.getAbsolutePath());
            return "/uploads/profile/" + savedFilename;
        } catch (IOException e) {
            log.error("프로필 이미지 저장 중 오류 발생: userId={}", userId, e);
            throw new RuntimeException("프로필 이미지 저장에 실패했습니다.", e);
        }
    }
    private String saveFacilityImage(MultipartFile file, String userId) {
        try {
            String uploadDir = Constants.FACILITY_UPLOAD_PATH;
            File uploadDirFile = new File(uploadDir);
            if (!uploadDirFile.exists()) {
                boolean created = uploadDirFile.mkdirs();
                log.info("시설 이미지 업로드 디렉토리 생성: {} - {}", uploadDir, created ? "성공" : "실패");
            }
            String originalFilename = file.getOriginalFilename();
            String extension = "";
            if (originalFilename != null && originalFilename.contains(".")) {
                extension = originalFilename.substring(originalFilename.lastIndexOf("."));
            }
            String savedFilename = "facility_" + userId + "_" + UUID.randomUUID().toString() + extension;
            File savedFile = new File(uploadDir + savedFilename);
            file.transferTo(savedFile);
            log.info("시설 이미지 저장 완료: {}", savedFile.getAbsolutePath());
            return "/uploads/facility/" + savedFilename;
        } catch (IOException e) {
            log.error("시설 이미지 저장 중 오류 발생: userId={}", userId, e);
            throw new RuntimeException("시설 이미지 저장에 실패했습니다.", e);
        }
    }
    @Transactional(readOnly = true)
    public int getTotalMembersCount() {
        try {
            return memberMapper.getTotalCount();
        } catch (Exception e) {
            log.error("전체 회원 수 조회 중 오류 발생", e);
            throw new RuntimeException("회원 수 조회 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional(readOnly = true)
    public int getMemberCount() {
        try {
            return memberMapper.getMemberCount();
        } catch (Exception e) {
            log.error("회원 수 조회 중 오류 발생", e);
            return 0;
        }
    }
    @Transactional(readOnly = true)
    public List<MemberDTO> getMembersWithPaging(MemberDTO searchDTO) {
        try {
            return memberMapper.findMembersWithPaging(searchDTO);
        } catch (Exception e) {
            log.error("페이징된 회원 목록 조회 중 오류 발생", e);
            throw new RuntimeException("회원 목록 조회 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional(readOnly = true)
    public List<MemberDTO> getMembersByRole(String role) {
        try {
            return memberMapper.findMembersByRole(role);
        } catch (Exception e) {
            log.error("역할별 회원 목록 조회 중 오류 발생: {}", role, e);
            throw new RuntimeException("역할별 회원 목록 조회 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional
    public void updateMemberStatus(Long memberId, boolean isActive) {
        try {
            memberMapper.updateMemberStatus(memberId, isActive);
            log.info("회원 상태 변경 완료: memberId={}, isActive={}", memberId, isActive);
        } catch (Exception e) {
            log.error("회원 상태 변경 중 오류 발생: memberId={}", memberId, e);
            throw new RuntimeException("회원 상태 변경 중 오류가 발생했습니다.", e);
        }
    }
    @Transactional(readOnly = true)
    public int getTotalMemberCount() {
        try {
            return memberMapper.getTotalCount();
        } catch (Exception e) {
            log.error("전체 회원 수 조회 중 오류 발생", e);
            return 0;
        }
    }
    @Transactional(readOnly = true)
    public int getFacilityMemberCount() {
        try {
            return memberMapper.getFacilityMemberCount();
        } catch (Exception e) {
            log.error("시설 회원 수 조회 중 오류 발생", e);
            return 0;
        }
    }
    @Transactional(readOnly = true)
    public List<MemberDTO> getMembersByRole(String role, int page, int pageSize) {
        try {
            log.info("역할별 회원 목록 조회 시작: role={}, page={}, pageSize={}", role, page, pageSize);
            String searchRole = "ALL".equals(role) ? null : role;
            List<MemberDTO> members = memberMapper.findMembersByRole(searchRole);
            log.info("역할별 회원 조회 완료: role={}, count={} 명", role, members.size());
            return members;
        } catch (Exception e) {
            log.error("역할별 회원 목록 조회 중 오류 발생: role={}, page={}", role, page, e);
            return new ArrayList<>();
        }
    }
    @Transactional(readOnly = true)
    public int getMemberCountByRole(String role) {
        try {
            if ("ALL".equals(role)) {
                return memberMapper.getTotalCount();
            } else if ("FACILITY".equals(role)) {
                return memberMapper.getFacilityMemberCount();
            } else if ("USER".equals(role)) {
                return memberMapper.getUserMemberCount();
            } else {
                return memberMapper.getMemberCountByRole(role);
            }
        } catch (Exception e) {
            log.error("역할별 회원 수 조회 중 오류 발생: role={}", role, e);
            return 0;
        }
    }
    @Transactional
    public boolean toggleMemberActive(Long memberId) {
        try {
            MemberDTO member = memberMapper.findById(memberId);
            if (member == null) {
                throw new RuntimeException("회원을 찾을 수 없습니다.");
            }
            boolean newStatus = !Boolean.TRUE.equals(member.getIsActive());
            memberMapper.updateMemberStatus(memberId, newStatus);
            log.info("회원 활성화 상태 토글 완료: memberId={}, newStatus={}", memberId, newStatus);
            return true;
        } catch (Exception e) {
            log.error("회원 활성화 상태 토글 중 오류 발생: memberId={}", memberId, e);
            return false;
        }
    }
}
````

## File: src/main/resources/application.yml
````yaml
server:
  port: 8080
  servlet:
    context-path: /
    encoding:
      charset: UTF-8
      enabled: true
      force: true
spring:
  jackson:
    serialization:
      write-dates-as-timestamps: false
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: ${DB_URL:jdbc:mysql://localhost:3306/carelink?useSSL=false&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=UTF-8}
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:mysql}
    hikari:
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      maximum-pool-size: 10
      minimum-idle: 5
      pool-name: CareLink-HikariCP
      auto-commit: false
      transaction-isolation: TRANSACTION_READ_COMMITTED
  thymeleaf:
    prefix: classpath:/templates/
    suffix: .html
    mode: HTML
    encoding: UTF-8
    cache: false
  servlet:
    multipart:
      max-file-size: 50MB
      max-request-size: 50MB
mybatis:
  type-aliases-package: com.example.carelink.dto
  mapper-locations: classpath:mapper/*.xml
  configuration:
    map-underscore-to-camel-case: true
    jdbc-type-for-null: varchar
    default-fetch-size: 100
    default-statement-timeout: 30
logging:
  level:
    root: INFO
    com.example.carelink: DEBUG
    com.example.carelink.dao: DEBUG
    org.springframework.web: DEBUG
    org.springframework.jdbc: DEBUG
    org.mybatis: DEBUG
    org.apache.ibatis: DEBUG
    org.springframework.transaction: DEBUG
    java.sql: DEBUG
    jdbc.sqltiming: INFO
    com.zaxxer.hikari: DEBUG
file:
  upload-dir:
    facility: C:/carelink-uploads/facility/
    profile: C:/carelink-uploads/profile/
    temp: C:/carelink-uploads/temp/
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: method
  show-actuator: true
  default-consumes-media-type: application/json
  default-produces-media-type: application/json
  paths-to-match:
    - /api/**
  packages-to-scan:
    - com.lightcare.controller
api:
  kakao:
    app-key: ${KAKAO_APP_KEY:b97b58672807a40c122a5deed8a98ea4}
````

## File: src/main/resources/mapper/facilityMapper.xml
````xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.FacilityMapper">
    <resultMap id="facilityResultMap" type="com.example.carelink.dto.FacilityDTO">
        <id property="facilityId" column="facility_id"/>
        <result property="facilityName" column="facility_name"/>
        <result property="facilityType" column="facility_type"/>
        <result property="address" column="address"/>
        <result property="detailAddress" column="detail_address"/>
        <result property="phone" column="phone"/>
        <result property="latitude" column="latitude"/>
        <result property="longitude" column="longitude"/>
        <result property="description" column="description"/>
        <result property="facilityImage" column="facility_image"/>
        <result property="facilityImageAltText" column="facility_image_alt_text"/>
        <result property="homepage" column="homepage"/>
        <result property="capacity" column="capacity"/>
        <result property="currentOccupancy" column="current_occupancy"/>
        <result property="operatingHours" column="operating_hours"/>
        <result property="features" column="features"/>
        <result property="averageRating" column="average_rating"/>
        <result property="reviewCount" column="review_count"/>
        <result property="gradeRating" column="grade_rating"/>
        <result property="registeredMemberId" column="registered_member_id"/>
        <result property="registeredMemberName" column="registered_member_name"/>
        <result property="isApproved" column="is_approved"/>
        <result property="approvalStatus" column="approval_status"/>
    </resultMap>
    <select id="searchFacilities" resultMap="facilityResultMap">
        SELECT f.*, m.name as registered_member_name
        FROM facility f
        LEFT JOIN member m ON f.registered_member_id = m.member_id
        <where>
            f.is_deleted = false
            AND f.is_approved = true
            <if test="facilityName != null and facilityName != ''">
                AND f.facility_name LIKE CONCAT('%', #{facilityName}, '%')
            </if>
            <if test="facilityType != null and facilityType != ''">
                AND f.facility_type = #{facilityType}
            </if>
            <if test="address != null and address != ''">
                AND f.address LIKE CONCAT(#{address}, '%')
            </if>
            <if test="swLat != null and swLng != null and neLat != null and neLng != null">
                AND (f.latitude BETWEEN #{swLat} AND #{neLat})
                AND (f.longitude BETWEEN #{swLng} AND #{neLng})
            </if>
        </where>
        ORDER BY f.created_at DESC
    </select>
    <select id="getFacilityById" resultType="com.example.carelink.dto.FacilityDTO">
        SELECT
            f.facility_id,
            f.facility_name,
            f.facility_type,
            f.address,
            f.phone,
            f.latitude,
            f.longitude,
            f.description,
            f.facility_image,
            f.homepage,
            f.capacity,
            f.current_occupancy,
            f.operating_hours,
            f.features,
            f.average_rating,
            f.review_count,
            f.grade_rating,
            f.registered_member_id,
            m.name as registered_member_name,
            f.is_deleted,
            f.is_approved,
            CASE
                WHEN f.is_deleted = true THEN '삭제됨'
                WHEN f.is_approved = false THEN '승인대기'
                ELSE '정상'
            END as status
        FROM facility f
        LEFT JOIN member m ON f.registered_member_id = m.member_id
        WHERE f.facility_id = #{facilityId}
    </select>
    <select id="getAllFacilities" resultMap="facilityResultMap">
        SELECT f.*, m.name as registered_member_name
        FROM facility f
        LEFT JOIN member m ON f.registered_member_id = m.member_id
        WHERE f.is_deleted = false
        AND f.is_approved = true
        ORDER BY f.created_at DESC
    </select>
    <insert id="insertFacility" parameterType="com.example.carelink.dto.FacilityDTO" useGeneratedKeys="true" keyProperty="facilityId">
        INSERT INTO facility (
            facility_name, facility_type, address, detail_address, phone,
            latitude, longitude, description, facility_image, facility_image_alt_text, homepage,
            capacity, current_occupancy, operating_hours, features,
            average_rating, review_count, registered_member_id,
            is_approved, approval_status
        ) VALUES (
                     #{facilityName}, #{facilityType}, #{address}, #{detailAddress}, #{phone},
                     #{latitude}, #{longitude}, #{description}, #{facilityImage}, #{facilityImageAltText}, #{homepage},
                     #{capacity}, #{currentOccupancy}, #{operatingHours}, #{features},
                     #{averageRating}, #{reviewCount}, #{registeredMemberId},
                     #{isApproved}, #{approvalStatus}
                 )
    </insert>
    <update id="updateFacility" parameterType="com.example.carelink.dto.FacilityDTO">
        UPDATE facility
        SET
            facility_name = #{facilityName},
            facility_type = #{facilityType},
            address = #{address},
            detail_address = #{detailAddress},
            phone = #{phone},
            latitude = #{latitude},
            longitude = #{longitude},
            description = #{description},
            facility_image = #{facilityImage},
            facility_image_alt_text = #{facilityImageAltText},
            homepage = #{homepage},
            capacity = #{capacity},
            current_occupancy = #{currentOccupancy},
            operating_hours = #{operatingHours},
            features = #{features},
            average_rating = #{averageRating},
            review_count = #{reviewCount},
            registered_member_id = #{registeredMemberId},
            is_approved = #{isApproved},
            approval_status = #{approvalStatus},
            updated_at = NOW()
        WHERE facility_id = #{facilityId}
    </update>
    <delete id="deleteFacility">
        DELETE FROM facility WHERE facility_id = #{facilityId}
    </delete>
    <select id="countFacilitiesByRegion" resultType="int">
        SELECT COUNT(*)
        FROM facility
        WHERE address LIKE CONCAT(#{region}, '%')
    </select>
    <select id="getFacilityCount" resultType="int">
        SELECT COUNT(*)
        FROM facility
        WHERE is_deleted = false
        AND is_approved = true
    </select>
    <select id="getAllActiveFacilities" resultType="com.example.carelink.dto.FacilityDTO">
        SELECT
            f.facility_id,
            f.facility_name,
            f.facility_type,
            f.address,
            f.phone,
            f.average_rating,
            f.review_count,
            f.registered_member_id,
            m.name as registered_member_name,
            f.is_deleted,
            f.is_approved,
            CASE
                WHEN f.is_deleted = true THEN '삭제됨'
                WHEN f.is_approved = false THEN '승인대기'
                ELSE '정상'
            END as status
        FROM facility f
        LEFT JOIN member m ON f.registered_member_id = m.member_id
        WHERE f.is_deleted = false
        AND f.is_approved = true
        ORDER BY f.facility_name ASC
    </select>
    <delete id="deleteByMemberId" parameterType="long">
        DELETE FROM facility WHERE registered_member_id = #{memberId}
    </delete>
    <select id="getFacilitiesByMemberId" parameterType="long" resultType="FacilityDTO">
        SELECT
            facility_id as facilityId,
            facility_name as facilityName,
            facility_type as facilityType,
            address,
            detail_address as detailAddress,
            phone,
            latitude,
            longitude,
            description,
            facility_image as facilityImage,
            homepage,
            capacity,
            current_occupancy as currentOccupancy,
            operating_hours as operatingHours,
            features,
            average_rating as averageRating,
            review_count as reviewCount,
            grade_rating as gradeRating,
            registered_member_id as registeredMemberId,
            is_approved as isApproved,
            approval_status as approvalStatus,
            created_at as createdAt,
            updated_at as updatedAt,
            is_deleted as isDeleted
        FROM facility
        WHERE registered_member_id = #{memberId} AND is_deleted = false
        ORDER BY created_at DESC
    </select>
    <select id="getFacilityByMemberId" parameterType="long" resultType="FacilityDTO">
        SELECT
            facility_id as facilityId,
            facility_name as facilityName,
            facility_type as facilityType,
            address,
            detail_address as detailAddress,
            phone,
            latitude,
            longitude,
            description,
            facility_image as facilityImage,
            homepage,
            capacity,
            current_occupancy as currentOccupancy,
            operating_hours as operatingHours,
            features,
            average_rating as averageRating,
            review_count as reviewCount,
            grade_rating as gradeRating,
            registered_member_id as registeredMemberId,
            is_approved as isApproved,
            approval_status as approvalStatus,
            created_at as createdAt,
            updated_at as updatedAt,
            is_deleted as isDeleted
        FROM facility
        WHERE registered_member_id = #{memberId} AND is_deleted = false
        ORDER BY created_at DESC
        LIMIT 1
    </select>
    <select id="getFacilitiesByApprovalStatus" parameterType="string" resultType="FacilityDTO">
        SELECT
            f.facility_id,
            f.facility_name,
            f.facility_type,
            f.address,
            f.detail_address,
            f.phone,
            f.description,
            f.homepage,
            f.capacity,
            f.operating_hours,
            f.features,
            f.facility_image,
            f.latitude,
            f.longitude,
            f.approval_status,
            f.registered_member_id,
            f.created_at,
            f.updated_at,
            m.user_id as registeredUserName,
            m.name as registeredMemberName
        FROM facility f
        LEFT JOIN member m ON f.registered_member_id = m.member_id
        WHERE f.is_deleted = false
        <if test="approvalStatus != null and approvalStatus != ''">
            AND f.approval_status = #{approvalStatus}
        </if>
        ORDER BY f.created_at DESC
    </select>
    <update id="updateFacilityApprovalStatus">
        UPDATE facility
        SET
            approval_status = #{approvalStatus},
            is_approved = (#{approvalStatus} = 'APPROVED'),
            <if test="rejectionReason != null">
            description = CONCAT(COALESCE(description, ''), CHAR(10), '거부사유: ', #{rejectionReason}),
            </if>
            updated_at = NOW()
        WHERE facility_id = #{facilityId}
    </update>
    <select id="countFacilitiesByStatus" parameterType="string" resultType="int">
        SELECT COUNT(*)
        FROM facility
        WHERE is_deleted = false
        AND approval_status = #{approvalStatus}
    </select>
    <update id="updateFacilityMainImage">
        UPDATE facility
        SET
            facility_image = #{mainImagePath},
            image_count = #{imageCount},
            updated_at = NOW()
        WHERE facility_id = #{facilityId}
    </update>
</mapper>
````

## File: src/main/java/com/example/carelink/controller/FacilityController.java
````java
package com.example.carelink.controller;
import com.example.carelink.dto.FacilityDTO;
import com.example.carelink.dto.FacilityImageDTO;
import com.example.carelink.dto.ReviewDTO;
import com.example.carelink.service.FacilityService;
import com.example.carelink.service.ReviewService;
import com.example.carelink.service.FacilityImageService;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.context.annotation.Bean;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.common.Constants;
import org.springframework.beans.factory.annotation.Value;
import javax.servlet.http.HttpSession;
import java.util.List;
import java.util.ArrayList;
import java.util.Map;
import java.util.HashMap;
@Controller
@RequestMapping("/facility")
@RequiredArgsConstructor
@Slf4j
public class FacilityController {
    private final FacilityService facilityService;
    private final ReviewService reviewService;
    private final FacilityImageService facilityImageService;
    @Value("${api.kakao.app-key}")
    private String kakaoAppKey;
    @Bean
    public ObjectMapper objectMapper() {
        ObjectMapper mapper = new ObjectMapper();
        mapper.registerModule(new JavaTimeModule());
        return mapper;
    }
    @GetMapping("/facility-info/{facilityId}")
    @ResponseBody
    public Map<String, Object> getFacilityInfo(@PathVariable Long facilityId, HttpSession session) {
        Map<String, Object> result = new HashMap<>();
        try {
            MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (member == null) {
                result.put("success", false);
                result.put("message", "로그인이 필요합니다.");
                return result;
            }
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                result.put("success", false);
                result.put("message", "시설을 찾을 수 없습니다.");
                return result;
            }
            if (!facility.getRegisteredMemberId().equals(member.getMemberId())
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                result.put("success", false);
                result.put("message", "해당 시설 정보를 조회할 권한이 없습니다.");
                return result;
            }
            result.put("success", true);
            result.put("facility", facility);
            log.info("시설 상세 정보 API 조회 완료: facilityId={}, memberId={}", facilityId, member.getMemberId());
        } catch (Exception e) {
            log.error("시설 상세 정보 API 조회 중 오류: facilityId={}", facilityId, e);
            result.put("success", false);
            result.put("message", "시설 정보 조회 중 오류가 발생했습니다.");
        }
        return result;
    }
    @GetMapping("/manage/{facilityId}/edit")
    public String redirectToEdit(@PathVariable Long facilityId) {
        log.info("내 시설에서 시설 수정으로 리다이렉트: facilityId={}", facilityId);
        return "redirect:/facility/edit/" + facilityId;
    }
    @GetMapping("/search")
    public String searchFacilities(
            @RequestParam(value = "facilityName", required = false) String facilityName,
            @RequestParam(value = "region", required = false) String region,
            @RequestParam(value = "facilityType", required = false) String facilityType,
            @RequestParam(value = "gradeRating", required = false) String gradeRating,
            Model model
    ) {
        log.info("시설 검색 페이지 접속 - facilityName: {}, region: {}, facilityType: {}, gradeRating: {}",
                facilityName, region, facilityType, gradeRating);
        List<FacilityDTO> facilityList = new ArrayList<>();
        try {
            facilityName = (facilityName != null && facilityName.trim().isEmpty()) ? null : facilityName;
            region = (region != null && region.trim().isEmpty()) ? null : region;
            facilityType = (facilityType != null && facilityType.trim().isEmpty()) ? null : facilityType;
            FacilityDTO searchCondition = new FacilityDTO();
            searchCondition.setFacilityName(facilityName != null ? facilityName.trim() : null);
            searchCondition.setFacilityType(facilityType);
            searchCondition.setAddress(region);
            facilityList = facilityService.searchFacilities(searchCondition);
            if (facilityList == null) {
                facilityList = new ArrayList<>();
            }
        } catch (Exception e) {
            log.error("시설 검색 중 오류 발생", e);
            facilityList = new ArrayList<>();
        }
        model.addAttribute("facilityList", facilityList);
        model.addAttribute("facilityName", facilityName);
        model.addAttribute("region", region);
        model.addAttribute("facilityType", facilityType);
        model.addAttribute("gradeRating", gradeRating);
        model.addAttribute("KAKAO_APP_KEY", kakaoAppKey);
        log.info("검색된 시설 수: {}", facilityList.size());
        return "facility/search";
    }
    @GetMapping("/detail/{facilityId}")
    public String getFacilityDetail(@PathVariable Long facilityId, Model model, HttpSession session) {
        log.info("시설 상세 정보 페이지 접속 - facilityId: {}", facilityId);
        try {
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                model.addAttribute("error", "해당 시설을 찾을 수 없습니다.");
                return "redirect:/facility/search";
            }
            List<ReviewDTO> recentReviews = reviewService.getReviewsByFacilityId(facilityId);
            if (recentReviews.size() > 5) {
                recentReviews = recentReviews.subList(0, 5);
            }
            Double averageRating = reviewService.getAverageRating(facilityId);
            MemberDTO sessionMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            boolean isAdmin = sessionMember != null && "ADMIN".equals(sessionMember.getRole());
            boolean isOwner = sessionMember != null && facility.getRegisteredMemberId() != null &&
                             facility.getRegisteredMemberId().equals(sessionMember.getMemberId());
            model.addAttribute("facility", facility);
            model.addAttribute("recentReviews", recentReviews);
            model.addAttribute("averageRating", averageRating);
            model.addAttribute("reviewCount", recentReviews.size());
            model.addAttribute("pageTitle", facility.getFacilityName() + " 상세정보");
            model.addAttribute("sessionMember", sessionMember);
            model.addAttribute("isAdmin", isAdmin);
            model.addAttribute("isOwner", isOwner);
            log.info("시설 상세 정보 조회 완료 - facilityId: {}, 리뷰 수: {}, 관리자: {}, 소유자: {}",
                    facilityId, recentReviews.size(), isAdmin, isOwner);
            return "facility/detail";
        } catch (Exception e) {
            log.error("시설 상세 정보 조회 중 오류 발생 - facilityId: {}", facilityId, e);
            model.addAttribute("error", "시설 정보를 불러오는 중 오류가 발생했습니다.");
            return "redirect:/facility/search";
        }
    }
    @GetMapping("/manage")
    public String manageFacility(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (member == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        if (!Constants.MEMBER_ROLE_FACILITY.equals(member.getRole())) {
            redirectAttributes.addFlashAttribute("error", "시설 회원만 접근할 수 있습니다.");
            return "redirect:/";
        }
        try {
            List<FacilityDTO> facilities = facilityService.getFacilitiesByMemberId(member.getMemberId());
            model.addAttribute("facilities", facilities);
            model.addAttribute("facilityCount", facilities.size());
            log.info("시설 관리 페이지 접근: memberId={}, 시설 수={}",
                    member.getMemberId(), facilities.size());
            return "facility/manage";
        } catch (Exception e) {
            log.error("시설 관리 페이지 조회 중 오류 발생: memberId={}", member.getMemberId(), e);
            redirectAttributes.addFlashAttribute("error", "시설 정보를 불러오는 중 오류가 발생했습니다.");
            return "redirect:/";
        }
    }
    @GetMapping("/edit/{facilityId}")
    public String editFacilityForm(@PathVariable Long facilityId, HttpSession session,
                                   Model model, RedirectAttributes redirectAttributes) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (member == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        try {
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                redirectAttributes.addFlashAttribute("error", "시설을 찾을 수 없습니다.");
                return "redirect:/facility/manage";
            }
            if (!facility.getRegisteredMemberId().equals(member.getMemberId())
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                redirectAttributes.addFlashAttribute("error", "해당 시설을 수정할 권한이 없습니다.");
                return "redirect:/facility/manage";
            }
            model.addAttribute("facility", facility);
            log.info("시설 수정 페이지 접근: facilityId={}, memberId={}", facilityId, member.getMemberId());
            return "facility/edit";
        } catch (Exception e) {
            log.error("시설 수정 페이지 조회 중 오류 발생: facilityId={}", facilityId, e);
            redirectAttributes.addFlashAttribute("error", "시설 정보를 불러오는 중 오류가 발생했습니다.");
            return "redirect:/facility/manage";
        }
    }
    @PostMapping("/edit/{facilityId}")
    public String updateFacility(@PathVariable Long facilityId,
                                @ModelAttribute FacilityDTO facilityDTO,
                                @RequestParam(value = "facilityImageFile", required = false) MultipartFile facilityImageFile,
                                HttpSession session,
                                RedirectAttributes redirectAttributes) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (member == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        try {
            FacilityDTO existingFacility = facilityService.getFacilityById(facilityId);
            if (existingFacility == null) {
                redirectAttributes.addFlashAttribute("error", "시설을 찾을 수 없습니다.");
                return "redirect:/facility/manage";
            }
            if (!existingFacility.getRegisteredMemberId().equals(member.getMemberId())
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                redirectAttributes.addFlashAttribute("error", "해당 시설을 수정할 권한이 없습니다.");
                return "redirect:/facility/manage";
            }
            facilityDTO.setFacilityId(facilityId);
            facilityDTO.setRegisteredMemberId(existingFacility.getRegisteredMemberId());
            facilityDTO.setIsApproved(existingFacility.getIsApproved());
            String approvalStatus = existingFacility.getApprovalStatus();
            if (approvalStatus == null || approvalStatus.trim().isEmpty()) {
                if (existingFacility.getIsApproved() != null && existingFacility.getIsApproved()) {
                    approvalStatus = "APPROVED";
                    log.info("🔧 approval_status NULL 방지 - 승인된 시설: APPROVED");
                } else {
                    approvalStatus = "PENDING";
                    log.info("🔧 approval_status NULL 방지 - 미승인 시설: PENDING");
                }
            }
            facilityDTO.setApprovalStatus(approvalStatus);
            facilityDTO.setAverageRating(existingFacility.getAverageRating());
            facilityDTO.setReviewCount(existingFacility.getReviewCount());
            facilityDTO.setCurrentOccupancy(existingFacility.getCurrentOccupancy());
            facilityDTO.setGradeRating(existingFacility.getGradeRating());
            facilityService.updateFacility(facilityDTO, facilityImageFile);
            log.info("시설 정보 수정 완료: facilityId={}, memberId={}", facilityId, member.getMemberId());
            redirectAttributes.addFlashAttribute("message", "시설 정보가 성공적으로 수정되었습니다.");
            return "redirect:/facility/manage";
        } catch (Exception e) {
            log.error("시설 정보 수정 중 오류 발생: facilityId={}", facilityId, e);
            redirectAttributes.addFlashAttribute("error", "시설 정보 수정 중 오류가 발생했습니다.");
            return "redirect:/facility/edit/" + facilityId;
        }
    }
    @PostMapping("/delete/{facilityId}")
    public String deleteFacility(@PathVariable Long facilityId,
                                HttpSession session,
                                RedirectAttributes redirectAttributes) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (member == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        try {
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                redirectAttributes.addFlashAttribute("error", "시설을 찾을 수 없습니다.");
                return "redirect:/facility/manage";
            }
            if (!facility.getRegisteredMemberId().equals(member.getMemberId())
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                redirectAttributes.addFlashAttribute("error", "해당 시설을 삭제할 권한이 없습니다.");
                return "redirect:/facility/manage";
            }
            facilityService.deleteFacility(facilityId);
            log.info("시설 삭제 완료: facilityId={}, memberId={}", facilityId, member.getMemberId());
            redirectAttributes.addFlashAttribute("message", "시설이 성공적으로 삭제되었습니다.");
            return "redirect:/facility/manage";
        } catch (Exception e) {
            log.error("시설 삭제 중 오류 발생: facilityId={}", facilityId, e);
            redirectAttributes.addFlashAttribute("error", "시설 삭제 중 오류가 발생했습니다.");
            return "redirect:/facility/manage";
        }
    }
    @GetMapping("/api/{facilityId}")
    @ResponseBody
    public FacilityDTO getFacilityApi(@PathVariable Long facilityId, HttpSession session) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (member == null) {
            throw new RuntimeException("로그인이 필요합니다.");
        }
        FacilityDTO facility = facilityService.getFacilityById(facilityId);
        if (facility == null) {
            throw new RuntimeException("시설을 찾을 수 없습니다.");
        }
        if (!facility.getRegisteredMemberId().equals(member.getMemberId())
            && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
            throw new RuntimeException("해당 시설을 조회할 권한이 없습니다.");
        }
        return facility;
    }
    @GetMapping("/crop-images/{facilityId}")
    public String cropImagePage(@PathVariable Long facilityId,
                                HttpSession session,
                                Model model,
                                RedirectAttributes redirectAttributes) {
        try {
            MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (member == null) {
                redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
                return "redirect:/member/login";
            }
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                redirectAttributes.addFlashAttribute("error", "시설을 찾을 수 없습니다.");
                return "redirect:/facility/manage";
            }
            if (!facility.getRegisteredMemberId().equals(member.getMemberId())
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                redirectAttributes.addFlashAttribute("error", "해당 시설의 이미지를 관리할 권한이 없습니다.");
                return "redirect:/facility/manage";
            }
            model.addAttribute("facility", facility);
            log.info("시설 이미지 크롭 페이지 접속: facilityId={}, memberId={}", facilityId, member.getMemberId());
            return "facility/crop-images";
        } catch (Exception e) {
            log.error("시설 이미지 크롭 페이지 오류: facilityId={}", facilityId, e);
            redirectAttributes.addFlashAttribute("error", "페이지 로드 중 오류가 발생했습니다.");
            return "redirect:/facility/manage";
        }
    }
    @PostMapping("/crop-images/save/{facilityId}")
    @ResponseBody
    public Map<String, Object> saveFacilityImage(@PathVariable Long facilityId,
                                                @RequestParam("facilityImage") MultipartFile facilityImageFile,
                                                @RequestParam(value = "altText", required = false) String altText,
                                                @RequestParam(value = "format", required = false) String format,
                                                @RequestParam(value = "imageIndex", required = false) String imageIndex,
                                                @RequestParam(value = "customFileName", required = false) String customFileName,
                                                HttpSession session) {
        Map<String, Object> result = new HashMap<>();
        try {
            log.info("🔥 시설 이미지 저장 시작 - facilityId: {}, 받은 파라미터들 확인", facilityId);
            log.info("📋 altText: '{}', format: '{}', imageIndex: '{}', customFileName: '{}'", altText, format, imageIndex, customFileName);
            log.info("📁 파일 정보 - 이름: '{}', 크기: {}bytes, 타입: '{}'",
                    facilityImageFile.getOriginalFilename(), facilityImageFile.getSize(), facilityImageFile.getContentType());
            MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (member == null) {
                log.error("❌ 로그인된 사용자가 없음");
                result.put("success", false);
                result.put("message", "로그인이 필요합니다.");
                return result;
            }
            log.info("👤 로그인 사용자: {} (role: {})", member.getUserId(), member.getRole());
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                result.put("success", false);
                result.put("message", "시설을 찾을 수 없습니다.");
                return result;
            }
            if (!facility.getRegisteredMemberId().equals(member.getMemberId())
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                result.put("success", false);
                result.put("message", "해당 시설의 이미지를 관리할 권한이 없습니다.");
                return result;
            }
            log.info("🖼️ 시설 이미지 저장 요청 - facilityId: {}, 형식: {}, 인덱스: {}, 크기: {} bytes",
                    facilityId, format, imageIndex, facilityImageFile.getSize());
            if (facilityImageFile.isEmpty()) {
                result.put("success", false);
                result.put("message", "업로드된 이미지 파일이 비어있습니다.");
                return result;
            }
            String finalAltText;
            if (altText != null && !altText.trim().isEmpty()) {
                finalAltText = altText.trim();
                log.info("🏷️ 시설 이미지 Alt 텍스트 설정: {}", finalAltText);
            } else {
                finalAltText = facility.getFacilityName() + " 시설 이미지";
                if (imageIndex != null && !imageIndex.isEmpty()) {
                    finalAltText += " " + (Integer.parseInt(imageIndex) + 1);
                }
                log.info("🏷️ 시설 이미지 Alt 텍스트 기본값 설정: {}", finalAltText);
            }
            String contentType = facilityImageFile.getContentType();
            if (contentType != null) {
                log.info("📷 업로드된 이미지 형식: {}", contentType);
                if (contentType.contains("avif")) {
                    log.info("✨ AVIF 형식 감지 - 최적 압축 적용됨");
                } else if (contentType.contains("webp")) {
                    log.info("🚀 WebP 형식 감지 - 효율적 압축 적용됨");
                } else if (contentType.contains("jpeg")) {
                    log.info("📸 JPEG 형식 감지 - 호환성 우선 적용됨");
                }
            }
            Integer orderIndex = imageIndex != null ? Integer.parseInt(imageIndex) : null;
            log.info("🔧 서비스 호출 전 - facilityId: {}, orderIndex: {}, altText: '{}', customFileName: '{}'",
                facilityId, orderIndex, finalAltText, customFileName);
            FacilityImageDTO savedImage = facilityImageService.saveSingleFacilityImage(
                facilityId, facilityImageFile, finalAltText, orderIndex, customFileName);
            log.info("✅ 서비스 호출 완료 - 저장된 이미지ID: {}, 경로: {}", savedImage.getImageId(), savedImage.getImagePath());
            result.put("success", true);
            result.put("message", "시설 이미지가 성공적으로 저장되었습니다.");
            result.put("facilityId", facilityId);
            result.put("imageIndex", imageIndex);
            result.put("imageId", savedImage.getImageId());
            result.put("imagePath", savedImage.getImagePath());
            log.info("✅ 시설 이미지 저장 성공: facilityId={}, imageId={}", facilityId, savedImage.getImageId());
        } catch (Exception e) {
            log.error("❌ 시설 이미지 저장 중 오류 발생: facilityId={}", facilityId, e);
            result.put("success", false);
            result.put("message", "이미지 저장 중 오류가 발생했습니다: " + e.getMessage());
        }
        return result;
    }
}
````

## File: src/main/java/com/example/carelink/controller/MemberController.java
````java
package com.example.carelink.controller;
import com.example.carelink.dto.LoginDTO;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.service.MemberService;
import com.example.carelink.common.Constants;
import com.example.carelink.validation.groups.OnFacilityJoin;
import com.example.carelink.common.CustomMultipartFile;
import org.springframework.web.multipart.MultipartFile;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;
import javax.servlet.http.HttpSession;
import javax.validation.ConstraintViolation;
import javax.validation.Valid;
import javax.validation.Validator;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Set;
@Slf4j
@Controller
@RequestMapping("/member")
@RequiredArgsConstructor
public class MemberController {
    private final MemberService memberService;
    @Autowired
    private Validator validator;
    @GetMapping("/login")
    public String loginForm(Model model) {
        model.addAttribute("loginDTO", new LoginDTO());
        return "member/login";
    }
    @PostMapping("/login")
    public String login(@Valid @ModelAttribute LoginDTO loginDTO,
                        BindingResult bindingResult,
                        HttpSession session,
                        RedirectAttributes redirectAttributes) {
        if (bindingResult.hasErrors()) {
            log.warn("로그인 폼 유효성 검사 실패: {}", bindingResult.getAllErrors());
            return "member/login";
        }
        log.info("로그인 시도: userId={}, 비밀번호 길이={}", loginDTO.getUserId(), loginDTO.getPassword().length());
        try {
            MemberDTO loginMember = memberService.login(loginDTO);
            if (loginMember != null) {
                session.setAttribute(Constants.SESSION_MEMBER, loginMember);
                session.setAttribute("memberId", loginMember.getMemberId());
                log.info("컨트롤러 로그인 성공: userId={}, role={}", loginMember.getUserId(), loginMember.getRole());
                redirectAttributes.addFlashAttribute("message", "로그인되었습니다.");
                return "redirect:/";
            } else {
                log.warn("컨트롤러 로그인 실패: userId={}", loginDTO.getUserId());
                redirectAttributes.addFlashAttribute("error", "아이디 또는 비밀번호가 잘못되었습니다.");
                return "redirect:/member/login";
            }
        } catch (Exception e) {
            log.error("로그인 처리 중 오류 발생: userId={}", loginDTO.getUserId(), e);
            redirectAttributes.addFlashAttribute("error", "로그인 처리 중 오류가 발생했습니다.");
            return "redirect:/member/login";
        }
    }
    @GetMapping("/logout")
    public String logout(HttpSession session, RedirectAttributes redirectAttributes) {
        if (session != null) {
            session.invalidate();
        }
        redirectAttributes.addFlashAttribute("message", "로그아웃되었습니다.");
        return "redirect:/";
    }
    @GetMapping("/join")
    public String joinForm(Model model) {
        model.addAttribute("memberDTO", new MemberDTO());
        return "member/join";
    }
    @PostMapping("/join")
    public String join(
            @Validated(value = {javax.validation.groups.Default.class})
            @ModelAttribute MemberDTO memberDTO,
            BindingResult bindingResult,
            @RequestParam(value = "facilityImageFile", required = false) MultipartFile facilityImageFile,
            HttpSession session,
            RedirectAttributes redirectAttributes,
            Model model) {
        if (!memberDTO.getPassword().equals(memberDTO.getPasswordConfirm())) {
            bindingResult.rejectValue("passwordConfirm", "password.mismatch", "비밀번호 확인이 일치하지 않습니다.");
            log.warn("회원가입 실패: 비밀번호 확인 불일치");
            model.addAttribute("memberDTO", memberDTO);
            return "member/join";
        }
        if ("FACILITY".equalsIgnoreCase(memberDTO.getRole())) {
            Set<ConstraintViolation<MemberDTO>> violations = validator.validate(memberDTO, OnFacilityJoin.class);
            for (ConstraintViolation<MemberDTO> violation : violations) {
                bindingResult.rejectValue(violation.getPropertyPath().toString(), "", violation.getMessage());
            }
        }
        // 3. 최종 유효성 검사 결과 확인 (기본 유효성 + 수동 추가된 유효성)
        if (bindingResult.hasErrors()) {
            log.warn("회원가입 유효성 검사 실패: {}", bindingResult.getAllErrors());
            model.addAttribute("memberDTO", memberDTO);
            return "member/join";
        }
        try {
            memberService.join(memberDTO, facilityImageFile);
            log.info("회원가입 성공: {}", memberDTO.getUserId());
            LoginDTO loginDTO = new LoginDTO();
            loginDTO.setUserId(memberDTO.getUserId());
            loginDTO.setPassword(memberDTO.getPassword());
            MemberDTO loginMember = memberService.login(loginDTO);
            if (loginMember != null) {
                session.setAttribute(Constants.SESSION_MEMBER, loginMember);
                session.setAttribute("memberId", loginMember.getMemberId());
                log.info("회원가입 후 자동 로그인 성공: userId={}", loginMember.getUserId());
                redirectAttributes.addFlashAttribute("message", "회원가입이 완료되었습니다. 환영합니다!");
                return "redirect:/";
            } else {
                log.warn("회원가입은 성공했으나 자동 로그인 실패: {}", memberDTO.getUserId());
                redirectAttributes.addFlashAttribute("message", "회원가입이 완료되었습니다. 로그인해주세요.");
                return "redirect:/member/login";
            }
        } catch (IllegalArgumentException e) {
            log.warn("회원가입 실패: {}", e.getMessage());
            bindingResult.rejectValue("userId", "duplicate.userId", e.getMessage());
            return "member/join";
        } catch (Exception e) {
            log.error("회원가입 처리 중 알 수 없는 오류 발생", e);
            redirectAttributes.addFlashAttribute("error", "회원가입 처리 중 오류가 발생했습니다.");
            return "member/join";
        }
    }
    @PostMapping("/checkUserId")
    @ResponseBody
    public Map<String, Object> checkUserId(@RequestParam String userId) {
        Map<String, Object> result = new HashMap<>();
        try {
            boolean isDuplicate = memberService.isUserIdDuplicate(userId);
            result.put("isDuplicate", isDuplicate);
            result.put("message", isDuplicate ? "이미 사용중인 아이디입니다." : "사용 가능한 아이디입니다.");
        } catch (Exception e) {
            log.error("아이디 중복 체크 중 오류 발생", e);
            result.put("error", "중복 체크 중 오류가 발생했습니다.");
        }
        return result;
    }
    @GetMapping("/debug/password-test")
    @ResponseBody
    public Map<String, Object> debugPasswordTest(@RequestParam(defaultValue = "admin") String userId,
                                                 @RequestParam(defaultValue = "admin123") String password) {
        Map<String, Object> result = new HashMap<>();
        try {
            MemberDTO member = memberService.getMemberByUserId(userId);
            if (member == null) {
                result.put("error", "사용자를 찾을 수 없습니다: " + userId);
                return result;
            }
            result.put("userId", member.getUserId());
            result.put("dbPasswordHash", member.getPassword());
            result.put("dbPasswordLength", member.getPassword().length());
            result.put("inputPassword", password);
            result.put("inputPasswordLength", password.length());
            boolean isValidBcryptFormat = member.getPassword().startsWith("$2a$") ||
                                        member.getPassword().startsWith("$2b$") ||
                                        member.getPassword().startsWith("$2y$");
            result.put("isValidBcryptFormat", isValidBcryptFormat);
            LoginDTO loginDTO = new LoginDTO();
            loginDTO.setUserId(userId);
            loginDTO.setPassword(password);
            MemberDTO loginResult = memberService.login(loginDTO);
            result.put("loginSuccess", loginResult != null);
            result.put("isActive", member.getIsActive());
            result.put("isDeleted", member.getIsDeleted());
            result.put("loginFailCount", member.getLoginFailCount());
            result.put("role", member.getRole());
            log.info("디버깅 테스트 결과: {}", result);
        } catch (Exception e) {
            log.error("디버깅 테스트 중 오류 발생", e);
            result.put("error", "테스트 중 오류 발생: " + e.getMessage());
        }
        return result;
    }
    @GetMapping("/myinfo")
    public String verifyPasswordForm(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        return "member/verifyPassword";
    }
    @PostMapping("/myinfo/verify")
    public String verifyPassword(@RequestParam("password") String password,
                                HttpSession session,
                                RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        try {
            if (!password.equals(loginMember.getPassword())) {
                redirectAttributes.addFlashAttribute("error", "비밀번호가 일치하지 않습니다.");
                return "redirect:/member/myinfo";
            }
            return "redirect:/member/myinfo/edit";
        } catch (Exception e) {
            log.error("비밀번호 확인 중 오류 발생: {}", loginMember.getUserId(), e);
            redirectAttributes.addFlashAttribute("error", "비밀번호 확인 중 오류가 발생했습니다.");
            return "redirect:/member/myinfo";
        }
    }
    @GetMapping("/myinfo/edit")
    public String myInfoEdit(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        try {
            MemberDTO memberInfo = memberService.findById(loginMember.getMemberId());
            if (memberInfo == null) {
                redirectAttributes.addFlashAttribute("error", "사용자 정보를 찾을 수 없습니다.");
                session.invalidate();
                return "redirect:/member/login";
            }
            session.setAttribute("myinfo_verified", true);
            model.addAttribute("memberDTO", memberInfo);
            return "member/myinfo";
        } catch (Exception e) {
            log.error("마이페이지 정보 조회 중 오류 발생: {}", loginMember.getUserId(), e);
            redirectAttributes.addFlashAttribute("error", "회원 정보를 불러오는 중 오류가 발생했습니다.");
            return "redirect:/";
        }
    }
    @GetMapping("/myinfo/crop-image")
    public String cropImagePage(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        Boolean myinfoVerified = (Boolean) session.getAttribute("myinfo_verified");
        if (myinfoVerified == null || !myinfoVerified) {
            redirectAttributes.addFlashAttribute("error", "올바른 경로로 접근해주세요.");
            return "redirect:/member/myinfo";
        }
        model.addAttribute("memberDTO", loginMember);
        return "member/crop-image";
    }
    @PostMapping("/myinfo/crop-image/upload")
    @ResponseBody
    public Map<String, Object> uploadTempImage(@RequestParam("imageFile") MultipartFile imageFile,
                                               HttpSession session) {
        Map<String, Object> result = new HashMap<>();
        try {
            MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (loginMember == null) {
                result.put("success", false);
                result.put("message", "로그인이 필요합니다.");
                return result;
            }
            if (imageFile.isEmpty()) {
                result.put("success", false);
                result.put("message", "이미지 파일이 없습니다.");
                return result;
            }
            if (imageFile.getSize() > 5 * 1024 * 1024) {
                result.put("success", false);
                result.put("message", "파일 크기는 5MB 이하여야 합니다.");
                return result;
            }
            String contentType = imageFile.getContentType();
            if (contentType == null || !contentType.startsWith("image/")) {
                result.put("success", false);
                result.put("message", "이미지 파일만 업로드 가능합니다.");
                return result;
            }
            byte[] imageBytes = imageFile.getBytes();
            String base64Image = "data:" + contentType + ";base64," +
                                java.util.Base64.getEncoder().encodeToString(imageBytes);
            session.setAttribute("tempImageData", base64Image);
            session.setAttribute("tempImageName", imageFile.getOriginalFilename());
            result.put("success", true);
            result.put("imageData", base64Image);
            result.put("message", "이미지가 업로드되었습니다.");
        } catch (Exception e) {
            log.error("임시 이미지 업로드 중 오류 발생", e);
            result.put("success", false);
            result.put("message", "이미지 업로드 중 오류가 발생했습니다.");
        }
        return result;
    }
    @PostMapping("/myinfo/crop-image/save")
    @ResponseBody
    public Map<String, Object> saveCroppedImage(@RequestParam("croppedImage") MultipartFile croppedImageFile,
                                                @RequestParam(value = "altText", required = false) String altText,
                                                @RequestParam(value = "format", required = false) String format,
                                                @RequestParam(value = "quality", required = false) String quality,
                                                HttpSession session) {
        Map<String, Object> result = new HashMap<>();
        try {
            MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (loginMember == null) {
                result.put("success", false);
                result.put("message", "로그인이 필요합니다.");
                return result;
            }
            log.info("🖼️ 크롭된 이미지 저장 요청 - 형식: {}, 품질: {}, 크기: {} bytes",
                    format, quality, croppedImageFile.getSize());
            log.info("📁 파일 정보 - 이름: {}, 컨텐츠 타입: {}",
                    croppedImageFile.getOriginalFilename(), croppedImageFile.getContentType());
            if (croppedImageFile.isEmpty()) {
                result.put("success", false);
                result.put("message", "업로드된 이미지 파일이 비어있습니다.");
                return result;
            }
            MemberDTO memberDTO = memberService.findById(loginMember.getMemberId());
            if (memberDTO == null) {
                result.put("success", false);
                result.put("message", "회원 정보를 찾을 수 없습니다.");
                return result;
            }
            log.info("📋 받은 파라미터 - altText: '{}', format: '{}', quality: '{}'", altText, format, quality);
            if (altText != null && !altText.trim().isEmpty()) {
                memberDTO.setProfileImageAltText(altText.trim());
                log.info("🏷️ 프로필 이미지 Alt 텍스트 설정: {}", altText.trim());
            } else {
                memberDTO.setProfileImageAltText("사용자 프로필 사진");
                log.info("🏷️ 프로필 이미지 Alt 텍스트 기본값 설정: 사용자 프로필 사진");
            }
            String contentType = croppedImageFile.getContentType();
            if (contentType != null) {
                log.info("📷 업로드된 이미지 형식: {}", contentType);
                if (contentType.contains("avif")) {
                    log.info("✨ AVIF 형식 감지 - 최적 압축 적용됨");
                } else if (contentType.contains("webp")) {
                    log.info("🚀 WebP 형식 감지 - 효율적 압축 적용됨");
                } else if (contentType.contains("jpeg")) {
                    log.info("📸 JPEG 형식 감지 - 호환성 우선 적용됨");
                }
            }
            memberService.updateMember(memberDTO, croppedImageFile);
            MemberDTO updatedMember = memberService.findById(loginMember.getMemberId());
            if (updatedMember != null) {
                session.setAttribute(Constants.SESSION_MEMBER, updatedMember);
            }
            session.removeAttribute("tempImageData");
            session.removeAttribute("tempImageName");
            result.put("success", true);
            result.put("message", "프로필 이미지가 성공적으로 저장되었습니다.");
            result.put("profileImageUrl", updatedMember.getProfileImage());
        } catch (Exception e) {
            log.error("크롭된 이미지 저장 중 오류 발생", e);
            result.put("success", false);
            result.put("message", "이미지 저장 중 오류가 발생했습니다.");
        }
        return result;
    }
    @PostMapping("/myinfo/update")
    public String updateMember(@ModelAttribute MemberDTO memberDTO,
                               BindingResult bindingResult,
                               @RequestParam(value = "profileImageFile", required = false) MultipartFile profileImageFile,
                               HttpSession session,
                               Model model,
                               RedirectAttributes redirectAttributes) {
        log.info("회원정보 수정 요청: memberId={}, name={}, email={}",
                memberDTO.getMemberId(), memberDTO.getName(), memberDTO.getEmail());
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        log.info("세션 로그인 멤버: {}", loginMember != null ? loginMember.getMemberId() : "null");
        if (loginMember == null) {
            log.warn("세션에 로그인 정보가 없음");
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        if (!loginMember.getMemberId().equals(memberDTO.getMemberId())) {
            log.warn("권한 없음: 세션 memberId={}, 요청 memberId={}",
                    loginMember.getMemberId(), memberDTO.getMemberId());
            redirectAttributes.addFlashAttribute("error", "권한이 없거나 로그인 정보가 유효하지 않습니다.");
            return "redirect:/member/myinfo";
        }
        if (memberDTO.getName() == null || memberDTO.getName().trim().isEmpty()) {
            bindingResult.rejectValue("name", "NotBlank", "이름은 필수입니다.");
        }
        if (memberDTO.getEmail() != null && !memberDTO.getEmail().trim().isEmpty()) {
            if (!memberDTO.getEmail().matches("^[A-Za-z0-9+_.-]+@(.+)$")) {
                bindingResult.rejectValue("email", "Email", "올바른 이메일 형식이 아닙니다.");
            }
        }
        if (memberDTO.getPhone() != null && !memberDTO.getPhone().trim().isEmpty()) {
            if (!memberDTO.getPhone().matches("^01(?:0|1|[6-9])-(?:\\d{3}|\\d{4})-\\d{4}$")) {
                bindingResult.rejectValue("phone", "Pattern", "올바른 휴대폰 번호 형식이 아닙니다.");
            }
        }
        if (bindingResult.hasErrors()) {
            log.warn("회원정보 수정 유효성 검사 실패: {}", bindingResult.getAllErrors());
            model.addAttribute("memberDTO", memberDTO);
            return "member/myinfo";
        }
        try {
            log.info("회원정보 수정 서비스 호출 시작");
            memberService.updateMember(memberDTO, profileImageFile);
            log.info("회원정보 수정 서비스 호출 완료");
            MemberDTO updatedMember = memberService.findById(memberDTO.getMemberId());
            if (updatedMember != null) {
                session.setAttribute(Constants.SESSION_MEMBER, updatedMember);
                log.info("세션 정보 업데이트 완료: {}", updatedMember.getName());
            } else {
                log.warn("업데이트된 회원 정보 조회 실패");
            }
            redirectAttributes.addFlashAttribute("message", "회원정보가 성공적으로 수정되었습니다.");
            return "redirect:/member/myinfo/edit";
        } catch (Exception e) {
            log.error("회원정보 수정 중 오류 발생: memberId={}, userId={}",
                    memberDTO.getMemberId(), memberDTO.getUserId(), e);
            redirectAttributes.addFlashAttribute("error", "회원정보 수정 중 오류가 발생했습니다: " + e.getMessage());
            return "redirect:/member/myinfo/edit";
        }
    }
    @GetMapping("/mypage/change-password")
    public String changePasswordForm(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        return "member/changePassword";
    }
    @PostMapping("/mypage/change-password")
    public String changePassword(@RequestParam("currentPassword") String currentPassword,
                                 @RequestParam("newPassword") String newPassword,
                                 @RequestParam("confirmPassword") String confirmNewPassword,
                                 HttpSession session,
                                 RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        String userId = loginMember.getUserId();
        try {
            memberService.changePassword(userId, currentPassword, newPassword, confirmNewPassword);
            redirectAttributes.addFlashAttribute("message", "비밀번호가 성공적으로 변경되었습니다.");
            return "redirect:/member/myinfo/edit";
        } catch (IllegalArgumentException e) {
            redirectAttributes.addFlashAttribute("error", e.getMessage());
            return "redirect:/member/mypage/change-password";
        } catch (Exception e) {
            log.error("비밀번호 변경 중 오류 발생: {}", userId, e);
            redirectAttributes.addFlashAttribute("error", "비밀번호 변경 중 오류가 발생했습니다.");
            return "redirect:/member/mypage/change-password";
        }
    }
    @GetMapping("/mypage/delete")
    public String deleteMemberForm(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        try {
            Map<String, Integer> contentCounts = memberService.getUserContentCounts(loginMember.getMemberId());
            model.addAttribute("member", loginMember);
            model.addAttribute("contentCounts", contentCounts);
            log.info("회원탈퇴 페이지 접근: userId={}, 작성 콘텐츠={}",
                    loginMember.getUserId(), contentCounts);
            return "member/deleteMember";
        } catch (Exception e) {
            log.error("회원탈퇴 페이지 로드 중 오류: {}", loginMember.getUserId(), e);
            model.addAttribute("member", loginMember);
            model.addAttribute("contentCounts", Map.of("board", 0, "review", 0, "job", 0));
            return "member/deleteMember";
        }
    }
    @PostMapping("/mypage/delete")
    public String deleteMember(@RequestParam("password") String password,
                              @RequestParam("confirmName") String confirmName,
                              @RequestParam("deleteOption") String deleteOption,
                              HttpSession session,
                              RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        String userId = loginMember.getUserId();
        log.info("회원탈퇴 요청: userId={}, 입력된 비밀번호 길이={}, 입력된 이름={}, 삭제옵션={}",
                userId, password.length(), confirmName, deleteOption);
        try {
            MemberDTO currentMember = memberService.findById(loginMember.getMemberId());
            if (currentMember == null) {
                log.warn("회원탈퇴: 회원 정보를 찾을 수 없음: memberId={}", loginMember.getMemberId());
                redirectAttributes.addFlashAttribute("error", "회원 정보를 찾을 수 없습니다.");
                return "redirect:/member/mypage/delete";
            }
            log.info("비밀번호 비교: DB 비밀번호={}, 입력 비밀번호={}",
                    currentMember.getPassword(), password);
            if (!password.equals(currentMember.getPassword())) {
                log.warn("회원탈퇴: 비밀번호 불일치: userId={}", userId);
                redirectAttributes.addFlashAttribute("error", "현재 비밀번호가 일치하지 않습니다.");
                return "redirect:/member/mypage/delete";
            }
            log.info("비밀번호 확인 성공: userId={}", userId);
            if (!confirmName.trim().equals(currentMember.getName().trim())) {
                log.warn("회원탈퇴: 이름 불일치: userId={}, 입력된 이름={}, 등록된 이름={}",
                        userId, confirmName, currentMember.getName());
                redirectAttributes.addFlashAttribute("error",
                        String.format("이름이 일치하지 않습니다. 등록된 이름 '%s'를 정확히 입력해주세요.", currentMember.getName()));
                return "redirect:/member/mypage/delete";
            }
            log.info("이름 확인 성공: userId={}, 이름={}", userId, confirmName);
            String resultMessage = memberService.deleteMemberWithOption(userId, deleteOption);
            log.info("회원탈퇴 완료: userId={}, 옵션={}", userId, deleteOption);
            session.invalidate();
            redirectAttributes.addFlashAttribute("message", resultMessage + " 그동안 이용해 주셔서 감사합니다.");
            return "redirect:/";
        } catch (Exception e) {
            log.error("회원 탈퇴 처리 중 오류 발생: {}", userId, e);
            redirectAttributes.addFlashAttribute("error", "회원 탈퇴 처리 중 오류가 발생했습니다.");
            return "redirect:/member/mypage/delete";
        }
    }
    @GetMapping("/admin/members")
    public String listMembers(@RequestParam(defaultValue = "1") int page,
                              @RequestParam(defaultValue = "10") int pageSize,
                              @RequestParam(required = false) String role,
                              Model model, HttpSession session, RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null || !Constants.MEMBER_ROLE_ADMIN.equals(loginMember.getRole())) {
            redirectAttributes.addFlashAttribute("error", "관리자 권한이 필요합니다.");
            return "redirect:/";
        }
        try {
            MemberDTO searchDTO = new MemberDTO();
            searchDTO.setPageSize(pageSize);
            searchDTO.setOffset((page - 1) * pageSize);
            searchDTO.setRole(role);
            List<MemberDTO> members = memberService.getMembersWithPaging(searchDTO);
            int totalMembers = memberService.getTotalMembersCount();
            int totalPages = (int) Math.ceil((double) totalMembers / pageSize);
            model.addAttribute("members", members);
            model.addAttribute("currentPage", page);
            model.addAttribute("totalPages", totalPages);
            model.addAttribute("pageSize", pageSize);
            model.addAttribute("currentRole", role);
            return "member/memberList";
        } catch (Exception e) {
            log.error("관리자 회원 목록 조회 중 오류 발생", e);
            redirectAttributes.addFlashAttribute("error", "회원 목록 조회 중 오류가 발생했습니다.");
            return "redirect:/";
        }
    }
    @PostMapping("/admin/members/status")
    public String updateMemberStatus(@RequestParam Long memberId,
                                     @RequestParam boolean isActive,
                                     HttpSession session, RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null || !Constants.MEMBER_ROLE_ADMIN.equals(loginMember.getRole())) {
            redirectAttributes.addFlashAttribute("error", "관리자 권한이 없습니다.");
            return "redirect:/member/admin/members";
        }
        try {
            memberService.updateMemberStatus(memberId, isActive);
            redirectAttributes.addFlashAttribute("message", "회원 상태가 성공적으로 변경되었습니다.");
        } catch (Exception e) {
            log.error("회원 상태 변경 중 오류 발생: memberId={}", memberId, e);
            redirectAttributes.addFlashAttribute("error", "회원 상태 변경 중 오류가 발생했습니다.");
        }
        return "redirect:/member/admin/members";
    }
    @GetMapping("/mypost")
    public String myPosts(@RequestParam(defaultValue = "all") String type,
                         @RequestParam(defaultValue = "1") int page,
                         @RequestParam(defaultValue = "10") int pageSize,
                         HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        try {
            Long memberId = loginMember.getMemberId();
            log.info("내가 쓴 글 페이지 요청: memberId={}, type={}, page={}", memberId, type, page);
            int offset = (page - 1) * pageSize;
            Map<String, Object> result = memberService.getMyPosts(memberId, type, page, pageSize, offset);
            model.addAttribute("member", loginMember);
            model.addAttribute("posts", result.get("posts"));
            model.addAttribute("totalCount", result.get("totalCount"));
            model.addAttribute("currentType", type);
            model.addAttribute("currentPage", page);
            model.addAttribute("pageSize", pageSize);
            model.addAttribute("totalPages", (int) Math.ceil((double) (Integer) result.get("totalCount") / pageSize));
            Map<String, Integer> contentCounts = (Map<String, Integer>) result.get("contentCounts");
            model.addAttribute("contentCounts", contentCounts);
            log.info("내가 쓴 글 조회 완료: 총 {}개", result.get("totalCount"));
            return "member/myPosts";
        } catch (Exception e) {
            log.error("내가 쓴 글 페이지 로드 중 오류: memberId={}", loginMember.getMemberId(), e);
            redirectAttributes.addFlashAttribute("error", "내가 쓴 글을 불러오는 중 오류가 발생했습니다.");
            return "redirect:/member/myinfo/edit";
        }
    }
}
````
`````

## File: lightcare-summary.md
`````markdown
This file is a merged representation of the entire codebase, combined into a single document by Repomix.

# File Summary

## Purpose
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  a. A header with the file path (## File: path/to/file)
  b. The full contents of the file in a code block

## Usage Guidelines
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)

# Directory Structure
```
backup/
  deprecated_files/
    crop-image.backup.html
    crop-image.backup.js
    edit.backup.html
    facility-image-cropper.backup.js
  facility-image-implementation/
    facility-image-implementation/
      detail-backup.html
      detail.html
      edit.html
      facility-detail-map.js
      facility-detail.js
      facility-edit.js
      FacilityController.java
      FacilityImageService.java
      README.md
gradle/
  wrapper/
    gradle-wrapper.properties
src/
  main/
    java/
      com/
        example/
          carelink/
            common/
              BaseDTO.java
              Constants.java
              CustomMultipartFile.java
              PageInfo.java
            config/
              DevSecurityConfig.java
              KakaoApiConfig.java
              ProdSecurityConfig.java
              SecurityConfig.java
              WebConfig.java
            controller/
              AdminController.java
              BoardController.java
              FacilityController.java
              FacilityImageApiController.java
              HomeController.java
              JobController.java
              MemberController.java
              ReviewController.java
            dao/
              BoardMapper.java
              FacilityImageMapper.java
              FacilityMapper.java
              JobApplicationMapper.java
              JobMapper.java
              MemberMapper.java
              ReviewMapper.java
            dto/
              BoardDTO.java
              FacilityDTO.java
              FacilityImageDTO.java
              JobApplicationDTO.java
              JobDTO.java
              LoginDTO.java
              MemberDTO.java
              ReviewDTO.java
            service/
              BoardService.java
              FacilityImageService.java
              FacilityService.java
              JobService.java
              MemberService.java
              ReviewService.java
            validation/
              groups/
                OnFacilityJoin.java
            CarelinkApplication.java
      Crolling.java
    resources/
      mapper/
        boardMapper.xml
        facilityImageMapper.xml
        facilityMapper.xml
        JobApplicationMapper.xml
        jobMapper.xml
        MemberMapper.xml
        reviewMapper.xml
      static/
        css/
          advanced-image-cropper.css
          common.css
          facility-image-uploader.css
          image-compressor.css
          rich-text-editor.css
        js/
          board-detail.js
          board-navigation.js
          change-password.js
          common.js
          delete-member.js
          facility-edit.js
          facility-image-core.js
          facility-image-cropper-module.js
          facility-image-data-module.js
          facility-image-dom-validator.js
          facility-image-event-coordinator.js
          facility-image-main-controller.js
          facility-image-seo-module.js
          facility-image-ui-module.js
          facility-image-upload-module.js
          facility-image-utils-module.js
          facility-manage.js
          image-compressor.js
          job-detail.js
          job-edit.js
          kakaomap.js
          my-posts.js
          myinfo.js
          phone-formatter.js
          review-detail.js
          review-write.js
          rich-text-editor-v2.js
          rich-text-editor.js
          smart-scroll-utility.js
      templates/
        admin/
          dashboard.html
          facilities.html
          members.html
          statistics.html
        board/
          detail.html
          edit.html
          faq-list.html
          faq-write.html
          list.html
          notice-list.html
          qna-list.html
          write.html
        facility/
          crop-images.html
          detail.html
          edit.backup.html
          edit.html
          manage.html
          search.html
        job/
          detail.html
          edit.html
          list.html
          write.html
        layout/
          footer.html
          header.html
        member/
          changePassword.html
          crop-image.backup.html
          crop-image.html
          deleteMember.html
          join.html
          login.html
          myinfo.html
          myPosts.html
          verifyPassword.html
        review/
          detail.html
          edit.html
          list.html
          write.html
        index.html
      application.yml
      db_performance_indexes.sql
      mybatis-config.xml
      schema.sql
.dockerignore
.repomixignore
build.gradle
CLAUDE.md
cleanup_files.sh
deploy-heroku.sh
deploy-ncp.sh
deploy-oracle.sh
deploy-railway.sh
deploy.sh
docker-compose.aws.yml
docker-compose.yml
docker-run-example.sh
Dockerfile
gradlew
gradlew.bat
ncp-server-setup.sh
nixpacks.toml
oracle-setup.sh
Procfile
README.md
reset_all_data.sql
reset_facility_images.sql
run-dev.bat
schema-postgresql.sql
SECURITY_NOTICE.md
start-server.sh
stop-server.sh
system.properties
tomorrow-checklist.md
```

# Files

## File: .repomixignore
````
# Build outputs
build/
target/
*.jar
*.war

# IDE files
.idea/
*.iml
.vscode/
.gradle/

# Dependencies
node_modules/

# Logs
*.log
logs/

# Database
*.db
*.sqlite

# Images and media
*.png
*.jpg
*.jpeg
*.gif
*.svg
*.ico

# Documents
docs/
*.pdf
*.doc
*.docx

# Test files
src/test/

# Config files with secrets
*.env
.env.*

# OS files
.DS_Store
Thumbs.db

# Git
.git/
.gitignore

# Other
*.zip
*.tar.gz
images/
static/images/
static/css/
static/js/bootstrap*
static/js/jquery*
````

## File: deploy-heroku.sh
````bash
#!/bin/bash

echo "🚀 Heroku 배포 스크립트"
echo "======================"

# 색상 정의
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# 1. 프로젝트 빌드
echo -e "${YELLOW}📦 프로젝트 빌드 중...${NC}"
./gradlew clean build -x test

if [ $? -eq 0 ]; then
    echo -e "${GREEN}✅ 빌드 성공!${NC}"
else
    echo -e "${RED}❌ 빌드 실패!${NC}"
    exit 1
fi

# 2. Heroku CLI 설치 확인
if ! command -v heroku &> /dev/null; then
    echo -e "${RED}❌ Heroku CLI가 설치되지 않았습니다.${NC}"
    echo "다음 링크에서 설치하세요: https://devcenter.heroku.com/articles/heroku-cli"
    exit 1
fi

# 3. Heroku 로그인 확인
echo -e "${YELLOW}🔑 Heroku 로그인 확인 중...${NC}"
heroku auth:whoami &> /dev/null
if [ $? -ne 0 ]; then
    echo -e "${YELLOW}로그인이 필요합니다. 'heroku login' 명령어를 실행하세요.${NC}"
    heroku login
fi

# 4. Heroku 앱 생성
echo -e "${YELLOW}🏗️  Heroku 앱 생성 중...${NC}"
APP_NAME="elderberry-ai"
heroku create $APP_NAME

# 5. PostgreSQL 애드온 추가
echo -e "${YELLOW}🗄️  PostgreSQL 데이터베이스 추가 중...${NC}"
heroku addons:create heroku-postgresql:hobby-dev -a $APP_NAME

# 6. 환경변수 설정
echo -e "${YELLOW}🔧 환경변수 설정 중...${NC}"
heroku config:set KAKAO_APP_KEY=b97b58672807a40c122a5deed8a98ea4 -a $APP_NAME
heroku config:set SPRING_PROFILES_ACTIVE=heroku -a $APP_NAME

# 7. Git 설정 및 배포
echo -e "${YELLOW}📡 Git 리모트 추가 및 배포 중...${NC}"
git remote add heroku https://git.heroku.com/$APP_NAME.git
git add .
git commit -m "Heroku 배포: $(date)"
git push heroku main

# 8. 데이터베이스 스키마 초기화
echo -e "${YELLOW}🗄️  데이터베이스 스키마 초기화 중...${NC}"
heroku pg:psql -a $APP_NAME < schema-postgresql.sql

# 9. 앱 열기
echo -e "${GREEN}🎉 배포 완료!${NC}"
echo -e "${GREEN}앱 URL: https://$APP_NAME.herokuapp.com${NC}"
heroku open -a $APP_NAME

echo ""
echo -e "${YELLOW}📋 다음 단계:${NC}"
echo "1. 커스텀 도메인 연결: heroku domains:add elderberry-ai.com -a $APP_NAME"
echo "2. DNS 설정: elderberry-ai.com의 CNAME을 $APP_NAME.herokuapp.com으로 설정"
echo "3. SSL 인증서: heroku certs:auto:enable -a $APP_NAME"
````

## File: deploy-ncp.sh
````bash
#!/bin/bash

# NCP 서버 배포 스크립트
# 사용법: ./deploy-ncp.sh

echo "🚀 LightCare NCP 배포 시작..."

# 1. 프로젝트 빌드
echo "📦 프로젝트 빌드 중..."
./gradlew clean build -x test

if [ $? -ne 0 ]; then
    echo "❌ 빌드 실패!"
    exit 1
fi

echo "✅ 빌드 완료!"

# 2. JAR 파일 확인
JAR_FILE="build/libs/carelink-0.0.1-SNAPSHOT.jar"
if [ ! -f "$JAR_FILE" ]; then
    echo "❌ JAR 파일을 찾을 수 없습니다: $JAR_FILE"
    exit 1
fi

# 3. 서버 정보 설정 (환경변수로 관리)
SERVER_IP=${NCP_SERVER_IP:-"your-server-ip"}
SERVER_USER=${NCP_SERVER_USER:-"root"}
DEPLOY_PATH="/home/carelink"

echo "📤 서버로 파일 전송 중..."
echo "   서버: $SERVER_USER@$SERVER_IP"
echo "   경로: $DEPLOY_PATH"

# 4. 서버로 JAR 파일 전송
scp $JAR_FILE $SERVER_USER@$SERVER_IP:$DEPLOY_PATH/carelink.jar

if [ $? -ne 0 ]; then
    echo "❌ 파일 전송 실패!"
    exit 1
fi

# 5. 서버 스크립트 전송
scp start-server.sh $SERVER_USER@$SERVER_IP:$DEPLOY_PATH/
scp stop-server.sh $SERVER_USER@$SERVER_IP:$DEPLOY_PATH/

# 6. 서버에서 애플리케이션 재시작
echo "🔄 서버 애플리케이션 재시작 중..."
ssh $SERVER_USER@$SERVER_IP << 'ENDSSH'
cd /home/carelink
chmod +x start-server.sh stop-server.sh

# 기존 프로세스 종료
./stop-server.sh

# 새 버전 시작
./start-server.sh

# 상태 확인
sleep 5
if pgrep -f "carelink.jar" > /dev/null; then
    echo "✅ 애플리케이션이 성공적으로 시작되었습니다!"
    echo "📊 프로세스 정보:"
    ps aux | grep carelink.jar | grep -v grep
else
    echo "❌ 애플리케이션 시작 실패!"
    echo "로그 확인: tail -f /var/log/carelink/application.log"
fi
ENDSSH

echo "🎉 배포 완료!"
echo "🌐 접속 주소: http://$SERVER_IP:8080"
````

## File: deploy-oracle.sh
````bash
#!/bin/bash

# Oracle Cloud 배포 스크립트
# 로컬에서 실행하여 Oracle Cloud VM에 배포

echo "🔮 Oracle Cloud 배포 스크립트"
echo "============================="

# 변수 설정 (수정 필요)
SERVER_IP="your-oracle-server-ip"
SSH_KEY="~/.ssh/oracle-key"

# 1. 프로젝트 빌드
echo "🔨 프로젝트 빌드..."
./gradlew clean build -x test

# 2. JAR 파일 확인
if [ ! -f "build/libs/carelink-0.0.1-SNAPSHOT.jar" ]; then
    echo "❌ JAR 파일을 찾을 수 없습니다!"
    exit 1
fi

# 3. JAR 파일 업로드
echo "📤 JAR 파일 업로드..."
scp -i $SSH_KEY build/libs/carelink-0.0.1-SNAPSHOT.jar ubuntu@$SERVER_IP:/opt/lightcare/carelink.jar

# 4. 서비스 재시작
echo "🔄 서비스 재시작..."
ssh -i $SSH_KEY ubuntu@$SERVER_IP "sudo systemctl restart lightcare"

# 5. 서비스 상태 확인
echo "✅ 서비스 상태 확인..."
ssh -i $SSH_KEY ubuntu@$SERVER_IP "sudo systemctl status lightcare"

echo "🎉 배포 완료!"
echo "📌 접속 주소: http://$SERVER_IP:8080"
````

## File: deploy-railway.sh
````bash
#!/bin/bash

echo "🚂 Railway 배포 스크립트"
echo "========================"

# 1. Git 상태 확인
echo "📋 Git 상태 확인..."
git status

# 2. 변경사항 커밋
echo "💾 변경사항 커밋..."
git add .
git commit -m "Railway 배포 설정 추가"

# 3. Railway CLI 설치 확인
if ! command -v railway &> /dev/null
then
    echo "⚠️ Railway CLI가 설치되어 있지 않습니다."
    echo "설치 명령어: npm install -g @railway/cli"
    exit 1
fi

# 4. Railway 로그인
echo "🔐 Railway 로그인..."
railway login

# 5. 프로젝트 생성 또는 연결
echo "🎯 Railway 프로젝트 설정..."
railway link

# 6. 배포
echo "🚀 배포 시작..."
railway up

echo "✅ 배포 완료!"
echo "📌 Railway 대시보드에서 환경변수를 설정해주세요:"
echo "   - DB_URL"
echo "   - DB_USERNAME" 
echo "   - DB_PASSWORD"
echo "   - KAKAO_APP_KEY"
````

## File: deploy.sh
````bash
#!/bin/bash

echo "🚀 LightCare 배포 스크립트"
echo "=========================="

# 1. 프로젝트 빌드
echo "📦 프로젝트 빌드 중..."
./gradlew clean build -x test

# 2. JAR 파일 확인
if [ -f "build/libs/carelink-*.jar" ]; then
    echo "✅ JAR 파일 생성 완료"
else
    echo "❌ JAR 파일 생성 실패"
    exit 1
fi

# 3. 환경변수 파일 생성
echo "🔧 환경변수 설정..."
cat > application-production.yml << EOF
server:
  port: 8080

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/carelink?useSSL=false&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=UTF-8
    username: \${DB_USERNAME:root}
    password: \${DB_PASSWORD:mysql}

api:
  kakao:
    app-key: \${KAKAO_APP_KEY}
EOF

echo "✅ 배포 준비 완료!"
echo "💡 다음 단계:"
echo "   1. AWS EC2 인스턴스 생성"
echo "   2. 탄력적 IP 할당" 
echo "   3. 도메인 DNS 설정"
echo "   4. 서버에 애플리케이션 업로드"
````

## File: gradlew
````
#!/bin/sh

#
# Copyright © 2015-2021 the original authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-License-Identifier: Apache-2.0
#

##############################################################################
#
#   Gradle start up script for POSIX generated by Gradle.
#
#   Important for running:
#
#   (1) You need a POSIX-compliant shell to run this script. If your /bin/sh is
#       noncompliant, but you have some other compliant shell such as ksh or
#       bash, then to run this script, type that shell name before the whole
#       command line, like:
#
#           ksh Gradle
#
#       Busybox and similar reduced shells will NOT work, because this script
#       requires all of these POSIX shell features:
#         * functions;
#         * expansions «$var», «${var}», «${var:-default}», «${var+SET}»,
#           «${var#prefix}», «${var%suffix}», and «$( cmd )»;
#         * compound commands having a testable exit status, especially «case»;
#         * various built-in commands including «command», «set», and «ulimit».
#
#   Important for patching:
#
#   (2) This script targets any POSIX shell, so it avoids extensions provided
#       by Bash, Ksh, etc; in particular arrays are avoided.
#
#       The "traditional" practice of packing multiple parameters into a
#       space-separated string is a well documented source of bugs and security
#       problems, so this is (mostly) avoided, by progressively accumulating
#       options in "$@", and eventually passing that to Java.
#
#       Where the inherited environment variables (DEFAULT_JVM_OPTS, JAVA_OPTS,
#       and GRADLE_OPTS) rely on word-splitting, this is performed explicitly;
#       see the in-line comments for details.
#
#       There are tweaks for specific operating systems such as AIX, CygWin,
#       Darwin, MinGW, and NonStop.
#
#   (3) This script is generated from the Groovy template
#       https://github.com/gradle/gradle/blob/HEAD/platforms/jvm/plugins-application/src/main/resources/org/gradle/api/internal/plugins/unixStartScript.txt
#       within the Gradle project.
#
#       You can find Gradle at https://github.com/gradle/gradle/.
#
##############################################################################

# Attempt to set APP_HOME

# Resolve links: $0 may be a link
app_path=$0

# Need this for daisy-chained symlinks.
while
    APP_HOME=${app_path%"${app_path##*/}"}  # leaves a trailing /; empty if no leading path
    [ -h "$app_path" ]
do
    ls=$( ls -ld "$app_path" )
    link=${ls#*' -> '}
    case $link in             #(
      /*)   app_path=$link ;; #(
      *)    app_path=$APP_HOME$link ;;
    esac
done

# This is normally unused
# shellcheck disable=SC2034
APP_BASE_NAME=${0##*/}
# Discard cd standard output in case $CDPATH is set (https://github.com/gradle/gradle/issues/25036)
APP_HOME=$( cd -P "${APP_HOME:-./}" > /dev/null && printf '%s\n' "$PWD" ) || exit

# Use the maximum available, or set MAX_FD != -1 to use that value.
MAX_FD=maximum

warn () {
    echo "$*"
} >&2

die () {
    echo
    echo "$*"
    echo
    exit 1
} >&2

# OS specific support (must be 'true' or 'false').
cygwin=false
msys=false
darwin=false
nonstop=false
case "$( uname )" in                #(
  CYGWIN* )         cygwin=true  ;; #(
  Darwin* )         darwin=true  ;; #(
  MSYS* | MINGW* )  msys=true    ;; #(
  NONSTOP* )        nonstop=true ;;
esac

CLASSPATH=$APP_HOME/gradle/wrapper/gradle-wrapper.jar


# Determine the Java command to use to start the JVM.
if [ -n "$JAVA_HOME" ] ; then
    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
        # IBM's JDK on AIX uses strange locations for the executables
        JAVACMD=$JAVA_HOME/jre/sh/java
    else
        JAVACMD=$JAVA_HOME/bin/java
    fi
    if [ ! -x "$JAVACMD" ] ; then
        die "ERROR: JAVA_HOME is set to an invalid directory: $JAVA_HOME

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
else
    JAVACMD=java
    if ! command -v java >/dev/null 2>&1
    then
        die "ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
fi

# Increase the maximum file descriptors if we can.
if ! "$cygwin" && ! "$darwin" && ! "$nonstop" ; then
    case $MAX_FD in #(
      max*)
        # In POSIX sh, ulimit -H is undefined. That's why the result is checked to see if it worked.
        # shellcheck disable=SC2039,SC3045
        MAX_FD=$( ulimit -H -n ) ||
            warn "Could not query maximum file descriptor limit"
    esac
    case $MAX_FD in  #(
      '' | soft) :;; #(
      *)
        # In POSIX sh, ulimit -n is undefined. That's why the result is checked to see if it worked.
        # shellcheck disable=SC2039,SC3045
        ulimit -n "$MAX_FD" ||
            warn "Could not set maximum file descriptor limit to $MAX_FD"
    esac
fi

# Collect all arguments for the java command, stacking in reverse order:
#   * args from the command line
#   * the main class name
#   * -classpath
#   * -D...appname settings
#   * --module-path (only if needed)
#   * DEFAULT_JVM_OPTS, JAVA_OPTS, and GRADLE_OPTS environment variables.

# For Cygwin or MSYS, switch paths to Windows format before running java
if "$cygwin" || "$msys" ; then
    APP_HOME=$( cygpath --path --mixed "$APP_HOME" )
    CLASSPATH=$( cygpath --path --mixed "$CLASSPATH" )

    JAVACMD=$( cygpath --unix "$JAVACMD" )

    # Now convert the arguments - kludge to limit ourselves to /bin/sh
    for arg do
        if
            case $arg in                                #(
              -*)   false ;;                            # don't mess with options #(
              /?*)  t=${arg#/} t=/${t%%/*}              # looks like a POSIX filepath
                    [ -e "$t" ] ;;                      #(
              *)    false ;;
            esac
        then
            arg=$( cygpath --path --ignore --mixed "$arg" )
        fi
        # Roll the args list around exactly as many times as the number of
        # args, so each arg winds up back in the position where it started, but
        # possibly modified.
        #
        # NB: a `for` loop captures its iteration list before it begins, so
        # changing the positional parameters here affects neither the number of
        # iterations, nor the values presented in `arg`.
        shift                   # remove old arg
        set -- "$@" "$arg"      # push replacement arg
    done
fi


# Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
DEFAULT_JVM_OPTS='"-Xmx64m" "-Xms64m"'

# Collect all arguments for the java command:
#   * DEFAULT_JVM_OPTS, JAVA_OPTS, and optsEnvironmentVar are not allowed to contain shell fragments,
#     and any embedded shellness will be escaped.
#   * For example: A user cannot expect ${Hostname} to be expanded, as it is an environment variable and will be
#     treated as '${Hostname}' itself on the command line.

set -- \
        "-Dorg.gradle.appname=$APP_BASE_NAME" \
        -classpath "$CLASSPATH" \
        org.gradle.wrapper.GradleWrapperMain \
        "$@"

# Stop when "xargs" is not available.
if ! command -v xargs >/dev/null 2>&1
then
    die "xargs is not available"
fi

# Use "xargs" to parse quoted args.
#
# With -n1 it outputs one arg per line, with the quotes and backslashes removed.
#
# In Bash we could simply go:
#
#   readarray ARGS < <( xargs -n1 <<<"$var" ) &&
#   set -- "${ARGS[@]}" "$@"
#
# but POSIX shell has neither arrays nor command substitution, so instead we
# post-process each arg (as a line of input to sed) to backslash-escape any
# character that might be a shell metacharacter, then use eval to reverse
# that process (while maintaining the separation between arguments), and wrap
# the whole thing up as a single "set" statement.
#
# This will of course break if any of these variables contains a newline or
# an unmatched quote.
#

eval "set -- $(
        printf '%s\n' "$DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS" |
        xargs -n1 |
        sed ' s~[^-[:alnum:]+,./:=@_]~\\&~g; ' |
        tr '\n' ' '
    )" '"$@"'

exec "$JAVACMD" "$@"
````

## File: ncp-server-setup.sh
````bash
#!/bin/bash

# NCP 서버 초기 설정 스크립트
# 서버에 SSH 접속 후 실행

echo "🔧 NCP 서버 초기 설정 시작..."

# 1. 시스템 업데이트
echo "📦 시스템 패키지 업데이트..."
sudo apt-get update
sudo apt-get upgrade -y

# 2. Java 11 설치
echo "☕ Java 11 설치..."
sudo apt-get install openjdk-11-jdk -y
java -version

# 3. MySQL 클라이언트 설치
echo "🐬 MySQL 클라이언트 설치..."
sudo apt-get install mysql-client -y

# 4. Nginx 설치 (리버스 프록시용)
echo "🌐 Nginx 설치..."
sudo apt-get install nginx -y

# 5. 방화벽 설정
echo "🔒 방화벽 설정..."
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw allow 8080/tcp  # Spring Boot
sudo ufw --force enable

# 6. 애플리케이션 디렉토리 생성
echo "📁 디렉토리 생성..."
sudo mkdir -p /home/carelink
sudo mkdir -p /home/carelink/uploads/{facility,profile,temp}
sudo mkdir -p /var/log/carelink

# 7. 사용자 생성 (보안)
echo "👤 carelink 사용자 생성..."
sudo useradd -m -s /bin/bash carelink
sudo chown -R carelink:carelink /home/carelink
sudo chown -R carelink:carelink /var/log/carelink

# 8. Nginx 설정
echo "⚙️ Nginx 리버스 프록시 설정..."
sudo tee /etc/nginx/sites-available/carelink << 'EOF'
server {
    listen 80;
    server_name your-domain.com;
    
    client_max_body_size 50M;
    
    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 타임아웃 설정
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # 정적 파일 직접 서빙 (성능 향상)
    location /css/ {
        alias /home/carelink/static/css/;
        expires 30d;
    }
    
    location /js/ {
        alias /home/carelink/static/js/;
        expires 30d;
    }
    
    location /images/ {
        alias /home/carelink/static/images/;
        expires 30d;
    }
}
EOF

# Nginx 사이트 활성화
sudo ln -sf /etc/nginx/sites-available/carelink /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx

# 9. Systemd 서비스 생성
echo "🚀 Systemd 서비스 생성..."
sudo tee /etc/systemd/system/carelink.service << 'EOF'
[Unit]
Description=LightCare Spring Boot Application
After=syslog.target network.target

[Service]
Type=simple
User=carelink
Group=carelink
WorkingDirectory=/home/carelink

Environment="SPRING_PROFILES_ACTIVE=prod"
Environment="DB_HOST=your-db-endpoint"
Environment="DB_NAME=carelink"
Environment="DB_USERNAME=carelink"
Environment="DB_PASSWORD=your-db-password"
Environment="KAKAO_APP_KEY=b97b58672807a40c122a5deed8a98ea4"

ExecStart=/usr/bin/java -Xms512m -Xmx1024m -jar /home/carelink/carelink.jar
ExecStop=/bin/kill -TERM $MAINPID

Restart=on-failure
RestartSec=10

StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl daemon-reload
sudo systemctl enable carelink.service

# 10. 로그 로테이션 설정
echo "📝 로그 로테이션 설정..."
sudo tee /etc/logrotate.d/carelink << 'EOF'
/var/log/carelink/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0644 carelink carelink
    sharedscripts
    postrotate
        systemctl reload carelink
    endscript
}
EOF

echo "✅ 서버 초기 설정 완료!"
echo ""
echo "📌 다음 단계:"
echo "1. DB 엔드포인트 및 비밀번호 설정"
echo "2. 도메인 설정 (/etc/nginx/sites-available/carelink)"
echo "3. JAR 파일 업로드 후 서비스 시작:"
echo "   sudo systemctl start carelink"
echo "   sudo systemctl status carelink"
echo "   sudo journalctl -u carelink -f"
````

## File: nixpacks.toml
````toml
[phases.setup]
nixPkgs = ["...", "jdk11"]

[start]
cmd = "java -jar -Dserver.port=$PORT build/libs/carelink-0.0.1-SNAPSHOT.jar"
````

## File: oracle-setup.sh
````bash
#!/bin/bash

echo "🔮 Oracle Cloud 서버 설정 스크립트"
echo "=================================="

# 1. 시스템 업데이트
echo "📦 시스템 패키지 업데이트..."
sudo apt update && sudo apt upgrade -y

# 2. Java 11 설치
echo "☕ Java 11 설치..."
sudo apt install openjdk-11-jdk -y
java -version

# 3. MySQL 8 설치
echo "🗄️ MySQL 8.0 설치..."
sudo apt install mysql-server -y

# 4. MySQL 보안 설정
echo "🔒 MySQL 보안 설정..."
sudo mysql << EOF
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'LightCare2024!';
CREATE DATABASE carelink CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'lightcare'@'%' IDENTIFIED BY 'LightCare2024!';
GRANT ALL PRIVILEGES ON carelink.* TO 'lightcare'@'%';
FLUSH PRIVILEGES;
EOF

# 5. 방화벽 설정
echo "🔥 방화벽 규칙 설정..."
sudo iptables -I INPUT 6 -m state --state NEW -p tcp --dport 8080 -j ACCEPT
sudo iptables -I INPUT 6 -m state --state NEW -p tcp --dport 80 -j ACCEPT
sudo iptables -I INPUT 6 -m state --state NEW -p tcp --dport 443 -j ACCEPT
sudo netfilter-persistent save

# 6. 애플리케이션 디렉토리 생성
echo "📁 애플리케이션 디렉토리 생성..."
sudo mkdir -p /opt/lightcare
sudo chown ubuntu:ubuntu /opt/lightcare

# 7. 서비스 파일 생성
echo "🎯 시스템 서비스 생성..."
sudo tee /etc/systemd/system/lightcare.service > /dev/null << 'EOF'
[Unit]
Description=LightCare Spring Boot Application
After=syslog.target

[Service]
User=ubuntu
ExecStart=/usr/bin/java -jar /opt/lightcare/carelink.jar
SuccessExitStatus=143
StandardOutput=append:/var/log/lightcare/app.log
StandardError=append:/var/log/lightcare/error.log
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# 8. 로그 디렉토리 생성
sudo mkdir -p /var/log/lightcare
sudo chown ubuntu:ubuntu /var/log/lightcare

# 9. 서비스 등록
sudo systemctl daemon-reload
sudo systemctl enable lightcare

echo "✅ Oracle Cloud 서버 설정 완료!"
echo ""
echo "📌 다음 단계:"
echo "1. JAR 파일을 /opt/lightcare/carelink.jar로 업로드"
echo "2. sudo systemctl start lightcare 로 서비스 시작"
echo "3. http://서버IP:8080 으로 접속 테스트"
````

## File: Procfile
````
web: java -Dserver.port=$PORT -Dspring.profiles.active=heroku -jar build/libs/carelink-*.jar
````

## File: schema-postgresql.sql
````sql
-- PostgreSQL용 스키마 (Heroku 배포용)

-- 회원 테이블
CREATE TABLE IF NOT EXISTS member (
    member_id SERIAL PRIMARY KEY,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    name VARCHAR(50) NOT NULL,
    phone VARCHAR(15),
    role VARCHAR(20) DEFAULT 'USER',
    is_approved BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 시설 테이블
CREATE TABLE IF NOT EXISTS facility (
    facility_id SERIAL PRIMARY KEY,
    facility_name VARCHAR(100) NOT NULL,
    address VARCHAR(200) NOT NULL,
    detail_address VARCHAR(100),
    phone VARCHAR(15),
    facility_type VARCHAR(50),
    description TEXT,
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    is_approved BOOLEAN DEFAULT false,
    registered_member_id INTEGER REFERENCES member(member_id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 시설 이미지 테이블
CREATE TABLE IF NOT EXISTS facility_image (
    image_id SERIAL PRIMARY KEY,
    facility_id INTEGER REFERENCES facility(facility_id) ON DELETE CASCADE,
    image_path VARCHAR(500) NOT NULL,
    is_main BOOLEAN DEFAULT false,
    display_order INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 리뷰 테이블
CREATE TABLE IF NOT EXISTS review (
    review_id SERIAL PRIMARY KEY,
    facility_id INTEGER REFERENCES facility(facility_id) ON DELETE CASCADE,
    member_id INTEGER REFERENCES member(member_id) ON DELETE CASCADE,
    rating INTEGER CHECK (rating >= 1 AND rating <= 5),
    content TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 게시판 테이블
CREATE TABLE IF NOT EXISTS board (
    board_id SERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    content TEXT,
    board_type VARCHAR(50) DEFAULT 'info',
    member_id INTEGER REFERENCES member(member_id) ON DELETE CASCADE,
    view_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 구인공고 테이블
CREATE TABLE IF NOT EXISTS job_posting (
    job_id SERIAL PRIMARY KEY,
    facility_id INTEGER REFERENCES facility(facility_id) ON DELETE CASCADE,
    title VARCHAR(200) NOT NULL,
    content TEXT,
    job_type VARCHAR(50),
    salary VARCHAR(100),
    working_hours VARCHAR(100),
    requirements TEXT,
    benefits TEXT,
    is_active BOOLEAN DEFAULT true,
    deadline TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 구직 지원 테이블
CREATE TABLE IF NOT EXISTS job_application (
    application_id SERIAL PRIMARY KEY,
    job_id INTEGER REFERENCES job_posting(job_id) ON DELETE CASCADE,
    member_id INTEGER REFERENCES member(member_id) ON DELETE CASCADE,
    cover_letter TEXT,
    resume_path VARCHAR(500),
    status VARCHAR(20) DEFAULT 'PENDING',
    applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 인덱스 생성
CREATE INDEX IF NOT EXISTS idx_facility_location ON facility(latitude, longitude);
CREATE INDEX IF NOT EXISTS idx_facility_type ON facility(facility_type);
CREATE INDEX IF NOT EXISTS idx_review_facility ON review(facility_id);
CREATE INDEX IF NOT EXISTS idx_board_type ON board(board_type);
CREATE INDEX IF NOT EXISTS idx_job_active ON job_posting(is_active);
````

## File: start-server.sh
````bash
#!/bin/bash

# 서버 시작 스크립트
echo "🚀 LightCare 서버 시작..."

# 로그 디렉토리 생성
mkdir -p /var/log/carelink
mkdir -p /home/carelink/uploads/{facility,profile,temp}

# 환경변수 설정
export SPRING_PROFILES_ACTIVE=prod
export DB_HOST=${DB_HOST:-"localhost"}
export DB_NAME=${DB_NAME:-"carelink"}
export DB_USERNAME=${DB_USERNAME:-"carelink"}
export DB_PASSWORD=${DB_PASSWORD:-"your-db-password"}
export KAKAO_APP_KEY=${KAKAO_APP_KEY:-"b97b58672807a40c122a5deed8a98ea4"}

# Java 옵션 설정
JAVA_OPTS="-Xms512m -Xmx1024m"
JAVA_OPTS="$JAVA_OPTS -Dspring.profiles.active=prod"
JAVA_OPTS="$JAVA_OPTS -Dfile.encoding=UTF-8"
JAVA_OPTS="$JAVA_OPTS -Djava.net.preferIPv4Stack=true"

# 애플리케이션 실행 (백그라운드)
nohup java $JAVA_OPTS -jar /home/carelink/carelink.jar > /var/log/carelink/console.log 2>&1 &

echo "✅ PID: $!"
echo $! > /home/carelink/carelink.pid

echo "📝 로그 확인:"
echo "   tail -f /var/log/carelink/application.log"
echo "   tail -f /var/log/carelink/console.log"
````

## File: stop-server.sh
````bash
#!/bin/bash

# 서버 종료 스크립트
echo "🛑 LightCare 서버 종료 중..."

# PID 파일 확인
PID_FILE="/home/carelink/carelink.pid"

if [ -f "$PID_FILE" ]; then
    PID=$(cat $PID_FILE)
    if ps -p $PID > /dev/null; then
        echo "프로세스 종료: PID $PID"
        kill $PID
        sleep 3
        
        # 강제 종료 필요시
        if ps -p $PID > /dev/null; then
            echo "강제 종료 실행..."
            kill -9 $PID
        fi
        
        rm -f $PID_FILE
        echo "✅ 서버가 종료되었습니다."
    else
        echo "⚠️ PID $PID 프로세스가 실행중이지 않습니다."
        rm -f $PID_FILE
    fi
else
    echo "⚠️ PID 파일이 없습니다. 프로세스 검색 중..."
    
    # JAR 파일로 실행중인 프로세스 찾기
    PID=$(pgrep -f "carelink.jar")
    
    if [ ! -z "$PID" ]; then
        echo "프로세스 발견: PID $PID"
        kill $PID
        sleep 3
        
        if pgrep -f "carelink.jar" > /dev/null; then
            echo "강제 종료 실행..."
            pkill -9 -f "carelink.jar"
        fi
        echo "✅ 서버가 종료되었습니다."
    else
        echo "ℹ️ 실행중인 서버가 없습니다."
    fi
fi
````

## File: system.properties
````
java.runtime.version=11
````

## File: tomorrow-checklist.md
````markdown
# 📋 내일 Oracle Cloud 배포 체크리스트

## 1. Oracle Cloud 가입 재시도
- [ ] 24시간 후 재시도
- [ ] 시크릿 모드 브라우저 사용
- [ ] 다른 카드 준비 (필요시)

## 2. 가입 성공 후 순서

### Step 1: VM 인스턴스 생성
```
이름: lightcare-server
Shape: VM.Standard.E2.1.Micro (Always Free)
OS: Ubuntu 20.04
Region: Korea Central (춘천)
```

### Step 2: SSH 키 다운로드
- Private Key 안전한 곳에 저장
- 권한 설정: chmod 400 ssh-key.key

### Step 3: Security List 설정
```
포트 22, 80, 443, 8080 오픈
```

### Step 4: 서버 접속 후 실행
```bash
# 1. 서버 접속
ssh -i ssh-key.key ubuntu@<public-ip>

# 2. 기본 패키지 업데이트
sudo apt update && sudo apt upgrade -y

# 3. Java 11 설치
sudo apt install openjdk-11-jdk -y

# 4. MySQL 설치
sudo apt install mysql-server -y

# 5. 프로젝트 디렉토리 생성
mkdir /home/ubuntu/lightcare
```

## 3. 로컬에서 준비할 것

### JAR 파일 빌드
```bash
# Windows 환경
./gradlew.bat clean build -x test

# 빌드된 파일 위치
build/libs/carelink-0.0.1-SNAPSHOT.jar
```

### 환경변수 준비
```
DB_PASSWORD=설정할비밀번호
KAKAO_APP_KEY=b97b58672807a40c122a5deed8a98ea4
```

## 4. 배포 명령어

### JAR 파일 업로드
```bash
scp -i ssh-key.key build/libs/*.jar ubuntu@<ip>:/home/ubuntu/lightcare/
```

### 애플리케이션 실행
```bash
# 테스트 실행
java -jar carelink-0.0.1-SNAPSHOT.jar

# 백그라운드 실행
nohup java -jar carelink-0.0.1-SNAPSHOT.jar &
```

## 5. 확인사항
- [ ] http://<public-ip>:8080 접속 테스트
- [ ] 데이터베이스 연결 확인
- [ ] 로그 파일 확인

## 💡 Tips
- Oracle Cloud는 한번 설정하면 영구 무료
- 주기적으로 접속해서 계정 활성 유지
- 문제 발생시 다시 연락주세요!
````

## File: gradle/wrapper/gradle-wrapper.properties
````
distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-8.13-bin.zip
networkTimeout=10000
validateDistributionUrl=true
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists
````

## File: src/main/java/com/example/carelink/dto/LoginDTO.java
````java
package com.example.carelink.dto;

import lombok.Data;
import javax.validation.constraints.NotBlank;

/**
 * 로그인 요청 DTO
 * 팀원 A 담당: 로그인 기능에서 사용
 */
@Data
public class LoginDTO {
    
    @NotBlank(message = "사용자 ID를 입력해주세요")
    private String userId;        // 사용자 ID
    
    @NotBlank(message = "비밀번호를 입력해주세요")
    private String password;      // 비밀번호
    
    private boolean rememberMe;   // 로그인 상태 유지
}
````

## File: src/main/resources/mybatis-config.xml
````xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-config.dtd">

<configuration>
    <!-- 설정 -->
    <settings>
        <!-- 카멜케이스 자동 매핑 활성화 -->
        <setting name="mapUnderscoreToCamelCase" value="true"/>
        <!-- NULL 값도 호출되도록 설정 -->
        <setting name="callSettersOnNulls" value="true"/>
        <!-- 지연 로딩 비활성화 -->
        <setting name="lazyLoadingEnabled" value="false"/>
    </settings>

    <!-- 타입 별칭 설정 -->
    <typeAliases>
        <package name="com.example.carelink.dto"/>
    </typeAliases>
</configuration>
````

## File: docker-compose.aws.yml
````yaml
version: '3.8'

services:
  # Spring Boot 애플리케이션 (AWS EC2/RDS 연결)
  app:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: carelink-app
    ports:
      - "8080:8080"
    environment:
      # Spring Boot 프로필
      - SPRING_PROFILES_ACTIVE=prod
      
      # 데이터베이스 설정 (AWS RDS)
      - DB_URL=${DB_URL:-jdbc:mysql://localhost:3306/carelink?useSSL=false&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=UTF-8}
      - DB_USERNAME=${DB_USERNAME:-root}
      - DB_PASSWORD=${DB_PASSWORD:-mysql}
      
      # 카카오 API 키
      - KAKAO_APP_KEY=${KAKAO_APP_KEY:-your_kakao_app_key}
      - KAKAO_REST_API_KEY=${KAKAO_REST_API_KEY:-your_kakao_rest_api_key}
      
      # 파일 업로드 경로
      - UPLOAD_BASE_PATH=${UPLOAD_BASE_PATH:-/carelink-uploads/}
      
      # 로그 설정
      - LOGGING_LEVEL_ROOT=INFO
      - LOGGING_LEVEL_COM_EXAMPLE_CARELINK=DEBUG
      
      # JVM 메모리 설정
      - JAVA_OPTS=-Xms512m -Xmx1024m -XX:+UseContainerSupport -XX:MaxRAMPercentage=75.0
      
    volumes:
      - carelink-uploads:/carelink-uploads
      - ./logs:/app/logs
    restart: unless-stopped
    networks:
      - carelink-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  carelink-uploads:
    name: carelink-uploads
    driver: local

networks:
  carelink-network:
    name: carelink-network
    driver: bridge
````

## File: docker-run-example.sh
````bash
# 로컬 테스트용 (MySQL 로컬 서버)
docker run -d \
  --name carelink-app \
  -p 8080:8080 \
  -e SPRING_PROFILES_ACTIVE=prod \
  -e DB_URL="jdbc:mysql://host.docker.internal:3306/carelink?useSSL=false&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=UTF-8" \
  -e DB_USERNAME=root \
  -e DB_PASSWORD=mysql \
  -e KAKAO_APP_KEY=0948e3e4faa457fb6083f68e1ce10458 \
  -e UPLOAD_BASE_PATH=/carelink-uploads/ \
  -v carelink-uploads:/carelink-uploads \
  carelink-app

# AWS RDS 사용시
docker run -d \
  --name carelink-app \
  -p 8080:8080 \
  -e SPRING_PROFILES_ACTIVE=prod \
  -e DB_URL="jdbc:mysql://your-rds-endpoint.region.rds.amazonaws.com:3306/carelink?useSSL=true&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=UTF-8" \
  -e DB_USERNAME=root \
  -e DB_PASSWORD=your-rds-password \
  -e KAKAO_APP_KEY=0948e3e4faa457fb6083f68e1ce10458 \
  -e UPLOAD_BASE_PATH=/carelink-uploads/ \
  -v carelink-uploads:/carelink-uploads \
  carelink-app
````

## File: gradlew.bat
````
@rem
@rem Copyright 2015 the original author or authors.
@rem
@rem Licensed under the Apache License, Version 2.0 (the "License");
@rem you may not use this file except in compliance with the License.
@rem You may obtain a copy of the License at
@rem
@rem      https://www.apache.org/licenses/LICENSE-2.0
@rem
@rem Unless required by applicable law or agreed to in writing, software
@rem distributed under the License is distributed on an "AS IS" BASIS,
@rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
@rem See the License for the specific language governing permissions and
@rem limitations under the License.
@rem
@rem SPDX-License-Identifier: Apache-2.0
@rem

@if "%DEBUG%"=="" @echo off
@rem ##########################################################################
@rem
@rem  Gradle startup script for Windows
@rem
@rem ##########################################################################

@rem Set local scope for the variables with windows NT shell
if "%OS%"=="Windows_NT" setlocal

set DIRNAME=%~dp0
if "%DIRNAME%"=="" set DIRNAME=.
@rem This is normally unused
set APP_BASE_NAME=%~n0
set APP_HOME=%DIRNAME%

@rem Resolve any "." and ".." in APP_HOME to make it shorter.
for %%i in ("%APP_HOME%") do set APP_HOME=%%~fi

@rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
set DEFAULT_JVM_OPTS="-Xmx64m" "-Xms64m"

@rem Find java.exe
if defined JAVA_HOME goto findJavaFromJavaHome

set JAVA_EXE=java.exe
%JAVA_EXE% -version >NUL 2>&1
if %ERRORLEVEL% equ 0 goto execute

echo. 1>&2
echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH. 1>&2
echo. 1>&2
echo Please set the JAVA_HOME variable in your environment to match the 1>&2
echo location of your Java installation. 1>&2

goto fail

:findJavaFromJavaHome
set JAVA_HOME=%JAVA_HOME:"=%
set JAVA_EXE=%JAVA_HOME%/bin/java.exe

if exist "%JAVA_EXE%" goto execute

echo. 1>&2
echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME% 1>&2
echo. 1>&2
echo Please set the JAVA_HOME variable in your environment to match the 1>&2
echo location of your Java installation. 1>&2

goto fail

:execute
@rem Setup the command line

set CLASSPATH=%APP_HOME%\gradle\wrapper\gradle-wrapper.jar


@rem Execute Gradle
"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -classpath "%CLASSPATH%" org.gradle.wrapper.GradleWrapperMain %*

:end
@rem End local scope for the variables with windows NT shell
if %ERRORLEVEL% equ 0 goto mainEnd

:fail
rem Set variable GRADLE_EXIT_CONSOLE if you need the _script_ return code instead of
rem the _cmd.exe /c_ return code!
set EXIT_CODE=%ERRORLEVEL%
if %EXIT_CODE% equ 0 set EXIT_CODE=1
if not ""=="%GRADLE_EXIT_CONSOLE%" exit %EXIT_CODE%
exit /b %EXIT_CODE%

:mainEnd
if "%OS%"=="Windows_NT" endlocal

:omega
````

## File: run-dev.bat
````
@echo off
title LightCare 개발 환경
color 0A
echo.
echo =============================================
echo  🚀 LightCare 개발 환경을 시작합니다
echo =============================================
echo.

REM .env 파일 존재 확인
if not exist ".env" (
    echo ❌ .env 파일을 찾을 수 없습니다!
    echo    프로젝트 루트에 .env 파일을 생성해주세요.
    pause
    exit /b 1
)

echo 📋 .env 파일에서 환경변수를 로드합니다...
echo.

REM .env 파일에서 환경변수 로드
for /f "usebackq eol=# tokens=1,2 delims==" %%a in (".env") do (
    if not "%%a"=="" (
        echo   ✅ %%a 설정 완료
        set "%%a=%%b"
    )
)

echo.
echo 🔑 환경변수 확인:
echo   - KAKAO_APP_KEY: %KAKAO_APP_KEY:~0,10%...
echo   - DB_USERNAME: %DB_USERNAME%
echo   - DB_URL이 설정됨
echo.

echo 🗄️ MySQL 연결을 확인합니다...
mysql -u %DB_USERNAME% -p%DB_PASSWORD% -e "SELECT 1;" 2>nul
if errorlevel 1 (
    echo ⚠️  MySQL 연결에 실패했습니다. MySQL이 실행 중인지 확인해주세요.
    echo.
)

echo 🌱 Spring Boot 애플리케이션을 시작합니다...
echo.
echo =============================================
echo  애플리케이션이 시작되면:
echo  👉 http://localhost:8080 으로 접속하세요
echo  👉 종료하려면 Ctrl+C 를 누르세요
echo =============================================
echo.

REM Gradle 실행
call gradlew.bat bootRun

echo.
echo 📋 애플리케이션이 종료되었습니다.
pause
````

## File: SECURITY_NOTICE.md
````markdown
# 🚨 중요 보안 공지

## ⚠️ 팀원 필독 사항

### 📋 실제 API 키 정보
- **실제 새로운 카카오 API 키**: 
- **이 키는 팀원들만 사용하고 외부에 노출하지 마세요!**

### 🔐 보안 주의사항

#### 1. 문서 파일 보안
- 모든 MD 파일에서는 실제 API 키를 `새로_발급받은_키`로 표시
- 실제 키는 이 문서와 .env 파일에서만 관리
- **이 파일(SECURITY_NOTICE.md)은 절대 Git에 커밋하지 마세요!**

#### 2. 환경변수 설정시 주의
```env
# .env 파일에 실제 키 입력
KAKAO_APP_KEY=
KAKAO_REST_API_KEY=
```

#### 3. 팀 내부 공유 방법
- 슬랙/디스코드 DM으로만 공유
- 공개 채널에 키 정보 절대 금지
- 스크린샷 시 키 정보 모자이크 처리

### 🚫 절대 하지 말아야 할 것
- 실제 API 키를 MD 파일에 작성
- 공개 채널에 키 정보 공유
- 소스코드에 키 하드코딩
- 이 파일을 Git에 커밋

### ✅ 올바른 작업 방법
1. 이 문서에서 실제 키 확인
2. 개인 .env 파일에만 실제 키 입력
3. 문서 작성시 `새로_발급받은_키` 플레이스홀더 사용
4. 팀원 문의시 DM으로 키 정보 공유

---

**🔒 이 파일은 로컬에서만 보관하고 Git에 커밋하지 마세요!**
````

## File: backup/deprecated_files/crop-image.backup.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>프로필 이미지 크롭 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <!-- 브레드크럼 -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item"><a href="/member/myinfo">마이페이지</a></li>
                <li class="breadcrumb-item active" aria-current="page">프로필 이미지 크롭</li>
            </ol>
        </nav>
        
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="card shadow">
                    <div class="card-body p-4">
                        <div class="text-center mb-4">
                            <h3 class="card-title fw-bold text-primary">
                                <i class="fas fa-crop me-2"></i>
                                프로필 이미지 크롭
                            </h3>
                            <p class="text-muted">증명사진 비율(3:4)에 맞춰 프로필 사진을 조절하세요</p>
                        </div>

                        <!-- 고급 이미지 크롭퍼 컨테이너 -->
                        <div id="profileImageCropper"></div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 고급 이미지 크롭퍼 -->
<link rel="stylesheet" href="/css/advanced-image-cropper.css">
<script src="/js/advanced-image-cropper.js"></script>

<script>
$(document).ready(function() {
    // 프로필 이미지 크롭퍼 초기화
    initializeProfileImageCropper();
});

// 프로필 이미지 크롭퍼 초기화
function initializeProfileImageCropper() {
    const profileImageCropper = new AdvancedImageCropper('profileImageCropper', {
        // 프로필 이미지 최적화 설정
        aspectRatio: 3/4, // 프로필 증명사진 비율
        cropWidth: 300,
        cropHeight: 400,
        previewStyle: 'profile',
        title: '프로필 이미지 업로드',
        quality: 0.9,
        enableAltText: true,
        showSteps: true,
        
        // 크롭 완료 콜백
        onCropComplete: function(result) {
            console.log('프로필 이미지 크롭 완료:', result);
            
            // 서버에 크롭된 이미지 저장
            saveProfileImage(result);
        },
        
        // 에러 콜백
        onError: function(message) {
            console.error('프로필 이미지 크롭 오류:', message);
            showErrorMessage('이미지 처리 중 오류가 발생했습니다: ' + message);
        }
    });
    
    // 전역에서 접근 가능하도록 저장
    window.profileImageCropper = profileImageCropper;
}

// 프로필 이미지 서버 저장
function saveProfileImage(result) {
    // 로딩 표시
    showLoadingMessage('프로필 이미지 저장 중...');
    
    const formData = new FormData();
    formData.append('croppedImage', result.imageData);
    formData.append('altText', result.altText);
    
    fetch('/member/myinfo/crop-image/save', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        hideLoadingMessage();
        
        if (data.success) {
            showSuccessMessage('프로필 이미지가 성공적으로 저장되었습니다!');
            
            // 2초 후 마이페이지로 이동
            setTimeout(() => {
                window.location.href = '/member/myinfo/edit';
            }, 2000);
        } else {
            showErrorMessage(data.message || '프로필 이미지 저장에 실패했습니다.');
        }
    })
    .catch(error => {
        hideLoadingMessage();
        console.error('프로필 이미지 저장 오류:', error);
        showErrorMessage('프로필 이미지 저장 중 오류가 발생했습니다.');
    });
}

// 로딩 메시지 표시
function showLoadingMessage(message) {
    const existingLoading = document.querySelector('.loading-overlay');
    if (existingLoading) existingLoading.remove();
    
    const loadingDiv = document.createElement('div');
    loadingDiv.className = 'loading-overlay position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center';
    loadingDiv.style.cssText = 'background: rgba(0,0,0,0.5); z-index: 9999;';
    loadingDiv.innerHTML = `
        <div class="text-center text-white">
            <div class="spinner-border mb-3" role="status"></div>
            <div>${message}</div>
        </div>
    `;
    
    document.body.appendChild(loadingDiv);
}

// 로딩 메시지 숨김
function hideLoadingMessage() {
    const loadingOverlay = document.querySelector('.loading-overlay');
    if (loadingOverlay) {
        loadingOverlay.remove();
    }
}

// 성공 메시지 표시
function showSuccessMessage(message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-success alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3';
    alertDiv.style.cssText = 'z-index: 10000; min-width: 300px;';
    alertDiv.innerHTML = `
        <i class="fas fa-check-circle me-2"></i>${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    // 5초 후 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}

// 에러 메시지 표시
function showErrorMessage(message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-danger alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3';
    alertDiv.style.cssText = 'z-index: 10000; min-width: 300px;';
    alertDiv.innerHTML = `
        <i class="fas fa-exclamation-triangle me-2"></i>${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    // 10초 후 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 10000);
}
</script>

</body>
</html>
````

## File: backup/deprecated_files/crop-image.backup.js
````javascript
/**
 * 프로필 이미지 크롭 전용 JavaScript
 * 한국 표준 증명사진 비율(3:4) 최적화 버전
 * Cropper.js 라이브러리 사용
 */

// 전역 변수
let cropper = null;
let originalImageData = null;
let originalImage = null;

// DOM 요소
const elements = {};

// 초기화
document.addEventListener('DOMContentLoaded', function() {
    initializeElements();
    setupEventListeners();
    console.log('프로필 이미지 크롭 페이지 초기화 완료 (Cropper.js)');
});

// DOM 요소 초기화
function initializeElements() {
    elements.imageInput = document.getElementById('imageInput');
    elements.cropImage = document.getElementById('cropImage');
    elements.uploadSection = document.getElementById('uploadSection');
    elements.cropSection = document.getElementById('cropSection');
    elements.completeSection = document.getElementById('completeSection');
    elements.previewCanvas = document.getElementById('previewCanvas');
    elements.finalPreview = document.getElementById('finalPreview');
    elements.zoomIndicator = document.getElementById('zoomIndicator');
    elements.zoomLevel = document.getElementById('zoomLevel');
    elements.zoomStatus = document.getElementById('zoomStatus');
    
    // 단계 요소
    elements.steps = {
        step1: document.getElementById('step1'),
        step2: document.getElementById('step2'),
        step3: document.getElementById('step3')
    };
    
    // 버튼 요소
    elements.buttons = {
        zoomIn: document.getElementById('zoomIn'),
        zoomOut: document.getElementById('zoomOut'),
        resetZoom: document.getElementById('resetZoom'),
        backToUpload: document.getElementById('backToUpload'),
        cropAndSave: document.getElementById('cropAndSave'),
        cropAnother: document.getElementById('cropAnother')
    };
}

// 이벤트 리스너 설정
function setupEventListeners() {
    // 파일 입력 이벤트 등록
    if (elements.imageInput) {
        elements.imageInput.removeEventListener('change', handleImageUpload);
        elements.imageInput.addEventListener('change', handleImageUpload);
        console.log('파일 입력 이벤트 리스너 등록됨');
    }
    
    // 확대/축소 버튼
    if (elements.buttons.zoomIn) {
        elements.buttons.zoomIn.addEventListener('click', () => {
            if (cropper) {
                cropper.zoom(0.1);
            }
        });
    }
    
    if (elements.buttons.zoomOut) {
        elements.buttons.zoomOut.addEventListener('click', () => {
            if (cropper) {
                cropper.zoom(-0.1);
            }
        });
    }
    
    if (elements.buttons.resetZoom) {
        elements.buttons.resetZoom.addEventListener('click', () => {
            if (cropper) {
                cropper.reset();
            }
        });
    }
    
    // 네비게이션 버튼
    if (elements.buttons.backToUpload) {
        elements.buttons.backToUpload.addEventListener('click', goToUploadStep);
    }
    
    if (elements.buttons.cropAndSave) {
        elements.buttons.cropAndSave.addEventListener('click', cropAndSaveImage);
    }
    
    if (elements.buttons.cropAnother) {
        elements.buttons.cropAnother.addEventListener('click', goToUploadStep);
    }
    
    // 파일 선택 버튼
    const fileSelectBtn = document.getElementById('fileSelectBtn');
    if (fileSelectBtn) {
        fileSelectBtn.addEventListener('click', () => {
            console.log('파일 선택 버튼 클릭됨');
            if (elements.imageInput) {
                elements.imageInput.click();
            }
        });
    }
    
    // 드래그 앤 드롭 (업로드 영역 전체)
    const uploadArea = document.querySelector('.upload-area');
    if (uploadArea) {
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('drop', handleDrop);
        
        // 업로드 영역 클릭 시 파일 선택 (버튼 영역 제외)
        uploadArea.addEventListener('click', (event) => {
            if (!event.target.closest('#fileSelectBtn')) {
                console.log('업로드 영역 클릭됨');
                if (elements.imageInput) {
                    elements.imageInput.click();
                }
            }
        });
    }
}

// 드래그 오버 처리
function handleDragOver(event) {
    event.preventDefault();
    event.currentTarget.style.borderColor = '#0d6efd';
    event.currentTarget.style.backgroundColor = '#f8f9ff';
}

// 드롭 처리
function handleDrop(event) {
    event.preventDefault();
    const files = event.dataTransfer.files;
    if (files.length > 0) {
        handleImageFile(files[0]);
    }
    
    // 스타일 리셋
    event.currentTarget.style.borderColor = '';
    event.currentTarget.style.backgroundColor = '';
}

// 이미지 업로드 처리
function handleImageUpload(event) {
    console.log('파일 업로드 이벤트 발생:', event);
    const file = event.target.files[0];
    if (file) {
        console.log('선택된 파일:', file.name, file.size, file.type);
        handleImageFile(file);
    } else {
        console.log('선택된 파일이 없습니다');
    }
}

// 이미지 파일 처리
function handleImageFile(file) {
    console.log('이미지 파일 처리 시작:', file.name);
    
    // 파일 타입 검증
    if (!file.type.startsWith('image/')) {
        alert('이미지 파일만 업로드 가능합니다.');
        return;
    }
    
    // 파일 크기 검증 (5MB)
    if (file.size > 5 * 1024 * 1024) {
        alert('파일 크기는 5MB 이하여야 합니다.');
        return;
    }
    
    // 지원되는 형식 검증
    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];
    if (!allowedTypes.includes(file.type)) {
        alert('JPG, PNG 파일만 지원됩니다.');
        return;
    }
    
    console.log('파일 검증 통과, FileReader 시작');
    
    // 로컬에서 이미지 로드
    const reader = new FileReader();
    reader.onload = function(e) {
        console.log('FileReader 로드 완료');
        originalImageData = e.target.result;
        loadImageToCropper(originalImageData);
        goToCropStep();
    };
    reader.onerror = function(e) {
        console.error('FileReader 오류:', e);
        alert('파일 읽기 중 오류가 발생했습니다.');
    };
    reader.readAsDataURL(file);
}

// 크롭퍼에 이미지 로드
function loadImageToCropper(imageData) {
    if (!elements.cropImage) return;
    
    elements.cropImage.src = imageData;
    elements.cropImage.style.display = 'block';
    
    // 이미지가 로드된 후 크롭퍼 초기화
    elements.cropImage.onload = function() {
        console.log('이미지 로드 완료, 크롭퍼 초기화 시작');
        setTimeout(() => {
            initializeCropper();
        }, 100);
    };
}

// 크롭퍼 초기화 (Cropper.js 사용)
function initializeCropper() {
    if (cropper) {
        cropper.destroy();
    }
    
    console.log('🚀 Cropper.js 초기화 시작');
    
    // 한국 표준 증명사진 비율 적용 (가로3:세로4)
    const aspectRatio = 3 / 4; // 0.75 (세로가 더 긴 형태)
    
    cropper = new Cropper(elements.cropImage, {
        aspectRatio: aspectRatio, // 3:4 비율
        viewMode: 1, // 크롭 박스를 캔버스 내부로 제한
        dragMode: 'move', // 드래그 모드
        autoCropArea: 0.8, // 자동 크롭 영역 크기
        restore: false, // 크기 조정 시 크롭 박스 복원 안함
        guides: true, // 가이드 라인 표시
        center: true, // 중앙 표시자 표시
        highlight: true, // 크롭 박스 하이라이트
        cropBoxMovable: true, // 크롭 박스 이동 가능
        cropBoxResizable: true, // 크롭 박스 크기 조정 가능
        toggleDragModeOnDblclick: false, // 더블클릭으로 드래그 모드 토글 안함
        
        // 초기화 완료 시
        ready: function() {
            console.log('✅ Cropper.js 초기화 완료');
            console.log('📏 설정된 aspectRatio:', aspectRatio);
            console.log('🎯 목표: 증명사진 비율 (3:4, 세로가 더 긴 형태)');
            
            // 초기 크롭 데이터 확인
            const cropData = cropper.getData();
            const currentRatio = cropData.width / cropData.height;
            console.log('📊 초기 크롭 영역:', Math.round(cropData.width), 'x', Math.round(cropData.height));
            console.log('📊 초기 실제 비율:', currentRatio.toFixed(3), '목표:', aspectRatio.toFixed(3));
            
            // 초기 미리보기 업데이트
            updatePreview();
        },
        
        // 크롭 변경 시
        crop: function(event) {
            const data = event.detail;
            const currentRatio = data.width / data.height;
            
            // 비율 확인 로그
            if (Math.abs(currentRatio - aspectRatio) > 0.01) {
                console.log('⚠️ 비율 확인:', currentRatio.toFixed(3), '목표:', aspectRatio.toFixed(3));
            }
            
            // 미리보기 업데이트
            updatePreview();
        }
    });
    
    // 스마트 스크롤 기능 추가 (이미지 확대/축소 우선, 한계점에서 페이지 스크롤)
    setupSmartScroll();
}

// 스마트 스크롤 기능
function setupSmartScroll() {
    if (!cropper || !elements.cropImage) return;
    
    const cropContainer = elements.cropImage.parentElement;
    if (!cropContainer) return;
    
    // 최대/최소 줌 레벨 설정
    const MIN_ZOOM = 0.1;  // 최소 줌 (10%)
    const MAX_ZOOM = 3.0;  // 최대 줌 (300%)
    
    console.log('🖱️ 스마트 스크롤 기능 활성화');
    
    cropContainer.addEventListener('wheel', function(event) {
        if (!cropper) return;
        
        // 현재 줌 레벨 확인 (더 정확한 방식)
        const canvasData = cropper.getCanvasData();
        const containerData = cropper.getContainerData();
        const currentZoom = canvasData.naturalWidth > 0 ? canvasData.width / canvasData.naturalWidth : 1;
        
        const isZoomingIn = event.deltaY < 0;  // 휠을 위로 올리면 확대
        const isZoomingOut = event.deltaY > 0; // 휠을 아래로 내리면 축소
        
        console.log('🔍 현재 줌:', currentZoom.toFixed(2), '방향:', isZoomingIn ? '확대' : '축소');
        
        // 더 관대한 임계값 설정
        const maxThreshold = 2.8;  // 조금 더 낮은 최대값
        const minThreshold = 0.2;  // 조금 더 높은 최소값
        
        // 확대 시: 최대 줌 근처에서 페이지 스크롤 허용
        if (isZoomingIn && currentZoom >= maxThreshold) {
            updateZoomIndicator(currentZoom, '최대 확대');
            console.log('📈 최대 확대 근처 - 페이지 스크롤 실행');
            
            // 페이지 스크롤을 더 부드럽게 실행
            const scrollAmount = event.deltaY * 0.5; // 스크롤 강도 조절
            window.scrollBy({
                top: scrollAmount,
                behavior: 'smooth'
            });
            return;
        }
        
        // 축소 시: 최소 줌 근처에서 페이지 스크롤 허용  
        if (isZoomingOut && currentZoom <= minThreshold) {
            updateZoomIndicator(currentZoom, '최소 축소');
            console.log('📉 최소 축소 근처 - 페이지 스크롤 실행');
            
            // 페이지 스크롤을 더 부드럽게 실행
            const scrollAmount = event.deltaY * 0.5; // 스크롤 강도 조절
            window.scrollBy({
                top: scrollAmount,
                behavior: 'smooth'
            });
            return;
        }
        
        // 이미지 확대/축소 범위 내에서는 기본 스크롤 차단하고 줌 적용
        event.preventDefault();
        event.stopPropagation();
        
        const zoomDelta = isZoomingIn ? 0.1 : -0.1;
        cropper.zoom(zoomDelta);
        
        // 줌 표시기 업데이트
        const newZoom = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, currentZoom + zoomDelta));
        updateZoomIndicator(newZoom, isZoomingIn ? '확대' : '축소');
        
    }, { passive: false }); // passive: false로 설정해야 preventDefault 작동
}

// 줌 표시기 업데이트
function updateZoomIndicator(zoomLevel, status) {
    if (!elements.zoomIndicator || !elements.zoomLevel || !elements.zoomStatus) return;
    
    // 줌 레벨을 퍼센트로 표시
    const zoomPercent = Math.round(zoomLevel * 100);
    elements.zoomLevel.textContent = zoomPercent + '%';
    
    // 상태 메시지 업데이트
    let statusMessage = '';
    let statusClass = '';
    
    if (status === '최대 확대') {
        statusMessage = '(최대 - 페이지 스크롤 가능)';
        statusClass = 'text-warning';
    } else if (status === '최소 축소') {
        statusMessage = '(최소 - 페이지 스크롤 가능)';
        statusClass = 'text-info';
    } else {
        statusMessage = `(${status} 중)`;
        statusClass = 'text-success';
    }
    
    elements.zoomStatus.textContent = statusMessage;
    elements.zoomStatus.className = `ms-2 ${statusClass}`;
    
    // 줌 표시기 보이기
    elements.zoomIndicator.style.display = 'block';
    
    // 3초 후 자동 숨김
    clearTimeout(window.zoomIndicatorTimeout);
    window.zoomIndicatorTimeout = setTimeout(() => {
        if (elements.zoomIndicator) {
            elements.zoomIndicator.style.display = 'none';
        }
    }, 3000);
}

// 미리보기 업데이트
function updatePreview() {
    if (!cropper || !elements.previewCanvas) {
        return;
    }
    
    console.log('🖼️ 미리보기 업데이트 시작');
    
    // 크롭된 이미지를 캔버스에 그리기
    const canvas = cropper.getCroppedCanvas({
        width: 90,  // 미리보기 캔버스 크기와 동일
        height: 120,
        imageSmoothingEnabled: true,
        imageSmoothingQuality: 'high'
    });
    
    if (canvas) {
        const ctx = elements.previewCanvas.getContext('2d');
        ctx.clearRect(0, 0, elements.previewCanvas.width, elements.previewCanvas.height);
        
        // 크롭된 이미지를 미리보기 캔버스에 그리기
        ctx.drawImage(canvas, 0, 0, elements.previewCanvas.width, elements.previewCanvas.height);
        
        console.log('✅ 미리보기 업데이트 완료');
    }
}

// 크롭 및 저장
function cropAndSaveImage() {
    if (!cropper) {
        alert('이미지를 먼저 로드해주세요.');
        return;
    }
    
    setButtonLoading(elements.buttons.cropAndSave, true, '저장 중...');
    
    try {
        // 최종 크롭된 이미지 생성 (고품질)
        const canvas = cropper.getCroppedCanvas({
            width: 300,   // 최종 이미지 가로 크기
            height: 400,  // 최종 이미지 세로 크기 (3:4 비율)
            imageSmoothingEnabled: true,
            imageSmoothingQuality: 'high'
        });
        
        if (canvas) {
            // Base64로 변환하여 서버에 전송
            const croppedImageData = canvas.toDataURL('image/jpeg', 0.9);
            saveImageToServer(croppedImageData);
        } else {
            throw new Error('캔버스 생성 실패');
        }
        
    } catch (error) {
        console.error('크롭 처리 오류:', error);
        setButtonLoading(elements.buttons.cropAndSave, false);
        alert('이미지 처리 중 오류가 발생했습니다.');
    }
}

// 서버에 크롭된 이미지 저장
function saveImageToServer(croppedImageData) {
    const formData = new FormData();
    formData.append('croppedImage', croppedImageData);
    
    fetch('/member/myinfo/crop-image/save', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        setButtonLoading(elements.buttons.cropAndSave, false);
        
        if (data.success) {
            // 최종 미리보기 설정
            if (elements.finalPreview) {
                elements.finalPreview.src = croppedImageData;
            }
            
            // 성공 시 완료 단계 표시
            goToCompleteStep();
            console.log('프로필 이미지 저장 성공');
            
            // 3초 후 마이페이지로 자동 이동 (선택사항)
            setTimeout(() => {
                window.location.href = '/member/myinfo/edit';
            }, 2000);
        } else {
            alert(data.message || '이미지 저장에 실패했습니다.');
        }
    })
    .catch(error => {
        setButtonLoading(elements.buttons.cropAndSave, false);
        console.error('저장 오류:', error);
        alert('이미지 저장 중 오류가 발생했습니다.');
    });
}

// 단계 이동 함수들
function goToUploadStep() {
    hideAllSections();
    if (elements.uploadSection) elements.uploadSection.style.display = 'block';
    updateStepIndicator(1);
    
    // 초기화
    if (elements.imageInput) elements.imageInput.value = '';
    if (cropper) {
        cropper.destroy();
        cropper = null;
    }
    originalImageData = null;
    originalImage = null;
}

function goToCropStep() {
    hideAllSections();
    if (elements.cropSection) elements.cropSection.style.display = 'block';
    updateStepIndicator(2);
}

function goToCompleteStep() {
    hideAllSections();
    if (elements.completeSection) elements.completeSection.style.display = 'block';
    updateStepIndicator(3);
}

// 모든 섹션 숨기기
function hideAllSections() {
    if (elements.uploadSection) elements.uploadSection.style.display = 'none';
    if (elements.cropSection) elements.cropSection.style.display = 'none';
    if (elements.completeSection) elements.completeSection.style.display = 'none';
}

// 단계 표시기 업데이트
function updateStepIndicator(currentStep) {
    // 모든 단계 초기화
    Object.values(elements.steps).forEach(step => {
        if (step) {
            step.classList.remove('active', 'completed');
        }
    });
    
    // 현재 단계까지 활성화
    for (let i = 1; i <= currentStep; i++) {
        const step = elements.steps[`step${i}`];
        if (step) {
            if (i === currentStep) {
                step.classList.add('active');
            } else {
                step.classList.add('completed');
            }
        }
    }
}

// 버튼 로딩 상태 설정
function setButtonLoading(button, isLoading, loadingText = '처리 중...') {
    if (!button) return;
    
    if (isLoading) {
        button.disabled = true;
        button.classList.add('loading');
        button.setAttribute('data-original-text', button.innerHTML);
        button.innerHTML = `<i class="fas fa-spinner fa-spin me-1"></i>${loadingText}`;
    } else {
        button.disabled = false;
        button.classList.remove('loading');
        const originalText = button.getAttribute('data-original-text');
        if (originalText) {
            button.innerHTML = originalText;
        }
    }
}
````

## File: backup/deprecated_files/facility-image-cropper.backup.js
````javascript
/**
 * 시설 이미지 크롭 전용 JavaScript
 * 프로필 이미지 방식을 기반으로 다중 이미지 처리 추가
 * 16:9 비율 최적화 버전
 */

// 전역 변수
let cropper = null;
let originalImages = [];
let croppedImages = [];
let currentImageIndex = 0;
let facilityId = null;
let smartScrollInstance = null;

// DOM 요소들
const elements = {};

// 초기화
document.addEventListener('DOMContentLoaded', function() {
    console.log('🎬 시설 이미지 크롭퍼 초기화 시작');
    
    // URL에서 시설 ID 추출
    const pathParts = window.location.pathname.split('/');
    facilityId = pathParts[pathParts.length - 1];
    console.log('🏢 시설 ID:', facilityId);
    
    initializeElements();
    setupEventListeners();
    setupDragAndDrop();
    
    console.log('✅ 시설 이미지 크롭퍼 초기화 완료');
});

// DOM 요소 초기화 (프로필 이미지 방식 적용)
function initializeElements() {
    console.log('🔍 DOM 요소 초기화 시작');
    
    // 기본 요소들
    elements.imageInput = document.getElementById('imageInput');
    elements.uploadSection = document.getElementById('uploadSection');
    elements.cropSection = document.getElementById('cropSection');
    elements.compressionSection = document.getElementById('compressionSection');
    elements.completeSection = document.getElementById('completeSection');
    
    // 업로드 관련
    elements.uploadArea = document.getElementById('uploadArea');
    elements.fileSelectBtn = document.getElementById('fileSelectBtn');
    
    // 이미지 리스트
    elements.imageListSection = document.getElementById('imageListSection');
    elements.imageList = document.getElementById('imageList');
    elements.imageCount = document.getElementById('imageCount');
    
    // 크롭 관련
    elements.cropImage = document.getElementById('cropImage');
    elements.previewCanvas = document.getElementById('previewCanvas');
    elements.currentImageNumber = document.getElementById('currentImageNumber');
    elements.imageDimensions = document.getElementById('imageDimensions');
    elements.imageFileName = document.getElementById('imageFileName');
    
    // 줌 표시기
    elements.zoomIndicator = document.getElementById('zoomIndicator');
    elements.zoomLevel = document.getElementById('zoomLevel');
    elements.zoomStatus = document.getElementById('zoomStatus');
    
    // 단계 표시기
    elements.steps = {
        step1: document.getElementById('step1'),
        step2: document.getElementById('step2'),
        step3: document.getElementById('step3'),
        step4: document.getElementById('step4')
    };
    
    // 버튼들
    elements.buttons = {
        fileSelect: document.getElementById('fileSelectBtn'),
        backToUpload: document.getElementById('backToUploadBtn'),
        prevImage: document.getElementById('prevImageBtn'),
        nextImage: document.getElementById('nextImageBtn'),
        cropCurrent: document.getElementById('cropCurrentBtn'),
        zoomIn: document.getElementById('zoomInBtn'),
        zoomOut: document.getElementById('zoomOutBtn'),
        rotateLeft: document.getElementById('rotateLeftBtn'),
        rotateRight: document.getElementById('rotateRightBtn'),
        reset: document.getElementById('resetBtn')
    };
    
    console.log('✅ DOM 요소 초기화 완료');
    
    // 필수 요소 검증
    const requiredElements = ['imageInput', 'uploadSection', 'cropSection'];
    const missingElements = requiredElements.filter(key => !elements[key]);
    
    if (missingElements.length > 0) {
        console.error('❌ 필수 DOM 요소가 없습니다:', missingElements);
    }
}

// 이벤트 리스너 설정 (프로필 이미지 방식 적용)
function setupEventListeners() {
    console.log('🔗 이벤트 리스너 설정 시작');
    
    // 파일 입력 이벤트
    if (elements.imageInput) {
        elements.imageInput.removeEventListener('change', handleMultipleImageUpload);
        elements.imageInput.addEventListener('change', handleMultipleImageUpload);
        console.log('📁 파일 입력 이벤트 리스너 등록됨');
    }
    
    // 파일 선택 버튼 (프로필 방식)
    const fileSelectBtn = document.getElementById('fileSelectBtn');
    if (fileSelectBtn) {
        fileSelectBtn.addEventListener('click', () => {
            console.log('📁 파일 선택 버튼 클릭됨');
            if (elements.imageInput) {
                elements.imageInput.click();
            }
        });
        console.log('✅ 파일 선택 버튼 이벤트 등록 완료');
    }
    
    // 크롭 컨트롤 버튼들
    if (elements.buttons.zoomIn) {
        elements.buttons.zoomIn.addEventListener('click', () => zoomCropper(0.1));
    }
    if (elements.buttons.zoomOut) {
        elements.buttons.zoomOut.addEventListener('click', () => zoomCropper(-0.1));
    }
    if (elements.buttons.rotateLeft) {
        elements.buttons.rotateLeft.addEventListener('click', () => rotateCropper(-90));
    }
    if (elements.buttons.rotateRight) {
        elements.buttons.rotateRight.addEventListener('click', () => rotateCropper(90));
    }
    if (elements.buttons.reset) {
        elements.buttons.reset.addEventListener('click', () => resetCropper());
    }
    
    // 네비게이션 버튼들
    if (elements.buttons.backToUpload) {
        elements.buttons.backToUpload.addEventListener('click', goToUploadStep);
    }
    if (elements.buttons.prevImage) {
        elements.buttons.prevImage.addEventListener('click', goToPreviousImage);
    }
    if (elements.buttons.nextImage) {
        elements.buttons.nextImage.addEventListener('click', goToNextImage);
    }
    if (elements.buttons.cropCurrent) {
        elements.buttons.cropCurrent.addEventListener('click', cropCurrentImage);
    }
    
    // 압축 단계 버튼들 추가
    const backToCropBtn = document.getElementById('backToCropBtn');
    if (backToCropBtn) {
        backToCropBtn.addEventListener('click', () => {
            console.log('🔙 크롭 단계로 돌아가기');
            goToCropStep();
        });
    }
    
    const saveAllImagesBtn = document.getElementById('saveAllImagesBtn');
    if (saveAllImagesBtn) {
        saveAllImagesBtn.addEventListener('click', () => {
            console.log('💾 모든 이미지 저장 시작');
            saveAllImages();
        });
    }
    
    // 압축 설정 이벤트 리스너 추가
    setupCompressionControls();
    
    // 완료 단계 버튼들
    const addMoreImagesBtn = document.getElementById('addMoreImagesBtn');
    if (addMoreImagesBtn) {
        addMoreImagesBtn.addEventListener('click', () => {
            console.log('➕ 이미지 더 추가 버튼 클릭');
            goToUploadStep();
        });
    }
    
    // 키보드 단축키
    setupKeyboardShortcuts();
    
    console.log('✅ 이벤트 리스너 설정 완료');
}

// 압축 설정 컨트롤 설정 (새로 추가)
function setupCompressionControls() {
    // 품질 슬라이더 이벤트
    const qualitySlider = document.getElementById('qualitySlider');
    const qualityPercent = document.getElementById('qualityPercent');
    
    if (qualitySlider && qualityPercent) {
        qualitySlider.addEventListener('input', function() {
            const value = Math.round(this.value * 100);
            qualityPercent.textContent = value + '%';
            updateCompressionPreview();
        });
        
        // 초기값 설정
        qualityPercent.textContent = Math.round(qualitySlider.value * 100) + '%';
    }
    
    // 이미지 형식 라디오 이벤트
    const formatRadios = document.querySelectorAll('input[name="imageFormat"]');
    formatRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            updateCompressionPreview();
            console.log('🔄 이미지 형식 변경:', this.value);
        });
    });
    
    // 자동 최적화 체크박스
    const autoOptimize = document.getElementById('autoOptimize');
    if (autoOptimize) {
        autoOptimize.addEventListener('change', function() {
            updateCompressionPreview();
            console.log('🤖 자동 최적화:', this.checked);
        });
    }
    
    console.log('⚙️ 압축 컨트롤 설정 완료');
}

// 모든 이미지 저장 기능 (서버 통신 구현)
function saveAllImages() {
    if (croppedImages.length === 0) {
        alert('저장할 이미지가 없습니다.');
        return;
    }
    
    console.log('📤 시설 이미지 서버 저장 시작');
    const saveBtn = document.getElementById('saveAllImagesBtn');
    setButtonLoading(saveBtn, true, '저장 중...');
    
    // Alt 텍스트 가져오기
    const altTextInput = document.getElementById('altTextInput');
    const altText = altTextInput ? altTextInput.value.trim() : '';
    
    // 압축 설정 가져오기
    const qualitySlider = document.getElementById('qualitySlider');
    const quality = qualitySlider ? parseFloat(qualitySlider.value) : 0.8;
    
    const formatRadios = document.querySelectorAll('input[name="imageFormat"]:checked');
    const format = formatRadios.length > 0 ? formatRadios[0].value : 'jpeg';
    
    // FormData 생성
    const formData = new FormData();
    formData.append('facilityId', facilityId);
    formData.append('altText', altText);
    formData.append('quality', quality);
    formData.append('format', format);
    
    // 크롭된 이미지들 추가
    croppedImages.forEach((image, index) => {
        if (image && image.croppedDataUrl) {
            formData.append(`croppedImage_${index}`, image.croppedDataUrl);
            formData.append(`originalName_${index}`, image.name);
        }
    });
    
    console.log(`📸 전송할 이미지 수: ${croppedImages.filter(img => img && img.croppedDataUrl).length}`);
    
    // 서버에 저장 요청
    fetch(`/facility/crop-images/${facilityId}/save`, {
        method: 'POST',
        body: formData
    })
    .then(response => {
        console.log('📡 서버 응답 상태:', response.status);
        return response.json();
    })
    .then(data => {
        setButtonLoading(saveBtn, false);
        console.log('📥 서버 응답 데이터:', data);
        
        if (data.success) {
            console.log('✅ 시설 이미지 저장 성공');
            goToCompleteStep();
            
            // 성공 메시지 표시
            setTimeout(() => {
                alert('시설 이미지가 성공적으로 저장되었습니다!');
            }, 500);
            
        } else {
            console.error('❌ 저장 실패:', data.message);
            alert(data.message || '이미지 저장에 실패했습니다.');
        }
    })
    .catch(error => {
        setButtonLoading(saveBtn, false);
        console.error('🚨 저장 오류:', error);
        alert('이미지 저장 중 오류가 발생했습니다.');
    });
}

// 완료 단계로 이동 (새로 추가)
function goToCompleteStep() {
    hideAllSections();
    if (elements.completeSection) {
        elements.completeSection.style.display = 'block';
        console.log('🎆 완료 단계 표시');
    }
    updateStepIndicator(4);
    
    // 완료된 이미지들 표시
    updateFinalImagesGrid();
}

// 최종 이미지 그리드 업데이트 (새로 추가)
function updateFinalImagesGrid() {
    const finalImagesGrid = document.getElementById('finalImagesGrid');
    if (!finalImagesGrid) return;
    
    finalImagesGrid.innerHTML = '';
    
    croppedImages.forEach((image, index) => {
        if (image && image.croppedDataUrl) {
            const imageElement = document.createElement('div');
            imageElement.className = 'col-md-3 col-sm-4 col-6 mb-3';
            imageElement.innerHTML = `
                <div class="card">
                    <img src="${image.croppedDataUrl}" class="card-img-top" style="height: 120px; object-fit: cover;">
                    <div class="card-body p-2">
                        <small class="text-muted">이미지 ${index + 1}</small>
                    </div>
                </div>
            `;
            finalImagesGrid.appendChild(imageElement);
        }
    });
    
    console.log(`🖼️ 최종 이미지 그리드 업데이트: ${croppedImages.length}개`);
}

// 드래그 앤 드롭 설정 (프로필 방식 적용)
function setupDragAndDrop() {
    const uploadArea = elements.uploadArea;
    if (!uploadArea) return;
    
    uploadArea.addEventListener('dragover', handleDragOver);
    uploadArea.addEventListener('drop', handleDrop);
    
    // 업로드 영역 클릭 시 파일 선택 (프로필 방식)
    uploadArea.addEventListener('click', (event) => {
        if (!event.target.closest('#fileSelectBtn')) {
            console.log('🖱️ 업로드 영역 클릭됨');
            if (elements.imageInput) {
                elements.imageInput.click();
            }
        }
    });
    
    console.log('🎯 드래그 앤 드롭 설정 완료');
}

// 드래그 오버 처리 (프로필 방식)
function handleDragOver(event) {
    event.preventDefault();
    event.currentTarget.style.borderColor = '#0d6efd';
    event.currentTarget.style.backgroundColor = '#f8f9ff';
}

// 드롭 처리 (프로필 방식)
function handleDrop(event) {
    event.preventDefault();
    const files = Array.from(event.dataTransfer.files);
    if (files.length > 0) {
        console.log(`🎯 드롭된 파일 수: ${files.length}`);
        handleMultipleFiles(files);
    }
    
    // 스타일 리셋
    event.currentTarget.style.borderColor = '';
    event.currentTarget.style.backgroundColor = '';
}

// 다중 이미지 업로드 처리
function handleMultipleImageUpload(event) {
    console.log('📁 다중 파일 업로드 이벤트 발생');
    const files = Array.from(event.target.files);
    handleMultipleFiles(files);
}

// 다중 파일 처리 메인 로직
function handleMultipleFiles(files) {
    if (files.length === 0) {
        console.log('선택된 파일이 없습니다');
        return;
    }
    
    console.log(`📸 선택된 파일 수: ${files.length}`);
    
    // 최대 5장 제한
    if (files.length > 5) {
        alert('최대 5장까지만 등록할 수 있습니다.');
        return;
    }
    
    // 파일 검증
    const validFiles = files.filter(file => validateImageFile(file));
    if (validFiles.length === 0) {
        alert('유효한 이미지 파일이 없습니다.');
        return;
    }
    
    if (validFiles.length !== files.length) {
        alert(`${files.length - validFiles.length}개 파일이 형식 오류로 제외되었습니다.`);
    }
    
    // 기존 이미지 초기화
    originalImages = [];
    croppedImages = [];
    currentImageIndex = 0;
    
    // 모든 파일 처리
    processMultipleFiles(validFiles);
}

// 이미지 파일 검증 (프로필 방식)
function validateImageFile(file) {
    console.log(`🔍 파일 검증: ${file.name}`);
    
    // 파일 타입 검증
    if (!file.type.startsWith('image/')) {
        console.error(`❌ 이미지 파일이 아님: ${file.name}`);
        return false;
    }
    
    // 지원되는 형식 검증
    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
    if (!allowedTypes.includes(file.type)) {
        console.error(`❌ 지원되지 않는 형식: ${file.name} (${file.type})`);
        return false;
    }
    
    // 파일 크기 검증 (10MB)
    if (file.size > 10 * 1024 * 1024) {
        console.error(`❌ 파일 크기 초과: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)}MB)`);
        return false;
    }
    
    console.log(`✅ 파일 검증 통과: ${file.name}`);
    return true;
}

// 다중 파일 순차 처리 (프로필 방식 완전 적용)
function processMultipleFiles(files) {
    let processedCount = 0;
    
    files.forEach((file, index) => {
        processSingleFile(file, index, () => {
            processedCount++;
            console.log(`📸 처리 진행률: ${processedCount}/${files.length}`);
            
            if (processedCount === files.length) {
                console.log('✅ 모든 이미지 로드 완료 - 프로필 방식 적용');
                
                // 프로필 방식: 즉시 실행 (타이밍 문제 해결)
                showImageList();
                loadCurrentImageToCropper();
                goToCropStep();
                
                console.log('🚀 모든 단계 실행 완료');
            }
        });
    });
}

// 단일 파일 처리 (프로필 방식 적용)
function processSingleFile(file, index, callback) {
    console.log(`🖼️ 이미지 처리 시작: ${file.name} (${index + 1})`);
    
    const reader = new FileReader();
    reader.onload = function(e) {
        const imageData = {
            id: index,
            name: file.name,
            size: file.size,
            type: file.type,
            dataUrl: e.target.result,
            originalFile: file
        };
        
        originalImages.push(imageData);
        console.log(`✅ 이미지 로드 완료: ${file.name}`);
        
        if (callback) callback();
    };
    
    reader.onerror = function() {
        console.error(`❌ 파일 읽기 실패: ${file.name}`);
        alert(`${file.name} 파일을 읽을 수 없습니다.`);
    };
    
    reader.readAsDataURL(file);
}

// 크롭퍼 초기화 (16:9 비율)
function initializeCropper() {
    if (!elements.cropImage) {
        console.error('❌ cropImage 요소를 찾을 수 없습니다.');
        return;
    }
    
    console.log('🔧 크롭퍼 초기화 - 16:9 비율');
    
    // 기존 크롭퍼 정리
    if (cropper) {
        cropper.destroy();
        cropper = null;
    }
    
    // 스마트 스크롤 인스턴스 정리
    if (smartScrollInstance) {
        smartScrollInstance.destroy();
        smartScrollInstance = null;
    }
    
    cropper = new Cropper(elements.cropImage, {
        aspectRatio: 16 / 9, // 시설 사진은 16:9 비율
        viewMode: 1,
        dragMode: 'move',
        autoCropArea: 0.8,
        responsive: true,
        restore: false,
        guides: true,
        center: true,
        highlight: false,
        cropBoxMovable: true,
        cropBoxResizable: true,
        toggleDragModeOnDblclick: true,
        rotatable: true,
        scalable: true,
        zoomable: true,
        minCropBoxWidth: 200,
        minCropBoxHeight: 112,
        ready() {
            console.log('✅ 크롭퍼 준비 완료');
            updatePreview();
            // 프로필 방식: 크롭퍼 준비 완료 후 스마트 스크롤 설정
            setTimeout(() => {
                setupSmartScroll();
            }, 100);
        },
        crop: updatePreview
    });
}

// 스마트 스크롤 설정 (프로필 방식 정확히 복사)
function setupSmartScroll() {
    if (!cropper || !elements.cropImage) return;
    
    const cropContainer = elements.cropImage.parentElement;
    if (!cropContainer) return;
    
    // 최대/최소 줌 레벨 설정 (프로필과 정확히 동일)
    const MIN_ZOOM = 0.1;  // 최소 줌 (10%)
    const MAX_ZOOM = 3.0;  // 최대 줌 (300%)
    
    console.log('🖱️ 스마트 스크롤 기능 활성화');
    
    cropContainer.addEventListener('wheel', function(event) {
        if (!cropper) return;
        
        // 현재 줌 레벨 확인 (프로필과 정확히 동일한 방식)
        const canvasData = cropper.getCanvasData();
        const containerData = cropper.getContainerData();
        const currentZoom = canvasData.naturalWidth > 0 ? canvasData.width / canvasData.naturalWidth : 1;
        
        const isZoomingIn = event.deltaY < 0;  // 휠을 위로 올리면 확대
        const isZoomingOut = event.deltaY > 0; // 휠을 아래로 내리면 축소
        
        console.log('🔍 현재 줌:', currentZoom.toFixed(2), '방향:', isZoomingIn ? '확대' : '축소');
        
        // 프로필과 정확히 동일한 임계값 설정
        const maxThreshold = 2.8;  // 조금 더 낮은 최대값
        const minThreshold = 0.2;  // 조금 더 높은 최소값
        
        // 확대 시: 최대 줌 근처에서 페이지 스크롤 허용
        if (isZoomingIn && currentZoom >= maxThreshold) {
            updateZoomIndicator(currentZoom, '최대 확대');
            console.log('📈 최대 확대 근처 - 페이지 스크롤 실행');
            
            // 페이지 스크롤을 더 부드럽게 실행 (프로필과 정확히 동일)
            const scrollAmount = event.deltaY * 0.5; // 스크롤 강도 조절
            window.scrollBy({
                top: scrollAmount,
                behavior: 'smooth'
            });
            return;
        }
        
        // 축소 시: 최소 줌 근처에서 페이지 스크롤 허용  
        if (isZoomingOut && currentZoom <= minThreshold) {
            updateZoomIndicator(currentZoom, '최소 축소');
            console.log('📉 최소 축소 근처 - 페이지 스크롤 실행');
            
            // 페이지 스크롤을 더 부드럽게 실행 (프로필과 정확히 동일)
            const scrollAmount = event.deltaY * 0.5; // 스크롤 강도 조절
            window.scrollBy({
                top: scrollAmount,
                behavior: 'smooth'
            });
            return;
        }
        
        // 이미지 확대/축소 범위 내에서는 기본 스크롤 차단하고 줌 적용
        event.preventDefault();
        event.stopPropagation();
        
        const zoomDelta = isZoomingIn ? 0.1 : -0.1;
        cropper.zoom(zoomDelta);
        
        // 줌 표시기 업데이트
        const newZoom = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, currentZoom + zoomDelta));
        updateZoomIndicator(newZoom, isZoomingIn ? '확대' : '축소');
        
    }, { passive: false }); // passive: false로 설정해야 preventDefault 작동
}

// 줌 표시기 업데이트 (프로필 방식 완전 적용)
function updateZoomIndicator(zoomLevel, status) {
    if (!elements.zoomIndicator || !elements.zoomLevel || !elements.zoomStatus) return;
    
    // 줌 레벨을 퍼센트로 표시 (프로필과 동일)
    const zoomPercent = Math.round(zoomLevel * 100);
    elements.zoomLevel.textContent = zoomPercent + '%';
    
    // 상태 메시지 업데이트 (프로필과 동일)
    let statusMessage = '';
    let statusClass = '';
    
    if (status === '최대 확대') {
        statusMessage = '(최대 - 페이지 스크롤 가능)';
        statusClass = 'text-warning';
    } else if (status === '최소 축소') {
        statusMessage = '(최소 - 페이지 스크롤 가능)';
        statusClass = 'text-info';
    } else {
        statusMessage = `(${status} 중)`;
        statusClass = 'text-success';
    }
    
    elements.zoomStatus.textContent = statusMessage;
    elements.zoomStatus.className = `ms-2 ${statusClass}`;
    
    // 줌 표시기 보이기 (프로필과 동일)
    elements.zoomIndicator.style.display = 'block';
    
    // 3초 후 자동 숨김 (프로필과 동일)
    clearTimeout(window.zoomIndicatorTimeout);
    window.zoomIndicatorTimeout = setTimeout(() => {
        if (elements.zoomIndicator) {
            elements.zoomIndicator.style.display = 'none';
        }
    }, 3000);
}

// 현재 이미지를 크롭퍼에 로드
function loadCurrentImageToCropper() {
    if (originalImages.length === 0) return;
    
    const currentImage = originalImages[currentImageIndex];
    if (!currentImage) return;
    
    console.log(`🖼️ 크롭퍼에 이미지 로드: ${currentImage.name} (${currentImageIndex + 1}/${originalImages.length})`);
    
    // 현재 이미지 번호 업데이트
    if (elements.currentImageNumber) {
        elements.currentImageNumber.textContent = `${currentImageIndex + 1}/${originalImages.length}`;
    }
    if (elements.imageDimensions) {
        elements.imageDimensions.textContent = '계산 중...';
    }
    if (elements.imageFileName) {
        elements.imageFileName.textContent = currentImage.name;
    }
    
    // 네비게이션 버튼 표시/숨김
    if (elements.buttons.prevImage) {
        elements.buttons.prevImage.style.display = currentImageIndex > 0 ? 'inline-block' : 'none';
    }
    if (elements.buttons.nextImage) {
        elements.buttons.nextImage.style.display = currentImageIndex < originalImages.length - 1 ? 'inline-block' : 'none';
    }
    
    elements.cropImage.src = currentImage.dataUrl;
    elements.cropImage.style.display = 'block';
    
    elements.cropImage.onload = function() {
        console.log('이미지 로드 완료, 크롭퍼 초기화 시작');
        setTimeout(() => {
            initializeCropper();
            updateImageDimensions();
        }, 100);
    };
}

// 미리보기 업데이트 (16:9 비율)
function updatePreview() {
    if (!cropper || !elements.previewCanvas) return;
    
    console.log('🖼️ 미리보기 업데이트 시작');
    
    // 크롭된 이미지를 캔버스에 그리기 (16:9 비율)
    const canvas = cropper.getCroppedCanvas({
        width: 192,
        height: 108,
        imageSmoothingEnabled: true,
        imageSmoothingQuality: 'high'
    });
    
    if (canvas) {
        const ctx = elements.previewCanvas.getContext('2d');
        ctx.clearRect(0, 0, elements.previewCanvas.width, elements.previewCanvas.height);
        ctx.drawImage(canvas, 0, 0, elements.previewCanvas.width, elements.previewCanvas.height);
        console.log('✅ 미리보기 업데이트 완료');
    }
}

// 이미지 크기 정보 업데이트
function updateImageDimensions() {
    if (!cropper || !elements.imageDimensions) return;
    
    const imageData = cropper.getImageData();
    elements.imageDimensions.textContent = `${Math.round(imageData.naturalWidth)} × ${Math.round(imageData.naturalHeight)}`;
}

// 단계 이동 함수들
function goToUploadStep() {
    hideAllSections();
    if (elements.uploadSection) elements.uploadSection.style.display = 'block';
    updateStepIndicator(1);
    
    // 초기화
    if (elements.imageInput) elements.imageInput.value = '';
    if (cropper) {
        cropper.destroy();
        cropper = null;
    }
    if (smartScrollInstance) {
        smartScrollInstance.destroy();
        smartScrollInstance = null;
    }
    originalImages = [];
    croppedImages = [];
    currentImageIndex = 0;
}

function goToCropStep() {
    hideAllSections();
    if (elements.cropSection) elements.cropSection.style.display = 'block';
    updateStepIndicator(2);
}

// 모든 섹션 숨기기 (압축 섹션 포함)
function hideAllSections() {
    const sections = ['uploadSection', 'cropSection', 'compressionSection', 'completeSection'];
    sections.forEach(sectionId => {
        const section = elements[sectionId];
        if (section) {
            section.style.display = 'none';
            console.log(`🙈 ${sectionId} 섹션 숨김`);
        }
    });
    
    // 이미지 리스트 섹션도 숨김
    if (elements.imageListSection) {
        elements.imageListSection.style.display = 'none';
    }
}

// 단계 표시기 업데이트
function updateStepIndicator(currentStep) {
    if (!elements.steps) return;
    
    // 모든 단계 초기화
    Object.values(elements.steps).forEach(step => {
        if (step) {
            step.classList.remove('active', 'completed');
        }
    });
    
    // 현재 단계까지 활성화
    for (let i = 1; i <= currentStep; i++) {
        const step = elements.steps[`step${i}`];
        if (step) {
            if (i === currentStep) {
                step.classList.add('active');
            } else {
                step.classList.add('completed');
            }
        }
    }
}

// 이미지 리스트 표시
function showImageList() {
    if (!elements.imageListSection || !elements.imageList) return;
    
    if (elements.imageCount) {
        elements.imageCount.textContent = originalImages.length;
    }
    elements.imageList.innerHTML = '';
    
    originalImages.forEach((image, index) => {
        const imageItem = document.createElement('div');
        imageItem.className = 'col-md-4 col-lg-3';
        imageItem.innerHTML = `
            <div class="card image-item" data-index="${index}">
                <div class="card-img-top position-relative">
                    <img src="${image.dataUrl}" class="img-fluid" style="height: 120px; object-fit: cover;">
                    <div class="position-absolute top-0 end-0 p-1">
                        <span class="badge bg-primary">${index + 1}</span>
                    </div>
                </div>
                <div class="card-body p-2">
                    <h6 class="card-title text-truncate small mb-1">${image.name}</h6>
                    <small class="text-muted">${formatFileSize(image.size)}</small>
                </div>
            </div>
        `;
        
        elements.imageList.appendChild(imageItem);
    });
    
    if (elements.imageListSection) {
        elements.imageListSection.style.display = 'block';
    }
}

// 파일 크기 포맷팅
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// 크롭퍼 줌
function zoomCropper(ratio) {
    if (!cropper) return;
    cropper.zoom(ratio);
}

// 크롭퍼 회전
function rotateCropper(degree) {
    if (!cropper) return;
    cropper.rotate(degree);
}

// 크롭퍼 리셋
function resetCropper() {
    if (!cropper) return;
    cropper.reset();
}

// 이전 이미지로 이동
function goToPreviousImage() {
    if (currentImageIndex > 0) {
        currentImageIndex--;
        loadCurrentImageToCropper();
    }
}

// 다음 이미지로 이동
function goToNextImage() {
    if (currentImageIndex < originalImages.length - 1) {
        currentImageIndex++;
        loadCurrentImageToCropper();
    }
}

// 현재 이미지 크롭 (프로필 방식 + 다음 단계 이동 추가)
function cropCurrentImage() {
    if (!cropper) {
        alert('크롭퍼가 초기화되지 않았습니다.');
        return;
    }
    
    console.log(`🔄 이미지 크롭 중: ${currentImageIndex + 1}/${originalImages.length}`);
    
    // 버튼 로딩 상태 설정 (프로필 방식)
    const cropBtn = elements.buttons.cropCurrent;
    setButtonLoading(cropBtn, true, '크롭 중...');
    
    try {
        // 크롭된 이미지 생성 (16:9 비율)
        const canvas = cropper.getCroppedCanvas({
            width: 800,
            height: 450, // 16:9 비율
            imageSmoothingEnabled: true,
            imageSmoothingQuality: 'high'
        });
        
        if (canvas) {
            const croppedImageData = canvas.toDataURL('image/jpeg', 0.9);
            
            // 크롭된 이미지 저장
            croppedImages[currentImageIndex] = {
                ...originalImages[currentImageIndex],
                croppedDataUrl: croppedImageData,
                isCropped: true
            };
            
            console.log(`✅ 이미지 크롭 완료: ${currentImageIndex + 1}`);
            
            // 다음 이미지로 자동 이동 또는 압축 단계로
            if (currentImageIndex < originalImages.length - 1) {
                // 다음 이미지가 있으면 이동
                setTimeout(() => {
                    setButtonLoading(cropBtn, false);
                    goToNextImage();
                }, 500);
            } else {
                // 모든 이미지 크롭 완료 시 압축 단계로 이동
                console.log('🎉 모든 이미지 크롭 완료 - 압축 단계로 이동');
                setTimeout(() => {
                    setButtonLoading(cropBtn, false);
                    goToCompressionStep();
                }, 500);
            }
        } else {
            throw new Error('캔버스 생성 실패');
        }
        
    } catch (error) {
        console.error('크롭 처리 오류:', error);
        setButtonLoading(cropBtn, false);
        alert('이미지 처리 중 오류가 발생했습니다.');
    }
}

// 압축 단계로 이동 (새로 추가)
function goToCompressionStep() {
    hideAllSections();
    if (elements.compressionSection) {
        elements.compressionSection.style.display = 'block';
        console.log('📦 압축 단계 표시 완료');
    }
    updateStepIndicator(3);
    
    // 크롭된 이미지들을 압축 미리보기에 표시
    updateCompressionPreview();
}

// 압축 미리보기 업데이트 (실시간 반영)
function updateCompressionPreview() {
    const finalPreviewImage = document.getElementById('finalPreviewImage');
    const compressionSavings = document.getElementById('compressionSavings');
    const currentFormat = document.getElementById('currentFormat');
    
    if (!finalPreviewImage || croppedImages.length === 0) return;
    
    // 첫 번째 크롭된 이미지를 미리보기로 표시
    const firstCroppedImage = croppedImages.find(img => img && img.croppedDataUrl);
    if (!firstCroppedImage) return;
    
    // 현재 설정 가져오기
    const qualitySlider = document.getElementById('qualitySlider');
    const quality = qualitySlider ? parseFloat(qualitySlider.value) : 0.8;
    
    const formatRadios = document.querySelectorAll('input[name="imageFormat"]:checked');
    const format = formatRadios.length > 0 ? formatRadios[0].value : 'jpeg';
    
    // 선택된 형식에 따라 이미지 재압축
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();
    
    img.onload = function() {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        
        // 형식별 압축 적용
        let mimeType = 'image/jpeg';
        let compressionRatio = 0.7; // 기본 압축률
        
        switch(format) {
            case 'avif':
                mimeType = 'image/avif';
                compressionRatio = 0.9; // AVIF는 높은 압축률
                break;
            case 'webp':
                mimeType = 'image/webp';
                compressionRatio = 0.8; // WebP는 중간 압축률
                break;
            case 'jpeg':
            default:
                mimeType = 'image/jpeg';
                compressionRatio = 0.7; // JPEG는 낮은 압축률
                break;
        }
        
        // 압축된 이미지 생성
        const compressedDataUrl = canvas.toDataURL(mimeType, quality);
        finalPreviewImage.src = compressedDataUrl;
        
        // 압축 정보 업데이트
        if (compressionSavings) {
            const savingsPercent = Math.round(compressionRatio * 100);
            compressionSavings.textContent = `평균 ${savingsPercent}% 용량 절약`;
            compressionSavings.className = 'compression-savings text-success fw-bold mb-2';
        }
        
        if (currentFormat) {
            currentFormat.textContent = format.toUpperCase();
            currentFormat.className = 'fw-bold';
        }
        
        console.log(`🔧 압축 미리보기 업데이트: ${format.toUpperCase()}, 품질: ${Math.round(quality * 100)}%`);
    };
    
    img.src = firstCroppedImage.croppedDataUrl;
}

// 버튼 로딩 상태 설정 (프로필 방식과 동일)
function setButtonLoading(button, isLoading, loadingText = '처리 중...') {
    if (!button) return;
    
    if (isLoading) {
        button.disabled = true;
        button.classList.add('loading');
        button.setAttribute('data-original-text', button.innerHTML);
        button.innerHTML = `<i class="fas fa-spinner fa-spin me-1"></i>${loadingText}`;
    } else {
        button.disabled = false;
        button.classList.remove('loading');
        const originalText = button.getAttribute('data-original-text');
        if (originalText) {
            button.innerHTML = originalText;
        }
    }
}

// 키보드 단축키 설정
function setupKeyboardShortcuts() {
    document.addEventListener('keydown', function(event) {
        // 입력 필드에서는 단축키 비활성화
        if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
            return;
        }
        
        switch (event.key) {
            case '+':
            case '=':
                event.preventDefault();
                zoomCropper(0.1);
                break;
                
            case '-':
                event.preventDefault();
                zoomCropper(-0.1);
                break;
                
            case 'r':
            case 'R':
                event.preventDefault();
                rotateCropper(90);
                break;
                
            case 'l':
            case 'L':
                event.preventDefault();
                rotateCropper(-90);
                break;
                
            case 'Enter':
                event.preventDefault();
                if (elements.buttons.cropCurrent && !elements.buttons.cropCurrent.disabled) {
                    cropCurrentImage();
                }
                break;
                
            case 'Escape':
                event.preventDefault();
                resetCropper();
                break;
                
            case 'ArrowLeft':
                event.preventDefault();
                if (elements.buttons.prevImage && elements.buttons.prevImage.style.display !== 'none') {
                    goToPreviousImage();
                }
                break;
                
            case 'ArrowRight':
                event.preventDefault();
                if (elements.buttons.nextImage && elements.buttons.nextImage.style.display !== 'none') {
                    goToNextImage();
                }
                break;
        }
    });
    
    console.log('⌨️ 키보드 단축키 설정 완료');
}

// 페이지 언로드 시 정리
window.addEventListener('beforeunload', function() {
    if (cropper) {
        cropper.destroy();
    }
    if (smartScrollInstance) {
        smartScrollInstance.destroy();
    }
});
````

## File: backup/facility-image-implementation/facility-image-implementation/facility-detail-map.js
````javascript
/**
 * 시설 상세보기 페이지 지도 기능 전용 JavaScript
 * - 카카오맵 API를 사용한 시설 위치 표시
 * - 인포윈도우 및 길찾기 기능
 * - 지도 컨트롤 및 에러 처리
 */

// 전역 변수
let detailMap = null;
let detailMarker = null;
let detailInfoWindow = null;
let facilityMapData = {};

/**
 * 시설 지도 데이터 초기화
 * @param {Object} data - Thymeleaf에서 전달받은 시설 데이터
 */
function initializeFacilityMapData(data) {
    facilityMapData = data;
    console.log('🗺️ 시설 지도 데이터 초기화:', facilityMapData);
}

/**
 * 시설 상세보기 지도 초기화
 */
function initializeFacilityDetailMap() {
    console.log('🗺️ 시설 상세보기 지도 초기화 시작');
    
    const mapContainer = document.getElementById('facilityMap');
    if (!mapContainer) {
        console.error('❌ 지도 컨테이너를 찾을 수 없습니다.');
        return;
    }
    
    let mapCenter = new kakao.maps.LatLng(37.566826, 126.9786567); // 기본값: 서울 시청
    
    // 시설 위치가 있다면 해당 위치를 중심으로 설정
    if (facilityMapData.latitude && facilityMapData.longitude) {
        mapCenter = new kakao.maps.LatLng(facilityMapData.latitude, facilityMapData.longitude);
        console.log('📍 시설 위치:', facilityMapData.latitude, facilityMapData.longitude);
    } else {
        console.warn('⚠️ 시설 위치 정보가 없습니다.');
    }
    
    const mapOption = {
        center: mapCenter,
        level: 3 // 상세 페이지이므로 더 확대해서 보여줌
    };
    
    try {
        detailMap = new kakao.maps.Map(mapContainer, mapOption);
        console.log('✅ 지도 인스턴스 생성 완료');
        
        // 시설 위치에 마커 추가
        if (facilityMapData.latitude && facilityMapData.longitude) {
            addFacilityMarker();
            addMapControls();
            console.log('✅ 시설 상세보기 지도 초기화 완료');
        } else {
            showNoLocationMessage(mapContainer);
        }
    } catch (error) {
        console.error('❌ 지도 초기화 중 오류:', error);
        showMapErrorMessage(mapContainer);
    }
}

/**
 * 시설 마커 추가
 */
function addFacilityMarker() {
    const position = new kakao.maps.LatLng(facilityMapData.latitude, facilityMapData.longitude);
    
    // 마커 생성
    detailMarker = new kakao.maps.Marker({
        position: position,
        map: detailMap
    });
    
    // 인포윈도우 생성 (개선된 디자인)
    const infoWindowContent = createInfoWindowContent();
    
    detailInfoWindow = new kakao.maps.InfoWindow({
        content: infoWindowContent,
        removable: true
    });
    
    // 마커 클릭 이벤트
    kakao.maps.event.addListener(detailMarker, 'click', function() {
        detailInfoWindow.open(detailMap, detailMarker);
    });
    
    // 초기에 인포윈도우 열기 (1초 후)
    setTimeout(() => {
        detailInfoWindow.open(detailMap, detailMarker);
    }, 1000);
    
    console.log('📍 시설 마커 및 인포윈도우 생성 완료');
}

/**
 * 인포윈도우 컨텐츠 생성
 * @returns {string} HTML 컨텐츠
 */
function createInfoWindowContent() {
    return `
        <div class="info-window p-3" style="width:320px; border-radius: 8px; font-family: 'Noto Sans KR', sans-serif;">
            <h6 class="mb-2 text-primary fw-bold">
                <i class="fas fa-building me-1"></i>${facilityMapData.name || '시설명'}
            </h6>
            <p class="mb-2 small text-dark">
                <i class="fas fa-map-marker-alt text-danger me-1"></i>
                ${facilityMapData.address || '주소 정보 없음'}
            </p>
            <div class="d-flex justify-content-between align-items-center">
                <p class="mb-0 small">
                    <i class="fas fa-phone text-success me-1"></i>
                    <a href="tel:${facilityMapData.phone || ''}" class="text-decoration-none text-success fw-medium">
                        ${facilityMapData.phone || '전화번호 없음'}
                    </a>
                </p>
                <button class="btn btn-sm btn-outline-primary" onclick="openKakaoMapRoute()">
                    <i class="fas fa-route me-1"></i>길찾기
                </button>
            </div>
            <div class="mt-2 text-center">
                <small class="text-muted">
                    <i class="fas fa-info-circle me-1"></i>
                    정확한 위치를 확인하세요
                </small>
            </div>
        </div>
    `;
}

/**
 * 지도 컨트롤 추가
 */
function addMapControls() {
    // 지도 타입 컨트롤 추가
    const mapTypeControl = new kakao.maps.MapTypeControl();
    detailMap.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);
    
    // 줌 컨트롤 추가
    const zoomControl = new kakao.maps.ZoomControl();
    detailMap.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
    
    console.log('🎛️ 지도 컨트롤 추가 완료');
}

/**
 * 카카오맵 길찾기 열기
 */
function openKakaoMapRoute() {
    if (facilityMapData.latitude && facilityMapData.longitude && facilityMapData.name) {
        const url = `https://map.kakao.com/link/to/${encodeURIComponent(facilityMapData.name)},${facilityMapData.latitude},${facilityMapData.longitude}`;
        window.open(url, '_blank');
        console.log('🛣️ 카카오맵 길찾기 열기:', url);
    } else {
        alert('길찾기 정보가 부족합니다.');
    }
}

/**
 * 위치 정보 없음 메시지 표시
 * @param {HTMLElement} container - 지도 컨테이너
 */
function showNoLocationMessage(container) {
    container.innerHTML = `
        <div class="d-flex align-items-center justify-content-center h-100 text-muted bg-light rounded" style="height: 400px;">
            <div class="text-center">
                <i class="fas fa-exclamation-triangle fa-3x mb-3 text-warning"></i>
                <h5 class="mb-2">위치 정보 없음</h5>
                <p class="mb-0">이 시설의 위치 정보가 등록되지 않았습니다.</p>
                <small class="text-muted mt-2 d-block">시설 관리자에게 문의하시기 바랍니다.</small>
            </div>
        </div>
    `;
    console.log('⚠️ 위치 정보 없음 메시지 표시');
}

/**
 * 지도 로드 실패 메시지 표시
 * @param {HTMLElement} container - 지도 컨테이너
 */
function showMapErrorMessage(container) {
    container.innerHTML = `
        <div class="d-flex align-items-center justify-content-center h-100 text-muted bg-light rounded" style="height: 400px;">
            <div class="text-center">
                <i class="fas fa-exclamation-triangle fa-3x mb-3 text-danger"></i>
                <h5 class="mb-2">지도 로드 실패</h5>
                <p class="mb-0">지도를 불러올 수 없습니다.</p>
                <button class="btn btn-outline-primary btn-sm mt-2" onclick="location.reload()">
                    <i class="fas fa-refresh me-1"></i>새로고침
                </button>
            </div>
        </div>
    `;
    console.log('❌ 지도 로드 실패 메시지 표시');
}

/**
 * 지도 크기 조정 (창 크기 변경 시)
 */
function resizeFacilityMap() {
    if (detailMap) {
        detailMap.relayout();
        console.log('📐 지도 크기 조정 완료');
    }
}

// 창 크기 변경 시 지도 크기 조정
window.addEventListener('resize', resizeFacilityMap);
````

## File: backup/facility-image-implementation/facility-image-implementation/facility-detail.js
````javascript
/**
 * 시설 상세보기 페이지 전용 JavaScript
 * - 이미지 확대 모달 기능
 * - 5초 자동 슬라이드
 * - 화살표 네비게이션
 * - 키보드 단축키
 */

// 전역 변수
let facilityData = {};
let facilityImages = [];
let currentModalIndex = 0;
let modalCarousel;
let autoSlideInterval;
let isAutoSliding = false;

/**
 * 시설 데이터 초기화
 * @param {Object} data - Thymeleaf에서 전달받은 시설 데이터
 */
function initializeFacilityData(data) {
    facilityData = data;
    console.log('🏢 시설 데이터 초기화:', facilityData);
}

/**
 * 시설 이미지 데이터 초기화
 * @param {Array} images - Thymeleaf에서 전달받은 이미지 데이터
 */
function initializeFacilityImages(images) {
    facilityImages = images || [];
    console.log('📸 시설 이미지 데이터 초기화 - 이미지 수:', facilityImages.length);
    console.log('📸 이미지 목록:', facilityImages);
}

/**
 * DOM 로드 완료 후 초기화
 */
document.addEventListener('DOMContentLoaded', function() {
    console.log('🖼️ 시설 상세보기 DOM 로드 완료');
    
    // 시설 등급 색상 적용
    applyGradeColors();
    
    // 모달 요소 확인
    const modal = document.getElementById('imageModal');
    if (!modal) {
        console.error('❌ 이미지 모달 요소를 찾을 수 없습니다');
    } else {
        console.log('✅ 이미지 모달 요소 확인됨');
    }
});

/**
 * 시설 등급 색상 적용
 */
function applyGradeColors() {
    $('.grade-badge').each(function() {
        const grade = parseInt($(this).data('grade'));
        switch(grade) {
            case 1: $(this).addClass('bg-success'); break;
            case 2: $(this).addClass('bg-info'); break;
            case 3: $(this).addClass('bg-warning'); break;
            case 4: $(this).addClass('bg-secondary'); break;
            case 5: $(this).addClass('bg-danger'); break;
            default: $(this).addClass('bg-secondary');
        }
    });
    
    $('.grade-rating').each(function() {
        const grade = parseInt($(this).data('grade'));
        switch(grade) {
            case 1: $(this).addClass('text-success'); break;
            case 2: $(this).addClass('text-info'); break;
            case 3: $(this).addClass('text-warning'); break;
            case 4: $(this).addClass('text-secondary'); break;
            case 5: $(this).addClass('text-danger'); break;
            default: $(this).addClass('text-muted');
        }
    });
}

/**
 * 이미지 모달 열기
 * @param {number} imageIndex - 표시할 이미지 인덱스
 */
function openImageModal(imageIndex = 0) {
    console.log('🖼️ 이미지 모달 열기 시도 - imageIndex:', imageIndex);
    console.log('📸 사용 가능한 이미지 수:', facilityImages.length);
    
    if (facilityImages.length === 0) {
        console.warn('⚠️ 표시할 이미지가 없습니다');
        alert('표시할 이미지가 없습니다.');
        return;
    }
    
    currentModalIndex = Math.max(0, Math.min(imageIndex, facilityImages.length - 1));
    console.log('📍 실제 모달 인덱스:', currentModalIndex);
    
    setupModalCarousel();
    
    const modalElement = document.getElementById('imageModal');
    const modal = new bootstrap.Modal(modalElement);
    
    // 기존 이벤트 리스너 제거 (중복 방지)
    modalElement.removeEventListener('shown.bs.modal', handleModalShown);
    modalElement.removeEventListener('hidden.bs.modal', handleModalHidden);
    
    // 새 이벤트 리스너 추가
    modalElement.addEventListener('shown.bs.modal', handleModalShown);
    modalElement.addEventListener('hidden.bs.modal', handleModalHidden);
    
    modal.show();
    console.log('✅ 모달 표시 완료');
}

/**
 * 모달 표시 완료 이벤트 핸들러
 */
function handleModalShown() {
    console.log('🎯 모달이 완전히 열림 - 캐러셀 초기화');
    if (modalCarousel) {
        modalCarousel.to(currentModalIndex);
        updateModalImageInfo();
    }
    startAutoSlide();
}

/**
 * 모달 숨김 이벤트 핸들러
 */
function handleModalHidden() {
    console.log('🚪 모달이 닫힘 - 정리 작업');
    stopAutoSlide();
}

/**
 * 모달 캐러셀 설정
 */
function setupModalCarousel() {
    console.log('🔧 모달 캐러셀 설정 시작');
    
    const carouselInner = document.getElementById('modalCarouselInner');
    const indicators = document.getElementById('modalCarouselIndicators');
    
    if (!carouselInner || !indicators) {
        console.error('❌ 모달 캐러셀 요소를 찾을 수 없음');
        return;
    }
    
    // 기존 캐러셀 인스턴스 해제
    if (modalCarousel) {
        modalCarousel.dispose();
        modalCarousel = null;
    }
    
    // 기존 내용 정리
    carouselInner.innerHTML = '';
    indicators.innerHTML = '';
    
    console.log('📸 모달에 표시할 이미지 수:', facilityImages.length);
    
    // 이미지 아이템 생성
    facilityImages.forEach((image, index) => {
        console.log(`🖼️ 이미지 ${index + 1} 생성:`, image.path);
        
        // 캐러셀 아이템
        const carouselItem = document.createElement('div');
        carouselItem.className = `carousel-item ${index === currentModalIndex ? 'active' : ''}`;
        carouselItem.innerHTML = `
            <div class="d-flex justify-content-center align-items-center" style="height: 80vh;">
                <img src="${image.path}" 
                     class="img-fluid" 
                     style="max-height: 100%; max-width: 100%; object-fit: contain;" 
                     alt="${image.alt || '시설 이미지'}"
                     onerror="this.src='/images/default_facility.jpg'">
            </div>
        `;
        carouselInner.appendChild(carouselItem);
        
        // 인디케이터 버튼 (이미지가 2개 이상일 때만)
        if (facilityImages.length > 1) {
            const indicator = document.createElement('button');
            indicator.type = 'button';
            indicator.setAttribute('data-bs-target', '#modalCarousel');
            indicator.setAttribute('data-bs-slide-to', index);
            indicator.className = index === currentModalIndex ? 'active' : '';
            indicator.setAttribute('aria-label', `이미지 ${index + 1}`);
            indicators.appendChild(indicator);
        }
    });
    
    // 캐러셀 요소 표시/숨김 처리
    const prevBtn = document.querySelector('#modalCarousel .carousel-control-prev');
    const nextBtn = document.querySelector('#modalCarousel .carousel-control-next');
    
    if (facilityImages.length <= 1) {
        if (prevBtn) prevBtn.style.display = 'none';
        if (nextBtn) nextBtn.style.display = 'none';
        indicators.style.display = 'none';
    } else {
        if (prevBtn) prevBtn.style.display = 'block';
        if (nextBtn) nextBtn.style.display = 'block';
        indicators.style.display = 'block';
    }
    
    // 캐러셀 인스턴스 생성
    const carouselElement = document.getElementById('modalCarousel');
    modalCarousel = new bootstrap.Carousel(carouselElement, {
        interval: false, // 자동 슬라이드는 별도로 관리
        ride: false,
        wrap: true
    });
    
    // 기존 이벤트 리스너 제거
    carouselElement.removeEventListener('slide.bs.carousel', handleCarouselSlide);
    carouselElement.removeEventListener('slid.bs.carousel', handleCarouselSlid);
    
    // 슬라이드 이벤트 리스너 추가
    carouselElement.addEventListener('slide.bs.carousel', handleCarouselSlide);
    carouselElement.addEventListener('slid.bs.carousel', handleCarouselSlid);
    
    updateModalImageInfo();
    console.log('✅ 모달 캐러셀 설정 완료');
}

/**
 * 캐러셀 슬라이드 시작 이벤트
 */
function handleCarouselSlide(event) {
    console.log('🔄 캐러셀 슬라이드 시작:', event.from, '→', event.to);
    currentModalIndex = event.to;
}

/**
 * 캐러셀 슬라이드 완료 이벤트
 */
function handleCarouselSlid(event) {
    console.log('✅ 캐러셀 슬라이드 완료:', event.to);
    currentModalIndex = event.to;
    updateModalImageInfo();
}

/**
 * 모달 이미지 정보 업데이트
 */
function updateModalImageInfo() {
    const counter = document.getElementById('modalImageCounter');
    const altText = document.getElementById('modalImageAlt');
    
    if (facilityImages.length > 0 && currentModalIndex < facilityImages.length) {
        counter.textContent = `${currentModalIndex + 1} / ${facilityImages.length}`;
        altText.textContent = facilityImages[currentModalIndex].alt || '시설 이미지';
    }
}

/**
 * 자동 슬라이드 시작
 */
function startAutoSlide() {
    if (facilityImages.length <= 1) return;
    
    isAutoSliding = true;
    updateAutoSlideButton();
    
    autoSlideInterval = setInterval(() => {
        if (modalCarousel) {
            modalCarousel.next();
        }
    }, 5000);
    
    console.log('▶️ 자동 슬라이드 시작');
}

/**
 * 자동 슬라이드 정지
 */
function stopAutoSlide() {
    isAutoSliding = false;
    updateAutoSlideButton();
    
    if (autoSlideInterval) {
        clearInterval(autoSlideInterval);
        autoSlideInterval = null;
    }
    
    console.log('⏸️ 자동 슬라이드 정지');
}

/**
 * 자동 슬라이드 토글
 */
function toggleAutoSlide() {
    if (isAutoSliding) {
        stopAutoSlide();
    } else {
        startAutoSlide();
    }
}

/**
 * 자동 슬라이드 버튼 업데이트
 */
function updateAutoSlideButton() {
    const icon = document.getElementById('autoSlideIcon');
    const text = document.getElementById('autoSlideText');
    
    if (icon && text) {
        if (isAutoSliding) {
            icon.className = 'fas fa-pause';
            text.textContent = '일시정지';
        } else {
            icon.className = 'fas fa-play';
            text.textContent = '자동재생';
        }
    }
}

/**
 * 이미지 다운로드
 */
function downloadImage() {
    if (facilityImages.length === 0 || currentModalIndex >= facilityImages.length) return;
    
    const currentImage = facilityImages[currentModalIndex];
    const link = document.createElement('a');
    link.href = currentImage.path;
    link.download = `시설이미지_${currentModalIndex + 1}.jpg`;
    link.click();
    
    console.log('💾 이미지 다운로드:', currentImage.path);
}

/**
 * 전화하기 버튼 클릭 이벤트 핸들러
 */
function callFacilityPhone(button) {
    const phone = button.getAttribute('data-phone');
    if (phone) {
        window.location.href = `tel:${phone}`;
    }
}

/**
 * 리뷰 작성 페이지로 이동
 */
function writeReview() {
    if (facilityData.facilityId) {
        window.location.href = `/review/write?facilityId=${facilityData.facilityId}`;
    }
}

/**
 * 주변 구인정보 검색
 */
function searchNearbyJobs() {
    if (facilityData.latitude && facilityData.longitude) {
        window.location.href = `/job/list?lat=${facilityData.latitude}&lng=${facilityData.longitude}&radius=5`;
    }
}

/**
 * 카카오톡 공유하기
 */
function shareToKakao() {
    if (!facilityData) return;
    
    const facilityName = facilityData.name || '시설명';
    const address = facilityData.address || '주소';
    const logoImageUrl = facilityData.facilityImage || '/images/default_facility.jpg';

    if (window.Kakao) {
        Kakao.Link.sendDefault({
            objectType: 'location',
            address: address,
            addressTitle: facilityName,
            content: {
                title: facilityName,
                description: `${address}\n상세 정보 보기`,
                imageUrl: logoImageUrl,
                link: {
                    mobileWebUrl: window.location.href,
                    webUrl: window.location.href
                }
            },
            buttons: [
                {
                    title: '상세 정보 보기',
                    link: {
                        mobileWebUrl: window.location.href,
                        webUrl: window.location.href
                    }
                }
            ]
        });
    } else {
        alert('카카오톡 공유하기를 사용할 수 없습니다.');
    }
}

/**
 * 시설 삭제 함수
 */
function deleteFacility(facilityId) {
    if (confirm('정말로 이 시설을 삭제하시겠습니까?\n삭제된 시설은 복구할 수 없습니다.')) {
        // AJAX로 삭제 요청
        fetch('/facility/delete/' + facilityId, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => {
            if (response.ok) {
                alert('시설이 삭제되었습니다.');
                window.location.href = '/facility/search';
            } else {
                alert('시설 삭제 중 오류가 발생했습니다.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('시설 삭제 중 오류가 발생했습니다.');
        });
    }
}

// 키보드 단축키 (모달이 열려있을 때)
document.addEventListener('keydown', function(e) {
    const modal = document.getElementById('imageModal');
    if (!modal || !modal.classList.contains('show')) return;
    
    switch(e.key) {
        case 'ArrowLeft':
            e.preventDefault();
            if (modalCarousel) modalCarousel.prev();
            break;
        case 'ArrowRight':
            e.preventDefault();
            if (modalCarousel) modalCarousel.next();
            break;
        case ' ': // 스페이스바
            e.preventDefault();
            toggleAutoSlide();
            break;
        case 'Escape':
            e.preventDefault();
            bootstrap.Modal.getInstance(modal)?.hide();
            break;
    }
});
````

## File: backup/facility-image-implementation/facility-image-implementation/facility-edit.js
````javascript
// facility-edit.js

// 시설 주소 검색 함수
function searchFacilityAddress() {
    new daum.Postcode({
        oncomplete: function(data) {
            let fullAddr = data.roadAddress || data.jibunAddress;
            
            // 주소 필드 업데이트
            document.getElementById('facilityAddress').value = fullAddr;
            
            // 지도에 위치 표시
            updateMapAndCoordinates(fullAddr);
        }
    }).open();
}

// 지도 업데이트 및 좌표 설정 함수
function updateMapAndCoordinates(address) {
    const geocoder = new kakao.maps.services.Geocoder();
    
    geocoder.addressSearch(address, function(result, status) {
        if (status === kakao.maps.services.Status.OK) {
            const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
            
            // 좌표를 히든 필드에 저장
            document.getElementById('latitude').value = result[0].y;
            document.getElementById('longitude').value = result[0].x;
            
            // 지도 컨테이너 표시
            const mapContainer = document.getElementById('mapPreviewContainer');
            mapContainer.style.display = 'block';
            
            // 지도 초기화
            const mapOption = {
                center: coords,
                level: 3
            };
            
            const map = new kakao.maps.Map(document.getElementById('previewMap'), mapOption);
            
            // 마커 추가
            const marker = new kakao.maps.Marker({
                position: coords
            });
            marker.setMap(map);
            
            // 인포윈도우 추가
            const infowindow = new kakao.maps.InfoWindow({
                content: '<div style="width:150px;text-align:center;padding:6px 0;">선택된 위치</div>'
            });
            infowindow.open(map, marker);
        }
    });
}

// 운영시간 라디오 버튼 처리
function handleOperatingHours() {
    const radio24 = document.getElementById('operating24');
    const radioCustom = document.getElementById('operatingCustom');
    const customInput = document.getElementById('customOperatingHours');
    const hiddenInput = document.getElementById('operatingHours');
    
    function updateOperatingHours() {
        if (radio24.checked) {
            customInput.style.display = 'none';
            hiddenInput.value = '24시간';
        } else if (radioCustom.checked) {
            customInput.style.display = 'block';
            hiddenInput.value = customInput.value || '';
        }
    }
    
    radio24.addEventListener('change', updateOperatingHours);
    radioCustom.addEventListener('change', updateOperatingHours);
    customInput.addEventListener('input', function() {
        if (radioCustom.checked) {
            hiddenInput.value = this.value;
        }
    });
    
    // 초기 상태 설정
    updateOperatingHours();
}

// 전화번호 포맷팅
function formatPhoneNumber(input) {
    let value = input.value.replace(/\D/g, '');
    let formattedValue = '';
    
    if (value.startsWith('02')) {
        // 서울 지역번호
        if (value.length <= 2) {
            formattedValue = value;
        } else if (value.length <= 6) {
            formattedValue = value.slice(0, 2) + '-' + value.slice(2);
        } else if (value.length <= 10) {
            formattedValue = value.slice(0, 2) + '-' + value.slice(2, 6) + '-' + value.slice(6);
        } else {
            formattedValue = value.slice(0, 2) + '-' + value.slice(2, 6) + '-' + value.slice(6, 10);
        }
    } else if (value.startsWith('01')) {
        // 휴대폰 번호
        if (value.length <= 3) {
            formattedValue = value;
        } else if (value.length <= 7) {
            formattedValue = value.slice(0, 3) + '-' + value.slice(3);
        } else if (value.length <= 11) {
            formattedValue = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7);
        } else {
            formattedValue = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
        }
    } else if (value.length >= 3) {
        // 기타 지역번호
        if (value.length <= 3) {
            formattedValue = value;
        } else if (value.length <= 7) {
            formattedValue = value.slice(0, 3) + '-' + value.slice(3);
        } else if (value.length <= 11) {
            formattedValue = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7);
        } else {
            formattedValue = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
        }
    } else {
        formattedValue = value;
    }
    
    input.value = formattedValue;
}

// 폼 유효성 검사
function validateForm() {
    const requiredFields = [
        { id: 'facilityName', name: '시설명' },
        { id: 'facilityType', name: '시설 유형' },
        { id: 'facilityAddress', name: '주소' },
        { id: 'phone', name: '전화번호' }
    ];
    
    for (let field of requiredFields) {
        const element = document.getElementById(field.id);
        if (!element.value.trim()) {
            alert(`${field.name}을(를) 입력해주세요.`);
            element.focus();
            return false;
        }
    }
    
    // 전화번호 패턴 검사
    const phonePattern = /^(02-\d{3,4}-\d{4}|0(3[1-3]|4[1-3]|5[1-5]|6[1-4]|70)-\d{3,4}-\d{4}|01[016-9]-\d{3,4}-\d{4})$/;
    const phone = document.getElementById('phone').value;
    if (!phonePattern.test(phone)) {
        alert('올바른 전화번호 형식이 아닙니다.');
        document.getElementById('phone').focus();
        return false;
    }
    
    return true;
}

// 페이지 로드 완료 후 실행
document.addEventListener('DOMContentLoaded', function() {
    // 운영시간 처리 초기화
    handleOperatingHours();
    
    // 전화번호 입력 포맷팅
    const phoneInput = document.getElementById('phone');
    if (phoneInput) {
        phoneInput.addEventListener('input', function() {
            formatPhoneNumber(this);
        });
    }
    
    // 기존 주소가 있는 경우 지도 표시
    const existingAddress = document.getElementById('facilityAddress').value;
    if (existingAddress) {
        updateMapAndCoordinates(existingAddress);
    }
    
    // 폼 제출 시 유효성 검사
    const form = document.getElementById('facilityEditForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            if (!validateForm()) {
                e.preventDefault();
            }
        });
    }
});
````

## File: backup/facility-image-implementation/facility-image-implementation/FacilityController.java
````java
package com.example.carelink.controller;

import com.example.carelink.dto.FacilityDTO;
import com.example.carelink.dto.FacilityImageDTO;
import com.example.carelink.dto.ReviewDTO;
import com.example.carelink.service.FacilityService;
import com.example.carelink.service.ReviewService;
import com.example.carelink.service.FacilityImageService;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.context.annotation.Bean;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.common.Constants;
import javax.servlet.http.HttpSession;

import java.util.List;
import java.util.ArrayList; // ArrayList를 사용하기 위해 추가된 import 문
import java.util.Map;
import java.util.HashMap;

@Controller
@RequestMapping("/facility")
@RequiredArgsConstructor
@Slf4j
public class FacilityController {

    private final FacilityService facilityService;
    private final ReviewService reviewService;
    private final FacilityImageService facilityImageService;

    /**
     * Jackson ObjectMapper에 Java 8 날짜/시간 모듈을 등록합니다.
     * 이 메서드는 Spring 컨텍스트에 ObjectMapper 빈을 등록하여
     * LocalDateTime 직렬화 문제를 해결합니다.
     */
    @Bean
    public ObjectMapper objectMapper() {
        ObjectMapper mapper = new ObjectMapper();
        mapper.registerModule(new JavaTimeModule());
        return mapper;
    }

    /**
     * 시설 검색 페이지 및 검색 결과 조회
     */
    @GetMapping("/search")
    public String searchFacilities(
            @RequestParam(value = "facilityName", required = false) String facilityName,
            @RequestParam(value = "region", required = false) String region,
            @RequestParam(value = "facilityType", required = false) String facilityType,
            @RequestParam(value = "gradeRating", required = false) String gradeRating,
            Model model
    ) {
        log.info("시설 검색 페이지 접속 - facilityName: {}, region: {}, facilityType: {}, gradeRating: {}",
                facilityName, region, facilityType, gradeRating);

        // 빈 문자열을 null로 변환
        facilityName = (facilityName != null && facilityName.trim().isEmpty()) ? null : facilityName;
        region = (region != null && region.trim().isEmpty()) ? null : region;
        facilityType = (facilityType != null && facilityType.trim().isEmpty()) ? null : facilityType;

        FacilityDTO searchCondition = new FacilityDTO();
        searchCondition.setFacilityName(facilityName != null ? facilityName.trim() : null);
        searchCondition.setFacilityType(facilityType);
        searchCondition.setAddress(region); // 지역 검색용

        // gradeRating 기능은 현재 데이터베이스 스키마에 없으므로 비활성화
        // try {
        //     if (gradeRating != null && !gradeRating.isEmpty()) {
        //         searchCondition.setGradeRating(Integer.parseInt(gradeRating));
        //     }
        // } catch (NumberFormatException e) {
        //     log.warn("Invalid gradeRating format: {}", gradeRating);
        // }

        // DTO 객체를 서비스 메서드로 전달하여 검색을 수행합니다.
        List<FacilityDTO> facilityList = facilityService.searchFacilities(searchCondition);

        // 검색 결과가 null일 경우 빈 리스트로 초기화하여 Thymeleaf 오류를 방지합니다.
        if (facilityList == null) {
            facilityList = new ArrayList<>();
        }

        // 각 시설의 메인 이미지 조회
        for (FacilityDTO facility : facilityList) {
            try {
                FacilityImageDTO mainImage = facilityImageService.getMainImageByFacilityId(facility.getFacilityId());
                if (mainImage != null) {
                    facility.setFacilityImage(mainImage.getImagePath());
                    facility.setFacilityImageAltText(mainImage.getImageAltText());
                }
            } catch (Exception e) {
                log.warn("시설 메인 이미지 조회 실패 - facilityId: {}", facility.getFacilityId(), e);
            }
        }

        // 검색 결과를 모델에 추가합니다.
        model.addAttribute("facilityList", facilityList);
        model.addAttribute("facilityName", facilityName);
        model.addAttribute("region", region);
        model.addAttribute("facilityType", facilityType);
        model.addAttribute("gradeRating", gradeRating);

        log.info("검색된 시설 수: {}", facilityList.size());

        // 'search.html' 템플릿을 반환합니다.
        return "facility/search";
    }

    /**
     * 시설 상세 정보 페이지
     */
    @GetMapping("/detail/{facilityId}")
    public String getFacilityDetail(@PathVariable Long facilityId, Model model, HttpSession session) {
        log.info("시설 상세 정보 페이지 접속 - facilityId: {}", facilityId);
        
        try {
            // 시설 정보 조회
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                model.addAttribute("error", "해당 시설을 찾을 수 없습니다.");
                return "redirect:/facility/search";
            }
            
            // 해당 시설의 리뷰 목록 조회 (최근 5개)
            List<ReviewDTO> recentReviews = reviewService.getReviewsByFacilityId(facilityId);
            if (recentReviews.size() > 5) {
                recentReviews = recentReviews.subList(0, 5);
            }
            
            // 시설의 평균 평점 조회
            Double averageRating = reviewService.getAverageRating(facilityId);
            
            // 시설의 모든 이미지 조회
            List<FacilityImageDTO> facilityImages = facilityImageService.getImagesByFacilityId(facilityId);
            log.info("시설 이미지 목록 조회 완료 - facilityId: {}, 이미지 수: {}", facilityId, facilityImages.size());
            
            // 세션에서 사용자 정보 조회 (관리자 권한 체크용)
            MemberDTO sessionMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            boolean isAdmin = sessionMember != null && "ADMIN".equals(sessionMember.getRole());
            boolean isOwner = sessionMember != null && facility.getRegisteredMemberId() != null && 
                             facility.getRegisteredMemberId().equals(sessionMember.getMemberId());
            
            model.addAttribute("facility", facility);
            model.addAttribute("recentReviews", recentReviews);
            model.addAttribute("averageRating", averageRating);
            model.addAttribute("reviewCount", recentReviews.size());
            model.addAttribute("facilityImages", facilityImages);
            model.addAttribute("pageTitle", facility.getFacilityName() + " 상세정보");
            model.addAttribute("sessionMember", sessionMember);
            model.addAttribute("isAdmin", isAdmin);
            model.addAttribute("isOwner", isOwner);
            
            log.info("시설 상세 정보 조회 완료 - facilityId: {}, 리뷰 수: {}, 관리자: {}, 소유자: {}", 
                    facilityId, recentReviews.size(), isAdmin, isOwner);
            
            return "facility/detail";
        } catch (Exception e) {
            log.error("시설 상세 정보 조회 중 오류 발생 - facilityId: {}", facilityId, e);
            model.addAttribute("error", "시설 정보를 불러오는 중 오류가 발생했습니다.");
            return "redirect:/facility/search";
        }
    }

    /**
     * 시설 관리 페이지
     */
    @GetMapping("/manage")
    public String manageFacility(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        
        if (member == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        
        if (!Constants.MEMBER_ROLE_FACILITY.equals(member.getRole())) {
            redirectAttributes.addFlashAttribute("error", "시설 회원만 접근할 수 있습니다.");
            return "redirect:/";
        }
        
        try {
            // 회원의 모든 시설 정보 조회
            List<FacilityDTO> facilities = facilityService.getFacilitiesByMemberId(member.getMemberId());
            
            // 각 시설별 구인공고 수 조회 (TODO: 향후 JobService에서 조회)
            // for (FacilityDTO facility : facilities) {
            //     int jobCount = jobService.getJobCountByFacilityId(facility.getFacilityId());
            //     facility.setJobCount(jobCount);
            // }
            
            model.addAttribute("facilities", facilities);
            model.addAttribute("facilityCount", facilities.size());
            log.info("시설 관리 페이지 접근: memberId={}, 시설 수={}", 
                    member.getMemberId(), facilities.size());
            
            return "facility/manage";
        } catch (Exception e) {
            log.error("시설 관리 페이지 조회 중 오류 발생: memberId={}", member.getMemberId(), e);
            redirectAttributes.addFlashAttribute("error", "시설 정보를 불러오는 중 오류가 발생했습니다.");
            return "redirect:/";
        }
    }

    /**
     * 시설 수정 페이지
     */
    @GetMapping("/edit/{facilityId}")
    public String editFacilityForm(@PathVariable Long facilityId, HttpSession session, 
                                   Model model, RedirectAttributes redirectAttributes) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        
        if (member == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        
        try {
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            
            if (facility == null) {
                redirectAttributes.addFlashAttribute("error", "시설을 찾을 수 없습니다.");
                return "redirect:/facility/manage";
            }
            
            // 권한 확인 (시설 소유자 또는 관리자만 수정 가능)
            if (!facility.getRegisteredMemberId().equals(member.getMemberId()) 
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                redirectAttributes.addFlashAttribute("error", "해당 시설을 수정할 권한이 없습니다.");
                return "redirect:/facility/manage";
            }
            
            model.addAttribute("facility", facility);
            log.info("시설 수정 페이지 접근: facilityId={}, memberId={}", facilityId, member.getMemberId());
            
            return "facility/edit";
        } catch (Exception e) {
            log.error("시설 수정 페이지 조회 중 오류 발생: facilityId={}", facilityId, e);
            redirectAttributes.addFlashAttribute("error", "시설 정보를 불러오는 중 오류가 발생했습니다.");
            return "redirect:/facility/manage";
        }
    }

    /**
     * 시설 수정 처리
     */
    @PostMapping("/edit/{facilityId}")
    public String updateFacility(@PathVariable Long facilityId,
                                @ModelAttribute FacilityDTO facilityDTO,
                                @RequestParam(value = "facilityImageFile", required = false) MultipartFile facilityImageFile,
                                HttpSession session,
                                RedirectAttributes redirectAttributes) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        
        if (member == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        
        try {
            FacilityDTO existingFacility = facilityService.getFacilityById(facilityId);
            
            if (existingFacility == null) {
                redirectAttributes.addFlashAttribute("error", "시설을 찾을 수 없습니다.");
                return "redirect:/facility/manage";
            }
            
            // 권한 확인
            if (!existingFacility.getRegisteredMemberId().equals(member.getMemberId()) 
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                redirectAttributes.addFlashAttribute("error", "해당 시설을 수정할 권한이 없습니다.");
                return "redirect:/facility/manage";
            }
            
            // 기본 정보 유지
            facilityDTO.setFacilityId(facilityId);
            facilityDTO.setRegisteredMemberId(existingFacility.getRegisteredMemberId());
            facilityDTO.setIsApproved(existingFacility.getIsApproved());
            
            // approval_status가 null인 경우 기본값 설정
            String approvalStatus = existingFacility.getApprovalStatus();
            if (approvalStatus == null || approvalStatus.trim().isEmpty()) {
                // 기존 시설의 is_approved 상태를 기반으로 적절한 값 설정
                if (existingFacility.getIsApproved() != null && existingFacility.getIsApproved()) {
                    approvalStatus = "APPROVED";
                    log.info("🔧 approval_status NULL 방지 - 승인된 시설: APPROVED");
                } else {
                    approvalStatus = "PENDING";
                    log.info("🔧 approval_status NULL 방지 - 미승인 시설: PENDING");
                }
            }
            facilityDTO.setApprovalStatus(approvalStatus);
            
            facilityDTO.setAverageRating(existingFacility.getAverageRating());
            facilityDTO.setReviewCount(existingFacility.getReviewCount());
            facilityDTO.setCurrentOccupancy(existingFacility.getCurrentOccupancy());
            facilityDTO.setGradeRating(existingFacility.getGradeRating());
            
            // 시설 정보 수정 (이미지 파일 포함)
            facilityService.updateFacility(facilityDTO, facilityImageFile);
            
            log.info("시설 정보 수정 완료: facilityId={}, memberId={}", facilityId, member.getMemberId());
            redirectAttributes.addFlashAttribute("message", "시설 정보가 성공적으로 수정되었습니다.");
            
            return "redirect:/facility/manage";
        } catch (Exception e) {
            log.error("시설 정보 수정 중 오류 발생: facilityId={}", facilityId, e);
            redirectAttributes.addFlashAttribute("error", "시설 정보 수정 중 오류가 발생했습니다.");
            return "redirect:/facility/edit/" + facilityId;
        }
    }

    /**
     * 시설 삭제
     */
    @PostMapping("/delete/{facilityId}")
    public String deleteFacility(@PathVariable Long facilityId,
                                HttpSession session,
                                RedirectAttributes redirectAttributes) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        
        if (member == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        
        try {
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            
            if (facility == null) {
                redirectAttributes.addFlashAttribute("error", "시설을 찾을 수 없습니다.");
                return "redirect:/facility/manage";
            }
            
            // 권한 확인
            if (!facility.getRegisteredMemberId().equals(member.getMemberId()) 
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                redirectAttributes.addFlashAttribute("error", "해당 시설을 삭제할 권한이 없습니다.");
                return "redirect:/facility/manage";
            }
            
            // 시설 삭제
            facilityService.deleteFacility(facilityId);
            
            log.info("시설 삭제 완료: facilityId={}, memberId={}", facilityId, member.getMemberId());
            redirectAttributes.addFlashAttribute("message", "시설이 성공적으로 삭제되었습니다.");
            
            return "redirect:/facility/manage";
        } catch (Exception e) {
            log.error("시설 삭제 중 오류 발생: facilityId={}", facilityId, e);
            redirectAttributes.addFlashAttribute("error", "시설 삭제 중 오류가 발생했습니다.");
            return "redirect:/facility/manage";
        }
    }

    /**
     * 시설 API - AJAX용
     */
    @GetMapping("/api/{facilityId}")
    @ResponseBody
    public FacilityDTO getFacilityApi(@PathVariable Long facilityId, HttpSession session) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        
        if (member == null) {
            throw new RuntimeException("로그인이 필요합니다.");
        }
        
        FacilityDTO facility = facilityService.getFacilityById(facilityId);
        
        if (facility == null) {
            throw new RuntimeException("시설을 찾을 수 없습니다.");
        }
        
        // 권한 확인 (시설 소유자 또는 관리자만 조회 가능)
        if (!facility.getRegisteredMemberId().equals(member.getMemberId()) 
            && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
            throw new RuntimeException("해당 시설을 조회할 권한이 없습니다.");
        }
        
        return facility;
    }

    /**
     * 시설 이미지 크롭 페이지
     */
    @GetMapping("/crop-images/{facilityId}")
    public String cropImagePage(@PathVariable Long facilityId, 
                                HttpSession session, 
                                Model model, 
                                RedirectAttributes redirectAttributes) {
        try {
            MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            
            if (member == null) {
                redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
                return "redirect:/member/login";
            }
            
            // 시설 정보 조회
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                redirectAttributes.addFlashAttribute("error", "시설을 찾을 수 없습니다.");
                return "redirect:/facility/manage";
            }
            
            // 권한 확인 (시설 소유자 또는 관리자만 접근 가능)
            if (!facility.getRegisteredMemberId().equals(member.getMemberId()) 
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                redirectAttributes.addFlashAttribute("error", "해당 시설의 이미지를 관리할 권한이 없습니다.");
                return "redirect:/facility/manage";
            }
            
            model.addAttribute("facility", facility);
            log.info("시설 이미지 크롭 페이지 접속: facilityId={}, memberId={}", facilityId, member.getMemberId());
            
            return "facility/crop-images";
            
        } catch (Exception e) {
            log.error("시설 이미지 크롭 페이지 오류: facilityId={}", facilityId, e);
            redirectAttributes.addFlashAttribute("error", "페이지 로드 중 오류가 발생했습니다.");
            return "redirect:/facility/manage";
        }
    }

    /**
     * 시설 이미지 저장 처리 (다중 이미지 지원)
     */
    @PostMapping("/crop-images/save/{facilityId}")
    @ResponseBody
    public Map<String, Object> saveFacilityImage(@PathVariable Long facilityId,
                                                @RequestParam("facilityImage") MultipartFile facilityImageFile,
                                                @RequestParam(value = "altText", required = false) String altText,
                                                @RequestParam(value = "format", required = false) String format,
                                                @RequestParam(value = "imageIndex", required = false) String imageIndex,
                                                HttpSession session) {
        Map<String, Object> result = new HashMap<>();
        
        try {
            MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (member == null) {
                result.put("success", false);
                result.put("message", "로그인이 필요합니다.");
                return result;
            }
            
            // 시설 정보 조회 및 권한 확인
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                result.put("success", false);
                result.put("message", "시설을 찾을 수 없습니다.");
                return result;
            }
            
            if (!facility.getRegisteredMemberId().equals(member.getMemberId()) 
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                result.put("success", false);
                result.put("message", "해당 시설의 이미지를 관리할 권한이 없습니다.");
                return result;
            }
            
            log.info("🖼️ 시설 이미지 저장 요청 - facilityId: {}, 형식: {}, 인덱스: {}, 크기: {} bytes", 
                    facilityId, format, imageIndex, facilityImageFile.getSize());
            
            // 업로드된 파일이 유효한지 확인
            if (facilityImageFile.isEmpty()) {
                result.put("success", false);
                result.put("message", "업로드된 이미지 파일이 비어있습니다.");
                return result;
            }
            
            // Alt 텍스트 설정
            String finalAltText;
            if (altText != null && !altText.trim().isEmpty()) {
                finalAltText = altText.trim();
                log.info("🏷️ 시설 이미지 Alt 텍스트 설정: {}", finalAltText);
            } else {
                // 기본값 설정
                finalAltText = facility.getFacilityName() + " 시설 이미지";
                if (imageIndex != null && !imageIndex.isEmpty()) {
                    finalAltText += " " + (Integer.parseInt(imageIndex) + 1);
                }
                log.info("🏷️ 시설 이미지 Alt 텍스트 기본값 설정: {}", finalAltText);
            }
            
            // 이미지 형식 정보 로깅
            String contentType = facilityImageFile.getContentType();
            if (contentType != null) {
                log.info("📷 업로드된 이미지 형식: {}", contentType);
                if (contentType.contains("avif")) {
                    log.info("✨ AVIF 형식 감지 - 최적 압축 적용됨");
                } else if (contentType.contains("webp")) {
                    log.info("🚀 WebP 형식 감지 - 효율적 압축 적용됨");
                } else if (contentType.contains("jpeg")) {
                    log.info("📸 JPEG 형식 감지 - 호환성 우선 적용됨");
                }
            }
            
            // 다중 이미지 시스템으로 저장
            Integer orderIndex = imageIndex != null ? Integer.parseInt(imageIndex) : null;
            FacilityImageDTO savedImage = facilityImageService.saveSingleFacilityImage(
                facilityId, facilityImageFile, finalAltText, orderIndex);
            
            result.put("success", true);
            result.put("message", "시설 이미지가 성공적으로 저장되었습니다.");
            result.put("facilityId", facilityId);
            result.put("imageIndex", imageIndex);
            result.put("imageId", savedImage.getImageId());
            result.put("imagePath", savedImage.getImagePath());
            
            log.info("✅ 시설 이미지 저장 성공: facilityId={}, imageId={}", facilityId, savedImage.getImageId());
            
        } catch (Exception e) {
            log.error("❌ 시설 이미지 저장 중 오류 발생: facilityId={}", facilityId, e);
            result.put("success", false);
            result.put("message", "이미지 저장 중 오류가 발생했습니다: " + e.getMessage());
        }
        
        return result;
    }
    
    /**
     * 시설 이미지 목록 조회 API
     */
    @GetMapping("/api/{facilityId}/images")
    @ResponseBody
    public List<FacilityImageDTO> getFacilityImages(@PathVariable Long facilityId, HttpSession session) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        
        if (member == null) {
            throw new RuntimeException("로그인이 필요합니다.");
        }
        
        FacilityDTO facility = facilityService.getFacilityById(facilityId);
        if (facility == null) {
            throw new RuntimeException("시설을 찾을 수 없습니다.");
        }
        
        // 권한 확인 (시설 소유자, 관리자, 또는 모든 사용자에게 조회 허용)
        // 필요에 따라 권한 체크 로직 수정 가능
        
        return facilityImageService.getImagesByFacilityId(facilityId);
    }
}
````

## File: backup/facility-image-implementation/facility-image-implementation/FacilityImageService.java
````java
package com.example.carelink.service;

import com.example.carelink.dao.FacilityImageMapper;
import com.example.carelink.dao.FacilityMapper;
import com.example.carelink.dto.FacilityImageDTO;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.IOException;
import java.util.List;
import java.util.UUID;

@Service
public class FacilityImageService {

    private final FacilityImageMapper facilityImageMapper;
    private final FacilityMapper facilityMapper;
    private static final Logger log = LoggerFactory.getLogger(FacilityImageService.class);

    @Autowired
    public FacilityImageService(FacilityImageMapper facilityImageMapper, FacilityMapper facilityMapper) {
        this.facilityImageMapper = facilityImageMapper;
        this.facilityMapper = facilityMapper;
    }

    /**
     * 시설의 모든 이미지 조회
     */
    @Transactional(readOnly = true)
    public List<FacilityImageDTO> getImagesByFacilityId(Long facilityId) {
        log.info("시설 이미지 목록 조회 시작 - facilityId: {}", facilityId);
        List<FacilityImageDTO> images = facilityImageMapper.getImagesByFacilityId(facilityId);
        log.info("시설 이미지 목록 조회 완료 - facilityId: {}, 이미지 수: {}", facilityId, images.size());
        return images;
    }

    /**
     * 시설의 메인 이미지 조회
     */
    @Transactional(readOnly = true)
    public FacilityImageDTO getMainImageByFacilityId(Long facilityId) {
        log.info("시설 메인 이미지 조회 - facilityId: {}", facilityId);
        return facilityImageMapper.getMainImageByFacilityId(facilityId);
    }

    /**
     * 다중 시설 이미지 저장
     */
    @Transactional
    public void saveFacilityImages(Long facilityId, List<MultipartFile> imageFiles, List<String> altTexts) {
        try {
            log.info("📸 다중 시설 이미지 저장 시작 - facilityId: {}, 이미지 수: {}", facilityId, imageFiles.size());
            
            // 최대 5장 제한 검사
            if (imageFiles.size() > 5) {
                throw new RuntimeException("시설 이미지는 최대 5장까지만 등록할 수 있습니다. 요청된 이미지 수: " + imageFiles.size() + "장");
            }
            
            // 기존 이미지 개수 확인
            int existingImageCount = facilityImageMapper.countImagesByFacilityId(facilityId);
            if (existingImageCount + imageFiles.size() > 5) {
                throw new RuntimeException("시설 이미지는 최대 5장까지만 등록할 수 있습니다. " +
                        "현재: " + existingImageCount + "장, 추가 요청: " + imageFiles.size() + "장");
            }
            
            // 기존 이미지 삭제 (선택적)
            // facilityImageMapper.deleteAllImagesByFacilityId(facilityId);
            
            for (int i = 0; i < imageFiles.size(); i++) {
                MultipartFile file = imageFiles.get(i);
                String altText = (altTexts != null && i < altTexts.size()) ? altTexts.get(i) : null;
                
                if (!file.isEmpty()) {
                    // 파일 저장
                    String imagePath = saveImageFile(file, facilityId.toString(), i);
                    
                    // 데이터베이스에 저장
                    FacilityImageDTO imageDTO = new FacilityImageDTO();
                    imageDTO.setFacilityId(facilityId);
                    imageDTO.setImagePath(imagePath);
                    imageDTO.setImageAltText(altText);
                    imageDTO.setImageOrder(i);
                    imageDTO.setIsMainImage(i == 0); // 첫 번째 이미지를 메인으로 설정
                    
                    facilityImageMapper.insertFacilityImage(imageDTO);
                    log.info("✅ 시설 이미지 저장 완료 - index: {}, path: {}", i, imagePath);
                }
            }
            
            log.info("🎉 모든 시설 이미지 저장 완료 - facilityId: {}", facilityId);
            
        } catch (Exception e) {
            log.error("❌ 시설 이미지 저장 중 오류 발생 - facilityId: {}", facilityId, e);
            throw new RuntimeException("시설 이미지 저장에 실패했습니다.", e);
        }
    }

    /**
     * 단일 시설 이미지 저장
     */
    @Transactional
    public FacilityImageDTO saveSingleFacilityImage(Long facilityId, MultipartFile imageFile, String altText, Integer imageOrder) {
        try {
            log.info("📸 단일 시설 이미지 저장 시작 - facilityId: {}, order: {}", facilityId, imageOrder);
            
            if (imageFile.isEmpty()) {
                throw new IllegalArgumentException("업로드된 이미지 파일이 비어있습니다.");
            }
            
            // 파일 저장
            String imagePath = saveImageFile(imageFile, facilityId.toString(), imageOrder != null ? imageOrder : 0);
            
            // 기존 이미지 개수 확인 및 최대 제한 검사
            int existingImageCount = facilityImageMapper.countImagesByFacilityId(facilityId);
            log.info("📊 기존 이미지 개수: {}/5", existingImageCount);
            
            if (existingImageCount >= 5) {
                throw new RuntimeException("시설 이미지는 최대 5장까지만 등록할 수 있습니다. 현재: " + existingImageCount + "장");
            }
            
            // 데이터베이스에 저장
            FacilityImageDTO imageDTO = new FacilityImageDTO();
            imageDTO.setFacilityId(facilityId);
            imageDTO.setImagePath(imagePath);
            imageDTO.setImageAltText(altText);
            imageDTO.setImageOrder(imageOrder != null ? imageOrder : existingImageCount);
            imageDTO.setIsMainImage(existingImageCount == 0); // 첫 번째 이미지면 메인으로 설정
            
            facilityImageMapper.insertFacilityImage(imageDTO);
            log.info("✅ facility_images 테이블에 저장 완료 - imageId: {}, path: {}", imageDTO.getImageId(), imagePath);
            
            // 시설 테이블의 메인 이미지 정보도 업데이트
            updateFacilityMainImageInfo(facilityId);
            
            return imageDTO;
            
        } catch (Exception e) {
            log.error("❌ 단일 시설 이미지 저장 중 오류 발생 - facilityId: {}", facilityId, e);
            throw new RuntimeException("시설 이미지 저장에 실패했습니다.", e);
        }
    }
    
    /**
     * 시설 테이블의 메인 이미지 정보 업데이트
     */
    private void updateFacilityMainImageInfo(Long facilityId) {
        try {
            // 시설의 총 이미지 수 조회
            int imageCount = facilityImageMapper.countImagesByFacilityId(facilityId);
            
            // 메인 이미지 조회
            FacilityImageDTO mainImage = facilityImageMapper.getMainImageByFacilityId(facilityId);
            String mainImagePath = mainImage != null ? mainImage.getImagePath() : null;
            
            log.info("🔄 시설 테이블 메인 이미지 정보 업데이트 - facilityId: {}, imageCount: {}, mainImagePath: {}", 
                    facilityId, imageCount, mainImagePath);
            
            // 시설 테이블의 이미지 관련 정보 업데이트
            int result = facilityMapper.updateFacilityImageInfo(facilityId, imageCount, mainImagePath);
            if (result > 0) {
                log.info("✅ 시설 테이블 이미지 정보 업데이트 완료 - facilityId: {}", facilityId);
            } else {
                log.warn("⚠️ 시설 테이블 이미지 정보 업데이트 실패 - facilityId: {}", facilityId);
            }
            
        } catch (Exception e) {
            log.error("❌ 시설 테이블 메인 이미지 정보 업데이트 중 오류 - facilityId: {}", facilityId, e);
        }
    }

    /**
     * 시설 이미지 파일 저장 메서드
     */
    private String saveImageFile(MultipartFile file, String facilityId, int index) {
        try {
            // 프로젝트 루트 경로 기반으로 절대 경로 설정
            String projectRoot = System.getProperty("user.dir");
            String uploadDir = projectRoot + "/src/main/resources/static/uploads/facility/";
            File uploadDirFile = new File(uploadDir);
            if (!uploadDirFile.exists()) {
                boolean created = uploadDirFile.mkdirs();
                log.info("업로드 디렉토리 생성: {} - {}", uploadDir, created ? "성공" : "실패");
            }
            
            // 파일명 생성 (facilityId + index + UUID + 원본 확장자)
            String originalFilename = file.getOriginalFilename();
            String extension = "";
            if (originalFilename != null && originalFilename.contains(".")) {
                extension = originalFilename.substring(originalFilename.lastIndexOf("."));
            }
            String savedFilename = String.format("facility_%s_%d_%s%s", 
                    facilityId, index, UUID.randomUUID().toString(), extension);
            
            // 파일 저장
            File savedFile = new File(uploadDir + savedFilename);
            file.transferTo(savedFile);
            log.info("시설 이미지 파일 저장 완료: {}", savedFile.getAbsolutePath());
            
            // 웹 경로 반환
            return "/uploads/facility/" + savedFilename;
            
        } catch (IOException e) {
            log.error("시설 이미지 파일 저장 중 오류 발생: facilityId={}, index={}", facilityId, index, e);
            throw new RuntimeException("이미지 파일 저장에 실패했습니다.", e);
        }
    }

    /**
     * 메인 이미지 변경
     */
    @Transactional
    public void updateMainImage(Long facilityId, Long imageId) {
        try {
            log.info("메인 이미지 변경 시작 - facilityId: {}, imageId: {}", facilityId, imageId);
            
            // 기존 메인 이미지 해제
            facilityImageMapper.clearMainImages(facilityId);
            
            // 새 메인 이미지 설정
            int result = facilityImageMapper.updateMainImage(facilityId, imageId);
            if (result == 0) {
                throw new RuntimeException("메인 이미지 설정에 실패했습니다.");
            }
            
            log.info("메인 이미지 변경 완료 - facilityId: {}, imageId: {}", facilityId, imageId);
            
        } catch (Exception e) {
            log.error("메인 이미지 변경 중 오류 발생 - facilityId: {}, imageId: {}", facilityId, imageId, e);
            throw new RuntimeException("메인 이미지 변경에 실패했습니다.", e);
        }
    }

    /**
     * 시설 이미지 삭제
     */
    @Transactional
    public void deleteFacilityImage(Long imageId) {
        try {
            log.info("시설 이미지 삭제 시작 - imageId: {}", imageId);
            
            int result = facilityImageMapper.deleteFacilityImage(imageId);
            if (result == 0) {
                throw new RuntimeException("시설 이미지 삭제에 실패했습니다.");
            }
            
            log.info("시설 이미지 삭제 완료 - imageId: {}", imageId);
            
        } catch (Exception e) {
            log.error("시설 이미지 삭제 중 오류 발생 - imageId: {}", imageId, e);
            throw new RuntimeException("시설 이미지 삭제에 실패했습니다.", e);
        }
    }

    /**
     * 시설의 이미지 개수 조회
     */
    @Transactional(readOnly = true)
    public int getImageCountByFacilityId(Long facilityId) {
        return facilityImageMapper.countImagesByFacilityId(facilityId);
    }
}
````

## File: backup/facility-image-implementation/facility-image-implementation/README.md
````markdown
# 시설 이미지 구현 백업 (80% 완성)

이 디렉토리는 시설 이미지 등록/관리 기능 구현의 백업입니다.

## 백업된 파일들

### 백엔드 파일
- `FacilityImageService.java` - 시설 이미지 서비스 로직 (최대 5장 제한 포함)
- `FacilityController.java` - 시설 관련 컨트롤러

### 프론트엔드 파일
- `facility-detail.js` - 시설 상세보기 전용 JavaScript (이미지 모달, 슬라이더 등)
- `facility-detail-map.js` - 시설 상세보기 지도 기능 전용 JavaScript
- `facility-edit.js` - 시설 수정 페이지 JavaScript
- `detail.html` - 개선된 시설 상세보기 템플릿
- `edit.html` - 시설 수정 템플릿
- `detail-backup.html` - 원본 백업 파일

## 구현된 기능 (약 80% 완성)

### ✅ 완성된 기능
1. **이미지 업로드/삭제**
   - 드래그 앤 드롭 업로드
   - 미리보기 기능
   - 개별 이미지 삭제
   - 최대 5장 제한

2. **이미지 슬라이더**
   - 5초 자동 슬라이드
   - 화살표 네비게이션
   - 인디케이터 점

3. **이미지 확대 모달**
   - 클릭 시 전체화면 확대
   - 모달 내 슬라이더
   - 자동재생/일시정지 컨트롤
   - 다운로드 기능
   - 키보드 단축키 지원

4. **지도 기능**
   - 카카오맵 연동
   - 시설 위치 마커
   - 인포윈도우
   - 길찾기 기능

### 🔧 보완이 필요한 부분 (약 20%)
1. **에러 처리 강화**
   - 이미지 업로드 실패 시 처리
   - 네트워크 오류 처리

2. **성능 최적화**
   - 이미지 로딩 최적화
   - 메모리 관리

3. **접근성 개선**
   - 스크린 리더 지원
   - 키보드 네비게이션 완성

## 기술 스택
- **백엔드**: Spring Boot, MyBatis
- **프론트엔드**: Thymeleaf, Bootstrap 5, JavaScript
- **지도**: 카카오맵 API

## 사용 방법
1. 이전 버전으로 되돌린 후
2. 필요한 파일들을 적절한 위치에 복사
3. 단계별로 기능 재구현

## 주요 개선사항
- Thymeleaf와 JavaScript 충돌 방지
- 외부 JavaScript 파일 분리
- 안전한 데이터 전달 메커니즘
- 모듈화된 코드 구조

생성 일시: 2025-07-05
백업 사유: 이전 버전으로 되돌리기 전 80% 완성된 기능 보존
````

## File: src/main/java/com/example/carelink/common/CustomMultipartFile.java
````java
package com.example.carelink.common;

import org.springframework.web.multipart.MultipartFile;

import java.io.*;

/**
 * 커스텀 MultipartFile 구현
 * Base64 데이터를 MultipartFile로 변환하기 위한 클래스
 */
public class CustomMultipartFile implements MultipartFile {
    private final String name;
    private final String originalFilename;
    private final String contentType;
    private final byte[] content;

    public CustomMultipartFile(String name, String originalFilename, String contentType, byte[] content) {
        this.name = name;
        this.originalFilename = originalFilename;
        this.contentType = contentType;
        this.content = content;
    }

    @Override
    public String getName() {
        return name;
    }

    @Override
    public String getOriginalFilename() {
        return originalFilename;
    }

    @Override
    public String getContentType() {
        return contentType;
    }

    @Override
    public boolean isEmpty() {
        return content == null || content.length == 0;
    }

    @Override
    public long getSize() {
        return content != null ? content.length : 0;
    }

    @Override
    public byte[] getBytes() throws IOException {
        return content;
    }

    @Override
    public InputStream getInputStream() throws IOException {
        return new ByteArrayInputStream(content);
    }

    @Override
    public void transferTo(File dest) throws IOException, IllegalStateException {
        try (FileOutputStream fos = new FileOutputStream(dest)) {
            fos.write(content);
        }
    }
}
````

## File: src/main/java/com/example/carelink/common/PageInfo.java
````java
package com.example.carelink.common;

import lombok.Getter;
import lombok.Setter;

import java.util.List;

/**
 * 페이징 처리를 위한 정보 클래스
 * 모든 목록 조회에서 사용하는 페이징 정보
 */
@Getter
@Setter
public class PageInfo<T> {
    
    private List<T> list;           // 데이터 목록
    private int currentPage;        // 현재 페이지
    private int pageSize;           // 페이지당 데이터 수
    private int totalCount;         // 전체 데이터 수
    private int totalPages;         // 전체 페이지 수
    private int startPage;          // 시작 페이지 번호
    private int endPage;            // 끝 페이지 번호
    private boolean hasPrevious;    // 이전 페이지 존재 여부
    private boolean hasNext;        // 다음 페이지 존재 여부
    private boolean firstPage;      // 첫 페이지 여부
    private boolean lastPage;       // 마지막 페이지 여부
    
    /**
     * 페이징 정보 생성
     * @param list 데이터 목록
     * @param currentPage 현재 페이지
     * @param pageSize 페이지당 데이터 수
     * @param totalCount 전체 데이터 수
     */
    public PageInfo(List<T> list, int currentPage, int pageSize, int totalCount) {
        this.list = list;
        this.currentPage = currentPage;
        this.pageSize = pageSize;
        this.totalCount = totalCount;
        
        // 전체 페이지 수 계산
        this.totalPages = (int) Math.ceil((double) totalCount / pageSize);
        
        // 페이지 네비게이션 범위 계산 (시작, 끝 페이지)
        this.startPage = Math.max(1, currentPage - 4);
        this.endPage = Math.min(totalPages, currentPage + 4);
        
        // 이전/다음 페이지 존재 여부
        this.hasPrevious = currentPage > 1;
        this.hasNext = currentPage < totalPages;
        this.firstPage = currentPage == 1;
        this.lastPage = currentPage == totalPages;
    }
    
    /**
     * 페이지 오프셋 계산
     */
    public int getOffset() {
        return (currentPage - 1) * pageSize;
    }
    
    /**
     * 현재 페이지가 첫 페이지인지 확인
     */
    public boolean isFirstPage() {
        return currentPage == 1;
    }
    
    /**
     * 현재 페이지가 마지막 페이지인지 확인
     */
    public boolean isLastPage() {
        return currentPage == totalPages;
    }
}
````

## File: src/main/java/com/example/carelink/config/DevSecurityConfig.java
````java
package com.example.carelink.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Profile;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.web.SecurityFilterChain;

/**
 * 개발 환경 전용 보안 설정
 * 개발 편의성을 위해 보안을 완화한 설정
 */
@Configuration
@EnableWebSecurity
@Profile("dev")
public class DevSecurityConfig {

    @Bean
    public SecurityFilterChain devFilterChain(HttpSecurity http) throws Exception {
        http
            .csrf(csrf -> csrf.disable()) // 개발 환경에서는 CSRF 비활성화
            .authorizeHttpRequests(auth -> auth
                .anyRequest().permitAll() // 개발 환경에서는 모든 요청 허용
            )
            .formLogin(formLogin -> formLogin.disable()) // 개발 환경에서는 기본 폼 로그인 비활성화
            .httpBasic(httpBasic -> httpBasic.disable()); // 개발 환경에서는 Basic 인증 비활성화

        return http.build();
    }
}
````

## File: src/main/java/com/example/carelink/config/KakaoApiConfig.java
````java
package com.example.carelink.config;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.springframework.web.servlet.HandlerInterceptor;
import org.springframework.web.servlet.ModelAndView;

/**
 * 카카오 API 키 설정을 위한 Configuration
 */
@Configuration
public class KakaoApiConfig implements WebMvcConfigurer {

    @Value("${api.kakao.app-key:#{null}}")
    private String kakaoAppKey;
    
    // 환경변수를 직접 읽는 방법도 추가
    private String getKakaoAppKey() {
        String key = kakaoAppKey;
        if (key == null || key.isEmpty()) {
            key = System.getenv("KAKAO_APP_KEY");
            System.out.println("환경변수에서 직접 읽은 API 키: " + (key != null ? "존재함" : "없음"));
        }
        return key;
    }

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new KakaoApiInterceptor());
    }

    /**
     * 모든 페이지에 KAKAO_APP_KEY를 자동으로 추가하는 인터셉터
     */
    public class KakaoApiInterceptor implements HandlerInterceptor {

        @Override
        public void postHandle(HttpServletRequest request, HttpServletResponse response, 
                             Object handler, ModelAndView modelAndView) throws Exception {
            
            if (modelAndView != null && !modelAndView.getViewName().startsWith("redirect:")) {
                // 모든 뷰에 KAKAO_APP_KEY 추가
                String apiKey = getKakaoAppKey();
                System.out.println("뷰에 전달할 API 키: " + (apiKey != null && !apiKey.isEmpty() ? "존재함" : "없음"));
                modelAndView.addObject("KAKAO_APP_KEY", apiKey);
            }
        }
    }
}
````

## File: src/main/java/com/example/carelink/config/ProdSecurityConfig.java
````java
package com.example.carelink.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Profile;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.util.matcher.AntPathRequestMatcher;

/**
 * 운영 환경 전용 보안 설정
 * 실제 서비스 환경에 적합한 보안 강화 설정
 */
@Configuration
@EnableWebSecurity
@Profile("prod")
public class ProdSecurityConfig {

    @Bean
    public SecurityFilterChain prodFilterChain(HttpSecurity http) throws Exception {
        http
            .csrf(csrf -> csrf
                .csrfTokenRepository(org.springframework.security.web.csrf.CookieCsrfTokenRepository.withHttpOnlyFalse())
            ) // 운영 환경에서는 CSRF 보호 활성화
            .authorizeHttpRequests(auth -> auth
                // 정적 리소스 허용
                .requestMatchers(
                    new AntPathRequestMatcher("/css/**"),
                    new AntPathRequestMatcher("/js/**"),
                    new AntPathRequestMatcher("/images/**"),
                    new AntPathRequestMatcher("/favicon.ico")
                ).permitAll()
                // 인증 없이 접근을 허용할 URL 설정 (기존 SecurityConfig와 동일)
                .requestMatchers(
                    new AntPathRequestMatcher("/"),                    // 메인 페이지
                    new AntPathRequestMatcher("/member/login"),       // 로그인 폼 페이지 및 처리
                    new AntPathRequestMatcher("/member/join"),        // 회원가입 폼 페이지 및 처리
                    new AntPathRequestMatcher("/member/checkUserId"), // 아이디 중복 확인 Ajax
                    new AntPathRequestMatcher("/facility/**"),        // 시설 검색 페이지 (비회원도 접근 가능)
                    new AntPathRequestMatcher("/board/**"),           // 게시판 페이지 (비회원도 접근 가능)
                    new AntPathRequestMatcher("/review/**"),          // 리뷰 페이지 (비회원도 접근 가능)
                    new AntPathRequestMatcher("/job/**"),             // 구인구직 페이지 (비회원도 접근 가능)
                    new AntPathRequestMatcher("/api/**"),             // API 경로 (필요시)
                    new AntPathRequestMatcher("/error")               // 에러 페이지 (필요시)
                ).permitAll()
                // 관리자 페이지는 ADMIN 권한 필요
                .requestMatchers(new AntPathRequestMatcher("/admin/**")).hasRole("ADMIN")
                // 나머지는 인증 필요 (운영 환경)
                .anyRequest().authenticated()
            )
            .formLogin(formLogin -> formLogin
                .loginPage("/member/login")
                .defaultSuccessUrl("/")
                .failureUrl("/member/login?error=true")
                .permitAll()
            )
            .logout(logout -> logout
                .logoutRequestMatcher(new AntPathRequestMatcher("/member/logout")) // 로그아웃 URL
                .logoutSuccessUrl("/") // 로그아웃 성공 시 이동 페이지
                .invalidateHttpSession(true) // 세션 무효화
                .deleteCookies("JSESSIONID") // 쿠키 삭제
                .permitAll()
            )
            .sessionManagement(session -> session
                .maximumSessions(1) // 동시 로그인 세션 1개로 제한
                .maxSessionsPreventsLogin(false) // 새 로그인 시 기존 세션 무효화
            );

        return http.build();
    }
}
````

## File: src/main/java/com/example/carelink/controller/HomeController.java
````java
package com.example.carelink.controller;

import com.example.carelink.service.BoardService;
import com.example.carelink.service.FacilityService;
import com.example.carelink.service.JobService;
import com.example.carelink.service.MemberService;
import com.example.carelink.service.ReviewService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

/**
 * 홈페이지 컨트롤러
 * 메인 페이지 및 공통 페이지 처리
 */
@Slf4j
@Controller
@RequiredArgsConstructor
public class HomeController {

    private final MemberService memberService;
    private final FacilityService facilityService;
    private final JobService jobService;
    private final ReviewService reviewService;
    private final BoardService boardService;

    /**
     * 메인 홈페이지
     */
    @GetMapping("/")
    public String home(Model model) {
        model.addAttribute("pageTitle", "메인");
        
        try {
            // 실제 통계 데이터 조회
            int facilityCount = facilityService.getFacilityCount();
            int jobCount = jobService.getJobCount();
            int reviewCount = reviewService.getReviewCount();
            int memberCount = memberService.getMemberCount();
            int boardCount = boardService.getBoardCount();
            
            model.addAttribute("facilityCount", facilityCount);
            model.addAttribute("jobCount", jobCount);
            model.addAttribute("reviewCount", reviewCount);
            model.addAttribute("memberCount", memberCount);
            model.addAttribute("boardCount", boardCount);
            
            log.info("통계 데이터 - 시설: {}, 구인구직: {}, 리뷰: {}, 회원: {}, 게시글: {}", 
                    facilityCount, jobCount, reviewCount, memberCount, boardCount);
        } catch (Exception e) {
            log.error("통계 데이터 조회 실패", e);
            // 에러 발생 시 기본값 설정
            model.addAttribute("facilityCount", 0);
            model.addAttribute("jobCount", 0);
            model.addAttribute("reviewCount", 0);
            model.addAttribute("memberCount", 0);
            model.addAttribute("boardCount", 0);
        }
        
        log.info("메인 페이지 접속");
        return "index";
    }

    /**
     * 소개 페이지
     */
    @GetMapping("/about")
    public String about(Model model) {
        model.addAttribute("pageTitle", "소개");
        return "about";
    }

    /**
     * 오류 페이지
     */
    @GetMapping("/error")
    public String error() {
        return "error";
    }
}
````

## File: src/main/java/com/example/carelink/dao/JobApplicationMapper.java
````java
package com.example.carelink.dao;

import com.example.carelink.dto.JobApplicationDTO; // 방금 생성한 JobApplicationDTO 임포트
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param; // @Param 어노테이션 임포트

@Mapper // 이 인터페이스가 MyBatis 매퍼임을 나타냅니다.
public interface JobApplicationMapper {

    // 새로운 지원 정보를 데이터베이스에 삽입하는 메서드
    // JobApplicationDTO 객체를 받아서 DB에 저장하고, 삽입된 레코드 수를 반환합니다.
    int insertJobApplication(JobApplicationDTO jobApplication);

    // 특정 공고에 대한 특정 회원의 지원 여부를 확인하는 메서드
    // job_id와 applicant_member_id를 받아서 해당 조건에 맞는 지원서의 수를 반환합니다.
    int countByJobIdAndApplicantMemberId(@Param("jobId") Long jobId, @Param("applicantMemberId") Long applicantMemberId);

    // TODO: (선택 사항) 필요한 경우 다른 조회/수정/삭제 메서드 추가
    // 예:
    // JobApplicationDTO findById(Long id);
    // List<JobApplicationDTO> findByJobId(Long jobId);
    // List<JobApplicationDTO> findByApplicantMemberId(Long applicantMemberId);
    // int updateStatus(@Param("id") Long id, @Param("status") String status);
}
````

## File: src/main/java/com/example/carelink/dto/FacilityImageDTO.java
````java
package com.example.carelink.dto;

import lombok.Data;
import java.time.LocalDateTime;

/**
 * 시설 이미지 DTO
 * 다중 이미지 지원을 위한 별도 DTO
 */
@Data
public class FacilityImageDTO {
    private Long imageId;
    private Long facilityId;
    private String imagePath;
    private String imageAltText;
    private Integer imageOrder;
    private Boolean isMainImage;
    private LocalDateTime uploadDate;
    private LocalDateTime updatedAt;
}
````

## File: src/main/java/com/example/carelink/dto/JobApplicationDTO.java
````java
package com.example.carelink.dto;

import lombok.Data;
import lombok.NoArgsConstructor;
import lombok.AllArgsConstructor;

import java.time.LocalDateTime; // LocalDateTime 클래스 임포트

@Data // Lombok: getter, setter, equals, hashCode, toString 자동 생성
@NoArgsConstructor // Lombok: 기본 생성자 자동 생성
@AllArgsConstructor // Lombok: 모든 필드를 인자로 받는 생성자 자동 생성
public class JobApplicationDTO {

    private Long id; // 지원서의 고유 ID (데이터베이스의 기본 키)
    private Long jobId; // 지원한 구인/구직 공고의 ID (JobDTO의 jobId와 연결)
    private Long applicantMemberId; // 지원한 개인 회원의 ID (MemberDTO의 memberId와 연결)
    private LocalDateTime applicationDate; // 지원 일시 (지원 버튼 클릭 시의 시간)
    private String status; // 지원 상태 (예: "PENDING", "ACCEPTED", "REJECTED" 등)

    // TODO: (선택 사항) 필요한 경우 추가 필드
    // 예를 들어, 이력서 파일 경로, 자기소개서 내용 등을 추가할 수 있습니다.
    // private String resumePath;
    // private String coverLetter;
}
````

## File: src/main/java/com/example/carelink/validation/groups/OnFacilityJoin.java
````java
package com.example.carelink.validation.groups;

public interface OnFacilityJoin {
}
````

## File: src/main/resources/mapper/JobApplicationMapper.xml
````xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.JobApplicationMapper">

    <insert id="insertJobApplication" parameterType="com.example.carelink.dto.JobApplicationDTO"
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO job_application (
            job_id,
            applicant_member_id,
            application_date,
            status
        ) VALUES (
            #{jobId},
            #{applicantMemberId},
            #{applicationDate},
            #{status}
        )
    </insert>

    <select id="countByJobIdAndApplicantMemberId" resultType="int">
        SELECT COUNT(*)
        FROM job_application
        WHERE job_id = #{jobId} AND applicant_member_id = #{applicantMemberId}
    </select>

    </mapper>
````

## File: src/main/resources/static/css/facility-image-uploader.css
````css
/**
 * 시설 이미지 업로더 스타일
 * 사용자 친화적이고 현대적인 디자인
 */

.facility-image-uploader {
    max-width: 100%;
    margin: 0 auto;
}

/* 업로드 영역 */
.upload-area {
    border: 2px dashed #dee2e6;
    border-radius: 12px;
    padding: 40px 20px;
    text-align: center;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.upload-area::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s ease;
}

.upload-area:hover {
    border-color: #007bff;
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,123,255,0.15);
}

.upload-area:hover::before {
    left: 100%;
}

.upload-area.drag-over {
    border-color: #28a745;
    background: linear-gradient(135deg, #e8f5e8 0%, #c3e6cb 100%);
    transform: scale(1.02);
}

.upload-content {
    position: relative;
    z-index: 1;
}

.upload-icon {
    margin-bottom: 20px;
}

.upload-icon i {
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

.upload-title {
    color: #495057;
    font-weight: 600;
    margin-bottom: 10px;
}

.upload-description {
    font-size: 16px;
    margin-bottom: 15px;
}

.upload-format-info {
    margin-bottom: 20px;
}

/* 미리보기 영역 */
.preview-area {
    border: 1px solid #dee2e6;
    border-radius: 12px;
    padding: 20px;
    background: #fff;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e9ecef;
}

.preview-header h6 {
    color: #495057;
    font-weight: 600;
}

.preview-image-container {
    position: relative;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    margin-bottom: 20px;
}

.preview-image {
    width: 100%;
    max-height: 300px;
    object-fit: cover;
    display: block;
}

.image-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0,0,0,0.7));
    color: white;
    padding: 15px;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.preview-image-container:hover .image-overlay {
    opacity: 1;
}

.image-info {
    display: flex;
    gap: 15px;
    font-size: 14px;
}

.image-size, .image-dimensions {
    background: rgba(255,255,255,0.2);
    padding: 4px 8px;
    border-radius: 4px;
    backdrop-filter: blur(5px);
}

/* 압축 설정 */
.compression-settings {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    border: 1px solid #e9ecef;
}

.compression-savings {
    font-size: 14px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.form-range {
    appearance: none;
    background: transparent;
    cursor: pointer;
}

.form-range::-webkit-slider-track {
    background: #dee2e6;
    height: 6px;
    border-radius: 3px;
}

.form-range::-webkit-slider-thumb {
    appearance: none;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #007bff;
    cursor: pointer;
    border: 2px solid #fff;
    box-shadow: 0 2px 6px rgba(0,123,255,0.3);
}

.form-range::-moz-range-track {
    background: #dee2e6;
    height: 6px;
    border-radius: 3px;
    border: none;
}

.form-range::-moz-range-thumb {
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #007bff;
    cursor: pointer;
    border: 2px solid #fff;
    box-shadow: 0 2px 6px rgba(0,123,255,0.3);
}

/* Alt 텍스트 섹션 */
.alt-text-section {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 15px;
}

.alt-text-section .form-label {
    color: #856404;
    font-weight: 600;
}

/* 진행률 영역 */
.progress-area {
    margin: 20px 0;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.progress {
    height: 8px;
    border-radius: 4px;
    background: #e9ecef;
    overflow: hidden;
}

.progress-bar {
    background: linear-gradient(45deg, #007bff, #0056b3);
    transition: width 0.3s ease;
}

.progress-text {
    margin-top: 10px;
    color: #6c757d;
    font-weight: 500;
}

/* 버튼 스타일 */
.btn {
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255,255,255,0.3);
    transition: all 0.3s ease;
    transform: translate(-50%, -50%);
}

.btn:hover::before {
    width: 300px;
    height: 300px;
}

.btn-lg {
    padding: 12px 30px;
    font-size: 16px;
    font-weight: 600;
}

.btn-primary {
    background: linear-gradient(45deg, #007bff, #0056b3);
    border: none;
    box-shadow: 0 4px 15px rgba(0,123,255,0.3);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,123,255,0.4);
}

.btn-outline-danger {
    border-color: #dc3545;
    color: #dc3545;
}

.btn-outline-danger:hover {
    background: #dc3545;
    border-color: #dc3545;
    color: white;
    transform: translateY(-1px);
}

.btn-outline-secondary {
    border-color: #6c757d;
    color: #6c757d;
}

.btn-outline-secondary:hover {
    background: #6c757d;
    border-color: #6c757d;
    color: white;
}

/* 에러 메시지 */
.error-message {
    border-radius: 8px;
    border: none;
    background: linear-gradient(45deg, #dc3545, #c82333);
    color: white;
    font-weight: 500;
    animation: slideInDown 0.3s ease;
}

@keyframes slideInDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* 반응형 디자인 */
@media (max-width: 768px) {
    .upload-area {
        padding: 30px 15px;
    }
    
    .upload-title {
        font-size: 1.1rem;
    }
    
    .upload-description {
        font-size: 14px;
    }
    
    .preview-area {
        padding: 15px;
    }
    
    .compression-settings {
        padding: 12px;
    }
    
    .btn-lg {
        padding: 10px 25px;
        font-size: 15px;
    }
    
    .image-info {
        flex-direction: column;
        gap: 8px;
    }
}

@media (max-width: 576px) {
    .preview-header {
        flex-direction: column;
        gap: 10px;
        text-align: center;
    }
    
    .compression-settings .row {
        flex-direction: column;
    }
    
    .compression-settings .col-md-6 {
        margin-bottom: 15px;
    }
}

/* 다크 모드 지원 */
@media (prefers-color-scheme: dark) {
    .upload-area {
        background: linear-gradient(135deg, #343a40 0%, #495057 100%);
        border-color: #495057;
    }
    
    .upload-title, .upload-description {
        color: #f8f9fa;
    }
    
    .preview-area {
        background: #343a40;
        border-color: #495057;
    }
    
    .compression-settings {
        background: #495057;
        border-color: #6c757d;
    }
    
    .alt-text-section {
        background: #856404;
        border-color: #ffc107;
    }
    
    .progress-area {
        background: #495057;
        border-color: #6c757d;
    }
}

/* 애니메이션 향상 */
.facility-image-uploader * {
    transition: all 0.3s ease;
}

/* 포커스 상태 */
.btn:focus,
.form-control:focus,
.form-range:focus {
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);
    outline: none;
}

/* 로딩 상태 */
.loading {
    pointer-events: none;
    opacity: 0.6;
}

.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border: 2px solid #fff;
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}
````

## File: src/main/resources/static/css/image-compressor.css
````css
/* 이미지 압축 UI 스타일 */
.image-compressor-wrapper {
    position: relative;
}

.image-upload-area {
    min-height: 120px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #f8f9fa;
}

.image-upload-area:hover {
    background: #e9ecef;
}

.image-upload-area.drag-over {
    border-color: #007bff !important;
    background: #e7f3ff !important;
}

.upload-icon svg {
    transition: transform 0.3s ease;
}

.image-upload-area:hover .upload-icon svg {
    transform: scale(1.1);
}

.compression-settings {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1rem;
}

.compression-settings h4 {
    color: #495057;
    margin-bottom: 1rem;
}

.quality-slider {
    accent-color: #007bff;
}

.max-width-input {
    font-size: 0.875rem;
}

.compress-btn {
    background: linear-gradient(45deg, #007bff, #0056b3);
    border: none;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0,123,255,0.2);
}

.compress-btn:hover {
    background: linear-gradient(45deg, #0056b3, #004085);
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,123,255,0.3);
}

.file-preview {
    max-height: 400px;
    overflow-y: auto;
}

.preview-item {
    background: #ffffff;
    transition: all 0.3s ease;
}

.preview-item:hover {
    background: #f8f9fa;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.preview-item img {
    object-fit: cover;
    border: 1px solid #dee2e6;
}

.compression-result {
    text-align: right;
}

.compression-result .text-green-600 {
    color: #28a745 !important;
}

.compression-progress {
    background: #ffffff;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 1rem;
}

.progress-bar {
    overflow: hidden;
    position: relative;
}

.progress-fill {
    background: linear-gradient(90deg, #007bff, #28a745);
    position: relative;
    overflow: hidden;
}

.progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: progress-shine 2s infinite;
}

@keyframes progress-shine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.compression-summary {
    background: linear-gradient(135deg, #d4edda, #c3e6cb);
    border: 1px solid #b8dabc;
    animation: slideIn 0.5s ease-out;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.compression-summary h4 {
    color: #155724;
}

.compression-summary .text-green-700 {
    color: #155724 !important;
}

/* 반응형 디자인 */
@media (max-width: 768px) {
    .compression-settings .grid-cols-2 {
        grid-template-columns: 1fr;
    }
    
    .preview-item {
        flex-direction: column;
        text-align: center;
    }
    
    .preview-item .flex {
        flex-direction: column;
        align-items: center;
    }
    
    .compression-result {
        text-align: center;
        margin-top: 1rem;
    }
}

/* 드래그 앤 드롭 상태 */
.image-upload-area.border-blue-400 {
    border-color: #60a5fa !important;
}

.image-upload-area.bg-blue-50 {
    background-color: #eff6ff !important;
}

/* 로딩 애니메이션 */
.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #007bff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* 압축 품질 표시 */
.quality-indicator {
    position: relative;
    height: 4px;
    background: #e9ecef;
    border-radius: 2px;
    overflow: hidden;
}

.quality-indicator::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background: linear-gradient(90deg, #dc3545, #ffc107, #28a745);
    border-radius: 2px;
    transition: width 0.3s ease;
}

.quality-indicator[data-quality="0.1"]::before { width: 10%; }
.quality-indicator[data-quality="0.2"]::before { width: 20%; }
.quality-indicator[data-quality="0.3"]::before { width: 30%; }
.quality-indicator[data-quality="0.4"]::before { width: 40%; }
.quality-indicator[data-quality="0.5"]::before { width: 50%; }
.quality-indicator[data-quality="0.6"]::before { width: 60%; }
.quality-indicator[data-quality="0.7"]::before { width: 70%; }
.quality-indicator[data-quality="0.8"]::before { width: 80%; }
.quality-indicator[data-quality="0.9"]::before { width: 90%; }
.quality-indicator[data-quality="1"]::before { width: 100%; }

/* 툴팁 스타일 */
.tooltip-text {
    position: relative;
    cursor: help;
}

.tooltip-text::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: #333;
    color: white;
    padding: 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 1000;
}

.tooltip-text:hover::after {
    opacity: 1;
}

/* 성공 메시지 */
.success-message {
    background: linear-gradient(135deg, #d4edda, #c3e6cb);
    border: 1px solid #b8dabc;
    color: #155724;
    padding: 1rem;
    border-radius: 8px;
    margin-top: 1rem;
    animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* 파일 크기 표시 */
.file-size {
    font-family: 'Courier New', monospace;
    font-weight: 600;
}

.file-size.original {
    color: #dc3545;
}

.file-size.compressed {
    color: #28a745;
}

/* 압축률 배지 */
.compression-badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    background: #28a745;
    color: white;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
}

.compression-badge.high {
    background: #28a745;
}

.compression-badge.medium {
    background: #ffc107;
    color: #212529;
}

.compression-badge.low {
    background: #dc3545;
}

/* Alt 태그 입력 UI 스타일 */
.alt-tags-section {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid #e9ecef;
}

.alt-tags-section h4 {
    color: #495057;
    margin-bottom: 1rem;
}

.alt-tag-item {
    background: #ffffff;
    transition: all 0.3s ease;
    border: 1px solid #dee2e6;
}

.alt-tag-item:hover {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transform: translateY(-1px);
}

.file-icon {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
}

.alt-text-input {
    border: 1px solid #ced4da;
    border-radius: 4px;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    resize: vertical;
}

.alt-text-input:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);
    outline: 0;
}

.char-count {
    font-size: 0.75rem;
    font-weight: 500;
}

.auto-suggestion {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 4px;
    padding: 0.5rem;
    margin-top: 0.5rem;
}

.auto-suggestion .auto-alt-text {
    font-style: italic;
    color: #856404;
    font-weight: 500;
}

.use-suggestion {
    text-decoration: none !important;
    font-size: 0.75rem;
    color: #28a745 !important;
    transition: color 0.3s ease;
}

.use-suggestion:hover {
    color: #1e7e34 !important;
}

.use-suggestion:disabled {
    color: #6c757d !important;
    cursor: not-allowed;
}

/* SEO 도움말 툴팁 */
.seo-help {
    position: relative;
    display: inline-block;
    cursor: help;
}

.seo-help::before {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    background: #333;
    color: white;
    padding: 0.5rem 0.75rem;
    border-radius: 4px;
    font-size: 0.75rem;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 1000;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.seo-help::after {
    content: '';
    position: absolute;
    bottom: 115%;
    left: 50%;
    transform: translateX(-50%);
    border: 4px solid transparent;
    border-top-color: #333;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 1000;
}

.seo-help:hover::before,
.seo-help:hover::after {
    opacity: 1;
}

/* 자동 생성 체크박스 */
.form-check-input:checked {
    background-color: #007bff;
    border-color: #007bff;
}

.form-check-label {
    color: #495057;
    font-weight: 500;
}

/* 반응형 디자인 */
@media (max-width: 768px) {
    .alt-tag-item .d-flex {
        flex-direction: column;
    }
    
    .file-icon {
        align-self: center;
        margin-bottom: 1rem;
    }
    
    .char-count {
        float: none !important;
        display: block;
        text-align: center;
        margin-top: 0.25rem;
    }
    
    .auto-suggestion {
        text-align: center;
    }
    
    .use-suggestion {
        display: block;
        margin-top: 0.5rem;
    }
}

/* 애니메이션 효과 */
.alt-tags-section {
    animation: slideInUp 0.3s ease-out;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.alt-tag-item {
    animation: fadeInScale 0.3s ease-out;
}

@keyframes fadeInScale {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* 성공 상태 */
.alt-input-success {
    border-color: #28a745 !important;
}

.alt-input-success:focus {
    border-color: #28a745 !important;
    box-shadow: 0 0 0 0.2rem rgba(40,167,69,0.25) !important;
}

/* 경고 상태 */
.alt-input-warning {
    border-color: #ffc107 !important;
}

.alt-input-warning:focus {
    border-color: #ffc107 !important;
    box-shadow: 0 0 0 0.2rem rgba(255,193,7,0.25) !important;
}
````

## File: src/main/resources/static/js/board-detail.js
````javascript
// 게시글 상세 페이지 전용 JavaScript
console.log('board-detail.js 로드됨');

function deleteBoard(event) {
    console.log('삭제 함수 실행');
    
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    var button = event ? event.target.closest('button') : document.querySelector('button[data-board-id]');
    console.log('버튼:', button);
    
    if (!button) {
        alert('삭제 버튼을 찾을 수 없습니다.');
        return false;
    }
    
    var boardId = parseInt(button.getAttribute('data-board-id'));
    var type = button.getAttribute('data-type') || 'all';
    
    console.log('boardId:', boardId, 'type:', type);
    
    if (!boardId || isNaN(boardId)) {
        alert('게시글 ID가 올바르지 않습니다.');
        return false;
    }
    
    if (!confirm('정말로 삭제하시겠습니까?')) {
        return false;
    }
    
    button.disabled = true;
    button.innerHTML = '삭제 중...';
    
    var formData = new FormData();
    formData.append('type', type);
    
    fetch('/board/delete/' + boardId, {
        method: 'POST',
        body: formData
    })
    .then(function(response) {
        console.log('응답 상태:', response.status);
        if (response.ok || response.status === 302) {
            window.location.href = '/board?type=' + type;
        } else {
            alert('삭제에 실패했습니다.');
            button.disabled = false;
            button.innerHTML = '<i class="fas fa-trash me-1"></i>삭제';
        }
    })
    .catch(function(error) {
        console.error('에러:', error);
        alert('오류가 발생했습니다.');
        button.disabled = false;
        button.innerHTML = '<i class="fas fa-trash me-1"></i>삭제';
    });
    
    return false;
}

function likeBoard() {
    var deleteButton = document.querySelector('button[data-board-id]');
    var boardId = deleteButton ? parseInt(deleteButton.getAttribute('data-board-id')) : 0;
    
    if (!boardId) {
        alert('게시글 ID를 찾을 수 없습니다.');
        return;
    }
    
    fetch('/board/like/' + boardId, {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: 'action=like'
    })
    .then(function(response) { return response.json(); })
    .then(function(data) {
        if (data.success) {
            var likeCount = document.getElementById('likeCount');
            if (likeCount) {
                likeCount.textContent = parseInt(likeCount.textContent) + 1;
            }
            alert(data.message || '추천되었습니다.');
        } else {
            alert(data.message || '추천에 실패했습니다.');
        }
    })
    .catch(function(error) {
        console.error('에러:', error);
        alert('오류가 발생했습니다.');
    });
}

function shareBoard() {
    var title = document.title.replace(' - CareLink', '') || '게시글';
    var url = window.location.href;
    
    if (navigator.clipboard) {
        navigator.clipboard.writeText(url).then(function() {
            alert('링크가 복사되었습니다.');
        }).catch(function() {
            prompt('링크를 복사하세요:', url);
        });
    } else {
        prompt('링크를 복사하세요:', url);
    }
}

function reportBoard() {
    if (confirm('이 게시글을 신고하시겠습니까?')) {
        alert('신고가 접수되었습니다.');
    }
}

console.log('board-detail.js 로드 완료');
````

## File: src/main/resources/static/js/board-navigation.js
````javascript
/**
 * 게시판 네비게이션 공통 JavaScript
 * 모든 게시판 템플릿에서 사용
 * 탭 클릭 시 브라우저 히스토리 문제 해결
 */

$(document).ready(function() {
    console.log('게시판 네비게이션 스크립트 로드됨');
    
    // 게시판 타입 링크 클릭 시 히스토리 교체 (핵심 기능)
    $('.board-type-link, .btn-group a[href*="/board"]').on('click', function(e) {
        const url = $(this).attr('href');
        
        // 현재 게시판 페이지에서 다른 탭으로 이동할 때만 히스토리 교체
        if (url && window.location.pathname.includes('/board')) {
            e.preventDefault();
            
            // 브라우저 지원 체크 후 히스토리 교체
            if (history.replaceState) {
                history.replaceState(null, null, url);
                console.log('히스토리 교체됨:', url);
            }
            
            // 페이지 이동
            window.location.href = url;
        }
        // 다른 페이지에서 게시판으로 오는 경우는 정상적인 히스토리 추가
    });
    
    // 검색 폼과 페이지네이션도 동일하게 처리
    $(document).on('click', '.pagination .page-link', function(e) {
        const url = $(this).attr('href');
        
        if (url && url !== '#' && url !== 'javascript:void(0)' && window.location.pathname.includes('/board')) {
            e.preventDefault();
            if (history.replaceState) {
                history.replaceState(null, null, url);
            }
            window.location.href = url;
        }
    });
    
    $(document).on('submit', 'form[action*="/board"]', function(e) {
        if (window.location.pathname.includes('/board')) {
            e.preventDefault();
            const form = $(this);
            const url = form.attr('action') || '/board';
            const formData = form.serialize();
            const fullUrl = url + '?' + formData;
            
            if (history.replaceState) {
                history.replaceState(null, null, fullUrl);
            }
            window.location.href = fullUrl;
        }
    });
});
````

## File: src/main/resources/static/js/change-password.js
````javascript
// 비밀번호 변경 페이지 JavaScript
// Thymeleaf 인라인 JavaScript를 사용하지 않고 완전히 분리된 JavaScript 파일

document.addEventListener('DOMContentLoaded', function() {
    // 상수 정의
    const PASSWORD_PATTERN = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,20}$/;
    const MIN_PASSWORD_LENGTH = 8;
    
    // DOM 요소 선택
    const elements = {
        form: document.getElementById('changePasswordForm'),
        currentPassword: document.getElementById('currentPassword'),
        newPassword: document.getElementById('newPassword'),
        confirmPassword: document.getElementById('confirmPassword'),
        submitButton: document.getElementById('submitButton'),
        toggleButtons: {
            current: document.getElementById('toggleCurrentPassword'),
            new: document.getElementById('toggleNewPassword'),
            confirm: document.getElementById('toggleConfirmPassword')
        },
        feedbacks: {
            current: document.getElementById('currentPasswordFeedback'),
            new: document.getElementById('newPasswordFeedback'),
            confirm: document.getElementById('confirmPasswordFeedback')
        }
    };

    // 디버깅: DOM 요소 확인
    console.log('비밀번호 변경 페이지 DOM 요소:', elements);

    // 비밀번호 표시/숨김 토글 함수
    function setupPasswordToggle(inputElement, toggleButton) {
        if (!inputElement || !toggleButton) {
            console.warn('비밀번호 토글 요소가 없습니다.');
            return;
        }

        toggleButton.addEventListener('click', function() {
            const icon = this.querySelector('i');
            if (inputElement.type === 'password') {
                inputElement.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                inputElement.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });
    }

    // 모든 비밀번호 토글 설정
    setupPasswordToggle(elements.currentPassword, elements.toggleButtons.current);
    setupPasswordToggle(elements.newPassword, elements.toggleButtons.new);
    setupPasswordToggle(elements.confirmPassword, elements.toggleButtons.confirm);

    // 입력 필드 유효성 검사 상태 초기화
    function clearValidationState(inputElement) {
        if (inputElement) {
            inputElement.classList.remove('is-valid', 'is-invalid');
        }
    }

    // 피드백 메시지 설정
    function setFeedback(feedbackElement, message, isValid) {
        if (!feedbackElement) return;
        
        feedbackElement.textContent = message;
        if (isValid) {
            feedbackElement.classList.remove('invalid-feedback');
            feedbackElement.classList.add('valid-feedback');
        } else {
            feedbackElement.classList.remove('valid-feedback');
            feedbackElement.classList.add('invalid-feedback');
        }
    }

    // 입력 필드 유효성 상태 설정
    function setValidationState(inputElement, isValid) {
        if (!inputElement) return;
        
        if (isValid) {
            inputElement.classList.remove('is-invalid');
            inputElement.classList.add('is-valid');
        } else {
            inputElement.classList.remove('is-valid');
            inputElement.classList.add('is-invalid');
        }
    }

    // 현재 비밀번호 검증
    function validateCurrentPassword() {
        const value = elements.currentPassword.value.trim();
        const isValid = value.length >= MIN_PASSWORD_LENGTH;
        
        if (value === '') {
            clearValidationState(elements.currentPassword);
            setFeedback(elements.feedbacks.current, '', true);
            return false;
        }
        
        setValidationState(elements.currentPassword, isValid);
        if (!isValid) {
            setFeedback(elements.feedbacks.current, '현재 비밀번호를 정확히 입력해주세요.', false);
        } else {
            setFeedback(elements.feedbacks.current, '', true);
        }
        
        return isValid;
    }

    // 새 비밀번호 검증
    function validateNewPassword() {
        const value = elements.newPassword.value;
        const isValid = PASSWORD_PATTERN.test(value);
        
        if (value === '') {
            clearValidationState(elements.newPassword);
            setFeedback(elements.feedbacks.new, '', true);
            return false;
        }
        
        setValidationState(elements.newPassword, isValid);
        if (!isValid) {
            setFeedback(elements.feedbacks.new, '8-20자의 영문, 숫자, 특수문자를 1개 이상 포함해주세요.', false);
        } else {
            // 현재 비밀번호와 같은지 확인
            if (value === elements.currentPassword.value) {
                setValidationState(elements.newPassword, false);
                setFeedback(elements.feedbacks.new, '현재 비밀번호와 다른 비밀번호를 입력해주세요.', false);
                return false;
            }
            setFeedback(elements.feedbacks.new, '사용 가능한 비밀번호입니다.', true);
        }
        
        return isValid && value !== elements.currentPassword.value;
    }

    // 비밀번호 확인 검증
    function validateConfirmPassword() {
        const newPasswordValue = elements.newPassword.value;
        const confirmValue = elements.confirmPassword.value;
        const isValid = confirmValue !== '' && newPasswordValue === confirmValue;
        
        if (confirmValue === '') {
            clearValidationState(elements.confirmPassword);
            setFeedback(elements.feedbacks.confirm, '', true);
            return false;
        }
        
        setValidationState(elements.confirmPassword, isValid);
        if (!isValid) {
            setFeedback(elements.feedbacks.confirm, '새 비밀번호와 일치하지 않습니다.', false);
        } else {
            setFeedback(elements.feedbacks.confirm, '비밀번호가 일치합니다.', true);
        }
        
        return isValid;
    }

    // 폼 제출 버튼 활성화/비활성화
    function updateSubmitButton() {
        const isCurrentValid = validateCurrentPassword();
        const isNewValid = validateNewPassword();
        const isConfirmValid = validateConfirmPassword();
        
        const isFormValid = isCurrentValid && isNewValid && isConfirmValid;
        
        if (elements.submitButton) {
            elements.submitButton.disabled = !isFormValid;
        }
        
        return isFormValid;
    }

    // 이벤트 리스너 등록
    if (elements.currentPassword) {
        elements.currentPassword.addEventListener('input', function() {
            // 현재 비밀번호가 변경되면 새 비밀번호도 다시 검증
            validateCurrentPassword();
            if (elements.newPassword.value) {
                validateNewPassword();
            }
            updateSubmitButton();
        });
        
        elements.currentPassword.addEventListener('blur', function() {
            validateCurrentPassword();
            updateSubmitButton();
        });
    }

    if (elements.newPassword) {
        elements.newPassword.addEventListener('input', function() {
            validateNewPassword();
            // 새 비밀번호가 변경되면 확인 비밀번호도 다시 검증
            if (elements.confirmPassword.value) {
                validateConfirmPassword();
            }
            updateSubmitButton();
        });
        
        elements.newPassword.addEventListener('blur', function() {
            validateNewPassword();
            updateSubmitButton();
        });
    }

    if (elements.confirmPassword) {
        elements.confirmPassword.addEventListener('input', function() {
            validateConfirmPassword();
            updateSubmitButton();
        });
        
        elements.confirmPassword.addEventListener('blur', function() {
            validateConfirmPassword();
            updateSubmitButton();
        });
    }

    // 폼 제출 이벤트
    if (elements.form) {
        elements.form.addEventListener('submit', function(event) {
            // 최종 유효성 검사
            const isFormValid = updateSubmitButton();
            
            if (!isFormValid) {
                event.preventDefault();
                console.log('폼 유효성 검사 실패');
                
                // 첫 번째 오류 필드에 포커스
                if (!validateCurrentPassword() && elements.currentPassword) {
                    elements.currentPassword.focus();
                } else if (!validateNewPassword() && elements.newPassword) {
                    elements.newPassword.focus();
                } else if (!validateConfirmPassword() && elements.confirmPassword) {
                    elements.confirmPassword.focus();
                }
                
                return false;
            }
            
            // 폼 제출 중 버튼 비활성화
            if (elements.submitButton) {
                elements.submitButton.disabled = true;
                elements.submitButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>변경 중...';
            }
            
            console.log('비밀번호 변경 폼 제출');
            return true;
        });
    }

    // 초기 상태 설정
    updateSubmitButton();
    
    console.log('비밀번호 변경 페이지 JavaScript 초기화 완료');
});
````

## File: src/main/resources/static/js/facility-edit.js
````javascript
// facility-edit.js

// 시설 주소 검색 함수
function searchFacilityAddress() {
    new daum.Postcode({
        oncomplete: function(data) {
            let fullAddr = data.roadAddress || data.jibunAddress;
            
            // 주소 필드 업데이트
            document.getElementById('facilityAddress').value = fullAddr;
            
            // 지도에 위치 표시
            updateMapAndCoordinates(fullAddr);
        }
    }).open();
}

// 지도 업데이트 및 좌표 설정 함수
function updateMapAndCoordinates(address) {
    const geocoder = new kakao.maps.services.Geocoder();
    
    geocoder.addressSearch(address, function(result, status) {
        if (status === kakao.maps.services.Status.OK) {
            const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
            
            // 좌표를 히든 필드에 저장
            document.getElementById('latitude').value = result[0].y;
            document.getElementById('longitude').value = result[0].x;
            
            // 지도 컨테이너 표시
            const mapContainer = document.getElementById('mapPreviewContainer');
            mapContainer.style.display = 'block';
            
            // 지도 초기화
            const mapOption = {
                center: coords,
                level: 3
            };
            
            const map = new kakao.maps.Map(document.getElementById('previewMap'), mapOption);
            
            // 마커 추가
            const marker = new kakao.maps.Marker({
                position: coords
            });
            marker.setMap(map);
            
            // 인포윈도우 추가
            const infowindow = new kakao.maps.InfoWindow({
                content: '<div style="width:150px;text-align:center;padding:6px 0;">선택된 위치</div>'
            });
            infowindow.open(map, marker);
        }
    });
}

// 운영시간 라디오 버튼 처리
function handleOperatingHours() {
    const radio24 = document.getElementById('operating24');
    const radioCustom = document.getElementById('operatingCustom');
    const customInput = document.getElementById('customOperatingHours');
    const hiddenInput = document.getElementById('operatingHours');
    
    function updateOperatingHours() {
        if (radio24.checked) {
            customInput.style.display = 'none';
            hiddenInput.value = '24시간';
        } else if (radioCustom.checked) {
            customInput.style.display = 'block';
            hiddenInput.value = customInput.value || '';
        }
    }
    
    radio24.addEventListener('change', updateOperatingHours);
    radioCustom.addEventListener('change', updateOperatingHours);
    customInput.addEventListener('input', function() {
        if (radioCustom.checked) {
            hiddenInput.value = this.value;
        }
    });
    
    // 초기 상태 설정
    updateOperatingHours();
}

// 전화번호 포맷팅
function formatPhoneNumber(input) {
    let value = input.value.replace(/\D/g, '');
    let formattedValue = '';
    
    if (value.startsWith('02')) {
        // 서울 지역번호
        if (value.length <= 2) {
            formattedValue = value;
        } else if (value.length <= 6) {
            formattedValue = value.slice(0, 2) + '-' + value.slice(2);
        } else if (value.length <= 10) {
            formattedValue = value.slice(0, 2) + '-' + value.slice(2, 6) + '-' + value.slice(6);
        } else {
            formattedValue = value.slice(0, 2) + '-' + value.slice(2, 6) + '-' + value.slice(6, 10);
        }
    } else if (value.startsWith('01')) {
        // 휴대폰 번호
        if (value.length <= 3) {
            formattedValue = value;
        } else if (value.length <= 7) {
            formattedValue = value.slice(0, 3) + '-' + value.slice(3);
        } else if (value.length <= 11) {
            formattedValue = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7);
        } else {
            formattedValue = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
        }
    } else if (value.length >= 3) {
        // 기타 지역번호
        if (value.length <= 3) {
            formattedValue = value;
        } else if (value.length <= 7) {
            formattedValue = value.slice(0, 3) + '-' + value.slice(3);
        } else if (value.length <= 11) {
            formattedValue = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7);
        } else {
            formattedValue = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
        }
    } else {
        formattedValue = value;
    }
    
    input.value = formattedValue;
}

// 폼 유효성 검사
function validateForm() {
    const requiredFields = [
        { id: 'facilityName', name: '시설명' },
        { id: 'facilityType', name: '시설 유형' },
        { id: 'facilityAddress', name: '주소' },
        { id: 'phone', name: '전화번호' }
    ];
    
    for (let field of requiredFields) {
        const element = document.getElementById(field.id);
        if (!element.value.trim()) {
            alert(`${field.name}을(를) 입력해주세요.`);
            element.focus();
            return false;
        }
    }
    
    // 전화번호 패턴 검사
    const phonePattern = /^(02-\d{3,4}-\d{4}|0(3[1-3]|4[1-3]|5[1-5]|6[1-4]|70)-\d{3,4}-\d{4}|01[016-9]-\d{3,4}-\d{4})$/;
    const phone = document.getElementById('phone').value;
    if (!phonePattern.test(phone)) {
        alert('올바른 전화번호 형식이 아닙니다.');
        document.getElementById('phone').focus();
        return false;
    }
    
    return true;
}

// 페이지 로드 완료 후 실행
document.addEventListener('DOMContentLoaded', function() {
    // 운영시간 처리 초기화
    handleOperatingHours();
    
    // 전화번호 입력 포맷팅
    const phoneInput = document.getElementById('phone');
    if (phoneInput) {
        phoneInput.addEventListener('input', function() {
            formatPhoneNumber(this);
        });
    }
    
    // 기존 주소가 있는 경우 지도 표시
    const existingAddress = document.getElementById('facilityAddress').value;
    if (existingAddress) {
        updateMapAndCoordinates(existingAddress);
    }
    
    // 폼 제출 시 유효성 검사
    const form = document.getElementById('facilityEditForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            if (!validateForm()) {
                e.preventDefault();
            }
        });
    }
});
````

## File: src/main/resources/static/js/facility-image-core.js
````javascript
/**
 * 시설 이미지 핵심 모듈 (Core Module)
 * 모든 시설 이미지 모듈의 기반이 되는 핵심 기능 제공
 * 
 * 주요 기능:
 * - 전역 네임스페이스 관리
 * - 상태 관리 시스템
 * - 이벤트 시스템
 * - 모듈 초기화 및 종속성 관리
 * - 공통 유틸리티 함수
 * - 에러 처리 및 로깅
 * - 브라우저 호환성 체크
 * 
 * @version 1.0.0
 * @author LightCare Team
 */

(function() {
    'use strict';
    
    // ================================================
    // 전역 네임스페이스 초기화
    // ================================================
    
    // 메인 네임스페이스 생성 (중복 방지)
    if (typeof window.FacilityImageSystem === 'undefined') {
        window.FacilityImageSystem = {};
    }
    
    // 모듈 네임스페이스 생성
    window.FacilityImageSystem.Core = {};
    
    // ================================================
    // 상수 정의
    // ================================================
    
    const CONSTANTS = {
        VERSION: '1.0.0',
        MODULE_NAME: 'FacilityImageCore',
        
        // 파일 제한
        MAX_FILE_SIZE: 10 * 1024 * 1024, // 10MB
        MAX_IMAGES: 5,
        ALLOWED_TYPES: ['image/jpeg', 'image/png', 'image/webp', 'image/avif'],
        
        // 이미지 크기 제한
        MAX_WIDTH: 1920,
        MAX_HEIGHT: 1200,
        CROP_RATIO: 16/9,
        
        // 품질 설정
        DEFAULT_QUALITY: 0.8,
        WEBP_QUALITY: 0.85,
        
        // 단계 정의
        STEPS: {
            UPLOAD: 1,
            CROP: 2,
            MANAGE: 3
        },
        
        // 상태 정의
        STATUS: {
            IDLE: 'idle',
            LOADING: 'loading',
            PROCESSING: 'processing',
            SUCCESS: 'success',
            ERROR: 'error'
        },
        
        // 이벤트 타입
        EVENTS: {
            INITIALIZED: 'initialized',
            STATE_CHANGED: 'stateChanged',
            STEP_CHANGED: 'stepChanged',
            IMAGE_ADDED: 'imageAdded',
            IMAGE_REMOVED: 'imageRemoved',
            IMAGE_PROCESSED: 'imageProcessed',
            ERROR: 'error',
            SUCCESS: 'success'
        }
    };
    
    // ================================================
    // 전역 상태 관리
    // ================================================
    
    const globalState = {
        // 시스템 상태
        isInitialized: false,
        currentStep: CONSTANTS.STEPS.UPLOAD,
        status: CONSTANTS.STATUS.IDLE,
        
        // 시설 정보
        facilityId: null,
        facilityName: null,
        
        // 이미지 데이터
        originalImages: [],
        processedImages: [],
        uploadedImages: [],
        
        // 현재 작업 상태
        currentImageIndex: 0,
        isProcessing: false,
        
        // 설정
        settings: {
            maxFileSize: CONSTANTS.MAX_FILE_SIZE,
            maxImages: CONSTANTS.MAX_IMAGES,
            allowedTypes: CONSTANTS.ALLOWED_TYPES,
            cropRatio: CONSTANTS.CROP_RATIO,
            quality: CONSTANTS.DEFAULT_QUALITY,
            enableCompression: true,
            enableSEO: true,
            enableAltText: true
        },
        
        // 브라우저 지원 정보
        browserSupport: {
            avif: false,
            webp: false,
            dragDrop: false,
            fileReader: false
        },
        
        // 에러 상태
        errors: [],
        warnings: []
    };
    
    // ================================================
    // 이벤트 시스템
    // ================================================
    
    const eventSystem = {
        listeners: {},
        
        /**
         * 이벤트 리스너 등록
         * @param {string} eventType - 이벤트 타입
         * @param {Function} callback - 콜백 함수
         */
        on(eventType, callback) {
            if (!this.listeners[eventType]) {
                this.listeners[eventType] = [];
            }
            this.listeners[eventType].push(callback);
        },
        
        /**
         * 이벤트 리스너 제거
         * @param {string} eventType - 이벤트 타입
         * @param {Function} callback - 제거할 콜백 함수
         */
        off(eventType, callback) {
            if (!this.listeners[eventType]) return;
            
            this.listeners[eventType] = this.listeners[eventType].filter(
                listener => listener !== callback
            );
        },
        
        /**
         * 이벤트 발생
         * @param {string} eventType - 이벤트 타입
         * @param {*} data - 전달할 데이터
         */
        emit(eventType, data) {
            if (!this.listeners[eventType]) return;
            
            this.listeners[eventType].forEach(callback => {
                try {
                    callback(data);
                } catch (error) {
                    console.error(`이벤트 리스너 오류 (${eventType}):`, error);
                }
            });
        },
        
        /**
         * 모든 이벤트 리스너 제거
         */
        removeAllListeners() {
            this.listeners = {};
        }
    };
    
    // ================================================
    // 로깅 시스템
    // ================================================
    
    const logger = {
        isEnabled: true,
        prefix: '🏢 [FacilityImageCore]',
        
        /**
         * 일반 로그
         * @param {string} message - 메시지
         * @param {*} data - 추가 데이터
         */
        log(message, data = null) {
            if (!this.isEnabled) return;
            
            const timestamp = new Date().toLocaleTimeString();
            console.log(`${this.prefix} [${timestamp}] ${message}`, data || '');
        },
        
        /**
         * 에러 로그
         * @param {string} message - 메시지
         * @param {Error} error - 에러 객체
         */
        error(message, error = null) {
            if (!this.isEnabled) return;
            
            const timestamp = new Date().toLocaleTimeString();
            console.error(`${this.prefix} [${timestamp}] ❌ ${message}`, error || '');
        },
        
        /**
         * 경고 로그
         * @param {string} message - 메시지
         * @param {*} data - 추가 데이터
         */
        warn(message, data = null) {
            if (!this.isEnabled) return;
            
            const timestamp = new Date().toLocaleTimeString();
            console.warn(`${this.prefix} [${timestamp}] ⚠️ ${message}`, data || '');
        },
        
        /**
         * 성공 로그
         * @param {string} message - 메시지
         * @param {*} data - 추가 데이터
         */
        success(message, data = null) {
            if (!this.isEnabled) return;
            
            const timestamp = new Date().toLocaleTimeString();
            console.log(`${this.prefix} [${timestamp}] ✅ ${message}`, data || '');
        },
        
        /**
         * 상태 체크 로그
         */
        checkState() {
            if (!this.isEnabled) return;
            
            this.log('현재 상태 체크', {
                isInitialized: globalState.isInitialized,
                currentStep: globalState.currentStep,
                status: globalState.status,
                facilityId: globalState.facilityId,
                imagesCount: globalState.originalImages.length,
                isProcessing: globalState.isProcessing
            });
        }
    };
    
    // ================================================
    // 상태 관리 함수
    // ================================================
    
    const stateManager = {
        /**
         * 상태 업데이트 (불변성 보장)
         * @param {Object} updates - 업데이트할 상태
         * @returns {Object} 새로운 상태
         */
        updateState(updates) {
            const oldState = { ...globalState };
            Object.assign(globalState, updates);
            
            // 상태 변경 이벤트 발생
            eventSystem.emit(CONSTANTS.EVENTS.STATE_CHANGED, {
                oldState,
                newState: globalState,
                changes: updates
            });
            
            logger.log('상태 업데이트', updates);
            return globalState;
        },
        
        /**
         * 현재 상태 반환
         * @returns {Object} 현재 상태
         */
        getState() {
            return { ...globalState };
        },
        
        /**
         * 상태 초기화
         */
        resetState() {
            const initialState = {
                isInitialized: false,
                currentStep: CONSTANTS.STEPS.UPLOAD,
                status: CONSTANTS.STATUS.IDLE,
                facilityId: null,
                facilityName: null,
                originalImages: [],
                processedImages: [],
                uploadedImages: [],
                currentImageIndex: 0,
                isProcessing: false,
                errors: [],
                warnings: []
            };
            
            this.updateState(initialState);
            logger.log('상태 초기화 완료');
        },
        
        /**
         * 단계 변경
         * @param {number} step - 변경할 단계
         */
        changeStep(step) {
            if (step < 1 || step > 3) {
                logger.error('잘못된 단계 번호:', step);
                return;
            }
            
            const oldStep = globalState.currentStep;
            this.updateState({ currentStep: step });
            
            // 단계 변경 이벤트 발생
            eventSystem.emit(CONSTANTS.EVENTS.STEP_CHANGED, {
                oldStep,
                newStep: step
            });
            
            logger.log(`단계 변경: ${oldStep} → ${step}`);
        },
        
        /**
         * 에러 추가
         * @param {string} message - 에러 메시지
         * @param {Error} error - 에러 객체
         */
        addError(message, error = null) {
            const errorObj = {
                message,
                error: error ? error.message : null,
                timestamp: new Date().toISOString(),
                stack: error ? error.stack : null
            };
            
            globalState.errors.push(errorObj);
            this.updateState({ status: CONSTANTS.STATUS.ERROR });
            
            eventSystem.emit(CONSTANTS.EVENTS.ERROR, errorObj);
            logger.error(message, error);
        },
        
        /**
         * 경고 추가
         * @param {string} message - 경고 메시지
         */
        addWarning(message) {
            const warningObj = {
                message,
                timestamp: new Date().toISOString()
            };
            
            globalState.warnings.push(warningObj);
            logger.warn(message);
        }
    };
    
    // ================================================
    // 브라우저 호환성 체크
    // ================================================
    
    const browserSupport = {
        /**
         * 브라우저 지원 기능 체크
         */
        async checkSupport() {
            logger.log('브라우저 지원 기능 체크 시작');
            
            const support = {
                avif: await this.checkImageFormat('avif'),
                webp: await this.checkImageFormat('webp'),
                dragDrop: this.checkDragDropSupport(),
                fileReader: this.checkFileReaderSupport()
            };
            
            stateManager.updateState({ browserSupport: support });
            logger.log('브라우저 지원 기능 체크 완료', support);
            
            return support;
        },
        
        /**
         * 이미지 포맷 지원 체크
         * @param {string} format - 체크할 포맷 (webp, avif)
         * @returns {Promise<boolean>} 지원 여부
         */
        checkImageFormat(format) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                canvas.width = 1;
                canvas.height = 1;
                
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.fillRect(0, 0, 1, 1);
                
                const dataURL = canvas.toDataURL(`image/${format}`);
                const supported = dataURL.indexOf(`data:image/${format}`) === 0;
                
                resolve(supported);
            });
        },
        
        /**
         * 드래그 앤 드롭 지원 체크
         * @returns {boolean} 지원 여부
         */
        checkDragDropSupport() {
            const div = document.createElement('div');
            return (('draggable' in div) || ('ondragstart' in div && 'ondrop' in div)) && 
                   'FormData' in window && 'FileReader' in window;
        },
        
        /**
         * FileReader 지원 체크
         * @returns {boolean} 지원 여부
         */
        checkFileReaderSupport() {
            return 'FileReader' in window;
        }
    };
    
    // ================================================
    // 유틸리티 함수
    // ================================================
    
    const utils = {
        /**
         * 시설 ID 추출
         * @returns {number|null} 시설 ID
         */
        extractFacilityId() {
            let facilityId = null;
            
            try {
                // 1. URL 경로에서 추출
                const pathParts = window.location.pathname.split('/');
                const lastPart = pathParts[pathParts.length - 1];
                if (!isNaN(lastPart) && lastPart !== '') {
                    facilityId = parseInt(lastPart);
                }
                
                // 2. 메타 태그에서 추출
                if (!facilityId) {
                    const metaTag = document.querySelector('meta[name="facility-id"]');
                    if (metaTag) {
                        facilityId = parseInt(metaTag.getAttribute('content'));
                    }
                }
                
                // 3. 히든 인풋에서 추출
                if (!facilityId) {
                    const hiddenInput = document.querySelector('input[name="facilityId"]');
                    if (hiddenInput) {
                        facilityId = parseInt(hiddenInput.value);
                    }
                }
                
                // 4. 데이터 속성에서 추출
                if (!facilityId) {
                    const container = document.querySelector('[data-facility-id]');
                    if (container) {
                        facilityId = parseInt(container.dataset.facilityId);
                    }
                }
                
            } catch (error) {
                logger.error('시설 ID 추출 중 오류:', error);
            }
            
            return facilityId;
        },
        
        /**
         * 파일 크기 포맷팅
         * @param {number} bytes - 바이트
         * @returns {string} 포맷된 크기
         */
        formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        },
        
        /**
         * 파일 유형 검증
         * @param {File} file - 검증할 파일
         * @returns {boolean} 유효한 파일인지 여부
         */
        validateFileType(file) {
            return CONSTANTS.ALLOWED_TYPES.includes(file.type);
        },
        
        /**
         * 파일 크기 검증
         * @param {File} file - 검증할 파일
         * @returns {boolean} 유효한 크기인지 여부
         */
        validateFileSize(file) {
            return file.size <= CONSTANTS.MAX_FILE_SIZE;
        },
        
        /**
         * 고유 ID 생성
         * @returns {string} 고유 ID
         */
        generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        },
        
        /**
         * 디바운스 함수
         * @param {Function} func - 실행할 함수
         * @param {number} wait - 대기 시간 (ms)
         * @returns {Function} 디바운스된 함수
         */
        debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        },
        
        /**
         * 스로틀 함수
         * @param {Function} func - 실행할 함수
         * @param {number} limit - 제한 시간 (ms)
         * @returns {Function} 스로틀된 함수
         */
        throttle(func, limit) {
            let inThrottle;
            return function(...args) {
                if (!inThrottle) {
                    func.apply(this, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }
    };
    
    // ================================================
    // 초기화 함수
    // ================================================
    
    const core = {
        /**
         * 핵심 모듈 초기화
         * @param {Object} options - 초기화 옵션
         * @returns {Promise<boolean>} 초기화 성공 여부
         */
        async initialize(options = {}) {
            if (globalState.isInitialized) {
                logger.warn('이미 초기화됨 - 중복 초기화 방지');
                return true;
            }
            
            logger.log('핵심 모듈 초기화 시작');
            
            try {
                // 설정 병합
                if (options.settings) {
                    Object.assign(globalState.settings, options.settings);
                }
                
                // 시설 ID 추출
                const facilityId = utils.extractFacilityId();
                if (!facilityId) {
                    throw new Error('시설 ID를 찾을 수 없습니다.');
                }
                
                // 브라우저 지원 체크
                await browserSupport.checkSupport();
                
                // 상태 업데이트
                stateManager.updateState({
                    isInitialized: true,
                    facilityId: facilityId,
                    status: CONSTANTS.STATUS.IDLE
                });
                
                // 초기화 완료 이벤트 발생
                eventSystem.emit(CONSTANTS.EVENTS.INITIALIZED, {
                    facilityId,
                    settings: globalState.settings,
                    browserSupport: globalState.browserSupport
                });
                
                logger.success('핵심 모듈 초기화 완료', {
                    facilityId,
                    version: CONSTANTS.VERSION
                });
                
                return true;
                
            } catch (error) {
                stateManager.addError('핵심 모듈 초기화 실패', error);
                return false;
            }
        },
        
        /**
         * 핵심 모듈 종료
         */
        destroy() {
            logger.log('핵심 모듈 종료');
            
            // 이벤트 리스너 제거
            eventSystem.removeAllListeners();
            
            // 상태 초기화
            stateManager.resetState();
            
            logger.success('핵심 모듈 종료 완료');
        },
        
        /**
         * 모듈 정보 반환
         * @returns {Object} 모듈 정보
         */
        getInfo() {
            return {
                name: CONSTANTS.MODULE_NAME,
                version: CONSTANTS.VERSION,
                isInitialized: globalState.isInitialized,
                facilityId: globalState.facilityId,
                currentStep: globalState.currentStep,
                status: globalState.status
            };
        }
    };
    
    // ================================================
    // 모듈 노출
    // ================================================
    
    // Core 모듈 API 노출
    window.FacilityImageSystem.Core = {
        // 상수
        CONSTANTS,
        
        // 시스템
        core,
        stateManager,
        eventSystem,
        logger,
        utils,
        browserSupport,
        
        // 편의 함수
        initialize: core.initialize.bind(core),
        destroy: core.destroy.bind(core),
        getState: stateManager.getState.bind(stateManager),
        updateState: stateManager.updateState.bind(stateManager),
        on: eventSystem.on.bind(eventSystem),
        off: eventSystem.off.bind(eventSystem),
        emit: eventSystem.emit.bind(eventSystem)
    };
    
    // 전역 접근을 위한 단축 참조
    window.FacilityImageCore = window.FacilityImageSystem.Core;
    
    logger.log('핵심 모듈 로드 완료');
    
})();
````

## File: src/main/resources/static/js/facility-image-cropper-module.js
````javascript
/**
 * 시설 이미지 크롭 모듈 (Cropper Module)
 * 이미지 크롭 기능에 특화된 모듈
 * 
 * 주요 기능:
 * - Cropper.js 기반 이미지 크롭
 * - 16:9 비율 자동 크롭
 * - 실시간 미리보기
 * - 줌 컨트롤 및 스마트 스크롤
 * - 키보드 단축키 지원
 * - 크롭 데이터 검증 및 저장
 * - 이미지 품질 최적화
 * 
 * @version 1.0.0
 * @author LightCare Team
 * @requires FacilityImageCore
 * @requires Cropper.js
 */

(function() {
    'use strict';
    
    // Core 모듈 의존성 체크
    if (!window.FacilityImageCore) {
        throw new Error('FacilityImageCore 모듈이 필요합니다.');
    }
    
    const Core = window.FacilityImageCore;
    
    // ================================================
    // 모듈 네임스페이스 생성
    // ================================================
    
    if (!window.FacilityImageSystem.Cropper) {
        window.FacilityImageSystem.Cropper = {};
    }
    
    // ================================================
    // 상수 정의
    // ================================================
    
    const CROPPER_CONSTANTS = {
        MODULE_NAME: 'FacilityImageCropper',
        VERSION: '1.0.0',
        
        // 크롭 설정
        ASPECT_RATIO: 16/9,
        VIEW_MODE: 1,
        CROP_BOX_MOVABLE: true,
        CROP_BOX_RESIZABLE: true,
        TOGGLEABLE: false,
        ZOOMABLE: true,
        SCALABLE: true,
        ROTATABLE: false,
        
        // 줌 설정
        MIN_ZOOM: 0.1,
        MAX_ZOOM: 3.0,
        ZOOM_STEP: 0.1,
        ZOOM_THRESHOLD_MIN: 0.2,
        ZOOM_THRESHOLD_MAX: 2.8,
        
        // 키보드 단축키
        KEYBOARD_SHORTCUTS: {
            ZOOM_IN: 'Equal',        // + 키
            ZOOM_OUT: 'Minus',       // - 키
            RESET: 'KeyR',           // R 키
            MOVE_LEFT: 'ArrowLeft',  // ← 키
            MOVE_RIGHT: 'ArrowRight',// → 키
            MOVE_UP: 'ArrowUp',      // ↑ 키
            MOVE_DOWN: 'ArrowDown',  // ↓ 키
            SAVE: 'KeyS',            // S 키 (Ctrl+S)
            NEXT: 'KeyN'             // N 키 (다음 이미지)
        },
        
        // 크롭 품질 설정
        OUTPUT_OPTIONS: {
            format: 'image/jpeg',
            quality: 0.85,
            maxWidth: 1920,
            maxHeight: 1080,
            fillColor: '#ffffff'
        }
    };
    
    // ================================================
    // 크롭퍼 상태 관리
    // ================================================
    
    const cropperState = {
        // 크롭퍼 인스턴스
        instance: null,
        
        // 현재 이미지 정보
        currentImage: null,
        currentImageIndex: 0,
        
        // 크롭 데이터
        cropData: null,
        
        // UI 요소
        elements: {
            container: null,
            image: null,
            canvas: null,
            zoomIndicator: null,
            zoomLevel: null,
            controls: {}
        },
        
        // 상태 플래그
        isInitialized: false,
        isCropping: false,
        isProcessing: false,
        
        // 스마트 스크롤 유틸리티
        smartScroll: null,
        
        // 설정
        settings: {
            aspectRatio: CROPPER_CONSTANTS.ASPECT_RATIO,
            viewMode: CROPPER_CONSTANTS.VIEW_MODE,
            ...CROPPER_CONSTANTS.OUTPUT_OPTIONS
        }
    };
    
    // ================================================
    // DOM 요소 관리
    // ================================================
    
    const domManager = {
        /**
         * DOM 요소 초기화
         * @returns {boolean} 초기화 성공 여부
         */
        initializeElements() {
            const elements = {
                container: document.querySelector('.crop-image-container, #cropImageContainer'),
                image: document.querySelector('#cropImage'),
                canvas: document.querySelector('#previewCanvas'),
                zoomIndicator: document.querySelector('#zoomIndicator'),
                zoomLevel: document.querySelector('#zoomLevel'),
                controls: {
                    zoomIn: document.querySelector('#zoomInBtn, .zoom-in-btn'),
                    zoomOut: document.querySelector('#zoomOutBtn, .zoom-out-btn'),
                    reset: document.querySelector('#resetZoomBtn, .reset-btn'),
                    save: document.querySelector('#saveCurrentAndGoNext, .save-btn'),
                    next: document.querySelector('#nextImageBtn, .next-btn'),
                    prev: document.querySelector('#prevImageBtn, .prev-btn')
                }
            };
            
            cropperState.elements = elements;
            
            // 필수 요소 체크
            if (!elements.image) {
                Core.logger.error('크롭 이미지 요소를 찾을 수 없습니다.');
                return false;
            }
            
            // 동적 요소 생성
            this.createMissingElements();
            
            Core.logger.log('DOM 요소 초기화 완료', {
                hasContainer: !!elements.container,
                hasImage: !!elements.image,
                hasCanvas: !!elements.canvas
            });
            
            return true;
        },
        
        /**
         * 누락된 요소 동적 생성
         */
        createMissingElements() {
            const elements = cropperState.elements;
            
            // 줌 표시기 생성
            if (!elements.zoomIndicator) {
                elements.zoomIndicator = this.createZoomIndicator();
            }
            
            // 미리보기 캔버스 생성
            if (!elements.canvas) {
                elements.canvas = this.createPreviewCanvas();
            }
            
            // 컨트롤 버튼 생성
            this.createMissingControls();
        },
        
        /**
         * 줌 표시기 생성
         * @returns {HTMLElement} 줌 표시기 요소
         */
        createZoomIndicator() {
            const indicator = document.createElement('div');
            indicator.id = 'zoomIndicator';
            indicator.className = 'zoom-indicator position-fixed';
            indicator.style.cssText = `
                top: 20px; 
                right: 20px; 
                z-index: 1000; 
                background: rgba(0,0,0,0.8); 
                color: white; 
                padding: 8px 12px; 
                border-radius: 6px; 
                font-size: 12px;
                display: none;
                transition: opacity 0.3s ease;
            `;
            
            indicator.innerHTML = `
                <i class="fas fa-search me-1"></i>
                <span id="zoomLevel">100%</span>
                <span id="zoomStatus" class="ms-2"></span>
            `;
            
            document.body.appendChild(indicator);
            cropperState.elements.zoomLevel = indicator.querySelector('#zoomLevel');
            
            return indicator;
        },
        
        /**
         * 미리보기 캔버스 생성
         * @returns {HTMLCanvasElement} 캔버스 요소
         */
        createPreviewCanvas() {
            const canvas = document.createElement('canvas');
            canvas.id = 'previewCanvas';
            canvas.width = 320;
            canvas.height = 180;
            canvas.style.cssText = `
                width: 100%; 
                height: 100%; 
                border: 1px solid #dee2e6; 
                border-radius: 4px;
                background: #f8f9fa;
            `;
            
            // 미리보기 컨테이너 찾기
            const previewContainer = document.querySelector('.crop-preview-panel, .preview-container');
            if (previewContainer) {
                previewContainer.appendChild(canvas);
            }
            
            return canvas;
        },
        
        /**
         * 누락된 컨트롤 버튼 생성
         */
        createMissingControls() {
            const controls = cropperState.elements.controls;
            
            // 줌 컨트롤이 없는 경우 생성
            if (!controls.zoomIn || !controls.zoomOut || !controls.reset) {
                this.createZoomControls();
            }
        },
        
        /**
         * 줌 컨트롤 생성
         */
        createZoomControls() {
            const controlsHtml = `
                <div class="crop-controls mt-3">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="zoomInBtn">
                            <i class="fas fa-search-plus me-1"></i>확대
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="zoomOutBtn">
                            <i class="fas fa-search-minus me-1"></i>축소
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="resetZoomBtn">
                            <i class="fas fa-undo me-1"></i>초기화
                        </button>
                    </div>
                </div>
            `;
            
            const container = cropperState.elements.container;
            if (container) {
                container.insertAdjacentHTML('beforeend', controlsHtml);
                
                // 참조 업데이트
                const controls = cropperState.elements.controls;
                controls.zoomIn = document.getElementById('zoomInBtn');
                controls.zoomOut = document.getElementById('zoomOutBtn');
                controls.reset = document.getElementById('resetZoomBtn');
            }
        }
    };
    
    // ================================================
    // 크롭퍼 인스턴스 관리
    // ================================================
    
    const cropperInstance = {
        /**
         * 크롭퍼 인스턴스 생성
         * @param {HTMLImageElement} imageElement - 이미지 요소
         * @param {Object} options - 크롭퍼 옵션
         * @returns {Object} 크롭퍼 인스턴스
         */
        create(imageElement, options = {}) {
            if (!imageElement) {
                throw new Error('이미지 요소가 필요합니다.');
            }
            
            const defaultOptions = {
                aspectRatio: cropperState.settings.aspectRatio,
                viewMode: CROPPER_CONSTANTS.VIEW_MODE,
                dragMode: 'move',
                cropBoxMovable: CROPPER_CONSTANTS.CROP_BOX_MOVABLE,
                cropBoxResizable: CROPPER_CONSTANTS.CROP_BOX_RESIZABLE,
                toggleDragModeOnDblclick: false,
                zoomable: CROPPER_CONSTANTS.ZOOMABLE,
                scalable: CROPPER_CONSTANTS.SCALABLE,
                rotatable: CROPPER_CONSTANTS.ROTATABLE,
                checkOrientation: false,
                modal: true,
                guides: true,
                center: true,
                highlight: true,
                background: true,
                autoCrop: true,
                autoCropArea: 0.8,
                movable: true,
                responsive: true,
                restore: true,
                checkCrossOrigin: true,
                minContainerWidth: 320,
                minContainerHeight: 180,
                minCanvasWidth: 0,
                minCanvasHeight: 0,
                minCropBoxWidth: 0,
                minCropBoxHeight: 0,
                
                // 이벤트 핸들러
                ready: this.onReady.bind(this),
                cropstart: this.onCropStart.bind(this),
                cropmove: this.onCropMove.bind(this),
                cropend: this.onCropEnd.bind(this),
                crop: this.onCrop.bind(this),
                zoom: this.onZoom.bind(this)
            };
            
            const cropperOptions = { ...defaultOptions, ...options };
            
            try {
                // 기존 인스턴스 제거
                this.destroy();
                
                // 새 인스턴스 생성
                cropperState.instance = new Cropper(imageElement, cropperOptions);
                
                Core.logger.log('크롭퍼 인스턴스 생성 완료');
                return cropperState.instance;
                
            } catch (error) {
                Core.logger.error('크롭퍼 인스턴스 생성 실패:', error);
                throw error;
            }
        },
        
        /**
         * 크롭퍼 인스턴스 제거
         */
        destroy() {
            if (cropperState.instance) {
                cropperState.instance.destroy();
                cropperState.instance = null;
                Core.logger.log('크롭퍼 인스턴스 제거 완료');
            }
        },
        
        /**
         * 크롭퍼 준비 완료 이벤트
         */
        onReady() {
            cropperState.isInitialized = true;
            
            // 스마트 스크롤 초기화
            if (window.SmartScrollUtility) {
                cropperState.smartScroll = new SmartScrollUtility(cropperState.instance);
            }
            
            // 미리보기 업데이트
            this.updatePreview();
            
            Core.emit(Core.CONSTANTS.EVENTS.SUCCESS, {
                type: 'cropper_ready',
                message: '크롭퍼 준비 완료'
            });
            
            Core.logger.success('크롭퍼 준비 완료');
        },
        
        /**
         * 크롭 시작 이벤트
         */
        onCropStart() {
            cropperState.isCropping = true;
            this.showZoomIndicator();
        },
        
        /**
         * 크롭 이동 이벤트
         */
        onCropMove() {
            this.updatePreview();
        },
        
        /**
         * 크롭 종료 이벤트
         */
        onCropEnd() {
            cropperState.isCropping = false;
            this.hideZoomIndicator();
            this.updatePreview();
        },
        
        /**
         * 크롭 데이터 변경 이벤트
         * @param {Object} event - 크롭 이벤트
         */
        onCrop(event) {
            cropperState.cropData = event.detail;
            this.updatePreview();
        },
        
        /**
         * 줌 변경 이벤트
         * @param {Object} event - 줌 이벤트
         */
        onZoom(event) {
            const ratio = event.detail.ratio;
            this.updateZoomIndicator(ratio);
            this.updatePreview();
        },
        
        /**
         * 줌 표시기 업데이트
         * @param {number} ratio - 줌 비율
         */
        updateZoomIndicator(ratio) {
            const zoomLevel = cropperState.elements.zoomLevel;
            if (zoomLevel) {
                zoomLevel.textContent = Math.round(ratio * 100) + '%';
            }
            
            this.showZoomIndicator();
        },
        
        /**
         * 줌 표시기 표시
         */
        showZoomIndicator() {
            const indicator = cropperState.elements.zoomIndicator;
            if (indicator) {
                indicator.style.display = 'block';
                indicator.style.opacity = '1';
                
                // 3초 후 자동 숨김
                clearTimeout(this.zoomIndicatorTimeout);
                this.zoomIndicatorTimeout = setTimeout(() => {
                    this.hideZoomIndicator();
                }, 3000);
            }
        },
        
        /**
         * 줌 표시기 숨김
         */
        hideZoomIndicator() {
            const indicator = cropperState.elements.zoomIndicator;
            if (indicator) {
                indicator.style.opacity = '0';
                setTimeout(() => {
                    indicator.style.display = 'none';
                }, 300);
            }
        },
        
        /**
         * 미리보기 업데이트
         */
        updatePreview() {
            if (!cropperState.instance || !cropperState.elements.canvas) return;
            
            try {
                const canvas = cropperState.elements.canvas;
                const croppedCanvas = cropperState.instance.getCroppedCanvas({
                    width: canvas.width,
                    height: canvas.height,
                    fillColor: cropperState.settings.fillColor
                });
                
                if (croppedCanvas) {
                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(croppedCanvas, 0, 0, canvas.width, canvas.height);
                }
                
            } catch (error) {
                Core.logger.error('미리보기 업데이트 실패:', error);
            }
        }
    };
    
    // ================================================
    // 크롭 컨트롤 관리
    // ================================================
    
    const cropperControls = {
        /**
         * 컨트롤 이벤트 설정
         */
        setupControls() {
            const controls = cropperState.elements.controls;
            
            // 줌 컨트롤
            if (controls.zoomIn) {
                controls.zoomIn.addEventListener('click', () => this.zoomIn());
            }
            if (controls.zoomOut) {
                controls.zoomOut.addEventListener('click', () => this.zoomOut());
            }
            if (controls.reset) {
                controls.reset.addEventListener('click', () => this.reset());
            }
            
            // 네비게이션 컨트롤
            if (controls.next) {
                controls.next.addEventListener('click', () => this.nextImage());
            }
            if (controls.prev) {
                controls.prev.addEventListener('click', () => this.prevImage());
            }
            
            // 저장 컨트롤
            if (controls.save) {
                controls.save.addEventListener('click', () => this.saveCrop());
            }
            
            // 키보드 단축키
            this.setupKeyboardShortcuts();
            
            Core.logger.log('크롭 컨트롤 설정 완료');
        },
        
        /**
         * 키보드 단축키 설정
         */
        setupKeyboardShortcuts() {
            document.addEventListener('keydown', (event) => {
                if (!cropperState.isInitialized) return;
                
                // 텍스트 입력 중일 때는 무시
                if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
                    return;
                }
                
                const shortcuts = CROPPER_CONSTANTS.KEYBOARD_SHORTCUTS;
                
                switch (event.code) {
                    case shortcuts.ZOOM_IN:
                        event.preventDefault();
                        this.zoomIn();
                        break;
                    case shortcuts.ZOOM_OUT:
                        event.preventDefault();
                        this.zoomOut();
                        break;
                    case shortcuts.RESET:
                        event.preventDefault();
                        this.reset();
                        break;
                    case shortcuts.MOVE_LEFT:
                        event.preventDefault();
                        this.moveLeft();
                        break;
                    case shortcuts.MOVE_RIGHT:
                        event.preventDefault();
                        this.moveRight();
                        break;
                    case shortcuts.MOVE_UP:
                        event.preventDefault();
                        this.moveUp();
                        break;
                    case shortcuts.MOVE_DOWN:
                        event.preventDefault();
                        this.moveDown();
                        break;
                    case shortcuts.SAVE:
                        if (event.ctrlKey) {
                            event.preventDefault();
                            this.saveCrop();
                        }
                        break;
                    case shortcuts.NEXT:
                        event.preventDefault();
                        this.nextImage();
                        break;
                }
            });
        },
        
        /**
         * 확대
         */
        zoomIn() {
            if (cropperState.instance) {
                cropperState.instance.zoom(CROPPER_CONSTANTS.ZOOM_STEP);
                Core.logger.log('이미지 확대');
            }
        },
        
        /**
         * 축소
         */
        zoomOut() {
            if (cropperState.instance) {
                cropperState.instance.zoom(-CROPPER_CONSTANTS.ZOOM_STEP);
                Core.logger.log('이미지 축소');
            }
        },
        
        /**
         * 초기화
         */
        reset() {
            if (cropperState.instance) {
                cropperState.instance.reset();
                Core.logger.log('크롭퍼 초기화');
            }
        },
        
        /**
         * 왼쪽 이동
         */
        moveLeft() {
            if (cropperState.instance) {
                cropperState.instance.move(-10, 0);
            }
        },
        
        /**
         * 오른쪽 이동
         */
        moveRight() {
            if (cropperState.instance) {
                cropperState.instance.move(10, 0);
            }
        },
        
        /**
         * 위쪽 이동
         */
        moveUp() {
            if (cropperState.instance) {
                cropperState.instance.move(0, -10);
            }
        },
        
        /**
         * 아래쪽 이동
         */
        moveDown() {
            if (cropperState.instance) {
                cropperState.instance.move(0, 10);
            }
        },
        
        /**
         * 다음 이미지
         */
        nextImage() {
            Core.emit('nextImage');
        },
        
        /**
         * 이전 이미지
         */
        prevImage() {
            Core.emit('prevImage');
        },
        
        /**
         * 크롭 저장
         */
        saveCrop() {
            if (!cropperState.instance) return;
            
            try {
                const croppedCanvas = cropperState.instance.getCroppedCanvas({
                    width: cropperState.settings.maxWidth,
                    height: cropperState.settings.maxHeight,
                    fillColor: cropperState.settings.fillColor
                });
                
                if (croppedCanvas) {
                    croppedCanvas.toBlob((blob) => {
                        Core.emit('imageCropped', {
                            blob: blob,
                            index: cropperState.currentImageIndex,
                            cropData: cropperState.cropData
                        });
                    }, cropperState.settings.format, cropperState.settings.quality);
                }
                
            } catch (error) {
                Core.logger.error('크롭 저장 실패:', error);
            }
        }
    };
    
    // ================================================
    // 메인 크롭퍼 객체
    // ================================================
    
    const cropper = {
        /**
         * 크롭퍼 모듈 초기화
         * @param {Object} options - 초기화 옵션
         * @returns {Promise<boolean>} 초기화 성공 여부
         */
        async initialize(options = {}) {
            if (cropperState.isInitialized) {
                Core.logger.warn('크롭퍼 모듈이 이미 초기화됨');
                return true;
            }
            
            Core.logger.log('크롭퍼 모듈 초기화 시작');
            
            try {
                // 설정 병합
                if (options.settings) {
                    Object.assign(cropperState.settings, options.settings);
                }
                
                // DOM 요소 초기화
                if (!domManager.initializeElements()) {
                    throw new Error('DOM 요소 초기화 실패');
                }
                
                // 컨트롤 설정
                cropperControls.setupControls();
                
                Core.logger.success('크롭퍼 모듈 초기화 완료');
                return true;
                
            } catch (error) {
                Core.logger.error('크롭퍼 모듈 초기화 실패:', error);
                return false;
            }
        },
        
        /**
         * 이미지 로드
         * @param {string|File} image - 이미지 URL 또는 파일
         * @param {number} index - 이미지 인덱스
         * @returns {Promise<boolean>} 로드 성공 여부
         */
        async loadImage(image, index = 0) {
            if (!cropperState.elements.image) {
                throw new Error('이미지 요소가 없습니다.');
            }
            
            Core.logger.log(`이미지 로드 시작: ${index}`);
            
            try {
                cropperState.currentImageIndex = index;
                cropperState.isProcessing = true;
                
                // 이미지 소스 설정
                if (typeof image === 'string') {
                    cropperState.elements.image.src = image;
                } else if (image instanceof File) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        cropperState.elements.image.src = e.target.result;
                    };
                    reader.readAsDataURL(image);
                } else {
                    throw new Error('지원하지 않는 이미지 형식입니다.');
                }
                
                // 이미지 로드 완료 대기
                await new Promise((resolve, reject) => {
                    cropperState.elements.image.onload = () => {
                        // 크롭퍼 인스턴스 생성
                        cropperInstance.create(cropperState.elements.image);
                        cropperState.currentImage = image;
                        cropperState.isProcessing = false;
                        resolve();
                    };
                    
                    cropperState.elements.image.onerror = () => {
                        cropperState.isProcessing = false;
                        reject(new Error('이미지 로드 실패'));
                    };
                });
                
                Core.logger.success(`이미지 로드 완료: ${index}`);
                return true;
                
            } catch (error) {
                cropperState.isProcessing = false;
                Core.logger.error('이미지 로드 실패:', error);
                throw error;
            }
        },
        
        /**
         * 크롭 데이터 가져오기
         * @returns {Object} 크롭 데이터
         */
        getCropData() {
            if (!cropperState.instance) {
                return null;
            }
            
            return {
                cropBoxData: cropperState.instance.getCropBoxData(),
                canvasData: cropperState.instance.getCanvasData(),
                imageData: cropperState.instance.getImageData()
            };
        },
        
        /**
         * 크롭된 캔버스 가져오기
         * @param {Object} options - 캔버스 옵션
         * @returns {HTMLCanvasElement} 크롭된 캔버스
         */
        getCroppedCanvas(options = {}) {
            if (!cropperState.instance) {
                return null;
            }
            
            const defaultOptions = {
                width: cropperState.settings.maxWidth,
                height: cropperState.settings.maxHeight,
                fillColor: cropperState.settings.fillColor
            };
            
            return cropperState.instance.getCroppedCanvas({ ...defaultOptions, ...options });
        },
        
        /**
         * 크롭된 이미지 Blob 가져오기
         * @param {Object} options - 이미지 옵션
         * @returns {Promise<Blob>} 크롭된 이미지 Blob
         */
        async getCroppedBlob(options = {}) {
            const canvas = this.getCroppedCanvas(options);
            if (!canvas) {
                throw new Error('크롭된 캔버스를 가져올 수 없습니다.');
            }
            
            return new Promise((resolve, reject) => {
                canvas.toBlob((blob) => {
                    if (blob) {
                        resolve(blob);
                    } else {
                        reject(new Error('Blob 생성 실패'));
                    }
                }, cropperState.settings.format, cropperState.settings.quality);
            });
        },
        
        /**
         * 크롭퍼 제거
         */
        destroy() {
            cropperInstance.destroy();
            
            if (cropperState.smartScroll) {
                cropperState.smartScroll.destroy();
                cropperState.smartScroll = null;
            }
            
            // 상태 초기화
            cropperState.isInitialized = false;
            cropperState.currentImage = null;
            cropperState.currentImageIndex = 0;
            cropperState.cropData = null;
            cropperState.isCropping = false;
            cropperState.isProcessing = false;
            
            Core.logger.log('크롭퍼 모듈 제거 완료');
        },
        
        /**
         * 모듈 정보 반환
         * @returns {Object} 모듈 정보
         */
        getInfo() {
            return {
                name: CROPPER_CONSTANTS.MODULE_NAME,
                version: CROPPER_CONSTANTS.VERSION,
                isInitialized: cropperState.isInitialized,
                currentImageIndex: cropperState.currentImageIndex,
                isProcessing: cropperState.isProcessing,
                settings: cropperState.settings
            };
        }
    };
    
    // ================================================
    // 모듈 노출
    // ================================================
    
    // Cropper 모듈 API 노출
    window.FacilityImageSystem.Cropper = {
        // 상수
        CONSTANTS: CROPPER_CONSTANTS,
        
        // 메인 객체
        cropper,
        
        // 내부 객체 (고급 사용자용)
        cropperInstance,
        cropperControls,
        domManager,
        
        // 상태 (읽기 전용)
        getState: () => ({ ...cropperState }),
        
        // 편의 함수
        initialize: cropper.initialize.bind(cropper),
        loadImage: cropper.loadImage.bind(cropper),
        getCropData: cropper.getCropData.bind(cropper),
        getCroppedCanvas: cropper.getCroppedCanvas.bind(cropper),
        getCroppedBlob: cropper.getCroppedBlob.bind(cropper),
        destroy: cropper.destroy.bind(cropper)
    };
    
    // 전역 접근을 위한 단축 참조
    window.FacilityImageCropper = window.FacilityImageSystem.Cropper;
    
    Core.logger.log('크롭퍼 모듈 로드 완료');
    
})();
````

## File: src/main/resources/static/js/facility-image-data-module.js
````javascript
/**
 * 시설 이미지 데이터 모듈 (Data Module)
 * 서버 통신, 데이터 관리, API 호출 전용 모듈
 * 
 * @version 1.0.0
 * @author LightCare Team
 * @requires FacilityImageCore
 */

(function() {
    'use strict';
    
    if (!window.FacilityImageCore) {
        throw new Error('FacilityImageCore 모듈이 필요합니다.');
    }
    
    const Core = window.FacilityImageCore;
    
    if (!window.FacilityImageSystem.Data) {
        window.FacilityImageSystem.Data = {};
    }
    
    // ================================================
    // 상수 정의
    // ================================================
    
    const DATA_CONSTANTS = {
        MODULE_NAME: 'FacilityImageData',
        VERSION: '1.0.0',
        
        API_ENDPOINTS: {
            UPLOAD: '/facility/facility-images/upload',
            DELETE: '/facility/facility-images/delete',
            REORDER: '/facility/facility-images/reorder',
            GET_IMAGES: '/facility/facility-images',
            SET_MAIN: '/facility/facility-images/main'
        },
        
        REQUEST_TIMEOUT: 30000,
        RETRY_ATTEMPTS: 3,
        RETRY_DELAY: 1000
    };
    
    // ================================================
    // 데이터 상태 관리
    // ================================================
    
    const dataState = {
        isInitialized: false,
        facilityId: null,
        existingImages: [],
        uploadQueue: [],
        isUploading: false,
        uploadProgress: { current: 0, total: 0 },
        cache: new Map()
    };
    
    // ================================================
    // HTTP 클라이언트
    // ================================================
    
    const httpClient = {
        async request(url, options = {}) {
            const defaultOptions = {
                timeout: DATA_CONSTANTS.REQUEST_TIMEOUT,
                headers: {
                    'Content-Type': 'application/json'
                }
            };
            
            const config = { ...defaultOptions, ...options };
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), config.timeout);
                
                const response = await fetch(url, {
                    ...config,
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    return await response.json();
                } else {
                    return await response.text();
                }
                
            } catch (error) {
                Core.logger.error('HTTP 요청 실패:', error);
                throw error;
            }
        },
        
        async get(url, params = {}) {
            const urlParams = new URLSearchParams(params);
            const fullUrl = urlParams.toString() ? `${url}?${urlParams}` : url;
            return this.request(fullUrl, { method: 'GET' });
        },
        
        async post(url, data) {
            const options = {
                method: 'POST',
                body: data instanceof FormData ? data : JSON.stringify(data)
            };
            
            if (!(data instanceof FormData)) {
                options.headers = { 'Content-Type': 'application/json' };
            }
            
            return this.request(url, options);
        },
        
        async put(url, data) {
            return this.request(url, {
                method: 'PUT',
                body: JSON.stringify(data),
                headers: { 'Content-Type': 'application/json' }
            });
        },
        
        async delete(url) {
            return this.request(url, { method: 'DELETE' });
        }
    };
    
    // ================================================
    // 이미지 데이터 관리
    // ================================================
    
    const imageDataManager = {
        async loadExistingImages(facilityId) {
            try {
                const images = await httpClient.get(`${DATA_CONSTANTS.API_ENDPOINTS.GET_IMAGES}/${facilityId}`);
                dataState.existingImages = Array.isArray(images) ? images : [];
                
                Core.logger.log('기존 이미지 로드 완료:', dataState.existingImages.length);
                return dataState.existingImages;
                
            } catch (error) {
                Core.logger.error('기존 이미지 로드 실패:', error);
                dataState.existingImages = [];
                return [];
            }
        },
        
        async uploadImages(facilityId, files) {
            if (!files || files.length === 0) {
                throw new Error('업로드할 파일이 없습니다.');
            }
            
            dataState.isUploading = true;
            dataState.uploadProgress = { current: 0, total: files.length };
            
            try {
                const formData = new FormData();
                formData.append('facilityId', facilityId);
                
                files.forEach((fileData, index) => {
                    const blob = fileData.compressedBlob || fileData.file;
                    const fileName = fileData.seoFileName || fileData.file.name;
                    formData.append('images', blob, fileName);
                    
                    if (fileData.altText) {
                        formData.append(`altText_${index}`, fileData.altText);
                    }
                });
                
                const result = await httpClient.post(DATA_CONSTANTS.API_ENDPOINTS.UPLOAD, formData);
                
                Core.emit('uploadComplete', { result, facilityId });
                Core.logger.success('이미지 업로드 완료');
                
                return result;
                
            } catch (error) {
                Core.logger.error('이미지 업로드 실패:', error);
                throw error;
            } finally {
                dataState.isUploading = false;
            }
        },
        
        async deleteImage(imageId) {
            try {
                const result = await httpClient.delete(`${DATA_CONSTANTS.API_ENDPOINTS.DELETE}/${imageId}`);
                
                // 로컬 상태 업데이트
                dataState.existingImages = dataState.existingImages.filter(img => img.id !== imageId);
                
                Core.logger.log('이미지 삭제 완료:', imageId);
                return result;
                
            } catch (error) {
                Core.logger.error('이미지 삭제 실패:', error);
                throw error;
            }
        },
        
        async reorderImages(facilityId, imageOrder) {
            try {
                const result = await httpClient.put(DATA_CONSTANTS.API_ENDPOINTS.REORDER, {
                    facilityId,
                    imageOrder
                });
                
                Core.logger.log('이미지 순서 변경 완료');
                return result;
                
            } catch (error) {
                Core.logger.error('이미지 순서 변경 실패:', error);
                throw error;
            }
        },
        
        async setMainImage(facilityId, imageId) {
            try {
                const result = await httpClient.put(DATA_CONSTANTS.API_ENDPOINTS.SET_MAIN, {
                    facilityId,
                    imageId
                });
                
                Core.logger.log('대표 이미지 설정 완료:', imageId);
                return result;
                
            } catch (error) {
                Core.logger.error('대표 이미지 설정 실패:', error);
                throw error;
            }
        }
    };
    
    // ================================================
    // 캐시 관리
    // ================================================
    
    const cacheManager = {
        set(key, data, ttl = 300000) { // 5분 기본 TTL
            const cacheData = {
                data,
                timestamp: Date.now(),
                ttl
            };
            dataState.cache.set(key, cacheData);
        },
        
        get(key) {
            const cacheData = dataState.cache.get(key);
            if (!cacheData) return null;
            
            const isExpired = Date.now() - cacheData.timestamp > cacheData.ttl;
            if (isExpired) {
                dataState.cache.delete(key);
                return null;
            }
            
            return cacheData.data;
        },
        
        clear() {
            dataState.cache.clear();
        },
        
        delete(key) {
            dataState.cache.delete(key);
        }
    };
    
    // ================================================
    // 데이터 검증
    // ================================================
    
    const dataValidator = {
        validateImageData(imageData) {
            const errors = [];
            
            if (!imageData.file && !imageData.blob) {
                errors.push('파일 또는 Blob이 필요합니다.');
            }
            
            if (imageData.altText && imageData.altText.length > 200) {
                errors.push('Alt 텍스트는 200자 이하로 입력해주세요.');
            }
            
            return {
                isValid: errors.length === 0,
                errors
            };
        },
        
        validateUploadData(facilityId, files) {
            const errors = [];
            
            if (!facilityId || isNaN(facilityId)) {
                errors.push('유효한 시설 ID가 필요합니다.');
            }
            
            if (!files || files.length === 0) {
                errors.push('업로드할 파일이 없습니다.');
            }
            
            if (files && files.length > 5) {
                errors.push('최대 5개의 파일만 업로드할 수 있습니다.');
            }
            
            return {
                isValid: errors.length === 0,
                errors
            };
        }
    };
    
    // ================================================
    // 메인 데이터 객체
    // ================================================
    
    const data = {
        async initialize(facilityId, options = {}) {
            if (dataState.isInitialized) {
                Core.logger.warn('데이터 모듈이 이미 초기화됨');
                return true;
            }
            
            Core.logger.log('데이터 모듈 초기화 시작');
            
            try {
                dataState.facilityId = facilityId;
                
                // 기존 이미지 로드
                await imageDataManager.loadExistingImages(facilityId);
                
                dataState.isInitialized = true;
                Core.logger.success('데이터 모듈 초기화 완료');
                
                return true;
            } catch (error) {
                Core.logger.error('데이터 모듈 초기화 실패:', error);
                return false;
            }
        },
        
        async uploadImages(files) {
            const validation = dataValidator.validateUploadData(dataState.facilityId, files);
            if (!validation.isValid) {
                throw new Error(validation.errors.join(', '));
            }
            
            return imageDataManager.uploadImages(dataState.facilityId, files);
        },
        
        async getImages() {
            const cacheKey = `images_${dataState.facilityId}`;
            const cached = cacheManager.get(cacheKey);
            
            if (cached) {
                return cached;
            }
            
            const images = await imageDataManager.loadExistingImages(dataState.facilityId);
            cacheManager.set(cacheKey, images);
            
            return images;
        },
        
        async deleteImage(imageId) {
            const result = await imageDataManager.deleteImage(imageId);
            
            // 캐시 무효화
            const cacheKey = `images_${dataState.facilityId}`;
            cacheManager.delete(cacheKey);
            
            return result;
        },
        
        async reorderImages(imageOrder) {
            return imageDataManager.reorderImages(dataState.facilityId, imageOrder);
        },
        
        async setMainImage(imageId) {
            return imageDataManager.setMainImage(dataState.facilityId, imageId);
        },
        
        getExistingImages() {
            return dataState.existingImages;
        },
        
        getUploadProgress() {
            return dataState.uploadProgress;
        },
        
        isUploading() {
            return dataState.isUploading;
        },
        
        clearCache() {
            cacheManager.clear();
        },
        
        destroy() {
            dataState.isInitialized = false;
            dataState.facilityId = null;
            dataState.existingImages = [];
            dataState.uploadQueue = [];
            dataState.isUploading = false;
            cacheManager.clear();
            
            Core.logger.log('데이터 모듈 제거 완료');
        },
        
        getInfo() {
            return {
                name: DATA_CONSTANTS.MODULE_NAME,
                version: DATA_CONSTANTS.VERSION,
                isInitialized: dataState.isInitialized,
                facilityId: dataState.facilityId,
                existingImagesCount: dataState.existingImages.length,
                isUploading: dataState.isUploading,
                cacheSize: dataState.cache.size
            };
        }
    };
    
    // ================================================
    // 모듈 노출
    // ================================================
    
    window.FacilityImageSystem.Data = {
        CONSTANTS: DATA_CONSTANTS,
        data,
        httpClient,
        imageDataManager,
        cacheManager,
        dataValidator,
        getState: () => ({ ...dataState }),
        initialize: data.initialize.bind(data),
        uploadImages: data.uploadImages.bind(data),
        getImages: data.getImages.bind(data),
        deleteImage: data.deleteImage.bind(data),
        reorderImages: data.reorderImages.bind(data),
        setMainImage: data.setMainImage.bind(data),
        destroy: data.destroy.bind(data)
    };
    
    window.FacilityImageData = window.FacilityImageSystem.Data;
    
    Core.logger.log('데이터 모듈 로드 완료');
    
})();
````

## File: src/main/resources/static/js/facility-image-dom-validator.js
````javascript
/**
 * 시설 이미지 DOM 검증 및 복구 시스템
 * DOM 요소 누락 문제 해결과 타이밍 이슈 방지
 */

console.log('🔍 시설 이미지 DOM 검증자 로드됨');

// DOM 검증자 네임스페이스
window.FacilityImageDOMValidator = {
    // 필수 DOM 요소 정의
    requiredElements: {
        // 1단계 요소들
        step1: {
            uploadSection: { 
                selector: '#uploadSection', 
                fallback: 'div', 
                attributes: { id: 'uploadSection', class: 'section' }
            },
            imageInput: { 
                selector: '#imageInput', 
                fallback: 'input', 
                attributes: { id: 'imageInput', type: 'file', multiple: true, accept: 'image/*' }
            },
            selectedImagesPreview: { 
                selector: '#selectedImagesPreview', 
                fallback: 'div', 
                attributes: { id: 'selectedImagesPreview', class: 'preview-container' }
            }
        },
        
        // 2단계 요소들 (크롭)
        step2: {
            cropSection: { 
                selector: '#cropSection', 
                fallback: 'div', 
                attributes: { id: 'cropSection', class: 'section', style: 'display: none;' }
            },
            cropImage: { 
                selector: '#cropImage', 
                fallback: 'img', 
                attributes: { id: 'cropImage', class: 'crop-target', style: 'max-width: 100%; display: block;' }
            },
            nextAndSaveBtn: { 
                selector: '#nextAndSaveBtn', 
                fallback: 'button', 
                attributes: { id: 'nextAndSaveBtn', class: 'btn btn-primary', type: 'button' }
            },
            saveAndCompleteBtn: { 
                selector: '#saveAndCompleteBtn', 
                fallback: 'button', 
                attributes: { id: 'saveAndCompleteBtn', class: 'btn btn-success', type: 'button' }
            }
        },
        
        // 3단계 요소들
        step3: {
            manageSection: { 
                selector: '#manageSection', 
                fallback: 'div', 
                attributes: { id: 'manageSection', class: 'section', style: 'display: none;' }
            },
            manageImagesGrid: { 
                selector: '#manageImagesGrid', 
                fallback: 'div', 
                attributes: { id: 'manageImagesGrid', class: 'row images-grid' }
            }
        }
    },
    
    // 검증 결과
    validationResults: {
        missing: [],
        created: [],
        existing: []
    },
    
    // DOM 검증 및 복구 실행
    validateAndRepair() {
        console.log('🔧 DOM 검증 및 복구 시작');
        
        this.validationResults = { missing: [], created: [], existing: [] };
        
        Object.keys(this.requiredElements).forEach(stepName => {
            const stepElements = this.requiredElements[stepName];
            console.log(`📋 ${stepName} 단계 요소 검증 중...`);
            
            Object.keys(stepElements).forEach(elementName => {
                const elementConfig = stepElements[elementName];
                this.validateElement(elementName, elementConfig, stepName);
            });
        });
        
        this.reportResults();
        return this.validationResults;
    },
    
    // 개별 요소 검증
    validateElement(elementName, config, stepName) {
        const element = document.querySelector(config.selector);
        
        if (element) {
            this.validationResults.existing.push(`${stepName}.${elementName}`);
            console.log(`✅ ${elementName} 요소 존재 확인`);
        } else {
            console.warn(`⚠️ ${elementName} 요소 누락 - 생성 시도`);
            this.validationResults.missing.push(`${stepName}.${elementName}`);
            
            try {
                const createdElement = this.createElement(config);
                this.insertElement(createdElement, elementName, stepName);
                this.validationResults.created.push(`${stepName}.${elementName}`);
                console.log(`🆕 ${elementName} 요소 생성 완료`);
            } catch (error) {
                console.error(`❌ ${elementName} 요소 생성 실패:`, error);
            }
        }
    },
    
    // 요소 생성
    createElement(config) {
        const element = document.createElement(config.fallback);
        
        // 속성 설정
        Object.keys(config.attributes).forEach(attr => {
            if (attr === 'class') {
                element.className = config.attributes[attr];
            } else {
                element.setAttribute(attr, config.attributes[attr]);
            }
        });
        
        return element;
    },
    
    // 요소 삽입
    insertElement(element, elementName, stepName) {
        let container = null;
        
        // 적절한 컨테이너 찾기
        if (stepName === 'step1') {
            container = document.querySelector('.card-body') || document.body;
        } else if (stepName === 'step2') {
            container = document.querySelector('#cropSection') || document.querySelector('.card-body') || document.body;
            
            // cropSection이 없는 경우 생성
            if (elementName === 'cropImage' && !document.querySelector('#cropSection')) {
                const cropSection = this.createElement({
                    fallback: 'div',
                    attributes: { id: 'cropSection', class: 'section crop-section', style: 'display: none;' }
                });
                
                const cardBody = document.querySelector('.card-body');
                if (cardBody) {
                    cardBody.appendChild(cropSection);
                    container = cropSection;
                }
            }
        } else if (stepName === 'step3') {
            container = document.querySelector('#manageSection') || document.querySelector('.card-body') || document.body;
        }
        
        if (container) {
            container.appendChild(element);
            console.log(`📍 ${elementName} 요소가 ${container.id || container.className}에 삽입됨`);
        } else {
            document.body.appendChild(element);
            console.warn(`⚠️ ${elementName} 요소가 body에 삽입됨 (적절한 컨테이너 없음)`);
        }
    },
    
    // 검증 결과 보고
    reportResults() {
        const { existing, missing, created } = this.validationResults;
        
        console.log('📊 DOM 검증 결과:');
        console.log(`✅ 기존 요소: ${existing.length}개`, existing);
        console.log(`⚠️ 누락 요소: ${missing.length}개`, missing);
        console.log(`🆕 생성 요소: ${created.length}개`, created);
        
        if (missing.length > 0 && created.length > 0) {
            this.showRepairNotification();
        }
    },
    
    // 복구 알림 표시
    showRepairNotification() {
        const notification = document.createElement('div');
        notification.className = 'alert alert-info alert-dismissible fade show position-fixed';
        notification.style.cssText = 'top: 20px; left: 20px; z-index: 9999; max-width: 400px;';
        notification.innerHTML = `
            <i class="fas fa-tools me-2"></i>
            <strong>DOM 복구 완료</strong><br>
            누락된 ${this.validationResults.missing.length}개 요소가 자동으로 생성되었습니다.
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(notification);
        
        // 자동 제거
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 5000);
    },
    
    // 특정 요소 강제 생성
    forceCreateElement(elementId, config) {
        console.log(`🔨 ${elementId} 요소 강제 생성`);
        
        // 기존 요소 제거
        const existing = document.getElementById(elementId);
        if (existing) {
            existing.remove();
        }
        
        // 새 요소 생성
        const element = this.createElement(config);
        
        // 적절한 위치에 삽입
        const container = document.querySelector('.card-body') || document.body;
        container.appendChild(element);
        
        console.log(`✅ ${elementId} 요소 강제 생성 완료`);
        return element;
    },
    
    // 크롭 요소 전용 생성
    createCropSection() {
        console.log('🎨 크롭 섹션 생성');
        
        const cropSection = document.createElement('div');
        cropSection.id = 'cropSection';
        cropSection.className = 'section crop-section';
        cropSection.style.display = 'none';
        
        cropSection.innerHTML = `
            <div class="row">
                <div class="col-lg-8">
                    <div class="crop-container">
                        <img id="cropImage" class="crop-target" style="max-width: 100%; display: block;">
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="crop-controls">
                        <div class="mb-3">
                            <label for="seoFileName" class="form-label">파일명</label>
                            <input type="text" class="form-control" id="seoFileName" placeholder="파일명 입력">
                        </div>
                        <div class="mb-3">
                            <label for="altText" class="form-label">Alt 텍스트</label>
                            <input type="text" class="form-control" id="altText" placeholder="이미지 설명">
                        </div>
                        <div class="d-flex gap-2">
                            <button type="button" id="nextAndSaveBtn" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i>저장 후 다음
                            </button>
                            <button type="button" id="saveAndCompleteBtn" class="btn btn-success">
                                <i class="fas fa-check me-1"></i>저장 후 완료
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        const container = document.querySelector('.card-body');
        if (container) {
            container.appendChild(cropSection);
            console.log('✅ 크롭 섹션 생성 완료');
            return cropSection;
        } else {
            console.error('❌ 크롭 섹션 컨테이너를 찾을 수 없음');
            return null;
        }
    },
    
    // 정기 검증 (옵션)
    startPeriodicValidation(interval = 5000) {
        console.log(`🔄 정기 DOM 검증 시작 (${interval}ms 간격)`);
        
        setInterval(() => {
            const missingElements = this.getMissingElements();
            if (missingElements.length > 0) {
                console.warn('⚠️ 정기 검증에서 누락 요소 발견:', missingElements);
                this.validateAndRepair();
            }
        }, interval);
    },
    
    // 누락 요소 확인
    getMissingElements() {
        const missing = [];
        
        Object.keys(this.requiredElements).forEach(stepName => {
            const stepElements = this.requiredElements[stepName];
            Object.keys(stepElements).forEach(elementName => {
                const config = stepElements[elementName];
                if (!document.querySelector(config.selector)) {
                    missing.push(`${stepName}.${elementName}`);
                }
            });
        });
        
        return missing;
    }
};

// 자동 실행
document.addEventListener('DOMContentLoaded', function() {
    // 초기 검증
    setTimeout(() => {
        window.FacilityImageDOMValidator.validateAndRepair();
    }, 100);
    
    // 추가 검증 (다른 스크립트 로드 후)
    setTimeout(() => {
        window.FacilityImageDOMValidator.validateAndRepair();
    }, 1000);
});

console.log('✅ 시설 이미지 DOM 검증자 로드 완료');
````

## File: src/main/resources/static/js/facility-image-event-coordinator.js
````javascript
/**
 * 시설 이미지 이벤트 코디네이터
 * 파일 선택 중복 실행 완전 방지 및 이벤트 조정
 */

console.log('🎭 시설 이미지 이벤트 코디네이터 로드됨');

// 이벤트 코디네이터 네임스페이스
window.FacilityImageEventCoordinator = {
    // 상태 관리
    state: {
        fileSelectionActive: false,
        lastFileSelectionTime: 0,
        eventQueue: [],
        blockedEvents: [],
        debugMode: true
    },
    
    // 설정
    config: {
        debounceTime: 1000, // 1초 디바운스
        maxQueueSize: 10,
        cleanupInterval: 5000 // 5초마다 정리
    },
    
    // 초기화
    initialize() {
        console.log('🎭 이벤트 코디네이터 초기화');
        
        // 전역 이벤트 가로채기
        this.interceptGlobalEvents();
        
        // 정기 정리 작업
        this.startCleanupTimer();
        
        // 디버깅 인터페이스
        if (this.state.debugMode) {
            this.setupDebugInterface();
        }
        
        console.log('✅ 이벤트 코디네이터 초기화 완료');
    },
    
    // 파일 선택 이벤트 조정
    coordinateFileSelection(source, callback) {
        const now = Date.now();
        const timeSinceLastSelection = now - this.state.lastFileSelectionTime;
        
        this.log(`📁 파일 선택 요청: ${source}`, {
            active: this.state.fileSelectionActive,
            timeSince: timeSinceLastSelection,
            debounceTime: this.config.debounceTime
        });
        
        // 이미 활성화되어 있는 경우
        if (this.state.fileSelectionActive) {
            this.log('⛔ 파일 선택이 이미 활성화됨 - 요청 차단', { source });
            this.state.blockedEvents.push({
                source,
                timestamp: now,
                reason: 'already_active'
            });
            return false;
        }
        
        // 너무 빠른 연속 요청 차단
        if (timeSinceLastSelection < this.config.debounceTime) {
            this.log('⛔ 너무 빠른 연속 요청 - 디바운스 차단', { 
                source, 
                timeSince: timeSinceLastSelection,
                required: this.config.debounceTime
            });
            this.state.blockedEvents.push({
                source,
                timestamp: now,
                reason: 'debounce'
            });
            return false;
        }
        
        // 파일 선택 활성화
        this.state.fileSelectionActive = true;
        this.state.lastFileSelectionTime = now;
        
        this.log('✅ 파일 선택 허용', { source });
        
        // 콜백 실행
        try {
            const result = callback();
            
            // 비동기 처리 지원
            if (result && typeof result.then === 'function') {
                result.finally(() => {
                    this.releaseFileSelection(source);
                });
            } else {
                // 동기 처리인 경우 지연 후 해제
                setTimeout(() => {
                    this.releaseFileSelection(source);
                }, 100);
            }
            
            return true;
        } catch (error) {
            this.log('❌ 파일 선택 콜백 오류', { source, error });
            this.releaseFileSelection(source);
            return false;
        }
    },
    
    // 파일 선택 해제
    releaseFileSelection(source) {
        this.log('🔓 파일 선택 해제', { source });
        this.state.fileSelectionActive = false;
        
        // 대기 중인 이벤트 처리
        this.processQueuedEvents();
    },
    
    // 전역 이벤트 가로채기
    interceptGlobalEvents() {
        console.log('🕸️ 전역 이벤트 가로채기 설정');
        
        // input[type="file"] 이벤트 가로채기
        document.addEventListener('click', (event) => {
            const target = event.target;
            
            // 파일 입력 클릭 감지
            if (target.type === 'file' && target.id === 'imageInput') {
                this.handleFileInputClick(event, target);
            }
            
            // 파일 선택 트리거 버튼 감지
            if (target.id === 'imageLoadBtn' || 
                target.id === 'fileSelectOption' ||
                target.getAttribute('data-file-trigger')) {
                this.handleFileTriggerClick(event, target);
            }
        }, true); // 캡처 단계에서 처리
        
        // change 이벤트 가로채기
        document.addEventListener('change', (event) => {
            const target = event.target;
            
            if (target.type === 'file' && target.id === 'imageInput') {
                this.handleFileInputChange(event, target);
            }
        }, true);
    },
    
    // 파일 입력 클릭 처리
    handleFileInputClick(event, target) {
        this.log('📁 파일 입력 클릭 감지', { targetId: target.id });
        
        // 사용자 직접 클릭이나 신뢰할 수 있는 이벤트는 항상 허용
        if (event.isTrusted || event.target === target) {
            this.log('✅ 사용자 직접 클릭 또는 신뢰할 수 있는 이벤트 - 허용');
            return true;
        }
        
        // 파일 선택이 활성화되어 있지 않은 경우에도 허용
        if (!this.state.fileSelectionActive) {
            this.log('✅ 파일 선택이 활성화되지 않음 - 허용');
            return true;
        }
        
        // 프로그래밍 방식 클릭의 경우에만 제한적으로 차단
        this.log('⚠️ 프로그래밍 중복 클릭 감지 - 짧은 지연 후 재시도');
        // 완전 차단하지 않고 짧은 지연 후 허용
        setTimeout(() => {
            if (!this.state.fileSelectionActive) {
                target.click();
            }
        }, 50);
        return false;
    },
    
    // 파일 트리거 버튼 클릭 처리
    handleFileTriggerClick(event, target) {
        this.log('🔘 파일 트리거 버튼 클릭', { targetId: target.id });
        
        // 사용자 직접 클릭은 항상 허용하되 중복 방지만 수행
        if (event.isTrusted) {
            this.log('✅ 사용자 직접 트리거 클릭 - 기본 허용');
            
            // 중복 클릭 방지를 위한 최소한의 코디네이션
            if (!this.state.fileSelectionActive) {
                this.state.fileSelectionActive = true;
                this.state.lastFileSelectionTime = Date.now();
                
                setTimeout(() => {
                    const fileInput = document.getElementById('imageInput');
                    if (fileInput) {
                        fileInput.click();
                    }
                }, 10);
                
                // 짧은 시간 후 상태 해제
                setTimeout(() => {
                    this.releaseFileSelection(`button:${target.id}`);
                }, 100);
                
                return true;
            } else {
                this.log('⚠️ 파일 선택이 이미 진행 중 - 잠시 대기');
                return false;
            }
        }
        
        // 프로그래밍 방식 클릭의 경우 기존 로직 사용
        const allowed = this.coordinateFileSelection(`button:${target.id}`, () => {
            return true;
        });
        
        if (allowed) {
            setTimeout(() => {
                const fileInput = document.getElementById('imageInput');
                if (fileInput) {
                    fileInput.click();
                }
            }, 10);
        }
        
        return allowed;
    },
    
    // 파일 입력 변경 처리
    handleFileInputChange(event, target) {
        this.log('📂 파일 입력 변경 감지', { 
            targetId: target.id,
            fileCount: target.files.length
        });
        
        // 파일이 선택되었을 때 다른 모듈들에게 알림
        if (target.files.length > 0) {
            this.log('📢 파일 선택 완료 - 다른 모듈들에게 알림 발송', {
                fileCount: target.files.length,
                targetId: target.id
            });
            
            // 커스텀 이벤트 발생 - 다른 모듈들이 구독할 수 있도록
            const filesSelectedEvent = new CustomEvent('facilityImageFilesSelected', {
                detail: {
                    files: target.files,
                    source: target.id === 'folderInput' ? 'folder' : 'file',
                    targetElement: target,
                    timestamp: Date.now()
                }
            });
            
            document.dispatchEvent(filesSelectedEvent);
            this.log('✅ 파일 선택 이벤트 발송 완료');
        }
        
        // 파일 선택 완료 시 상태 해제
        setTimeout(() => {
            this.releaseFileSelection('file-input-change');
        }, 200);
    },
    
    // 대기열 이벤트 처리
    processQueuedEvents() {
        if (this.state.eventQueue.length > 0) {
            this.log('📋 대기열 이벤트 처리', { queueSize: this.state.eventQueue.length });
            
            const nextEvent = this.state.eventQueue.shift();
            if (nextEvent) {
                setTimeout(() => {
                    nextEvent.callback();
                }, 100);
            }
        }
    },
    
    // 이벤트 대기열에 추가
    queueEvent(source, callback) {
        if (this.state.eventQueue.length >= this.config.maxQueueSize) {
            this.log('⚠️ 대기열 용량 초과 - 이벤트 무시', { source });
            return false;
        }
        
        this.state.eventQueue.push({
            source,
            callback,
            timestamp: Date.now()
        });
        
        this.log('📝 이벤트 대기열 추가', { source, queueSize: this.state.eventQueue.length });
        return true;
    },
    
    // 정리 타이머 시작
    startCleanupTimer() {
        setInterval(() => {
            this.cleanup();
        }, this.config.cleanupInterval);
    },
    
    // 정리 작업
    cleanup() {
        const now = Date.now();
        const oldEventsThreshold = now - (this.config.cleanupInterval * 2);
        
        // 오래된 차단 이벤트 제거
        const oldBlockedCount = this.state.blockedEvents.length;
        this.state.blockedEvents = this.state.blockedEvents.filter(
            event => event.timestamp > oldEventsThreshold
        );
        
        // 오래된 대기열 이벤트 제거
        const oldQueueCount = this.state.eventQueue.length;
        this.state.eventQueue = this.state.eventQueue.filter(
            event => event.timestamp > oldEventsThreshold
        );
        
        if (oldBlockedCount !== this.state.blockedEvents.length || 
            oldQueueCount !== this.state.eventQueue.length) {
            this.log('🧹 정리 완료', {
                blockedRemoved: oldBlockedCount - this.state.blockedEvents.length,
                queueRemoved: oldQueueCount - this.state.eventQueue.length
            });
        }
    },
    
    // 디버깅 인터페이스 설정
    setupDebugInterface() {
        window.facilityImageEventDebug = {
            getState: () => this.state,
            getStats: () => ({
                blockedEventsCount: this.state.blockedEvents.length,
                queuedEventsCount: this.state.eventQueue.length,
                isFileSelectionActive: this.state.fileSelectionActive,
                lastSelectionTime: new Date(this.state.lastFileSelectionTime).toLocaleTimeString()
            }),
            clearBlocked: () => {
                this.state.blockedEvents = [];
                console.log('🧹 차단된 이벤트 기록 초기화됨');
            },
            clearQueue: () => {
                this.state.eventQueue = [];
                console.log('🧹 이벤트 대기열 초기화됨');
            },
            forceRelease: () => {
                this.state.fileSelectionActive = false;
                console.log('🔓 파일 선택 강제 해제됨');
            },
            testFileSelection: () => {
                return this.coordinateFileSelection('debug-test', () => {
                    console.log('🧪 테스트 파일 선택 실행됨');
                });
            }
        };
        
        console.log('🧪 디버깅 인터페이스 설정 완료: window.facilityImageEventDebug');
    },
    
    // 로깅
    log(message, data = null) {
        if (!this.state.debugMode) return;
        
        const timestamp = new Date().toLocaleTimeString();
        console.log(`🎭 [EventCoordinator] [${timestamp}] ${message}`, data || '');
    }
};

// 자동 초기화
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        window.FacilityImageEventCoordinator.initialize();
    }, 50);
});

console.log('✅ 시설 이미지 이벤트 코디네이터 로드 완료');
````

## File: src/main/resources/static/js/facility-image-utils-module.js
````javascript
/**
 * 시설 이미지 유틸리티 모듈 (Utils Module)
 * 공통 유틸리티, 헬퍼 함수들 전용 모듈
 * 
 * @version 1.0.0
 * @author LightCare Team
 * @requires FacilityImageCore
 */

(function() {
    'use strict';
    
    if (!window.FacilityImageCore) {
        throw new Error('FacilityImageCore 모듈이 필요합니다.');
    }
    
    const Core = window.FacilityImageCore;
    
    if (!window.FacilityImageSystem.Utils) {
        window.FacilityImageSystem.Utils = {};
    }
    
    // ================================================
    // 상수 정의
    // ================================================
    
    const UTILS_CONSTANTS = {
        MODULE_NAME: 'FacilityImageUtils',
        VERSION: '1.0.0'
    };
    
    // ================================================
    // 이미지 처리 유틸리티
    // ================================================
    
    const imageUtils = {
        /**
         * 이미지 크기 계산
         */
        calculateAspectRatio(width, height) {
            const gcd = this.getGCD(width, height);
            return {
                ratio: width / height,
                aspectRatio: `${width / gcd}:${height / gcd}`,
                width,
                height
            };
        },
        
        /**
         * 최대공약수 구하기
         */
        getGCD(a, b) {
            return b === 0 ? a : this.getGCD(b, a % b);
        },
        
        /**
         * 이미지 메타데이터 추출
         */
        async extractMetadata(file) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    const metadata = {
                        filename: file.name,
                        size: file.size,
                        type: file.type,
                        width: img.width,
                        height: img.height,
                        aspectRatio: this.calculateAspectRatio(img.width, img.height),
                        lastModified: new Date(file.lastModified)
                    };
                    resolve(metadata);
                };
                img.onerror = () => resolve(null);
                img.src = URL.createObjectURL(file);
            });
        },
        
        /**
         * 이미지 압축 비율 계산
         */
        calculateCompressionRatio(originalSize, compressedSize) {
            return Math.round((1 - compressedSize / originalSize) * 100);
        }
    };
    
    // ================================================
    // 파일 처리 유틸리티
    // ================================================
    
    const fileUtils = {
        /**
         * 파일 크기 포맷팅
         */
        formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        },
        
        /**
         * 파일 타입 체크
         */
        isImageFile(file) {
            return file.type.startsWith('image/');
        },
        
        /**
         * 파일 확장자 추출
         */
        getFileExtension(filename) {
            return filename.slice((filename.lastIndexOf('.') - 1 >>> 0) + 2);
        },
        
        /**
         * MIME 타입에서 확장자 추출
         */
        getExtensionFromMimeType(mimeType) {
            const extensions = {
                'image/jpeg': 'jpg',
                'image/png': 'png',
                'image/webp': 'webp',
                'image/avif': 'avif'
            };
            return extensions[mimeType] || 'jpg';
        },
        
        /**
         * Blob을 File로 변환
         */
        blobToFile(blob, filename) {
            return new File([blob], filename, { type: blob.type });
        }
    };
    
    // ================================================
    // 문자열 처리 유틸리티
    // ================================================
    
    const stringUtils = {
        /**
         * 문자열 슬러그화
         */
        slugify(text) {
            return text
                .toString()
                .toLowerCase()
                .trim()
                .replace(/\s+/g, '-')
                .replace(/[^\w\-]+/g, '')
                .replace(/\-\-+/g, '-')
                .replace(/^-+/, '')
                .replace(/-+$/, '');
        },
        
        /**
         * 한글을 영문으로 변환
         */
        koreanToEnglish(text) {
            const map = {
                'ㄱ': 'g', 'ㄴ': 'n', 'ㄷ': 'd', 'ㄹ': 'r', 'ㅁ': 'm',
                'ㅂ': 'b', 'ㅅ': 's', 'ㅇ': '', 'ㅈ': 'j', 'ㅊ': 'ch',
                'ㅋ': 'k', 'ㅌ': 't', 'ㅍ': 'p', 'ㅎ': 'h',
                'ㅏ': 'a', 'ㅓ': 'eo', 'ㅗ': 'o', 'ㅜ': 'u', 'ㅡ': 'eu', 'ㅣ': 'i'
            };
            
            return text.replace(/[ㄱ-ㅎㅏ-ㅣ가-힣]/g, (char) => {
                return map[char] || '';
            });
        },
        
        /**
         * 텍스트 잘라내기
         */
        truncate(text, maxLength, suffix = '...') {
            if (text.length <= maxLength) return text;
            return text.slice(0, maxLength - suffix.length) + suffix;
        },
        
        /**
         * 카멜케이스 변환
         */
        toCamelCase(text) {
            return text.replace(/[-_\s]+(.)?/g, (_, char) => 
                char ? char.toUpperCase() : ''
            );
        }
    };
    
    // ================================================
    // 배열 처리 유틸리티
    // ================================================
    
    const arrayUtils = {
        /**
         * 배열 섞기
         */
        shuffle(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        },
        
        /**
         * 배열 청크 분할
         */
        chunk(array, size) {
            const chunks = [];
            for (let i = 0; i < array.length; i += size) {
                chunks.push(array.slice(i, i + size));
            }
            return chunks;
        },
        
        /**
         * 중복 제거
         */
        unique(array, key = null) {
            if (key) {
                const seen = new Set();
                return array.filter(item => {
                    const keyValue = item[key];
                    if (seen.has(keyValue)) {
                        return false;
                    }
                    seen.add(keyValue);
                    return true;
                });
            }
            return [...new Set(array)];
        },
        
        /**
         * 배열에서 랜덤 선택
         */
        randomSelect(array, count = 1) {
            const shuffled = this.shuffle(array);
            return count === 1 ? shuffled[0] : shuffled.slice(0, count);
        }
    };
    
    // ================================================
    // 시간 처리 유틸리티
    // ================================================
    
    const timeUtils = {
        /**
         * 상대 시간 표시
         */
        timeAgo(date) {
            const now = new Date();
            const diff = now - new Date(date);
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return '방금 전';
            if (minutes < 60) return `${minutes}분 전`;
            if (hours < 24) return `${hours}시간 전`;
            if (days < 30) return `${days}일 전`;
            return new Date(date).toLocaleDateString();
        },
        
        /**
         * 시간 포맷팅
         */
        formatTime(date, format = 'YYYY-MM-DD HH:mm:ss') {
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            const hours = String(d.getHours()).padStart(2, '0');
            const minutes = String(d.getMinutes()).padStart(2, '0');
            const seconds = String(d.getSeconds()).padStart(2, '0');
            
            return format
                .replace('YYYY', year)
                .replace('MM', month)
                .replace('DD', day)
                .replace('HH', hours)
                .replace('mm', minutes)
                .replace('ss', seconds);
        }
    };
    
    // ================================================
    // URL 처리 유틸리티
    // ================================================
    
    const urlUtils = {
        /**
         * URL 파라미터 추출
         */
        getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const result = {};
            for (const [key, value] of params) {
                result[key] = value;
            }
            return result;
        },
        
        /**
         * URL 파라미터 설정
         */
        setUrlParam(key, value) {
            const url = new URL(window.location);
            url.searchParams.set(key, value);
            window.history.pushState({}, '', url);
        },
        
        /**
         * 현재 URL에서 시설 ID 추출
         */
        extractFacilityId() {
            const pathParts = window.location.pathname.split('/');
            const lastPart = pathParts[pathParts.length - 1];
            return !isNaN(lastPart) && lastPart !== '' ? parseInt(lastPart) : null;
        }
    };
    
    // ================================================
    // 로컬 스토리지 유틸리티
    // ================================================
    
    const storageUtils = {
        /**
         * 로컬 스토리지에 저장
         */
        set(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
                return true;
            } catch (error) {
                Core.logger.error('로컬 스토리지 저장 실패:', error);
                return false;
            }
        },
        
        /**
         * 로컬 스토리지에서 가져오기
         */
        get(key, defaultValue = null) {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (error) {
                Core.logger.error('로컬 스토리지 읽기 실패:', error);
                return defaultValue;
            }
        },
        
        /**
         * 로컬 스토리지에서 제거
         */
        remove(key) {
            try {
                localStorage.removeItem(key);
                return true;
            } catch (error) {
                Core.logger.error('로컬 스토리지 제거 실패:', error);
                return false;
            }
        },
        
        /**
         * 로컬 스토리지 전체 클리어
         */
        clear() {
            try {
                localStorage.clear();
                return true;
            } catch (error) {
                Core.logger.error('로컬 스토리지 클리어 실패:', error);
                return false;
            }
        }
    };
    
    // ================================================
    // 성능 측정 유틸리티
    // ================================================
    
    const performanceUtils = {
        timers: new Map(),
        
        /**
         * 타이머 시작
         */
        startTimer(name) {
            this.timers.set(name, performance.now());
        },
        
        /**
         * 타이머 종료 및 결과 반환
         */
        endTimer(name) {
            const startTime = this.timers.get(name);
            if (!startTime) return null;
            
            const duration = performance.now() - startTime;
            this.timers.delete(name);
            
            Core.logger.log(`⏱️ ${name}: ${duration.toFixed(2)}ms`);
            return duration;
        },
        
        /**
         * 함수 실행 시간 측정
         */
        async measureFunction(fn, name = 'function') {
            this.startTimer(name);
            const result = await fn();
            this.endTimer(name);
            return result;
        }
    };
    
    // ================================================
    // 메인 유틸리티 객체
    // ================================================
    
    const utils = {
        initialize() {
            Core.logger.log('유틸리티 모듈 초기화 완료');
            return true;
        },
        
        // 각 유틸리티 그룹 접근자
        image: imageUtils,
        file: fileUtils,
        string: stringUtils,
        array: arrayUtils,
        time: timeUtils,
        url: urlUtils,
        storage: storageUtils,
        performance: performanceUtils,
        
        getInfo() {
            return {
                name: UTILS_CONSTANTS.MODULE_NAME,
                version: UTILS_CONSTANTS.VERSION,
                availableUtils: [
                    'image', 'file', 'string', 'array', 
                    'time', 'url', 'storage', 'performance'
                ]
            };
        }
    };
    
    // ================================================
    // 모듈 노출
    // ================================================
    
    window.FacilityImageSystem.Utils = {
        CONSTANTS: UTILS_CONSTANTS,
        utils,
        imageUtils,
        fileUtils,
        stringUtils,
        arrayUtils,
        timeUtils,
        urlUtils,
        storageUtils,
        performanceUtils,
        initialize: utils.initialize.bind(utils)
    };
    
    window.FacilityImageUtils = window.FacilityImageSystem.Utils;
    
    Core.logger.log('유틸리티 모듈 로드 완료');
    
})();
````

## File: src/main/resources/static/js/image-compressor.js
````javascript
/**
 * 이미지 압축 공통 라이브러리
 * SEO 최적화를 위한 이미지 용량 줄이기 기능
 */
class ImageCompressor {
    constructor(options = {}) {
        this.options = {
            quality: options.quality || 0.8,
            maxWidth: options.maxWidth || 1920,
            maxHeight: options.maxHeight || 1080,
            outputFormat: options.outputFormat || 'image/jpeg',
            enableResize: options.enableResize !== false,
            showProgress: options.showProgress !== false,
            ...options
        };
    }

    /**
     * 파일을 압축합니다
     * @param {File} file - 압축할 파일
     * @param {Object} customOptions - 사용자 정의 옵션
     * @returns {Promise<{file: File, originalSize: number, compressedSize: number, compressionRatio: number}>}
     */
    async compressFile(file, customOptions = {}) {
        const options = { ...this.options, ...customOptions };
        
        if (!this.isValidImageFile(file)) {
            throw new Error('지원되지 않는 이미지 파일입니다.');
        }

        const originalSize = file.size;
        
        try {
            const compressedFile = await this.compress(file, options);
            const compressedSize = compressedFile.size;
            const compressionRatio = Math.round((1 - compressedSize / originalSize) * 100);
            
            return {
                file: compressedFile,
                originalSize,
                compressedSize,
                compressionRatio
            };
        } catch (error) {
            console.error('이미지 압축 중 오류 발생:', error);
            throw error;
        }
    }

    /**
     * 여러 파일을 압축합니다
     * @param {FileList|Array} files - 압축할 파일 목록
     * @param {Object} customOptions - 사용자 정의 옵션
     * @returns {Promise<Array>}
     */
    async compressFiles(files, customOptions = {}) {
        const fileArray = Array.from(files);
        const results = [];
        
        for (let i = 0; i < fileArray.length; i++) {
            const file = fileArray[i];
            try {
                const result = await this.compressFile(file, customOptions);
                results.push(result);
                
                if (this.options.showProgress && this.onProgress) {
                    this.onProgress(i + 1, fileArray.length, result);
                }
            } catch (error) {
                console.error(`파일 ${file.name} 압축 실패:`, error);
                results.push({ error: error.message, file });
            }
        }
        
        return results;
    }

    /**
     * 실제 압축 로직
     * @private
     */
    async compress(file, options) {
        return new Promise((resolve, reject) => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = () => {
                try {
                    // 리사이즈 계산
                    const { width, height } = this.calculateDimensions(
                        img.width, 
                        img.height, 
                        options.maxWidth, 
                        options.maxHeight,
                        options.enableResize
                    );
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // 이미지 그리기
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Blob으로 변환
                    canvas.toBlob((blob) => {
                        if (blob) {
                            const compressedFile = new File([blob], file.name, {
                                type: options.outputFormat,
                                lastModified: Date.now()
                            });
                            resolve(compressedFile);
                        } else {
                            reject(new Error('압축 실패'));
                        }
                    }, options.outputFormat, options.quality);
                } catch (error) {
                    reject(error);
                }
            };
            
            img.onerror = () => reject(new Error('이미지 로드 실패'));
            img.src = URL.createObjectURL(file);
        });
    }

    /**
     * 리사이즈 치수 계산
     * @private
     */
    calculateDimensions(originalWidth, originalHeight, maxWidth, maxHeight, enableResize) {
        if (!enableResize) {
            return { width: originalWidth, height: originalHeight };
        }

        let { width, height } = { width: originalWidth, height: originalHeight };
        
        // 최대 너비 제한
        if (width > maxWidth) {
            height = (height * maxWidth) / width;
            width = maxWidth;
        }
        
        // 최대 높이 제한
        if (height > maxHeight) {
            width = (width * maxHeight) / height;
            height = maxHeight;
        }
        
        return { width: Math.round(width), height: Math.round(height) };
    }

    /**
     * 유효한 이미지 파일인지 확인
     * @private
     */
    isValidImageFile(file) {
        const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
        return validTypes.includes(file.type);
    }

    /**
     * 파일 크기를 읽기 쉬운 형태로 변환
     * @param {number} bytes - 바이트 수
     * @returns {string}
     */
    static formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    /**
     * 진행 상황 콜백 설정
     * @param {Function} callback - 진행 상황 콜백 함수
     */
    setProgressCallback(callback) {
        this.onProgress = callback;
    }
}

/**
 * 이미지 압축 UI 헬퍼
 */
class ImageCompressorUI {
    constructor(inputSelector, options = {}) {
        this.input = document.querySelector(inputSelector);
        this.compressor = new ImageCompressor(options);
        this.originalFiles = [];
        this.compressedFiles = [];
        
        this.init();
    }

    init() {
        if (!this.input) {
            console.error('이미지 입력 요소를 찾을 수 없습니다.');
            return;
        }

        this.createUI();
        this.bindEvents();
    }

    createUI() {
        // 기존 input을 숨기고 새로운 UI 생성
        this.input.style.display = 'none';
        
        const wrapper = document.createElement('div');
        wrapper.className = 'image-compressor-wrapper';
        wrapper.innerHTML = `
            <div class="image-upload-area border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <div class="upload-icon mb-3">
                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                </div>
                <p class="text-sm text-gray-600 mb-2">이미지를 드래그하여 업로드하거나 클릭하여 선택하세요</p>
                <p class="text-xs text-gray-500">JPG, PNG, WEBP 파일만 지원됩니다</p>
                <input type="file" class="hidden" accept="image/*" multiple>
            </div>
            
            <div class="compression-settings mt-4 hidden">
                <h4 class="text-sm font-semibold mb-3">압축 설정</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs text-gray-700 mb-1">품질 (${Math.round(this.compressor.options.quality * 100)}%)</label>
                        <input type="range" class="quality-slider w-full" min="0.1" max="1" step="0.1" value="${this.compressor.options.quality}">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-700 mb-1">최대 너비 (px)</label>
                        <input type="number" class="max-width-input w-full px-2 py-1 border rounded text-sm" value="${this.compressor.options.maxWidth}">
                    </div>
                </div>
                <div class="mt-3">
                    <button type="button" class="compress-btn bg-blue-500 text-white px-4 py-2 rounded text-sm hover:bg-blue-600">
                        이미지 압축하기
                    </button>
                </div>
            </div>
            
            <div class="file-preview mt-4 hidden">
                <h4 class="text-sm font-semibold mb-3">파일 미리보기</h4>
                <div class="preview-list"></div>
            </div>
            
            <div class="alt-tags-section mt-4 hidden">
                <h4 class="text-sm font-semibold mb-3">
                    <i class="fas fa-tag me-1"></i>SEO 최적화 - 이미지 설명 (Alt 태그)
                </h4>
                <div class="alt-tags-list"></div>
                <div class="mt-2">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="autoGenerateAlt" checked>
                        <label class="form-check-label text-xs text-gray-600" for="autoGenerateAlt">
                            <i class="fas fa-magic me-1"></i>설명이 비어있으면 자동으로 생성
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="compression-progress mt-4 hidden">
                <div class="progress-bar bg-gray-200 rounded-full h-2">
                    <div class="progress-fill bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <p class="text-sm text-gray-600 mt-2">압축 진행 중...</p>
            </div>
        `;
        
        this.input.parentNode.insertBefore(wrapper, this.input);
        this.wrapper = wrapper;
        this.fileInput = wrapper.querySelector('input[type="file"]');
        this.uploadArea = wrapper.querySelector('.image-upload-area');
        this.settingsArea = wrapper.querySelector('.compression-settings');
        this.previewArea = wrapper.querySelector('.file-preview');
        this.altTagsSection = wrapper.querySelector('.alt-tags-section');
        this.progressArea = wrapper.querySelector('.compression-progress');
    }

    bindEvents() {
        // 파일 선택 이벤트
        this.fileInput.addEventListener('change', (e) => {
            this.handleFiles(e.target.files);
        });

        // 드래그 앤 드롭 이벤트
        this.uploadArea.addEventListener('click', () => {
            this.fileInput.click();
        });

        this.uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            this.uploadArea.classList.add('border-blue-400', 'bg-blue-50');
        });

        this.uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            this.uploadArea.classList.remove('border-blue-400', 'bg-blue-50');
        });

        this.uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            this.uploadArea.classList.remove('border-blue-400', 'bg-blue-50');
            this.handleFiles(e.dataTransfer.files);
        });

        // 압축 설정 이벤트
        this.wrapper.querySelector('.quality-slider').addEventListener('input', (e) => {
            const quality = parseFloat(e.target.value);
            this.compressor.options.quality = quality;
            e.target.previousElementSibling.textContent = `품질 (${Math.round(quality * 100)}%)`;
        });

        this.wrapper.querySelector('.max-width-input').addEventListener('input', (e) => {
            this.compressor.options.maxWidth = parseInt(e.target.value);
        });

        // 압축 실행 이벤트
        this.wrapper.querySelector('.compress-btn').addEventListener('click', () => {
            this.compressImages();
        });
    }

    handleFiles(files) {
        if (files.length === 0) return;

        this.originalFiles = Array.from(files);
        this.showPreview(files);
        this.showAltTagInputs(files);
        this.settingsArea.classList.remove('hidden');
        this.previewArea.classList.remove('hidden');
        this.altTagsSection.classList.remove('hidden');
    }

    showPreview(files) {
        const previewList = this.wrapper.querySelector('.preview-list');
        previewList.innerHTML = '';

        Array.from(files).forEach((file, index) => {
            const previewItem = document.createElement('div');
            previewItem.className = 'preview-item flex items-center justify-between p-3 border rounded mb-2';
            
            const reader = new FileReader();
            reader.onload = (e) => {
                previewItem.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <img src="${e.target.result}" class="w-12 h-12 object-cover rounded" alt="미리보기">
                        <div>
                            <p class="text-sm font-medium">${file.name}</p>
                            <p class="text-xs text-gray-500">원본: ${ImageCompressor.formatFileSize(file.size)}</p>
                        </div>
                    </div>
                    <div class="compression-result hidden">
                        <p class="text-xs text-green-600">압축 완료!</p>
                        <p class="text-xs text-gray-500">압축 후: <span class="compressed-size"></span></p>
                        <p class="text-xs text-gray-500">압축률: <span class="compression-ratio"></span>%</p>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
            
            previewList.appendChild(previewItem);
        });
    }

    async compressImages() {
        if (this.originalFiles.length === 0) return;

        this.progressArea.classList.remove('hidden');
        const progressFill = this.wrapper.querySelector('.progress-fill');
        const progressText = this.wrapper.querySelector('.compression-progress p');

        this.compressor.setProgressCallback((current, total, result) => {
            const percentage = Math.round((current / total) * 100);
            progressFill.style.width = `${percentage}%`;
            progressText.textContent = `압축 진행 중... (${current}/${total})`;

            // 개별 파일 결과 업데이트
            this.updatePreviewResult(current - 1, result);
        });

        try {
            const results = await this.compressor.compressFiles(this.originalFiles);
            this.compressedFiles = results.map(result => result.file).filter(file => file);
            
            // 원본 input에 압축된 파일 설정
            this.updateOriginalInput();
            
            progressText.textContent = '압축 완료!';
            
            // 총 압축 결과 표시
            this.showCompressionSummary(results);
            
        } catch (error) {
            console.error('압축 중 오류 발생:', error);
            progressText.textContent = '압축 중 오류가 발생했습니다.';
        }
    }

    updatePreviewResult(index, result) {
        const previewItems = this.wrapper.querySelectorAll('.preview-item');
        if (previewItems[index]) {
            const resultDiv = previewItems[index].querySelector('.compression-result');
            if (resultDiv && !result.error) {
                resultDiv.querySelector('.compressed-size').textContent = ImageCompressor.formatFileSize(result.compressedSize);
                resultDiv.querySelector('.compression-ratio').textContent = result.compressionRatio;
                resultDiv.classList.remove('hidden');
            }
        }
    }

    updateOriginalInput() {
        // DataTransfer 객체를 사용하여 압축된 파일을 원본 input에 설정
        const dt = new DataTransfer();
        this.compressedFiles.forEach(file => {
            dt.items.add(file);
        });
        this.input.files = dt.files;
        
        // change 이벤트 발생
        this.input.dispatchEvent(new Event('change', { bubbles: true }));
    }

    showCompressionSummary(results) {
        const totalOriginal = results.reduce((sum, result) => sum + (result.originalSize || 0), 0);
        const totalCompressed = results.reduce((sum, result) => sum + (result.compressedSize || 0), 0);
        const totalRatio = Math.round((1 - totalCompressed / totalOriginal) * 100);

        const summary = document.createElement('div');
        summary.className = 'compression-summary mt-4 p-4 bg-green-50 border border-green-200 rounded-lg';
        summary.innerHTML = `
            <h4 class="text-sm font-semibold text-green-800 mb-2">압축 완료!</h4>
            <div class="text-xs text-green-700">
                <p>원본 용량: ${ImageCompressor.formatFileSize(totalOriginal)}</p>
                <p>압축 후 용량: ${ImageCompressor.formatFileSize(totalCompressed)}</p>
                <p>총 압축률: ${totalRatio}%</p>
                <p class="mt-1 font-medium">SEO 최적화를 위해 용량이 ${ImageCompressor.formatFileSize(totalOriginal - totalCompressed)} 줄어들었습니다!</p>
            </div>
        `;
        
        this.wrapper.appendChild(summary);
    }

    showAltTagInputs(files) {
        const altTagsList = this.wrapper.querySelector('.alt-tags-list');
        altTagsList.innerHTML = '';

        Array.from(files).forEach((file, index) => {
            const altTagItem = document.createElement('div');
            altTagItem.className = 'alt-tag-item mb-3 p-3 border rounded bg-light';
            
            const fileName = file.name;
            const autoGeneratedAlt = this.generateAutoAltText(fileName);
            
            altTagItem.innerHTML = `
                <div class="d-flex align-items-start gap-3">
                    <div class="flex-shrink-0">
                        <div class="file-icon bg-primary text-white rounded p-2">
                            <i class="fas fa-image"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1">
                        <h6 class="mb-2 text-sm font-medium">${fileName}</h6>
                        <div class="mb-2">
                            <label class="form-label text-xs">이미지 설명 (Alt 태그)</label>
                            <textarea 
                                class="form-control form-control-sm alt-text-input" 
                                data-file-index="${index}"
                                rows="2" 
                                placeholder="SEO 최적화를 위한 이미지 설명을 입력하세요..."
                                maxlength="125"
                            ></textarea>
                            <div class="form-text text-xs">
                                <span class="text-muted">검색엔진 최적화를 위해 이미지 내용을 설명해주세요 (최대 125자)</span>
                                <span class="char-count float-end">0/125</span>
                            </div>
                        </div>
                        <div class="auto-suggestion ${autoGeneratedAlt ? '' : 'hidden'}">
                            <small class="text-muted">
                                <i class="fas fa-lightbulb text-warning me-1"></i>
                                자동 제안: <span class="auto-alt-text">${autoGeneratedAlt}</span>
                                <button type="button" class="btn btn-link btn-sm p-0 ms-2 use-suggestion" data-file-index="${index}">
                                    <i class="fas fa-check text-success"></i> 사용
                                </button>
                            </small>
                        </div>
                    </div>
                </div>
            `;
            
            altTagsList.appendChild(altTagItem);
        });

        // 이벤트 리스너 추가
        this.bindAltTagEvents();
    }

    bindAltTagEvents() {
        // 글자 수 카운터
        this.wrapper.querySelectorAll('.alt-text-input').forEach(input => {
            const charCount = input.closest('.alt-tag-item').querySelector('.char-count');
            
            input.addEventListener('input', () => {
                const length = input.value.length;
                charCount.textContent = `${length}/125`;
                charCount.className = length > 100 ? 'char-count float-end text-warning' : 'char-count float-end text-muted';
            });
        });

        // 자동 제안 사용 버튼
        this.wrapper.querySelectorAll('.use-suggestion').forEach(button => {
            button.addEventListener('click', () => {
                const fileIndex = button.dataset.fileIndex;
                const altInput = this.wrapper.querySelector(`.alt-text-input[data-file-index="${fileIndex}"]`);
                const suggestedText = button.closest('.auto-suggestion').querySelector('.auto-alt-text').textContent;
                
                altInput.value = suggestedText;
                altInput.dispatchEvent(new Event('input'));
                
                // 사용된 제안 표시
                button.innerHTML = '<i class="fas fa-check text-success"></i> 적용됨';
                button.disabled = true;
            });
        });
    }

    generateAutoAltText(fileName) {
        // 파일명 기반 자동 alt 텍스트 생성
        const cleanName = fileName
            .replace(/\.[^/.]+$/, '') // 확장자 제거
            .replace(/[_-]/g, ' ')    // 언더스코어, 하이픈을 공백으로
            .replace(/\d+/g, '')      // 숫자 제거
            .trim();

        if (!cleanName) return '';

        // 한글인지 확인
        const isKorean = /[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(cleanName);
        
        if (isKorean) {
            // 한글 파일명 처리
            if (cleanName.includes('시설') || cleanName.includes('요양원')) {
                return `${cleanName} 시설 사진`;
            } else if (cleanName.includes('프로필') || cleanName.includes('증명')) {
                return `${cleanName} 이미지`;
            } else {
                return `${cleanName} 사진`;
            }
        } else {
            // 영문 파일명 처리
            const words = cleanName.toLowerCase().split(/\s+/).filter(word => word.length > 0);
            
            if (words.length === 0) return '';
            
            // 시설 관련 키워드
            if (words.some(word => ['facility', 'nursing', 'care', 'hospital'].includes(word))) {
                return `${this.capitalizeWords(cleanName)} facility image`;
            }
            // 프로필 관련 키워드  
            else if (words.some(word => ['profile', 'avatar', 'user', 'member'].includes(word))) {
                return `${this.capitalizeWords(cleanName)} profile picture`;
            }
            // 일반적인 경우
            else {
                return `${this.capitalizeWords(cleanName)} image`;
            }
        }
    }

    capitalizeWords(str) {
        return str.replace(/\b\w/g, l => l.toUpperCase());
    }

    getAltTexts() {
        const altTexts = [];
        const inputs = this.wrapper.querySelectorAll('.alt-text-input');
        const autoGenerate = this.wrapper.querySelector('#autoGenerateAlt').checked;
        
        inputs.forEach((input, index) => {
            let altText = input.value.trim();
            
            // 자동 생성이 활성화되고 입력값이 없으면 자동 생성
            if (!altText && autoGenerate && this.originalFiles[index]) {
                altText = this.generateAutoAltText(this.originalFiles[index].name);
            }
            
            altTexts.push(altText);
        });
        
        return altTexts;
    }

    // 압축된 파일과 함께 alt 텍스트도 반환하도록 수정
    async compressImages() {
        if (this.originalFiles.length === 0) return;

        this.progressArea.classList.remove('hidden');
        const progressFill = this.wrapper.querySelector('.progress-fill');
        const progressText = this.wrapper.querySelector('.compression-progress p');

        const altTexts = this.getAltTexts();

        this.compressor.setProgressCallback((current, total, result) => {
            const percentage = Math.round((current / total) * 100);
            progressFill.style.width = `${percentage}%`;
            progressText.textContent = `압축 진행 중... (${current}/${total})`;

            // 개별 파일 결과 업데이트
            this.updatePreviewResult(current - 1, result);
        });

        try {
            const results = await this.compressor.compressFiles(this.originalFiles);
            this.compressedFiles = results.map(result => result.file).filter(file => file);
            
            // 압축된 파일에 alt 텍스트 메타데이터 추가
            this.compressedFiles.forEach((file, index) => {
                if (altTexts[index]) {
                    file.altText = altTexts[index];
                }
            });
            
            // 원본 input에 압축된 파일 설정
            this.updateOriginalInput();
            
            // alt 텍스트를 히든 필드에 저장
            this.updateAltTextHiddenFields(altTexts);
            
            progressText.textContent = '압축 완료!';
            
            // 총 압축 결과 표시
            this.showCompressionSummary(results);
            
        } catch (error) {
            console.error('압축 중 오류 발생:', error);
            progressText.textContent = '압축 중 오류가 발생했습니다.';
        }
    }

    updateAltTextHiddenFields(altTexts) {
        // 기존 히든 필드들 제거
        this.wrapper.querySelectorAll('input[name*="altText"]').forEach(input => input.remove());
        
        // 새로운 히든 필드들 생성
        altTexts.forEach((altText, index) => {
            if (altText) {
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = `${this.input.name}_altText_${index}`;
                hiddenInput.value = altText;
                this.wrapper.appendChild(hiddenInput);
            }
        });

        // 단일 파일인 경우 기본 이름으로도 생성
        if (altTexts.length === 1 && altTexts[0]) {
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = `${this.input.name.replace('File', 'AltText')}`;
            hiddenInput.value = altTexts[0];
            this.wrapper.appendChild(hiddenInput);
        }
    }
}

// 전역 사용을 위한 함수
window.ImageCompressor = ImageCompressor;
window.ImageCompressorUI = ImageCompressorUI;

// 자동 초기화 (data-image-compressor 속성이 있는 input들에 대해)
document.addEventListener('DOMContentLoaded', () => {
    const inputs = document.querySelectorAll('input[type="file"][data-image-compressor]');
    inputs.forEach(input => {
        const options = input.dataset.imageCompressor ? JSON.parse(input.dataset.imageCompressor) : {};
        new ImageCompressorUI(`#${input.id}`, options);
    });
});
````

## File: src/main/resources/static/js/job-detail.js
````javascript
/**
 * 구인구직 상세보기 페이지 JavaScript
 * Thymeleaf 충돌 방지를 위해 단순화된 버전
 */

// 전역 변수
let currentJobId = null;

// DOM 로드 완료 후 초기화
document.addEventListener('DOMContentLoaded', function() {
    console.log('구인구직 상세보기 페이지 JavaScript 로드됨');
    
    // URL에서 구인구직 ID 추출
    currentJobId = extractJobIdFromUrl();
    if (!currentJobId) {
        currentJobId = document.getElementById('jobId')?.value;
    }
    console.log('현재 구인구직 ID:', currentJobId);
    
    // 이벤트 리스너 초기화
    initializeEventListeners();
});

/**
 * URL에서 구인구직 ID 추출
 */
function extractJobIdFromUrl() {
    const path = window.location.pathname;
    const segments = path.split('/');
    const detailIndex = segments.findIndex(segment => segment === 'detail');
    
    if (detailIndex !== -1 && detailIndex < segments.length - 1) {
        return segments[detailIndex + 1];
    }
    
    console.warn('URL에서 구인구직 ID를 찾을 수 없습니다:', path);
    return null;
}

/**
 * 이벤트 리스너 초기화
 */
function initializeEventListeners() {
    // 지원하기 버튼
    const applyBtn = document.querySelector('[onclick="applyJob()"]');
    if (applyBtn) {
        applyBtn.removeAttribute('onclick');
        applyBtn.addEventListener('click', applyJob);
    }
    
    // 연락하기 버튼
    const contactBtn = document.querySelector('[onclick="contactJob()"]');
    if (contactBtn) {
        contactBtn.removeAttribute('onclick');
        contactBtn.addEventListener('click', contactJob);
    }
    
    // 관심등록 버튼
    const bookmarkBtn = document.querySelector('[onclick="bookmarkJob()"]');
    if (bookmarkBtn) {
        bookmarkBtn.removeAttribute('onclick');
        bookmarkBtn.addEventListener('click', bookmarkJob);
    }
    
    // 공유 버튼
    const shareBtn = document.querySelector('[onclick="shareJob()"]');
    if (shareBtn) {
        shareBtn.removeAttribute('onclick');
        shareBtn.addEventListener('click', shareJob);
    }
    
    // 삭제 버튼
    const deleteBtn = document.querySelector('[onclick="deleteJob()"]');
    if (deleteBtn) {
        deleteBtn.removeAttribute('onclick');
        deleteBtn.addEventListener('click', deleteJob);
    }
    
    // 쪽지 보내기 버튼
    const messageBtn = document.querySelector('[onclick="sendMessage()"]');
    if (messageBtn) {
        messageBtn.removeAttribute('onclick');
        messageBtn.addEventListener('click', sendMessage);
    }
    
    // 신고 버튼
    const reportBtn = document.querySelector('[onclick="reportJob()"]');
    if (reportBtn) {
        reportBtn.removeAttribute('onclick');
        reportBtn.addEventListener('click', reportJob);
    }
}

/**
 * 지원하기 기능
 */
function applyJob() {
    if (!currentJobId) {
        alert('오류: 구인구직 정보를 찾을 수 없습니다.');
        return;
    }
    
    if (confirm('이 구인에 지원하시겠습니까?')) {
        // TODO: 실제 지원 로직 구현
        fetch(`/job/${currentJobId}/apply`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                jobId: currentJobId
            })
        })
        .then(response => {
            if (response.ok) {
                alert('지원이 완료되었습니다. 담당자가 연락드릴 예정입니다.');
                location.reload();
            } else {
                throw new Error('지원 처리 중 오류가 발생했습니다.');
            }
        })
        .catch(error => {
            console.error('지원 오류:', error);
            alert('지원 처리 중 오류가 발생했습니다. 다시 시도해주세요.');
        });
    }
}

/**
 * 연락하기 기능
 */
function contactJob() {
    const contactPhone = document.querySelector('#contactPhone')?.value;
    const contactEmail = document.querySelector('#contactEmail')?.value;
    
    if (contactPhone) {
        if (confirm('담당자에게 연락하시겠습니까?\n연락처: ' + contactPhone)) {
            window.location.href = 'tel:' + contactPhone;
        }
    } else if (contactEmail) {
        if (confirm('담당자에게 이메일을 보내시겠습니까?\n이메일: ' + contactEmail)) {
            window.location.href = 'mailto:' + contactEmail;
        }
    } else {
        alert('연락처 정보가 없습니다.');
    }
}

/**
 * 관심등록 기능
 */
function bookmarkJob() {
    if (!currentJobId) {
        alert('오류: 구인구직 정보를 찾을 수 없습니다.');
        return;
    }
    
    alert('관심등록 기능은 추후 구현 예정입니다.');
}

/**
 * 공유 기능
 */
function shareJob() {
    const url = window.location.href;
    const title = document.querySelector('h3')?.textContent || '구인구직';
    
    if (navigator.share) {
        navigator.share({
            title: title,
            url: url
        }).catch(error => {
            console.log('공유 실패:', error);
            fallbackShare(url);
        });
    } else {
        fallbackShare(url);
    }
}

/**
 * 공유 기능 대체 방법 (클립보드 복사)
 */
function fallbackShare(url) {
    if (navigator.clipboard) {
        navigator.clipboard.writeText(url).then(() => {
            alert('링크가 클립보드에 복사되었습니다.');
        }).catch(() => {
            promptShare(url);
        });
    } else {
        promptShare(url);
    }
}

/**
 * URL 수동 복사 안내
 */
function promptShare(url) {
    const textArea = document.createElement('textarea');
    textArea.value = url;
    document.body.appendChild(textArea);
    textArea.select();
    
    try {
        document.execCommand('copy');
        alert('링크가 클립보드에 복사되었습니다.');
    } catch (err) {
        alert('링크 복사에 실패했습니다. 수동으로 복사해주세요:\n' + url);
    }
    
    document.body.removeChild(textArea);
}

/**
 * 구인구직 삭제 기능
 */
function deleteJob() {
    if (!currentJobId) {
        alert('오류: 구인구직 정보를 찾을 수 없습니다.');
        return;
    }
    
    if (confirm('정말로 이 구인구직을 삭제하시겠습니까?\n삭제된 데이터는 복구할 수 없습니다.')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/job/delete/${currentJobId}`;
        
        // CSRF 토큰이 필요한 경우 추가
        const csrfToken = document.querySelector('meta[name="_csrf"]');
        if (csrfToken) {
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = '_csrf';
            csrfInput.value = csrfToken.getAttribute('content');
            form.appendChild(csrfInput);
        }
        
        document.body.appendChild(form);
        form.submit();
    }
}

/**
 * 쪽지 보내기 기능
 */
function sendMessage() {
    alert('쪽지 기능은 추후 구현 예정입니다.');
}

/**
 * 신고 기능
 */
function reportJob() {
    if (!currentJobId) {
        alert('오류: 구인구직 정보를 찾을 수 없습니다.');
        return;
    }
    
    const reason = prompt('신고 사유를 입력해주세요:');
    if (reason && reason.trim()) {
        if (confirm('이 구인구직을 신고하시겠습니까?\n사유: ' + reason)) {
            // TODO: 실제 신고 로직 구현
            fetch(`/job/${currentJobId}/report`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    jobId: currentJobId,
                    reason: reason.trim()
                })
            })
            .then(response => {
                if (response.ok) {
                    alert('신고가 접수되었습니다. 검토 후 조치하겠습니다.');
                } else {
                    throw new Error('신고 처리 중 오류가 발생했습니다.');
                }
            })
            .catch(error => {
                console.error('신고 오류:', error);
                alert('신고 처리 중 오류가 발생했습니다. 다시 시도해주세요.');
            });
        }
    }
}
````

## File: src/main/resources/static/js/my-posts.js
````javascript
// 내가 쓴 글 페이지 JavaScript
// Thymeleaf 인라인 JavaScript를 사용하지 않고 완전히 분리된 JavaScript 파일

document.addEventListener('DOMContentLoaded', function() {
    // DOM 요소 선택
    const elements = {
        filterButtons: document.querySelectorAll('.filter-btn'),
        sortSelect: document.getElementById('sortSelect'),
        postsContainer: document.getElementById('postsContainer'),
        postItems: document.querySelectorAll('.post-item'),
        tableBody: document.querySelector('#postsContainer tbody')
    };

    // 디버깅: DOM 요소 확인
    console.log('내가 쓴 글 페이지 DOM 요소:', {
        filterButtons: elements.filterButtons.length,
        sortSelect: elements.sortSelect ? 'found' : 'not found',
        postsContainer: elements.postsContainer ? 'found' : 'not found',
        postItems: elements.postItems.length,
        tableBody: elements.tableBody ? 'found' : 'not found'
    });

    // 현재 URL에서 파라미터 추출
    const urlParams = new URLSearchParams(window.location.search);
    const currentType = urlParams.get('type') || 'all';
    const currentPage = parseInt(urlParams.get('page')) || 1;
    const currentPageSize = parseInt(urlParams.get('pageSize')) || 10;

    // 필터 버튼 이벤트 설정
    function setupFilterButtons() {
        elements.filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                const selectedType = this.getAttribute('data-type');
                
                if (selectedType !== currentType) {
                    // URL 파라미터를 변경하여 페이지 이동
                    const newUrl = new URL(window.location.href);
                    newUrl.searchParams.set('type', selectedType);
                    newUrl.searchParams.set('page', '1'); // 첫 페이지로 리셋
                    
                    console.log('필터 변경:', selectedType);
                    window.location.href = newUrl.toString();
                }
            });
        });
    }

    // 정렬 기능
    function setupSorting() {
        if (!elements.sortSelect || !elements.tableBody) return;

        elements.sortSelect.addEventListener('change', function() {
            const sortType = this.value;
            console.log('정렬 변경:', sortType);
            
            // 현재 보이는 게시글들을 배열로 변환
            const rows = Array.from(elements.tableBody.querySelectorAll('.post-item'));
            
            // 정렬 기준에 따라 정렬
            rows.sort((a, b) => {
                switch (sortType) {
                    case 'latest':
                        // 최신순 (기본값)
                        const dateA = new Date(a.getAttribute('data-created'));
                        const dateB = new Date(b.getAttribute('data-created'));
                        return dateB - dateA;
                        
                    case 'oldest':
                        // 오래된순
                        const oldDateA = new Date(a.getAttribute('data-created'));
                        const oldDateB = new Date(b.getAttribute('data-created'));
                        return oldDateA - oldDateB;
                        
                    case 'views':
                        // 조회순
                        const viewsA = parseInt(a.getAttribute('data-views')) || 0;
                        const viewsB = parseInt(b.getAttribute('data-views')) || 0;
                        return viewsB - viewsA;
                        
                    case 'likes':
                        // 추천순
                        const likesA = parseInt(a.getAttribute('data-likes')) || 0;
                        const likesB = parseInt(b.getAttribute('data-likes')) || 0;
                        return likesB - likesA;
                        
                    default:
                        return 0;
                }
            });
            
            // 정렬된 순서로 DOM 재배치
            rows.forEach(row => {
                elements.tableBody.appendChild(row);
            });
            
            // 정렬 애니메이션 효과
            rows.forEach((row, index) => {
                row.style.opacity = '0.5';
                setTimeout(() => {
                    row.style.opacity = '1';
                    row.style.transition = 'opacity 0.2s ease';
                }, index * 30);
            });
        });
    }

    // 테이블 행 호버 효과 (간단한)
    function setupRowEffects() {
        const postRows = document.querySelectorAll('.post-item');
        
        postRows.forEach(row => {
            row.addEventListener('mouseenter', function() {
                this.style.backgroundColor = '#f8f9fa';
            });
            
            row.addEventListener('mouseleave', function() {
                this.style.backgroundColor = '';
            });
        });
    }

    // 페이지 로드 완료 메시지
    function showLoadedMessage() {
        const totalPosts = elements.postItems.length;
        if (totalPosts > 0) {
            console.log(`내가 쓴 글 페이지 로드 완료: ${totalPosts}개 게시글`);
        }
    }

    // 초기화 함수
    function init() {
        setupFilterButtons();
        setupSorting();
        setupRowEffects();
        showLoadedMessage();
        
        console.log('내가 쓴 글 페이지 JavaScript 초기화 완료');
    }

    // 초기화 실행
    init();
});
````

## File: src/main/resources/static/js/phone-formatter.js
````javascript
/**
 * 한국 전화번호 포맷팅 유틸리티
 * 지역번호별 정확한 형식 적용
 */
class PhoneFormatter {
    constructor() {
        // 지역번호별 패턴 정의
        this.patterns = {
            // 서울 (02): 2-3-4 또는 2-4-4
            '^02': [
                { pattern: /^(02)(\d{3})(\d{4})$/, format: '$1-$2-$3' },
                { pattern: /^(02)(\d{4})(\d{4})$/, format: '$1-$2-$3' }
            ],
            // 부산(051), 대구(053), 인천(032), 광주(062), 대전(042), 울산(052): 3-3-4
            '^(051|053|032|062|042|052)': [
                { pattern: /^(051|053|032|062|042|052)(\d{3})(\d{4})$/, format: '$1-$2-$3' }
            ],
            // 경기 지역 (031): 3-3-4 또는 3-4-4
            '^031': [
                { pattern: /^(031)(\d{3})(\d{4})$/, format: '$1-$2-$3' },
                { pattern: /^(031)(\d{4})(\d{4})$/, format: '$1-$2-$3' }
            ],
            // 강원도 (033): 3-3-4
            '^033': [
                { pattern: /^(033)(\d{3})(\d{4})$/, format: '$1-$2-$3' }
            ],
            // 충북 (043): 3-3-4
            '^043': [
                { pattern: /^(043)(\d{3})(\d{4})$/, format: '$1-$2-$3' }
            ],
            // 충남 (041): 3-3-4
            '^041': [
                { pattern: /^(041)(\d{3})(\d{4})$/, format: '$1-$2-$3' }
            ],
            // 전북 (063): 3-3-4
            '^063': [
                { pattern: /^(063)(\d{3})(\d{4})$/, format: '$1-$2-$3' }
            ],
            // 전남 (061): 3-3-4
            '^061': [
                { pattern: /^(061)(\d{3})(\d{4})$/, format: '$1-$2-$3' }
            ],
            // 경북 (054): 3-3-4
            '^054': [
                { pattern: /^(054)(\d{3})(\d{4})$/, format: '$1-$2-$3' }
            ],
            // 경남 (055): 3-3-4
            '^055': [
                { pattern: /^(055)(\d{3})(\d{4})$/, format: '$1-$2-$3' }
            ],
            // 제주 (064): 3-3-4
            '^064': [
                { pattern: /^(064)(\d{3})(\d{4})$/, format: '$1-$2-$3' }
            ],
            // 휴대폰 (010, 011, 016, 017, 018, 019): 3-4-4
            '^(010|011|016|017|018|019)': [
                { pattern: /^(010|011|016|017|018|019)(\d{4})(\d{4})$/, format: '$1-$2-$3' }
            ],
            // 인터넷 전화 (070): 3-4-4
            '^070': [
                { pattern: /^(070)(\d{4})(\d{4})$/, format: '$1-$2-$3' }
            ],
            // 기타 4자리 지역번호: 4-3-4
            '^(0\d{3})': [
                { pattern: /^(0\d{3})(\d{3})(\d{4})$/, format: '$1-$2-$3' }
            ]
        };
    }

    /**
     * 전화번호를 지역번호에 맞게 포맷팅
     * @param {string} phone - 포맷팅할 전화번호
     * @returns {string} 포맷팅된 전화번호
     */
    format(phone) {
        if (!phone) return '';
        
        // 숫자만 추출
        const cleaned = phone.replace(/\D/g, '');
        
        // 빈 문자열이거나 너무 짧으면 그대로 반환
        if (!cleaned || cleaned.length < 8) {
            return cleaned;
        }

        // 각 패턴에 대해 매칭 시도
        for (const [areaCodePattern, formatRules] of Object.entries(this.patterns)) {
            const areaRegex = new RegExp(areaCodePattern);
            
            if (areaRegex.test(cleaned)) {
                // 해당 지역번호의 포맷 규칙들을 시도
                for (const rule of formatRules) {
                    if (rule.pattern.test(cleaned)) {
                        return cleaned.replace(rule.pattern, rule.format);
                    }
                }
            }
        }

        // 매칭되지 않는 경우 기본 포맷 적용
        return this.applyDefaultFormat(cleaned);
    }

    /**
     * 기본 포맷 적용 (매칭되지 않는 번호용)
     * @param {string} cleaned - 숫자만 있는 전화번호
     * @returns {string} 기본 포맷팅된 전화번호
     */
    applyDefaultFormat(cleaned) {
        if (cleaned.length === 10) {
            // 10자리: 3-3-4
            return cleaned.replace(/^(\d{3})(\d{3})(\d{4})$/, '$1-$2-$3');
        } else if (cleaned.length === 11) {
            // 11자리: 3-4-4 (휴대폰) 또는 4-3-4 (일부 지역번호)
            if (cleaned.startsWith('010') || cleaned.startsWith('070')) {
                return cleaned.replace(/^(\d{3})(\d{4})(\d{4})$/, '$1-$2-$3');
            } else {
                return cleaned.replace(/^(\d{4})(\d{3})(\d{4})$/, '$1-$2-$3');
            }
        } else if (cleaned.length === 9) {
            // 9자리: 2-3-4 (서울 일부)
            return cleaned.replace(/^(\d{2})(\d{3})(\d{4})$/, '$1-$2-$3');
        }
        
        return cleaned;
    }

    /**
     * 전화번호 유효성 검사
     * @param {string} phone - 검사할 전화번호
     * @returns {object} 검사 결과
     */
    validate(phone) {
        const cleaned = phone.replace(/\D/g, '');
        const result = {
            isValid: false,
            type: '',
            message: '',
            formatted: ''
        };

        if (!cleaned) {
            result.message = '전화번호를 입력해주세요.';
            return result;
        }

        if (cleaned.length < 8) {
            result.message = '전화번호가 너무 짧습니다.';
            return result;
        }

        if (cleaned.length > 11) {
            result.message = '전화번호가 너무 깁니다.';
            return result;
        }

        // 휴대폰 번호 검사
        if (/^(010|011|016|017|018|019)\d{8}$/.test(cleaned)) {
            result.isValid = true;
            result.type = '휴대폰';
            result.formatted = this.format(cleaned);
            result.message = '올바른 휴대폰 번호입니다.';
            return result;
        }

        // 인터넷 전화 검사
        if (/^070\d{8}$/.test(cleaned)) {
            result.isValid = true;
            result.type = '인터넷전화';
            result.formatted = this.format(cleaned);
            result.message = '올바른 인터넷전화 번호입니다.';
            return result;
        }

        // 일반 전화 검사
        for (const [areaCodePattern, formatRules] of Object.entries(this.patterns)) {
            const areaRegex = new RegExp(areaCodePattern);
            
            if (areaRegex.test(cleaned)) {
                for (const rule of formatRules) {
                    if (rule.pattern.test(cleaned)) {
                        result.isValid = true;
                        result.type = '일반전화';
                        result.formatted = this.format(cleaned);
                        result.message = '올바른 전화번호입니다.';
                        return result;
                    }
                }
            }
        }

        result.message = '올바르지 않은 전화번호 형식입니다.';
        return result;
    }

    /**
     * 실시간 포맷팅을 위한 입력 핸들러
     * @param {HTMLElement} input - 입력 필드
     */
    attachToInput(input) {
        if (!input) return;

        const self = this;
        let lastValue = '';

        // 입력 이벤트 핸들러
        input.addEventListener('input', function(e) {
            const currentValue = e.target.value;
            const cursorPosition = e.target.selectionStart;
            const formatted = self.format(currentValue);
            
            // 포맷팅된 값이 다르면 업데이트
            if (formatted !== currentValue) {
                e.target.value = formatted;
                
                // 커서 위치 조정
                const diff = formatted.length - currentValue.length;
                e.target.setSelectionRange(cursorPosition + diff, cursorPosition + diff);
            }
            
            lastValue = formatted;
        });

        // 포커스 아웃 시 유효성 검사
        input.addEventListener('blur', function(e) {
            const validation = self.validate(e.target.value);
            
            // 유효성 검사 결과에 따른 UI 업데이트
            const feedbackElement = input.parentNode.querySelector('.phone-feedback');
            if (feedbackElement) {
                feedbackElement.remove();
            }

            if (e.target.value.trim() !== '') {
                const feedback = document.createElement('div');
                feedback.className = `phone-feedback small mt-1 ${validation.isValid ? 'text-success' : 'text-danger'}`;
                feedback.innerHTML = `<i class="fas ${validation.isValid ? 'fa-check-circle' : 'fa-exclamation-circle'} me-1"></i>${validation.message}`;
                
                input.parentNode.appendChild(feedback);
                
                if (validation.isValid) {
                    input.classList.remove('is-invalid');
                    input.classList.add('is-valid');
                } else {
                    input.classList.remove('is-valid');
                    input.classList.add('is-invalid');
                }
            } else {
                input.classList.remove('is-valid', 'is-invalid');
            }
        });

        // 키보드 이벤트 (숫자와 하이픈만 허용)
        input.addEventListener('keypress', function(e) {
            const allowedKeys = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '-', 'Backspace', 'Delete', 'Tab', 'Enter'];
            
            if (!allowedKeys.includes(e.key) && !e.ctrlKey && !e.metaKey) {
                e.preventDefault();
            }
        });
    }
}

// 전역에서 사용할 수 있도록 인스턴스 생성
window.phoneFormatter = new PhoneFormatter();

// DOM이 로드되면 자동으로 전화번호 필드에 적용
document.addEventListener('DOMContentLoaded', function() {
    // 전화번호 입력 필드 자동 감지 및 적용
    const phoneInputs = document.querySelectorAll('input[type="tel"], input[name*="phone"], input[id*="phone"]');
    
    phoneInputs.forEach(input => {
        window.phoneFormatter.attachToInput(input);
    });
});
````

## File: src/main/resources/static/js/rich-text-editor.js
````javascript
/**
 * 라이트케어 전용 리치 텍스트 에디터
 * 테이블, 이미지, 링크 등 고급 서식 기능 지원
 */
class RichTextEditor {
    constructor(selector, options = {}) {
        this.element = document.querySelector(selector);
        if (!this.element) {
            console.error('RichTextEditor: Element not found:', selector);
            return;
        }

        this.options = {
            height: options.height || '300px',
            placeholder: options.placeholder || '내용을 입력하세요...',
            enableImage: options.enableImage !== false,
            enableTable: options.enableTable !== false,
            enableLink: options.enableLink !== false,
            imageUploadUrl: options.imageUploadUrl || '/api/upload/image',
            maxImageSize: options.maxImageSize || 5 * 1024 * 1024, // 5MB
            allowedImageTypes: options.allowedImageTypes || ['image/jpeg', 'image/png', 'image/gif', 'image/webp'],
            toolbar: options.toolbar || [
                'bold', 'italic', 'underline', 'strikethrough',
                '|',
                'fontSize', 'color', 'backgroundColor',
                '|',
                'alignLeft', 'alignCenter', 'alignRight', 'alignJustify',
                '|',
                'orderedList', 'unorderedList', 'indent', 'outdent',
                '|',
                'link', 'image', 'table',
                '|',
                'blockquote', 'codeBlock',
                '|',
                'undo', 'redo',
                '|',
                'fullscreen', 'sourceCode'
            ],
            ...options
        };

        this.init();
    }

    init() {
        this.createEditor();
        this.bindEvents();
        this.initializeContent();
    }

    createEditor() {
        // 기존 textarea 숨기기
        this.element.style.display = 'none';

        // 에디터 컨테이너 생성
        this.container = document.createElement('div');
        this.container.className = 'rich-text-editor';
        this.container.innerHTML = `
            <div class="rte-toolbar">
                ${this.generateToolbar()}
            </div>
            <div class="rte-content" contenteditable="true" style="height: ${this.options.height}">
                ${this.options.placeholder ? `<p class="rte-placeholder">${this.options.placeholder}</p>` : ''}
            </div>
            <div class="rte-statusbar">
                <span class="rte-word-count">단어 수: 0</span>
                <span class="rte-char-count">글자 수: 0</span>
            </div>
        `;

        // textarea 다음에 에디터 삽입
        this.element.parentNode.insertBefore(this.container, this.element.nextSibling);

        // 에디터 요소들 참조 저장
        this.toolbar = this.container.querySelector('.rte-toolbar');
        this.content = this.container.querySelector('.rte-content');
        this.statusbar = this.container.querySelector('.rte-statusbar');

        // 히든 파일 입력 생성 (이미지 업로드용)
        this.fileInput = document.createElement('input');
        this.fileInput.type = 'file';
        this.fileInput.accept = this.options.allowedImageTypes.join(',');
        this.fileInput.style.display = 'none';
        this.container.appendChild(this.fileInput);
    }

    generateToolbar() {
        const toolbarGroups = [];
        let currentGroup = [];

        this.options.toolbar.forEach(tool => {
            if (tool === '|') {
                if (currentGroup.length > 0) {
                    toolbarGroups.push(currentGroup);
                    currentGroup = [];
                }
            } else {
                currentGroup.push(tool);
            }
        });

        if (currentGroup.length > 0) {
            toolbarGroups.push(currentGroup);
        }

        return toolbarGroups.map(group => 
            `<div class="rte-toolbar-group">
                ${group.map(tool => this.generateToolButton(tool)).join('')}
            </div>`
        ).join('');
    }

    generateToolButton(tool) {
        const buttons = {
            'bold': '<button type="button" class="rte-btn" data-command="bold" title="굵게 (Ctrl+B)"><i class="fas fa-bold"></i></button>',
            'italic': '<button type="button" class="rte-btn" data-command="italic" title="기울임 (Ctrl+I)"><i class="fas fa-italic"></i></button>',
            'underline': '<button type="button" class="rte-btn" data-command="underline" title="밑줄 (Ctrl+U)"><i class="fas fa-underline"></i></button>',
            'strikethrough': '<button type="button" class="rte-btn" data-command="strikeThrough" title="취소선"><i class="fas fa-strikethrough"></i></button>',
            
            'fontSize': `<select class="rte-select" data-command="fontSize" title="글자 크기">
                <option value="">크기</option>
                <option value="1">매우 작게</option>
                <option value="2">작게</option>
                <option value="3">보통</option>
                <option value="4">크게</option>
                <option value="5">매우 크게</option>
                <option value="6">더 크게</option>
                <option value="7">가장 크게</option>
            </select>`,
            
            'color': '<input type="color" class="rte-color" data-command="foreColor" title="글자 색상" value="#000000">',
            'backgroundColor': '<input type="color" class="rte-color" data-command="backColor" title="배경 색상" value="#ffffff">',
            
            'alignLeft': '<button type="button" class="rte-btn" data-command="justifyLeft" title="왼쪽 정렬"><i class="fas fa-align-left"></i></button>',
            'alignCenter': '<button type="button" class="rte-btn" data-command="justifyCenter" title="가운데 정렬"><i class="fas fa-align-center"></i></button>',
            'alignRight': '<button type="button" class="rte-btn" data-command="justifyRight" title="오른쪽 정렬"><i class="fas fa-align-right"></i></button>',
            'alignJustify': '<button type="button" class="rte-btn" data-command="justifyFull" title="양쪽 정렬"><i class="fas fa-align-justify"></i></button>',
            
            'orderedList': '<button type="button" class="rte-btn" data-command="insertOrderedList" title="번호 목록"><i class="fas fa-list-ol"></i></button>',
            'unorderedList': '<button type="button" class="rte-btn" data-command="insertUnorderedList" title="글머리 목록"><i class="fas fa-list-ul"></i></button>',
            'indent': '<button type="button" class="rte-btn" data-command="indent" title="들여쓰기"><i class="fas fa-indent"></i></button>',
            'outdent': '<button type="button" class="rte-btn" data-command="outdent" title="내어쓰기"><i class="fas fa-outdent"></i></button>',
            
            'link': '<button type="button" class="rte-btn" data-command="createLink" title="링크 삽입"><i class="fas fa-link"></i></button>',
            'image': '<button type="button" class="rte-btn" data-command="insertImage" title="이미지 삽입"><i class="fas fa-image"></i></button>',
            'table': '<button type="button" class="rte-btn" data-command="insertTable" title="테이블 삽입"><i class="fas fa-table"></i></button>',
            
            'blockquote': '<button type="button" class="rte-btn" data-command="blockquote" title="인용문"><i class="fas fa-quote-left"></i></button>',
            'codeBlock': '<button type="button" class="rte-btn" data-command="code" title="코드 블록"><i class="fas fa-code"></i></button>',
            
            'undo': '<button type="button" class="rte-btn" data-command="undo" title="실행 취소 (Ctrl+Z)"><i class="fas fa-undo"></i></button>',
            'redo': '<button type="button" class="rte-btn" data-command="redo" title="다시 실행 (Ctrl+Y)"><i class="fas fa-redo"></i></button>',
            
            'fullscreen': '<button type="button" class="rte-btn" data-command="fullscreen" title="전체화면"><i class="fas fa-expand"></i></button>',
            'sourceCode': '<button type="button" class="rte-btn" data-command="sourceCode" title="소스 코드 보기"><i class="fas fa-code"></i></button>'
        };

        return buttons[tool] || '';
    }

    bindEvents() {
        // 툴바 버튼 클릭 이벤트
        this.toolbar.addEventListener('click', (e) => {
            const button = e.target.closest('.rte-btn');
            if (button) {
                e.preventDefault();
                this.executeCommand(button.dataset.command);
            }
        });

        // 셀렉트 박스 변경 이벤트
        this.toolbar.addEventListener('change', (e) => {
            if (e.target.classList.contains('rte-select')) {
                this.executeCommand(e.target.dataset.command, e.target.value);
            }
        });

        // 색상 선택 이벤트
        this.toolbar.addEventListener('input', (e) => {
            if (e.target.classList.contains('rte-color')) {
                this.executeCommand(e.target.dataset.command, e.target.value);
            }
        });

        // 에디터 내용 변경 이벤트
        this.content.addEventListener('input', () => {
            this.updateOriginalTextarea();
            this.updateStatusBar();
            this.handlePlaceholder();
        });

        // 에디터 포커스 이벤트
        this.content.addEventListener('focus', () => {
            this.handlePlaceholder();
        });

        // 에디터 블러 이벤트
        this.content.addEventListener('blur', () => {
            this.handlePlaceholder();
        });

        // 키보드 단축키
        this.content.addEventListener('keydown', (e) => {
            this.handleKeyboardShortcuts(e);
        });

        // 파일 입력 변경 이벤트
        this.fileInput.addEventListener('change', (e) => {
            this.handleImageUpload(e.target.files[0]);
        });

        // 드래그 앤 드롭 이벤트
        this.content.addEventListener('dragover', (e) => {
            e.preventDefault();
            this.content.classList.add('rte-dragover');
        });

        this.content.addEventListener('dragleave', (e) => {
            e.preventDefault();
            this.content.classList.remove('rte-dragover');
        });

        this.content.addEventListener('drop', (e) => {
            e.preventDefault();
            this.content.classList.remove('rte-dragover');
            
            const files = Array.from(e.dataTransfer.files);
            const imageFile = files.find(file => this.options.allowedImageTypes.includes(file.type));
            
            if (imageFile) {
                this.handleImageUpload(imageFile);
            }
        });
    }

    executeCommand(command, value = null) {
        this.content.focus();

        switch (command) {
            case 'createLink':
                this.insertLink();
                break;
            case 'insertImage':
                this.insertImage();
                break;
            case 'insertTable':
                this.insertTable();
                break;
            case 'blockquote':
                this.insertBlockquote();
                break;
            case 'code':
                this.insertCodeBlock();
                break;
            case 'fullscreen':
                this.toggleFullscreen();
                break;
            case 'sourceCode':
                this.toggleSourceCode();
                break;
            case 'fontSize':
                if (value) {
                    document.execCommand('fontSize', false, value);
                }
                break;
            case 'foreColor':
            case 'backColor':
                document.execCommand(command, false, value);
                break;
            default:
                document.execCommand(command, false, value);
        }

        this.updateOriginalTextarea();
    }

    insertLink() {
        const selection = window.getSelection();
        const selectedText = selection.toString();
        
        const url = prompt('링크 URL을 입력하세요:', 'https://');
        if (url && url !== 'https://') {
            const linkText = selectedText || prompt('링크 텍스트를 입력하세요:', url);
            if (linkText) {
                const link = `<a href="${url}" target="_blank" rel="noopener noreferrer">${linkText}</a>`;
                this.insertHTML(link);
            }
        }
    }

    insertImage() {
        this.fileInput.click();
    }

    async handleImageUpload(file) {
        if (!file) return;

        // 파일 타입 검증
        if (!this.options.allowedImageTypes.includes(file.type)) {
            alert('지원되지 않는 이미지 형식입니다.');
            return;
        }

        // 파일 크기 검증
        if (file.size > this.options.maxImageSize) {
            alert(`이미지 크기는 ${this.formatFileSize(this.options.maxImageSize)} 이하여야 합니다.`);
            return;
        }

        // 로딩 표시
        const loadingImg = '<span class="rte-loading">이미지 업로드 중... <i class="fas fa-spinner fa-spin"></i></span>';
        this.insertHTML(loadingImg);

        try {
            // 이미지 압축 (이전에 만든 ImageCompressor 사용)
            if (window.ImageCompressor) {
                const compressor = new ImageCompressor({
                    quality: 0.8,
                    maxWidth: 1200,
                    maxHeight: 800
                });
                
                const result = await compressor.compressFile(file);
                file = result.file;
            }

            // 임시로 base64로 변환하여 미리보기 표시
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = `<img src="${e.target.result}" alt="업로드된 이미지" style="max-width: 100%; height: auto;" class="rte-uploaded-image">`;
                
                // 로딩 스피너 제거 후 이미지 삽입
                const loadingSpan = this.content.querySelector('.rte-loading');
                if (loadingSpan) {
                    loadingSpan.outerHTML = img;
                } else {
                    this.insertHTML(img);
                }
                
                this.updateOriginalTextarea();
            };
            reader.readAsDataURL(file);

            // 실제 서버 업로드는 폼 제출 시 처리하거나 별도 API 호출
            
        } catch (error) {
            console.error('이미지 업로드 실패:', error);
            alert('이미지 업로드에 실패했습니다.');
            
            // 로딩 스피너 제거
            const loadingSpan = this.content.querySelector('.rte-loading');
            if (loadingSpan) {
                loadingSpan.remove();
            }
        }
    }

    insertTable() {
        const rows = prompt('행 수를 입력하세요:', '3');
        const cols = prompt('열 수를 입력하세요:', '3');
        
        if (rows && cols && !isNaN(rows) && !isNaN(cols)) {
            let table = '<table class="rte-table table table-bordered"><tbody>';
            
            for (let i = 0; i < parseInt(rows); i++) {
                table += '<tr>';
                for (let j = 0; j < parseInt(cols); j++) {
                    table += '<td>&nbsp;</td>';
                }
                table += '</tr>';
            }
            
            table += '</tbody></table><p>&nbsp;</p>';
            this.insertHTML(table);
        }
    }

    insertBlockquote() {
        const selection = window.getSelection();
        const selectedText = selection.toString();
        
        if (selectedText) {
            const blockquote = `<blockquote class="blockquote">${selectedText}</blockquote>`;
            this.insertHTML(blockquote);
        } else {
            const blockquote = '<blockquote class="blockquote">인용문을 입력하세요...</blockquote>';
            this.insertHTML(blockquote);
        }
    }

    insertCodeBlock() {
        const selection = window.getSelection();
        const selectedText = selection.toString();
        
        if (selectedText) {
            const code = `<pre><code>${selectedText}</code></pre>`;
            this.insertHTML(code);
        } else {
            const code = '<pre><code>코드를 입력하세요...</code></pre>';
            this.insertHTML(code);
        }
    }

    insertHTML(html) {
        if (document.queryCommandSupported('insertHTML')) {
            document.execCommand('insertHTML', false, html);
        } else {
            // fallback for browsers that don't support insertHTML
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                range.deleteContents();
                
                const div = document.createElement('div');
                div.innerHTML = html;
                
                const fragment = document.createDocumentFragment();
                while (div.firstChild) {
                    fragment.appendChild(div.firstChild);
                }
                
                range.insertNode(fragment);
            }
        }
    }

    toggleFullscreen() {
        this.container.classList.toggle('rte-fullscreen');
        const btn = this.toolbar.querySelector('[data-command="fullscreen"] i');
        btn.className = this.container.classList.contains('rte-fullscreen') 
            ? 'fas fa-compress' 
            : 'fas fa-expand';
    }

    toggleSourceCode() {
        const isSourceMode = this.container.classList.contains('rte-source-mode');
        
        if (isSourceMode) {
            // 소스 모드에서 에디터 모드로
            const sourceTextarea = this.container.querySelector('.rte-source-textarea');
            this.content.innerHTML = sourceTextarea.value;
            sourceTextarea.remove();
            this.container.classList.remove('rte-source-mode');
        } else {
            // 에디터 모드에서 소스 모드로
            const sourceTextarea = document.createElement('textarea');
            sourceTextarea.className = 'rte-source-textarea';
            sourceTextarea.style.cssText = `
                width: 100%;
                height: ${this.options.height};
                border: none;
                outline: none;
                font-family: 'Courier New', monospace;
                font-size: 14px;
                padding: 10px;
                resize: none;
            `;
            sourceTextarea.value = this.content.innerHTML;
            
            this.content.style.display = 'none';
            this.content.parentNode.appendChild(sourceTextarea);
            this.container.classList.add('rte-source-mode');
        }
    }

    handleKeyboardShortcuts(e) {
        if (e.ctrlKey || e.metaKey) {
            switch (e.key.toLowerCase()) {
                case 'b':
                    e.preventDefault();
                    this.executeCommand('bold');
                    break;
                case 'i':
                    e.preventDefault();
                    this.executeCommand('italic');
                    break;
                case 'u':
                    e.preventDefault();
                    this.executeCommand('underline');
                    break;
                case 'z':
                    e.preventDefault();
                    this.executeCommand('undo');
                    break;
                case 'y':
                    e.preventDefault();
                    this.executeCommand('redo');
                    break;
            }
        }
    }

    handlePlaceholder() {
        const placeholder = this.content.querySelector('.rte-placeholder');
        const isEmpty = this.content.textContent.trim() === '' || 
                       (this.content.innerHTML.trim() === '<p class="rte-placeholder">' + this.options.placeholder + '</p>');

        if (isEmpty && !placeholder) {
            this.content.innerHTML = `<p class="rte-placeholder">${this.options.placeholder}</p>`;
        } else if (!isEmpty && placeholder) {
            placeholder.remove();
        }
    }

    updateOriginalTextarea() {
        let content = this.content.innerHTML;
        
        // placeholder 제거
        if (content.includes('rte-placeholder')) {
            content = '';
        }
        
        this.element.value = content;
        
        // 변경 이벤트 발생
        this.element.dispatchEvent(new Event('input', { bubbles: true }));
        this.element.dispatchEvent(new Event('change', { bubbles: true }));
    }

    updateStatusBar() {
        const text = this.content.textContent || '';
        const words = text.trim() ? text.trim().split(/\s+/).length : 0;
        const chars = text.length;
        
        this.statusbar.querySelector('.rte-word-count').textContent = `단어 수: ${words}`;
        this.statusbar.querySelector('.rte-char-count').textContent = `글자 수: ${chars}`;
    }

    initializeContent() {
        if (this.element.value) {
            this.content.innerHTML = this.element.value;
        }
        this.updateStatusBar();
        this.handlePlaceholder();
    }

    formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // 공개 API
    getContent() {
        return this.content.innerHTML;
    }

    setContent(html) {
        this.content.innerHTML = html;
        this.updateOriginalTextarea();
        this.updateStatusBar();
        this.handlePlaceholder();
    }

    focus() {
        this.content.focus();
    }

    destroy() {
        if (this.container) {
            this.container.remove();
        }
        this.element.style.display = '';
    }
}

// 전역 사용을 위한 함수
window.RichTextEditor = RichTextEditor;

// 자동 초기화 (data-rich-editor 속성이 있는 textarea들에 대해)
document.addEventListener('DOMContentLoaded', () => {
    const textareas = document.querySelectorAll('textarea[data-rich-editor]');
    textareas.forEach(textarea => {
        const options = textarea.dataset.richEditor ? JSON.parse(textarea.dataset.richEditor) : {};
        new RichTextEditor(`#${textarea.id}`, options);
    });
});
````

## File: src/main/resources/templates/admin/facilities.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>시설 승인 관리 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <!-- 브레드크럼 -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item"><a href="/admin">관리자 대시보드</a></li>
                <li class="breadcrumb-item active" aria-current="page">시설 승인 관리</li>
            </ol>
        </nav>

        <!-- 페이지 헤더 -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="h2 mb-3">
                    <i class="fas fa-check-circle text-warning me-2"></i>
                    시설 승인 관리
                </h1>
            </div>
        </div>

        <!-- 상태 필터 탭 -->
        <div class="row mb-4">
            <div class="col-12">
                <ul class="nav nav-tabs" id="statusTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" th:classappend="${currentStatus == 'PENDING' ? 'active' : ''}" 
                                type="button" onclick="loadFacilities('PENDING')">
                            <i class="fas fa-clock text-warning me-1"></i>
                            승인 대기 <span class="badge bg-warning ms-1">대기중</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" th:classappend="${currentStatus == 'APPROVED' ? 'active' : ''}" 
                                type="button" onclick="loadFacilities('APPROVED')">
                            <i class="fas fa-check text-success me-1"></i>
                            승인 완료 <span class="badge bg-success ms-1">승인</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" th:classappend="${currentStatus == 'REJECTED' ? 'active' : ''}" 
                                type="button" onclick="loadFacilities('REJECTED')">
                            <i class="fas fa-times text-danger me-1"></i>
                            승인 거부 <span class="badge bg-danger ms-1">거부</span>
                        </button>
                    </li>
                </ul>
            </div>
        </div>

        <!-- 시설 목록 -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body" id="facilityListContainer">
                        <div th:if="${facilities.empty}" class="text-center py-5">
                            <i class="fas fa-search fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">해당 상태의 시설이 없습니다.</h5>
                            <p class="text-muted mb-0">다른 상태 탭을 확인해보세요.</p>
                        </div>

                        <div th:unless="${facilities.empty}">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">시설명</th>
                                            <th scope="col">유형</th>
                                            <th scope="col">주소</th>
                                            <th scope="col">등록자</th>
                                            <th scope="col">등록일</th>
                                            <th scope="col">상태</th>
                                            <th scope="col">작업</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="facility, iterStat : ${facilities}">
                                            <th scope="row" th:text="${iterStat.count}">1</th>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div>
                                                        <h6 class="mb-0" th:text="${facility.facilityName}">시설명</h6>
                                                        <small class="text-muted" th:if="${facility.phone}" th:text="${facility.phone}">전화번호</small>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge bg-info" th:text="${facility.facilityType}">유형</span>
                                            </td>
                                            <td>
                                                <small th:text="${facility.address}">주소</small>
                                            </td>
                                            <td>
                                                <div>
                                                    <div th:text="${facility.registeredMemberName}">등록자명</div>
                                                    <small class="text-muted" th:text="'(' + ${facility.registeredUserName} + ')'">ID</small>
                                                </div>
                                            </td>
                                            <td>
                                                <small th:text="${#temporals.format(facility.createdAt, 'yyyy-MM-dd')}">등록일</small>
                                            </td>
                                            <td>
                                                <span th:if="${facility.approvalStatus == 'PENDING'}" class="badge bg-warning">승인대기</span>
                                                <span th:if="${facility.approvalStatus == 'APPROVED'}" class="badge bg-success">승인완료</span>
                                                <span th:if="${facility.approvalStatus == 'REJECTED'}" class="badge bg-danger">승인거부</span>
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm" role="group">
                                                    <button type="button" class="btn btn-outline-info" 
                                                            th:onclick="'viewFacilityDetail(' + ${facility.facilityId} + ')'">
                                                        <i class="fas fa-eye"></i> 상세
                                                    </button>
                                                    <div th:if="${facility.approvalStatus == 'PENDING'}">
                                                        <button type="button" class="btn btn-success btn-sm" 
                                                                th:onclick="'approveFacility(' + ${facility.facilityId} + ')'">
                                                            <i class="fas fa-check"></i> 승인
                                                        </button>
                                                        <button type="button" class="btn btn-danger btn-sm" 
                                                                th:onclick="'rejectFacility(' + ${facility.facilityId} + ')'">
                                                            <i class="fas fa-times"></i> 거부
                                                        </button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- 시설 상세 정보 모달 -->
<div class="modal fade" id="facilityDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">시설 상세 정보</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="facilityDetailContent">
                <!-- AJAX로 로드될 내용 -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>

<!-- 승인 거부 사유 입력 모달 -->
<div class="modal fade" id="rejectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">승인 거부 사유</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="rejectForm">
                    <input type="hidden" id="rejectFacilityId">
                    <div class="mb-3">
                        <label for="rejectionReason" class="form-label">거부 사유 <span class="text-danger">*</span></label>
                        <textarea class="form-control" id="rejectionReason" rows="4" 
                                  placeholder="승인 거부 사유를 상세히 입력해주세요." required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                <button type="button" class="btn btn-danger" onclick="confirmReject()">승인 거부</button>
            </div>
        </div>
    </div>
</div>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<script>
// 현재 상태 저장
let currentStatus = '[[${currentStatus}]]';

// 시설 목록 AJAX 로드
function loadFacilities(status) {
    // 탭 활성화 상태 변경
    $('.nav-tabs .nav-link').removeClass('active');
    event.target.classList.add('active');
    
    // 로딩 표시
    $('#facilityListContainer').html('<div class="text-center py-5"><i class="fas fa-spinner fa-spin fa-2x"></i><p class="mt-2">로딩 중...</p></div>');
    
    // AJAX 요청
    $.get('/admin/facilities', { status: status })
        .done(function(html) {
            // 응답에서 시설 목록 부분만 추출
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const facilityContent = doc.getElementById('facilityListContainer').innerHTML;
            $('#facilityListContainer').html(facilityContent);
            currentStatus = status;
        })
        .fail(function() {
            $('#facilityListContainer').html('<div class="text-center py-5 text-danger"><i class="fas fa-exclamation-triangle fa-2x"></i><p class="mt-2">시설 목록을 불러오는데 실패했습니다.</p></div>');
        });
}

// 시설 상세 정보 조회
function viewFacilityDetail(facilityId) {
    $.get('/admin/facilities/' + facilityId + '/detail')
        .done(function(facility) {
            if (facility) {
                let content = `
                    <div class="row">
                        <div class="col-md-6">
                            <h6>기본 정보</h6>
                            <table class="table table-sm">
                                <tr><td><strong>시설명:</strong></td><td>${facility.facilityName || '-'}</td></tr>
                                <tr><td><strong>유형:</strong></td><td>${facility.facilityType || '-'}</td></tr>
                                <tr><td><strong>전화번호:</strong></td><td>${facility.phone || '-'}</td></tr>
                                <tr><td><strong>수용인원:</strong></td><td>${facility.capacity || '-'}명</td></tr>
                                <tr><td><strong>운영시간:</strong></td><td>${facility.operatingHours || '-'}</td></tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6>등록 정보</h6>
                            <table class="table table-sm">
                                <tr><td><strong>등록자:</strong></td><td>${facility.registeredMemberName || '-'}</td></tr>
                                <tr><td><strong>등록 ID:</strong></td><td>${facility.registeredUserName || '-'}</td></tr>
                                <tr><td><strong>등록일:</strong></td><td>${facility.createdAt || '-'}</td></tr>
                                <tr><td><strong>승인상태:</strong></td><td>
                                    ${facility.approvalStatus === 'PENDING' ? '<span class="badge bg-warning">승인대기</span>' : 
                                      facility.approvalStatus === 'APPROVED' ? '<span class="badge bg-success">승인완료</span>' : 
                                      '<span class="badge bg-danger">승인거부</span>'}
                                </td></tr>
                            </table>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <h6>주소 정보</h6>
                            <p>${facility.address || '-'}</p>
                            ${facility.detailAddress ? '<p><small class="text-muted">상세: ' + facility.detailAddress + '</small></p>' : ''}
                        </div>
                    </div>
                    ${facility.description ? 
                        '<div class="row mt-3"><div class="col-12"><h6>시설 설명</h6><p>' + facility.description + '</p></div></div>' : ''}
                    ${facility.features ? 
                        '<div class="row mt-3"><div class="col-12"><h6>시설 특징</h6><p>' + facility.features + '</p></div></div>' : ''}
                    ${facility.rejectionReason ? 
                        '<div class="row mt-3"><div class="col-12"><h6 class="text-danger">거부 사유</h6><p class="text-danger">' + facility.rejectionReason + '</p></div></div>' : ''}
                `;
                
                $('#facilityDetailContent').html(content);
                $('#facilityDetailModal').modal('show');
            }
        })
        .fail(function() {
            alert('시설 정보를 불러올 수 없습니다.');
        });
}

// 시설 승인
function approveFacility(facilityId) {
    if (confirm('이 시설을 승인하시겠습니까?')) {
        $.post('/admin/facilities/' + facilityId + '/approve', {
            action: 'approve'
        })
        .done(function(result) {
            if (result === 'SUCCESS') {
                alert('시설이 승인되었습니다.');
                location.reload();
            } else {
                alert('승인 처리 중 오류가 발생했습니다.');
            }
        })
        .fail(function() {
            alert('승인 처리 중 오류가 발생했습니다.');
        });
    }
}

// 시설 승인 거부 (모달 열기)
function rejectFacility(facilityId) {
    $('#rejectFacilityId').val(facilityId);
    $('#rejectionReason').val('');
    $('#rejectModal').modal('show');
}

// 승인 거부 확인
function confirmReject() {
    const facilityId = $('#rejectFacilityId').val();
    const reason = $('#rejectionReason').val().trim();
    
    if (!reason) {
        alert('거부 사유를 입력해주세요.');
        return;
    }
    
    $.post('/admin/facilities/' + facilityId + '/approve', {
        action: 'reject',
        reason: reason
    })
    .done(function(result) {
        if (result === 'SUCCESS') {
            alert('시설 승인이 거부되었습니다.');
            $('#rejectModal').modal('hide');
            location.reload();
        } else {
            alert('거부 처리 중 오류가 발생했습니다.');
        }
    })
    .fail(function() {
        alert('거부 처리 중 오류가 발생했습니다.');
    });
}
</script>

</body>
</html>
````

## File: src/main/resources/templates/admin/members.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>회원 관리 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <!-- 브레드크럼 -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item"><a href="/admin">관리자 대시보드</a></li>
                <li class="breadcrumb-item active" aria-current="page">회원 관리</li>
            </ol>
        </nav>

        <!-- 페이지 헤더 -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="h2 mb-3">
                    <i class="fas fa-users text-primary me-2"></i>
                    회원 관리
                </h1>
            </div>
        </div>

        <!-- 역할별 필터 탭 -->
        <div class="row mb-4">
            <div class="col-12">
                <ul class="nav nav-tabs" id="roleTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" th:classappend="${currentRole == 'ALL' ? 'active' : ''}" 
                                type="button" onclick="loadMembers('ALL')">
                            <i class="fas fa-users text-secondary me-1"></i>
                            전체 회원 <span class="badge bg-secondary ms-1" th:text="${totalCount}">0</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" th:classappend="${currentRole == 'USER' ? 'active' : ''}" 
                                type="button" onclick="loadMembers('USER')">
                            <i class="fas fa-user text-info me-1"></i>
                            일반 회원 <span class="badge bg-info ms-1">일반</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" th:classappend="${currentRole == 'FACILITY' ? 'active' : ''}" 
                                type="button" onclick="loadMembers('FACILITY')">
                            <i class="fas fa-building text-success me-1"></i>
                            시설 회원 <span class="badge bg-success ms-1">시설</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" th:classappend="${currentRole == 'ADMIN' ? 'active' : ''}" 
                                type="button" onclick="loadMembers('ADMIN')">
                            <i class="fas fa-crown text-warning me-1"></i>
                            관리자 <span class="badge bg-warning ms-1">관리자</span>
                        </button>
                    </li>
                </ul>
            </div>
        </div>

        <!-- 회원 목록 -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body" id="memberListContainer">
                        <div th:if="${members == null or members.empty}" class="text-center py-5">
                            <i class="fas fa-user-slash fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">해당 역할의 회원이 없습니다.</h5>
                            <p class="text-muted mb-0">다른 역할 탭을 확인해보세요.</p>
                        </div>

                        <div th:unless="${members == null or members.empty}">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">아이디</th>
                                            <th scope="col">이름</th>
                                            <th scope="col">이메일</th>
                                            <th scope="col">전화번호</th>
                                            <th scope="col">역할</th>
                                            <th scope="col">가입일</th>
                                            <th scope="col">상태</th>
                                            <th scope="col">작업</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="member, iterStat : ${members}">
                                            <th scope="row" th:text="${iterStat.count}">1</th>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div>
                                                        <h6 class="mb-0" th:text="${member.userId}">아이디</h6>
                                                        <small class="text-muted" th:if="${member.lastLoginAt}" 
                                                               th:text="'최근로그인: ' + ${#temporals.format(member.lastLoginAt, 'MM-dd HH:mm')}">최근로그인</small>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <div th:text="${member.name}">이름</div>
                                            </td>
                                            <td>
                                                <small th:text="${member.email}">이메일</small>
                                            </td>
                                            <td>
                                                <small th:text="${member.phone}">전화번호</small>
                                            </td>
                                            <td>
                                                <span th:if="${member.role == 'USER'}" class="badge bg-info">일반</span>
                                                <span th:if="${member.role == 'FACILITY'}" class="badge bg-success">시설</span>
                                                <span th:if="${member.role == 'ADMIN'}" class="badge bg-warning">관리자</span>
                                            </td>
                                            <td>
                                                <small th:text="${#temporals.format(member.createdAt, 'yyyy-MM-dd')}">가입일</small>
                                            </td>
                                            <td>
                                                <span th:if="${member.isActive}" class="badge bg-success">활성</span>
                                                <span th:unless="${member.isActive}" class="badge bg-danger">비활성</span>
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm" role="group">
                                                    <button type="button" class="btn btn-outline-warning" 
                                                            th:onclick="'toggleMemberActive(' + ${member.memberId} + ')'">
                                                        <i class="fas fa-toggle-on" th:if="${member.isActive}"></i>
                                                        <i class="fas fa-toggle-off" th:unless="${member.isActive}"></i>
                                                        <span th:text="${member.isActive ? '비활성화' : '활성화'}">상태변경</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- 페이징 -->
                            <div th:if="${totalPages > 1}" class="d-flex justify-content-center mt-4">
                                <nav aria-label="회원 목록 페이지네이션">
                                    <ul class="pagination">
                                        <li class="page-item" th:classappend="${currentPage == 1 ? 'disabled' : ''}">
                                            <a class="page-link" th:href="@{/admin/members(role=${currentRole}, page=${currentPage - 1})}">이전</a>
                                        </li>
                                        <li th:each="page : ${#numbers.sequence(1, totalPages)}" 
                                            class="page-item" th:classappend="${page == currentPage ? 'active' : ''}">
                                            <a class="page-link" th:href="@{/admin/members(role=${currentRole}, page=${page})}" th:text="${page}">1</a>
                                        </li>
                                        <li class="page-item" th:classappend="${currentPage == totalPages ? 'disabled' : ''}">
                                            <a class="page-link" th:href="@{/admin/members(role=${currentRole}, page=${currentPage + 1})}">다음</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<script>
// 현재 역할 저장
let currentRole = '[[${currentRole}]]';

// 회원 목록 AJAX 로드
function loadMembers(role) {
    // 탭 활성화 상태 변경
    $('.nav-tabs .nav-link').removeClass('active');
    event.target.classList.add('active');
    
    // 로딩 표시
    $('#memberListContainer').html('<div class="text-center py-5"><i class="fas fa-spinner fa-spin fa-2x"></i><p class="mt-2">로딩 중...</p></div>');
    
    // AJAX 요청
    $.get('/admin/members', { role: role })
        .done(function(html) {
            // 응답에서 회원 목록 부분만 추출
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const memberContent = doc.getElementById('memberListContainer').innerHTML;
            $('#memberListContainer').html(memberContent);
            currentRole = role;
        })
        .fail(function() {
            $('#memberListContainer').html('<div class="text-center py-5 text-danger"><i class="fas fa-exclamation-triangle fa-2x"></i><p class="mt-2">회원 목록을 불러오는데 실패했습니다.</p></div>');
        });
}

// 회원 활성화 상태 토글
function toggleMemberActive(memberId) {
    if (confirm('이 회원의 활성화 상태를 변경하시겠습니까?')) {
        $.post('/admin/members/' + memberId + '/toggle-active')
            .done(function(result) {
                if (result === 'SUCCESS') {
                    alert('회원 상태가 변경되었습니다.');
                    location.reload();
                } else {
                    alert('상태 변경에 실패했습니다.');
                }
            })
            .fail(function() {
                alert('상태 변경 중 오류가 발생했습니다.');
            });
    }
}
</script>

</body>
</html>
````

## File: src/main/resources/templates/admin/statistics.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>통계 관리 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <!-- 브레드크럼 -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item"><a href="/admin">관리자 대시보드</a></li>
                <li class="breadcrumb-item active" aria-current="page">통계 관리</li>
            </ol>
        </nav>

        <!-- 페이지 헤더 -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="h2 mb-3">
                    <i class="fas fa-chart-bar text-info me-2"></i>
                    통계 관리
                </h1>
                <p class="text-muted">라이트케어 플랫폼의 전반적인 통계 정보를 확인할 수 있습니다.</p>
            </div>
        </div>

        <!-- 회원 통계 -->
        <div class="row mb-4">
            <div class="col-12">
                <h3 class="mb-3">
                    <i class="fas fa-users text-primary me-2"></i>
                    회원 통계
                </h3>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">전체 회원</h4>
                                <h2 class="mb-0" th:text="${totalMembers ?: 0}">0</h2>
                                <small>명</small>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-users fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">시설 회원</h4>
                                <h2 class="mb-0" th:text="${facilityMembers ?: 0}">0</h2>
                                <small>명</small>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-building fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">일반 회원</h4>
                                <h2 class="mb-0" th:text="${totalMembers - facilityMembers ?: 0}">0</h2>
                                <small>명</small>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-user fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 시설 통계 -->
        <div class="row mb-4">
            <div class="col-12">
                <h3 class="mb-3">
                    <i class="fas fa-hospital text-success me-2"></i>
                    시설 통계
                </h3>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">승인된 시설</h4>
                                <h2 class="mb-0" th:text="${approvedFacilities ?: 0}">0</h2>
                                <small>개</small>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-check-circle fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-warning text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">승인 대기</h4>
                                <h2 class="mb-0" th:text="${pendingFacilities ?: 0}">0</h2>
                                <small>개</small>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-clock fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-danger text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">승인 거부</h4>
                                <h2 class="mb-0" th:text="${rejectedFacilities ?: 0}">0</h2>
                                <small>개</small>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-times-circle fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-secondary text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">전체 시설</h4>
                                <h2 class="mb-0" th:text="${(approvedFacilities ?: 0) + (pendingFacilities ?: 0) + (rejectedFacilities ?: 0)}">0</h2>
                                <small>개</small>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-building fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 차트 영역 (추후 확장 가능) -->
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-chart-pie me-2"></i>
                            회원 구성비
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center">
                            <canvas id="memberChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-chart-bar me-2"></i>
                            시설 승인 현황
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center">
                            <canvas id="facilityChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 빠른 액션 버튼들 -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-tools me-2"></i>
                            빠른 관리 액션
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 mb-2">
                                <a href="/admin/facilities?status=PENDING" class="btn btn-warning w-100">
                                    <i class="fas fa-clock me-2"></i>
                                    승인 대기 시설 관리
                                </a>
                            </div>
                            <div class="col-md-3 mb-2">
                                <a href="/admin/members?role=ALL" class="btn btn-primary w-100">
                                    <i class="fas fa-users me-2"></i>
                                    전체 회원 관리
                                </a>
                            </div>
                            <div class="col-md-3 mb-2">
                                <a href="/admin/facilities?status=APPROVED" class="btn btn-success w-100">
                                    <i class="fas fa-check me-2"></i>
                                    승인된 시설 관리
                                </a>
                            </div>
                            <div class="col-md-3 mb-2">
                                <a href="/admin" class="btn btn-secondary w-100">
                                    <i class="fas fa-home me-2"></i>
                                    대시보드로 돌아가기
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<!-- Chart.js 라이브러리 (선택사항) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
// 회원 구성비 차트
const memberCtx = document.getElementById('memberChart').getContext('2d');
const facilityMembers = /*[[${facilityMembers ?: 0}]]*/ 0;
const userMembers = /*[[${totalMembers ?: 0}]]*/ 0 - facilityMembers;

new Chart(memberCtx, {
    type: 'doughnut',
    data: {
        labels: ['일반 회원', '시설 회원'],
        datasets: [{
            data: [userMembers, facilityMembers],
            backgroundColor: ['#17a2b8', '#28a745'],
            borderWidth: 2,
            borderColor: '#fff'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});

// 시설 승인 현황 차트
const facilityCtx = document.getElementById('facilityChart').getContext('2d');
const approvedFacilities = /*[[${approvedFacilities ?: 0}]]*/ 0;
const pendingFacilities = /*[[${pendingFacilities ?: 0}]]*/ 0;
const rejectedFacilities = /*[[${rejectedFacilities ?: 0}]]*/ 0;

new Chart(facilityCtx, {
    type: 'bar',
    data: {
        labels: ['승인완료', '승인대기', '승인거부'],
        datasets: [{
            label: '시설 수',
            data: [approvedFacilities, pendingFacilities, rejectedFacilities],
            backgroundColor: ['#28a745', '#ffc107', '#dc3545'],
            borderColor: ['#1e7e34', '#e0a800', '#c82333'],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    stepSize: 1
                }
            }
        },
        plugins: {
            legend: {
                display: false
            }
        }
    }
});
</script>

</body>
</html>
````

## File: src/main/resources/templates/board/faq-write.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>FAQ 작성 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>

    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <div class="container mt-4">
            <!-- 페이지 제목 -->
            <div class="row mb-4">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">홈</a></li>
                            <li class="breadcrumb-item"><a href="/board">정보마당</a></li>
                            <li class="breadcrumb-item"><a th:href="@{/board(type='faq')}">FAQ</a></li>
                            <li class="breadcrumb-item active" aria-current="page">FAQ 작성</li>
                        </ol>
                    </nav>
                    <h2>
                        <i class="fas fa-question-circle text-warning me-2"></i> 
                        FAQ 작성
                    </h2>
                    <p class="text-muted">자주 묻는 질문과 답변을 작성해주세요.</p>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-8">
                    <!-- FAQ 작성 폼 -->
                    <div class="card">
                        <div class="card-header bg-warning text-white">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-edit me-2"></i>FAQ 작성
                            </h5>
                        </div>
                        <div class="card-body">
                            <form th:action="@{/board/write}" method="post" th:object="${boardDTO}">
                                <input type="hidden" name="type" value="faq">
                                <input type="hidden" th:field="*{category}" value="FAQ">
                                
                                <!-- FAQ 카테고리 -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">FAQ 카테고리 <span class="text-danger">*</span></label>
                                        <select class="form-select" th:field="*{subCategory}" required>
                                            <option value="">카테고리를 선택하세요</option>
                                            <option value="facility">시설 이용</option>
                                            <option value="cost">비용 문의</option>
                                            <option value="insurance">보험 관련</option>
                                            <option value="admission">입소 절차</option>
                                            <option value="service">서비스</option>
                                            <option value="etc">기타</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">우선순위</label>
                                        <select class="form-select" th:field="*{priority}">
                                            <option value="0">일반</option>
                                            <option value="1">중요</option>
                                            <option value="2">매우 중요</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- 질문 (제목) -->
                                <div class="mb-3">
                                    <label class="form-label">질문 (Q) <span class="text-danger">*</span></label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-warning text-white">
                                            <i class="fas fa-question-circle"></i>
                                        </span>
                                        <input type="text" class="form-control" th:field="*{title}" 
                                               placeholder="자주 묻는 질문을 입력하세요" 
                                               maxlength="200" required>
                                    </div>
                                </div>

                                <!-- 답변 (내용) -->
                                <div class="mb-3">
                                    <label class="form-label">답변 (A) <span class="text-danger">*</span></label>
                                    <textarea class="form-control" th:field="*{content}" 
                                              rows="10" 
                                              placeholder="질문에 대한 상세한 답변을 작성해주세요."
                                              maxlength="2000" required></textarea>
                                </div>

                                <!-- 태그 -->
                                <div class="mb-3">
                                    <label class="form-label">태그</label>
                                    <input type="text" class="form-control" th:field="*{tags}" 
                                           placeholder="관련 태그를 쉼표로 구분하여 입력하세요">
                                </div>

                                <!-- 작성 옵션 -->
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" th:field="*{isPinned}" id="isPinned">
                                            <label class="form-check-label" for="isPinned">
                                                <i class="fas fa-thumbtack me-1"></i>상단 고정
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" th:field="*{isNotice}" id="isNotice">
                                            <label class="form-check-label" for="isNotice">
                                                <i class="fas fa-exclamation-triangle me-1"></i>중요 FAQ
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- 버튼 그룹 -->
                                <div class="d-flex gap-2 justify-content-end">
                                    <a th:href="@{/board(type='faq')}" class="btn btn-secondary">
                                        <i class="fas fa-times me-1"></i>취소
                                    </a>
                                    <button type="submit" class="btn btn-warning">
                                        <i class="fas fa-check me-1"></i>FAQ 등록
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <!-- FAQ 작성 도움말 -->
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0"><i class="fas fa-lightbulb me-2"></i>FAQ 작성 가이드</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <h6 class="text-success"><i class="fas fa-check-circle me-1"></i>좋은 FAQ 작성법</h6>
                                <ul class="list-unstyled small">
                                    <li class="mb-1"><i class="fas fa-arrow-right text-primary me-2"></i>실제로 자주 묻는 질문을 선택</li>
                                    <li class="mb-1"><i class="fas fa-arrow-right text-primary me-2"></i>명확하고 구체적인 질문</li>
                                    <li class="mb-1"><i class="fas fa-arrow-right text-primary me-2"></i>단계별 상세한 답변</li>
                                    <li class="mb-1"><i class="fas fa-arrow-right text-primary me-2"></i>관련 링크나 연락처 포함</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 푸터 -->
    <footer th:replace="~{layout/footer :: footer}"></footer>
    
    <!-- JavaScript -->
    <div th:replace="~{layout/footer :: scripts}"></div>
</body>
</html>
````

## File: src/main/resources/templates/layout/footer.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <!-- 푸터 -->
    <footer th:fragment="footer" class="bg-dark text-light mt-auto py-4">
        <div class="container">
            <div class="row">
                <!-- 사이트 정보 -->
                <div class="col-md-4 mb-3">
                    <h5 class="fw-bold">
                        <i class="fas fa-heart text-danger me-2"></i>
                        CareLink
                    </h5>
                    <p class="mb-2">믿을 수 있는 요양원 구인구직 플랫폼</p>
                    <p class="text-muted small">
                        좋은 사람과 좋은 시설을 연결하여<br>
                        더 나은 요양 서비스를 만들어갑니다.
                    </p>
                </div>
                
                <!-- 빠른 링크 -->
                <div class="col-md-4 mb-3">
                    <h6 class="fw-bold mb-3">빠른 링크</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <a href="/facility/search" class="text-light text-decoration-none">
                                <i class="fas fa-chevron-right me-2"></i>시설 찾기
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="/job?type=recruit" class="text-light text-decoration-none">
                                <i class="fas fa-chevron-right me-2"></i>구인 정보
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="/job?type=search" class="text-light text-decoration-none">
                                <i class="fas fa-chevron-right me-2"></i>구직 정보
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="/review" class="text-light text-decoration-none">
                                <i class="fas fa-chevron-right me-2"></i>시설 리뷰
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- 고객 지원 -->
                <div class="col-md-4 mb-3">
                    <h6 class="fw-bold mb-3">고객 지원</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <a href="/board?type=notice" class="text-light text-decoration-none">
                                <i class="fas fa-chevron-right me-2"></i>공지사항
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="/board?type=qna" class="text-light text-decoration-none">
                                <i class="fas fa-chevron-right me-2"></i>Q&A
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="/board?type=faq" class="text-light text-decoration-none">
                                <i class="fas fa-chevron-right me-2"></i>자주 묻는 질문
                            </a>
                        </li>
                        <li class="mb-2">
                            <span class="text-muted">
                                <i class="fas fa-phone me-2"></i>1588-0000
                            </span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <hr class="my-4">
            
            <!-- 저작권 및 팀 정보 -->
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0 text-muted small">
                        © 2024 CareLink. 4인 팀 프로젝트 - 모든 권리 보유.
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <small class="text-muted">
                        <span class="me-3">팀원 A: 회원관리</span>
                        <span class="me-3">팀원 B: 시설검색</span>
                        <span class="me-3">팀원 C: 구인구직</span>
                        <span>팀원 D: 리뷰&게시판</span>
                    </small>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- JavaScript 포함 영역 -->
    <div th:fragment="scripts">
        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
        <!-- Cropper.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
        <!-- 공통 JavaScript -->
        <script src="/js/common.js"></script>
    </div>
</body>
</html>
````

## File: src/main/resources/templates/member/changePassword.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>비밀번호 변경 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <!-- 브레드크럼 -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item"><a href="/member/myinfo">내 정보</a></li>
                <li class="breadcrumb-item active" aria-current="page">비밀번호 변경</li>
            </ol>
        </nav>
        
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-5">
                <!-- 비밀번호 변경 카드 -->
                <div class="card shadow">
                    <div class="card-body p-4">
                        <!-- 제목 -->
                        <div class="text-center mb-4">
                            <h3 class="card-title fw-bold text-primary">
                                <i class="fas fa-key me-2"></i>
                                비밀번호 변경
                            </h3>
                            <p class="text-muted">새로운 비밀번호로 변경하세요</p>
                        </div>
                        
                        <!-- 비밀번호 변경 폼 -->
                        <form id="changePasswordForm" th:action="@{/member/mypage/change-password}" method="post" novalidate>
                            <!-- 현재 비밀번호 -->
                            <div class="mb-3">
                                <label for="currentPassword" class="form-label">
                                    <i class="fas fa-lock me-1"></i>현재 비밀번호 <span class="text-danger">*</span>
                                </label>
                                <div class="input-group">
                                    <input type="password" 
                                           class="form-control" 
                                           id="currentPassword" 
                                           name="currentPassword"
                                           placeholder="현재 비밀번호를 입력하세요"
                                           required>
                                    <button class="btn btn-outline-secondary" type="button" id="toggleCurrentPassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div id="currentPasswordFeedback" class="invalid-feedback"></div>
                            </div>
                            
                            <!-- 새 비밀번호 -->
                            <div class="mb-3">
                                <label for="newPassword" class="form-label">
                                    <i class="fas fa-key me-1"></i>새 비밀번호 <span class="text-danger">*</span>
                                </label>
                                <div class="input-group">
                                    <input type="password" 
                                           class="form-control" 
                                           id="newPassword" 
                                           name="newPassword"
                                           placeholder="새 비밀번호를 입력하세요"
                                           required>
                                    <button class="btn btn-outline-secondary" type="button" id="toggleNewPassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <small class="form-text text-muted">8-20자의 영문, 숫자, 특수문자를 1개 이상 포함해야 합니다.</small>
                                <div id="newPasswordFeedback" class="invalid-feedback"></div>
                            </div>
                            
                            <!-- 새 비밀번호 확인 -->
                            <div class="mb-4">
                                <label for="confirmPassword" class="form-label">
                                    <i class="fas fa-key me-1"></i>새 비밀번호 확인 <span class="text-danger">*</span>
                                </label>
                                <div class="input-group">
                                    <input type="password" 
                                           class="form-control" 
                                           id="confirmPassword" 
                                           name="confirmPassword"
                                           placeholder="새 비밀번호를 다시 입력하세요"
                                           required>
                                    <button class="btn btn-outline-secondary" type="button" id="toggleConfirmPassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div id="confirmPasswordFeedback" class="invalid-feedback"></div>
                            </div>
                            
                            <!-- 비밀번호 변경 버튼 -->
                            <div class="d-grid mb-3">
                                <button type="submit" class="btn btn-primary btn-lg" id="submitButton" disabled>
                                    <i class="fas fa-check me-2"></i>
                                    비밀번호 변경
                                </button>
                            </div>
                        </form>
                        
                        <!-- 취소 버튼 -->
                        <div class="text-center">
                            <a href="/member/myinfo" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-1"></i>
                                내 정보로 돌아가기
                            </a>
                        </div>
                        
                        <!-- 비밀번호 안전성 가이드 -->
                        <hr class="my-4">
                        <div class="alert alert-info" role="alert">
                            <h6 class="alert-heading">
                                <i class="fas fa-shield-alt me-2"></i>
                                안전한 비밀번호 만들기
                            </h6>
                            <ul class="mb-0 small">
                                <li>8자 이상 20자 이하로 설정하세요</li>
                                <li>영문 대소문자, 숫자, 특수문자를 조합하세요</li>
                                <li>개인정보(이름, 생년월일)는 사용하지 마세요</li>
                                <li>다른 사이트와 다른 비밀번호를 사용하세요</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 비밀번호 변경 전용 JavaScript -->
<script src="/js/change-password.js"></script>

</body>
</html>
````

## File: src/main/resources/templates/member/crop-image.backup.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>프로필 이미지 크롭 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <!-- 브레드크럼 -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item"><a href="/member/myinfo">마이페이지</a></li>
                <li class="breadcrumb-item active" aria-current="page">프로필 이미지 크롭</li>
            </ol>
        </nav>
        
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="card shadow">
                    <div class="card-body p-4">
                        <div class="text-center mb-4">
                            <h3 class="card-title fw-bold text-primary">
                                <i class="fas fa-crop me-2"></i>
                                프로필 이미지 크롭
                            </h3>
                            <p class="text-muted">증명사진 비율(3:4)에 맞춰 프로필 사진을 조절하세요</p>
                        </div>

                        <!-- 고급 이미지 크롭퍼 컨테이너 -->
                        <div id="profileImageCropper"></div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 고급 이미지 크롭퍼 -->
<link rel="stylesheet" href="/css/advanced-image-cropper.css">
<script src="/js/advanced-image-cropper.js"></script>

<script>
$(document).ready(function() {
    // 프로필 이미지 크롭퍼 초기화
    initializeProfileImageCropper();
});

// 프로필 이미지 크롭퍼 초기화
function initializeProfileImageCropper() {
    const profileImageCropper = new AdvancedImageCropper('profileImageCropper', {
        // 프로필 이미지 최적화 설정
        aspectRatio: 3/4, // 프로필 증명사진 비율
        cropWidth: 300,
        cropHeight: 400,
        previewStyle: 'profile',
        title: '프로필 이미지 업로드',
        quality: 0.9,
        enableAltText: true,
        showSteps: true,
        
        // 크롭 완료 콜백
        onCropComplete: function(result) {
            console.log('프로필 이미지 크롭 완료:', result);
            
            // 서버에 크롭된 이미지 저장
            saveProfileImage(result);
        },
        
        // 에러 콜백
        onError: function(message) {
            console.error('프로필 이미지 크롭 오류:', message);
            showErrorMessage('이미지 처리 중 오류가 발생했습니다: ' + message);
        }
    });
    
    // 전역에서 접근 가능하도록 저장
    window.profileImageCropper = profileImageCropper;
}

// 프로필 이미지 서버 저장
function saveProfileImage(result) {
    // 로딩 표시
    showLoadingMessage('프로필 이미지 저장 중...');
    
    const formData = new FormData();
    formData.append('croppedImage', result.imageData);
    formData.append('altText', result.altText);
    
    fetch('/member/myinfo/crop-image/save', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        hideLoadingMessage();
        
        if (data.success) {
            showSuccessMessage('프로필 이미지가 성공적으로 저장되었습니다!');
            
            // 2초 후 마이페이지로 이동
            setTimeout(() => {
                window.location.href = '/member/myinfo/edit';
            }, 2000);
        } else {
            showErrorMessage(data.message || '프로필 이미지 저장에 실패했습니다.');
        }
    })
    .catch(error => {
        hideLoadingMessage();
        console.error('프로필 이미지 저장 오류:', error);
        showErrorMessage('프로필 이미지 저장 중 오류가 발생했습니다.');
    });
}

// 로딩 메시지 표시
function showLoadingMessage(message) {
    const existingLoading = document.querySelector('.loading-overlay');
    if (existingLoading) existingLoading.remove();
    
    const loadingDiv = document.createElement('div');
    loadingDiv.className = 'loading-overlay position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center';
    loadingDiv.style.cssText = 'background: rgba(0,0,0,0.5); z-index: 9999;';
    loadingDiv.innerHTML = `
        <div class="text-center text-white">
            <div class="spinner-border mb-3" role="status"></div>
            <div>${message}</div>
        </div>
    `;
    
    document.body.appendChild(loadingDiv);
}

// 로딩 메시지 숨김
function hideLoadingMessage() {
    const loadingOverlay = document.querySelector('.loading-overlay');
    if (loadingOverlay) {
        loadingOverlay.remove();
    }
}

// 성공 메시지 표시
function showSuccessMessage(message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-success alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3';
    alertDiv.style.cssText = 'z-index: 10000; min-width: 300px;';
    alertDiv.innerHTML = `
        <i class="fas fa-check-circle me-2"></i>${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    // 5초 후 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}

// 에러 메시지 표시
function showErrorMessage(message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-danger alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3';
    alertDiv.style.cssText = 'z-index: 10000; min-width: 300px;';
    alertDiv.innerHTML = `
        <i class="fas fa-exclamation-triangle me-2"></i>${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    // 10초 후 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 10000);
}
</script>

</body>
</html>
````

## File: src/main/resources/templates/member/myPosts.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>내가 쓴 글 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <!-- 브레드크럼 -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item"><a href="/member/myinfo/edit">내 정보</a></li>
                <li class="breadcrumb-item active" aria-current="page">내가 쓴 글</li>
            </ol>
        </nav>
        
        <div class="row">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-body">
                        <!-- 헤더 -->
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h3 class="card-title fw-bold text-primary mb-0">
                                <i class="fas fa-edit me-2"></i>
                                내가 쓴 글
                            </h3>
                            <div class="text-muted">
                                <span th:text="${member.name}">사용자명</span>님의 작성 글
                            </div>
                        </div>
                        
                        
                        <!-- 필터 및 정렬 -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div class="btn-group btn-group-sm" role="group" aria-label="게시글 타입 필터">
                                <button type="button" class="btn filter-btn" data-type="all" 
                                        th:classappend="${currentType == 'all'} ? 'btn-primary' : 'btn-outline-primary'">
                                    전체 (<span th:text="${contentCounts.total}">0</span>)
                                </button>
                                <button type="button" class="btn filter-btn" data-type="board"
                                        th:classappend="${currentType == 'board'} ? 'btn-info' : 'btn-outline-info'">
                                    게시글 (<span th:text="${contentCounts.board}">0</span>)
                                </button>
                                <button type="button" class="btn filter-btn" data-type="review"
                                        th:classappend="${currentType == 'review'} ? 'btn-success' : 'btn-outline-success'">
                                    리뷰 (<span th:text="${contentCounts.review}">0</span>)
                                </button>
                                <button type="button" class="btn filter-btn" data-type="job"
                                        th:classappend="${currentType == 'job'} ? 'btn-warning' : 'btn-outline-warning'">
                                    구인구직 (<span th:text="${contentCounts.job}">0</span>)
                                </button>
                            </div>
                            
                            <div class="d-flex align-items-center gap-2">
                                <small class="text-muted">
                                    총 <strong th:text="${totalCount}">0</strong>개
                                </small>
                                <select class="form-select form-select-sm" id="sortSelect" style="width: auto;">
                                    <option value="latest">최신순</option>
                                    <option value="oldest">오래된순</option>
                                    <option value="views">조회순</option>
                                    <option value="likes">추천순</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- 게시글 목록 -->
                        <div class="posts-container">
                            <div th:if="${#lists.isEmpty(posts)}" class="text-center py-5">
                                <div class="text-muted">
                                    <i class="fas fa-inbox fa-2x mb-3"></i>
                                    <p>작성한 글이 없습니다.</p>
                                </div>
                            </div>
                            
                            <!-- 게시글 테이블 -->
                            <div th:unless="${#lists.isEmpty(posts)}" id="postsContainer">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-light">
                                            <tr>
                                                <th style="width: 80px;">유형</th>
                                                <th>제목</th>
                                                <th style="width: 100px;">카테고리</th>
                                                <th style="width: 80px;">조회</th>
                                                <th style="width: 80px;">추천</th>
                                                <th style="width: 120px;">작성일</th>
                                                <th style="width: 80px;">관리</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="post : ${posts}" class="post-item" 
                                                th:attr="data-type=${post.type}, data-created=${post.createdAt}, data-views=${post.viewCount ?: 0}, data-likes=${post.likeCount ?: 0}">
                                                <td>
                                                    <span class="badge badge-sm" 
                                                          th:classappend="'bg-' + ${post.type == 'board' ? 'info' : (post.type == 'review' ? 'success' : 'warning')}">
                                                        <span th:text="${post.type == 'board' ? '게시글' : (post.type == 'review' ? '리뷰' : '구인')}">타입</span>
                                                    </span>
                                                </td>
                                                <td>
                                                    <div class="d-flex flex-column">
                                                        <a th:href="${post.url}" class="text-decoration-none fw-medium text-dark" th:text="${post.title}">글 제목</a>
                                                        <small class="text-muted" th:text="${#strings.abbreviate(post.content, 60)}" style="font-size: 0.8rem;">내용 미리보기...</small>
                                                        <div class="mt-1" th:if="${post.rating != null or post.salary != null}">
                                                            <small class="text-warning" th:if="${post.rating != null}">
                                                                <i class="fas fa-star"></i> <span th:text="${post.rating}">0</span>점
                                                            </small>
                                                            <small class="text-success" th:if="${post.salary != null}">
                                                                <i class="fas fa-won-sign"></i> <span th:text="${post.salary}">급여</span>
                                                            </small>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <small class="text-muted" th:text="${post.category}">카테고리</small>
                                                </td>
                                                <td class="text-center">
                                                    <small class="text-muted" th:if="${post.viewCount != null}" th:text="${post.viewCount}">0</small>
                                                    <small class="text-muted" th:unless="${post.viewCount != null}">-</small>
                                                </td>
                                                <td class="text-center">
                                                    <small class="text-muted" th:if="${post.likeCount != null}" th:text="${post.likeCount}">0</small>
                                                    <small class="text-muted" th:unless="${post.likeCount != null}">-</small>
                                                </td>
                                                <td>
                                                    <small class="text-muted" th:text="${#temporals.format(post.createdAt, 'MM-dd HH:mm')}">날짜</small>
                                                </td>
                                                <td class="text-center">
                                                    <a th:href="${post.url}" class="btn btn-outline-primary btn-sm">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 페이징 -->
                        <div th:if="${totalPages > 1}" class="d-flex justify-content-center mt-4">
                            <nav aria-label="게시글 페이지 네비게이션">
                                <ul class="pagination">
                                    <!-- 이전 페이지 -->
                                    <li class="page-item" th:classappend="${currentPage <= 1} ? 'disabled'">
                                        <a class="page-link" th:href="@{/member/mypost(type=${currentType}, page=${currentPage - 1}, pageSize=${pageSize})}" 
                                           aria-label="이전 페이지">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                    
                                    <!-- 페이지 번호 -->
                                    <li th:each="i : ${#numbers.sequence(1, totalPages)}" 
                                        class="page-item" th:classappend="${i == currentPage} ? 'active'">
                                        <a class="page-link" th:href="@{/member/mypost(type=${currentType}, page=${i}, pageSize=${pageSize})}" 
                                           th:text="${i}">1</a>
                                    </li>
                                    
                                    <!-- 다음 페이지 -->
                                    <li class="page-item" th:classappend="${currentPage >= totalPages} ? 'disabled'">
                                        <a class="page-link" th:href="@{/member/mypost(type=${currentType}, page=${currentPage + 1}, pageSize=${pageSize})}" 
                                           aria-label="다음 페이지">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 내가 쓴 글 전용 JavaScript -->
<script src="/js/my-posts.js"></script>
</body>
</html>
````

## File: src/main/resources/templates/member/verifyPassword.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>비밀번호 확인 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <!-- 브레드크럼 -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item active" aria-current="page">비밀번호 확인</li>
            </ol>
        </nav>
        
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-4">
                <div class="card shadow">
                    <div class="card-body p-4">
                        <div class="text-center mb-4">
                            <h3 class="card-title fw-bold text-warning">
                                <i class="fas fa-shield-alt me-2"></i>
                                보안 확인
                            </h3>
                            <p class="text-muted">회원정보 수정을 위해<br>현재 비밀번호를 입력해주세요</p>
                        </div>

                        <form th:action="@{/member/myinfo/verify}" method="post" id="verifyForm">
                            <div class="mb-4">
                                <label for="password" class="form-label">
                                    <i class="fas fa-key me-1"></i>현재 비밀번호
                                </label>
                                <div class="input-group">
                                    <input type="password"
                                           class="form-control"
                                           id="password"
                                           name="password"
                                           placeholder="현재 비밀번호를 입력하세요"
                                           required
                                           autocomplete="current-password">
                                    <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                        <i class="fas fa-eye" id="toggleIcon"></i>
                                    </button>
                                </div>
                                <div class="form-text text-muted">
                                    <i class="fas fa-info-circle me-1"></i>
                                    개인정보 보호를 위한 추가 인증입니다
                                </div>
                            </div>

                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-check me-2"></i>
                                    확인
                                </button>
                                <a th:href="@{/}" class="btn btn-outline-secondary">
                                    <i class="fas fa-arrow-left me-2"></i>
                                    취소
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('password');
    const toggleButton = document.getElementById('togglePassword');
    const toggleIcon = document.getElementById('toggleIcon');
    const verifyForm = document.getElementById('verifyForm');
    
    // 비밀번호 표시/숨김 토글
    toggleButton.addEventListener('click', function() {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        
        if (type === 'text') {
            toggleIcon.classList.remove('fa-eye');
            toggleIcon.classList.add('fa-eye-slash');
        } else {
            toggleIcon.classList.remove('fa-eye-slash');
            toggleIcon.classList.add('fa-eye');
        }
    });
    
    // 폼 제출 시 검증
    verifyForm.addEventListener('submit', function(e) {
        const password = passwordInput.value.trim();
        
        if (password.length < 1) {
            e.preventDefault();
            alert('비밀번호를 입력해주세요.');
            passwordInput.focus();
            return false;
        }
    });
    
    // 페이지 로드 시 포커스
    passwordInput.focus();
});
</script>
</body>
</html>
````

## File: src/main/resources/db_performance_indexes.sql
````sql
-- 🚀 LightCare 프로젝트 성능 최적화 인덱스
-- 기존 데이터에 영향 없이 검색 성능만 향상시킴

-- 리뷰 검색 성능 향상
CREATE INDEX IF NOT EXISTS idx_reviews_title ON reviews(title);
CREATE INDEX IF NOT EXISTS idx_reviews_created_at ON reviews(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_reviews_rating ON reviews(rating);
CREATE INDEX IF NOT EXISTS idx_reviews_facility_id ON reviews(facility_id);

-- 게시판 검색 성능 향상
CREATE INDEX IF NOT EXISTS idx_boards_category ON boards(category);
CREATE INDEX IF NOT EXISTS idx_boards_created_at ON boards(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_boards_title ON boards(title);
CREATE INDEX IF NOT EXISTS idx_boards_status ON boards(is_active, is_deleted);

-- 구인구직 검색 성능 향상
CREATE INDEX IF NOT EXISTS idx_jobs_type ON job_postings(job_type);
CREATE INDEX IF NOT EXISTS idx_jobs_status ON job_postings(status);
CREATE INDEX IF NOT EXISTS idx_jobs_created_at ON job_postings(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_jobs_salary ON job_postings(salary);

-- 시설 검색 성능 향상
CREATE INDEX IF NOT EXISTS idx_facilities_name ON facilities(facility_name);
CREATE INDEX IF NOT EXISTS idx_facilities_location ON facilities(latitude, longitude);
CREATE INDEX IF NOT EXISTS idx_facilities_type ON facilities(facility_type);

-- 회원 관련 성능 향상
CREATE INDEX IF NOT EXISTS idx_members_email ON members(email);
CREATE INDEX IF NOT EXISTS idx_members_role ON members(role);

-- 복합 인덱스 (자주 함께 사용되는 조건들)
CREATE INDEX IF NOT EXISTS idx_reviews_facility_rating ON reviews(facility_id, rating);
CREATE INDEX IF NOT EXISTS idx_boards_category_active ON boards(category, is_active, is_deleted);
CREATE INDEX IF NOT EXISTS idx_jobs_type_status ON job_postings(job_type, status);

-- 인덱스 생성 완료 확인용 쿼리 (실행 후 확인)
-- SHOW INDEX FROM reviews;
-- SHOW INDEX FROM boards;
-- SHOW INDEX FROM job_postings;
-- SHOW INDEX FROM facilities;
````

## File: .dockerignore
````
# 빌드 결과물
/build/
/target/
*.class
bin/
out/

# Gradle 관련
.gradle/
!gradle-wrapper.jar
!gradle-wrapper.properties

# IDE 관련
.idea/
*.iml
*.ipr
*.iws
.vscode/
.settings/
.classpath
.project

# 로그 및 임시 파일
*.log
logs/
*.lock
*.out
*.bak
*.swp
*.tmp

# OS 관련
.DS_Store
Thumbs.db

# 개발 환경 설정
.env
node_modules/

# 테스트 파일
src/test/

# 문서 파일 (선택적으로 제외)
*.md
!README.md

# 업로드 디렉토리 (로컬 개발용)
/carelink-uploads/
````

## File: cleanup_files.sh
````bash
#!/bin/bash

# ================================================
# 업로드된 파일들 정리 스크립트
# ================================================

echo "🧹 파일 시스템 정리 시작..."

# 시설 이미지 파일들 삭제
if [ -d "C:/carelink-uploads/facility" ]; then
    echo "📁 시설 이미지 폴더 정리 중..."
    rm -rf C:/carelink-uploads/facility/*
    echo "✅ 시설 이미지 파일들 삭제 완료"
else
    echo "⚠️ 시설 이미지 폴더가 없습니다: C:/carelink-uploads/facility"
fi

# 프로필 이미지 파일들 삭제 (선택사항)
if [ -d "C:/carelink-uploads/member" ]; then
    echo "📁 프로필 이미지 폴더 정리 중..."
    rm -rf C:/carelink-uploads/member/*
    echo "✅ 프로필 이미지 파일들 삭제 완료"
else
    echo "⚠️ 프로필 이미지 폴더가 없습니다: C:/carelink-uploads/member"
fi

# Gradle 빌드 캐시 정리
echo "🔄 Gradle 캐시 정리 중..."
./gradlew clean

echo "✨ 파일 시스템 정리 완료!"
echo ""
echo "🔄 다음 단계:"
echo "1. 데이터베이스 초기화 실행"
echo "2. 애플리케이션 재시작"
echo "3. 새로운 이미지로 테스트"
````

## File: backup/deprecated_files/edit.backup.html
````html
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/header :: header}">
    <title>시설 정보 수정 - 라이트케어</title>
</head>

<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="container my-4">
    <!-- 브레드크럼 -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">홈</a></li>
            <li class="breadcrumb-item"><a href="/facility/search">시설 찾기</a></li>
            <li class="breadcrumb-item"><a href="/facility/manage">내 시설 관리</a></li>
            <li class="breadcrumb-item active" aria-current="page">시설 정보 수정</li>
        </ol>
    </nav>
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-edit me-2"></i>시설 정보 수정
                    </h3>
                </div>
                <div class="card-body">
                    <form id="facilityEditForm" th:action="@{/facility/edit/{id}(id=${facility.facilityId})}" 
                          method="post" enctype="multipart/form-data" th:object="${facility}">
                        
                        <!-- 시설명 -->
                        <div class="mb-3">
                            <label for="facilityName" class="form-label">
                                <i class="fas fa-building me-1"></i>시설명 <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="facilityName" th:field="*{facilityName}"
                                   placeholder="시설명을 입력하세요" required>
                        </div>

                        <!-- 시설 유형 -->
                        <div class="mb-3">
                            <label for="facilityType" class="form-label">
                                <i class="fas fa-tag me-1"></i>시설 유형 <span class="text-danger">*</span>
                            </label>
                            <select class="form-select" id="facilityType" th:field="*{facilityType}" required>
                                <option value="">시설 유형을 선택하세요</option>
                                <option value="NURSING_HOME">요양원</option>
                                <option value="HOSPITAL">요양병원</option>
                                <option value="DAY_CARE">데이케어센터</option>
                            </select>
                        </div>

                        <!-- 주소 -->
                        <div class="mb-3">
                            <label for="facilityAddress" class="form-label">
                                <i class="fas fa-map-marker-alt me-1"></i>주소 <span class="text-danger">*</span>
                            </label>
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" id="facilityAddress" th:field="*{address}"
                                       placeholder="주소 검색 버튼을 클릭하세요" readonly required>
                                <button type="button" class="btn btn-outline-primary" onclick="searchFacilityAddress()">
                                    <i class="fas fa-search me-1"></i>주소 검색
                                </button>
                            </div>
                            <input type="text" class="form-control" id="detailAddress" th:field="*{detailAddress}"
                                   placeholder="상세 주소를 입력하세요 (예: 101호, 2층)">
                            <!-- 위도/경도 히든 필드 -->
                            <input type="hidden" id="latitude" th:field="*{latitude}">
                            <input type="hidden" id="longitude" th:field="*{longitude}">
                        </div>
                        
                        <!-- 위치 미리보기 지도 -->
                        <div class="mb-3" id="mapPreviewContainer" style="display: none;">
                            <label class="form-label">
                                <i class="fas fa-map me-1"></i>위치 미리보기
                            </label>
                            <div id="previewMap" style="width:100%; height:200px; border-radius: 8px; border: 1px solid #dee2e6;"></div>
                            <small class="form-text text-muted">선택된 주소의 위치가 지도에 표시됩니다.</small>
                        </div>

                        <!-- 시설 전화번호 -->
                        <div class="mb-3">
                            <label for="phone" class="form-label">
                                <i class="fas fa-phone me-1"></i>시설 전화번호 <span class="text-danger">*</span>
                            </label>
                            <input type="tel" class="form-control" id="phone" th:field="*{phone}"
                                   placeholder="전화번호를 입력하세요 (지역번호에 맞게 자동 포맷팅)" required>
                            <small class="form-text text-muted">
                                <strong>지역번호 예시:</strong> 
                                서울(02), 부산(051), 대구(053), 인천(032), 광주(062), 대전(042), 울산(052) 등<br>
                                <strong>형식:</strong> 042는 3-3-4, 02는 2-3-4 또는 2-4-4 형식으로 자동 적용됩니다
                            </small>
                        </div>

                        <!-- 현재 시설 이미지 (있는 경우) -->
                        <div class="mb-3" th:if="${facility.facilityImage}">
                            <label class="form-label">
                                <i class="fas fa-image me-1"></i>현재 시설 사진
                            </label>
                            <div class="current-image-container mb-3" style="position: relative; display: inline-block;">
                                <img th:src="@{${facility.facilityImage}}" alt="현재 시설 사진" 
                                     style="max-width: 300px; max-height: 200px; border-radius: 12px; border: 2px solid #dee2e6; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                                <div class="current-image-overlay" style="position: absolute; top: 8px; right: 8px;">
                                    <span class="badge bg-primary">현재 이미지</span>
                                </div>
                            </div>
                        </div>

                        <!-- 새 시설 이미지 업로드 -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-cloud-upload-alt me-1"></i>시설 사진 
                                <span th:if="${facility.facilityImage == null}" class="text-danger">*</span>
                                <span th:if="${facility.facilityImage != null}" class="text-muted">(새 이미지로 변경)</span>
                            </label>
                            
                            <!-- 새로운 이미지 업로더 컴포넌트 -->
                            <div id="facilityImageUploader"></div>
                            
                            <!-- 숨겨진 파일 입력 (기존 폼과 호환성을 위해) -->
                            <input type="file" id="facilityImageFile" name="facilityImageFile" 
                                   accept="image/*" style="display: none;"
                                   th:required="${facility.facilityImage == null}">
                            
                            <!-- Alt 텍스트 입력 (SEO용) -->
                            <input type="hidden" id="facilityImageAltText" name="facilityImageAltText" 
                                   th:value="${facility.facilityImageAltText}">
                        </div>

                        <!-- 수용 인원 -->
                        <div class="mb-3">
                            <label for="capacity" class="form-label">
                                <i class="fas fa-users me-1"></i>수용 인원
                            </label>
                            <input type="number" class="form-control" id="capacity" th:field="*{capacity}"
                                   placeholder="수용 가능 인원을 입력하세요" min="1">
                        </div>

                        <!-- 운영 시간 -->
                        <div class="mb-3">
                            <label for="operatingHours" class="form-label">
                                <i class="fas fa-clock me-1"></i>운영 시간
                            </label>
                            <div class="row g-2">
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operatingType" id="operating24" 
                                               value="24시간" th:checked="${facility.operatingHours == '24시간'}">
                                        <label class="form-check-label fw-bold text-success" for="operating24">
                                            <i class="fas fa-clock me-1"></i>24시간 운영
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operatingType" id="operatingCustom" 
                                               value="custom" th:checked="${facility.operatingHours != '24시간' && facility.operatingHours != null}">
                                        <label class="form-check-label" for="operatingCustom">
                                            <i class="fas fa-clock me-1"></i>시간 직접 설정
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operatingType" id="operatingWeekly" value="weekly">
                                        <label class="form-check-label" for="operatingWeekly">
                                            <i class="fas fa-calendar-week me-1"></i>요일별 시간 설정
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 간단한 시간 설정 -->
                            <div id="simpleTimeContainer" class="mt-3" style="display: none;">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title mb-3">운영 시간 설정</h6>
                                        <div class="row g-2">
                                            <div class="col-md-6">
                                                <label class="form-label small">시작 시간</label>
                                                <select class="form-select" id="startHour">
                                                    <option value="">시</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label small">종료 시간</label>
                                                <select class="form-select" id="endHour">
                                                    <option value="">시</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle me-1"></i>
                                                매일 동일한 시간으로 설정됩니다
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 요일별 시간 설정 -->
                            <div id="weeklyTimeContainer" class="mt-3" style="display: none;">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title mb-3">요일별 운영 시간</h6>
                                        <div id="weeklySchedule">
                                            <!-- JavaScript로 동적 생성 -->
                                        </div>
                                        
                                        <div class="mt-3">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle me-1"></i>
                                                운영하지 않는 요일은 체크를 해제하세요
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 직접 입력 -->
                            <div id="customTimeContainer" class="mt-3" style="display: none;">
                                <input type="text" class="form-control" id="customOperatingHours" 
                                       placeholder="예: 09:00-18:00, 평일 09:00-18:00 주말 10:00-16:00"
                                       th:value="${facility.operatingHours != '24시간' ? facility.operatingHours : ''}">
                                <small class="form-text text-muted">
                                    자유 형식으로 운영 시간을 입력하세요
                                </small>
                            </div>
                            
                            <input type="hidden" id="operatingHours" th:field="*{operatingHours}">
                        </div>

                        <!-- 홈페이지 -->
                        <div class="mb-3">
                            <label for="homepage" class="form-label">
                                <i class="fas fa-globe me-1"></i>홈페이지 URL
                            </label>
                            <input type="url" class="form-control" id="homepage" th:field="*{homepage}"
                                   placeholder="https://www.example.com">
                        </div>

                        <!-- 시설 설명 -->
                        <div class="mb-3">
                            <label for="description" class="form-label">
                                <i class="fas fa-info-circle me-1"></i>시설 설명
                            </label>
                            <textarea class="form-control" id="description" th:field="*{description}" rows="4"
                                      placeholder="시설에 대한 설명을 입력하세요"
                                      data-rich-editor='{"height": "250px", "enableImage": true, "enableTable": false, "enableLink": true}'></textarea>
                        </div>

                        <!-- 시설 특징 -->
                        <div class="mb-3">
                            <label for="features" class="form-label">
                                <i class="fas fa-star me-1"></i>시설 특징
                            </label>
                            <input type="text" class="form-control" id="features" th:field="*{features}"
                                   placeholder="시설의 주요 특징을 쉼표로 구분하여 입력하세요 (예: 24시간 간병서비스, 물리치료실, 카페)">
                            <small class="form-text text-muted">쉼표(,)로 구분하여 여러 특징을 입력할 수 있습니다</small>
                        </div>

                        <!-- 버튼 -->
                        <div class="d-flex gap-2 justify-content-end">
                            <a th:href="@{/facility/manage}" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>취소
                            </a>
                            <button type="submit" class="btn btn-primary" id="submitButton">
                                <i class="fas fa-save me-2"></i>수정 완료
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 카카오 주소 검색 API -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<!-- 카카오맵 API (좌표 변환용) -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_APP_KEY&libraries=services"></script>
<!-- 카카오맵 유틸리티 -->
<script src="/js/kakaomap.js"></script>
<script src="/js/facility-edit.js"></script>

<!-- 전화번호 포맷터 -->
<script src="/js/phone-formatter.js"></script>

<!-- 고급 이미지 크롭퍼 -->
<link rel="stylesheet" href="/css/advanced-image-cropper.css">
<script src="/js/advanced-image-cropper.js"></script>

<!-- 리치 텍스트 에디터 -->
<link rel="stylesheet" href="/css/rich-text-editor.css">
<script src="/js/rich-text-editor.js"></script>

<script>
$(document).ready(function() {
    console.log('Initializing operating hours...');
    
    // 시간 옵션 동적 생성
    initializeTimeOptions();
    
    // 요일별 스케줄 미리 생성
    generateWeeklySchedule();
    
    // 직접 입력 변경 이벤트
    $('#customOperatingHours').on('input', function() {
        updateOperatingHours();
    });
    
    // 초기 상태 설정
    initializeOperatingHours();
});

function initializeTimeOptions() {
    // 시작 시간 옵션 생성
    for (let i = 0; i <= 23; i++) {
        const hour = String(i).padStart(2, '0');
        $('#startHour').append(`<option value="${hour}">${hour}시</option>`);
        $('#endHour').append(`<option value="${hour}">${hour}시</option>`);
    }
}

function generateWeeklySchedule() {
    console.log('Generating weekly schedule...');
    const days = ['월요일', '화요일', '수요일', '목요일', '금요일', '토요일', '일요일'];
    let html = '';
    
    days.forEach((day, index) => {
        html += `
            <div class="row g-2 mb-2">
                <div class="col-3">
                    <div class="form-check">
                        <input class="form-check-input day-check" type="checkbox" id="day${index}" checked>
                        <label class="form-check-label" for="day${index}">${day}</label>
                    </div>
                </div>
                <div class="col-9 time-controls">
                    <div class="d-flex align-items-center gap-2">
                        <select class="form-select form-select-sm day-start" id="start${index}" style="width: 80px;">
                            <option value="">시작</option>
                        </select>
                        <span>시 ~</span>
                        <select class="form-select form-select-sm day-end" id="end${index}" style="width: 80px;">
                            <option value="">종료</option>
                        </select>
                        <span>시</span>
                    </div>
                    <div class="rest-day-notice text-muted small mt-1" style="display: none;">
                        <i class="fas fa-moon me-1"></i>휴무일
                    </div>
                </div>
            </div>
        `;
    });
    
    $('#weeklySchedule').html(html);
    
    // 시간 옵션 추가
    for (let i = 0; i <= 23; i++) {
        const hour = String(i).padStart(2, '0');
        days.forEach((day, index) => {
            $(`#start${index}`).append(`<option value="${hour}">${hour}</option>`);
            $(`#end${index}`).append(`<option value="${hour}">${hour}</option>`);
        });
    }
    
    // 이벤트 리스너 추가
    setTimeout(function() {
        $('.day-check').off('change').on('change', function() {
            const index = $(this).attr('id').replace('day', '');
            const timeControls = $(this).closest('.row').find('.time-controls');
            const restNotice = timeControls.find('.rest-day-notice');
            const selects = timeControls.find('select');
            
            if ($(this).is(':checked')) {
                selects.show();
                timeControls.find('span').show();
                restNotice.hide();
            } else {
                selects.hide();
                timeControls.find('span').hide();
                restNotice.show();
            }
            
            updateOperatingHours();
        });
        
        $('.day-start, .day-end').off('change').on('change', function() {
            updateOperatingHours();
        });
        
        // 간단한 시간 설정 이벤트도 여기서 등록
        $('#startHour, #endHour').off('change').on('change', function() {
            updateOperatingHours();
        });
    }, 100);
}

function initializeOperatingHours() {
    const currentHours = $('#operatingHours').val();
    
    if (currentHours === '24시간') {
        $('#operating24').prop('checked', true);
    } else if (currentHours && currentHours !== '') {
        $('#operatingCustom').prop('checked', true);
        $('#customTimeContainer').show();
        $('#customOperatingHours').val(currentHours);
    }
}

function updateOperatingHours() {
    const operatingType = $('input[name="operatingType"]:checked').val();
    let operatingHours = '';
    
    if (operatingType === '24시간') {
        operatingHours = '24시간';
    } else if (operatingType === 'simple') {
        const startHour = $('#startHour').val();
        const endHour = $('#endHour').val();
        
        if (startHour && endHour) {
            operatingHours = `${startHour}:00-${endHour}:00`;
        }
    } else if (operatingType === 'weekly') {
        const weeklyHours = [];
        const days = ['월', '화', '수', '목', '금', '토', '일'];
        
        $('.day-check').each(function(index) {
            if ($(this).is(':checked')) {
                const startHour = $(`#start${index}`).val();
                const endHour = $(`#end${index}`).val();
                
                if (startHour && endHour) {
                    weeklyHours.push(`${days[index]} ${startHour}:00-${endHour}:00`);
                }
            } else {
                weeklyHours.push(`${days[index]} 휴무`);
            }
        });
        
        operatingHours = weeklyHours.join(', ');
    } else if (operatingType === 'custom') {
        operatingHours = $('#customOperatingHours').val();
    }
    
    $('#operatingHours').val(operatingHours);
}


// 간단한 시간 설정 라디오 버튼 동적 추가
$(document).ready(function() {
    const simpleOption = `
        <div class="col-12">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="operatingType" id="operatingSimple" value="simple">
                <label class="form-check-label" for="operatingSimple">
                    <i class="fas fa-clock me-1"></i>간단한 시간 설정
                </label>
            </div>
        </div>
    `;
    
    $('#operatingCustom').closest('.col-12').after(simpleOption);
    
    // 이벤트 리스너 다시 등록
    setTimeout(function() {
        $('input[name="operatingType"]').off('change').on('change', function() {
            const value = $(this).val();
            console.log('Operating type changed:', value);
            
            // 모든 컨테이너 숨기기
            $('#simpleTimeContainer, #weeklyTimeContainer, #customTimeContainer').hide();
            
            if (value === 'custom') {
                $('#customTimeContainer').show();
            } else if (value === 'weekly') {
                $('#weeklyTimeContainer').show();
                generateWeeklySchedule();
            } else if (value === 'simple') {
                $('#simpleTimeContainer').show();
            }
            
            updateOperatingHours();
        });
    }, 100);
    
    // 고급 이미지 크롭퍼 초기화
    initializeFacilityImageCropper();
});

// 시설 이미지 크롭퍼 초기화
function initializeFacilityImageCropper() {
    const facilityImageCropper = new AdvancedImageCropper('facilityImageUploader', {
        // 시설 이미지 최적화 설정
        aspectRatio: 16/10, // 시설 카드 비율
        cropWidth: 800,
        cropHeight: 500,
        previewStyle: 'facility',
        title: '시설 이미지 업로드',
        quality: 0.8,
        enableAltText: true,
        
        // 크롭 완료 콜백
        onCropComplete: function(result) {
            console.log('시설 이미지 크롭 완료:', result);
            
            // 기존 파일 입력에 압축된 파일 설정
            const facilityImageFile = document.getElementById('facilityImageFile');
            const facilityImageAltText = document.getElementById('facilityImageAltText');
            
            // DataTransfer를 사용하여 File 객체를 input에 설정
            const dataTransfer = new DataTransfer();
            const compressedFile = new File([result.compressedBlob], 
                result.originalFile.name, {
                    type: 'image/jpeg',
                    lastModified: Date.now()
                });
            
            dataTransfer.items.add(compressedFile);
            facilityImageFile.files = dataTransfer.files;
            
            // Alt 텍스트 설정
            if (facilityImageAltText) {
                facilityImageAltText.value = result.altText;
            }
            
            // 성공 메시지 표시
            showSuccessMessage('시설 이미지가 성공적으로 최적화되었습니다!');
        },
        
        // 에러 콜백
        onError: function(message) {
            console.error('시설 이미지 크롭 오류:', message);
            showErrorMessage('이미지 처리 중 오류가 발생했습니다: ' + message);
        }
    });
    
    // 전역에서 접근 가능하도록 저장
    window.facilityImageCropper = facilityImageCropper;
}

// 성공 메시지 표시
function showSuccessMessage(message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-success alert-dismissible fade show';
    alertDiv.innerHTML = `
        <i class="fas fa-check-circle me-2"></i>${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // 폼 상단에 메시지 삽입
    const form = document.getElementById('facilityEditForm');
    form.insertBefore(alertDiv, form.firstChild);
    
    // 5초 후 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}

// 에러 메시지 표시
function showErrorMessage(message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-danger alert-dismissible fade show';
    alertDiv.innerHTML = `
        <i class="fas fa-exclamation-triangle me-2"></i>${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // 폼 상단에 메시지 삽입
    const form = document.getElementById('facilityEditForm');
    form.insertBefore(alertDiv, form.firstChild);
    
    // 10초 후 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 10000);
}
</script>

</body>
</html>
````

## File: backup/facility-image-implementation/facility-image-implementation/detail-backup.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>시설 상세보기</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<div class="container mt-4">
    <!-- 브레드크럼 -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">홈</a></li>
            <li class="breadcrumb-item"><a href="/facility/search">시설 찾기</a></li>
            <li class="breadcrumb-item active" aria-current="page">시설 상세</li>
        </ol>
    </nav>
    <!-- 4:6 비율로 배치 -->
    <div class="row">
        <!-- 왼쪽 40%: 시설 기본정보 + 시설정보, 시설현황, 연락처정보, 관련서비스 -->
        <div class="col-md-5">
            <!-- 시설 기본정보 -->
            <div class="card mb-3 shadow-sm" style="min-height: 500px;">
                <div class="card-header bg-light">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-building text-primary me-2"></i>
                        <h5 class="mb-0">시설 기본정보</h5>
                    </div>
                </div>
                <div class="card-body d-flex flex-column">
                    <!-- 세로 배치: 이미지 → 내용 → 버튼 -->
                    
                    <!-- 1. 시설 이미지 슬라이더 -->
                    <div class="position-relative mb-4 flex-grow-1">
                        <div id="facilityImageCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
                            <div class="carousel-inner rounded shadow-sm" style="height: 250px;">
                                <!-- 다중 이미지가 있는 경우 -->
                                <div th:if="${facilityImages != null and #lists.size(facilityImages) > 0}">
                                    <div th:each="image, iterStat : ${facilityImages}" 
                                         th:class="${'carousel-item' + (iterStat.index == 0 ? ' active' : '')}">
                                        <img th:src="${image.imagePath}"
                                             class="d-block w-100 facility-carousel-img"
                                             style="height: 250px; object-fit: cover; cursor: pointer;"
                                             th:alt="${image.imageAltText}"
                                             th:onclick="'openImageModal(' + ${iterStat.index} + ')'"
                                             th:data-index="${iterStat.index}"
                                             loading="lazy">
                                        <!-- 이미지 순서 표시 -->
                                        <div class="carousel-caption d-none d-md-block" 
                                             style="background: rgba(0,0,0,0.5); border-radius: 5px; right: 10px; left: auto; bottom: 10px; width: auto; padding: 5px 10px;">
                                            <small th:text="${iterStat.index + 1} + '/' + ${#lists.size(facilityImages)}">1/5</small>
                                        </div>
                                    </div>
                                </div>
                                <!-- 이미지가 없는 경우 기본 이미지 -->
                                <div th:unless="${facilityImages != null and #lists.size(facilityImages) > 0}" 
                                     class="carousel-item active">
                                    <div class="d-flex align-items-center justify-content-center bg-light" style="height: 250px;">
                                        <div class="text-center text-muted">
                                            <i class="fas fa-image fa-3x mb-2" style="opacity: 0.3;"></i>
                                            <p class="mb-0 small">등록된 시설 이미지가 없습니다</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 이미지가 2개 이상일 때만 화살표 표시 -->
                            <div th:if="${facilityImages != null and #lists.size(facilityImages) > 1}">
                                <button class="carousel-control-prev" type="button" 
                                        data-bs-target="#facilityImageCarousel" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" 
                                          style="background-color: rgba(0,0,0,0.5); border-radius: 50%; width: 30px; height: 30px;"></span>
                                    <span class="visually-hidden">이전</span>
                                </button>
                                <button class="carousel-control-next" type="button" 
                                        data-bs-target="#facilityImageCarousel" data-bs-slide="next">
                                    <span class="carousel-control-next-icon"
                                          style="background-color: rgba(0,0,0,0.5); border-radius: 50%; width: 30px; height: 30px;"></span>
                                    <span class="visually-hidden">다음</span>
                                </button>
                            </div>
                            
                            <!-- 이미지 인디케이터 (점) -->
                            <div th:if="${facilityImages != null and #lists.size(facilityImages) > 1}" 
                                 class="carousel-indicators" style="bottom: -30px;">
                                <button th:each="image, iterStat : ${facilityImages}" 
                                        type="button" 
                                        data-bs-target="#facilityImageCarousel" 
                                        th:data-bs-slide-to="${iterStat.index}"
                                        th:class="${iterStat.index == 0 ? 'active' : ''}"
                                        style="width: 8px; height: 8px; border-radius: 50%; background-color: #007bff;"></button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 2. 시설명, 등급, 별점 -->
                    <div class="text-center mb-4">
                        <h4 class="mb-3" th:text="${facility.facilityName}">시설명</h4>
                        <div class="d-flex flex-wrap gap-2 justify-content-center mb-3">
                            <span class="badge bg-primary fs-6" th:text="${facility.facilityType}">시설유형</span>
                            <span th:if="${facility.gradeRating != null and facility.gradeRating > 0}" 
                                  class="badge fs-6 grade-badge"
                                  th:data-grade="${facility.gradeRating}"
                                  th:text="${facility.gradeRating} + '등급'">1등급</span>
                            <span th:unless="${facility.gradeRating != null and facility.gradeRating > 0}" 
                                  class="badge bg-secondary fs-6">등급 정보 없음</span>
                        </div>
                        <div th:if="${facility.averageRating != null and facility.averageRating > 0}">
                            <span class="badge bg-warning text-dark fs-6">
                                <i class="fas fa-star"></i> <span th:text="${#numbers.formatDecimal(facility.averageRating, 1, 1)}">0.0</span>
                            </span>
                        </div>
                    </div>
                    
                    <!-- 3. 버튼 -->
                    <div class="mt-auto">
                        <!-- 관리자 또는 시설 소유자인 경우 관리 버튼 표시 -->
                        <div th:if="${isAdmin or isOwner}" class="mb-3">
                            <div class="row g-2">
                                <div class="col-6">
                                    <a th:href="@{/facility/edit/{id}(id=${facility.facilityId})}" 
                                       class="btn btn-warning w-100 btn-sm">
                                        <i class="fas fa-edit"></i><br><small>시설수정</small>
                                    </a>
                                </div>
                                <div class="col-6">
                                    <button class="btn btn-danger w-100 btn-sm" 
                                            th:onclick="'deleteFacility(' + ${facility.facilityId} + ')'">
                                        <i class="fas fa-trash"></i><br><small>시설삭제</small>
                                    </button>
                                </div>
                            </div>
                            <hr class="my-3">
                        </div>
                        
                        <!-- 일반 사용자 버튼 -->
                        <div class="row g-2">
                            <div class="col-6">
                                <button class="btn btn-primary w-100 btn-sm" th:data-phone="${facility.phone}" onclick="callFacilityPhone(this)">
                                    <i class="fas fa-phone"></i><br><small>전화상담</small>
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-success w-100 btn-sm" onclick="writeReview()">
                                    <i class="fas fa-star"></i><br><small>리뷰작성</small>
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-secondary w-100 btn-sm" onclick="shareToKakao()">
                                    <i class="fas fa-share"></i><br><small>공유</small>
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-primary w-100 btn-sm" onclick="searchNearbyJobs()">
                                    <i class="fas fa-briefcase"></i><br><small>주변채용</small>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 시설정보 -->
            <div class="card mb-3 shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-info-circle text-primary me-2"></i>시설정보</h6>
                </div>
                <div class="card-body">
                    <div class="row small">
                        <div class="col-12">
                            <div class="info-item mb-2">
                                <i class="fas fa-map-marker-alt text-danger me-2"></i>
                                <span th:text="${facility.address}">주소</span>
                            </div>
                            <div class="info-item mb-2">
                                <i class="fas fa-phone text-success me-2"></i>
                                <span th:text="${facility.phone}">전화번호</span>
                            </div>
                            <div class="info-item mb-2">
                                <i class="fas fa-user-tie text-primary me-2"></i>
                                원장: <span th:text="${facility.registeredMemberName}">원장명</span>
                            </div>
                            <div class="info-item mb-2">
                                <i class="fas fa-bed text-warning me-2"></i>
                                정원: <span th:text="${facility.capacity}">정원</span>명
                                <span th:if="${facility.currentOccupancy != null}" class="text-muted">
                                    (현재: <span th:text="${facility.currentOccupancy}">0</span>명)
                                </span>
                            </div>
                            <div class="info-item mb-2" th:if="${facility.homepage}">
                                <i class="fas fa-globe text-info me-2"></i>
                                <a th:href="${facility.homepage}" target="_blank" class="text-decoration-none">홈페이지</a>
                            </div>
                        </div>
                    </div>
                    <div th:if="${facility.description}" class="mt-3 pt-2 border-top">
                        <p class="small mb-0" style="line-height: 1.4;" th:text="${facility.description}">시설 소개</p>
                    </div>
                    <div th:if="${facility.features}" class="mt-2">
                        <div class="features-list">
                            <span th:each="feature : ${#strings.arraySplit(facility.features, ',')}" 
                                  class="badge bg-light text-dark me-1 mb-1" th:text="${feature}">특징</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 시설현황 -->
            <div class="card mb-3 shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-chart-bar text-primary me-2"></i>시설현황</h6>
                </div>
                <div class="card-body">
                    <div class="row text-center g-2">
                        <div class="col-6">
                            <div class="p-2 bg-light rounded">
                                <h5 th:if="${facility.gradeRating != null and facility.gradeRating > 0}"
                                    th:text="${facility.gradeRating} + '등급'"
                                    class="grade-rating mb-1"
                                    th:data-grade="${facility.gradeRating}">1등급</h5>
                                <h5 th:unless="${facility.gradeRating != null and facility.gradeRating > 0}" class="text-muted mb-1">-</h5>
                                <small class="text-muted">시설등급</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-2 bg-light rounded">
                                <h5 class="mb-1" th:text="${facility.capacity ?: '-'}">-</h5>
                                <small class="text-muted">정원</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-2 bg-light rounded">
                                <h5 class="mb-1" th:text="${facility.currentOccupancy ?: '0'}">0</h5>
                                <small class="text-muted">현재입소</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-2 bg-light rounded">
                                <h5 th:if="${facility.averageRating != null and facility.averageRating > 0}"
                                    th:text="${#numbers.formatDecimal(facility.averageRating, 1, 1)}"
                                    class="text-warning mb-1">4.5</h5>
                                <h5 th:unless="${facility.averageRating != null and facility.averageRating > 0}" class="text-muted mb-1">0.0</h5>
                                <small class="text-muted">평균평점</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <!-- 오른쪽 60%: 지도와 리뷰 -->
        <div class="col-md-7">
            <!-- 위치 및 교통정보 -->
            <div class="card mb-3 shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-map-marker-alt text-danger me-2"></i>위치 및 교통정보</h5>
                </div>
                <div class="card-body p-0">
                    <div id="facilityMap" style="width:100%; height:400px;">
                        <div class="d-flex align-items-center justify-content-center h-100 text-muted">
                            <div class="text-center">
                                <i class="fas fa-map fa-3x mb-3 text-primary"></i>
                                <p class="fs-6">지도를 불러오는 중...</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-3 bg-light border-top">
                        <div class="d-flex align-items-center mb-1">
                            <i class="fas fa-map-marker-alt text-danger me-2"></i>
                            <strong th:text="${facility.address}">주소가 여기에 표시됩니다</strong>
                        </div>
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            지도를 클릭하거나 확대/축소하여 더 자세한 위치를 확인할 수 있습니다
                        </small>
                    </div>
                </div>
            </div>

            <!-- 시설리뷰 -->
            <div class="card shadow-sm">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-comments text-primary me-2"></i>시설리뷰 
                        <span class="badge bg-primary ms-2" th:text="${reviewCount}">0</span>
                    </h5>
                    <button class="btn btn-sm btn-primary" onclick="writeReview()">
                        <i class="fas fa-plus me-1"></i>리뷰 작성
                    </button>
                </div>
                <div class="card-body">
                    <div id="reviewList">
                        <!-- 리뷰가 있는 경우 -->
                        <div th:if="${not #lists.isEmpty(recentReviews)}">
                            <div th:each="review : ${recentReviews}" class="review-item border-bottom pb-3 mb-3">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1" th:text="${review.title}">리뷰 제목</h6>
                                        <div class="mb-2">
                                            <span class="text-warning">
                                                <i th:each="i : ${#numbers.sequence(1, 5)}" 
                                                   th:class="${i <= review.rating} ? 'fas fa-star' : 'far fa-star'"></i>
                                            </span>
                                            <span class="ms-2 fw-bold" th:text="${review.rating} + '.0'">5.0</span>
                                        </div>
                                        <p class="text-muted small mb-2" th:text="${#strings.abbreviate(review.content, 100)}">리뷰 내용 미리보기</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">
                                                <i class="fas fa-user me-1"></i>
                                                <span th:text="${review.memberName}">작성자</span>
                                                <span class="mx-2">|</span>
                                                <i class="fas fa-calendar me-1"></i>
                                                <span th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd')}">작성일</span>
                                            </small>
                                            <a th:href="@{/review/detail/{id}(id=${review.reviewId})}" class="btn btn-sm btn-outline-secondary">
                                                <i class="fas fa-eye me-1"></i>상세보기
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center mt-3">
                                <a th:href="@{/review(facilityId=${facility.facilityId})}" class="btn btn-outline-primary me-2">
                                    <i class="fas fa-list me-1"></i>전체 리뷰 보기
                                </a>
                                <!-- 시설 소유자만 관리 버튼 표시 -->
                                <a th:if="${session.loginMember != null and session.loginMember.memberId == facility.registeredMemberId}" 
                                   th:href="@{/facility/manage}" class="btn btn-success">
                                    <i class="fas fa-cogs me-1"></i>시설 관리
                                </a>
                            </div>
                        </div>
                        
                        <!-- 리뷰가 없는 경우 -->
                        <div th:if="${#lists.isEmpty(recentReviews)}" class="text-center text-muted py-4">
                            <i class="fas fa-comments fa-2x mb-2"></i>
                            <p>아직 리뷰가 없습니다.</p>
                            <p class="small">첫 번째 리뷰를 작성해보세요!</p>
                            <!-- 시설 소유자만 관리 버튼 표시 -->
                            <div th:if="${session.loginMember != null and session.loginMember.memberId == facility.registeredMemberId}" class="mt-3">
                                <a th:href="@{/facility/manage}" class="btn btn-success">
                                    <i class="fas fa-cogs me-1"></i>시설 관리
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{layout/footer :: footer}"></div>
<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 카카오맵 API -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_APP_KEY&libraries=services,clusterer,drawing"></script>

<!-- 시설 상세보기 전용 JavaScript -->
<script src="/js/facility-detail.js"></script>
<script src="/js/facility-detail-map.js"></script>

<!-- Thymeleaf 데이터 전달 스크립트 -->
<script th:inline="javascript">
    /*<![CDATA[*/
    
    // 시설 데이터 초기화
    const facilityDataFromServer = {
        facilityId: /*[[${facility.facilityId}]]*/ 0,
        name: /*[[${facility.facilityName}]]*/ '',
        latitude: /*[[${facility.latitude}]]*/ 0,
        longitude: /*[[${facility.longitude}]]*/ 0,
        address: /*[[${facility.address}]]*/ '',
        phone: /*[[${facility.phone}]]*/ '',
        facilityImage: /*[[${facility.facilityImage}]]*/ ''
    };
    
    // 시설 이미지 데이터 초기화
    const facilityImagesFromServer = [
        /*[# th:each="image, imageStat : ${facilityImages}"]*/
        {
            path: '[[${image.imagePath}]]',
            alt: '[[${image.imageAltText != null ? image.imageAltText : "시설 이미지"}]]'
        }/*[# th:unless="${imageStat.last}"],*//*[/]*/
        /*[/]*/
    ];

    // DOM 로드 후 데이터 초기화
    $(document).ready(function() {
        console.log('🏢 시설 상세보기 페이지 초기화 시작');
        
        // 데이터 초기화
        initializeFacilityData(facilityDataFromServer);
        initializeFacilityImages(facilityImagesFromServer);
        initializeFacilityMapData(facilityDataFromServer);
        
        // 지도 초기화
        setTimeout(function() {
            initializeFacilityDetailMap();
        }, 500);
        
        console.log('✅ 시설 상세보기 페이지 초기화 완료');
    });

    // 전화하기 버튼 클릭 이벤트 핸들러
    function callFacilityPhone(button) {
        const phone = button.getAttribute('data-phone');
        if (phone) {
            window.location.href = `tel:${phone}`;
        }
    }

    // 리뷰 작성 페이지로 이동
    function writeReview() {
        window.location.href = `/review/write?facilityId=[[${facility.facilityId}]]`;
    }


    // 주변 구인정보 검색
    function searchNearbyJobs() {
        const latitude = /*[[${facility.latitude}]]*/ 0;
        const longitude = /*[[${facility.longitude}]]*/ 0;
        window.location.href = `/job/list?lat=${latitude}&lng=${longitude}&radius=5`;
    }

    // 카카오톡 공유하기
    function shareToKakao() {
        const facilityId = /*[[${facility.facilityId}]]*/ 0;
        const facilityName = /*[[${facility.facilityName}]]*/ '시설명';
        const address = /*[[${facility.address}]]*/ '주소';
        const logoImageUrl = /*[[${facility.facilityImage}]]*/ '/images/default_facility.jpg';

        if (window.Kakao) {
            Kakao.Link.sendDefault({
                objectType: 'location',
                address: address,
                addressTitle: facilityName,
                content: {
                    title: facilityName,
                    description: `${address}\n상세 정보 보기`,
                    imageUrl: logoImageUrl,
                    link: {
                        mobileWebUrl: window.location.href,
                        webUrl: window.location.href
                    }
                },
                buttons: [
                    {
                        title: '상세 정보 보기',
                        link: {
                            mobileWebUrl: window.location.href,
                            webUrl: window.location.href
                        }
                    }
                ]
            });
        } else {
            alert('카카오톡 공유하기를 사용할 수 없습니다.');
        }
    }

    /*]]>*/
</script>

<!-- 이미지 확대 모달 -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content bg-dark">
            <div class="modal-header border-0">
                <h5 class="modal-title text-white" id="imageModalLabel">시설 이미지</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="닫기"></button>
            </div>
            <div class="modal-body p-0 position-relative">
                <div id="modalCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
                    <div class="carousel-inner" id="modalCarouselInner">
                        <!-- 이미지들이 JavaScript로 동적 생성됨 -->
                    </div>
                    
                    <!-- 모달 내 컨트롤 -->
                    <button class="carousel-control-prev" type="button" data-bs-target="#modalCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" style="width: 40px; height: 40px;"></span>
                        <span class="visually-hidden">이전</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#modalCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon" style="width: 40px; height: 40px;"></span>
                        <span class="visually-hidden">다음</span>
                    </button>
                    
                    <!-- 모달 내 인디케이터 -->
                    <div class="carousel-indicators" id="modalCarouselIndicators">
                        <!-- JavaScript로 동적 생성됨 -->
                    </div>
                </div>
                
                <!-- 이미지 정보 표시 -->
                <div class="position-absolute bottom-0 start-0 end-0 bg-dark bg-opacity-75 text-white p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <span id="modalImageCounter">1 / 5</span>
                            <span class="ms-3" id="modalImageAlt">시설 이미지</span>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline-light me-2" onclick="toggleAutoSlide()">
                                <i class="fas fa-play" id="autoSlideIcon"></i>
                                <span id="autoSlideText">자동재생</span>
                            </button>
                            <button class="btn btn-sm btn-outline-light" onclick="downloadImage()">
                                <i class="fas fa-download"></i> 다운로드
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// 시설 이미지 데이터 (Thymeleaf에서 JavaScript로 전달)
const facilityImages = [
    /*[# th:each="image, imageStat : ${facilityImages}"]*/
    {
        path: '[[${image.imagePath}]]',
        alt: '[[${image.imageAltText != null ? image.imageAltText : "시설 이미지"}]]'
    }/*[# th:unless="${imageStat.last}"],*//*[/]*/
    /*[/]*/
];

console.log('📸 시설 이미지 데이터 로드:', facilityImages);

let currentModalIndex = 0;
let modalCarousel;
let autoSlideInterval;
let isAutoSliding = false;

// DOM 로드 완료 후 초기화
document.addEventListener('DOMContentLoaded', function() {
    console.log('🖼️ DOM 로드 완료 - 시설 이미지 수:', facilityImages.length);
    console.log('📸 이미지 데이터:', facilityImages);
    
    // 모달 요소 확인
    const modal = document.getElementById('imageModal');
    if (!modal) {
        console.error('❌ 이미지 모달 요소를 찾을 수 없습니다');
    } else {
        console.log('✅ 이미지 모달 요소 확인됨');
    }
});

// 이미지 모달 열기
function openImageModal(imageIndex = 0) {
    console.log('🖼️ 이미지 모달 열기 시도 - imageIndex:', imageIndex);
    console.log('📸 사용 가능한 이미지 수:', facilityImages.length);
    
    if (facilityImages.length === 0) {
        console.warn('⚠️ 표시할 이미지가 없습니다');
        alert('표시할 이미지가 없습니다.');
        return;
    }
    
    currentModalIndex = Math.max(0, Math.min(imageIndex, facilityImages.length - 1));
    console.log('📍 실제 모달 인덱스:', currentModalIndex);
    
    setupModalCarousel();
    
    const modalElement = document.getElementById('imageModal');
    const modal = new bootstrap.Modal(modalElement);
    
    // 기존 이벤트 리스너 제거 (중복 방지)
    modalElement.removeEventListener('shown.bs.modal', handleModalShown);
    modalElement.removeEventListener('hidden.bs.modal', handleModalHidden);
    
    // 새 이벤트 리스너 추가
    modalElement.addEventListener('shown.bs.modal', handleModalShown);
    modalElement.addEventListener('hidden.bs.modal', handleModalHidden);
    
    modal.show();
    console.log('✅ 모달 표시 완료');
}

// 모달 표시 완료 이벤트 핸들러
function handleModalShown() {
    console.log('🎯 모달이 완전히 열림 - 캐러셀 초기화');
    if (modalCarousel) {
        modalCarousel.to(currentModalIndex);
        updateModalImageInfo();
    }
    startAutoSlide();
}

// 모달 숨김 이벤트 핸들러
function handleModalHidden() {
    console.log('🚪 모달이 닫힘 - 정리 작업');
    stopAutoSlide();
}

// 모달 캐러셀 설정
function setupModalCarousel() {
    console.log('🔧 모달 캐러셀 설정 시작');
    
    const carouselInner = document.getElementById('modalCarouselInner');
    const indicators = document.getElementById('modalCarouselIndicators');
    
    if (!carouselInner || !indicators) {
        console.error('❌ 모달 캐러셀 요소를 찾을 수 없음');
        return;
    }
    
    // 기존 캐러셀 인스턴스 해제
    if (modalCarousel) {
        modalCarousel.dispose();
        modalCarousel = null;
    }
    
    // 기존 내용 정리
    carouselInner.innerHTML = '';
    indicators.innerHTML = '';
    
    console.log('📸 모달에 표시할 이미지 수:', facilityImages.length);
    
    // 이미지 아이템 생성
    facilityImages.forEach((image, index) => {
        console.log(`🖼️ 이미지 ${index + 1} 생성:`, image.path);
        
        // 캐러셀 아이템
        const carouselItem = document.createElement('div');
        carouselItem.className = `carousel-item ${index === currentModalIndex ? 'active' : ''}`;
        carouselItem.innerHTML = `
            <div class="d-flex justify-content-center align-items-center" style="height: 80vh;">
                <img src="${image.path}" 
                     class="img-fluid" 
                     style="max-height: 100%; max-width: 100%; object-fit: contain;" 
                     alt="${image.alt || '시설 이미지'}"
                     onerror="this.src='/images/default_facility.jpg'">
            </div>
        `;
        carouselInner.appendChild(carouselItem);
        
        // 인디케이터 버튼 (이미지가 2개 이상일 때만)
        if (facilityImages.length > 1) {
            const indicator = document.createElement('button');
            indicator.type = 'button';
            indicator.setAttribute('data-bs-target', '#modalCarousel');
            indicator.setAttribute('data-bs-slide-to', index);
            indicator.className = index === currentModalIndex ? 'active' : '';
            indicator.setAttribute('aria-label', `이미지 ${index + 1}`);
            indicators.appendChild(indicator);
        }
    });
    
    // 캐러셀 요소 표시/숨김 처리
    const prevBtn = document.querySelector('#modalCarousel .carousel-control-prev');
    const nextBtn = document.querySelector('#modalCarousel .carousel-control-next');
    
    if (facilityImages.length <= 1) {
        if (prevBtn) prevBtn.style.display = 'none';
        if (nextBtn) nextBtn.style.display = 'none';
        indicators.style.display = 'none';
    } else {
        if (prevBtn) prevBtn.style.display = 'block';
        if (nextBtn) nextBtn.style.display = 'block';
        indicators.style.display = 'block';
    }
    
    // 캐러셀 인스턴스 생성
    const carouselElement = document.getElementById('modalCarousel');
    modalCarousel = new bootstrap.Carousel(carouselElement, {
        interval: false, // 자동 슬라이드는 별도로 관리
        ride: false,
        wrap: true
    });
    
    // 기존 이벤트 리스너 제거
    carouselElement.removeEventListener('slide.bs.carousel', handleCarouselSlide);
    carouselElement.removeEventListener('slid.bs.carousel', handleCarouselSlid);
    
    // 슬라이드 이벤트 리스너 추가
    carouselElement.addEventListener('slide.bs.carousel', handleCarouselSlide);
    carouselElement.addEventListener('slid.bs.carousel', handleCarouselSlid);
    
    updateModalImageInfo();
    console.log('✅ 모달 캐러셀 설정 완료');
}

// 캐러셀 슬라이드 시작 이벤트
function handleCarouselSlide(event) {
    console.log('🔄 캐러셀 슬라이드 시작:', event.from, '→', event.to);
    currentModalIndex = event.to;
}

// 캐러셀 슬라이드 완료 이벤트
function handleCarouselSlid(event) {
    console.log('✅ 캐러셀 슬라이드 완료:', event.to);
    currentModalIndex = event.to;
    updateModalImageInfo();
}

// 모달 이미지 정보 업데이트
function updateModalImageInfo() {
    const counter = document.getElementById('modalImageCounter');
    const altText = document.getElementById('modalImageAlt');
    
    if (facilityImages.length > 0) {
        counter.textContent = `${currentModalIndex + 1} / ${facilityImages.length}`;
        altText.textContent = facilityImages[currentModalIndex].alt || '시설 이미지';
    }
}

// 자동 슬라이드 시작
function startAutoSlide() {
    if (facilityImages.length <= 1) return;
    
    isAutoSliding = true;
    updateAutoSlideButton();
    
    autoSlideInterval = setInterval(() => {
        if (modalCarousel) {
            modalCarousel.next();
        }
    }, 5000);
}

// 자동 슬라이드 정지
function stopAutoSlide() {
    isAutoSliding = false;
    updateAutoSlideButton();
    
    if (autoSlideInterval) {
        clearInterval(autoSlideInterval);
        autoSlideInterval = null;
    }
}

// 자동 슬라이드 토글
function toggleAutoSlide() {
    if (isAutoSliding) {
        stopAutoSlide();
    } else {
        startAutoSlide();
    }
}

// 자동 슬라이드 버튼 업데이트
function updateAutoSlideButton() {
    const icon = document.getElementById('autoSlideIcon');
    const text = document.getElementById('autoSlideText');
    
    if (isAutoSliding) {
        icon.className = 'fas fa-pause';
        text.textContent = '일시정지';
    } else {
        icon.className = 'fas fa-play';
        text.textContent = '자동재생';
    }
}

// 이미지 다운로드
function downloadImage() {
    if (facilityImages.length === 0) return;
    
    const currentImage = facilityImages[currentModalIndex];
    const link = document.createElement('a');
    link.href = currentImage.path;
    link.download = `시설이미지_${currentModalIndex + 1}.jpg`;
    link.click();
}

// 키보드 단축키 (모달이 열려있을 때)
document.addEventListener('keydown', function(e) {
    const modal = document.getElementById('imageModal');
    if (!modal.classList.contains('show')) return;
    
    switch(e.key) {
        case 'ArrowLeft':
            e.preventDefault();
            if (modalCarousel) modalCarousel.prev();
            break;
        case 'ArrowRight':
            e.preventDefault();
            if (modalCarousel) modalCarousel.next();
            break;
        case ' ': // 스페이스바
            e.preventDefault();
            toggleAutoSlide();
            break;
        case 'Escape':
            e.preventDefault();
            bootstrap.Modal.getInstance(modal)?.hide();
            break;
    }
});
</script>

<script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>
<script>
    // 새로운 App Key로 카카오톡 SDK 초기화
    Kakao.init('YOUR_KAKAO_APP_KEY');
</script>
</body>
</html>
````

## File: backup/facility-image-implementation/facility-image-implementation/detail.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>시설 상세보기</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<div class="container mt-4">
    <!-- 브레드크럼 -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">홈</a></li>
            <li class="breadcrumb-item"><a href="/facility/search">시설 찾기</a></li>
            <li class="breadcrumb-item active" aria-current="page">시설 상세</li>
        </ol>
    </nav>
    <!-- 4:6 비율로 배치 -->
    <div class="row">
        <!-- 왼쪽 40%: 시설 기본정보 + 시설정보, 시설현황, 연락처정보, 관련서비스 -->
        <div class="col-md-5">
            <!-- 시설 기본정보 -->
            <div class="card mb-3 shadow-sm" style="min-height: 500px;">
                <div class="card-header bg-light">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-building text-primary me-2"></i>
                        <h5 class="mb-0">시설 기본정보</h5>
                    </div>
                </div>
                <div class="card-body d-flex flex-column">
                    <!-- 세로 배치: 이미지 → 내용 → 버튼 -->
                    
                    <!-- 1. 시설 이미지 슬라이더 -->
                    <div class="position-relative mb-4 flex-grow-1">
                        <div id="facilityImageCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
                            <div class="carousel-inner rounded shadow-sm" style="height: 250px;">
                                <!-- 다중 이미지가 있는 경우 -->
                                <div th:if="${facilityImages != null and #lists.size(facilityImages) > 0}">
                                    <div th:each="image, iterStat : ${facilityImages}" 
                                         th:class="${'carousel-item' + (iterStat.index == 0 ? ' active' : '')}">
                                        <img th:src="${image.imagePath}"
                                             class="d-block w-100 facility-carousel-img"
                                             style="height: 250px; object-fit: cover; cursor: pointer;"
                                             th:alt="${image.imageAltText}"
                                             th:onclick="'openImageModal(' + ${iterStat.index} + ')'"
                                             th:data-index="${iterStat.index}"
                                             loading="lazy">
                                        <!-- 이미지 순서 표시 -->
                                        <div class="carousel-caption d-none d-md-block" 
                                             style="background: rgba(0,0,0,0.5); border-radius: 5px; right: 10px; left: auto; bottom: 10px; width: auto; padding: 5px 10px;">
                                            <small th:text="${iterStat.index + 1} + '/' + ${#lists.size(facilityImages)}">1/5</small>
                                        </div>
                                    </div>
                                </div>
                                <!-- 이미지가 없는 경우 기본 이미지 -->
                                <div th:unless="${facilityImages != null and #lists.size(facilityImages) > 0}" 
                                     class="carousel-item active">
                                    <div class="d-flex align-items-center justify-content-center bg-light" style="height: 250px;">
                                        <div class="text-center text-muted">
                                            <i class="fas fa-image fa-3x mb-2" style="opacity: 0.3;"></i>
                                            <p class="mb-0 small">등록된 시설 이미지가 없습니다</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 이미지가 2개 이상일 때만 화살표 표시 -->
                            <div th:if="${facilityImages != null and #lists.size(facilityImages) > 1}">
                                <button class="carousel-control-prev" type="button" 
                                        data-bs-target="#facilityImageCarousel" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" 
                                          style="background-color: rgba(0,0,0,0.5); border-radius: 50%; width: 30px; height: 30px;"></span>
                                    <span class="visually-hidden">이전</span>
                                </button>
                                <button class="carousel-control-next" type="button" 
                                        data-bs-target="#facilityImageCarousel" data-bs-slide="next">
                                    <span class="carousel-control-next-icon"
                                          style="background-color: rgba(0,0,0,0.5); border-radius: 50%; width: 30px; height: 30px;"></span>
                                    <span class="visually-hidden">다음</span>
                                </button>
                            </div>
                            
                            <!-- 이미지 인디케이터 (점) -->
                            <div th:if="${facilityImages != null and #lists.size(facilityImages) > 1}" 
                                 class="carousel-indicators" style="bottom: -30px;">
                                <button th:each="image, iterStat : ${facilityImages}" 
                                        type="button" 
                                        data-bs-target="#facilityImageCarousel" 
                                        th:data-bs-slide-to="${iterStat.index}"
                                        th:class="${iterStat.index == 0 ? 'active' : ''}"
                                        style="width: 8px; height: 8px; border-radius: 50%; background-color: #007bff;"></button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 2. 시설명, 등급, 별점 -->
                    <div class="text-center mb-4">
                        <h4 class="mb-3" th:text="${facility.facilityName}">시설명</h4>
                        <div class="d-flex flex-wrap gap-2 justify-content-center mb-3">
                            <span th:if="${facility.gradeRating != null and facility.gradeRating > 0}" 
                                  class="badge grade-badge" 
                                  th:data-grade="${facility.gradeRating}"
                                  th:text="${facility.gradeRating} + '등급'">1등급</span>
                            
                            <!-- 평점 표시 -->
                            <div class="d-flex align-items-center">
                                <div class="rating me-2">
                                    <span th:each="i : ${#numbers.sequence(1, 5)}" 
                                          class="fas fa-star" 
                                          th:classappend="${i <= (facility.averageRating ?: 0)} ? 'text-warning' : 'text-muted'"></span>
                                </div>
                                <span class="badge bg-warning text-dark" 
                                      th:text="${facility.averageRating != null ? #numbers.formatDecimal(facility.averageRating, 1, 1) : '0.0'} + '/5.0'">4.5/5.0</span>
                                <span class="text-muted small ms-2" 
                                      th:text="'(' + ${facility.reviewCount ?: 0} + '개 리뷰)'">( 0개 리뷰)</span>
                            </div>
                        </div>
                        
                        <!-- 3. 연락 및 공유 버튼 그룹 -->
                        <div class="row g-2">
                            <div class="col-6">
                                <button class="btn btn-success w-100 btn-sm" 
                                        th:onclick="'callFacilityPhone(this)'" 
                                        th:data-phone="${facility.phone}">
                                    <i class="fas fa-phone"></i><br><small>전화하기</small>
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-primary w-100 btn-sm" onclick="writeReview()">
                                    <i class="fas fa-edit"></i><br><small>리뷰작성</small>
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-secondary w-100 btn-sm" onclick="shareToKakao()">
                                    <i class="fas fa-share"></i><br><small>공유</small>
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-primary w-100 btn-sm" onclick="searchNearbyJobs()">
                                    <i class="fas fa-briefcase"></i><br><small>주변채용</small>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 시설정보 -->
            <div class="card mb-3 shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-info-circle text-primary me-2"></i>시설정보</h6>
                </div>
                <div class="card-body">
                    <div class="row small">
                        <div class="col-12">
                            <div class="info-item mb-2">
                                <i class="fas fa-map-marker-alt text-danger me-2"></i>
                                <span th:text="${facility.address}">주소</span>
                            </div>
                            <div class="info-item mb-2">
                                <i class="fas fa-phone text-success me-2"></i>
                                <span th:text="${facility.phone}">전화번호</span>
                            </div>
                            <div class="info-item mb-2">
                                <i class="fas fa-user-tie text-primary me-2"></i>
                                원장: <span th:text="${facility.registeredMemberName}">원장명</span>
                            </div>
                            <div class="info-item mb-2">
                                <i class="fas fa-bed text-warning me-2"></i>
                                정원: <span th:text="${facility.capacity}">정원</span>명
                                <span th:if="${facility.currentOccupancy != null}" class="text-muted">
                                    (현재: <span th:text="${facility.currentOccupancy}">0</span>명)
                                </span>
                            </div>
                            <div class="info-item mb-2" th:if="${facility.homepage}">
                                <i class="fas fa-globe text-info me-2"></i>
                                <a th:href="${facility.homepage}" target="_blank" class="text-decoration-none">홈페이지</a>
                            </div>
                        </div>
                    </div>
                    <div th:if="${facility.description}" class="mt-3 pt-2 border-top">
                        <p class="small mb-0" style="line-height: 1.4;" th:text="${facility.description}">시설 소개</p>
                    </div>
                    <div th:if="${facility.features}" class="mt-2">
                        <div class="d-flex flex-wrap gap-1">
                            <span th:each="feature : ${#strings.listSplit(facility.features, ',')}" 
                                  class="badge bg-light text-dark border" 
                                  th:text="${#strings.trim(feature)}">특징</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 시설현황 -->
            <div class="card mb-3 shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-chart-bar text-primary me-2"></i>시설현황</h6>
                </div>
                <div class="card-body">
                    <div class="row text-center g-2">
                        <div class="col-6">
                            <div class="p-2 bg-light rounded">
                                <h5 th:if="${facility.gradeRating != null and facility.gradeRating > 0}"
                                    th:text="${facility.gradeRating} + '등급'"
                                    class="grade-rating mb-1"
                                    th:data-grade="${facility.gradeRating}">1등급</h5>
                                <h5 th:unless="${facility.gradeRating != null and facility.gradeRating > 0}" class="text-muted mb-1">-</h5>
                                <small class="text-muted">시설등급</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-2 bg-light rounded">
                                <h5 class="mb-1" th:text="${facility.capacity ?: '-'}">-</h5>
                                <small class="text-muted">정원</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-2 bg-light rounded">
                                <h5 class="mb-1" th:text="${facility.currentOccupancy ?: '0'}">0</h5>
                                <small class="text-muted">현재입소</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-2 bg-light rounded">
                                <h5 th:if="${facility.averageRating != null and facility.averageRating > 0}"
                                    th:text="${#numbers.formatDecimal(facility.averageRating, 1, 1)}"
                                    class="text-warning mb-1">4.5</h5>
                                <h5 th:unless="${facility.averageRating != null and facility.averageRating > 0}" class="text-muted mb-1">0.0</h5>
                                <small class="text-muted">평균평점</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <!-- 오른쪽 60%: 지도와 리뷰 -->
        <div class="col-md-7">
            <!-- 위치 및 교통정보 -->
            <div class="card mb-3 shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-map-marker-alt text-danger me-2"></i>위치 및 교통정보</h5>
                </div>
                <div class="card-body p-0">
                    <div id="facilityMap" style="width:100%; height:400px;">
                        <div class="d-flex align-items-center justify-content-center h-100 text-muted">
                            <div class="text-center">
                                <i class="fas fa-map fa-3x mb-3 text-primary"></i>
                                <p class="fs-6">지도를 불러오는 중...</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-3 bg-light border-top">
                        <div class="d-flex align-items-center mb-1">
                            <i class="fas fa-map-marker-alt text-danger me-2"></i>
                            <strong th:text="${facility.address}">주소가 여기에 표시됩니다</strong>
                        </div>
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            지도를 클릭하거나 확대/축소하여 더 자세한 위치를 확인할 수 있습니다
                        </small>
                    </div>
                </div>
            </div>

            <!-- 시설리뷰 -->
            <div class="card shadow-sm">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-comments text-primary me-2"></i>시설리뷰 
                        <span class="badge bg-primary ms-2" th:text="${reviewCount}">0</span>
                    </h5>
                    <button class="btn btn-sm btn-primary" onclick="writeReview()">
                        <i class="fas fa-plus me-1"></i>리뷰 작성
                    </button>
                </div>
                <div class="card-body">
                    <div id="reviewList">
                        <!-- 리뷰가 있는 경우 -->
                        <div th:if="${not #lists.isEmpty(recentReviews)}">
                            <div th:each="review : ${recentReviews}" class="review-item border-bottom pb-3 mb-3">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1" th:text="${review.title}">리뷰 제목</h6>
                                        <div class="mb-2">
                                            <span class="text-warning">
                                                <i th:each="i : ${#numbers.sequence(1, 5)}" 
                                                   th:class="${i <= review.rating} ? 'fas fa-star' : 'far fa-star'"></i>
                                            </span>
                                            <span class="ms-2 fw-bold" th:text="${review.rating} + '.0'">5.0</span>
                                        </div>
                                        <p class="text-muted small mb-2" th:text="${#strings.abbreviate(review.content, 100)}">리뷰 내용 미리보기</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">
                                                <i class="fas fa-user me-1"></i>
                                                <span th:text="${review.memberName}">작성자</span>
                                                <span class="mx-2">|</span>
                                                <i class="fas fa-calendar me-1"></i>
                                                <span th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd')}">작성일</span>
                                            </small>
                                            <a th:href="@{/review/detail/{id}(id=${review.reviewId})}" class="btn btn-sm btn-outline-secondary">
                                                <i class="fas fa-eye me-1"></i>상세보기
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center mt-3">
                                <a th:href="@{/review(facilityId=${facility.facilityId})}" class="btn btn-outline-primary me-2">
                                    <i class="fas fa-list me-1"></i>전체 리뷰 보기
                                </a>
                                <!-- 시설 소유자만 관리 버튼 표시 -->
                                <a th:if="${session.loginMember != null and session.loginMember.memberId == facility.registeredMemberId}" 
                                   th:href="@{/facility/manage}" class="btn btn-success">
                                    <i class="fas fa-cogs me-1"></i>시설 관리
                                </a>
                            </div>
                        </div>
                        
                        <!-- 리뷰가 없는 경우 -->
                        <div th:if="${#lists.isEmpty(recentReviews)}" class="text-center text-muted py-4">
                            <i class="fas fa-comments fa-2x mb-2"></i>
                            <p>아직 리뷰가 없습니다.</p>
                            <p class="small">첫 번째 리뷰를 작성해보세요!</p>
                            <!-- 시설 소유자만 관리 버튼 표시 -->
                            <div th:if="${session.loginMember != null and session.loginMember.memberId == facility.registeredMemberId}" class="mt-3">
                                <a th:href="@{/facility/manage}" class="btn btn-success">
                                    <i class="fas fa-cogs me-1"></i>시설 관리
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{layout/footer :: footer}"></div>
<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 카카오맵 API -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_APP_KEY&libraries=services,clusterer,drawing"></script>

<!-- 시설 상세보기 전용 JavaScript -->
<script src="/js/facility-detail.js"></script>
<script src="/js/facility-detail-map.js"></script>

<!-- Thymeleaf 데이터 전달 스크립트 -->
<script th:inline="javascript">
    /*<![CDATA[*/
    
    // 시설 데이터 초기화
    const facilityDataFromServer = {
        facilityId: /*[[${facility.facilityId}]]*/ 0,
        name: /*[[${facility.facilityName}]]*/ '',
        latitude: /*[[${facility.latitude}]]*/ 0,
        longitude: /*[[${facility.longitude}]]*/ 0,
        address: /*[[${facility.address}]]*/ '',
        phone: /*[[${facility.phone}]]*/ '',
        facilityImage: /*[[${facility.facilityImage}]]*/ ''
    };
    
    // 시설 이미지 데이터 초기화
    const facilityImagesFromServer = [
        /*[# th:each="image, imageStat : ${facilityImages}"]*/
        {
            path: '[[${image.imagePath}]]',
            alt: '[[${image.imageAltText != null ? image.imageAltText : "시설 이미지"}]]'
        }/*[# th:unless="${imageStat.last}"],*//*[/]*/
        /*[/]*/
    ];

    // DOM 로드 후 데이터 초기화
    $(document).ready(function() {
        console.log('🏢 시설 상세보기 페이지 초기화 시작');
        
        // 데이터 초기화
        initializeFacilityData(facilityDataFromServer);
        initializeFacilityImages(facilityImagesFromServer);
        initializeFacilityMapData(facilityDataFromServer);
        
        // 지도 초기화
        setTimeout(function() {
            initializeFacilityDetailMap();
        }, 500);
        
        console.log('✅ 시설 상세보기 페이지 초기화 완료');
    });
    
    /*]]>*/
</script>

<!-- 이미지 확대 모달 -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content bg-dark">
            <div class="modal-header border-0">
                <h5 class="modal-title text-white" id="imageModalLabel">시설 이미지</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="닫기"></button>
            </div>
            <div class="modal-body p-0 position-relative">
                <div id="modalCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
                    <div class="carousel-inner" id="modalCarouselInner">
                        <!-- 이미지들이 JavaScript로 동적 생성됨 -->
                    </div>
                    
                    <!-- 모달 내 컨트롤 -->
                    <button class="carousel-control-prev" type="button" data-bs-target="#modalCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" style="width: 40px; height: 40px;"></span>
                        <span class="visually-hidden">이전</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#modalCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon" style="width: 40px; height: 40px;"></span>
                        <span class="visually-hidden">다음</span>
                    </button>
                    
                    <!-- 모달 내 인디케이터 -->
                    <div class="carousel-indicators" id="modalCarouselIndicators">
                        <!-- JavaScript로 동적 생성됨 -->
                    </div>
                </div>
                
                <!-- 이미지 정보 표시 -->
                <div class="position-absolute bottom-0 start-0 end-0 bg-dark bg-opacity-75 text-white p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <span id="modalImageCounter">1 / 5</span>
                            <span class="ms-3" id="modalImageAlt">시설 이미지</span>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline-light me-2" onclick="toggleAutoSlide()">
                                <i class="fas fa-play" id="autoSlideIcon"></i>
                                <span id="autoSlideText">자동재생</span>
                            </button>
                            <button class="btn btn-sm btn-outline-light" onclick="downloadImage()">
                                <i class="fas fa-download"></i> 다운로드
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>
<script>
    // 새로운 App Key로 카카오톡 SDK 초기화
    Kakao.init('YOUR_KAKAO_APP_KEY');
</script>
</body>
</html>
````

## File: backup/facility-image-implementation/facility-image-implementation/edit.html
````html
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/header :: header}">
    <title>시설 정보 수정 - 라이트케어</title>
</head>

<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="container my-4">
    <!-- 브레드크럼 -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">홈</a></li>
            <li class="breadcrumb-item"><a href="/facility/search">시설 찾기</a></li>
            <li class="breadcrumb-item"><a href="/facility/manage">내 시설 관리</a></li>
            <li class="breadcrumb-item active" aria-current="page">시설 정보 수정</li>
        </ol>
    </nav>
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-edit me-2"></i>시설 정보 수정
                    </h3>
                </div>
                <div class="card-body">
                    <form id="facilityEditForm" th:action="@{/facility/edit/{id}(id=${facility.facilityId})}" 
                          method="post" enctype="multipart/form-data" th:object="${facility}">
                        
                        <!-- 시설명 -->
                        <div class="mb-3">
                            <label for="facilityName" class="form-label">
                                <i class="fas fa-building me-1"></i>시설명 <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="facilityName" th:field="*{facilityName}"
                                   placeholder="시설명을 입력하세요" required>
                        </div>

                        <!-- 시설 유형 -->
                        <div class="mb-3">
                            <label for="facilityType" class="form-label">
                                <i class="fas fa-tag me-1"></i>시설 유형 <span class="text-danger">*</span>
                            </label>
                            <select class="form-select" id="facilityType" th:field="*{facilityType}" required>
                                <option value="">시설 유형을 선택하세요</option>
                                <option value="NURSING_HOME">요양원</option>
                                <option value="HOSPITAL">요양병원</option>
                                <option value="DAY_CARE">데이케어센터</option>
                            </select>
                        </div>

                        <!-- 주소 -->
                        <div class="mb-3">
                            <label for="facilityAddress" class="form-label">
                                <i class="fas fa-map-marker-alt me-1"></i>주소 <span class="text-danger">*</span>
                            </label>
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" id="facilityAddress" th:field="*{address}"
                                       placeholder="주소 검색 버튼을 클릭하세요" readonly required>
                                <button type="button" class="btn btn-outline-primary" onclick="searchFacilityAddress()">
                                    <i class="fas fa-search me-1"></i>주소 검색
                                </button>
                            </div>
                            <input type="text" class="form-control" id="detailAddress" th:field="*{detailAddress}"
                                   placeholder="상세 주소를 입력하세요 (예: 101호, 2층)">
                            <!-- 위도/경도 히든 필드 -->
                            <input type="hidden" id="latitude" th:field="*{latitude}">
                            <input type="hidden" id="longitude" th:field="*{longitude}">
                        </div>
                        
                        <!-- 위치 미리보기 지도 -->
                        <div class="mb-3" id="mapPreviewContainer" style="display: none;">
                            <label class="form-label">
                                <i class="fas fa-map me-1"></i>위치 미리보기
                            </label>
                            <div id="previewMap" style="width:100%; height:200px; border-radius: 8px; border: 1px solid #dee2e6;"></div>
                            <small class="form-text text-muted">선택된 주소의 위치가 지도에 표시됩니다.</small>
                        </div>

                        <!-- 시설 전화번호 -->
                        <div class="mb-3">
                            <label for="phone" class="form-label">
                                <i class="fas fa-phone me-1"></i>시설 전화번호 <span class="text-danger">*</span>
                            </label>
                            <input type="tel" class="form-control" id="phone" th:field="*{phone}"
                                   placeholder="전화번호를 입력하세요 (지역번호에 맞게 자동 포맷팅)" required>
                            <small class="form-text text-muted">
                                <strong>지역번호 예시:</strong> 
                                서울(02), 부산(051), 대구(053), 인천(032), 광주(062), 대전(042), 울산(052) 등<br>
                                <strong>형식:</strong> 042는 3-3-4, 02는 2-3-4 또는 2-4-4 형식으로 자동 적용됩니다
                            </small>
                        </div>

                        <!-- 현재 시설 이미지 (있는 경우) -->
                        <div class="mb-3" th:if="${facility.facilityImage}">
                            <label class="form-label">
                                <i class="fas fa-image me-1"></i>현재 시설 사진
                            </label>
                            <div class="current-image-container mb-3" style="position: relative; display: inline-block;">
                                <img th:src="@{${facility.facilityImage}}" alt="현재 시설 사진" 
                                     style="max-width: 300px; max-height: 200px; border-radius: 12px; border: 2px solid #dee2e6; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                                <div class="current-image-overlay" style="position: absolute; top: 8px; right: 8px;">
                                    <span class="badge bg-primary">현재 이미지</span>
                                </div>
                            </div>
                        </div>

                        <!-- 시설 이미지 관리 -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-images me-1"></i>시설 사진 관리
                                <span th:if="${facility.facilityImage == null}" class="text-danger">*</span>
                            </label>
                            
                            <div class="image-management-section">
                                <!-- 고급 이미지 크롭 시스템 링크 -->
                                <div class="card border-primary mb-3">
                                    <div class="card-body text-center">
                                        <i class="fas fa-crop-alt fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title">고급 이미지 관리 시스템</h6>
                                        <p class="card-text text-muted small mb-3">
                                            16:9 비율로 최적화된 시설 사진을 최대 5장까지 등록하고 <br>
                                            AVIF/WebP 압축으로 빠른 로딩 속도를 구현하세요
                                        </p>
                                        <a th:href="@{/facility/crop-images/{id}(id=${facility.facilityId})}" 
                                           class="btn btn-primary">
                                            <i class="fas fa-images me-2"></i>시설 이미지 관리
                                        </a>
                                    </div>
                                </div>
                                
                                <!-- 기존 간단 업로드 (호환성 유지) -->
                                <div class="simple-upload-section">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="useSimpleUpload">
                                        <label class="form-check-label text-muted" for="useSimpleUpload">
                                            <small>간단 업로드 사용 (크롭 없이 업로드)</small>
                                        </label>
                                    </div>
                                    
                                    <div id="simpleUploadContainer" style="display: none;">
                                        <input type="file" class="form-control" id="facilityImageFile" 
                                               name="facilityImageFile" accept="image/*"
                                               th:required="${facility.facilityImage == null}">
                                        <small class="text-muted">
                                            <i class="fas fa-info-circle me-1"></i>
                                            JPG, PNG 파일만 지원. 고급 기능을 원하시면 위의 이미지 관리 시스템을 이용하세요.
                                        </small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Alt 텍스트 입력 (SEO용) -->
                            <input type="hidden" id="facilityImageAltText" name="facilityImageAltText" 
                                   th:value="${facility.facilityImageAltText}">
                        </div>

                        <!-- 수용 인원 -->
                        <div class="mb-3">
                            <label for="capacity" class="form-label">
                                <i class="fas fa-users me-1"></i>수용 인원
                            </label>
                            <input type="number" class="form-control" id="capacity" th:field="*{capacity}"
                                   placeholder="수용 가능 인원을 입력하세요" min="1">
                        </div>

                        <!-- 운영 시간 -->
                        <div class="mb-3">
                            <label for="operatingHours" class="form-label">
                                <i class="fas fa-clock me-1"></i>운영 시간
                            </label>
                            <div class="row g-2">
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operatingType" id="operating24" 
                                               value="24시간" th:checked="${facility.operatingHours == '24시간'}">
                                        <label class="form-check-label fw-bold text-success" for="operating24">
                                            <i class="fas fa-clock me-1"></i>24시간 운영
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operatingType" id="operatingCustom" 
                                               value="custom" th:checked="${facility.operatingHours != '24시간' && facility.operatingHours != null}">
                                        <label class="form-check-label" for="operatingCustom">
                                            <i class="fas fa-clock me-1"></i>시간 직접 설정
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operatingType" id="operatingWeekly" value="weekly">
                                        <label class="form-check-label" for="operatingWeekly">
                                            <i class="fas fa-calendar-week me-1"></i>요일별 시간 설정
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 간단한 시간 설정 -->
                            <div id="simpleTimeContainer" class="mt-3" style="display: none;">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title mb-3">운영 시간 설정</h6>
                                        <div class="row g-2">
                                            <div class="col-md-6">
                                                <label class="form-label small">시작 시간</label>
                                                <select class="form-select" id="startHour">
                                                    <option value="">시</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label small">종료 시간</label>
                                                <select class="form-select" id="endHour">
                                                    <option value="">시</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle me-1"></i>
                                                매일 동일한 시간으로 설정됩니다
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 요일별 시간 설정 -->
                            <div id="weeklyTimeContainer" class="mt-3" style="display: none;">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title mb-3">요일별 운영 시간</h6>
                                        <div id="weeklySchedule">
                                            <!-- JavaScript로 동적 생성 -->
                                        </div>
                                        
                                        <div class="mt-3">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle me-1"></i>
                                                운영하지 않는 요일은 체크를 해제하세요
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 직접 입력 -->
                            <div id="customTimeContainer" class="mt-3" style="display: none;">
                                <input type="text" class="form-control" id="customOperatingHours" 
                                       placeholder="예: 09:00-18:00, 평일 09:00-18:00 주말 10:00-16:00"
                                       th:value="${facility.operatingHours != '24시간' ? facility.operatingHours : ''}">
                                <small class="form-text text-muted">
                                    자유 형식으로 운영 시간을 입력하세요
                                </small>
                            </div>
                            
                            <input type="hidden" id="operatingHours" th:field="*{operatingHours}">
                        </div>

                        <!-- 홈페이지 -->
                        <div class="mb-3">
                            <label for="homepage" class="form-label">
                                <i class="fas fa-globe me-1"></i>홈페이지 URL
                            </label>
                            <input type="url" class="form-control" id="homepage" th:field="*{homepage}"
                                   placeholder="https://www.example.com">
                        </div>

                        <!-- 시설 설명 -->
                        <div class="mb-3">
                            <label for="description" class="form-label">
                                <i class="fas fa-info-circle me-1"></i>시설 설명
                            </label>
                            <textarea class="form-control" id="description" th:field="*{description}" rows="4"
                                      placeholder="시설에 대한 설명을 입력하세요"
                                      data-rich-editor='{"height": "250px", "enableImage": true, "enableTable": false, "enableLink": true}'></textarea>
                        </div>

                        <!-- 시설 특징 -->
                        <div class="mb-3">
                            <label for="features" class="form-label">
                                <i class="fas fa-star me-1"></i>시설 특징
                            </label>
                            <input type="text" class="form-control" id="features" th:field="*{features}"
                                   placeholder="시설의 주요 특징을 쉼표로 구분하여 입력하세요 (예: 24시간 간병서비스, 물리치료실, 카페)">
                            <small class="form-text text-muted">쉼표(,)로 구분하여 여러 특징을 입력할 수 있습니다</small>
                        </div>

                        <!-- 버튼 -->
                        <div class="d-flex gap-2 justify-content-end">
                            <a th:href="@{/facility/manage}" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>취소
                            </a>
                            <button type="submit" class="btn btn-primary" id="submitButton">
                                <i class="fas fa-save me-2"></i>수정 완료
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 카카오 주소 검색 API -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<!-- 카카오맵 API (좌표 변환용) -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_APP_KEY&libraries=services"></script>
<!-- 카카오맵 유틸리티 -->
<script src="/js/kakaomap.js"></script>
<script src="/js/facility-edit.js"></script>

<!-- 전화번호 포맷터 -->
<script src="/js/phone-formatter.js"></script>

<!-- 고급 이미지 크롭퍼 -->
<link rel="stylesheet" href="/css/advanced-image-cropper.css">
<script src="/js/advanced-image-cropper.js"></script>

<!-- 리치 텍스트 에디터 -->
<link rel="stylesheet" href="/css/rich-text-editor.css">
<script src="/js/rich-text-editor.js"></script>

<script>
$(document).ready(function() {
    console.log('Initializing operating hours...');
    
    // 시간 옵션 동적 생성
    initializeTimeOptions();
    
    // 요일별 스케줄 미리 생성
    generateWeeklySchedule();
    
    // 직접 입력 변경 이벤트
    $('#customOperatingHours').on('input', function() {
        updateOperatingHours();
    });
    
    // 초기 상태 설정
    initializeOperatingHours();
});

function initializeTimeOptions() {
    // 시작 시간 옵션 생성
    for (let i = 0; i <= 23; i++) {
        const hour = String(i).padStart(2, '0');
        $('#startHour').append(`<option value="${hour}">${hour}시</option>`);
        $('#endHour').append(`<option value="${hour}">${hour}시</option>`);
    }
}

function generateWeeklySchedule() {
    console.log('Generating weekly schedule...');
    const days = ['월요일', '화요일', '수요일', '목요일', '금요일', '토요일', '일요일'];
    let html = '';
    
    days.forEach((day, index) => {
        html += `
            <div class="row g-2 mb-2">
                <div class="col-3">
                    <div class="form-check">
                        <input class="form-check-input day-check" type="checkbox" id="day${index}" checked>
                        <label class="form-check-label" for="day${index}">${day}</label>
                    </div>
                </div>
                <div class="col-9 time-controls">
                    <div class="d-flex align-items-center gap-2">
                        <select class="form-select form-select-sm day-start" id="start${index}" style="width: 80px;">
                            <option value="">시작</option>
                        </select>
                        <span>시 ~</span>
                        <select class="form-select form-select-sm day-end" id="end${index}" style="width: 80px;">
                            <option value="">종료</option>
                        </select>
                        <span>시</span>
                    </div>
                    <div class="rest-day-notice text-muted small mt-1" style="display: none;">
                        <i class="fas fa-moon me-1"></i>휴무일
                    </div>
                </div>
            </div>
        `;
    });
    
    $('#weeklySchedule').html(html);
    
    // 시간 옵션 추가
    for (let i = 0; i <= 23; i++) {
        const hour = String(i).padStart(2, '0');
        days.forEach((day, index) => {
            $(`#start${index}`).append(`<option value="${hour}">${hour}</option>`);
            $(`#end${index}`).append(`<option value="${hour}">${hour}</option>`);
        });
    }
    
    // 이벤트 리스너 추가
    setTimeout(function() {
        $('.day-check').off('change').on('change', function() {
            const index = $(this).attr('id').replace('day', '');
            const timeControls = $(this).closest('.row').find('.time-controls');
            const restNotice = timeControls.find('.rest-day-notice');
            const selects = timeControls.find('select');
            
            if ($(this).is(':checked')) {
                selects.show();
                timeControls.find('span').show();
                restNotice.hide();
            } else {
                selects.hide();
                timeControls.find('span').hide();
                restNotice.show();
            }
            
            updateOperatingHours();
        });
        
        $('.day-start, .day-end').off('change').on('change', function() {
            updateOperatingHours();
        });
        
        // 간단한 시간 설정 이벤트도 여기서 등록
        $('#startHour, #endHour').off('change').on('change', function() {
            updateOperatingHours();
        });
    }, 100);
}

function initializeOperatingHours() {
    const currentHours = $('#operatingHours').val();
    
    if (currentHours === '24시간') {
        $('#operating24').prop('checked', true);
    } else if (currentHours && currentHours !== '') {
        $('#operatingCustom').prop('checked', true);
        $('#customTimeContainer').show();
        $('#customOperatingHours').val(currentHours);
    }
}

function updateOperatingHours() {
    const operatingType = $('input[name="operatingType"]:checked').val();
    let operatingHours = '';
    
    if (operatingType === '24시간') {
        operatingHours = '24시간';
    } else if (operatingType === 'simple') {
        const startHour = $('#startHour').val();
        const endHour = $('#endHour').val();
        
        if (startHour && endHour) {
            operatingHours = `${startHour}:00-${endHour}:00`;
        }
    } else if (operatingType === 'weekly') {
        const weeklyHours = [];
        const days = ['월', '화', '수', '목', '금', '토', '일'];
        
        $('.day-check').each(function(index) {
            if ($(this).is(':checked')) {
                const startHour = $(`#start${index}`).val();
                const endHour = $(`#end${index}`).val();
                
                if (startHour && endHour) {
                    weeklyHours.push(`${days[index]} ${startHour}:00-${endHour}:00`);
                }
            } else {
                weeklyHours.push(`${days[index]} 휴무`);
            }
        });
        
        operatingHours = weeklyHours.join(', ');
    } else if (operatingType === 'custom') {
        operatingHours = $('#customOperatingHours').val();
    }
    
    $('#operatingHours').val(operatingHours);
}


// 간단한 시간 설정 라디오 버튼 동적 추가
$(document).ready(function() {
    const simpleOption = `
        <div class="col-12">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="operatingType" id="operatingSimple" value="simple">
                <label class="form-check-label" for="operatingSimple">
                    <i class="fas fa-clock me-1"></i>간단한 시간 설정
                </label>
            </div>
        </div>
    `;
    
    $('#operatingCustom').closest('.col-12').after(simpleOption);
    
    // 이벤트 리스너 다시 등록
    setTimeout(function() {
        $('input[name="operatingType"]').off('change').on('change', function() {
            const value = $(this).val();
            console.log('Operating type changed:', value);
            
            // 모든 컨테이너 숨기기
            $('#simpleTimeContainer, #weeklyTimeContainer, #customTimeContainer').hide();
            
            if (value === 'custom') {
                $('#customTimeContainer').show();
            } else if (value === 'weekly') {
                $('#weeklyTimeContainer').show();
                generateWeeklySchedule();
            } else if (value === 'simple') {
                $('#simpleTimeContainer').show();
            }
            
            updateOperatingHours();
        });
    }, 100);
    
    // 고급 이미지 크롭퍼 초기화
    initializeFacilityImageCropper();
});

// 시설 이미지 크롭퍼 초기화
function initializeFacilityImageCropper() {
    try {
        // Cropper.js 사용 가능 여부 확인
        if (typeof Cropper === 'undefined') {
            console.warn('Cropper.js를 로드할 수 없습니다. 기존 파일 입력을 사용합니다.');
            return; // 기존 파일 입력 폼을 그대로 사용
        }
        
        const facilityImageCropper = new AdvancedImageCropper('facilityImageUploader', {
        // 시설 이미지 최적화 설정
        aspectRatio: 16/10, // 시설 카드 비율
        cropWidth: 800,
        cropHeight: 500,
        previewStyle: 'facility',
        title: '시설 이미지 업로드',
        quality: 0.8,
        enableAltText: true,
        
        // 크롭 완료 콜백
        onCropComplete: function(result) {
            console.log('시설 이미지 크롭 완료:', result);
            
            // 기존 파일 입력에 압축된 파일 설정
            const facilityImageFile = document.getElementById('facilityImageFile');
            const facilityImageAltText = document.getElementById('facilityImageAltText');
            
            // DataTransfer를 사용하여 File 객체를 input에 설정
            const dataTransfer = new DataTransfer();
            const compressedFile = new File([result.compressedBlob], 
                result.originalFile.name, {
                    type: 'image/jpeg',
                    lastModified: Date.now()
                });
            
            dataTransfer.items.add(compressedFile);
            facilityImageFile.files = dataTransfer.files;
            
            // Alt 텍스트 설정
            if (facilityImageAltText) {
                facilityImageAltText.value = result.altText;
            }
            
            // 성공 메시지 표시
            showSuccessMessage('시설 이미지가 성공적으로 최적화되었습니다!');
        },
        
        // 에러 콜백
        onError: function(message) {
            console.error('시설 이미지 크롭 오류:', message);
            showErrorMessage('이미지 처리 중 오류가 발생했습니다: ' + message);
        }
    });
    
    // 전역에서 접근 가능하도록 저장
    window.facilityImageCropper = facilityImageCropper;
    } catch (error) {
        console.error('시설 이미지 크롭퍼 초기화 실패:', error);
        console.warn('기존 파일 입력 방식을 사용합니다.');
        // 기존 파일 입력이 이미 있으므로 별도 처리 불필요
    }
}

// 성공 메시지 표시
function showSuccessMessage(message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-success alert-dismissible fade show';
    alertDiv.innerHTML = `
        <i class="fas fa-check-circle me-2"></i>${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // 폼 상단에 메시지 삽입
    const form = document.getElementById('facilityEditForm');
    form.insertBefore(alertDiv, form.firstChild);
    
    // 5초 후 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}

// 에러 메시지 표시
function showErrorMessage(message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-danger alert-dismissible fade show';
    alertDiv.innerHTML = `
        <i class="fas fa-exclamation-triangle me-2"></i>${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // 폼 상단에 메시지 삽입
    const form = document.getElementById('facilityEditForm');
    form.insertBefore(alertDiv, form.firstChild);
    
    // 10초 후 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 10000);
}

// 간단 업로드 토글 기능
document.addEventListener('DOMContentLoaded', function() {
    const useSimpleUpload = document.getElementById('useSimpleUpload');
    const simpleUploadContainer = document.getElementById('simpleUploadContainer');
    
    if (useSimpleUpload && simpleUploadContainer) {
        useSimpleUpload.addEventListener('change', function() {
            if (this.checked) {
                simpleUploadContainer.style.display = 'block';
            } else {
                simpleUploadContainer.style.display = 'none';
                // 파일 입력 초기화
                const fileInput = document.getElementById('facilityImageFile');
                if (fileInput) fileInput.value = '';
            }
        });
    }
});
</script>

</body>
</html>
````

## File: src/main/java/com/example/carelink/common/Constants.java
````java
package com.example.carelink.common;

/**
 * 프로젝트 전체에서 사용하는 공통 상수 정의
 * 팀원 간 일관성 유지를 위한 상수 클래스
 */
public class Constants {
    
    // 회원 관련 상수
    public static final String SESSION_MEMBER = "loginMember";
    public static final int MAX_LOGIN_ATTEMPTS = 5;
    public static final String MEMBER_ROLE_USER = "USER";
    public static final String MEMBER_ROLE_FACILITY = "FACILITY";
    public static final String MEMBER_ROLE_ADMIN = "ADMIN";
    
    // 페이징 관련 상수
    public static final int DEFAULT_PAGE_SIZE = 10;
    public static final int DEFAULT_PAGE_BLOCK = 5;
    
    // 파일 업로드 관련 상수
    public static final String UPLOAD_BASE_PATH = "C:/carelink-uploads/";
    public static final String FACILITY_UPLOAD_PATH = UPLOAD_BASE_PATH + "facility/";
    public static final String PROFILE_UPLOAD_PATH = UPLOAD_BASE_PATH + "profile/";
    public static final String TEMP_UPLOAD_PATH = UPLOAD_BASE_PATH + "temp/";
    public static final String TEST_IMAGES_PATH = "/test-images/";
    public static final long MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
    
    // 이미지 관련 상수
    public static final int MAX_FACILITY_IMAGES = 5; // 시설 이미지 최대 5장
    public static final int MAX_PROFILE_IMAGES = 1;  // 프로필 이미지 최대 1장
    public static final String[] ALLOWED_IMAGE_EXTENSIONS = {"jpg", "jpeg", "png", "webp"};
    
    // 구인구직 관련 상수
    public static final String JOB_TYPE_RECRUIT = "RECRUIT"; // 구인
    public static final String JOB_TYPE_SEARCH = "SEARCH";   // 구직
    public static final String JOB_STATUS_ACTIVE = "ACTIVE";
    public static final String JOB_STATUS_CLOSED = "CLOSED";
    
    // 시설 관련 상수
    public static final String FACILITY_TYPE_NURSING_HOME = "NURSING_HOME";     // 요양원
    public static final String FACILITY_TYPE_HOSPITAL = "HOSPITAL";             // 병원
    public static final String FACILITY_TYPE_DAY_CARE = "DAY_CARE";            // 주간보호센터
    
    // 응답 메시지 상수
    public static final String SUCCESS = "success";
    public static final String ERROR = "error";
    public static final String DUPLICATE_ID = "duplicate_id";
    public static final String LOGIN_REQUIRED = "login_required";
}
````

## File: src/main/java/com/example/carelink/controller/AdminController.java
````java
package com.example.carelink.controller;

import com.example.carelink.common.Constants;
import com.example.carelink.dto.FacilityDTO;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.service.FacilityService;
import com.example.carelink.service.MemberService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import javax.servlet.http.HttpSession;
import java.util.ArrayList;
import java.util.List;

/**
 * 관리자 전용 컨트롤러
 * 시설 승인, 회원 관리, 전체 시스템 관리 기능
 */
@Controller
@RequestMapping("/admin")
@RequiredArgsConstructor
@Slf4j
public class AdminController {

    private final FacilityService facilityService;
    private final MemberService memberService;

    /**
     * 관리자 권한 확인 메서드
     */
    private boolean isAdmin(HttpSession session) {
        MemberDTO sessionMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        return sessionMember != null && "ADMIN".equals(sessionMember.getRole());
    }

    /**
     * 관리자 대시보드 메인 페이지
     */
    @GetMapping("")
    public String adminDashboard(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        if (!isAdmin(session)) {
            redirectAttributes.addFlashAttribute("errorMessage", "관리자 권한이 필요합니다.");
            return "redirect:/";
        }

        try {
            // 승인 대기 중인 시설 수
            int pendingFacilities = facilityService.countPendingFacilities();
            
            // 전체 회원 수
            int totalMembers = memberService.getTotalMemberCount();
            
            // 시설 회원 수
            int facilityMembers = memberService.getFacilityMemberCount();
            
            // 일반 회원 수
            int userMembers = totalMembers - facilityMembers;

            model.addAttribute("pendingFacilities", pendingFacilities);
            model.addAttribute("totalMembers", totalMembers);
            model.addAttribute("facilityMembers", facilityMembers);
            model.addAttribute("userMembers", userMembers);

            log.info("관리자 대시보드 접근 - 승인대기: {}, 전체회원: {}", pendingFacilities, totalMembers);

        } catch (Exception e) {
            log.error("관리자 대시보드 로딩 중 오류 발생", e);
            redirectAttributes.addFlashAttribute("errorMessage", "대시보드 정보를 불러오는 중 오류가 발생했습니다.");
        }

        return "admin/dashboard";
    }

    /**
     * 시설 승인 관리 페이지
     */
    @GetMapping("/facilities")
    public String facilityManagement(@RequestParam(defaultValue = "PENDING") String status,
                                   HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        if (!isAdmin(session)) {
            redirectAttributes.addFlashAttribute("errorMessage", "관리자 권한이 필요합니다.");
            return "redirect:/";
        }

        try {
            log.info("시설 승인 관리 페이지 접근 시도 - 상태: {}", status);
            
            List<FacilityDTO> facilities = facilityService.getFacilitiesByApprovalStatus(status);
            log.info("시설 목록 조회 완료 - 상태: {}, 개수: {}", status, facilities != null ? facilities.size() : "null");
            
            // null 체크 및 빈 리스트 기본값 설정
            if (facilities == null) {
                facilities = new ArrayList<>();
                log.warn("시설 목록이 null이어서 빈 리스트로 초기화했습니다.");
            }
            
            model.addAttribute("facilities", facilities);
            model.addAttribute("currentStatus", status);

        } catch (Exception e) {
            log.error("시설 목록 조회 중 오류 발생 - 상태: {}", status, e);
            model.addAttribute("facilities", new ArrayList<>());
            model.addAttribute("currentStatus", status);
            redirectAttributes.addFlashAttribute("errorMessage", "시설 목록을 불러오는 중 오류가 발생했습니다: " + e.getMessage());
        }

        return "admin/facilities";
    }

    /**
     * 시설 승인 처리
     */
    @PostMapping("/facilities/{facilityId}/approve")
    @ResponseBody
    public String approveFacility(@PathVariable Long facilityId, 
                                @RequestParam String action,
                                @RequestParam(required = false) String reason,
                                HttpSession session) {
        if (!isAdmin(session)) {
            return "UNAUTHORIZED";
        }

        try {
            String newStatus;
            if ("approve".equals(action)) {
                newStatus = "APPROVED";
                facilityService.updateFacilityApprovalStatus(facilityId, newStatus, null);
                log.info("시설 승인 완료 - ID: {}", facilityId);
            } else if ("reject".equals(action)) {
                newStatus = "REJECTED";
                facilityService.updateFacilityApprovalStatus(facilityId, newStatus, reason);
                log.info("시설 승인 거부 - ID: {}, 사유: {}", facilityId, reason);
            } else {
                return "INVALID_ACTION";
            }

            return "SUCCESS";

        } catch (Exception e) {
            log.error("시설 승인 처리 중 오류 발생 - ID: {}", facilityId, e);
            return "ERROR";
        }
    }

    /**
     * 회원 관리 페이지
     */
    @GetMapping("/members")
    public String memberManagement(@RequestParam(defaultValue = "ALL") String role,
                                 @RequestParam(defaultValue = "1") int page,
                                 HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        if (!isAdmin(session)) {
            redirectAttributes.addFlashAttribute("errorMessage", "관리자 권한이 필요합니다.");
            return "redirect:/";
        }

        try {
            List<MemberDTO> members = memberService.getMembersByRole(role, page, 20);
            int totalCount = memberService.getMemberCountByRole(role);
            int totalPages = (int) Math.ceil((double) totalCount / 20);

            model.addAttribute("members", members);
            model.addAttribute("currentRole", role);
            model.addAttribute("currentPage", page);
            model.addAttribute("totalPages", totalPages);
            model.addAttribute("totalCount", totalCount);

            log.info("회원 관리 페이지 접근 - 역할: {}, 페이지: {}, 총 개수: {}", role, page, totalCount);

        } catch (Exception e) {
            log.error("회원 목록 조회 중 오류 발생", e);
            redirectAttributes.addFlashAttribute("errorMessage", "회원 목록을 불러오는 중 오류가 발생했습니다.");
        }

        return "admin/members";
    }

    /**
     * 회원 활성화/비활성화 토글
     */
    @PostMapping("/members/{memberId}/toggle-active")
    @ResponseBody
    public String toggleMemberActive(@PathVariable Long memberId, HttpSession session) {
        if (!isAdmin(session)) {
            return "UNAUTHORIZED";
        }

        try {
            boolean result = memberService.toggleMemberActive(memberId);
            log.info("회원 활성화 상태 변경 - ID: {}, 결과: {}", memberId, result);
            return result ? "SUCCESS" : "FAILED";

        } catch (Exception e) {
            log.error("회원 활성화 상태 변경 중 오류 발생 - ID: {}", memberId, e);
            return "ERROR";
        }
    }

    /**
     * 시설 상세 정보 조회 (모달용)
     */
    @GetMapping("/facilities/{facilityId}/detail")
    @ResponseBody
    public FacilityDTO getFacilityDetail(@PathVariable Long facilityId, HttpSession session) {
        if (!isAdmin(session)) {
            return null;
        }

        try {
            return facilityService.getFacilityById(facilityId);
        } catch (Exception e) {
            log.error("시설 상세 정보 조회 중 오류 발생 - ID: {}", facilityId, e);
            return null;
        }
    }

    /**
     * 전체 통계 페이지
     */
    @GetMapping("/statistics")
    public String statistics(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        if (!isAdmin(session)) {
            redirectAttributes.addFlashAttribute("errorMessage", "관리자 권한이 필요합니다.");
            return "redirect:/";
        }

        try {
            // 각종 통계 데이터 수집
            model.addAttribute("totalMembers", memberService.getTotalMemberCount());
            model.addAttribute("facilityMembers", memberService.getFacilityMemberCount());
            model.addAttribute("approvedFacilities", facilityService.countApprovedFacilities());
            model.addAttribute("pendingFacilities", facilityService.countPendingFacilities());
            model.addAttribute("rejectedFacilities", facilityService.countRejectedFacilities());

            log.info("관리자 통계 페이지 접근");

        } catch (Exception e) {
            log.error("통계 데이터 조회 중 오류 발생", e);
            redirectAttributes.addFlashAttribute("errorMessage", "통계 데이터를 불러오는 중 오류가 발생했습니다.");
        }

        return "admin/statistics";
    }
}
````

## File: src/main/java/com/example/carelink/dto/JobDTO.java
````java
package com.example.carelink.dto;

import com.example.carelink.common.BaseDTO;
import lombok.Data;
import lombok.EqualsAndHashCode;

import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;
import java.math.BigDecimal;
import java.time.LocalDate;

/**
 * 구인구직 게시글 DTO
 * 팀원 C 담당: 구인구직 게시판 기능
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class JobDTO extends BaseDTO {
    
    private Long jobId;             // 구인구직 ID (자동증가)
    
    @NotBlank(message = "제목은 필수입니다")
    private String title;           // 제목
    
    @NotBlank(message = "내용은 필수입니다")
    private String content;         // 내용
    
    @NotBlank(message = "구인구직 유형은 필수입니다")
    private String jobType;         // 구인구직 유형 (RECRUIT: 구인, SEARCH: 구직)
    
    @NotBlank(message = "근무 형태는 필수입니다")
    private String workType;        // 근무 형태 (FULL_TIME, PART_TIME, TEMPORARY)
    
    private String position;        // 모집 직종
    private Integer recruitCount;   // 모집 인원
    
    // 급여 정보
    private String salaryType;      // 급여 유형 (HOURLY, MONTHLY, ANNUAL)
    private BigDecimal salaryMin;   // 최소 급여
    private BigDecimal salaryMax;   // 최대 급여
    private String salaryDescription; // 급여 설명
    
    // 근무 조건
    private String workLocation;    // 근무 지역
    private String workHours;       // 근무 시간
    private String experience;      // 경력 조건
    private String education;       // 학력 조건
    private String qualifications;  // 자격 요건
    private String benefits;        // 복리후생
    
    // 모집 기간
    private LocalDate startDate;    // 모집 시작일
    private LocalDate endDate;      // 모집 마감일
    
    // 연락처 정보
    private String contactName;     // 담당자 이름
    private String contactPhone;    // 담당자 연락처
    private String contactEmail;    // 담당자 이메일
    
    // 상태 관리
    @NotBlank(message = "게시글 상태는 필수입니다")
    private String status;          // 게시글 상태 (ACTIVE, CLOSED, DRAFT)

    private Integer viewCount;      // 조회수
    private Integer applyCount;     // 지원자 수
    
    // 작성자 정보
    @NotNull(message = "작성자 정보는 필수입니다")
    private Long memberId;          // 작성자 ID
    private String memberName;      // 작성자 이름
    
    // 시설 정보 (구인글인 경우)
    private Long facilityId;        // 관련 시설 ID
    private String facilityName;    // 시설 이름
    
    // 검색용 필드
    private String searchKeyword;   // 검색 키워드
    private String searchJobType;   // 검색 구인구직 유형
    private String searchWorkType;  // 검색 근무 형태
    private String searchLocation;  // 검색 지역
    private String searchPosition;  // 검색 직종
    
    // 첨부파일
    private String attachmentPath;  // 첨부파일 경로
    private String attachmentName;  // 첨부파일 원본명
    
    // 우선순위 (상단 고정용)
    private Integer priority;       // 우선순위 (숫자가 높을수록 우선)

    private boolean isHighlight;    // 강조 표시 여부

}
````

## File: src/main/java/com/example/carelink/dto/ReviewDTO.java
````java
package com.example.carelink.dto;

import com.example.carelink.common.BaseDTO;
import lombok.Data;
import lombok.EqualsAndHashCode;

import javax.validation.constraints.Max;
import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;

/**
 * 시설 리뷰 DTO
 * 팀원 D 담당: 시설 리뷰 기능
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class ReviewDTO extends BaseDTO {
    
    private Long reviewId;          // 리뷰 ID (자동증가)
    
    @NotNull(message = "시설 정보는 필수입니다")
    private Long facilityId;        // 시설 ID
    private String facilityName;    // 시설 이름
    
    @NotNull(message = "작성자 정보는 필수입니다")
    private Long memberId;          // 작성자 ID
    private String memberName;      // 작성자 이름
    
    @NotBlank(message = "리뷰 제목은 필수입니다")
    private String title;           // 리뷰 제목
    
    @NotBlank(message = "리뷰 내용은 필수입니다")
    private String content;         // 리뷰 내용
    
    @NotNull(message = "평점은 필수입니다")
    @Min(value = 1, message = "평점은 1점 이상이어야 합니다")
    @Max(value = 5, message = "평점은 5점 이하여야 합니다")
    private Integer rating;         // 평점 (1-5점)
    
    // 세부 평점 (선택사항)
    private Integer serviceRating;  // 서비스 평점
    private Integer facilityRating; // 시설 평점
    private Integer staffRating;    // 직원 평점
    private Integer priceRating;    // 가격 평점
    
    // 리뷰 이미지
    private String reviewImage1;    // 리뷰 이미지 1
    private String reviewImage2;    // 리뷰 이미지 2
    private String reviewImage3;    // 리뷰 이미지 3
    
    // 리뷰 이미지 alt 텍스트 (SEO 최적화용)
    private String reviewImage1AltText;    // 리뷰 이미지 1 alt 텍스트
    private String reviewImage2AltText;    // 리뷰 이미지 2 alt 텍스트
    private String reviewImage3AltText;    // 리뷰 이미지 3 alt 텍스트
    
    // 추천/비추천
    private Integer likeCount;      // 추천 수
    private Integer dislikeCount;   // 비추천 수
    
    // 조회수
    private Integer viewCount;      // 조회수
    
    // 상태
    private boolean isVisible;      // 표시 여부
    private String status;          // 상태 (ACTIVE, HIDDEN, REPORTED)
    
    // 답글 관련
    private Long parentReviewId;    // 부모 리뷰 ID (답글인 경우)
    private Integer replyCount;     // 답글 수
    private Integer replyDepth;     // 답글 깊이
    
    // 검색용
    private String searchKeyword;   // 검색 키워드
    private Integer minRating;      // 최소 평점
    private Integer maxRating;      // 최대 평점
    
    // 정렬용
    private String sortBy;          // 정렬 기준 (LATEST, RATING_HIGH, RATING_LOW, LIKE_COUNT)
    
    // 시설 평균 평점 (조회용)
    private Double facilityAverageRating;    // 시설의 평균 평점
    private Integer facilityReviewCount;     // 시설의 전체 리뷰 수
}
````

## File: src/main/java/com/example/carelink/CarelinkApplication.java
````java
package com.example.carelink;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

/**
 * 요양원 구인구직 사이트 메인 애플리케이션
 * 팀 프로젝트 - 4인 협업 개발
 */
@SpringBootApplication
@MapperScan(basePackages = {"com.example.carelink.dao"})
public class CarelinkApplication {

    public static void main(String[] args) {
        SpringApplication.run(CarelinkApplication.class, args);
        System.out.println("========================================");
        System.out.println("    요양원 구인구직 사이트 시작됨!        ");
        System.out.println("    포트: http://localhost:8080         ");
        System.out.println("========================================");
    }
}
````

## File: src/main/resources/mapper/jobMapper.xml
````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.carelink.dao.JobMapper">

    <!-- ResultMap 정의 -->
    <resultMap id="jobResultMap" type="com.example.carelink.dto.JobDTO">
        <id property="jobId" column="job_id"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="jobType" column="job_type"/>
        <result property="workType" column="work_type"/>
        <result property="position" column="position"/>
        <result property="recruitCount" column="recruit_count"/>
        <result property="salaryType" column="salary_type"/>
        <result property="salaryMin" column="salary_min"/>
        <result property="salaryMax" column="salary_max"/>
        <result property="salaryDescription" column="salary_description"/>
        <result property="workLocation" column="work_location"/>
        <result property="workHours" column="work_hours"/>
        <result property="experience" column="experience"/>
        <result property="education" column="education"/>
        <result property="qualifications" column="qualifications"/>
        <result property="benefits" column="benefits"/>
        <result property="startDate" column="start_date"/>
        <result property="endDate" column="end_date"/>
        <result property="contactName" column="contact_name"/>
        <result property="contactPhone" column="contact_phone"/>
        <result property="contactEmail" column="contact_email"/>
        <result property="status" column="status"/>
        <result property="viewCount" column="view_count"/>
        <result property="applyCount" column="apply_count"/>
        <result property="memberId" column="member_id"/>
        <result property="memberName" column="member_name"/>
        <result property="facilityId" column="facility_id"/>
        <result property="facilityName" column="facility_name"/>
        <result property="attachmentPath" column="attachment_path"/>
        <result property="attachmentName" column="attachment_name"/>
        <result property="priority" column="priority"/>
        <result property="isHighlight" column="is_highlight"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="isDeleted" column="is_deleted"/>
    </resultMap>

    <!-- 구인구직 목록 조회 (검색 포함) -->
    <select id="findJobsWithSearch" parameterType="com.example.carelink.dto.JobDTO" resultMap="jobResultMap">
        SELECT 
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.is_deleted = false
        <if test="searchKeyword != null and searchKeyword != ''">
            AND (j.title LIKE CONCAT('%', #{searchKeyword}, '%') 
                 OR j.content LIKE CONCAT('%', #{searchKeyword}, '%')
                 OR j.position LIKE CONCAT('%', #{searchKeyword}, '%'))
        </if>
        <if test="searchJobType != null and searchJobType != ''">
            AND j.job_type = #{searchJobType}
        </if>
        <if test="searchWorkType != null and searchWorkType != ''">
            AND j.work_type = #{searchWorkType}
        </if>
        <if test="searchLocation != null and searchLocation != ''">
            AND j.work_location LIKE CONCAT('%', #{searchLocation}, '%')
        </if>
        <if test="searchPosition != null and searchPosition != ''">
            AND j.position LIKE CONCAT('%', #{searchPosition}, '%')
        </if>
        ORDER BY j.priority DESC, j.created_at DESC
        <if test="size != null and size > 0">
            LIMIT #{size}
        </if>
        <if test="offset != null and offset >= 0">
            OFFSET #{offset}
        </if>
    </select>

    <!-- 구인구직 총 개수 조회 -->
    <select id="countJobsWithSearch" parameterType="com.example.carelink.dto.JobDTO" resultType="int">
        SELECT COUNT(*)
        FROM job_posting j
        WHERE j.is_deleted = false
        <if test="searchKeyword != null and searchKeyword != ''">
            AND (j.title LIKE CONCAT('%', #{searchKeyword}, '%') 
                 OR j.content LIKE CONCAT('%', #{searchKeyword}, '%')
                 OR j.position LIKE CONCAT('%', #{searchKeyword}, '%'))
        </if>
        <if test="searchJobType != null and searchJobType != ''">
            AND j.job_type = #{searchJobType}
        </if>
        <if test="searchWorkType != null and searchWorkType != ''">
            AND j.work_type = #{searchWorkType}
        </if>
        <if test="searchLocation != null and searchLocation != ''">
            AND j.work_location LIKE CONCAT('%', #{searchLocation}, '%')
        </if>
        <if test="searchPosition != null and searchPosition != ''">
            AND j.position LIKE CONCAT('%', #{searchPosition}, '%')
        </if>
    </select>

    <!-- 구인구직 상세 조회 -->
    <select id="findJobById" parameterType="long" resultMap="jobResultMap">
        SELECT 
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.job_id = #{jobId} AND j.is_deleted = false
    </select>

    <!-- 구인구직 등록 -->
    <insert id="insertJob" parameterType="com.example.carelink.dto.JobDTO" useGeneratedKeys="true" keyProperty="jobId">
        INSERT INTO job_posting (
            title, content, job_type, work_type, position, recruit_count,
            salary_type, salary_min, salary_max, salary_description,
            work_location, work_hours, experience, education, qualifications, benefits,
            start_date, end_date, contact_name, contact_phone, contact_email,
            status, member_id, facility_id, attachment_path, attachment_name,
            priority, is_highlight, created_at
        ) VALUES (
            #{title}, #{content}, #{jobType}, #{workType}, #{position}, #{recruitCount},
            #{salaryType}, #{salaryMin}, #{salaryMax}, #{salaryDescription},
            #{workLocation}, #{workHours}, #{experience}, #{education}, #{qualifications}, #{benefits},
            #{startDate}, #{endDate}, #{contactName}, #{contactPhone}, #{contactEmail},
            #{status}, #{memberId}, #{facilityId}, #{attachmentPath}, #{attachmentName},
            #{priority}, #{isHighlight}, NOW()
        )
    </insert>

    <!-- 구인구직 수정 -->
    <update id="updateJob" parameterType="com.example.carelink.dto.JobDTO">
        UPDATE job_posting SET
            title = #{title},
            content = #{content},
            job_type = #{jobType},
            work_type = #{workType},
            position = #{position},
            recruit_count = #{recruitCount},
            salary_type = #{salaryType},
            salary_min = #{salaryMin},
            salary_max = #{salaryMax},
            salary_description = #{salaryDescription},
            work_location = #{workLocation},
            work_hours = #{workHours},
            experience = #{experience},
            education = #{education},
            qualifications = #{qualifications},
            benefits = #{benefits},
            start_date = #{startDate},
            end_date = #{endDate},
            contact_name = #{contactName},
            contact_phone = #{contactPhone},
            contact_email = #{contactEmail},
            status = #{status},
            facility_id = #{facilityId},
            attachment_path = #{attachmentPath},
            attachment_name = #{attachmentName},
            priority = #{priority},
            is_highlight = #{isHighlight},
            updated_at = NOW()
        WHERE job_id = #{jobId}
    </update>

    <!-- 구인구직 삭제 (논리 삭제) -->
    <update id="deleteJob" parameterType="long">
        UPDATE job_posting SET
            is_deleted = true,
            updated_at = NOW()
        WHERE job_id = #{jobId}
    </update>

    <!-- 조회수 증가 -->
    <update id="incrementViewCount" parameterType="long">
        UPDATE job_posting SET
            view_count = view_count + 1,
            updated_at = NOW()
        WHERE job_id = #{jobId}
    </update>

    <!-- 지원자 수 증가 -->
    <update id="incrementApplyCount" parameterType="long">
        UPDATE job_posting SET
            apply_count = apply_count + 1,
            updated_at = NOW()
        WHERE job_id = #{jobId}
    </update>

    <!-- 회원별 구인구직 목록 조회 -->
    <select id="findJobsByMemberId" parameterType="long" resultMap="jobResultMap">
        SELECT 
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.member_id = #{memberId} AND j.is_deleted = false
        ORDER BY j.created_at DESC
    </select>

    <!-- 시설별 구인구직 목록 조회 -->
    <select id="findJobsByFacilityId" parameterType="long" resultMap="jobResultMap">
        SELECT 
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.facility_id = #{facilityId} AND j.is_deleted = false
        ORDER BY j.created_at DESC
    </select>

    <!-- 기본 구인구직 목록 조회 (기존 호환성 유지) -->
    <select id="getJobList" parameterType="com.example.carelink.dto.JobDTO" resultMap="jobResultMap">
        SELECT 
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.is_deleted = false
        ORDER BY j.priority DESC, j.created_at DESC
        <if test="size != null and size > 0">
            LIMIT #{size}
        </if>
        <if test="page != null and page >= 0">
            OFFSET #{page}
        </if>
    </select>

    <!-- 구인구직 상세 조회 (기존 호환성 유지) -->
    <select id="getJobById" parameterType="long" resultMap="jobResultMap">
        SELECT 
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.job_id = #{jobId} AND j.is_deleted = false
    </select>

    <!-- 인기 구인구직 목록 조회 -->
    <select id="getPopularJobs" resultMap="jobResultMap">
        SELECT 
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.is_deleted = false AND j.status = 'ACTIVE'
        ORDER BY j.view_count DESC, j.apply_count DESC
        LIMIT 10
    </select>

    <!-- 전체 구인구직 수 조회 (통계용) -->
    <select id="getJobCount" resultType="int">
        SELECT COUNT(*) 
        FROM job_posting 
        WHERE is_deleted = false AND status = 'ACTIVE'
    </select>

    <!-- 회원 ID로 구인구직 게시글 삭제 (회원 탈퇴 시 사용) -->
    <delete id="deleteByMemberId" parameterType="long">
        DELETE FROM job_posting WHERE member_id = #{memberId}
    </delete>

    <!-- 시설 회원 ID로 구인구직 게시글 삭제 (시설 삭제 시 사용) -->
    <delete id="deleteByFacilityMemberId" parameterType="long">
        DELETE FROM job_posting 
        WHERE facility_id IN (
            SELECT facility_id FROM facility WHERE registered_member_id = #{memberId}
        )
    </delete>

</mapper>
````

## File: src/main/resources/static/css/advanced-image-cropper.css
````css
/**
 * 고급 이미지 크롭퍼 스타일
 * 프로필 & 시설 이미지 통합 컴포넌트
 */

.advanced-image-cropper {
    max-width: 100%;
    margin: 0 auto;
}

/* 단계 표시기 */
.steps-indicator {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 30px;
}

.step-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
}

.step-circle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: #e9ecef;
    border: 3px solid #dee2e6;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6c757d;
    font-size: 18px;
    transition: all 0.3s ease;
    margin-bottom: 8px;
}

.step-item.active .step-circle {
    background: #007bff;
    border-color: #007bff;
    color: white;
    transform: scale(1.1);
    box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
}

.step-item.completed .step-circle {
    background: #28a745;
    border-color: #28a745;
    color: white;
}

.step-label {
    font-size: 12px;
    color: #6c757d;
    font-weight: 500;
    text-align: center;
    margin-top: 5px;
}

.step-item.active .step-label {
    color: #007bff;
    font-weight: 600;
}

.step-item.completed .step-label {
    color: #28a745;
    font-weight: 600;
}

.step-connector {
    width: 80px;
    height: 3px;
    background: #dee2e6;
    margin: 0 10px;
    margin-top: -25px;
    z-index: 1;
    transition: background 0.3s ease;
}

.step-item.completed + .step-connector {
    background: #28a745;
}

/* Cropper.js 중앙 십자가 가시성 개선 */
.cropper-center {
    opacity: 1 !important;
}

.cropper-center:before,
.cropper-center:after {
    background-color: #007bff !important;
    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8) !important;
    opacity: 1 !important;
}

/* Cropper.js 가이드라인 개선 */
.cropper-line {
    background-color: rgba(0, 123, 255, 0.4) !important;
    opacity: 1 !important;
}

.cropper-dashed {
    border-color: rgba(0, 123, 255, 0.6) !important;
    opacity: 1 !important;
}

/* Cropper.js 핸들 개선 */
.cropper-point {
    background-color: #007bff !important;
    border: 2px solid #fff !important;
    box-shadow: 0 0 0 1px #007bff !important;
    opacity: 1 !important;
    width: 8px !important;
    height: 8px !important;
}

.cropper-point.point-se {
    cursor: nw-resize !important;
}

/* 업로드 영역 */
.upload-area {
    border: 2px dashed #dee2e6;
    border-radius: 12px;
    padding: 40px 20px;
    text-align: center;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.upload-area::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s ease;
}

.upload-area:hover {
    border-color: #007bff;
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,123,255,0.15);
}

.upload-area:hover::before {
    left: 100%;
}

.upload-area.drag-over {
    border-color: #28a745;
    background: linear-gradient(135deg, #e8f5e8 0%, #c3e6cb 100%);
    transform: scale(1.02);
}

.upload-content {
    position: relative;
    z-index: 1;
}

.upload-icon {
    margin-bottom: 20px;
}

.upload-icon i {
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

.upload-title {
    color: #495057;
    font-weight: 600;
    margin-bottom: 10px;
}

.upload-description {
    font-size: 16px;
    margin-bottom: 15px;
}

.upload-format-info {
    margin-bottom: 20px;
}

/* 크롭 영역 */
.crop-container {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.crop-image-container {
    border-radius: 8px;
    overflow: hidden;
    background: #f8f9fa;
    min-height: 300px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.crop-controls {
    text-align: center;
}

.crop-preview-panel {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    height: fit-content;
}

/* 프로필 미리보기 */
.profile-preview {
    text-align: center;
}

.profile-card {
    border-radius: 12px;
    transition: transform 0.3s ease;
}

.profile-card:hover {
    transform: translateY(-2px);
}

/* 시설 카드 미리보기 */
.facility-card-preview .card {
    transition: transform 0.3s ease;
    border: none;
}

.facility-card-preview .card:hover {
    transform: translateY(-2px);
}

.card-img-container {
    position: relative;
    overflow: hidden;
}

/* 줌 표시기 */
.zoom-indicator {
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 8px 12px;
    border-radius: 20px;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 9999;
    animation: fadeInOut 0.3s ease;
}

@keyframes fadeInOut {
    from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}

/* 이미지 정보 패널 */
.image-info-panel {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    border: 1px solid #e9ecef;
}

/* 최종 미리보기 */
.final-preview {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    text-align: center;
}

.final-image-container {
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: inline-block;
}

.final-image {
    max-width: 100%;
    height: auto;
    display: block;
}

/* 압축 설정 */
.compression-settings {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.compression-info {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    border: 1px solid #e9ecef;
    text-align: center;
}

.compression-savings {
    font-size: 18px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
}

/* Alt 텍스트 섹션 */
.alt-text-section {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 15px;
}

.alt-text-section .form-label {
    color: #856404;
    font-weight: 600;
}

/* 슬라이더 스타일 */
.form-range {
    appearance: none;
    background: transparent;
    cursor: pointer;
    height: 6px;
}

.form-range::-webkit-slider-track {
    background: #dee2e6;
    height: 6px;
    border-radius: 3px;
}

.form-range::-webkit-slider-thumb {
    appearance: none;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #007bff;
    cursor: pointer;
    border: 2px solid #fff;
    box-shadow: 0 2px 6px rgba(0,123,255,0.3);
    transition: all 0.2s ease;
}

.form-range::-webkit-slider-thumb:hover {
    background: #0056b3;
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0,123,255,0.5);
}

.form-range::-moz-range-track {
    background: #dee2e6;
    height: 6px;
    border-radius: 3px;
    border: none;
}

.form-range::-moz-range-thumb {
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #007bff;
    cursor: pointer;
    border: 2px solid #fff;
    box-shadow: 0 2px 6px rgba(0,123,255,0.3);
}

/* 진행률 영역 */
.progress-area {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    border: 1px solid #e9ecef;
    margin: 20px 0;
}

.progress {
    height: 8px;
    border-radius: 4px;
    background: #e9ecef;
    overflow: hidden;
}

.progress-bar {
    background: linear-gradient(45deg, #007bff, #0056b3);
    transition: width 0.3s ease;
}

.progress-text {
    margin-top: 10px;
    color: #6c757d;
    font-weight: 500;
}

/* 버튼 스타일 */
.btn {
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255,255,255,0.3);
    transition: all 0.3s ease;
    transform: translate(-50%, -50%);
}

.btn:hover::before {
    width: 300px;
    height: 300px;
}

.btn-lg {
    padding: 12px 30px;
    font-size: 16px;
    font-weight: 600;
}

.btn-primary {
    background: linear-gradient(45deg, #007bff, #0056b3);
    border: none;
    box-shadow: 0 4px 15px rgba(0,123,255,0.3);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,123,255,0.4);
}

.btn-success {
    background: linear-gradient(45deg, #28a745, #1e7e34);
    border: none;
    box-shadow: 0 4px 15px rgba(40,167,69,0.3);
}

.btn-success:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(40,167,69,0.4);
}

.btn-outline-secondary:hover {
    transform: translateY(-1px);
}

.btn-outline-danger:hover {
    transform: translateY(-1px);
}

/* 액션 버튼 그룹 */
.crop-actions, .final-actions {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    border: 1px solid #e9ecef;
}

/* 에러 메시지 */
.error-message {
    border-radius: 8px;
    border: none;
    background: linear-gradient(45deg, #dc3545, #c82333);
    color: white;
    font-weight: 500;
    animation: slideInDown 0.3s ease;
}

@keyframes slideInDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* 반응형 디자인 */
@media (max-width: 768px) {
    .steps-indicator {
        flex-direction: column;
        gap: 15px;
    }
    
    .step-connector {
        width: 3px;
        height: 30px;
        margin: 10px 0;
    }
    
    .upload-area {
        padding: 30px 15px;
    }
    
    .crop-container, .crop-preview-panel, .compression-settings {
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .crop-actions .d-flex, .final-actions .d-flex {
        flex-direction: column;
        gap: 10px;
    }
    
    .btn-lg {
        padding: 10px 25px;
        font-size: 15px;
    }
}

@media (max-width: 576px) {
    .step-circle {
        width: 40px;
        height: 40px;
        font-size: 16px;
    }
    
    .step-label {
        font-size: 11px;
    }
    
    .crop-controls .btn-group {
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .crop-controls .btn {
        flex: 1;
        min-width: 0;
        margin: 2px;
    }
}

/* 다크 모드 지원 */
@media (prefers-color-scheme: dark) {
    .advanced-image-cropper {
        color: #f8f9fa;
    }
    
    .upload-area {
        background: linear-gradient(135deg, #343a40 0%, #495057 100%);
        border-color: #495057;
    }
    
    .crop-container, .crop-preview-panel, .compression-settings, .final-preview {
        background: #343a40;
        border-color: #495057;
    }
    
    .image-info-panel, .compression-info {
        background: #495057;
        border-color: #6c757d;
    }
}

/* 포커스 상태 */
.btn:focus,
.form-control:focus,
.form-range:focus {
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);
    outline: none;
}

/* 로딩 상태 */
.loading {
    pointer-events: none;
    opacity: 0.6;
}

.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border: 2px solid #fff;
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Cropper.js 오버라이드 */
.cropper-container {
    direction: ltr;
    font-size: 0;
    line-height: 0;
    position: relative;
    -ms-touch-action: none;
    touch-action: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

.cropper-container img {
    border-radius: 8px;
}

.cropper-wrap-box,
.cropper-canvas,
.cropper-drag-box,
.cropper-crop-box,
.cropper-modal {
    border-radius: 8px;
}

.cropper-view-box {
    border-radius: 8px;
    outline: 1px solid #007bff;
    outline-color: rgba(0, 123, 255, 0.8);
}

.cropper-dashed {
    border-color: rgba(0, 123, 255, 0.5);
}

.cropper-center {
    opacity: 0.8;
}

.cropper-point {
    background-color: #007bff;
    border-radius: 50%;
    opacity: 0.8;
}

.cropper-line {
    background-color: #007bff;
    opacity: 0.6;
}
````

## File: src/main/resources/static/js/common.js
````javascript
/**
 * CareLink 공통 JavaScript 함수
 * 4인 팀 프로젝트 전용
 */

// 페이지 로드 완료 시 실행
$(document).ready(function() {
    // 공통 기능 초기화
    initCommonFeatures();
    
    // 자동 알림 숨김
    autoHideAlerts();
    
    // 폼 유효성 검사 초기화
    initFormValidation();
    
    // 파일 업로드 기능 초기화
    initFileUpload();
    
    // 로딩 상태 관리
    initLoadingState();
    
    // 게시글 삭제 후 목록 새로고침 체크
    refreshBoardList();
});

/**
 * 공통 기능 초기화
 */
function initCommonFeatures() {
    // 툴팁 초기화
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // 팝오버 초기화
    var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
    var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
        return new bootstrap.Popover(popoverTriggerEl);
    });
}

/**
 * 자동 알림 메시지 숨김
 */
function autoHideAlerts() {
    $('.alert').each(function() {
        var alert = $(this);
        if (!alert.hasClass('alert-permanent')) {
            setTimeout(function() {
                alert.fadeOut('slow');
            }, 3000); // 3초 후 자동 숨김
        }
    });
}

/**
 * 폼 유효성 검사 초기화
 */
function initFormValidation() {
    // Bootstrap 유효성 검사 클래스 추가
    $('form').each(function() {
        $(this).addClass('needs-validation');
    });
    
    // 실시간 유효성 검사
    $('.form-control').on('blur', function() {
        validateField($(this));
    });
    
    // 폼 제출 시 유효성 검사
    $('form').on('submit', function(e) {
        var form = $(this);
        var isValid = true;
        
        form.find('.form-control[required]').each(function() {
            if (!validateField($(this))) {
                isValid = false;
            }
        });
        
        if (!isValid) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        form.addClass('was-validated');
    });
}

/**
 * 개별 필드 유효성 검사
 */
function validateField(field) {
    var value = field.val().trim();
    var isValid = true;
    var errorMessage = '';
    
    // 필수 입력 검사
    if (field.prop('required') && value === '') {
        isValid = false;
        errorMessage = '필수 입력 항목입니다.';
    }
    
    // 이메일 형식 검사
    if (field.attr('type') === 'email' && value !== '') {
        var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(value)) {
            isValid = false;
            errorMessage = '올바른 이메일 형식이 아닙니다.';
        }
    }
    
    // 전화번호 형식 검사
    if (field.hasClass('phone-field') && value !== '') {
        var phoneRegex = /^01[016789]-?\d{3,4}-?\d{4}$/;
        if (!phoneRegex.test(value)) {
            isValid = false;
            errorMessage = '올바른 전화번호 형식이 아닙니다.';
        }
    }
    
    // 결과 표시
    if (isValid) {
        field.removeClass('is-invalid').addClass('is-valid');
        field.siblings('.invalid-feedback').hide();
    } else {
        field.removeClass('is-valid').addClass('is-invalid');
        field.siblings('.invalid-feedback').text(errorMessage).show();
    }
    
    return isValid;
}

/**
 * 파일 업로드 기능 초기화
 */
function initFileUpload() {
    $('.file-upload-area').on('dragover', function(e) {
        e.preventDefault();
        $(this).addClass('dragover');
    });
    
    $('.file-upload-area').on('dragleave', function(e) {
        e.preventDefault();
        $(this).removeClass('dragover');
    });
    
    $('.file-upload-area').on('drop', function(e) {
        e.preventDefault();
        $(this).removeClass('dragover');
        
        var files = e.originalEvent.dataTransfer.files;
        handleFileSelect(files, $(this));
    });
    
    $('.file-upload-area input[type="file"]').on('change', function() {
        var files = this.files;
        handleFileSelect(files, $(this).closest('.file-upload-area'));
    });
}

/**
 * 파일 선택 처리
 */
function handleFileSelect(files, uploadArea) {
    for (var i = 0; i < files.length; i++) {
        var file = files[i];
        
        // 파일 크기 검사 (10MB 제한)
        if (file.size > 10 * 1024 * 1024) {
            showAlert('파일 크기는 10MB를 초과할 수 없습니다.', 'warning');
            continue;
        }
        
        // 파일 미리보기 (이미지인 경우)
        if (file.type.startsWith('image/')) {
            var reader = new FileReader();
            reader.onload = function(e) {
                var preview = $('<img>').attr('src', e.target.result)
                    .css({'max-width': '200px', 'max-height': '200px', 'margin': '10px'});
                uploadArea.find('.file-preview').html(preview);
            };
            reader.readAsDataURL(file);
        }
        
        // 파일 정보 표시
        var fileInfo = $('<div class="file-info mt-2"></div>')
            .html('<i class="fas fa-file me-2"></i>' + file.name + ' (' + formatFileSize(file.size) + ')');
        uploadArea.find('.file-list').append(fileInfo);
    }
}

/**
 * 로딩 상태 관리 초기화
 */
function initLoadingState() {
    // 폼 제출 시 로딩 상태 표시
    $('form').on('submit', function() {
        var submitBtn = $(this).find('button[type="submit"]');
        var originalText = submitBtn.html();
        
        submitBtn.prop('disabled', true)
            .html('<span class="loading-spinner me-2"></span>처리중...');
        
        // 5초 후 원래 상태로 복원 (타임아웃 방지)
        setTimeout(function() {
            submitBtn.prop('disabled', false).html(originalText);
        }, 5000);
    });
    
    // AJAX 요청 시 로딩 상태 표시
    $(document).ajaxStart(function() {
        showLoading();
    }).ajaxStop(function() {
        hideLoading();
    });
}

/**
 * 페이지 로딩 표시
 */
function showLoading() {
    if ($('#loadingOverlay').length === 0) {
        var overlay = $('<div id="loadingOverlay" class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center" style="background-color: rgba(0,0,0,0.5); z-index: 9999;"></div>');
        var spinner = $('<div class="text-center text-white"></div>')
            .html('<div class="spinner-border mb-3" role="status"></div><br>로딩중...');
        overlay.append(spinner);
        $('body').append(overlay);
    }
}

/**
 * 페이지 로딩 숨김
 */
function hideLoading() {
    $('#loadingOverlay').remove();
}

/**
 * 커스텀 알림 표시
 */
function showAlert(message, type = 'info', autoHide = true) {
    var alertClass = 'alert-' + type;
    var iconClass = {
        'success': 'fa-check-circle',
        'danger': 'fa-exclamation-triangle',
        'warning': 'fa-exclamation-circle',
        'info': 'fa-info-circle'
    }[type] || 'fa-info-circle';
    
    var alert = $('<div class="alert alert-dismissible fade show" role="alert"></div>')
        .addClass(alertClass)
        .html('<i class="fas ' + iconClass + ' me-2"></i>' + message + 
              '<button type="button" class="btn-close" data-bs-dismiss="alert"></button>');
    
    $('.container').first().prepend(alert);
    
    if (autoHide) {
        setTimeout(function() {
            alert.fadeOut('slow', function() {
                $(this).remove();
            });
        }, 5000);
    }
}

/**
 * 확인 다이얼로그 표시
 */
function showConfirm(message, callback) {
    if (confirm(message)) {
        if (typeof callback === 'function') {
            callback();
        }
        return true;
    }
    return false;
}

/**
 * AJAX 요청 공통 함수
 */
function ajaxRequest(url, method, data, successCallback, errorCallback) {
    $.ajax({
        url: url,
        method: method || 'GET',
        data: data,
        dataType: 'json',
        success: function(response) {
            if (typeof successCallback === 'function') {
                successCallback(response);
            }
        },
        error: function(xhr, status, error) {
            console.error('AJAX 요청 실패:', error);
            showAlert('요청 처리 중 오류가 발생했습니다.', 'danger');
            
            if (typeof errorCallback === 'function') {
                errorCallback(xhr, status, error);
            }
        }
    });
}

/**
 * 페이지네이션 처리
 */
function handlePagination(currentPage, totalPages, baseUrl) {
    var pagination = $('.pagination');
    pagination.empty();
    
    // 이전 버튼
    if (currentPage > 1) {
        pagination.append('<li class="page-item"><a class="page-link" href="' + baseUrl + '?page=' + (currentPage - 1) + '">&laquo;</a></li>');
    }
    
    // 페이지 번호
    var startPage = Math.max(1, currentPage - 2);
    var endPage = Math.min(totalPages, currentPage + 2);
    
    for (var i = startPage; i <= endPage; i++) {
        var activeClass = i === currentPage ? ' active' : '';
        pagination.append('<li class="page-item' + activeClass + '"><a class="page-link" href="' + baseUrl + '?page=' + i + '">' + i + '</a></li>');
    }
    
    // 다음 버튼
    if (currentPage < totalPages) {
        pagination.append('<li class="page-item"><a class="page-link" href="' + baseUrl + '?page=' + (currentPage + 1) + '">&raquo;</a></li>');
    }
}

/**
 * 파일 크기 포맷팅
 */
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    var k = 1024;
    var sizes = ['Bytes', 'KB', 'MB', 'GB'];
    var i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

/**
 * 날짜 포맷팅
 */
function formatDate(date, format = 'YYYY-MM-DD') {
    if (!date) return '';
    
    var d = new Date(date);
    var year = d.getFullYear();
    var month = String(d.getMonth() + 1).padStart(2, '0');
    var day = String(d.getDate()).padStart(2, '0');
    var hour = String(d.getHours()).padStart(2, '0');
    var minute = String(d.getMinutes()).padStart(2, '0');
    
    return format
        .replace('YYYY', year)
        .replace('MM', month)
        .replace('DD', day)
        .replace('HH', hour)
        .replace('mm', minute);
}

/**
 * 문자열 길이 제한
 */
function truncateString(str, length) {
    if (!str) return '';
    return str.length > length ? str.substring(0, length) + '...' : str;
}

/**
 * 숫자 포맷팅 (콤마 추가)
 */
function formatNumber(num) {
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

/**
 * URL 파라미터 가져오기
 */
function getUrlParameter(name) {
    var url = new URL(window.location.href);
    return url.searchParams.get(name);
}

/**
 * 페이지 새로고침 강제 (캐시 무효화)
 */
function forceRefresh() {
    // 브라우저 캐시를 무시하고 강제 새로고침
    window.location.reload(true);
}

/**
 * 게시글 삭제 후 목록 새로고침
 */
function refreshBoardList() {
    // refresh 파라미터가 있으면 캐시 무효화 후 URL에서 제거
    var refreshParam = getUrlParameter('refresh');
    if (refreshParam) {
        // URL에서 refresh 파라미터 제거
        var url = new URL(window.location.href);
        url.searchParams.delete('refresh');
        window.history.replaceState({}, document.title, url.pathname + url.search);
        
        // 페이지 강제 새로고침
        setTimeout(function() {
            forceRefresh();
        }, 100);
    }
}

/**
 * 로컬 스토리지 관리
 */
var Storage = {
    set: function(key, value) {
        localStorage.setItem(key, JSON.stringify(value));
    },
    get: function(key) {
        var item = localStorage.getItem(key);
        return item ? JSON.parse(item) : null;
    },
    remove: function(key) {
        localStorage.removeItem(key);
    },
    clear: function() {
        localStorage.clear();
    }
};
````

## File: src/main/resources/static/js/facility-image-seo-module.js
````javascript
/**
 * 시설 이미지 SEO 모듈 (SEO Module)
 * SEO 최적화, 키워드 관리, Alt 텍스트 생성 전용 모듈
 * 
 * @version 1.0.0
 * @author LightCare Team
 * @requires FacilityImageCore
 */

(function() {
    'use strict';
    
    if (!window.FacilityImageCore) {
        throw new Error('FacilityImageCore 모듈이 필요합니다.');
    }
    
    const Core = window.FacilityImageCore;
    
    if (!window.FacilityImageSystem.SEO) {
        window.FacilityImageSystem.SEO = {};
    }
    
    // ================================================
    // 상수 정의
    // ================================================
    
    const SEO_CONSTANTS = {
        MODULE_NAME: 'FacilityImageSEO',
        VERSION: '1.0.0',
        
        KEYWORDS: {
            FACILITY: ['시설', 'facility', 'care facility'],
            NURSING_HOME: ['요양원', 'nursing home', 'senior care'],
            HOSPITAL: ['병원', 'hospital', 'medical center'],
            INTERIOR: ['내부', 'interior', 'inside'],
            EXTERIOR: ['외관', 'exterior', 'building'],
            ROOM: ['방', 'room', 'resident room'],
            DINING: ['식당', 'dining room', 'meal area'],
            GARDEN: ['정원', 'garden', 'outdoor'],
            CLEAN: ['깨끗한', 'clean', 'hygienic'],
            BRIGHT: ['밝은', 'bright', 'well-lit'],
            MODERN: ['현대적', 'modern', 'contemporary']
        },
        
        MAX_FILENAME_LENGTH: 100,
        MAX_ALT_TEXT_LENGTH: 200,
        KEYWORD_SEPARATOR: '-'
    };
    
    // ================================================
    // SEO 상태 관리
    // ================================================
    
    const seoState = {
        isInitialized: false,
        facilityName: '',
        selectedKeywords: [],
        autoGeneratedNames: new Map(),
        autoGeneratedAlts: new Map()
    };
    
    // ================================================
    // 키워드 관리
    // ================================================
    
    const keywordManager = {
        getKeywordsByCategory() {
            return {
                '시설 종류': SEO_CONSTANTS.KEYWORDS.FACILITY.concat(SEO_CONSTANTS.KEYWORDS.NURSING_HOME),
                '공간': SEO_CONSTANTS.KEYWORDS.INTERIOR.concat(SEO_CONSTANTS.KEYWORDS.ROOM, SEO_CONSTANTS.KEYWORDS.DINING),
                '특징': SEO_CONSTANTS.KEYWORDS.CLEAN.concat(SEO_CONSTANTS.KEYWORDS.BRIGHT, SEO_CONSTANTS.KEYWORDS.MODERN),
                '기타': SEO_CONSTANTS.KEYWORDS.GARDEN.concat(SEO_CONSTANTS.KEYWORDS.EXTERIOR)
            };
        },
        
        getAllKeywords() {
            return Object.values(SEO_CONSTANTS.KEYWORDS).flat();
        },
        
        searchKeywords(query) {
            const allKeywords = this.getAllKeywords();
            return allKeywords.filter(keyword => 
                keyword.toLowerCase().includes(query.toLowerCase())
            );
        },
        
        selectKeyword(keyword) {
            if (!keyword || typeof keyword !== 'string') return;
            
            // 선택된 키워드 목록에 추가
            if (!seoState.selectedKeywords.includes(keyword)) {
                seoState.selectedKeywords.push(keyword);
                Core.logger.log('키워드 선택됨:', keyword);
            }
        },
        
        deselectKeyword(keyword) {
            const index = seoState.selectedKeywords.indexOf(keyword);
            if (index > -1) {
                seoState.selectedKeywords.splice(index, 1);
                Core.logger.log('키워드 선택 해제됨:', keyword);
            }
        },
        
        addCustomKeyword(keyword) {
            if (!seoState.selectedKeywords.includes(keyword)) {
                seoState.selectedKeywords.push(keyword);
                Core.logger.log('커스텀 키워드 추가:', keyword);
            }
        },
        
        removeKeyword(keyword) {
            seoState.selectedKeywords = seoState.selectedKeywords.filter(k => k !== keyword);
            Core.logger.log('키워드 제거:', keyword);
        },
        
        getSelectedKeywords() {
            return [...seoState.selectedKeywords];
        }
    };
    
    // ================================================
    // 파일명 생성
    // ================================================
    
    const fileNameGenerator = {
        generateSEOFileName(originalName, keywords = [], index = 0) {
            // 입력값 검증
            if (!originalName || typeof originalName !== 'string') {
                originalName = 'image.jpg';
            }
            
            const baseName = this.cleanFileName(originalName);
            const keywordString = keywords.slice(0, 3).join(SEO_CONSTANTS.KEYWORD_SEPARATOR);
            const facilityPart = this.convertKoreanToEnglish(seoState.facilityName);
            
            let seoName = '';
            
            if (facilityPart) {
                seoName += facilityPart + SEO_CONSTANTS.KEYWORD_SEPARATOR;
            }
            
            if (keywordString) {
                seoName += keywordString + SEO_CONSTANTS.KEYWORD_SEPARATOR;
            }
            
            if (index > 0) {
                seoName += `${index + 1}${SEO_CONSTANTS.KEYWORD_SEPARATOR}`;
            }
            
            seoName += baseName;
            
            // 길이 제한
            if (seoName.length > SEO_CONSTANTS.MAX_FILENAME_LENGTH) {
                const extension = this.getFileExtension(originalName);
                const maxNameLength = SEO_CONSTANTS.MAX_FILENAME_LENGTH - extension.length;
                seoName = seoName.substring(0, maxNameLength) + extension;
            }
            
            return seoName.toLowerCase();
        },
        
        cleanFileName(fileName) {
            // 입력값 검증
            if (!fileName || typeof fileName !== 'string') {
                return 'image';
            }
            
            // 확장자 분리
            const lastDotIndex = fileName.lastIndexOf('.');
            const nameWithoutExt = lastDotIndex > 0 ? fileName.substring(0, lastDotIndex) : fileName;
            const extension = lastDotIndex > 0 ? fileName.substring(lastDotIndex) : '';
            
            // 한글 및 특수문자 제거
            const cleanName = nameWithoutExt
                .replace(/[가-힣]/g, '') // 한글 제거
                .replace(/[^a-zA-Z0-9-_]/g, '') // 영문, 숫자, 하이픈, 언더스코어만 유지
                .replace(/[-_]+/g, '-') // 연속된 구분자를 하나로 통합
                .replace(/^[-_]+|[-_]+$/g, ''); // 시작과 끝의 구분자 제거
            
            return cleanName || 'image';
        },
        
        getFileExtension(fileName) {
            const lastDotIndex = fileName.lastIndexOf('.');
            return lastDotIndex > 0 ? fileName.substring(lastDotIndex) : '.jpg';
        },
        
        convertKoreanToEnglish(korean) {
            const koreanToEnglish = {
                '요양원': 'nursing-home',
                '병원': 'hospital',
                '시설': 'facility',
                '케어': 'care',
                '센터': 'center',
                '의료': 'medical',
                '복지': 'welfare',
                '실버': 'silver',
                '타운': 'town'
            };
            
            let result = korean.toLowerCase();
            
            Object.entries(koreanToEnglish).forEach(([ko, en]) => {
                result = result.replace(new RegExp(ko, 'g'), en);
            });
            
            // 남은 한글 제거
            result = result.replace(/[가-힣]/g, '');
            
            return result.replace(/[^a-zA-Z0-9-]/g, '').replace(/-+/g, '-').replace(/^-+|-+$/g, '');
        }
    };
    
    // ================================================
    // Alt 텍스트 생성
    // ================================================
    
    const altTextGenerator = {
        generateAltText(fileName, keywords = [], index = 0) {
            let altText = '';
            
            // 시설명 추가
            if (seoState.facilityName) {
                altText += seoState.facilityName;
            }
            
            // 키워드 추가
            if (keywords.length > 0) {
                const koreanKeywords = keywords.filter(k => /[가-힣]/.test(k));
                if (koreanKeywords.length > 0) {
                    altText += ' ' + koreanKeywords.slice(0, 2).join(' ');
                }
            }
            
            // 파일명에서 추출한 정보 추가
            const fileInfo = this.extractInfoFromFileName(fileName);
            if (fileInfo) {
                altText += ' ' + fileInfo;
            }
            
            // 기본 설명 추가
            altText += ' 사진';
            
            // 인덱스 추가
            if (index > 0) {
                altText += ` ${index + 1}`;
            }
            
            // 길이 제한
            if (altText.length > SEO_CONSTANTS.MAX_ALT_TEXT_LENGTH) {
                altText = altText.substring(0, SEO_CONSTANTS.MAX_ALT_TEXT_LENGTH - 3) + '...';
            }
            
            return altText.trim();
        },
        
        extractInfoFromFileName(fileName) {
            const nameWithoutExt = fileName.replace(/\.[^/.]+$/, '');
            const parts = nameWithoutExt.split(/[-_]/);
            
            const meaningfulParts = parts.filter(part => 
                part.length > 2 && 
                !part.match(/^\d+$/) && // 숫자만 있는 부분 제외
                !part.match(/^(img|image|photo|pic)$/i) // 일반적인 이미지 용어 제외
            );
            
            return meaningfulParts.slice(0, 2).join(' ');
        },
        
        optimizeAltText(altText) {
            // 중복 단어 제거
            const words = altText.split(' ');
            const uniqueWords = [...new Set(words)];
            
            // 불필요한 단어 제거
            const stopWords = ['의', '을', '를', '이', '가', '에서', '에게', '로', '으로'];
            const filteredWords = uniqueWords.filter(word => !stopWords.includes(word));
            
            return filteredWords.join(' ').trim();
        }
    };
    
    // ================================================
    // SEO 분석
    // ================================================
    
    const seoAnalyzer = {
        analyzeFileName(fileName) {
            const score = {
                total: 0,
                details: [],
                recommendations: []
            };
            
            // 파일명 길이 체크
            if (fileName.length <= SEO_CONSTANTS.MAX_FILENAME_LENGTH) {
                score.total += 20;
                score.details.push('적절한 파일명 길이');
            } else {
                score.recommendations.push('파일명이 너무 깁니다.');
            }
            
            // 한글 사용 체크
            if (!/[가-힣]/.test(fileName)) {
                score.total += 30;
                score.details.push('영문 파일명 사용');
            } else {
                score.recommendations.push('한글 대신 영문 파일명을 사용하세요.');
            }
            
            // 키워드 포함 체크
            const hasKeywords = keywordManager.getAllKeywords().some(keyword => 
                fileName.toLowerCase().includes(keyword.toLowerCase())
            );
            
            if (hasKeywords) {
                score.total += 30;
                score.details.push('관련 키워드 포함');
            } else {
                score.recommendations.push('관련 키워드를 포함하세요.');
            }
            
            // 구분자 사용 체크
            if (fileName.includes('-') || fileName.includes('_')) {
                score.total += 20;
                score.details.push('적절한 구분자 사용');
            } else {
                score.recommendations.push('단어 구분을 위해 하이픈(-)을 사용하세요.');
            }
            
            return score;
        },
        
        analyzeAltText(altText) {
            const score = {
                total: 0,
                details: [],
                recommendations: []
            };
            
            // Alt 텍스트 길이 체크
            if (altText.length >= 10 && altText.length <= SEO_CONSTANTS.MAX_ALT_TEXT_LENGTH) {
                score.total += 30;
                score.details.push('적절한 Alt 텍스트 길이');
            } else if (altText.length < 10) {
                score.recommendations.push('Alt 텍스트가 너무 짧습니다.');
            } else {
                score.recommendations.push('Alt 텍스트가 너무 깁니다.');
            }
            
            // 시설명 포함 체크
            if (seoState.facilityName && altText.includes(seoState.facilityName)) {
                score.total += 25;
                score.details.push('시설명 포함');
            } else {
                score.recommendations.push('시설명을 포함하세요.');
            }
            
            // 키워드 포함 체크
            const hasKeywords = keywordManager.getAllKeywords().some(keyword => 
                altText.toLowerCase().includes(keyword.toLowerCase())
            );
            
            if (hasKeywords) {
                score.total += 25;
                score.details.push('관련 키워드 포함');
            } else {
                score.recommendations.push('관련 키워드를 포함하세요.');
            }
            
            // 자연스러운 문장 체크
            if (altText.includes(' ') && !altText.includes('___') && !altText.includes('---')) {
                score.total += 20;
                score.details.push('자연스러운 문장 구성');
            } else {
                score.recommendations.push('자연스러운 문장으로 작성하세요.');
            }
            
            return score;
        }
    };
    
    // ================================================
    // 메인 SEO 객체
    // ================================================
    
    const seo = {
        initialize(facilityName = '', options = {}) {
            if (seoState.isInitialized) {
                Core.logger.warn('SEO 모듈이 이미 초기화됨');
                return true;
            }
            
            Core.logger.log('SEO 모듈 초기화 시작');
            
            try {
                seoState.facilityName = facilityName;
                seoState.selectedKeywords = [];
                
                seoState.isInitialized = true;
                Core.logger.success('SEO 모듈 초기화 완료');
                
                return true;
            } catch (error) {
                Core.logger.error('SEO 모듈 초기화 실패:', error);
                return false;
            }
        },
        
        generateFileName(originalName, keywords = [], index = 0) {
            const fileName = fileNameGenerator.generateSEOFileName(originalName, keywords, index);
            seoState.autoGeneratedNames.set(originalName, fileName);
            return fileName;
        },
        
        generateAltText(fileName, keywords = [], index = 0) {
            const altText = altTextGenerator.generateAltText(fileName, keywords, index);
            const optimizedAltText = altTextGenerator.optimizeAltText(altText);
            seoState.autoGeneratedAlts.set(fileName, optimizedAltText);
            return optimizedAltText;
        },
        
        addKeyword(keyword) {
            keywordManager.addCustomKeyword(keyword);
        },
        
        removeKeyword(keyword) {
            keywordManager.removeKeyword(keyword);
        },
        
        getKeywords() {
            return keywordManager.getSelectedKeywords();
        },
        
        searchKeywords(query) {
            return keywordManager.searchKeywords(query);
        },
        
        analyzeFileName(fileName) {
            return seoAnalyzer.analyzeFileName(fileName);
        },
        
        analyzeAltText(altText) {
            return seoAnalyzer.analyzeAltText(altText);
        },
        
        getOptimizationSuggestions(fileName, altText) {
            const fileAnalysis = this.analyzeFileName(fileName);
            const altAnalysis = this.analyzeAltText(altText);
            
            return {
                fileName: fileAnalysis,
                altText: altAnalysis,
                overallScore: Math.round((fileAnalysis.total + altAnalysis.total) / 2)
            };
        },
        
        bulkOptimize(files) {
            return files.map((file, index) => {
                const optimizedFileName = this.generateFileName(file.name, seoState.selectedKeywords, index);
                const optimizedAltText = this.generateAltText(optimizedFileName, seoState.selectedKeywords, index);
                
                return {
                    ...file,
                    seoFileName: optimizedFileName,
                    altText: optimizedAltText,
                    seoScore: this.getOptimizationSuggestions(optimizedFileName, optimizedAltText)
                };
            });
        },
        
        destroy() {
            seoState.isInitialized = false;
            seoState.facilityName = '';
            seoState.selectedKeywords = [];
            seoState.autoGeneratedNames.clear();
            seoState.autoGeneratedAlts.clear();
            
            Core.logger.log('SEO 모듈 제거 완료');
        },
        
        getInfo() {
            return {
                name: SEO_CONSTANTS.MODULE_NAME,
                version: SEO_CONSTANTS.VERSION,
                isInitialized: seoState.isInitialized,
                facilityName: seoState.facilityName,
                selectedKeywordsCount: seoState.selectedKeywords.length,
                generatedNamesCount: seoState.autoGeneratedNames.size
            };
        }
    };
    
    // ================================================
    // 모듈 노출
    // ================================================
    
    window.FacilityImageSystem.SEO = {
        CONSTANTS: SEO_CONSTANTS,
        seo,
        keywordManager,
        fileNameGenerator,
        altTextGenerator,
        seoAnalyzer,
        getState: () => ({ ...seoState }),
        initialize: seo.initialize.bind(seo),
        generateFileName: seo.generateFileName.bind(seo),
        generateAltText: seo.generateAltText.bind(seo),
        addKeyword: seo.addKeyword.bind(seo),
        removeKeyword: seo.removeKeyword.bind(seo),
        getKeywords: seo.getKeywords.bind(seo),
        analyzeFileName: seo.analyzeFileName.bind(seo),
        analyzeAltText: seo.analyzeAltText.bind(seo),
        bulkOptimize: seo.bulkOptimize.bind(seo),
        destroy: seo.destroy.bind(seo),
        cleanFileName: fileNameGenerator.cleanFileName.bind(fileNameGenerator),
        selectKeyword: keywordManager.selectKeyword.bind(keywordManager),
        deselectKeyword: keywordManager.deselectKeyword.bind(keywordManager)
    };
    
    window.FacilityImageSEO = window.FacilityImageSystem.SEO;
    
    Core.logger.log('SEO 모듈 로드 완료');
    
})();
````

## File: src/main/resources/static/js/facility-image-ui-module.js
````javascript
/**
 * 시설 이미지 UI 모듈 (UI Module)
 * DOM 조작, 이벤트 처리, 프로그레스 표시 전용 모듈
 * 
 * @version 1.0.0
 * @author LightCare Team
 * @requires FacilityImageCore
 */

(function() {
    'use strict';
    
    if (!window.FacilityImageCore) {
        throw new Error('FacilityImageCore 모듈이 필요합니다.');
    }
    
    const Core = window.FacilityImageCore;
    
    if (!window.FacilityImageSystem.UI) {
        window.FacilityImageSystem.UI = {};
    }
    
    // ================================================
    // 상수 정의
    // ================================================
    
    const UI_CONSTANTS = {
        MODULE_NAME: 'FacilityImageUI',
        VERSION: '1.0.0',
        
        NOTIFICATION_TYPES: {
            INFO: 'info',
            SUCCESS: 'success',
            WARNING: 'warning',
            ERROR: 'error'
        },
        
        ANIMATION_DURATION: 300,
        NOTIFICATION_TIMEOUT: 5000
    };
    
    // ================================================
    // UI 상태 관리
    // ================================================
    
    const uiState = {
        isInitialized: false,
        activeNotifications: [],
        stepIndicators: [],
        progressBars: [],
        elements: {
            stepContainer: null,
            mainContainer: null,
            notificationContainer: null
        }
    };
    
    // ================================================
    // 단계 표시기 관리
    // ================================================
    
    const stepIndicator = {
        initialize() {
            const container = document.querySelector('.steps-indicator, #stepsIndicator');
            if (!container) {
                this.createStepIndicator();
            } else {
                uiState.elements.stepContainer = container;
            }
            this.setupStepEvents();
        },
        
        createStepIndicator() {
            const html = `
                <div class="steps-indicator mb-4" id="stepsIndicator">
                    <div class="step-item active" data-step="1">
                        <div class="step-circle"><i class="fas fa-upload"></i></div>
                        <div class="step-label">이미지 선택</div>
                    </div>
                    <div class="step-connector"></div>
                    <div class="step-item" data-step="2">
                        <div class="step-circle"><i class="fas fa-crop-alt"></i></div>
                        <div class="step-label">크롭 & 조정</div>
                    </div>
                    <div class="step-connector"></div>
                    <div class="step-item" data-step="3">
                        <div class="step-circle"><i class="fas fa-check"></i></div>
                        <div class="step-label">완료</div>
                    </div>
                </div>
            `;
            
            // 더 안전한 컨테이너 선택 로직
            let container = document.querySelector('#uploadSection, .upload-section, .content-wrapper, main, .container, body');
            if (!container) {
                container = document.body;
                Core.logger.warn('기본 컨테이너를 사용합니다.');
            }
            
            try {
                container.insertAdjacentHTML('afterbegin', html);
                uiState.elements.stepContainer = document.getElementById('stepsIndicator');
                Core.logger.success('단계 표시기 생성 완료');
            } catch (error) {
                Core.logger.error('단계 표시기 생성 실패:', error);
                // 대체 방법으로 body에 직접 추가
                try {
                    document.body.insertAdjacentHTML('afterbegin', html);
                    uiState.elements.stepContainer = document.getElementById('stepsIndicator');
                    Core.logger.success('단계 표시기 대체 생성 완료');
                } catch (fallbackError) {
                    Core.logger.error('단계 표시기 대체 생성도 실패:', fallbackError);
                }
            }
        },
        
        setupStepEvents() {
            Core.on(Core.CONSTANTS.EVENTS.STEP_CHANGED, (data) => {
                this.updateStep(data.newStep);
            });
        },
        
        updateStep(step) {
            const steps = document.querySelectorAll('.step-item');
            steps.forEach((stepEl, index) => {
                const stepNumber = index + 1;
                if (stepNumber <= step) {
                    stepEl.classList.add('active');
                    if (stepNumber < step) {
                        stepEl.classList.add('completed');
                    }
                } else {
                    stepEl.classList.remove('active', 'completed');
                }
            });
        }
    };
    
    // ================================================
    // 프로그레스 관리
    // ================================================
    
    const progressManager = {
        show(id, message = '처리 중...') {
            const progressHtml = `
                <div class="progress-container" id="progress-${id}">
                    <div class="progress-message mb-2">${message}</div>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <div class="progress-percentage text-center mt-1">0%</div>
                </div>
            `;
            
            const container = this.getProgressContainer();
            container.insertAdjacentHTML('beforeend', progressHtml);
            
            return document.getElementById(`progress-${id}`);
        },
        
        update(id, percentage, message = null) {
            const progressElement = document.getElementById(`progress-${id}`);
            if (!progressElement) return;
            
            const bar = progressElement.querySelector('.progress-bar');
            const text = progressElement.querySelector('.progress-percentage');
            const messageEl = progressElement.querySelector('.progress-message');
            
            if (bar) {
                bar.style.width = percentage + '%';
                bar.setAttribute('aria-valuenow', percentage);
            }
            
            if (text) {
                text.textContent = percentage + '%';
            }
            
            if (message && messageEl) {
                messageEl.textContent = message;
            }
        },
        
        hide(id) {
            const element = document.getElementById(`progress-${id}`);
            if (element) {
                element.style.opacity = '0';
                setTimeout(() => {
                    if (element.parentElement) {
                        element.parentElement.removeChild(element);
                    }
                }, UI_CONSTANTS.ANIMATION_DURATION);
            }
        },
        
        getProgressContainer() {
            let container = document.querySelector('#progressContainer');
            if (!container) {
                container = document.createElement('div');
                container.id = 'progressContainer';
                container.className = 'progress-container-wrapper';
                document.body.appendChild(container);
            }
            return container;
        }
    };
    
    // ================================================
    // 알림 시스템
    // ================================================
    
    const notificationManager = {
        show(message, type = UI_CONSTANTS.NOTIFICATION_TYPES.INFO, timeout = UI_CONSTANTS.NOTIFICATION_TIMEOUT) {
            try {
                const id = Core.utils.generateUniqueId();
                const typeClass = this.getTypeClass(type);
                const icon = this.getTypeIcon(type);
                
                const notificationHtml = `
                    <div class="alert alert-${typeClass} alert-dismissible fade show" id="notification-${id}" 
                         style="position: fixed; top: 20px; right: 20px; z-index: 1060; max-width: 400px;">
                        <i class="${icon} me-2"></i>
                        ${message}
                        <button type="button" class="btn-close" onclick="FacilityImageUI.dismissNotification('${id}')"></button>
                    </div>
                `;
                
                const container = this.getNotificationContainer();
                if (container) {
                    container.insertAdjacentHTML('beforeend', notificationHtml);
                    uiState.activeNotifications.push(id);
                    
                    if (timeout > 0) {
                        setTimeout(() => {
                            this.dismiss(id);
                        }, timeout);
                    }
                    
                    return id;
                } else {
                    // 컨테이너가 없으면 콘솔에 메시지 출력
                    Core.logger.log(`알림: ${message}`);
                    return null;
                }
            } catch (error) {
                Core.logger.error('알림 표시 실패:', error);
                // 브라우저 기본 알림 사용
                try {
                    alert(message);
                } catch (alertError) {
                    Core.logger.error('기본 알림도 실패:', alertError);
                }
                return null;
            }
        },
        
        dismiss(id) {
            const notification = document.getElementById(`notification-${id}`);
            if (notification) {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.parentElement.removeChild(notification);
                    }
                }, UI_CONSTANTS.ANIMATION_DURATION);
            }
            
            uiState.activeNotifications = uiState.activeNotifications.filter(nId => nId !== id);
        },
        
        getTypeClass(type) {
            switch (type) {
                case UI_CONSTANTS.NOTIFICATION_TYPES.SUCCESS: return 'success';
                case UI_CONSTANTS.NOTIFICATION_TYPES.WARNING: return 'warning';
                case UI_CONSTANTS.NOTIFICATION_TYPES.ERROR: return 'danger';
                default: return 'info';
            }
        },
        
        getTypeIcon(type) {
            switch (type) {
                case UI_CONSTANTS.NOTIFICATION_TYPES.SUCCESS: return 'fas fa-check-circle';
                case UI_CONSTANTS.NOTIFICATION_TYPES.WARNING: return 'fas fa-exclamation-triangle';
                case UI_CONSTANTS.NOTIFICATION_TYPES.ERROR: return 'fas fa-times-circle';
                default: return 'fas fa-info-circle';
            }
        },
        
        getNotificationContainer() {
            let container = uiState.elements.notificationContainer;
            if (!container) {
                container = document.createElement('div');
                container.id = 'notificationContainer';
                container.className = 'notification-container';
                document.body.appendChild(container);
                uiState.elements.notificationContainer = container;
            }
            return container;
        }
    };
    
    // ================================================
    // DOM 유틸리티
    // ================================================
    
    const domUtils = {
        show(element, animation = true) {
            if (typeof element === 'string') {
                element = document.querySelector(element);
            }
            
            if (element) {
                if (animation) {
                    element.style.opacity = '0';
                    element.style.display = 'block';
                    setTimeout(() => {
                        element.style.opacity = '1';
                    }, 10);
                } else {
                    element.style.display = 'block';
                }
            }
        },
        
        hide(element, animation = true) {
            if (typeof element === 'string') {
                element = document.querySelector(element);
            }
            
            if (element) {
                if (animation) {
                    element.style.opacity = '0';
                    setTimeout(() => {
                        element.style.display = 'none';
                    }, UI_CONSTANTS.ANIMATION_DURATION);
                } else {
                    element.style.display = 'none';
                }
            }
        },
        
        toggle(element, animation = true) {
            if (typeof element === 'string') {
                element = document.querySelector(element);
            }
            
            if (element) {
                const isVisible = element.style.display !== 'none' && 
                                element.offsetParent !== null;
                
                if (isVisible) {
                    this.hide(element, animation);
                } else {
                    this.show(element, animation);
                }
            }
        },
        
        addClass(element, className) {
            if (typeof element === 'string') {
                element = document.querySelector(element);
            }
            if (element) {
                element.classList.add(className);
            }
        },
        
        removeClass(element, className) {
            if (typeof element === 'string') {
                element = document.querySelector(element);
            }
            if (element) {
                element.classList.remove(className);
            }
        },
        
        toggleClass(element, className) {
            if (typeof element === 'string') {
                element = document.querySelector(element);
            }
            if (element) {
                element.classList.toggle(className);
            }
        }
    };
    
    // ================================================
    // 이벤트 관리
    // ================================================
    
    const eventManager = {
        setupGlobalEvents() {
            // Core 이벤트 리스너
            Core.on(Core.CONSTANTS.EVENTS.ERROR, (data) => {
                notificationManager.show(data.message, UI_CONSTANTS.NOTIFICATION_TYPES.ERROR);
            });
            
            Core.on(Core.CONSTANTS.EVENTS.SUCCESS, (data) => {
                notificationManager.show(data.message, UI_CONSTANTS.NOTIFICATION_TYPES.SUCCESS);
            });
            
            // 진행률 이벤트
            Core.on('uploadProgress', (data) => {
                progressManager.update('upload', data.percentage, data.message);
            });
            
            Core.on('uploadStart', () => {
                progressManager.show('upload', '업로드 중...');
            });
            
            Core.on('uploadComplete', () => {
                progressManager.hide('upload');
                notificationManager.show('업로드가 완료되었습니다.', UI_CONSTANTS.NOTIFICATION_TYPES.SUCCESS);
            });
        }
    };
    
    // ================================================
    // 메인 UI 객체
    // ================================================
    
    const ui = {
        async initialize(options = {}) {
            if (uiState.isInitialized) {
                Core.logger.warn('UI 모듈이 이미 초기화됨');
                return true;
            }
            
            Core.logger.log('UI 모듈 초기화 시작');
            
            try {
                // DOM이 준비될 때까지 대기
                await this.waitForDOM();
                
                stepIndicator.initialize();
                eventManager.setupGlobalEvents();
                this.setupStyles();
                
                uiState.isInitialized = true;
                Core.logger.success('UI 모듈 초기화 완료');
                
                return true;
            } catch (error) {
                Core.logger.error('UI 모듈 초기화 실패:', error);
                return false;
            }
        },
        
        // DOM 준비 대기
        async waitForDOM() {
            return new Promise((resolve) => {
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', resolve);
                } else {
                    resolve();
                }
            });
        },
        
        setupStyles() {
            const styles = `
                <style id="facility-ui-styles">
                .steps-indicator {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin-bottom: 2rem;
                }
                .step-item {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    position: relative;
                }
                .step-circle {
                    width: 50px;
                    height: 50px;
                    border-radius: 50%;
                    background: #dee2e6;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin-bottom: 8px;
                    transition: all 0.3s ease;
                }
                .step-item.active .step-circle {
                    background: #007bff;
                    color: white;
                }
                .step-item.completed .step-circle {
                    background: #28a745;
                    color: white;
                }
                .step-connector {
                    width: 80px;
                    height: 2px;
                    background: #dee2e6;
                    margin: 0 20px;
                    margin-bottom: 25px;
                }
                .step-label {
                    font-size: 0.875rem;
                    color: #6c757d;
                    text-align: center;
                }
                .step-item.active .step-label {
                    color: #007bff;
                    font-weight: 500;
                }
                </style>
            `;
            
            if (!document.getElementById('facility-ui-styles')) {
                document.head.insertAdjacentHTML('beforeend', styles);
            }
        },
        
        showNotification(message, type, timeout) {
            return notificationManager.show(message, type, timeout);
        },
        
        dismissNotification(id) {
            notificationManager.dismiss(id);
        },
        
        showProgress(id, message) {
            return progressManager.show(id, message);
        },
        
        updateProgress(id, percentage, message) {
            progressManager.update(id, percentage, message);
        },
        
        hideProgress(id) {
            progressManager.hide(id);
        },
        
        updateStep(step) {
            stepIndicator.updateStep(step);
        },
        
        show: domUtils.show,
        hide: domUtils.hide,
        toggle: domUtils.toggle,
        addClass: domUtils.addClass,
        removeClass: domUtils.removeClass,
        toggleClass: domUtils.toggleClass,
        
        destroy() {
            uiState.activeNotifications.forEach(id => {
                notificationManager.dismiss(id);
            });
            
            const containers = [
                '#stepsIndicator',
                '#progressContainer',
                '#notificationContainer',
                '#facility-ui-styles'
            ];
            
            containers.forEach(selector => {
                const element = document.querySelector(selector);
                if (element && element.parentElement) {
                    element.parentElement.removeChild(element);
                }
            });
            
            uiState.isInitialized = false;
            Core.logger.log('UI 모듈 제거 완료');
        },
        
        getInfo() {
            return {
                name: UI_CONSTANTS.MODULE_NAME,
                version: UI_CONSTANTS.VERSION,
                isInitialized: uiState.isInitialized,
                activeNotifications: uiState.activeNotifications.length
            };
        }
    };
    
    // ================================================
    // 모듈 노출
    // ================================================
    
    window.FacilityImageSystem.UI = {
        CONSTANTS: UI_CONSTANTS,
        ui,
        stepIndicator,
        progressManager,
        notificationManager,
        domUtils,
        getState: () => ({ ...uiState }),
        initialize: ui.initialize.bind(ui),
        showNotification: ui.showNotification.bind(ui),
        dismissNotification: ui.dismissNotification.bind(ui),
        showProgress: ui.showProgress.bind(ui),
        updateProgress: ui.updateProgress.bind(ui),
        hideProgress: ui.hideProgress.bind(ui),
        updateStep: ui.updateStep.bind(ui),
        show: ui.show.bind(ui),
        hide: ui.hide.bind(ui),
        toggle: ui.toggle.bind(ui),
        addClass: ui.addClass.bind(ui),
        removeClass: ui.removeClass.bind(ui),
        toggleClass: ui.toggleClass.bind(ui),
        destroy: ui.destroy.bind(ui)
    };
    
    window.FacilityImageUI = window.FacilityImageSystem.UI;
    
    Core.logger.log('UI 모듈 로드 완료');
    
})();
````

## File: src/main/resources/static/js/facility-image-upload-module.js
````javascript
/**
 * 시설 이미지 업로드 모듈 (Upload Module)
 * 파일 업로드, 드래그앤드롭, 파일 검증 전용 모듈
 * 
 * 주요 기능:
 * - 다중 파일 업로드
 * - 드래그앤드롭 인터페이스
 * - 파일 형식 및 크기 검증
 * - 이미지 압축 및 최적화
 * - 파일 미리보기
 * - 프로그레스 표시
 * - 에러 핸들링
 * 
 * @version 1.0.0
 * @author LightCare Team
 * @requires FacilityImageCore
 */

(function() {
    'use strict';
    
    // Core 모듈 의존성 체크
    if (!window.FacilityImageCore) {
        throw new Error('FacilityImageCore 모듈이 필요합니다.');
    }
    
    const Core = window.FacilityImageCore;
    
    // ================================================
    // 모듈 네임스페이스 생성
    // ================================================
    
    if (!window.FacilityImageSystem.Upload) {
        window.FacilityImageSystem.Upload = {};
    }
    
    // ================================================
    // 상수 정의
    // ================================================
    
    const UPLOAD_CONSTANTS = {
        MODULE_NAME: 'FacilityImageUpload',
        VERSION: '1.0.0',
        
        // 파일 제한
        MAX_FILE_SIZE: 10 * 1024 * 1024, // 10MB
        MAX_FILES: 5,
        ALLOWED_TYPES: ['image/jpeg', 'image/png', 'image/webp', 'image/avif'],
        ALLOWED_EXTENSIONS: ['.jpg', '.jpeg', '.png', '.webp', '.avif'],
        
        // 드래그앤드롭 상태
        DRAG_STATES: {
            NONE: 'none',
            ENTER: 'enter',
            OVER: 'over',
            LEAVE: 'leave'
        },
        
        // 파일 상태
        FILE_STATUS: {
            PENDING: 'pending',
            VALIDATING: 'validating',
            VALID: 'valid',
            INVALID: 'invalid',
            UPLOADING: 'uploading',
            UPLOADED: 'uploaded',
            ERROR: 'error'
        },
        
        // 압축 설정
        COMPRESSION_OPTIONS: {
            quality: 0.8,
            maxWidth: 1920,
            maxHeight: 1200,
            format: 'image/jpeg',
            enableCompression: true
        },
        
        // 에러 메시지
        ERROR_MESSAGES: {
            INVALID_TYPE: '지원하지 않는 파일 형식입니다.',
            FILE_TOO_LARGE: '파일 크기가 너무 큽니다.',
            TOO_MANY_FILES: '최대 업로드 가능한 파일 수를 초과했습니다.',
            UPLOAD_FAILED: '업로드에 실패했습니다.',
            READ_ERROR: '파일을 읽을 수 없습니다.',
            COMPRESSION_ERROR: '이미지 압축에 실패했습니다.'
        }
    };
    
    // ================================================
    // 업로드 상태 관리
    // ================================================
    
    const uploadState = {
        // 파일 목록
        files: [],
        validatedFiles: [],
        compressedFiles: [],
        
        // 현재 상태
        isInitialized: false,
        isDragging: false,
        isUploading: false,
        isProcessing: false,
        
        // 진행률
        progress: {
            current: 0,
            total: 0,
            percentage: 0
        },
        
        // UI 요소
        elements: {
            dropZone: null,
            fileInput: null,
            selectButton: null,
            previewContainer: null,
            progressBar: null,
            statusMessage: null
        },
        
        // 설정
        settings: {
            maxFileSize: UPLOAD_CONSTANTS.MAX_FILE_SIZE,
            maxFiles: UPLOAD_CONSTANTS.MAX_FILES,
            allowedTypes: UPLOAD_CONSTANTS.ALLOWED_TYPES,
            enableCompression: UPLOAD_CONSTANTS.COMPRESSION_OPTIONS.enableCompression,
            compressionQuality: UPLOAD_CONSTANTS.COMPRESSION_OPTIONS.quality
        },
        
        // 콜백 함수
        callbacks: {
            onFileSelect: null,
            onFileValidate: null,
            onFileCompress: null,
            onUploadProgress: null,
            onUploadComplete: null,
            onError: null
        }
    };
    
    // ================================================
    // DOM 요소 관리
    // ================================================
    
    const domManager = {
        /**
         * DOM 요소 초기화
         * @returns {boolean} 초기화 성공 여부
         */
        initializeElements() {
            const elements = {
                dropZone: document.querySelector('.upload-area, .drop-zone, #uploadArea'),
                fileInput: document.querySelector('#imageInput, #facilityImageFile, input[type="file"]'),
                selectButton: document.querySelector('#selectFileBtn, .select-file-btn'),
                previewContainer: document.querySelector('.selected-images-preview, #selectedImagesPreview'),
                progressBar: document.querySelector('.progress-bar, #uploadProgress'),
                statusMessage: document.querySelector('.upload-status, #uploadStatus')
            };
            
            uploadState.elements = elements;
            
            // 동적 요소 생성
            this.createMissingElements();
            
            Core.logger.log('업로드 DOM 요소 초기화 완료', {
                hasDropZone: !!elements.dropZone,
                hasFileInput: !!elements.fileInput,
                hasSelectButton: !!elements.selectButton
            });
            
            return true;
        },
        
        /**
         * 누락된 요소 동적 생성
         */
        createMissingElements() {
            const elements = uploadState.elements;
            
            // 드롭존 생성
            if (!elements.dropZone) {
                elements.dropZone = this.createDropZone();
            }
            
            // 파일 입력 생성
            if (!elements.fileInput) {
                elements.fileInput = this.createFileInput();
            }
            
            // 선택 버튼 생성
            if (!elements.selectButton) {
                elements.selectButton = this.createSelectButton();
            }
            
            // 미리보기 컨테이너 생성
            if (!elements.previewContainer) {
                elements.previewContainer = this.createPreviewContainer();
            }
            
            // 진행률 표시기 생성
            if (!elements.progressBar) {
                elements.progressBar = this.createProgressBar();
            }
        },
        
        /**
         * 드롭존 생성
         * @returns {HTMLElement} 드롭존 요소
         */
        createDropZone() {
            const dropZone = document.createElement('div');
            dropZone.className = 'upload-area drop-zone';
            dropZone.innerHTML = `
                <div class="upload-content">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt fa-3x text-primary"></i>
                    </div>
                    <h5 class="upload-title">시설 이미지 업로드</h5>
                    <p class="upload-description text-muted">
                        이미지를 드래그하여 업로드하거나 클릭하여 선택하세요
                    </p>
                    <div class="upload-format-info">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            JPG, PNG, WEBP 파일만 지원 (최대 10MB)
                        </small>
                    </div>
                </div>
            `;
            
            dropZone.style.cssText = `
                border: 2px dashed #dee2e6;
                border-radius: 8px;
                padding: 3rem;
                text-align: center;
                background: #f8f9fa;
                transition: all 0.3s ease;
                cursor: pointer;
                min-height: 300px;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            // 적절한 위치에 추가
            const container = document.querySelector('.upload-section, #uploadSection, main');
            if (container) {
                container.appendChild(dropZone);
            } else {
                document.body.appendChild(dropZone);
            }
            
            return dropZone;
        },
        
        /**
         * 파일 입력 생성
         * @returns {HTMLInputElement} 파일 입력 요소
         */
        createFileInput() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = UPLOAD_CONSTANTS.ALLOWED_TYPES.join(',');
            fileInput.multiple = true;
            fileInput.style.display = 'none';
            fileInput.id = 'facilityImageFile';
            
            document.body.appendChild(fileInput);
            return fileInput;
        },
        
        /**
         * 선택 버튼 생성
         * @returns {HTMLButtonElement} 선택 버튼 요소
         */
        createSelectButton() {
            const button = document.createElement('button');
            button.type = 'button';
            button.className = 'btn btn-primary btn-lg';
            button.innerHTML = '<i class="fas fa-folder-open me-2"></i>파일 선택';
            
            const dropZone = uploadState.elements.dropZone;
            if (dropZone) {
                dropZone.appendChild(button);
            }
            
            return button;
        },
        
        /**
         * 미리보기 컨테이너 생성
         * @returns {HTMLElement} 미리보기 컨테이너 요소
         */
        createPreviewContainer() {
            const container = document.createElement('div');
            container.className = 'selected-images-preview mt-4';
            container.innerHTML = `
                <h6 class="mb-3">
                    <i class="fas fa-images me-2"></i>선택된 이미지
                    <span class="badge bg-secondary ms-2" id="imageCount">0</span>
                </h6>
                <div class="row" id="previewGrid"></div>
            `;
            
            const dropZone = uploadState.elements.dropZone;
            if (dropZone && dropZone.parentElement) {
                dropZone.parentElement.appendChild(container);
            }
            
            return container;
        },
        
        /**
         * 진행률 표시기 생성
         * @returns {HTMLElement} 진행률 표시기 요소
         */
        createProgressBar() {
            const progressContainer = document.createElement('div');
            progressContainer.className = 'upload-progress mt-3';
            progressContainer.style.display = 'none';
            progressContainer.innerHTML = `
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                </div>
                <div class="progress-text text-center mt-2">
                    <small class="text-muted">준비 중...</small>
                </div>
            `;
            
            const dropZone = uploadState.elements.dropZone;
            if (dropZone && dropZone.parentElement) {
                dropZone.parentElement.appendChild(progressContainer);
            }
            
            return progressContainer;
        }
    };
    
    // ================================================
    // 파일 검증 시스템
    // ================================================
    
    const fileValidator = {
        /**
         * 파일 검증
         * @param {File} file - 검증할 파일
         * @returns {Object} 검증 결과
         */
        validateFile(file) {
            const result = {
                isValid: true,
                errors: [],
                warnings: []
            };
            
            // 파일 타입 검증
            if (!this.validateFileType(file)) {
                result.isValid = false;
                result.errors.push(UPLOAD_CONSTANTS.ERROR_MESSAGES.INVALID_TYPE);
            }
            
            // 파일 크기 검증
            if (!this.validateFileSize(file)) {
                result.isValid = false;
                result.errors.push(UPLOAD_CONSTANTS.ERROR_MESSAGES.FILE_TOO_LARGE);
            }
            
            // 파일 이름 검증
            const nameValidation = this.validateFileName(file.name);
            if (!nameValidation.isValid) {
                result.warnings.push(...nameValidation.warnings);
            }
            
            return result;
        },
        
        /**
         * 파일 타입 검증
         * @param {File} file - 검증할 파일
         * @returns {boolean} 유효한 타입인지 여부
         */
        validateFileType(file) {
            const allowedTypes = uploadState.settings.allowedTypes;
            return allowedTypes.includes(file.type);
        },
        
        /**
         * 파일 크기 검증
         * @param {File} file - 검증할 파일
         * @returns {boolean} 유효한 크기인지 여부
         */
        validateFileSize(file) {
            return file.size <= uploadState.settings.maxFileSize;
        },
        
        /**
         * 파일 이름 검증
         * @param {string} fileName - 파일 이름
         * @returns {Object} 검증 결과
         */
        validateFileName(fileName) {
            const result = {
                isValid: true,
                warnings: []
            };
            
            // 한글 파일명 체크
            if (/[가-힣]/.test(fileName)) {
                result.warnings.push('한글 파일명은 SEO에 불리할 수 있습니다.');
            }
            
            // 특수문자 체크
            if (/[^a-zA-Z0-9.\-_]/.test(fileName)) {
                result.warnings.push('특수문자가 포함된 파일명입니다.');
            }
            
            return result;
        },
        
        /**
         * 다중 파일 검증
         * @param {FileList} fileList - 파일 목록
         * @returns {Object} 검증 결과
         */
        validateFiles(fileList) {
            const files = Array.from(fileList);
            const result = {
                validFiles: [],
                invalidFiles: [],
                errors: [],
                warnings: []
            };
            
            // 파일 개수 체크
            if (files.length > uploadState.settings.maxFiles) {
                result.errors.push(UPLOAD_CONSTANTS.ERROR_MESSAGES.TOO_MANY_FILES);
                return result;
            }
            
            // 각 파일 검증
            files.forEach((file, index) => {
                const validation = this.validateFile(file);
                
                if (validation.isValid) {
                    result.validFiles.push({
                        file: file,
                        index: index,
                        id: Core.utils.generateUniqueId(),
                        status: UPLOAD_CONSTANTS.FILE_STATUS.VALID
                    });
                } else {
                    result.invalidFiles.push({
                        file: file,
                        index: index,
                        errors: validation.errors
                    });
                }
                
                result.errors.push(...validation.errors);
                result.warnings.push(...validation.warnings);
            });
            
            return result;
        }
    };
    
    // ================================================
    // 파일 압축 시스템
    // ================================================
    
    const fileCompressor = {
        /**
         * 이미지 압축
         * @param {File} file - 압축할 파일
         * @param {Object} options - 압축 옵션
         * @returns {Promise<Blob>} 압축된 이미지 Blob
         */
        async compressImage(file, options = {}) {
            const defaultOptions = {
                ...UPLOAD_CONSTANTS.COMPRESSION_OPTIONS,
                ...options
            };
            
            if (!defaultOptions.enableCompression) {
                return file;
            }
            
            try {
                const canvas = await this.createCanvas(file, defaultOptions);
                const compressedBlob = await this.canvasToBlob(canvas, defaultOptions);
                
                Core.logger.log('이미지 압축 완료', {
                    originalSize: Core.utils.formatFileSize(file.size),
                    compressedSize: Core.utils.formatFileSize(compressedBlob.size),
                    compressionRatio: Math.round((1 - compressedBlob.size / file.size) * 100) + '%'
                });
                
                // 압축된 파일에 원본 정보 보존
                const compressedFile = new File([compressedBlob], file.name, {
                    type: compressedBlob.type || file.type,
                    lastModified: file.lastModified
                });
                
                // 원본 파일 정보 추가
                compressedFile.originalFile = file;
                compressedFile.originalName = file.name;
                compressedFile.originalSize = file.size;
                compressedFile.originalType = file.type;
                compressedFile.isCompressed = true;
                
                return compressedFile;
                
            } catch (error) {
                Core.logger.error('이미지 압축 실패:', error);
                throw error;
            }
        },
        
        /**
         * 캔버스 생성
         * @param {File} file - 이미지 파일
         * @param {Object} options - 옵션
         * @returns {Promise<HTMLCanvasElement>} 캔버스
         */
        async createCanvas(file, options) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // 크기 계산
                    const { width, height } = this.calculateNewDimensions(
                        img.width, 
                        img.height, 
                        options.maxWidth, 
                        options.maxHeight
                    );
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // 이미지 그리기
                    ctx.fillStyle = options.fillColor || '#ffffff';
                    ctx.fillRect(0, 0, width, height);
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    resolve(canvas);
                };
                
                img.onerror = () => {
                    reject(new Error('이미지 로드 실패'));
                };
                
                img.src = URL.createObjectURL(file);
            });
        },
        
        /**
         * 캔버스를 Blob으로 변환
         * @param {HTMLCanvasElement} canvas - 캔버스
         * @param {Object} options - 옵션
         * @returns {Promise<Blob>} Blob
         */
        async canvasToBlob(canvas, options) {
            return new Promise((resolve, reject) => {
                canvas.toBlob((blob) => {
                    if (blob) {
                        resolve(blob);
                    } else {
                        reject(new Error('Blob 생성 실패'));
                    }
                }, options.format, options.quality);
            });
        },
        
        /**
         * 새로운 크기 계산
         * @param {number} width - 원본 너비
         * @param {number} height - 원본 높이
         * @param {number} maxWidth - 최대 너비
         * @param {number} maxHeight - 최대 높이
         * @returns {Object} 새로운 크기
         */
        calculateNewDimensions(width, height, maxWidth, maxHeight) {
            if (width <= maxWidth && height <= maxHeight) {
                return { width, height };
            }
            
            const ratio = Math.min(maxWidth / width, maxHeight / height);
            return {
                width: Math.round(width * ratio),
                height: Math.round(height * ratio)
            };
        }
    };
    
    // ================================================
    // 드래그앤드롭 시스템
    // ================================================
    
    const dragDropHandler = {
        /**
         * 드래그앤드롭 이벤트 설정
         */
        setupDragAndDrop() {
            const dropZone = uploadState.elements.dropZone;
            if (!dropZone) return;
            
            // 드래그 이벤트 리스너
            dropZone.addEventListener('dragenter', this.handleDragEnter.bind(this));
            dropZone.addEventListener('dragover', this.handleDragOver.bind(this));
            dropZone.addEventListener('dragleave', this.handleDragLeave.bind(this));
            dropZone.addEventListener('drop', this.handleDrop.bind(this));
            
            // 클릭 이벤트 리스너
            dropZone.addEventListener('click', this.handleClick.bind(this));
            
            // 전역 드래그 이벤트 방지
            document.addEventListener('dragover', (e) => e.preventDefault());
            document.addEventListener('drop', (e) => e.preventDefault());
            
            Core.logger.log('드래그앤드롭 이벤트 설정 완료');
        },
        
        /**
         * 드래그 진입 이벤트
         * @param {DragEvent} event - 드래그 이벤트
         */
        handleDragEnter(event) {
            event.preventDefault();
            event.stopPropagation();
            
            uploadState.isDragging = true;
            this.updateDropZoneStyle(UPLOAD_CONSTANTS.DRAG_STATES.ENTER);
        },
        
        /**
         * 드래그 오버 이벤트
         * @param {DragEvent} event - 드래그 이벤트
         */
        handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            
            this.updateDropZoneStyle(UPLOAD_CONSTANTS.DRAG_STATES.OVER);
        },
        
        /**
         * 드래그 떠남 이벤트
         * @param {DragEvent} event - 드래그 이벤트
         */
        handleDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            
            if (!event.currentTarget.contains(event.relatedTarget)) {
                uploadState.isDragging = false;
                this.updateDropZoneStyle(UPLOAD_CONSTANTS.DRAG_STATES.LEAVE);
            }
        },
        
        /**
         * 드롭 이벤트
         * @param {DragEvent} event - 드래그 이벤트
         */
        handleDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            
            uploadState.isDragging = false;
            this.updateDropZoneStyle(UPLOAD_CONSTANTS.DRAG_STATES.NONE);
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                this.handleFiles(files);
            }
        },
        
        /**
         * 클릭 이벤트
         * @param {Event} event - 클릭 이벤트
         */
        handleClick(event) {
            event.preventDefault();
            const fileInput = uploadState.elements.fileInput;
            if (fileInput) {
                fileInput.click();
            }
        },
        
        /**
         * 드롭존 스타일 업데이트
         * @param {string} state - 드래그 상태
         */
        updateDropZoneStyle(state) {
            const dropZone = uploadState.elements.dropZone;
            if (!dropZone) return;
            
            // 기존 클래스 제거
            dropZone.classList.remove('drag-enter', 'drag-over', 'drag-leave');
            
            switch (state) {
                case UPLOAD_CONSTANTS.DRAG_STATES.ENTER:
                    dropZone.classList.add('drag-enter');
                    dropZone.style.borderColor = '#007bff';
                    dropZone.style.backgroundColor = '#e3f2fd';
                    break;
                case UPLOAD_CONSTANTS.DRAG_STATES.OVER:
                    dropZone.classList.add('drag-over');
                    dropZone.style.borderColor = '#0056b3';
                    dropZone.style.backgroundColor = '#bbdefb';
                    break;
                case UPLOAD_CONSTANTS.DRAG_STATES.LEAVE:
                case UPLOAD_CONSTANTS.DRAG_STATES.NONE:
                    dropZone.classList.add('drag-leave');
                    dropZone.style.borderColor = '#dee2e6';
                    dropZone.style.backgroundColor = '#f8f9fa';
                    break;
            }
        },
        
        /**
         * 파일 처리
         * @param {FileList} files - 파일 목록
         */
        async handleFiles(files) {
            Core.logger.log('파일 처리 시작', { count: files.length });
            
            try {
                // 파일 검증
                const validation = fileValidator.validateFiles(files);
                
                if (validation.errors.length > 0) {
                    this.showErrors(validation.errors);
                    return;
                }
                
                if (validation.warnings.length > 0) {
                    this.showWarnings(validation.warnings);
                }
                
                // 유효한 파일들 처리
                if (validation.validFiles.length > 0) {
                    uploadState.files = validation.validFiles;
                    await this.processFiles(validation.validFiles);
                }
                
            } catch (error) {
                Core.logger.error('파일 처리 중 오류:', error);
                this.showError('파일 처리 중 오류가 발생했습니다.');
            }
        },
        
        /**
         * 파일 처리 (압축 및 미리보기)
         * @param {Array} files - 파일 배열
         */
        async processFiles(files) {
            uploadState.isProcessing = true;
            this.showProgress(0, files.length);
            
            try {
                for (let i = 0; i < files.length; i++) {
                    const fileData = files[i];
                    
                    // 1단계에서는 압축 건너뛰기 (2단계에서 크롭 시 압축)
                    // 미리보기 생성은 원본 파일로
                    await this.createPreview(fileData);
                    
                    // 진행률 업데이트
                    this.updateProgress(i + 1, files.length);
                }
                
                // 완료 처리
                uploadState.validatedFiles = files;
                this.hideProgress();
                
                // 콜백 호출
                if (uploadState.callbacks.onFileSelect) {
                    uploadState.callbacks.onFileSelect(files);
                }
                
                Core.emit(Core.CONSTANTS.EVENTS.IMAGE_ADDED, {
                    files: files,
                    count: files.length
                });
                
            } catch (error) {
                Core.logger.error('파일 처리 실패:', error);
                this.showError('파일 처리에 실패했습니다.');
            } finally {
                uploadState.isProcessing = false;
            }
        },
        
        /**
         * 미리보기 생성
         * @param {Object} fileData - 파일 데이터
         */
        async createPreview(fileData) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    const previewHtml = this.createPreviewHtml(fileData, e.target.result);
                    this.addPreviewToContainer(previewHtml);
                    resolve();
                };
                
                reader.onerror = () => {
                    Core.logger.error('미리보기 생성 실패:', fileData.file.name);
                    resolve();
                };
                
                reader.readAsDataURL(fileData.file);
            });
        },
        
        /**
         * 미리보기 HTML 생성
         * @param {Object} fileData - 파일 데이터
         * @param {string} dataUrl - 데이터 URL
         * @returns {string} 미리보기 HTML
         */
        createPreviewHtml(fileData, dataUrl) {
            return `
                <div class="col-md-3 mb-3" data-file-id="${fileData.id}">
                    <div class="card">
                        <div class="card-img-top" style="height: 150px; overflow: hidden;">
                            <img src="${dataUrl}" alt="${fileData.file.name}" 
                                 style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <div class="card-body p-2">
                            <h6 class="card-title small mb-1">${fileData.file.name}</h6>
                            <p class="card-text small text-muted mb-1">
                                ${Core.utils.formatFileSize(fileData.file.size)}
                            </p>
                            <button type="button" class="btn btn-sm btn-outline-danger" 
                                    onclick="FacilityImageUpload.removeFile('${fileData.id}')">
                                <i class="fas fa-times"></i> 제거
                            </button>
                        </div>
                    </div>
                </div>
            `;
        },
        
        /**
         * 미리보기 컨테이너에 추가
         * @param {string} html - 미리보기 HTML
         */
        addPreviewToContainer(html) {
            const container = uploadState.elements.previewContainer;
            if (!container) return;
            
            const grid = container.querySelector('#previewGrid, .row');
            if (grid) {
                grid.insertAdjacentHTML('beforeend', html);
            }
            
            // 카운터 업데이트
            const counter = container.querySelector('#imageCount');
            if (counter) {
                counter.textContent = uploadState.files.length;
            }
            
            // 컨테이너 표시
            container.style.display = 'block';
        },
        
        /**
         * 진행률 표시
         * @param {number} current - 현재 진행
         * @param {number} total - 전체 개수
         */
        showProgress(current, total) {
            const progressBar = uploadState.elements.progressBar;
            if (!progressBar) return;
            
            const percentage = total > 0 ? Math.round((current / total) * 100) : 0;
            const progressElement = progressBar.querySelector('.progress-bar');
            const textElement = progressBar.querySelector('.progress-text small');
            
            if (progressElement) {
                progressElement.style.width = percentage + '%';
                progressElement.setAttribute('aria-valuenow', percentage);
            }
            
            if (textElement) {
                textElement.textContent = `처리 중... ${current}/${total} (${percentage}%)`;
            }
            
            progressBar.style.display = 'block';
        },
        
        /**
         * 진행률 업데이트
         * @param {number} current - 현재 진행
         * @param {number} total - 전체 개수
         */
        updateProgress(current, total) {
            uploadState.progress = {
                current,
                total,
                percentage: Math.round((current / total) * 100)
            };
            
            this.showProgress(current, total);
        },
        
        /**
         * 진행률 숨김
         */
        hideProgress() {
            const progressBar = uploadState.elements.progressBar;
            if (progressBar) {
                progressBar.style.display = 'none';
            }
        },
        
        /**
         * 에러 표시
         * @param {Array} errors - 에러 배열
         */
        showErrors(errors) {
            errors.forEach(error => {
                this.showError(error);
            });
        },
        
        /**
         * 경고 표시
         * @param {Array} warnings - 경고 배열
         */
        showWarnings(warnings) {
            warnings.forEach(warning => {
                this.showWarning(warning);
            });
        },
        
        /**
         * 에러 메시지 표시
         * @param {string} message - 에러 메시지
         */
        showError(message) {
            Core.logger.error(message);
            // 토스트 또는 알림 표시
            this.showNotification(message, 'error');
        },
        
        /**
         * 경고 메시지 표시
         * @param {string} message - 경고 메시지
         */
        showWarning(message) {
            Core.logger.warn(message);
            this.showNotification(message, 'warning');
        },
        
        /**
         * 알림 표시
         * @param {string} message - 메시지
         * @param {string} type - 타입 (error, warning, info)
         */
        showNotification(message, type = 'info') {
            // 간단한 알림 구현
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'error' ? 'danger' : type === 'warning' ? 'warning' : 'info'} alert-dismissible fade show`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1050;
                max-width: 400px;
            `;
            
            notification.innerHTML = `
                <strong>${type === 'error' ? '오류' : type === 'warning' ? '경고' : '정보'}:</strong> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            // 5초 후 자동 제거
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.parentElement.removeChild(notification);
                }
            }, 5000);
        }
    };
    
    // ================================================
    // 메인 업로드 객체
    // ================================================
    
    const uploader = {
        /**
         * 업로드 모듈 초기화
         * @param {Object} options - 초기화 옵션
         * @returns {Promise<boolean>} 초기화 성공 여부
         */
        async initialize(options = {}) {
            if (uploadState.isInitialized) {
                Core.logger.warn('업로드 모듈이 이미 초기화됨');
                return true;
            }
            
            Core.logger.log('업로드 모듈 초기화 시작');
            
            try {
                // 설정 병합
                if (options.settings) {
                    Object.assign(uploadState.settings, options.settings);
                }
                
                // 콜백 설정
                if (options.callbacks) {
                    Object.assign(uploadState.callbacks, options.callbacks);
                }
                
                // DOM 요소 초기화
                domManager.initializeElements();
                
                // 드래그앤드롭 설정
                dragDropHandler.setupDragAndDrop();
                
                // 파일 입력 이벤트 설정
                this.setupFileInputEvents();
                
                uploadState.isInitialized = true;
                Core.logger.success('업로드 모듈 초기화 완료');
                
                return true;
                
            } catch (error) {
                Core.logger.error('업로드 모듈 초기화 실패:', error);
                return false;
            }
        },
        
        /**
         * 파일 입력 이벤트 설정
         */
        setupFileInputEvents() {
            const fileInput = uploadState.elements.fileInput;
            if (!fileInput) return;
            
            fileInput.addEventListener('change', async (event) => {
                const files = event.target.files;
                if (files.length > 0) {
                    await dragDropHandler.handleFiles(files);
                }
            });
        },
        
        /**
         * 파일 제거
         * @param {string} fileId - 파일 ID
         */
        removeFile(fileId) {
            // 파일 목록에서 제거
            uploadState.files = uploadState.files.filter(file => file.id !== fileId);
            uploadState.validatedFiles = uploadState.validatedFiles.filter(file => file.id !== fileId);
            
            // DOM에서 제거
            const previewElement = document.querySelector(`[data-file-id="${fileId}"]`);
            if (previewElement) {
                previewElement.remove();
            }
            
            // 카운터 업데이트
            const counter = document.querySelector('#imageCount');
            if (counter) {
                counter.textContent = uploadState.files.length;
            }
            
            // 이벤트 발생
            Core.emit(Core.CONSTANTS.EVENTS.IMAGE_REMOVED, {
                fileId: fileId,
                remainingCount: uploadState.files.length
            });
            
            Core.logger.log('파일 제거 완료:', fileId);
        },
        
        /**
         * 모든 파일 제거
         */
        clearAllFiles() {
            uploadState.files = [];
            uploadState.validatedFiles = [];
            uploadState.compressedFiles = [];
            
            // DOM 정리
            const previewContainer = uploadState.elements.previewContainer;
            if (previewContainer) {
                const grid = previewContainer.querySelector('#previewGrid, .row');
                if (grid) {
                    grid.innerHTML = '';
                }
                
                const counter = previewContainer.querySelector('#imageCount');
                if (counter) {
                    counter.textContent = '0';
                }
                
                previewContainer.style.display = 'none';
            }
            
            Core.logger.log('모든 파일 제거 완료');
        },
        
        /**
         * 현재 선택된 파일 반환
         * @returns {Array} 파일 배열
         */
        getFiles() {
            return uploadState.validatedFiles;
        },
        
        /**
         * 압축된 파일 반환
         * @returns {Array} 압축된 파일 배열
         */
        getCompressedFiles() {
            return uploadState.validatedFiles.filter(file => file.compressedBlob);
        },
        
        /**
         * 업로드 상태 반환
         * @returns {Object} 업로드 상태
         */
        getUploadState() {
            return {
                isInitialized: uploadState.isInitialized,
                isUploading: uploadState.isUploading,
                isProcessing: uploadState.isProcessing,
                fileCount: uploadState.files.length,
                validFileCount: uploadState.validatedFiles.length,
                progress: uploadState.progress
            };
        },
        
        /**
         * 업로드 모듈 제거
         */
        destroy() {
            this.clearAllFiles();
            
            // 이벤트 리스너 제거
            const dropZone = uploadState.elements.dropZone;
            if (dropZone) {
                dropZone.removeEventListener('dragenter', dragDropHandler.handleDragEnter);
                dropZone.removeEventListener('dragover', dragDropHandler.handleDragOver);
                dropZone.removeEventListener('dragleave', dragDropHandler.handleDragLeave);
                dropZone.removeEventListener('drop', dragDropHandler.handleDrop);
                dropZone.removeEventListener('click', dragDropHandler.handleClick);
            }
            
            // 상태 초기화
            uploadState.isInitialized = false;
            uploadState.isDragging = false;
            uploadState.isUploading = false;
            uploadState.isProcessing = false;
            
            Core.logger.log('업로드 모듈 제거 완료');
        },
        
        /**
         * 모듈 정보 반환
         * @returns {Object} 모듈 정보
         */
        getInfo() {
            return {
                name: UPLOAD_CONSTANTS.MODULE_NAME,
                version: UPLOAD_CONSTANTS.VERSION,
                isInitialized: uploadState.isInitialized,
                fileCount: uploadState.files.length,
                settings: uploadState.settings
            };
        }
    };
    
    // ================================================
    // 모듈 노출
    // ================================================
    
    // Upload 모듈 API 노출
    window.FacilityImageSystem.Upload = {
        // 상수
        CONSTANTS: UPLOAD_CONSTANTS,
        
        // 메인 객체
        uploader,
        
        // 내부 객체 (고급 사용자용)
        fileValidator,
        fileCompressor,
        dragDropHandler,
        domManager,
        
        // 상태 (읽기 전용)
        getState: () => ({ ...uploadState }),
        
        // 편의 함수
        initialize: uploader.initialize.bind(uploader),
        removeFile: uploader.removeFile.bind(uploader),
        clearAllFiles: uploader.clearAllFiles.bind(uploader),
        getFiles: uploader.getFiles.bind(uploader),
        getCompressedFiles: uploader.getCompressedFiles.bind(uploader),
        getUploadState: uploader.getUploadState.bind(uploader),
        destroy: uploader.destroy.bind(uploader),
        compressImage: fileCompressor.compressImage.bind(fileCompressor)
    };
    
    // 전역 접근을 위한 단축 참조
    window.FacilityImageUpload = window.FacilityImageSystem.Upload;
    
    Core.logger.log('업로드 모듈 로드 완료');
    
})();
````

## File: src/main/resources/static/js/facility-manage.js
````javascript
// facility-manage.js

// 시설 삭제 함수
function deleteFacility() {
    if (!facilityId) {
        alert('시설 정보를 찾을 수 없습니다.');
        return;
    }
    
    if (confirm('정말로 시설을 삭제하시겠습니까?\n삭제된 시설 정보는 복구할 수 없습니다.')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/facility/delete/${facilityId}`;
        
        // CSRF 토큰 추가 (Spring Security 사용 시)
        const csrfToken = document.querySelector('meta[name="_csrf"]');
        const csrfHeader = document.querySelector('meta[name="_csrf_header"]');
        
        if (csrfToken && csrfHeader) {
            const hiddenField = document.createElement('input');
            hiddenField.type = 'hidden';
            hiddenField.name = csrfToken.getAttribute('content');
            hiddenField.value = csrfHeader.getAttribute('content');
            form.appendChild(hiddenField);
        }
        
        document.body.appendChild(form);
        form.submit();
    }
}

// 페이지 로드 완료 후 실행
document.addEventListener('DOMContentLoaded', function() {
    // 이미지 로드 에러 처리 (default_facility.jpg 무한 요청 방지)
    const facilityImages = document.querySelectorAll('img[alt="시설 사진"], .facility-detail-image');
    facilityImages.forEach(function(facilityImage) {
        if (facilityImage && !facilityImage.classList.contains('error-handler-attached')) {
            facilityImage.classList.add('error-handler-attached');
            facilityImage.onerror = function() {
                // 이미 에러 처리되었는지 확인
                if (this.classList.contains('error-handled')) {
                    return;
                }
                this.classList.add('error-handled');
                this.style.display = 'none';
                
                const placeholder = document.createElement('div');
                placeholder.className = 'bg-light rounded p-5 text-center';
                placeholder.innerHTML = '<i class="fas fa-image fa-3x text-muted"></i><p class="text-muted mt-2">이미지를 불러올 수 없습니다</p>';
                this.parentNode.replaceChild(placeholder, this);
                console.log('✅ 시설 이미지 에러 처리 완료 (무한 요청 방지)');
            };
        }
    });
    
    // 외부 링크 안전하게 열기
    const externalLinks = document.querySelectorAll('a[target="_blank"]');
    externalLinks.forEach(link => {
        link.rel = 'noopener noreferrer';
    });
});
````

## File: src/main/resources/static/js/job-edit.js
````javascript
/**
 * 구인구직 수정 페이지 JavaScript
 * job-detail.js와의 충돌 방지를 위한 별도 파일
 */

// 전역 변수로 제출 상태 관리
let isSubmitting = false;
let formInitialized = false;

// DOM 로드 완료 후 초기화
document.addEventListener('DOMContentLoaded', function() {
    console.log('구인구직 수정 페이지 JavaScript 로드됨');
    
    // 중복 초기화 방지
    if (formInitialized) {
        console.log('이미 초기화됨 - 중복 초기화 방지');
        return;
    }
    
    // 폼 유효성 검사 초기화
    initFormValidation();
    
    // 취소 버튼 이벤트 리스너
    initCancelButton();
    
    // 입력 필드 이벤트 리스너 초기화
    initInputFieldHandlers();
    
    // 리치 텍스트 에디터 안전 초기화
    initSafeRichTextEditor();
    
    formInitialized = true;
    console.log('폼 초기화 완료');
});

/**
 * 폼 유효성 검사 초기화 (중복 방지)
 */
function initFormValidation() {
    const form = document.querySelector('form');
    if (!form) return;
    
    // 기존 이벤트 리스너 제거 (중복 방지)
    const newForm = form.cloneNode(true);
    form.parentNode.replaceChild(newForm, form);
    
    // 새로운 이벤트 리스너 추가
    newForm.addEventListener('submit', function(e) {
        console.log('폼 제출 시작 - 검증 중...');
        
        // 중복 제출 방지
        if (isSubmitting) {
            console.log('이미 제출 중 - 중복 제출 방지');
            e.preventDefault();
            return false;
        }
        
        // 제출 전 값 정리
        cleanFormValues();
        
        if (!validateForm()) {
            console.log('폼 검증 실패 - 제출 중단');
            e.preventDefault();
            return false;
        }
        
        // 제출 상태 플래그 설정
        isSubmitting = true;
        
        // 제출 버튼 비활성화
        const submitBtn = newForm.querySelector('button[type="submit"]');
        if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>수정 중...';
        }
        
        console.log('폼 검증 성공 - 제출 계속');
        return true;
    });
}

/**
 * 제출 전 폼 값 정리 (중복 및 누적 방지)
 */
function cleanFormValues() {
    console.log('폼 값 정리 시작');
    
    // 급여 설명 정리
    const salaryDescription = document.querySelector('[name="salaryDescription"]');
    if (salaryDescription && salaryDescription.value) {
        const cleanValue = salaryDescription.value.trim();
        // 중복된 값 제거 (콤마로 분리된 경우)
        const uniqueValues = [...new Set(cleanValue.split(',').map(v => v.trim()).filter(v => v))];
        salaryDescription.value = uniqueValues.join(', ');
        console.log('급여 설명 정리됨:', salaryDescription.value);
    }
    
    // 근무시간 정리
    const workHours = document.querySelector('[name="workHours"]');
    if (workHours && workHours.value) {
        const cleanValue = workHours.value.trim();
        // 중복된 값 제거
        const uniqueValues = [...new Set(cleanValue.split(',').map(v => v.trim()).filter(v => v))];
        workHours.value = uniqueValues.join(', ');
        console.log('근무시간 정리됨:', workHours.value);
    }
    
    // 기타 텍스트 필드 정리
    const textFields = ['title', 'facilityName', 'workLocation', 'contactPhone'];
    textFields.forEach(fieldName => {
        const field = document.querySelector(`[name="${fieldName}"]`);
        if (field && field.value) {
            field.value = field.value.trim();
        }
    });
    
    console.log('폼 값 정리 완료');
}

/**
 * 폼 유효성 검사 (구인글/구직글 구분)
 */
function validateForm() {
    const jobTypeInput = document.querySelector('[name="jobType"]');
    const jobType = jobTypeInput?.value || '';
    
    console.log('검증 시작 - jobType:', jobType);
    
    // 공통 필수 필드 검사
    const title = document.querySelector('[name="title"]')?.value?.trim() || '';
    const content = document.querySelector('[name="content"]')?.value?.trim() || '';
    const workType = document.querySelector('[name="workType"]')?.value || '';
    const status = document.querySelector('[name="status"]')?.value || '';
    
    if (!title) {
        alert('제목을 입력해주세요.');
        document.querySelector('[name="title"]')?.focus();
        return false;
    }
    
    if (!content) {
        alert('내용을 입력해주세요.');
        document.querySelector('[name="content"]')?.focus();
        return false;
    }
    
    if (!workType) {
        alert('고용형태를 선택해주세요.');
        document.querySelector('[name="workType"]')?.focus();
        return false;
    }
    
    if (!status) {
        alert('게시글 상태를 선택해주세요.');
        document.querySelector('[name="status"]')?.focus();
        return false;
    }
    
    // 구인글 전용 필수 필드 검사
    if (jobType === 'RECRUIT') {
        console.log('구인글 검증 중...');
        const facilityName = document.querySelector('[name="facilityName"]')?.value?.trim() || '';
        const position = document.querySelector('[name="position"]')?.value || '';
        
        if (!facilityName) {
            alert('회사명을 입력해주세요.');
            document.querySelector('[name="facilityName"]')?.focus();
            return false;
        }
        
        if (!position) {
            alert('직종을 선택해주세요.');
            document.querySelector('[name="position"]')?.focus();
            return false;
        }
    }
    
    // 구직글 전용 필수 필드 검사
    if (jobType === 'SEARCH') {
        console.log('구직글 검증 중...');
        const workLocation = document.querySelector('[name="workLocation"]')?.value?.trim() || '';
        const contactPhone = document.querySelector('[name="contactPhone"]')?.value?.trim() || '';
        const position = document.querySelector('[name="position"]')?.value || '';
        
        if (!workLocation) {
            alert('희망 근무지를 입력해주세요.');
            document.querySelector('[name="workLocation"]')?.focus();
            return false;
        }
        
        if (!contactPhone) {
            alert('연락처를 입력해주세요.');
            document.querySelector('[name="contactPhone"]')?.focus();
            return false;
        }
        
        if (!position) {
            alert('직종을 선택해주세요.');
            document.querySelector('[name="position"]')?.focus();
            return false;
        }
    }
    
    // 제목 길이 검사
    if (title.length > 100) {
        alert('제목은 100자 이하로 입력해주세요.');
        document.querySelector('[name="title"]')?.focus();
        return false;
    }
    
    // 내용 길이 검사
    if (content.length > 2000) {
        alert('내용은 2000자 이하로 입력해주세요.');
        document.querySelector('[name="content"]')?.focus();
        return false;
    }
    
    console.log('모든 검증 통과');
    return true;
}

/**
 * 입력 필드 이벤트 핸들러 초기화
 */
function initInputFieldHandlers() {
    // 급여 입력 필드 핸들러
    const salaryInputs = document.querySelectorAll('[name="salaryMin"], [name="salaryMax"]');
    salaryInputs.forEach(input => {
        if (input && input.type === 'number') {
            // 기존 이벤트 리스너 제거
            input.removeEventListener('blur', handleSalaryFormat);
            // 새 이벤트 리스너 추가
            input.addEventListener('blur', handleSalaryFormat);
        }
    });
    
    // 텍스트 필드 중복 입력 방지
    const textInputs = document.querySelectorAll('[name="salaryDescription"], [name="workHours"]');
    textInputs.forEach(input => {
        if (input) {
            input.removeEventListener('blur', handleTextFieldClean);
            input.addEventListener('blur', handleTextFieldClean);
        }
    });
}

/**
 * 급여 입력 필드 포맷팅 핸들러
 */
function handleSalaryFormat(event) {
    const input = event.target;
    let value = input.value.replace(/,/g, '');
    if (value && !isNaN(value)) {
        input.value = Number(value).toLocaleString();
    }
}

/**
 * 텍스트 필드 정리 핸들러 (중복 제거)
 */
function handleTextFieldClean(event) {
    const input = event.target;
    if (input.value) {
        const cleanValue = input.value.trim();
        // 중복된 값 제거 (콤마로 분리된 경우)
        const uniqueValues = [...new Set(cleanValue.split(',').map(v => v.trim()).filter(v => v))];
        input.value = uniqueValues.join(', ');
    }
}

/**
 * 리치 텍스트 에디터 안전 초기화
 */
function initSafeRichTextEditor() {
    const contentTextarea = document.getElementById('contentTextarea');
    if (contentTextarea && contentTextarea.hasAttribute('data-rich-editor')) {
        // 기존 에디터 인스턴스가 있다면 제거
        if (window.richTextEditorInstance) {
            try {
                window.richTextEditorInstance.destroy();
                console.log('기존 리치 텍스트 에디터 제거됨');
            } catch (e) {
                console.log('에디터 제거 중 오류 (무시):', e.message);
            }
        }
        
        // 새 에디터 초기화는 RichTextEditorV2가 로드된 후에 수행
        setTimeout(() => {
            if (typeof window.RichTextEditorV2 !== 'undefined') {
                try {
                    window.richTextEditorInstance = new window.RichTextEditorV2(contentTextarea);
                    console.log('리치 텍스트 에디터 안전 초기화 완료');
                } catch (e) {
                    console.log('에디터 초기화 오류:', e.message);
                }
            }
        }, 500);
    }
}

/**
 * 취소 버튼 이벤트 초기화
 */
function initCancelButton() {
    const cancelBtn = document.querySelector('.btn-secondary');
    if (!cancelBtn) return;
    
    cancelBtn.addEventListener('click', function(e) {
        if (confirm('수정을 취소하시겠습니까?\n변경사항이 저장되지 않습니다.')) {
            // 취소 버튼의 href로 이동 (이미 설정됨)
            return true;
        } else {
            e.preventDefault();
            return false;
        }
    });
}
````

## File: src/main/resources/static/js/myinfo.js
````javascript
// 내정보수정 페이지 JavaScript (단순화 버전)
// 크롭 기능은 별도 페이지에서 처리

document.addEventListener('DOMContentLoaded', function() {
    // DOM 요소 선택
    const elements = {
        form: document.getElementById('mypageForm'),
        phone: document.getElementById('phone'),
        name: document.getElementById('name'),
        email: document.getElementById('email')
    };

    // 기본 기능 초기화
    setupPhoneFormatting();
    setupFormValidation();
    
    console.log('내정보수정 페이지 JavaScript 초기화 완료 (단순화)');

    // 휴대폰 번호 자동 포맷팅 (매우 간단한 버전)
    function setupPhoneFormatting() {
        if (!elements.phone) return;

        elements.phone.addEventListener('input', function(event) {
            autoFormatPhone(event.target);
        });
        
        // 붙여넣기 시에도 포맷팅 적용
        elements.phone.addEventListener('paste', function(event) {
            setTimeout(() => autoFormatPhone(event.target), 10);
        });
    }

    // 스마트한 전화번호 포맷팅 함수 (정확한 커서 위치 추적)
    function autoFormatPhone(input) {
        const cursorPos = input.selectionStart;
        const oldValue = input.value;
        
        // 커서 앞에 있는 숫자의 개수 계산 (하이픈 제외)
        const numbersBeforeCursor = oldValue.substring(0, cursorPos).replace(/[^\d]/g, '').length;
        
        // 숫자만 추출
        const numbers = input.value.replace(/[^\d]/g, '');
        
        // 최대 11자리 제한
        const limitedNumbers = numbers.substring(0, 11);
        
        // 포맷팅 적용
        let formatted = formatPhoneNumber(limitedNumbers);
        
        // 값 업데이트
        input.value = formatted;
        
        // 새로운 커서 위치 계산
        let newCursorPos = 0;
        let numberCount = 0;
        
        for (let i = 0; i < formatted.length; i++) {
            if (/\d/.test(formatted[i])) {
                numberCount++;
                if (numberCount === numbersBeforeCursor) {
                    newCursorPos = i + 1;
                    break;
                }
            }
        }
        
        // 숫자가 추가된 경우 마지막 숫자 뒤로 커서 이동
        if (numberCount < numbersBeforeCursor) {
            newCursorPos = formatted.length;
        }
        
        // 커서가 하이픈 위에 있으면 다음 위치로 이동
        if (formatted[newCursorPos] === '-') {
            newCursorPos++;
        }
        
        // 커서 위치 설정 (비동기적으로 처리)
        setTimeout(() => {
            input.setSelectionRange(newCursorPos, newCursorPos);
        }, 0);
    }

    // 휴대폰 번호 포맷팅 (010으로 시작하는 번호만)
    function formatPhoneNumber(numbers) {
        if (numbers.length === 0) return '';
        
        // 휴대폰 번호만 허용 (010, 011, 016, 017, 018, 019)
        if (numbers.startsWith('01')) {
            if (numbers.length <= 3) {
                return numbers;
            } else if (numbers.length <= 7) {
                return numbers.substring(0, 3) + '-' + numbers.substring(3);
            } else {
                return numbers.substring(0, 3) + '-' + numbers.substring(3, 7) + '-' + numbers.substring(7);
            }
        }
        
        // 010으로 시작하지 않으면 입력 제한 (휴대폰 번호만 허용)
        return numbers.startsWith('0') ? numbers.substring(0, 1) : numbers;
    }


    // 폼 제출 전 유효성 검사
    function setupFormValidation() {
        if (!elements.form) return;

        elements.form.addEventListener('submit', function(event) {
            let isValid = true;
            const errors = [];

            // 이름 검사
            if (elements.name && elements.name.value.trim().length < 2) {
                isValid = false;
                errors.push('이름은 2자 이상 입력해주세요.');
                elements.name.classList.add('is-invalid');
            }

            // 이메일 검사
            if (elements.email && elements.email.value.trim()) {
                const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailPattern.test(elements.email.value.trim())) {
                    isValid = false;
                    errors.push('올바른 이메일 형식이 아닙니다.');
                    elements.email.classList.add('is-invalid');
                }
            }

            // 휴대폰 번호 검사
            if (elements.phone && elements.phone.value.trim()) {
                const phonePattern = /^01[0-9]-\d{3,4}-\d{4}$/;
                if (!phonePattern.test(elements.phone.value.trim())) {
                    isValid = false;
                    errors.push('올바른 휴대폰 번호 형식이 아닙니다.');
                    elements.phone.classList.add('is-invalid');
                }
            }

            if (!isValid) {
                event.preventDefault();
                alert('입력 오류:\n' + errors.join('\n'));
                return false;
            }

            // 제출 버튼 비활성화
            const submitButton = elements.form.querySelector('button[type="submit"]');
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>저장 중...';
            }

            return true;
        });
    }

    // 입력 필드 포커스 시 에러 상태 제거
    [elements.name, elements.email, elements.phone].forEach(field => {
        if (field) {
            field.addEventListener('focus', function() {
                this.classList.remove('is-invalid');
            });
        }
    });
});
````

## File: src/main/resources/static/js/review-detail.js
````javascript
/**
 * 리뷰 상세보기 페이지 JavaScript
 * Thymeleaf 충돌 방지를 위해 완전 분리된 버전
 */

// 전역 변수
let currentReviewId = null;

// DOM 로드 완료 후 초기화
document.addEventListener('DOMContentLoaded', function() {
    console.log('리뷰 상세보기 페이지 JavaScript 로드됨');
    
    // URL에서 리뷰 ID 추출
    currentReviewId = extractReviewIdFromUrl();
    console.log('현재 리뷰 ID:', currentReviewId);
    
    // 이벤트 리스너 초기화
    initializeEventListeners();
    
    // 이미지 모달 초기화
    initializeImageModal();
});

/**
 * URL에서 리뷰 ID 추출
 */
function extractReviewIdFromUrl() {
    const path = window.location.pathname;
    const segments = path.split('/');
    const detailIndex = segments.findIndex(segment => segment === 'detail');
    
    if (detailIndex !== -1 && detailIndex < segments.length - 1) {
        return segments[detailIndex + 1];
    }
    
    console.warn('URL에서 리뷰 ID를 찾을 수 없습니다:', path);
    return null;
}

/**
 * 이벤트 리스너 초기화
 */
function initializeEventListeners() {
    // data-action 속성을 가진 모든 버튼에 이벤트 리스너 추가
    const actionButtons = document.querySelectorAll('[data-action]');
    
    actionButtons.forEach(button => {
        const action = button.getAttribute('data-action');
        console.log('이벤트 리스너 등록:', action);
        
        switch(action) {
            case 'likeReview':
                button.addEventListener('click', handleLikeReview);
                break;
            case 'deleteReview':
                button.addEventListener('click', handleDeleteReview);
                break;
            case 'shareReview':
                button.addEventListener('click', handleShareReview);
                break;
            case 'reportReview':
                button.addEventListener('click', handleReportReview);
                break;
            default:
                console.warn('알 수 없는 액션:', action);
        }
    });
    
    console.log('이벤트 리스너 초기화 완료, 등록된 버튼 수:', actionButtons.length);
}

/**
 * 이미지 모달 초기화
 */
function initializeImageModal() {
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const reviewImages = document.querySelectorAll('.review-image');
    const closeBtn = document.querySelector('.close-modal');
    
    if (!modal || !modalImage) {
        console.log('이미지 모달 요소를 찾을 수 없음');
        return;
    }
    
    // 리뷰 이미지 클릭 이벤트
    reviewImages.forEach(img => {
        img.style.cursor = 'pointer';
        img.addEventListener('click', function() {
            modal.style.display = 'block';
            modalImage.src = this.src;
            modalImage.alt = this.alt || '리뷰 이미지';
        });
    });
    
    // 모달 닫기 버튼
    if (closeBtn) {
        closeBtn.addEventListener('click', function() {
            modal.style.display = 'none';
        });
    }
    
    // 모달 배경 클릭 시 닫기
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });
    
    // ESC 키로 모달 닫기
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.style.display === 'block') {
            modal.style.display = 'none';
        }
    });
    
    console.log('이미지 모달 초기화 완료, 이미지 수:', reviewImages.length);
}

/**
 * 리뷰 추천 처리
 */
function handleLikeReview(event) {
    event.preventDefault();
    event.stopPropagation();
    
    if (!currentReviewId) {
        showAlert('error', '리뷰 정보를 찾을 수 없습니다.');
        return;
    }
    
    console.log('추천 요청 시작:', currentReviewId);
    
    // 버튼 비활성화
    const button = event.target.closest('button');
    const originalHtml = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>처리 중...';
    button.disabled = true;
    
    fetch(`/review/like/${currentReviewId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => {
        console.log('추천 응답:', response.status);
        return response.json();
    })
    .then(data => {
        console.log('추천 응답 데이터:', data);
        if (data.success) {
            // 추천 수 업데이트
            const likeCountElement = document.getElementById('likeCount');
            if (likeCountElement) {
                likeCountElement.textContent = data.likeCount || 0;
            }
            
            showAlert('success', data.message || '추천하였습니다.');
        } else {
            showAlert('error', data.message || '추천 처리 중 오류가 발생했습니다.');
        }
    })
    .catch(error => {
        console.error('추천 처리 오류:', error);
        showAlert('error', '추천 처리 중 오류가 발생했습니다.');
    })
    .finally(() => {
        // 버튼 상태 복원
        button.innerHTML = originalHtml;
        button.disabled = false;
    });
}

/**
 * 리뷰 삭제 처리
 */
function handleDeleteReview(event) {
    event.preventDefault();
    event.stopPropagation();
    
    if (!currentReviewId) {
        showAlert('error', '리뷰 정보를 찾을 수 없습니다.');
        return;
    }
    
    if (!confirm('정말 이 리뷰를 삭제하시겠습니까?\n삭제된 리뷰는 복구할 수 없습니다.')) {
        return;
    }
    
    console.log('삭제 요청 시작:', currentReviewId);
    
    // 삭제 버튼 비활성화 및 로딩 상태 표시
    const button = event.target.closest('button');
    const originalHtml = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>삭제 중...';
    button.disabled = true;
    
    fetch(`/review/delete/${currentReviewId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => {
        console.log('삭제 응답:', response.status);
        if (response.ok) {
            showAlert('success', '리뷰가 성공적으로 삭제되었습니다.');
            // 2초 후 목록 페이지로 이동
            setTimeout(() => {
                window.location.href = '/review';
            }, 2000);
        } else if (response.redirected) {
            // 리다이렉트된 경우
            window.location.href = response.url;
        } else {
            throw new Error('삭제 요청이 실패했습니다.');
        }
    })
    .catch(error => {
        console.error('삭제 처리 오류:', error);
        showAlert('error', '리뷰 삭제 중 오류가 발생했습니다.');
        
        // 버튼 상태 복원
        button.innerHTML = originalHtml;
        button.disabled = false;
    });
}

/**
 * 리뷰 공유 처리
 */
function handleShareReview(event) {
    event.preventDefault();
    event.stopPropagation();
    
    const currentUrl = window.location.href;
    const reviewTitle = document.querySelector('h1, .card-title')?.textContent || '리뷰';
    
    console.log('공유 요청:', { url: currentUrl, title: reviewTitle });
    
    // Web Share API 지원 확인
    if (navigator.share) {
        navigator.share({
            title: reviewTitle,
            text: '이 리뷰를 확인해보세요!',
            url: currentUrl
        }).then(() => {
            console.log('공유 성공');
            showAlert('success', '공유가 완료되었습니다.');
        }).catch(error => {
            console.log('공유 취소 또는 실패:', error);
            // 공유 취소는 에러가 아니므로 메시지 표시하지 않음
        });
    } else {
        // 클립보드에 URL 복사
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(currentUrl).then(() => {
                showAlert('success', '링크가 클립보드에 복사되었습니다.');
            }).catch(error => {
                console.error('클립보드 복사 실패:', error);
                fallbackCopyToClipboard(currentUrl);
            });
        } else {
            fallbackCopyToClipboard(currentUrl);
        }
    }
}

/**
 * 클립보드 복사 대체 방법
 */
function fallbackCopyToClipboard(text) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    textArea.style.top = '-999999px';
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        const successful = document.execCommand('copy');
        if (successful) {
            showAlert('success', '링크가 복사되었습니다.');
        } else {
            showAlert('error', '링크 복사에 실패했습니다.');
        }
    } catch (err) {
        console.error('클립보드 복사 실패:', err);
        showAlert('error', '링크 복사에 실패했습니다.');
    }
    
    document.body.removeChild(textArea);
}

/**
 * 리뷰 신고 처리
 */
function handleReportReview(event) {
    event.preventDefault();
    event.stopPropagation();
    
    if (!currentReviewId) {
        showAlert('error', '리뷰 정보를 찾을 수 없습니다.');
        return;
    }
    
    const reportReason = prompt(
        '신고 사유를 입력해주세요:\n\n' +
        '• 부적절한 내용\n' +
        '• 허위정보\n' +
        '• 스팸/광고\n' +
        '• 기타'
    );
    
    if (!reportReason || reportReason.trim() === '') {
        return; // 사용자가 취소하거나 빈 내용
    }
    
    if (!confirm('이 리뷰를 신고하시겠습니까?')) {
        return;
    }
    
    console.log('신고 요청:', { reviewId: currentReviewId, reason: reportReason });
    
    // 버튼 비활성화
    const button = event.target.closest('button');
    const originalHtml = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>신고 중...';
    button.disabled = true;
    
    fetch(`/review/report/${currentReviewId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            reason: reportReason.trim()
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log('신고 응답:', data);
        if (data.success) {
            showAlert('success', data.message || '신고가 접수되었습니다. 검토 후 적절한 조치를 취하겠습니다.');
        } else {
            showAlert('error', data.message || '신고 처리 중 오류가 발생했습니다.');
        }
    })
    .catch(error => {
        console.error('신고 처리 오류:', error);
        showAlert('error', '신고 처리 중 오류가 발생했습니다.');
    })
    .finally(() => {
        // 버튼 상태 복원
        button.innerHTML = originalHtml;
        button.disabled = false;
    });
}

/**
 * 알림 메시지 표시
 */
function showAlert(type, message) {
    // 기존 알림 제거
    const existingAlert = document.querySelector('.dynamic-alert');
    if (existingAlert) {
        existingAlert.remove();
    }
    
    // 새 알림 생성
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show dynamic-alert`;
    alertDiv.style.position = 'fixed';
    alertDiv.style.top = '80px';
    alertDiv.style.left = '50%';
    alertDiv.style.transform = 'translateX(-50%)';
    alertDiv.style.zIndex = '9999';
    alertDiv.style.minWidth = '300px';
    alertDiv.style.maxWidth = '500px';
    
    alertDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    // 5초 후 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
    
    console.log('알림 표시:', type, message);
}

// 전역 함수로 노출 (혹시 다른 곳에서 호출하는 경우를 위해)
window.likeReview = handleLikeReview;
window.deleteReview = handleDeleteReview;
window.shareReview = handleShareReview;
window.reportReview = handleReportReview;
````

## File: src/main/resources/static/js/review-write.js
````javascript
// 리뷰 작성 페이지 JavaScript
// 팀원 D 담당 - 완전히 분리된 JavaScript 파일

document.addEventListener('DOMContentLoaded', function() {
    // 상수 정의
    const RATING_TEXTS = ['', '매우 불만족', '불만족', '보통', '만족', '매우 만족'];
    const MIN_CONTENT_LENGTH = 10;
    const MAX_CONTENT_LENGTH = 2000;

    // DOM 요소 선택
    const elements = {
        form: document.getElementById('reviewForm'),
        facilitySelect: document.getElementById('facilitySelect'),
        facilityId: document.getElementById('facilityId'),
        title: document.getElementById('title'),
        content: document.getElementById('content'),
        contentLength: document.getElementById('contentLength'),
        overallRating: document.getElementById('overallRating'),
        ratingValue: document.getElementById('ratingValue'),
        ratingText: document.getElementById('ratingText'),
        submitButton: document.getElementById('submitButton'),
        detailedRatings: document.querySelectorAll('.detailed-rating')
    };

    // 디버깅: DOM 요소 확인
    console.log('별점 관련 DOM 요소:', {
        overallRating: elements.overallRating,
        ratingValue: elements.ratingValue,
        ratingText: elements.ratingText,
        detailedRatings: elements.detailedRatings,
        detailedRatingsCount: elements.detailedRatings.length
    });

    // 세부 평점 컨테이너 확인
    elements.detailedRatings.forEach((container, index) => {
        console.log(`세부 평점 컨테이너 ${index + 1}:`, {
            container: container,
            field: container.dataset.field,
            stars: container.querySelectorAll('.star').length,
            ratingGroup: container.closest('.rating-group'),
            inputElement: container.closest('.rating-group')?.querySelector('.detailed-rating-input')
        });
    });

    // 별점 UI 업데이트 함수
    function updateStars(container, rating) {
        if (!container) {
            console.warn('별점 컨테이너가 없습니다.');
            return;
        }

        console.log('별점 업데이트:', { container, rating });
        const stars = container.querySelectorAll('.star');
        stars.forEach((star, index) => {
            if (index < rating) {
                star.classList.add('active');
            } else {
                star.classList.remove('active');
            }
        });
    }

    // 시설 선택 이벤트 핸들러
    if (elements.facilitySelect) {
        elements.facilitySelect.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const facilityId = this.value;
            const status = selectedOption.dataset.status;

            console.log('시설 선택:', { facilityId, status });

            // 시설 ID 설정
            if (elements.facilityId) {
                elements.facilityId.value = facilityId;
            }

            // 시설 상태에 따른 처리
            if (facilityId && status !== '정상') {
                alert('선택할 수 없는 시설입니다: ' + status);
                this.value = '';
                if (elements.facilityId) {
                    elements.facilityId.value = '';
                }
            }
        });
    }

    // 내용 길이 체크 및 표시
    if (elements.content && elements.contentLength) {
        elements.content.addEventListener('input', function() {
            const length = this.value.trim().length;
            elements.contentLength.textContent = length;

            // 길이 유효성 표시
            if (length < MIN_CONTENT_LENGTH) {
                elements.contentLength.classList.remove('text-success');
                elements.contentLength.classList.add('text-danger');
            } else if (length > MAX_CONTENT_LENGTH) {
                elements.contentLength.classList.remove('text-success');
                elements.contentLength.classList.add('text-danger');
            } else {
                elements.contentLength.classList.remove('text-danger');
                elements.contentLength.classList.add('text-success');
            }
        });

        // 초기 내용 길이 표시
        elements.content.dispatchEvent(new Event('input'));
    }

    // 전체 평점 이벤트 핸들러
    if (elements.overallRating) {
        const stars = elements.overallRating.querySelectorAll('.star');
        
        // 별점 클릭 이벤트
        stars.forEach(star => {
            star.addEventListener('click', function() {
                const rating = parseInt(this.dataset.rating);
                console.log('전체 평점 클릭:', { rating, target: this });

                // hidden input 업데이트
                elements.ratingValue.value = rating;
                
                // UI 업데이트
                updateStars(elements.overallRating, rating);
                elements.ratingText.textContent = RATING_TEXTS[rating];

                console.log('전체 평점 업데이트 완료:', {
                    rating,
                    text: RATING_TEXTS[rating],
                    inputValue: elements.ratingValue.value
                });
            });

            // 마우스 오버 이벤트
            star.addEventListener('mouseover', function() {
                const rating = parseInt(this.dataset.rating);
                updateStars(elements.overallRating, rating);
                elements.ratingText.textContent = RATING_TEXTS[rating];
            });

            // 마우스 아웃 이벤트
            star.addEventListener('mouseout', function() {
                const rating = parseInt(elements.ratingValue.value) || 0;
                updateStars(elements.overallRating, rating);
                elements.ratingText.textContent = rating ? RATING_TEXTS[rating] : '평점을 선택해주세요';
            });
        });

        // 초기 평점이 있는 경우 UI 업데이트
        const initialRating = parseInt(elements.ratingValue.value);
        if (!isNaN(initialRating) && initialRating >= 1 && initialRating <= 5) {
            console.log('초기 평점 설정:', initialRating);
            updateStars(elements.overallRating, initialRating);
            elements.ratingText.textContent = RATING_TEXTS[initialRating];
        }
    }

    // 세부 평점 이벤트 핸들러
    elements.detailedRatings.forEach(container => {
        const stars = container.querySelectorAll('.star');
        // rating-group에서 input 찾기 (HTML 구조: rating-group > d-flex > detailed-rating)
        const ratingGroup = container.closest('.rating-group');
        const input = ratingGroup ? ratingGroup.querySelector('.detailed-rating-input') : null;
        
        console.log('세부 평점 초기화:', {
            container: container,
            field: container.dataset.field,
            ratingGroup: ratingGroup,
            input: input,
            stars: stars.length
        });
        
        stars.forEach(star => {
            // 클릭 이벤트
            star.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const rating = parseInt(this.dataset.rating);
                console.log('세부 평점 클릭:', {
                    rating,
                    field: container.dataset.field,
                    target: this,
                    input: input
                });

                // hidden input 업데이트
                if (input) {
                    input.value = rating;
                    console.log('세부 평점 입력값 업데이트:', {
                        field: container.dataset.field,
                        rating,
                        inputValue: input.value,
                        inputName: input.name
                    });
                } else {
                    console.error('세부 평점 input을 찾을 수 없습니다:', container.dataset.field);
                }
                
                // UI 업데이트
                updateStars(container, rating);
            });

            // 마우스 오버 이벤트
            star.addEventListener('mouseover', function() {
                const rating = parseInt(this.dataset.rating);
                updateStars(container, rating);
            });

            // 마우스 아웃 이벤트
            star.addEventListener('mouseout', function() {
                const rating = parseInt(input?.value) || 0;
                updateStars(container, rating);
            });
        });

        // 초기 세부 평점이 있는 경우 UI 업데이트
        if (input && input.value) {
            const initialRating = parseInt(input.value);
            if (!isNaN(initialRating) && initialRating >= 1 && initialRating <= 5) {
                console.log('초기 세부 평점 설정:', {
                    field: container.dataset.field,
                    rating: initialRating
                });
                updateStars(container, initialRating);
            }
        }
    });

    // 폼 제출 전 검증
    if (elements.form) {
        elements.form.addEventListener('submit', function(e) {
            e.preventDefault();

            // 시설 선택 검증
            if (!elements.facilityId.value) {
                alert('시설을 선택해주세요.');
                if (elements.facilitySelect) {
                    elements.facilitySelect.focus();
                }
                return;
            }

            // 제목 검증
            if (!elements.title.value.trim()) {
                alert('제목을 입력해주세요.');
                elements.title.focus();
                return;
            }

            // 전체 평점 검증
            if (!elements.ratingValue.value) {
                alert('전체 평점을 선택해주세요.');
                elements.overallRating.scrollIntoView({ behavior: 'smooth' });
                return;
            }

            // 내용 길이 검증
            const contentLength = elements.content.value.trim().length;
            if (contentLength < MIN_CONTENT_LENGTH) {
                alert(`내용을 ${MIN_CONTENT_LENGTH}자 이상 입력해주세요.`);
                elements.content.focus();
                return;
            }

            if (contentLength > MAX_CONTENT_LENGTH) {
                alert(`내용은 ${MAX_CONTENT_LENGTH}자를 초과할 수 없습니다.`);
                elements.content.focus();
                return;
            }

            // 모든 검증 통과 시 폼 제출
            this.submit();
        });
    }
});
````

## File: src/main/resources/static/js/rich-text-editor-v2.js
````javascript
/**
 * 라이트케어 전용 리치 텍스트 에디터 v2.0
 * 보안 강화 및 성능 최적화 버전
 * - 이미지 업로드 기능 제거로 보안 강화
 * - 간소화된 툴바로 사용성 개선
 * - 메모리 사용량 최적화
 */
class RichTextEditorV2 {
    constructor(selector, options = {}) {
        this.element = document.querySelector(selector);
        if (!this.element) {
            console.error('RichTextEditorV2: Element not found:', selector);
            return;
        }

        // 기본 옵션 설정
        this.options = {
            height: options.height || '300px',
            placeholder: options.placeholder || '내용을 입력하세요...',
            enableTable: options.enableTable !== false,
            enableLink: options.enableLink !== false,
            maxLength: options.maxLength || 10000,
            // 이미지 업로드 기능 완전 제거
            enableImage: false,
            // 보안상 위험한 기능들 제거
            enableSourceCode: false,
            enableFullscreen: false,
            // 단순화된 툴바
            toolbar: options.toolbar || [
                'bold', 'italic', 'underline',
                '|',
                'fontSize', 'color',
                '|',
                'alignLeft', 'alignCenter', 'alignRight',
                '|',
                'orderedList', 'unorderedList',
                '|',
                'link', 'table',
                '|',
                'blockquote',
                '|',
                'undo', 'redo'
            ],
            ...options
        };

        this.init();
    }

    init() {
        this.createEditor();
        this.bindEvents();
        this.initializeContent();
        this.setupAccessibility();
    }

    createEditor() {
        // 기존 textarea 숨기기
        this.element.style.display = 'none';

        // 에디터 컨테이너 생성
        this.container = document.createElement('div');
        this.container.className = 'rich-text-editor-v2';
        this.container.setAttribute('role', 'textbox');
        this.container.setAttribute('aria-label', '리치 텍스트 에디터');
        
        this.container.innerHTML = `
            <div class="rte-toolbar" role="toolbar" aria-label="편집 도구">
                ${this.generateToolbar()}
            </div>
            <div class="rte-content" 
                 contenteditable="true" 
                 style="height: ${this.options.height}"
                 role="textbox"
                 aria-multiline="true"
                 aria-label="텍스트 입력 영역">
                ${this.options.placeholder ? `<p class="rte-placeholder">${this.options.placeholder}</p>` : ''}
            </div>
            <div class="rte-statusbar">
                <span class="rte-char-count">글자 수: 0 / ${this.options.maxLength}</span>
                <span class="rte-word-count">단어 수: 0</span>
            </div>
        `;

        // textarea 다음에 에디터 삽입
        this.element.parentNode.insertBefore(this.container, this.element.nextSibling);

        // 에디터 요소들 참조 저장
        this.toolbar = this.container.querySelector('.rte-toolbar');
        this.content = this.container.querySelector('.rte-content');
        this.statusbar = this.container.querySelector('.rte-statusbar');
    }

    generateToolbar() {
        const toolbarGroups = [];
        let currentGroup = [];

        this.options.toolbar.forEach(tool => {
            if (tool === '|') {
                if (currentGroup.length > 0) {
                    toolbarGroups.push(currentGroup);
                    currentGroup = [];
                }
            } else {
                currentGroup.push(tool);
            }
        });

        if (currentGroup.length > 0) {
            toolbarGroups.push(currentGroup);
        }

        return toolbarGroups.map(group => 
            `<div class="rte-toolbar-group">
                ${group.map(tool => this.generateToolButton(tool)).join('')}
            </div>`
        ).join('');
    }

    generateToolButton(tool) {
        const buttons = {
            'bold': '<button type="button" class="rte-btn" data-command="bold" title="굵게 (Ctrl+B)" aria-label="굵게"><i class="fas fa-bold"></i></button>',
            'italic': '<button type="button" class="rte-btn" data-command="italic" title="기울임 (Ctrl+I)" aria-label="기울임"><i class="fas fa-italic"></i></button>',
            'underline': '<button type="button" class="rte-btn" data-command="underline" title="밑줄 (Ctrl+U)" aria-label="밑줄"><i class="fas fa-underline"></i></button>',
            
            'fontSize': `<select class="rte-select" data-command="fontSize" title="글자 크기" aria-label="글자 크기">
                <option value="">크기</option>
                <option value="1">매우 작게</option>
                <option value="2">작게</option>
                <option value="3">보통</option>
                <option value="4">크게</option>
                <option value="5">매우 크게</option>
            </select>`,
            
            'color': '<input type="color" class="rte-color" data-command="foreColor" title="글자 색상" aria-label="글자 색상" value="#000000">',
            
            'alignLeft': '<button type="button" class="rte-btn" data-command="justifyLeft" title="왼쪽 정렬" aria-label="왼쪽 정렬"><i class="fas fa-align-left"></i></button>',
            'alignCenter': '<button type="button" class="rte-btn" data-command="justifyCenter" title="가운데 정렬" aria-label="가운데 정렬"><i class="fas fa-align-center"></i></button>',
            'alignRight': '<button type="button" class="rte-btn" data-command="justifyRight" title="오른쪽 정렬" aria-label="오른쪽 정렬"><i class="fas fa-align-right"></i></button>',
            
            'orderedList': '<button type="button" class="rte-btn" data-command="insertOrderedList" title="번호 목록" aria-label="번호 목록"><i class="fas fa-list-ol"></i></button>',
            'unorderedList': '<button type="button" class="rte-btn" data-command="insertUnorderedList" title="글머리 목록" aria-label="글머리 목록"><i class="fas fa-list-ul"></i></button>',
            
            'link': '<button type="button" class="rte-btn" data-command="createLink" title="링크 삽입" aria-label="링크 삽입"><i class="fas fa-link"></i></button>',
            'table': '<button type="button" class="rte-btn" data-command="insertTable" title="테이블 삽입" aria-label="테이블 삽입"><i class="fas fa-table"></i></button>',
            
            'blockquote': '<button type="button" class="rte-btn" data-command="blockquote" title="인용문" aria-label="인용문"><i class="fas fa-quote-left"></i></button>',
            
            'undo': '<button type="button" class="rte-btn" data-command="undo" title="실행 취소 (Ctrl+Z)" aria-label="실행 취소"><i class="fas fa-undo"></i></button>',
            'redo': '<button type="button" class="rte-btn" data-command="redo" title="다시 실행 (Ctrl+Y)" aria-label="다시 실행"><i class="fas fa-redo"></i></button>'
        };

        return buttons[tool] || '';
    }

    bindEvents() {
        // 툴바 버튼 클릭 이벤트
        this.toolbar.addEventListener('click', (e) => {
            const button = e.target.closest('.rte-btn');
            if (button) {
                e.preventDefault();
                this.executeCommand(button.dataset.command);
            }
        });

        // 셀렉트 박스 변경 이벤트
        this.toolbar.addEventListener('change', (e) => {
            if (e.target.classList.contains('rte-select')) {
                this.executeCommand(e.target.dataset.command, e.target.value);
            }
        });

        // 색상 선택 이벤트
        this.toolbar.addEventListener('input', (e) => {
            if (e.target.classList.contains('rte-color')) {
                this.executeCommand(e.target.dataset.command, e.target.value);
            }
        });

        // 에디터 내용 변경 이벤트
        this.content.addEventListener('input', () => {
            this.updateOriginalTextarea();
            this.updateStatusBar();
            this.handlePlaceholder();
            this.validateLength();
        });

        // 에디터 포커스 이벤트
        this.content.addEventListener('focus', () => {
            this.handlePlaceholder();
        });

        // 에디터 블러 이벤트
        this.content.addEventListener('blur', () => {
            this.handlePlaceholder();
        });

        // 키보드 단축키
        this.content.addEventListener('keydown', (e) => {
            this.handleKeyboardShortcuts(e);
        });

        // 붙여넣기 이벤트 - 보안 강화
        this.content.addEventListener('paste', (e) => {
            this.handlePaste(e);
        });
    }

    executeCommand(command, value = null) {
        this.content.focus();

        switch (command) {
            case 'createLink':
                this.insertLink();
                break;
            case 'insertTable':
                this.insertTable();
                break;
            case 'blockquote':
                this.insertBlockquote();
                break;
            case 'fontSize':
                if (value) {
                    document.execCommand('fontSize', false, value);
                }
                break;
            case 'foreColor':
                document.execCommand(command, false, value);
                break;
            default:
                document.execCommand(command, false, value);
        }

        this.updateOriginalTextarea();
    }

    insertLink() {
        const selection = window.getSelection();
        const selectedText = selection.toString().trim();
        
        // URL 입력 다이얼로그
        const url = prompt('링크 URL을 입력하세요:', 'https://');
        if (!url || url === 'https://') return;

        // URL 검증 (보안 강화)
        if (!this.isValidUrl(url)) {
            alert('올바른 URL 형식이 아닙니다.');
            return;
        }
        
        const linkText = selectedText || prompt('링크 텍스트를 입력하세요:', url);
        if (linkText) {
            // XSS 방지를 위한 속성값 정리 (HTML 인코딩하지 않고 직접 생성)
            const cleanUrl = url.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
            const cleanText = linkText.replace(/</g, '&lt;').replace(/>/g, '&gt;');
            const link = `<a href="${cleanUrl}" target="_blank" rel="noopener noreferrer" style="color: #0066cc; text-decoration: underline;">${cleanText}</a>`;
            this.insertHTML(link);
        }
    }

    insertTable() {
        const rows = prompt('행 수를 입력하세요:', '3');
        const cols = prompt('열 수를 입력하세요:', '3');
        
        if (rows && cols && !isNaN(rows) && !isNaN(cols)) {
            const numRows = Math.min(parseInt(rows), 20); // 최대 20행으로 제한
            const numCols = Math.min(parseInt(cols), 10); // 최대 10열로 제한
            
            let table = '<table class="rte-table table table-bordered"><tbody>';
            
            for (let i = 0; i < numRows; i++) {
                table += '<tr>';
                for (let j = 0; j < numCols; j++) {
                    table += '<td>&nbsp;</td>';
                }
                table += '</tr>';
            }
            
            table += '</tbody></table><p>&nbsp;</p>';
            this.insertHTML(table);
        }
    }

    insertBlockquote() {
        const selection = window.getSelection();
        const selectedText = selection.toString().trim();
        
        if (selectedText) {
            const safeText = this.escapeHtml(selectedText);
            const blockquote = `<blockquote class="blockquote">${safeText}</blockquote>`;
            this.insertHTML(blockquote);
        } else {
            const blockquote = '<blockquote class="blockquote">인용문을 입력하세요...</blockquote>';
            this.insertHTML(blockquote);
        }
    }

    insertHTML(html) {
        if (document.queryCommandSupported('insertHTML')) {
            document.execCommand('insertHTML', false, html);
        } else {
            // IE 호환성을 위한 대안
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                range.deleteContents();
                const div = document.createElement('div');
                div.innerHTML = html;
                const frag = document.createDocumentFragment();
                while (div.firstChild) {
                    frag.appendChild(div.firstChild);
                }
                range.insertNode(frag);
            }
        }
    }

    handleKeyboardShortcuts(e) {
        if (e.ctrlKey || e.metaKey) {
            switch (e.key.toLowerCase()) {
                case 'b':
                    e.preventDefault();
                    this.executeCommand('bold');
                    break;
                case 'i':
                    e.preventDefault();
                    this.executeCommand('italic');
                    break;
                case 'u':
                    e.preventDefault();
                    this.executeCommand('underline');
                    break;
                case 'z':
                    if (e.shiftKey) {
                        e.preventDefault();
                        this.executeCommand('redo');
                    } else {
                        e.preventDefault();
                        this.executeCommand('undo');
                    }
                    break;
                case 'y':
                    e.preventDefault();
                    this.executeCommand('redo');
                    break;
            }
        }
    }

    handlePaste(e) {
        e.preventDefault();
        
        const clipboardData = e.clipboardData || window.clipboardData;
        const pastedData = clipboardData.getData('text/plain');
        
        // 텍스트만 허용하고 HTML 태그 제거 (보안 강화)
        const cleanText = this.stripHtml(pastedData);
        const safeText = this.escapeHtml(cleanText);
        
        this.insertHTML(safeText);
    }

    updateOriginalTextarea() {
        // HTML 내용을 원본 textarea에 업데이트
        let content = this.content.innerHTML;
        
        // 플레이스홀더 제거
        if (content === `<p class="rte-placeholder">${this.options.placeholder}</p>`) {
            content = '';
        }
        
        this.element.value = content;
        
        // change 이벤트 발생
        const event = new Event('change', { bubbles: true });
        this.element.dispatchEvent(event);
    }

    updateStatusBar() {
        const text = this.content.textContent || this.content.innerText || '';
        const charCount = text.length;
        const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
        
        const charCountElement = this.statusbar.querySelector('.rte-char-count');
        const wordCountElement = this.statusbar.querySelector('.rte-word-count');
        
        if (charCountElement) {
            charCountElement.textContent = `글자 수: ${charCount} / ${this.options.maxLength}`;
            
            // 글자 수 초과 시 경고 표시
            if (charCount > this.options.maxLength) {
                charCountElement.classList.add('text-danger');
            } else {
                charCountElement.classList.remove('text-danger');
            }
        }
        
        if (wordCountElement) {
            wordCountElement.textContent = `단어 수: ${wordCount}`;
        }
    }

    handlePlaceholder() {
        const text = this.content.textContent || this.content.innerText || '';
        const hasPlaceholder = this.content.querySelector('.rte-placeholder');
        
        if (text.trim() === '' && !hasPlaceholder) {
            this.content.innerHTML = `<p class="rte-placeholder">${this.options.placeholder}</p>`;
        } else if (text.trim() !== '' && hasPlaceholder) {
            hasPlaceholder.remove();
        }
    }

    validateLength() {
        const text = this.content.textContent || this.content.innerText || '';
        
        if (text.length > this.options.maxLength) {
            // 글자 수 초과 시 내용 자르기
            const truncatedText = text.substring(0, this.options.maxLength);
            this.content.textContent = truncatedText;
            
            // 커서를 마지막으로 이동
            const range = document.createRange();
            const selection = window.getSelection();
            range.selectNodeContents(this.content);
            range.collapse(false);
            selection.removeAllRanges();
            selection.addRange(range);
            
            // 경고 메시지 표시
            this.showWarning(`최대 ${this.options.maxLength}자까지 입력 가능합니다.`);
        }
    }

    setupAccessibility() {
        // 에디터에 ARIA 속성 추가
        this.content.setAttribute('aria-label', '리치 텍스트 에디터 내용 영역');
        this.content.setAttribute('aria-describedby', 'rte-help-text');
        
        // 도움말 텍스트 추가
        const helpText = document.createElement('div');
        helpText.id = 'rte-help-text';
        helpText.className = 'sr-only';
        helpText.textContent = '리치 텍스트 에디터입니다. 텍스트 서식을 지정할 수 있습니다.';
        this.container.appendChild(helpText);
    }

    initializeContent() {
        if (this.element.value) {
            // 기존 값이 있으면 에디터에 설정
            const safeContent = this.sanitizeContent(this.element.value);
            this.content.innerHTML = safeContent;
        }
        
        this.handlePlaceholder();
        this.updateStatusBar();
    }

    // 보안 관련 유틸리티 메서드들
    isValidUrl(url) {
        try {
            const urlObject = new URL(url);
            return ['http:', 'https:', 'mailto:'].includes(urlObject.protocol);
        } catch {
            return false;
        }
    }

    escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    stripHtml(html) {
        const div = document.createElement('div');
        div.innerHTML = html;
        return div.textContent || div.innerText || '';
    }

    sanitizeContent(content) {
        // 허용된 태그만 남기고 나머지 제거
        const allowedTags = ['p', 'br', 'strong', 'b', 'em', 'i', 'u', 'ol', 'ul', 'li', 'blockquote', 'table', 'tr', 'td', 'th', 'thead', 'tbody', 'a'];
        const div = document.createElement('div');
        div.innerHTML = content;
        
        // 허용되지 않은 태그 제거
        const allElements = div.querySelectorAll('*');
        allElements.forEach(el => {
            if (!allowedTags.includes(el.tagName.toLowerCase())) {
                el.remove();
            } else if (el.tagName.toLowerCase() === 'a') {
                // 링크 태그의 보안 속성 확인
                const href = el.getAttribute('href');
                if (href && !this.isValidUrl(href)) {
                    el.remove();
                    return;
                }
                // 안전한 링크 속성 설정
                el.setAttribute('target', '_blank');
                el.setAttribute('rel', 'noopener noreferrer');
            }
        });
        
        return div.innerHTML;
    }

    showWarning(message) {
        // 간단한 경고 메시지 표시
        const warning = document.createElement('div');
        warning.className = 'rte-warning alert alert-warning alert-dismissible fade show';
        warning.style.position = 'fixed';
        warning.style.top = '20px';
        warning.style.right = '20px';
        warning.style.zIndex = '9999';
        warning.style.maxWidth = '300px';
        warning.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(warning);
        
        // 3초 후 자동 제거
        setTimeout(() => {
            if (warning.parentNode) {
                warning.remove();
            }
        }, 3000);
    }

    // 공개 API 메서드들
    getContent() {
        return this.content.innerHTML;
    }

    setContent(html) {
        const safeContent = this.sanitizeContent(html);
        this.content.innerHTML = safeContent;
        this.updateOriginalTextarea();
        this.updateStatusBar();
        this.handlePlaceholder();
    }

    getTextContent() {
        return this.content.textContent || this.content.innerText || '';
    }

    focus() {
        this.content.focus();
    }

    destroy() {
        if (this.container) {
            this.container.remove();
        }
        this.element.style.display = '';
    }
}

// 전역 사용을 위한 함수
window.RichTextEditorV2 = RichTextEditorV2;

// 자동 초기화 (data-rich-editor 속성이 있는 textarea들에 대해)
document.addEventListener('DOMContentLoaded', () => {
    const textareas = document.querySelectorAll('textarea[data-rich-editor]');
    textareas.forEach(textarea => {
        try {
            const options = textarea.dataset.richEditor ? JSON.parse(textarea.dataset.richEditor) : {};
            
            // 이미지 업로드 기능 강제 비활성화
            options.enableImage = false;
            
            // 최대 길이 설정
            if (textarea.maxLength > 0) {
                options.maxLength = textarea.maxLength;
            }
            
            new RichTextEditorV2(`#${textarea.id}`, options);
        } catch (error) {
            console.error('RichTextEditorV2 초기화 실패:', error);
            // 실패 시 기본 textarea 사용
        }
    });
});

console.log('✅ RichTextEditorV2 로드 완료 - 보안 강화 버전');
````

## File: src/main/resources/static/js/smart-scroll-utility.js
````javascript
/**
 * 스마트 스크롤 유틸리티
 * 프로필 이미지, 시설 이미지 크롭퍼에서 공통으로 사용
 * 이미지 확대/축소 한계점에서 자동으로 페이지 스크롤로 전환
 */

if (typeof SmartScrollUtility === 'undefined') {
    class SmartScrollUtility {
    constructor(cropper, options = {}) {
        this.cropper = cropper;
        this.options = {
            minZoom: 0.1,      // 최소 줌 (10%)
            maxZoom: 3.0,      // 최대 줌 (300%)
            maxThreshold: 2.8, // 최대 확대 임계값
            minThreshold: 0.2, // 최소 축소 임계값
            scrollMultiplier: 0.5, // 페이지 스크롤 강도
            zoomStep: 0.1,     // 줌 단계
            indicatorTimeout: 3000, // 줌 표시기 자동 숨김 시간
            ...options
        };
        
        this.zoomIndicatorTimeout = null;
        this.container = null;
        this.elements = {
            zoomIndicator: null,
            zoomLevel: null,
            zoomStatus: null
        };
        
        this.init();
    }
    
    /**
     * 초기화
     */
    init() {
        if (!this.cropper) {
            console.error('❌ SmartScrollUtility: cropper 객체가 필요합니다.');
            return;
        }
        
        this.findContainer();
        this.findZoomElements();
        this.setupEventListener();
        
        console.log('🖱️ SmartScrollUtility 초기화 완료');
        console.log('📊 설정:', this.options);
    }
    
    /**
     * 크롭 컨테이너 찾기
     */
    findContainer() {
        // 다양한 컨테이너 선택자 시도
        const selectors = [
            '.crop-image-container',  // 시설 이미지
            '.crop-container img',    // 프로필 이미지
            '.cropper-container',     // Cropper.js 기본
            '#cropImage'              // ID 직접 선택
        ];
        
        for (const selector of selectors) {
            const element = document.querySelector(selector);
            if (element) {
                this.container = element.closest('.crop-image-container') || 
                               element.parentElement || 
                               element;
                break;
            }
        }
        
        if (!this.container) {
            console.warn('⚠️ SmartScrollUtility: 크롭 컨테이너를 찾을 수 없습니다.');
        }
    }
    
    /**
     * 줌 표시기 요소 찾기
     */
    findZoomElements() {
        this.elements.zoomIndicator = document.getElementById('zoomIndicator');
        this.elements.zoomLevel = document.getElementById('zoomLevel');
        this.elements.zoomStatus = document.getElementById('zoomStatus');
        
        if (!this.elements.zoomIndicator) {
            console.log('💡 SmartScrollUtility: 줌 표시기가 없어 동적으로 생성합니다.');
            this.createZoomIndicator();
        }
    }
    
    /**
     * 동적으로 줌 표시기 생성
     */
    createZoomIndicator() {
        const indicator = document.createElement('div');
        indicator.id = 'zoomIndicator';
        indicator.className = 'zoom-indicator position-fixed';
        indicator.style.cssText = `
            top: 20px; 
            right: 20px; 
            z-index: 1000; 
            background: rgba(0,0,0,0.8); 
            color: white; 
            padding: 8px 12px; 
            border-radius: 6px; 
            font-size: 12px;
            display: none;
        `;
        
        indicator.innerHTML = `
            <i class="fas fa-search me-1"></i>
            <span id="zoomLevel">100%</span>
            <span id="zoomStatus" class="ms-2"></span>
        `;
        
        document.body.appendChild(indicator);
        
        // 요소 재할당
        this.elements.zoomIndicator = indicator;
        this.elements.zoomLevel = document.getElementById('zoomLevel');
        this.elements.zoomStatus = document.getElementById('zoomStatus');
        
        console.log('✅ 줌 표시기 동적 생성 완료');
    }
    
    /**
     * 이벤트 리스너 설정
     */
    setupEventListener() {
        if (!this.container) {
            console.error('❌ SmartScrollUtility: 컨테이너가 없어 이벤트를 등록할 수 없습니다.');
            return;
        }
        
        // 기존 이벤트 제거 (중복 방지)
        this.container.removeEventListener('wheel', this.handleWheel.bind(this));
        
        // 새 이벤트 등록
        this.container.addEventListener('wheel', this.handleWheel.bind(this), { 
            passive: false 
        });
        
        console.log('🔧 휠 이벤트 리스너 등록 완료:', this.container);
    }
    
    /**
     * 휠 이벤트 처리 (메인 로직)
     */
    handleWheel(event) {
        if (!this.cropper) return;
        
        // 현재 줌 레벨 확인
        const canvasData = this.cropper.getCanvasData();
        const currentZoom = canvasData.naturalWidth > 0 ? 
                           canvasData.width / canvasData.naturalWidth : 1;
        
        const isZoomingIn = event.deltaY < 0;  // 휠 위로 = 확대
        const isZoomingOut = event.deltaY > 0; // 휠 아래로 = 축소
        
        console.log(`🔍 줌 상태: ${currentZoom.toFixed(2)} (${isZoomingIn ? '확대' : '축소'})`);
        
        // 확대 시: 최대 줌 근처에서 페이지 스크롤
        if (isZoomingIn && currentZoom >= this.options.maxThreshold) {
            this.updateZoomIndicator(currentZoom, '최대 확대');
            this.scrollPage(event.deltaY * this.options.scrollMultiplier);
            console.log('📈 최대 확대 -> 페이지 스크롤');
            return;
        }
        
        // 축소 시: 최소 줌 근처에서 페이지 스크롤
        if (isZoomingOut && currentZoom <= this.options.minThreshold) {
            this.updateZoomIndicator(currentZoom, '최소 축소');
            this.scrollPage(event.deltaY * this.options.scrollMultiplier);
            console.log('📉 최소 축소 -> 페이지 스크롤');
            return;
        }
        
        // 정상 범위: 이미지 줌 적용
        event.preventDefault();
        event.stopPropagation();
        
        const zoomDelta = isZoomingIn ? this.options.zoomStep : -this.options.zoomStep;
        this.cropper.zoom(zoomDelta);
        
        // 줌 표시기 업데이트
        const newZoom = Math.max(
            this.options.minZoom, 
            Math.min(this.options.maxZoom, currentZoom + zoomDelta)
        );
        this.updateZoomIndicator(newZoom, isZoomingIn ? '확대' : '축소');
    }
    
    /**
     * 페이지 스크롤 실행
     */
    scrollPage(scrollAmount) {
        window.scrollBy({
            top: scrollAmount,
            behavior: 'smooth'
        });
    }
    
    /**
     * 줌 표시기 업데이트
     */
    updateZoomIndicator(zoomLevel, status) {
        if (!this.elements.zoomIndicator || !this.elements.zoomLevel) return;
        
        // 줌 레벨 표시
        const zoomPercent = Math.round(zoomLevel * 100);
        this.elements.zoomLevel.textContent = zoomPercent + '%';
        
        // 상태 메시지 설정
        if (this.elements.zoomStatus) {
            let statusMessage = '';
            let statusClass = '';
            
            switch (status) {
                case '최대 확대':
                    statusMessage = '(최대 - 페이지 스크롤 가능)';
                    statusClass = 'text-warning';
                    break;
                case '최소 축소':
                    statusMessage = '(최소 - 페이지 스크롤 가능)';
                    statusClass = 'text-info';
                    break;
                default:
                    statusMessage = `(${status} 중)`;
                    statusClass = 'text-success';
            }
            
            this.elements.zoomStatus.textContent = statusMessage;
            this.elements.zoomStatus.className = `ms-2 ${statusClass}`;
        }
        
        // 표시기 보이기
        this.elements.zoomIndicator.style.display = 'block';
        
        // 자동 숨김 타이머
        clearTimeout(this.zoomIndicatorTimeout);
        this.zoomIndicatorTimeout = setTimeout(() => {
            if (this.elements.zoomIndicator) {
                this.elements.zoomIndicator.style.display = 'none';
            }
        }, this.options.indicatorTimeout);
    }
    
    /**
     * 설정 업데이트
     */
    updateOptions(newOptions) {
        this.options = { ...this.options, ...newOptions };
        console.log('🔧 SmartScrollUtility 설정 업데이트:', this.options);
    }
    
    /**
     * 크롭퍼 업데이트 (동적 변경 시)
     */
    updateCropper(newCropper) {
        this.cropper = newCropper;
        console.log('🔄 SmartScrollUtility 크롭퍼 업데이트');
    }
    
    /**
     * 정리 (메모리 누수 방지)
     */
    destroy() {
        if (this.container) {
            this.container.removeEventListener('wheel', this.handleWheel.bind(this));
        }
        
        clearTimeout(this.zoomIndicatorTimeout);
        
        // 동적 생성된 표시기 제거
        const dynamicIndicator = document.getElementById('zoomIndicator');
        if (dynamicIndicator && dynamicIndicator.style.position === 'fixed') {
            dynamicIndicator.remove();
        }
        
        this.cropper = null;
        this.container = null;
        this.elements = {};
        
        console.log('🧹 SmartScrollUtility 정리 완료');
    }
}

// 전역 접근을 위한 윈도우 객체 등록
window.SmartScrollUtility = SmartScrollUtility;

}

// 간편 사용 함수
window.createSmartScroll = function(cropper, options = {}) {
    return new SmartScrollUtility(cropper, options);
};

console.log('📦 SmartScrollUtility 모듈 로드 완료');
````

## File: src/main/resources/templates/admin/dashboard.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>관리자 대시보드 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <!-- 브레드크럼 -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item active" aria-current="page">관리자 대시보드</li>
            </ol>
        </nav>

        <!-- 페이지 헤더 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <h1 class="h2 mb-1">
                            <i class="fas fa-tachometer-alt text-primary me-2"></i>
                            관리자 대시보드
                        </h1>
                        <p class="text-muted mb-0">CareLink 전체 시스템을 관리할 수 있습니다.</p>
                    </div>
                    <div>
                        <span class="badge bg-success fs-6">
                            <i class="fas fa-crown me-1"></i>Administrator
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 빠른 서비스 카드 (맨 위 큰 카드 4개) -->
        <div class="row g-4 mb-5">
            <div class="col-12">
                <h3 class="mb-4">
                    <i class="fas fa-bolt text-warning me-2"></i>
                    빠른 서비스
                </h3>
            </div>

            <!-- 시설 승인 관리 -->
            <div class="col-md-6 col-xl-3">
                <div class="card h-100 shadow-lg border-0" style="background: linear-gradient(135deg, #ff9a56 0%, #ff6b35 100%);">
                    <div class="card-body text-white text-center p-4">
                        <div class="display-4 mb-3">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h4 class="card-title mb-3">시설 승인</h4>
                        <h2 class="mb-3" th:text="${pendingFacilities}">0</h2>
                        <p class="mb-3">승인 대기 중인 시설</p>
                        <a href="/admin/facilities?status=PENDING" class="btn btn-light btn-lg w-100">
                            <i class="fas fa-eye me-2"></i>승인 관리
                        </a>
                    </div>
                </div>
            </div>

            <!-- 회원 관리 -->
            <div class="col-md-6 col-xl-3">
                <div class="card h-100 shadow-lg border-0" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="card-body text-white text-center p-4">
                        <div class="display-4 mb-3">
                            <i class="fas fa-users"></i>
                        </div>
                        <h4 class="card-title mb-3">회원 관리</h4>
                        <h2 class="mb-3" th:text="${totalMembers}">0</h2>
                        <p class="mb-3">전체 등록 회원</p>
                        <a href="/admin/members" class="btn btn-light btn-lg w-100">
                            <i class="fas fa-list me-2"></i>회원 관리
                        </a>
                    </div>
                </div>
            </div>

            <!-- 게시판 관리 -->
            <div class="col-md-6 col-xl-3">
                <div class="card h-100 shadow-lg border-0" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <div class="card-body text-white text-center p-4">
                        <div class="display-4 mb-3">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <h4 class="card-title mb-3">게시판 관리</h4>
                        <h2 class="mb-3">ALL</h2>
                        <p class="mb-3">공지사항 및 게시글</p>
                        <a href="/board" class="btn btn-light btn-lg w-100">
                            <i class="fas fa-edit me-2"></i>게시판 관리
                        </a>
                    </div>
                </div>
            </div>

            <!-- 리뷰 관리 -->
            <div class="col-md-6 col-xl-3">
                <div class="card h-100 shadow-lg border-0" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <div class="card-body text-white text-center p-4">
                        <div class="display-4 mb-3">
                            <i class="fas fa-star"></i>
                        </div>
                        <h4 class="card-title mb-3">리뷰 관리</h4>
                        <h2 class="mb-3">ALL</h2>
                        <p class="mb-3">시설 리뷰 및 평가</p>
                        <a href="/review" class="btn btn-light btn-lg w-100">
                            <i class="fas fa-star me-2"></i>리뷰 관리
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 통계 대시보드 (페이지 이동 없이 한 화면에 표시) -->
        <div class="row g-4 mb-5">
            <div class="col-12">
                <h3 class="mb-4">
                    <i class="fas fa-chart-bar text-info me-2"></i>
                    시스템 통계
                </h3>
            </div>

            <!-- 회원 통계 -->
            <div class="col-md-6 col-lg-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body text-center">
                        <div class="text-primary mb-2">
                            <i class="fas fa-users fa-2x"></i>
                        </div>
                        <h6 class="card-title text-muted">전체 회원</h6>
                        <h3 class="text-primary mb-2" th:text="${totalMembers}">0</h3>
                        <small class="text-muted">등록된 회원 수</small>
                    </div>
                </div>
            </div>

            <div class="col-md-6 col-lg-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body text-center">
                        <div class="text-success mb-2">
                            <i class="fas fa-building fa-2x"></i>
                        </div>
                        <h6 class="card-title text-muted">시설 회원</h6>
                        <h3 class="text-success mb-2" th:text="${facilityMembers}">0</h3>
                        <small class="text-muted">시설 운영자</small>
                    </div>
                </div>
            </div>

            <div class="col-md-6 col-lg-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body text-center">
                        <div class="text-info mb-2">
                            <i class="fas fa-user fa-2x"></i>
                        </div>
                        <h6 class="card-title text-muted">일반 회원</h6>
                        <h3 class="text-info mb-2" th:text="${userMembers}">0</h3>
                        <small class="text-muted">구직자 및 가족</small>
                    </div>
                </div>
            </div>

            <div class="col-md-6 col-lg-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body text-center">
                        <div class="text-warning mb-2">
                            <i class="fas fa-clock fa-2x"></i>
                        </div>
                        <h6 class="card-title text-muted">승인 대기</h6>
                        <h3 class="text-warning mb-2" th:text="${pendingFacilities}">0</h3>
                        <small class="text-muted">시설 승인 대기</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- 실시간 활동 현황 -->
        <div class="row g-4 mb-4">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0">
                            <i class="fas fa-activity text-success me-2"></i>
                            실시간 활동 현황
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="border-end">
                                    <h4 class="text-primary">
                                        <i class="fas fa-eye me-1"></i>
                                        <span id="todayVisits">-</span>
                                    </h4>
                                    <small class="text-muted">오늘 방문자</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="border-end">
                                    <h4 class="text-success">
                                        <i class="fas fa-user-plus me-1"></i>
                                        <span id="todaySignups">-</span>
                                    </h4>
                                    <small class="text-muted">오늘 가입자</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="border-end">
                                    <h4 class="text-info">
                                        <i class="fas fa-edit me-1"></i>
                                        <span id="todayPosts">-</span>
                                    </h4>
                                    <small class="text-muted">오늘 게시글</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <h4 class="text-warning">
                                    <i class="fas fa-star me-1"></i>
                                    <span id="todayReviews">-</span>
                                </h4>
                                <small class="text-muted">오늘 리뷰</small>
                            </div>
                        </div>
                        <div class="mt-3 text-center">
                            <button class="btn btn-outline-primary btn-sm" onclick="refreshStats()">
                                <i class="fas fa-sync me-1"></i>데이터 새로고침
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<script>
// 데이터 새로고침 함수
function refreshStats() {
    location.reload();
}

// 페이지 로드 시 통계 업데이트
$(document).ready(function() {
    console.log('관리자 대시보드 로드 완료');
    
    // 승인 대기 시설이 있으면 강조
    const pendingCount = parseInt($('[th\\:text="${pendingFacilities}"]').text());
    if (pendingCount > 0) {
        console.log('승인 대기 시설:', pendingCount);
    }
});
</script>

</body>
</html>
````

## File: src/main/resources/templates/board/edit.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title th:text="${pageTitle + ' - CareLink'}">게시글 수정 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>

    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <div class="container mt-4">
            <!-- 페이지 제목 -->
            <div class="row mb-4">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">홈</a></li>
                            <li class="breadcrumb-item"><a href="/board">정보마당</a></li>
                            <li class="breadcrumb-item">
                                <a th:href="@{/board/detail/{id}(id=${boardDTO.boardId}, type=${type})}" th:text="${boardDTO.title}">게시글 제목</a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">수정</li>
                        </ol>
                    </nav>
                    <h2>
                        <i class="fas fa-edit text-primary me-2"></i> 
                        게시글 수정
                    </h2>
                    <p class="text-muted">게시글 정보를 수정할 수 있습니다.</p>
                </div>
            </div>
            
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <form th:action="@{/board/edit/{id}(id=${boardDTO.boardId})}" method="post" th:object="${boardDTO}">
                        <!-- 게시판 타입 유지를 위한 hidden 필드 -->
                        <input type="hidden" name="type" th:value="${type}">
                        
                        <!-- 수정 시 필수 필드들을 유지하기 위한 hidden 필드 -->
                        <input type="hidden" th:field="*{memberId}">
                        <input type="hidden" th:field="*{boardType}">
                        <input type="hidden" th:field="*{viewCount}">
                        <input type="hidden" th:field="*{likeCount}">
                        <input type="hidden" th:field="*{commentCount}">
                        <input type="hidden" th:field="*{createdAt}">
                        <input type="hidden" th:field="*{replyDepth}">
                        <input type="hidden" th:field="*{replyOrder}">
                        <input type="hidden" th:field="*{parentBoardId}">
                        <input type="hidden" th:field="*{status}">
                        <input type="hidden" th:field="*{isActive}">
                        <input type="hidden" th:field="*{isDeleted}">
                        
                        <div class="card">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0">
                                    <i class="fas fa-edit me-2"></i>
                                    게시글 수정
                                </h5>
                            </div>
                            <div class="card-body">
                                <!-- 작성자 정보 표시 -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">작성자</label>
                                        <input type="text" class="form-control" th:value="${boardDTO.memberName}" readonly>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">작성일</label>
                                        <input type="text" class="form-control" th:value="${#temporals.format(boardDTO.createdAt, 'yyyy-MM-dd HH:mm')}" readonly>
                                    </div>
                                </div>

                                <!-- 카테고리 선택 -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">카테고리 <span class="text-danger">*</span></label>
                                        <select class="form-select" th:field="*{category}" required>
                                            <option value="">카테고리를 선택해주세요</option>
                                            <option value="NOTICE">공지사항</option>
                                            <option value="INFO">정보공유</option>
                                            <option value="QNA">Q&A</option>
                                            <option value="FAQ">자주묻는질문</option>
                                            <option value="TIP">팁&노하우</option>
                                            <option value="NEWS">뉴스</option>
                                            <option value="FREE">자유게시판</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">게시글 설정</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" th:field="*{isNotice}" id="isNotice">
                                            <label class="form-check-label" for="isNotice">
                                                공지사항으로 등록
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" th:field="*{isPinned}" id="isPinned">
                                            <label class="form-check-label" for="isPinned">
                                                상단 고정
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- 제목 -->
                                <div class="mb-3">
                                    <label class="form-label">제목 <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" th:field="*{title}" 
                                           placeholder="제목을 입력해주세요" required maxlength="100">
                                    <div class="form-text">
                                        최대 100자까지 입력 가능합니다.
                                        <small class="float-end">
                                            <span id="titleLength">0</span>/100자
                                        </small>
                                    </div>
                                </div>

                                <!-- 내용 -->
                                <div class="mb-4">
                                    <label class="form-label">내용 <span class="text-danger">*</span></label>
                                    <textarea class="form-control" rows="15" th:field="*{content}" 
                                              placeholder="내용을 입력해주세요" required minlength="20"
                                              data-rich-editor='{"height": "400px"}'></textarea>
                                    <div class="form-text">
                                        최소 20자 이상 작성해주세요.
                                        <small class="float-end">
                                            <span id="contentLength">0</span>자
                                        </small>
                                    </div>
                                </div>

                                <!-- 태그 -->
                                <div class="mb-4">
                                    <label class="form-label">태그</label>
                                    <input type="text" class="form-control" th:field="*{tags}" 
                                           placeholder="태그를 입력해주세요 (예: 요양원, 간병, 보험)">
                                    <div class="form-text">쉼표(,)로 구분하여 입력해주세요. 최대 5개까지 추가 가능합니다.</div>
                                </div>

                                <!-- 현재 게시글 정보 -->
                                <div class="mb-4 p-3 bg-light rounded">
                                    <h6 class="text-muted mb-2"><i class="fas fa-info-circle me-1"></i> 현재 게시글 정보</h6>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <small class="text-muted">조회수</small>
                                            <div th:text="${boardDTO.viewCount}">0</div>
                                        </div>
                                        <div class="col-md-4">
                                            <small class="text-muted">추천수</small>
                                            <div th:text="${boardDTO.likeCount}">0</div>
                                        </div>
                                        <div class="col-md-4">
                                            <small class="text-muted">댓글수</small>
                                            <div th:text="${boardDTO.commentCount}">0</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 버튼 -->
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <a th:href="@{/board/detail/{id}(id=${boardDTO.boardId}, type=${type})}" class="btn btn-secondary">
                                            <i class="fas fa-arrow-left me-1"></i> 취소
                                        </a>
                                    </div>
                                    <div>
                                        <button type="button" class="btn btn-outline-secondary me-2" onclick="previewBoard()">
                                            <i class="fas fa-eye me-1"></i> 미리보기
                                        </button>
                                        <button type="submit" class="btn btn-warning">
                                            <i class="fas fa-save me-1"></i> 수정 완료
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>

                    <!-- 수정 가이드 -->
                    <div class="card mt-4">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i> 게시글 수정 안내</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-primary"><i class="fas fa-check-circle me-1"></i> 수정 가능 항목</h6>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-check text-primary me-2"></i> 제목 및 내용</li>
                                        <li><i class="fas fa-check text-primary me-2"></i> 카테고리</li>
                                        <li><i class="fas fa-check text-primary me-2"></i> 태그</li>
                                        <li><i class="fas fa-check text-primary me-2"></i> 공지사항 설정</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-muted"><i class="fas fa-lock me-1"></i> 변경 불가 항목</h6>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-times text-muted me-2"></i> 작성자 정보</li>
                                        <li><i class="fas fa-times text-muted me-2"></i> 작성일시</li>
                                        <li><i class="fas fa-times text-muted me-2"></i> 조회수, 추천수</li>
                                        <li><i class="fas fa-times text-muted me-2"></i> 댓글 정보</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 푸터 -->
    <footer th:replace="~{layout/footer :: footer}"></footer>
    
    <!-- JavaScript -->
    <div th:replace="~{layout/footer :: scripts}"></div>

    <script>
        // 문자 수 카운팅
        document.addEventListener('DOMContentLoaded', function() {
            const titleInput = document.querySelector('input[name="title"]');
            const contentTextarea = document.querySelector('textarea[name="content"]');
            const titleLength = document.getElementById('titleLength');
            const contentLength = document.getElementById('contentLength');
            
            // 초기 문자 수 설정
            titleLength.textContent = titleInput.value.length;
            contentLength.textContent = contentTextarea.value.length;
            
            // 제목 글자 수 카운팅
            titleInput.addEventListener('input', function() {
                titleLength.textContent = this.value.length;
                if (this.value.length > 100) {
                    titleLength.style.color = 'red';
                } else {
                    titleLength.style.color = '';
                }
            });
            
            // 내용 글자 수 카운팅
            contentTextarea.addEventListener('input', function() {
                contentLength.textContent = this.value.length;
                if (this.value.length < 20) {
                    contentLength.style.color = 'red';
                } else {
                    contentLength.style.color = 'green';
                }
            });
            
            // 폼 유효성 검사
            const form = document.querySelector('form');
            form.addEventListener('submit', function(e) {
                const title = titleInput.value.trim();
                const content = contentTextarea.value.trim();
                const category = document.querySelector('select[name="category"]').value;
                
                if (!category) {
                    e.preventDefault();
                    alert('카테고리를 선택해주세요.');
                    return false;
                }
                
                if (title.length === 0) {
                    e.preventDefault();
                    alert('제목을 입력해주세요.');
                    titleInput.focus();
                    return false;
                }
                
                if (title.length > 100) {
                    e.preventDefault();
                    alert('제목은 100자 이하로 입력해주세요.');
                    titleInput.focus();
                    return false;
                }
                
                if (content.length < 20) {
                    e.preventDefault();
                    alert('내용을 최소 20자 이상 입력해주세요.');
                    contentTextarea.focus();
                    return false;
                }
                
                // 수정 확인
                if (!confirm('게시글을 수정하시겠습니까?')) {
                    e.preventDefault();
                    return false;
                }
            });
        });
        
        // 미리보기 기능
        function previewBoard() {
            const title = document.querySelector('input[name="title"]').value;
            const content = document.querySelector('textarea[name="content"]').value;
            
            if (title.trim() === '' || content.trim() === '') {
                alert('제목과 내용을 입력한 후 미리보기를 사용해주세요.');
                return;
            }
            
            // 새 창에서 미리보기 표시
            const previewWindow = window.open('', 'preview', 'width=800,height=600,scrollbars=yes');
            previewWindow.document.write(`
                <html>
                <head>
                    <title>미리보기</title>
                    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
                    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
                </head>
                <body class="p-4">
                    <div class="container">
                        <div class="alert alert-warning">
                            <i class="fas fa-eye me-2"></i>
                            이것은 미리보기입니다. 실제 게시글과 다를 수 있습니다.
                        </div>
                        <h2>${title}</h2>
                        <hr>
                        <div style="white-space: pre-wrap; line-height: 1.8;">${content}</div>
                    </div>
                </body>
                </html>
            `);
        }
        
        // 키보드 단축키
        document.addEventListener('keydown', function(e) {
            // Ctrl + S: 저장
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                document.querySelector('form').submit();
            }
            
            // ESC: 취소
            if (e.key === 'Escape') {
                if (confirm('수정을 취소하고 게시글로 돌아가시겠습니까?')) {
                    window.location.href = document.querySelector('a[href*="/board/detail"]').href;
                }
            }
        });
    </script>
</body>
</html>
````

## File: src/main/resources/templates/board/faq-list.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>자주묻는질문 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>

    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <div class="container py-4">
            <!-- 페이지 제목 -->
            <div class="row mb-4">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">홈</a></li>
                            <li class="breadcrumb-item"><a href="/board">정보마당</a></li>
                            <li class="breadcrumb-item active" aria-current="page">자주묻는질문</li>
                        </ol>
                    </nav>
                    <h2>
                        <i class="fas fa-question-circle text-warning me-2"></i> 
                        자주묻는질문 (FAQ)
                    </h2>
                    <p class="text-muted mb-3">자주 묻는 질문과 답변을 확인하세요. 궁금한 점이 해결되지 않으면 Q&A 게시판을 이용해주세요.</p>
                    
                    <!-- 게시판 타입 메뉴 -->
                    <div class="btn-group mb-3" role="group" aria-label="게시판 타입">
                        <a th:href="@{/board(type='all')}" class="btn btn-sm btn-outline-primary board-type-link">전체</a>
                        <a th:href="@{/board(type='notice')}" class="btn btn-sm btn-outline-primary board-type-link">공지사항</a>
                        <a th:href="@{/board(type='info')}" class="btn btn-sm btn-outline-primary board-type-link">정보공유</a>
                        <a th:href="@{/board(type='qna')}" class="btn btn-sm btn-outline-primary board-type-link">Q&A</a>
                        <a th:href="@{/board(type='faq')}" class="btn btn-sm btn-primary board-type-link">FAQ</a>
                    </div>
                </div>
            </div>
            
            <!-- 검색 및 글쓰기 -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <form th:action="@{/board}" method="get" class="d-flex gap-2">
                        <input type="hidden" name="type" value="faq">
                        <input type="text" name="keyword" class="form-control" th:value="${keyword}"
                               placeholder="FAQ 내용을 검색하세요">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search me-1"></i>검색
                        </button>
                    </form>
                </div>
                <div class="col-md-4 text-end">
                    <a th:href="@{/board/write(type='faq')}" class="btn btn-warning">
                        <i class="fas fa-plus me-1"></i>FAQ 작성
                    </a>
                </div>
            </div>

            <!-- FAQ 통계 -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card bg-warning bg-opacity-10">
                        <div class="card-body py-3">
                            <div class="row text-center">
                                <div class="col-md-4">
                                    <i class="fas fa-question-circle text-warning fa-2x mb-2"></i>
                                    <div>
                                        <strong class="d-block" th:text="${pageInfo.totalCount}">0</strong>
                                        <small class="text-muted">총 FAQ</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <i class="fas fa-eye text-info fa-2x mb-2"></i>
                                    <div>
                                        <strong class="d-block">1,234</strong>
                                        <small class="text-muted">총 조회수</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <i class="fas fa-thumbs-up text-success fa-2x mb-2"></i>
                                    <div>
                                        <strong class="d-block">98%</strong>
                                        <small class="text-muted">도움됨</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FAQ 카테고리 필터 -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">카테고리별 FAQ</h6>
                            <div class="btn-group flex-wrap" role="group">
                                <button type="button" class="btn btn-outline-secondary btn-sm active" onclick="filterFAQ('all')">
                                    전체 (<span id="count-all" th:text="${pageInfo.totalCount}">0</span>)
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="filterFAQ('facility')">
                                    시설 이용 (12)
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="filterFAQ('cost')">
                                    비용 문의 (8)
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="filterFAQ('insurance')">
                                    보험 관련 (15)
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="filterFAQ('admission')">
                                    입소 절차 (6)
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="filterFAQ('etc')">
                                    기타 (3)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FAQ 아코디언 목록 -->
            <div class="row">
                <div class="col-12">
                    <div th:if="${#lists.isEmpty(boardList)}" class="card">
                        <div class="card-body text-center py-5">
                            <i class="fas fa-question-circle fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">등록된 FAQ가 없습니다</h5>
                            <p class="text-muted">첫 번째 FAQ를 작성해보세요!</p>
                            <a th:href="@{/board/write(type='faq')}" class="btn btn-warning">
                                <i class="fas fa-plus me-1"></i>FAQ 작성하기
                            </a>
                        </div>
                    </div>
                    
                    <div th:unless="${#lists.isEmpty(boardList)}" class="accordion" id="faqAccordion">
                        <div th:each="board, iterStat : ${boardList}" class="accordion-item mb-2 faq-item" 
                             th:data-category="${board.subCategory ?: 'etc'}">
                            <h2 class="accordion-header" th:id="'heading' + ${board.boardId}">
                                <button class="accordion-button collapsed" type="button" 
                                        data-bs-toggle="collapse" 
                                        th:data-bs-target="'#collapse' + ${board.boardId}"
                                        th:aria-controls="'collapse' + ${board.boardId}">
                                    <div class="w-100 d-flex justify-content-between align-items-center">
                                        <div class="flex-grow-1">
                                            <span class="badge bg-warning me-2">Q</span>
                                            <span th:text="${board.title}" class="fw-semibold">FAQ 질문</span>
                                        </div>
                                        <div class="text-end me-3">
                                            <small class="text-muted">
                                                <i class="fas fa-eye me-1"></i><span th:text="${board.viewCount}">0</span>
                                                <i class="fas fa-thumbs-up ms-2 me-1"></i><span th:text="${board.likeCount}">0</span>
                                            </small>
                                        </div>
                                    </div>
                                </button>
                            </h2>
                            <div th:id="'collapse' + ${board.boardId}" 
                                 class="accordion-collapse collapse" 
                                 th:aria-labelledby="'heading' + ${board.boardId}"
                                 data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    <div class="mb-3">
                                        <span class="badge bg-success me-2">A</span>
                                        <strong>답변</strong>
                                    </div>
                                    <div class="faq-content" th:utext="${#strings.replace(#strings.replace(board.content, '\\n', '&lt;br&gt;'), '\\r\\n', '&lt;br&gt;')}">
                                        FAQ 답변 내용이 여기에 표시됩니다.
                                    </div>
                                    
                                    <!-- FAQ 메타 정보 -->
                                    <div class="mt-4 pt-3 border-top">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <small class="text-muted">
                                                    <i class="fas fa-user me-1"></i>작성자: <span th:text="${board.memberName}">관리자</span>
                                                    <span class="mx-2">|</span>
                                                    <i class="fas fa-calendar me-1"></i>작성일: <span th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd')}">2024-01-01</span>
                                                    <span class="mx-2">|</span>
                                                    <i class="fas fa-sync me-1"></i>수정일: <span th:text="${#temporals.format(board.updatedAt, 'yyyy-MM-dd')}">2024-01-01</span>
                                                </small>
                                            </div>
                                            <div class="col-md-6 text-end">
                                                <!-- FAQ 액션 버튼 -->
                                                <div class="btn-group btn-group-sm" role="group">
                                                    <button type="button" class="btn btn-outline-success btn-sm" 
                                                            th:onclick="'likeFAQ(' + ${board.boardId} + ')'">
                                                        <i class="fas fa-thumbs-up me-1"></i>도움됨 (<span th:text="${board.likeCount}">0</span>)
                                                    </button>
                                                    <button type="button" class="btn btn-outline-secondary btn-sm" 
                                                            th:onclick="'shareFAQ(' + ${board.boardId} + ')'">
                                                        <i class="fas fa-share me-1"></i>공유
                                                    </button>
                                                    <a th:href="@{/board/detail/{id}(id=${board.boardId}, type='faq')}" 
                                                       class="btn btn-outline-primary btn-sm">
                                                        <i class="fas fa-external-link-alt me-1"></i>상세보기
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 페이징 -->
            <nav th:if="${pageInfo.totalPages > 1}" aria-label="FAQ 페이지 네비게이션" class="mt-4">
                <ul class="pagination justify-content-center">
                    <!-- 처음 페이지 -->
                    <li class="page-item" th:classappend="${pageInfo.firstPage} ? 'disabled'">
                        <a class="page-link" th:href="@{/board(type='faq', page=1, keyword=${keyword})}">
                            <span>&laquo;&laquo;</span>
                        </a>
                    </li>
                    <!-- 이전 페이지 -->
                    <li class="page-item" th:classappend="${not pageInfo.hasPrevious} ? 'disabled'">
                        <a class="page-link" th:href="@{/board(type='faq', page=${pageInfo.currentPage - 1}, keyword=${keyword})}">
                            <span>&laquo;</span>
                        </a>
                    </li>
                    <!-- 페이지 번호 -->
                    <li th:each="pageNum : ${#numbers.sequence(pageInfo.startPage, pageInfo.endPage)}"
                        class="page-item" th:classappend="${pageNum == pageInfo.currentPage} ? 'active'">
                        <a class="page-link" th:href="@{/board(type='faq', page=${pageNum}, keyword=${keyword})}" th:text="${pageNum}">1</a>
                    </li>
                    <!-- 다음 페이지 -->
                    <li class="page-item" th:classappend="${not pageInfo.hasNext} ? 'disabled'">
                        <a class="page-link" th:href="@{/board(type='faq', page=${pageInfo.currentPage + 1}, keyword=${keyword})}">
                            <span>&raquo;</span>
                        </a>
                    </li>
                    <!-- 마지막 페이지 -->
                    <li class="page-item" th:classappend="${pageInfo.lastPage} ? 'disabled'">
                        <a class="page-link" th:href="@{/board(type='faq', page=${pageInfo.totalPages}, keyword=${keyword})}">
                            <span>&raquo;&raquo;</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- 도움말 섹션 -->
            <div class="row mt-5">
                <div class="col-12">
                    <div class="card bg-light">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-primary">
                                        <i class="fas fa-lightbulb me-1"></i>FAQ를 찾을 수 없나요?
                                    </h6>
                                    <p class="mb-2">원하는 답변을 찾지 못하셨다면 Q&A 게시판에 직접 질문해보세요.</p>
                                    <a href="/board?type=qna" class="btn btn-success btn-sm">
                                        <i class="fas fa-question-circle me-1"></i>Q&A 게시판 가기
                                    </a>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-info">
                                        <i class="fas fa-phone me-1"></i>전화 상담
                                    </h6>
                                    <p class="mb-2">급하신 문의사항은 전화로 상담받으실 수 있습니다.</p>
                                    <p class="mb-0">
                                        <strong class="text-primary">1588-0000</strong>
                                        <small class="text-muted">(평일 09:00~18:00)</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 푸터 -->
    <footer th:replace="~{layout/footer :: footer}"></footer>
    
    <!-- JavaScript -->
    <div th:replace="~{layout/footer :: scripts}"></div>

    <script>
        // FAQ 카테고리 필터링
        function filterFAQ(category) {
            const items = document.querySelectorAll('.faq-item');
            const buttons = document.querySelectorAll('.btn-group button');
            
            // 버튼 활성화 상태 변경
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // FAQ 아이템 필터링
            items.forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // FAQ 추천 기능
        function likeFAQ(boardId) {
            fetch(`/board/like/${boardId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'action=like'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // 추천수 업데이트
                    const likeButtons = document.querySelectorAll(`[onclick="likeFAQ(${boardId})"] span`);
                    likeButtons.forEach(span => {
                        span.textContent = parseInt(span.textContent) + 1;
                    });
                    
                    // 성공 메시지
                    showToast('도움이 되었다고 표시했습니다.', 'success');
                    
                    // 버튼 비활성화
                    event.target.disabled = true;
                    event.target.innerHTML = '<i class="fas fa-check me-1"></i>도움됨';
                } else {
                    showToast('처리 중 오류가 발생했습니다.', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('처리 중 오류가 발생했습니다.', 'error');
            });
        }
        
        // FAQ 공유 기능
        function shareFAQ(boardId) {
            const url = `${window.location.origin}/board/detail/${boardId}?type=faq`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'CareLink FAQ',
                    url: url
                }).then(() => {
                    showToast('공유되었습니다.', 'success');
                });
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    showToast('링크가 클립보드에 복사되었습니다.', 'success');
                });
            }
        }
        
        // 토스트 메시지 표시
        function showToast(message, type) {
            const toastClass = type === 'success' ? 'bg-success' : 'bg-danger';
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white ${toastClass} border-0`;
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">${message}</div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            // 토스트 컨테이너 생성 (없는 경우)
            let toastContainer = document.querySelector('.toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                document.body.appendChild(toastContainer);
            }
            
            toastContainer.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            // 토스트가 숨겨진 후 DOM에서 제거
            toast.addEventListener('hidden.bs.toast', () => {
                toast.remove();
            });
        }
        
        // 페이지 로드 시 아코디언 이벤트 추가
        document.addEventListener('DOMContentLoaded', function() {
            // 아코디언 열림/닫힘 시 조회수 증가 (한 번만)
            const accordions = document.querySelectorAll('.accordion-collapse');
            accordions.forEach(accordion => {
                accordion.addEventListener('shown.bs.collapse', function() {
                    if (!this.dataset.viewed) {
                        const boardId = this.id.replace('collapse', '');
                        // 조회수 증가 API 호출 (선택사항)
                        this.dataset.viewed = 'true';
                    }
                });
            });
        });
    </script>
    
    <!-- 게시판 네비게이션 공통 스크립트 -->
    <script src="/js/board-navigation.js"></script>
</body>
</html>
````

## File: src/main/resources/templates/board/notice-list.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>공지사항 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>

    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <div class="container py-4">
            <!-- 페이지 제목 -->
            <div class="row mb-4">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">홈</a></li>
                            <li class="breadcrumb-item"><a href="/board">정보마당</a></li>
                            <li class="breadcrumb-item active" aria-current="page">공지사항</li>
                        </ol>
                    </nav>
                    <h2>
                        <i class="fas fa-bullhorn text-danger me-2"></i> 
                        공지사항
                    </h2>
                    <p class="text-muted mb-3">CareLink의 중요한 공지사항과 새로운 소식을 확인하세요.</p>
                    
                    <!-- 게시판 타입 메뉴 -->
                    <div class="btn-group mb-3" role="group" aria-label="게시판 타입">
                        <a th:href="@{/board(type='all')}" class="btn btn-sm btn-outline-primary">전체</a>
                        <a th:href="@{/board(type='notice')}" class="btn btn-sm btn-danger">공지사항</a>
                        <a th:href="@{/board(type='info')}" class="btn btn-sm btn-outline-primary">정보공유</a>
                        <a th:href="@{/board(type='qna')}" class="btn btn-sm btn-outline-primary">Q&A</a>
                        <a th:href="@{/board(type='faq')}" class="btn btn-sm btn-outline-primary">FAQ</a>
                    </div>
                </div>
            </div>
            
            <!-- 검색 및 글쓰기 -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <form th:action="@{/board}" method="get" class="d-flex gap-2">
                        <input type="hidden" name="type" value="notice">
                        <input type="text" name="keyword" class="form-control" th:value="${keyword}"
                               placeholder="공지사항 검색">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search me-1"></i>검색
                        </button>
                    </form>
                </div>
                <div class="col-md-4 text-end">
                    <a th:href="@{/board/write(type='notice')}" class="btn btn-danger">
                        <i class="fas fa-plus me-1"></i>공지사항 작성
                    </a>
                </div>
            </div>

            <!-- 공지사항 통계 -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card bg-danger bg-opacity-10">
                        <div class="card-body py-3">
                            <div class="row text-center">
                                <div class="col-md-4">
                                    <i class="fas fa-bullhorn text-danger fa-2x mb-2"></i>
                                    <div>
                                        <strong class="d-block" th:text="${pageInfo.totalCount}">0</strong>
                                        <small class="text-muted">총 공지사항</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <i class="fas fa-eye text-info fa-2x mb-2"></i>
                                    <div>
                                        <strong class="d-block">5,678</strong>
                                        <small class="text-muted">총 조회수</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <i class="fas fa-calendar-day text-success fa-2x mb-2"></i>
                                    <div>
                                        <strong class="d-block">2</strong>
                                        <small class="text-muted">이번주 등록</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 공지사항 목록 -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-danger text-white">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-list me-2"></i>공지사항 목록
                                <small class="ms-2">
                                    (총 <span th:text="${pageInfo.totalCount}">0</span>개)
                                </small>
                            </h5>
                        </div>
                        <div class="card-body p-0">
                            <div th:if="${#lists.isEmpty(boardList)}" class="text-center py-5">
                                <i class="fas fa-bullhorn fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">등록된 공지사항이 없습니다</h5>
                                <p class="text-muted">첫 번째 공지사항을 작성해보세요!</p>
                                <a th:href="@{/board/write(type='notice')}" class="btn btn-danger">
                                    <i class="fas fa-plus me-1"></i>공지사항 작성하기
                                </a>
                            </div>
                            
                            <div th:unless="${#lists.isEmpty(boardList)}" class="list-group list-group-flush">
                                <div th:each="board : ${boardList}" class="list-group-item list-group-item-action notice-item">
                                    <div class="row align-items-center">
                                        <div class="col-md-8">
                                            <div class="d-flex align-items-center mb-2">
                                                <span class="badge bg-danger me-2">공지</span>
                                                <span th:if="${board.isPinned}" class="badge bg-warning me-2">고정</span>
                                                <span th:if="${board.isNotice}" class="badge bg-info me-2">중요</span>
                                                <h6 class="mb-0">
                                                    <a th:href="@{/board/detail/{id}(id=${board.boardId}, type='notice')}" 
                                                       class="text-decoration-none text-danger fw-bold" 
                                                       th:text="${board.title}">공지사항 제목</a>
                                                </h6>
                                            </div>
                                            <div class="notice-preview text-muted small">
                                                <span th:text="${#strings.abbreviate(board.content, 100)}">공지사항 내용 미리보기...</span>
                                            </div>
                                            <div class="notice-meta mt-2">
                                                <small class="text-muted">
                                                    <i class="fas fa-user me-1"></i><span th:text="${board.memberName}">관리자</span>
                                                    <span class="mx-2">|</span>
                                                    <i class="fas fa-calendar me-1"></i><span th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd HH:mm')}">2024-01-01 09:00</span>
                                                </small>
                                            </div>
                                        </div>
                                        <div class="col-md-4 text-end">
                                            <div class="notice-stats">
                                                <div class="row text-center">
                                                    <div class="col-6">
                                                        <i class="fas fa-eye text-info"></i>
                                                        <small class="d-block text-muted" th:text="${board.viewCount}">0</small>
                                                    </div>
                                                    <div class="col-6">
                                                        <i class="fas fa-thumbs-up text-success"></i>
                                                        <small class="d-block text-muted" th:text="${board.likeCount}">0</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 페이징 -->
            <nav th:if="${pageInfo.totalPages > 1}" aria-label="공지사항 페이지 네비게이션" class="mt-4">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${pageInfo.firstPage} ? 'disabled'">
                        <a class="page-link" th:href="@{/board(type='notice', page=1, keyword=${keyword})}">
                            <span>&laquo;&laquo;</span>
                        </a>
                    </li>
                    <li class="page-item" th:classappend="${not pageInfo.hasPrevious} ? 'disabled'">
                        <a class="page-link" th:href="@{/board(type='notice', page=${pageInfo.currentPage - 1}, keyword=${keyword})}">
                            <span>&laquo;</span>
                        </a>
                    </li>
                    <li th:each="pageNum : ${#numbers.sequence(pageInfo.startPage, pageInfo.endPage)}"
                        class="page-item" th:classappend="${pageNum == pageInfo.currentPage} ? 'active'">
                        <a class="page-link" th:href="@{/board(type='notice', page=${pageNum}, keyword=${keyword})}" th:text="${pageNum}">1</a>
                    </li>
                    <li class="page-item" th:classappend="${not pageInfo.hasNext} ? 'disabled'">
                        <a class="page-link" th:href="@{/board(type='notice', page=${pageInfo.currentPage + 1}, keyword=${keyword})}">
                            <span>&raquo;</span>
                        </a>
                    </li>
                    <li class="page-item" th:classappend="${pageInfo.lastPage} ? 'disabled'">
                        <a class="page-link" th:href="@{/board(type='notice', page=${pageInfo.totalPages}, keyword=${keyword})}">
                            <span>&raquo;&raquo;</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </main>

    <!-- 푸터 -->
    <footer th:replace="~{layout/footer :: footer}"></footer>
    
    <!-- JavaScript -->
    <div th:replace="~{layout/footer :: scripts}"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const noticeItems = document.querySelectorAll('.notice-item');
            
            noticeItems.forEach(item => {
                item.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#f8f9fa';
                });
                
                item.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = '';
                });
            });
        });
    </script>
    
    <!-- 게시판 네비게이션 공통 스크립트 -->
    <script src="/js/board-navigation.js"></script>
</body>
</html>
````

## File: src/main/resources/templates/board/qna-list.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>Q&A - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>

    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <div class="container py-4">
            <!-- 페이지 제목 -->
            <div class="row mb-4">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">홈</a></li>
                            <li class="breadcrumb-item"><a href="/board">정보마당</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Q&A</li>
                        </ol>
                    </nav>
                    <h2>
                        <i class="fas fa-question-circle text-success me-2"></i> 
                        Q&A (질문과 답변)
                    </h2>
                    <p class="text-muted mb-3">궁금한 점을 질문하고 답변을 받아보세요. 다른 사용자의 질문과 답변도 함께 확인할 수 있습니다.</p>
                    
                    <!-- 게시판 타입 메뉴 -->
                    <div class="btn-group mb-3" role="group" aria-label="게시판 타입">
                        <a th:href="@{/board(type='all')}" class="btn btn-sm btn-outline-primary">전체</a>
                        <a th:href="@{/board(type='notice')}" class="btn btn-sm btn-outline-primary">공지사항</a>
                        <a th:href="@{/board(type='info')}" class="btn btn-sm btn-outline-primary">정보공유</a>
                        <a th:href="@{/board(type='qna')}" class="btn btn-sm btn-success">Q&A</a>
                        <a th:href="@{/board(type='faq')}" class="btn btn-sm btn-outline-primary">FAQ</a>
                    </div>
                </div>
            </div>
            
            <!-- 검색 및 글쓰기 -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <form th:action="@{/board}" method="get" class="d-flex gap-2">
                        <input type="hidden" name="type" value="qna">
                        <select name="status" class="form-select" style="width: auto;">
                            <option value="">전체 상태</option>
                            <option value="waiting">답변 대기</option>
                            <option value="answered">답변 완료</option>
                            <option value="solved">해결됨</option>
                        </select>
                        <input type="text" name="keyword" class="form-control" th:value="${keyword}"
                               placeholder="질문 내용을 검색하세요">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search me-1"></i>검색
                        </button>
                    </form>
                </div>
                <div class="col-md-4 text-end">
                    <a th:href="@{/board/write(type='qna')}" class="btn btn-success">
                        <i class="fas fa-plus me-1"></i>질문하기
                    </a>
                </div>
            </div>

            <!-- Q&A 통계 -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card bg-success bg-opacity-10">
                        <div class="card-body py-3">
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <i class="fas fa-question-circle text-success fa-2x mb-2"></i>
                                    <div>
                                        <strong class="d-block" th:text="${pageInfo.totalCount}">0</strong>
                                        <small class="text-muted">총 질문</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <i class="fas fa-clock text-warning fa-2x mb-2"></i>
                                    <div>
                                        <strong class="d-block">12</strong>
                                        <small class="text-muted">답변 대기</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <i class="fas fa-check-circle text-primary fa-2x mb-2"></i>
                                    <div>
                                        <strong class="d-block">45</strong>
                                        <small class="text-muted">답변 완료</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <i class="fas fa-trophy text-danger fa-2x mb-2"></i>
                                    <div>
                                        <strong class="d-block">98%</strong>
                                        <small class="text-muted">해결률</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Q&A 카테고리 필터 -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">질문 카테고리</h6>
                            <div class="btn-group flex-wrap" role="group">
                                <button type="button" class="btn btn-outline-secondary btn-sm active" onclick="filterQNA('all')">
                                    전체 (<span th:text="${pageInfo.totalCount}">0</span>)
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="filterQNA('facility')">
                                    시설 관련 (15)
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="filterQNA('cost')">
                                    비용 문의 (23)
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="filterQNA('insurance')">
                                    보험 관련 (18)
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="filterQNA('service')">
                                    서비스 (12)
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="filterQNA('etc')">
                                    기타 (8)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Q&A 목록 -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-list me-2"></i>Q&A 목록
                                <small class="ms-2">
                                    (총 <span th:text="${pageInfo.totalCount}">0</span>개)
                                </small>
                            </h5>
                        </div>
                        <div class="card-body p-0">
                            <div th:if="${#lists.isEmpty(boardList)}" class="text-center py-5">
                                <i class="fas fa-question-circle fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">등록된 질문이 없습니다</h5>
                                <p class="text-muted">첫 번째 질문을 작성해보세요!</p>
                                <a th:href="@{/board/write(type='qna')}" class="btn btn-success">
                                    <i class="fas fa-plus me-1"></i>질문하기
                                </a>
                            </div>
                            
                            <div th:unless="${#lists.isEmpty(boardList)}" class="list-group list-group-flush">
                                <div th:each="board : ${boardList}" class="list-group-item list-group-item-action qna-item"
                                     th:data-category="${board.subCategory ?: 'etc'}">
                                    <div class="row align-items-center">
                                        <div class="col-md-8">
                                            <div class="d-flex align-items-center mb-2">
                                                <span class="badge bg-success me-2">Q</span>
                                                <!-- 답변 상태 배지 -->
                                                <span th:if="${board.commentCount == 0}" class="badge bg-warning me-2">답변대기</span>
                                                <span th:if="${board.commentCount > 0}" class="badge bg-primary me-2">답변완료</span>
                                                <span th:if="${board.status == 'SOLVED'}" class="badge bg-info me-2">해결됨</span>
                                                <h6 class="mb-0">
                                                    <a th:href="@{/board/detail/{id}(id=${board.boardId}, type='qna')}" 
                                                       class="text-decoration-none" 
                                                       th:text="${board.title}">질문 제목</a>
                                                </h6>
                                            </div>
                                            <div class="qna-preview text-muted small">
                                                <span th:text="${#strings.abbreviate(board.content, 120)}">질문 내용 미리보기...</span>
                                            </div>
                                            <div class="qna-meta mt-2">
                                                <small class="text-muted">
                                                    <i class="fas fa-user me-1"></i><span th:text="${board.memberName}">질문자</span>
                                                    <span class="mx-2">|</span>
                                                    <i class="fas fa-calendar me-1"></i><span th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd HH:mm')}">2024-01-01 09:00</span>
                                                    <span th:if="${board.tags}" class="mx-2">|</span>
                                                    <span th:if="${board.tags}" th:each="tag : ${#strings.arraySplit(board.tags, ',')}" 
                                                          class="badge bg-light text-dark me-1" th:text="${tag}">태그</span>
                                                </small>
                                            </div>
                                        </div>
                                        <div class="col-md-4 text-end">
                                            <div class="qna-stats">
                                                <div class="row text-center">
                                                    <div class="col-4">
                                                        <i class="fas fa-eye text-info"></i>
                                                        <small class="d-block text-muted" th:text="${board.viewCount}">0</small>
                                                    </div>
                                                    <div class="col-4">
                                                        <i class="fas fa-comments text-success"></i>
                                                        <small class="d-block text-muted" th:text="${board.commentCount}">0</small>
                                                    </div>
                                                    <div class="col-4">
                                                        <i class="fas fa-thumbs-up text-primary"></i>
                                                        <small class="d-block text-muted" th:text="${board.likeCount}">0</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="mt-2">
                                                <span th:if="${board.isNew != null and board.isNew}" class="badge bg-danger">NEW</span>
                                                <span th:if="${board.priority > 0}" class="badge bg-warning">긴급</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 페이징 -->
            <nav th:if="${pageInfo.totalPages > 1}" aria-label="Q&A 페이지 네비게이션" class="mt-4">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${pageInfo.firstPage} ? 'disabled'">
                        <a class="page-link" th:href="@{/board(type='qna', page=1, keyword=${keyword})}">
                            <span>&laquo;&laquo;</span>
                        </a>
                    </li>
                    <li class="page-item" th:classappend="${not pageInfo.hasPrevious} ? 'disabled'">
                        <a class="page-link" th:href="@{/board(type='qna', page=${pageInfo.currentPage - 1}, keyword=${keyword})}">
                            <span>&laquo;</span>
                        </a>
                    </li>
                    <li th:each="pageNum : ${#numbers.sequence(pageInfo.startPage, pageInfo.endPage)}"
                        class="page-item" th:classappend="${pageNum == pageInfo.currentPage} ? 'active'">
                        <a class="page-link" th:href="@{/board(type='qna', page=${pageNum}, keyword=${keyword})}" th:text="${pageNum}">1</a>
                    </li>
                    <li class="page-item" th:classappend="${not pageInfo.hasNext} ? 'disabled'">
                        <a class="page-link" th:href="@{/board(type='qna', page=${pageInfo.currentPage + 1}, keyword=${keyword})}">
                            <span>&raquo;</span>
                        </a>
                    </li>
                    <li class="page-item" th:classappend="${pageInfo.lastPage} ? 'disabled'">
                        <a class="page-link" th:href="@{/board(type='qna', page=${pageInfo.totalPages}, keyword=${keyword})}">
                            <span>&raquo;&raquo;</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- 도움말 섹션 -->
            <div class="row mt-5">
                <div class="col-12">
                    <div class="card bg-light">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-success">
                                        <i class="fas fa-lightbulb me-1"></i>질문하기 전에 확인하세요
                                    </h6>
                                    <p class="mb-2">FAQ에서 자주 묻는 질문과 답변을 먼저 확인해보세요.</p>
                                    <a href="/board?type=faq" class="btn btn-warning btn-sm">
                                        <i class="fas fa-question-circle me-1"></i>FAQ 보기
                                    </a>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-info">
                                        <i class="fas fa-phone me-1"></i>긴급 문의
                                    </h6>
                                    <p class="mb-2">긴급한 문의사항은 전화로 상담받으실 수 있습니다.</p>
                                    <p class="mb-0">
                                        <strong class="text-primary">1588-0000</strong>
                                        <small class="text-muted">(평일 09:00~18:00)</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 푸터 -->
    <footer th:replace="~{layout/footer :: footer}"></footer>
    
    <!-- JavaScript -->
    <div th:replace="~{layout/footer :: scripts}"></div>

    <script>
        // Q&A 카테고리 필터링
        function filterQNA(category) {
            const items = document.querySelectorAll('.qna-item');
            const buttons = document.querySelectorAll('.btn-group button');
            
            // 버튼 활성화 상태 변경
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Q&A 아이템 필터링
            items.forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const qnaItems = document.querySelectorAll('.qna-item');
            
            qnaItems.forEach(item => {
                item.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#f8f9fa';
                });
                
                item.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = '';
                });
            });
        });
    </script>
    
    <!-- 게시판 네비게이션 공통 스크립트 -->
    <script src="/js/board-navigation.js"></script>
</body>
</html>
````

## File: src/main/resources/templates/facility/edit.backup.html
````html
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/header :: header}">
    <title>시설 정보 수정 - 라이트케어</title>
</head>

<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="container my-4">
    <!-- 브레드크럼 -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">홈</a></li>
            <li class="breadcrumb-item"><a href="/facility/search">시설 찾기</a></li>
            <li class="breadcrumb-item"><a href="/facility/manage">내 시설 관리</a></li>
            <li class="breadcrumb-item active" aria-current="page">시설 정보 수정</li>
        </ol>
    </nav>
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-edit me-2"></i>시설 정보 수정
                    </h3>
                </div>
                <div class="card-body">
                    <form id="facilityEditForm" th:action="@{/facility/edit/{id}(id=${facility.facilityId})}" 
                          method="post" enctype="multipart/form-data" th:object="${facility}">
                        
                        <!-- 시설명 -->
                        <div class="mb-3">
                            <label for="facilityName" class="form-label">
                                <i class="fas fa-building me-1"></i>시설명 <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="facilityName" th:field="*{facilityName}"
                                   placeholder="시설명을 입력하세요" required>
                        </div>

                        <!-- 시설 유형 -->
                        <div class="mb-3">
                            <label for="facilityType" class="form-label">
                                <i class="fas fa-tag me-1"></i>시설 유형 <span class="text-danger">*</span>
                            </label>
                            <select class="form-select" id="facilityType" th:field="*{facilityType}" required>
                                <option value="">시설 유형을 선택하세요</option>
                                <option value="NURSING_HOME">요양원</option>
                                <option value="HOSPITAL">요양병원</option>
                                <option value="DAY_CARE">데이케어센터</option>
                            </select>
                        </div>

                        <!-- 주소 -->
                        <div class="mb-3">
                            <label for="facilityAddress" class="form-label">
                                <i class="fas fa-map-marker-alt me-1"></i>주소 <span class="text-danger">*</span>
                            </label>
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" id="facilityAddress" th:field="*{address}"
                                       placeholder="주소 검색 버튼을 클릭하세요" readonly required>
                                <button type="button" class="btn btn-outline-primary" onclick="searchFacilityAddress()">
                                    <i class="fas fa-search me-1"></i>주소 검색
                                </button>
                            </div>
                            <input type="text" class="form-control" id="detailAddress" th:field="*{detailAddress}"
                                   placeholder="상세 주소를 입력하세요 (예: 101호, 2층)">
                            <!-- 위도/경도 히든 필드 -->
                            <input type="hidden" id="latitude" th:field="*{latitude}">
                            <input type="hidden" id="longitude" th:field="*{longitude}">
                        </div>
                        
                        <!-- 위치 미리보기 지도 -->
                        <div class="mb-3" id="mapPreviewContainer" style="display: none;">
                            <label class="form-label">
                                <i class="fas fa-map me-1"></i>위치 미리보기
                            </label>
                            <div id="previewMap" style="width:100%; height:200px; border-radius: 8px; border: 1px solid #dee2e6;"></div>
                            <small class="form-text text-muted">선택된 주소의 위치가 지도에 표시됩니다.</small>
                        </div>

                        <!-- 시설 전화번호 -->
                        <div class="mb-3">
                            <label for="phone" class="form-label">
                                <i class="fas fa-phone me-1"></i>시설 전화번호 <span class="text-danger">*</span>
                            </label>
                            <input type="tel" class="form-control" id="phone" th:field="*{phone}"
                                   placeholder="전화번호를 입력하세요 (지역번호에 맞게 자동 포맷팅)" required>
                            <small class="form-text text-muted">
                                <strong>지역번호 예시:</strong> 
                                서울(02), 부산(051), 대구(053), 인천(032), 광주(062), 대전(042), 울산(052) 등<br>
                                <strong>형식:</strong> 042는 3-3-4, 02는 2-3-4 또는 2-4-4 형식으로 자동 적용됩니다
                            </small>
                        </div>

                        <!-- 현재 시설 이미지 (있는 경우) -->
                        <div class="mb-3" th:if="${facility.facilityImage}">
                            <label class="form-label">
                                <i class="fas fa-image me-1"></i>현재 시설 사진
                            </label>
                            <div class="current-image-container mb-3" style="position: relative; display: inline-block;">
                                <img th:src="@{${facility.facilityImage}}" alt="현재 시설 사진" 
                                     style="max-width: 300px; max-height: 200px; border-radius: 12px; border: 2px solid #dee2e6; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                                <div class="current-image-overlay" style="position: absolute; top: 8px; right: 8px;">
                                    <span class="badge bg-primary">현재 이미지</span>
                                </div>
                            </div>
                        </div>

                        <!-- 새 시설 이미지 업로드 -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-cloud-upload-alt me-1"></i>시설 사진 
                                <span th:if="${facility.facilityImage == null}" class="text-danger">*</span>
                                <span th:if="${facility.facilityImage != null}" class="text-muted">(새 이미지로 변경)</span>
                            </label>
                            
                            <!-- 새로운 이미지 업로더 컴포넌트 -->
                            <div id="facilityImageUploader"></div>
                            
                            <!-- 숨겨진 파일 입력 (기존 폼과 호환성을 위해) -->
                            <input type="file" id="facilityImageFile" name="facilityImageFile" 
                                   accept="image/*" style="display: none;"
                                   th:required="${facility.facilityImage == null}">
                            
                            <!-- Alt 텍스트 입력 (SEO용) -->
                            <input type="hidden" id="facilityImageAltText" name="facilityImageAltText" 
                                   th:value="${facility.facilityImageAltText}">
                        </div>

                        <!-- 수용 인원 -->
                        <div class="mb-3">
                            <label for="capacity" class="form-label">
                                <i class="fas fa-users me-1"></i>수용 인원
                            </label>
                            <input type="number" class="form-control" id="capacity" th:field="*{capacity}"
                                   placeholder="수용 가능 인원을 입력하세요" min="1">
                        </div>

                        <!-- 운영 시간 -->
                        <div class="mb-3">
                            <label for="operatingHours" class="form-label">
                                <i class="fas fa-clock me-1"></i>운영 시간
                            </label>
                            <div class="row g-2">
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operatingType" id="operating24" 
                                               value="24시간" th:checked="${facility.operatingHours == '24시간'}">
                                        <label class="form-check-label fw-bold text-success" for="operating24">
                                            <i class="fas fa-clock me-1"></i>24시간 운영
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operatingType" id="operatingCustom" 
                                               value="custom" th:checked="${facility.operatingHours != '24시간' && facility.operatingHours != null}">
                                        <label class="form-check-label" for="operatingCustom">
                                            <i class="fas fa-clock me-1"></i>시간 직접 설정
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operatingType" id="operatingWeekly" value="weekly">
                                        <label class="form-check-label" for="operatingWeekly">
                                            <i class="fas fa-calendar-week me-1"></i>요일별 시간 설정
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 간단한 시간 설정 -->
                            <div id="simpleTimeContainer" class="mt-3" style="display: none;">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title mb-3">운영 시간 설정</h6>
                                        <div class="row g-2">
                                            <div class="col-md-6">
                                                <label class="form-label small">시작 시간</label>
                                                <select class="form-select" id="startHour">
                                                    <option value="">시</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label small">종료 시간</label>
                                                <select class="form-select" id="endHour">
                                                    <option value="">시</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle me-1"></i>
                                                매일 동일한 시간으로 설정됩니다
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 요일별 시간 설정 -->
                            <div id="weeklyTimeContainer" class="mt-3" style="display: none;">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title mb-3">요일별 운영 시간</h6>
                                        <div id="weeklySchedule">
                                            <!-- JavaScript로 동적 생성 -->
                                        </div>
                                        
                                        <div class="mt-3">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle me-1"></i>
                                                운영하지 않는 요일은 체크를 해제하세요
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 직접 입력 -->
                            <div id="customTimeContainer" class="mt-3" style="display: none;">
                                <input type="text" class="form-control" id="customOperatingHours" 
                                       placeholder="예: 09:00-18:00, 평일 09:00-18:00 주말 10:00-16:00"
                                       th:value="${facility.operatingHours != '24시간' ? facility.operatingHours : ''}">
                                <small class="form-text text-muted">
                                    자유 형식으로 운영 시간을 입력하세요
                                </small>
                            </div>
                            
                            <input type="hidden" id="operatingHours" th:field="*{operatingHours}">
                        </div>

                        <!-- 홈페이지 -->
                        <div class="mb-3">
                            <label for="homepage" class="form-label">
                                <i class="fas fa-globe me-1"></i>홈페이지 URL
                            </label>
                            <input type="url" class="form-control" id="homepage" th:field="*{homepage}"
                                   placeholder="https://www.example.com">
                        </div>

                        <!-- 시설 설명 -->
                        <div class="mb-3">
                            <label for="description" class="form-label">
                                <i class="fas fa-info-circle me-1"></i>시설 설명
                            </label>
                            <textarea class="form-control" id="description" th:field="*{description}" rows="4"
                                      placeholder="시설에 대한 설명을 입력하세요"
                                      data-rich-editor='{"height": "250px", "enableImage": true, "enableTable": false, "enableLink": true}'></textarea>
                        </div>

                        <!-- 시설 특징 -->
                        <div class="mb-3">
                            <label for="features" class="form-label">
                                <i class="fas fa-star me-1"></i>시설 특징
                            </label>
                            <input type="text" class="form-control" id="features" th:field="*{features}"
                                   placeholder="시설의 주요 특징을 쉼표로 구분하여 입력하세요 (예: 24시간 간병서비스, 물리치료실, 카페)">
                            <small class="form-text text-muted">쉼표(,)로 구분하여 여러 특징을 입력할 수 있습니다</small>
                        </div>

                        <!-- 버튼 -->
                        <div class="d-flex gap-2 justify-content-end">
                            <a th:href="@{/facility/manage}" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>취소
                            </a>
                            <button type="submit" class="btn btn-primary" id="submitButton">
                                <i class="fas fa-save me-2"></i>수정 완료
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 카카오 주소 검색 API -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<!-- 카카오맵 API (좌표 변환용) -->
<script type="text/javascript" th:src="@{//dapi.kakao.com/v2/maps/sdk.js(appkey=${@environment.getProperty('api.kakao.app-key')}, libraries='services')}"></script>
<!-- 카카오맵 유틸리티 -->
<script src="/js/kakaomap.js"></script>
<script src="/js/facility-edit.js"></script>

<!-- 전화번호 포맷터 -->
<script src="/js/phone-formatter.js"></script>

<!-- 고급 이미지 크롭퍼 -->
<link rel="stylesheet" href="/css/advanced-image-cropper.css">
<script src="/js/advanced-image-cropper.js"></script>

<!-- 리치 텍스트 에디터 -->
<link rel="stylesheet" href="/css/rich-text-editor.css">
<script src="/js/rich-text-editor.js"></script>

<script>
$(document).ready(function() {
    console.log('Initializing operating hours...');
    
    // 시간 옵션 동적 생성
    initializeTimeOptions();
    
    // 요일별 스케줄 미리 생성
    generateWeeklySchedule();
    
    // 직접 입력 변경 이벤트
    $('#customOperatingHours').on('input', function() {
        updateOperatingHours();
    });
    
    // 초기 상태 설정
    initializeOperatingHours();
});

function initializeTimeOptions() {
    // 시작 시간 옵션 생성
    for (let i = 0; i <= 23; i++) {
        const hour = String(i).padStart(2, '0');
        $('#startHour').append(`<option value="${hour}">${hour}시</option>`);
        $('#endHour').append(`<option value="${hour}">${hour}시</option>`);
    }
}

function generateWeeklySchedule() {
    console.log('Generating weekly schedule...');
    const days = ['월요일', '화요일', '수요일', '목요일', '금요일', '토요일', '일요일'];
    let html = '';
    
    days.forEach((day, index) => {
        html += `
            <div class="row g-2 mb-2">
                <div class="col-3">
                    <div class="form-check">
                        <input class="form-check-input day-check" type="checkbox" id="day${index}" checked>
                        <label class="form-check-label" for="day${index}">${day}</label>
                    </div>
                </div>
                <div class="col-9 time-controls">
                    <div class="d-flex align-items-center gap-2">
                        <select class="form-select form-select-sm day-start" id="start${index}" style="width: 80px;">
                            <option value="">시작</option>
                        </select>
                        <span>시 ~</span>
                        <select class="form-select form-select-sm day-end" id="end${index}" style="width: 80px;">
                            <option value="">종료</option>
                        </select>
                        <span>시</span>
                    </div>
                    <div class="rest-day-notice text-muted small mt-1" style="display: none;">
                        <i class="fas fa-moon me-1"></i>휴무일
                    </div>
                </div>
            </div>
        `;
    });
    
    $('#weeklySchedule').html(html);
    
    // 시간 옵션 추가
    for (let i = 0; i <= 23; i++) {
        const hour = String(i).padStart(2, '0');
        days.forEach((day, index) => {
            $(`#start${index}`).append(`<option value="${hour}">${hour}</option>`);
            $(`#end${index}`).append(`<option value="${hour}">${hour}</option>`);
        });
    }
    
    // 이벤트 리스너 추가
    setTimeout(function() {
        $('.day-check').off('change').on('change', function() {
            const index = $(this).attr('id').replace('day', '');
            const timeControls = $(this).closest('.row').find('.time-controls');
            const restNotice = timeControls.find('.rest-day-notice');
            const selects = timeControls.find('select');
            
            if ($(this).is(':checked')) {
                selects.show();
                timeControls.find('span').show();
                restNotice.hide();
            } else {
                selects.hide();
                timeControls.find('span').hide();
                restNotice.show();
            }
            
            updateOperatingHours();
        });
        
        $('.day-start, .day-end').off('change').on('change', function() {
            updateOperatingHours();
        });
        
        // 간단한 시간 설정 이벤트도 여기서 등록
        $('#startHour, #endHour').off('change').on('change', function() {
            updateOperatingHours();
        });
    }, 100);
}

function initializeOperatingHours() {
    const currentHours = $('#operatingHours').val();
    
    if (currentHours === '24시간') {
        $('#operating24').prop('checked', true);
    } else if (currentHours && currentHours !== '') {
        $('#operatingCustom').prop('checked', true);
        $('#customTimeContainer').show();
        $('#customOperatingHours').val(currentHours);
    }
}

function updateOperatingHours() {
    const operatingType = $('input[name="operatingType"]:checked').val();
    let operatingHours = '';
    
    if (operatingType === '24시간') {
        operatingHours = '24시간';
    } else if (operatingType === 'simple') {
        const startHour = $('#startHour').val();
        const endHour = $('#endHour').val();
        
        if (startHour && endHour) {
            operatingHours = `${startHour}:00-${endHour}:00`;
        }
    } else if (operatingType === 'weekly') {
        const weeklyHours = [];
        const days = ['월', '화', '수', '목', '금', '토', '일'];
        
        $('.day-check').each(function(index) {
            if ($(this).is(':checked')) {
                const startHour = $(`#start${index}`).val();
                const endHour = $(`#end${index}`).val();
                
                if (startHour && endHour) {
                    weeklyHours.push(`${days[index]} ${startHour}:00-${endHour}:00`);
                }
            } else {
                weeklyHours.push(`${days[index]} 휴무`);
            }
        });
        
        operatingHours = weeklyHours.join(', ');
    } else if (operatingType === 'custom') {
        operatingHours = $('#customOperatingHours').val();
    }
    
    $('#operatingHours').val(operatingHours);
}


// 간단한 시간 설정 라디오 버튼 동적 추가
$(document).ready(function() {
    const simpleOption = `
        <div class="col-12">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="operatingType" id="operatingSimple" value="simple">
                <label class="form-check-label" for="operatingSimple">
                    <i class="fas fa-clock me-1"></i>간단한 시간 설정
                </label>
            </div>
        </div>
    `;
    
    $('#operatingCustom').closest('.col-12').after(simpleOption);
    
    // 이벤트 리스너 다시 등록
    setTimeout(function() {
        $('input[name="operatingType"]').off('change').on('change', function() {
            const value = $(this).val();
            console.log('Operating type changed:', value);
            
            // 모든 컨테이너 숨기기
            $('#simpleTimeContainer, #weeklyTimeContainer, #customTimeContainer').hide();
            
            if (value === 'custom') {
                $('#customTimeContainer').show();
            } else if (value === 'weekly') {
                $('#weeklyTimeContainer').show();
                generateWeeklySchedule();
            } else if (value === 'simple') {
                $('#simpleTimeContainer').show();
            }
            
            updateOperatingHours();
        });
    }, 100);
    
    // 고급 이미지 크롭퍼 초기화
    initializeFacilityImageCropper();
});

// 시설 이미지 크롭퍼 초기화
function initializeFacilityImageCropper() {
    const facilityImageCropper = new AdvancedImageCropper('facilityImageUploader', {
        // 시설 이미지 최적화 설정
        aspectRatio: 16/10, // 시설 카드 비율
        cropWidth: 800,
        cropHeight: 500,
        previewStyle: 'facility',
        title: '시설 이미지 업로드',
        quality: 0.8,
        enableAltText: true,
        
        // 크롭 완료 콜백
        onCropComplete: function(result) {
            console.log('시설 이미지 크롭 완료:', result);
            
            // 기존 파일 입력에 압축된 파일 설정
            const facilityImageFile = document.getElementById('facilityImageFile');
            const facilityImageAltText = document.getElementById('facilityImageAltText');
            
            // DataTransfer를 사용하여 File 객체를 input에 설정
            const dataTransfer = new DataTransfer();
            const compressedFile = new File([result.compressedBlob], 
                result.originalFile.name, {
                    type: 'image/jpeg',
                    lastModified: Date.now()
                });
            
            dataTransfer.items.add(compressedFile);
            facilityImageFile.files = dataTransfer.files;
            
            // Alt 텍스트 설정
            if (facilityImageAltText) {
                facilityImageAltText.value = result.altText;
            }
            
            // 성공 메시지 표시
            showSuccessMessage('시설 이미지가 성공적으로 최적화되었습니다!');
        },
        
        // 에러 콜백
        onError: function(message) {
            console.error('시설 이미지 크롭 오류:', message);
            showErrorMessage('이미지 처리 중 오류가 발생했습니다: ' + message);
        }
    });
    
    // 전역에서 접근 가능하도록 저장
    window.facilityImageCropper = facilityImageCropper;
}

// 성공 메시지 표시
function showSuccessMessage(message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-success alert-dismissible fade show';
    alertDiv.innerHTML = `
        <i class="fas fa-check-circle me-2"></i>${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // 폼 상단에 메시지 삽입
    const form = document.getElementById('facilityEditForm');
    form.insertBefore(alertDiv, form.firstChild);
    
    // 5초 후 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}

// 에러 메시지 표시
function showErrorMessage(message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-danger alert-dismissible fade show';
    alertDiv.innerHTML = `
        <i class="fas fa-exclamation-triangle me-2"></i>${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // 폼 상단에 메시지 삽입
    const form = document.getElementById('facilityEditForm');
    form.insertBefore(alertDiv, form.firstChild);
    
    // 10초 후 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 10000);
}
</script>

</body>
</html>
````

## File: src/main/resources/templates/review/edit.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title th:text="${pageTitle + ' - CareLink'}">리뷰 수정 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>

    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <div class="container mt-4">
            <!-- 페이지 제목 -->
            <div class="row mb-4">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">홈</a></li>
                            <li class="breadcrumb-item"><a href="/facility/search">시설 찾기</a></li>
                            <li class="breadcrumb-item"><a href="/review">시설 리뷰</a></li>
                            <li class="breadcrumb-item">
                                <a th:href="@{/review/detail/{id}(id=${reviewDTO.reviewId})}" th:text="${reviewDTO.title}">리뷰 제목</a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">수정</li>
                        </ol>
                    </nav>
                    <h2>
                        <i class="fas fa-edit text-primary me-2"></i> 
                        리뷰 수정
                    </h2>
                    <p class="text-muted">리뷰 정보를 수정할 수 있습니다.</p>
                </div>
            </div>

            <!-- 리뷰 수정 폼 -->
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h4 class="mb-0">
                                <i class="fas fa-star me-2"></i>리뷰 수정
                            </h4>
                        </div>
                        <div class="card-body">
                            <form th:action="@{/review/update}" method="post" th:object="${reviewDTO}" id="reviewEditForm">
                                <!-- 리뷰 ID (hidden) -->
                                <input type="hidden" th:field="*{reviewId}">
                                <input type="hidden" th:field="*{facilityId}">
                                <input type="hidden" th:field="*{memberId}">
                                
                                <!-- 시설 정보 표시 (읽기 전용) -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">시설 정보</label>
                                    <div class="p-3 bg-light rounded">
                                        <h6 class="mb-1" th:text="${reviewDTO.facilityName}">시설명</h6>
                                        <small class="text-muted">선택된 시설은 변경할 수 없습니다.</small>
                                    </div>
                                </div>

                                <!-- 제목 -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">제목 *</label>
                                    <input type="text" class="form-control" th:field="*{title}" id="title"
                                           placeholder="리뷰 제목을 입력해주세요" 
                                           maxlength="200" required>
                                    <div class="form-text">최대 200자까지 입력 가능합니다.</div>
                                </div>

                                <!-- 전체 평점 -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">전체 평점 *</label>
                                    <div class="rating-section">
                                        <div class="rating-stars" id="overallRating">
                                            <span class="star" data-rating="1">★</span>
                                            <span class="star" data-rating="2">★</span>
                                            <span class="star" data-rating="3">★</span>
                                            <span class="star" data-rating="4">★</span>
                                            <span class="star" data-rating="5">★</span>
                                        </div>
                                        <span class="rating-text ms-3" id="ratingText">평점을 선택해주세요</span>
                                        <input type="hidden" th:field="*{rating}" id="ratingValue" required>
                                    </div>
                                </div>

                                <!-- 세부 평점 -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">세부 평점 (선택사항)</label>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <div class="rating-group">
                                                <label class="form-label">서비스</label>
                                                <div class="detailed-rating" data-field="service">
                                                    <span class="star" data-rating="1">★</span>
                                                    <span class="star" data-rating="2">★</span>
                                                    <span class="star" data-rating="3">★</span>
                                                    <span class="star" data-rating="4">★</span>
                                                    <span class="star" data-rating="5">★</span>
                                                </div>
                                                <input type="hidden" th:field="*{serviceRating}" class="detailed-rating-input">
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="rating-group">
                                                <label class="form-label">시설</label>
                                                <div class="detailed-rating" data-field="facility">
                                                    <span class="star" data-rating="1">★</span>
                                                    <span class="star" data-rating="2">★</span>
                                                    <span class="star" data-rating="3">★</span>
                                                    <span class="star" data-rating="4">★</span>
                                                    <span class="star" data-rating="5">★</span>
                                                </div>
                                                <input type="hidden" th:field="*{facilityRating}" class="detailed-rating-input">
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="rating-group">
                                                <label class="form-label">직원</label>
                                                <div class="detailed-rating" data-field="staff">
                                                    <span class="star" data-rating="1">★</span>
                                                    <span class="star" data-rating="2">★</span>
                                                    <span class="star" data-rating="3">★</span>
                                                    <span class="star" data-rating="4">★</span>
                                                    <span class="star" data-rating="5">★</span>
                                                </div>
                                                <input type="hidden" th:field="*{staffRating}" class="detailed-rating-input">
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="rating-group">
                                                <label class="form-label">가격</label>
                                                <div class="detailed-rating" data-field="price">
                                                    <span class="star" data-rating="1">★</span>
                                                    <span class="star" data-rating="2">★</span>
                                                    <span class="star" data-rating="3">★</span>
                                                    <span class="star" data-rating="4">★</span>
                                                    <span class="star" data-rating="5">★</span>
                                                </div>
                                                <input type="hidden" th:field="*{priceRating}" class="detailed-rating-input">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 리뷰 내용 -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">리뷰 내용 *</label>
                                    <textarea class="form-control" rows="8" th:field="*{content}" id="content"
                                              placeholder="시설 이용 경험을 자세히 작성해주세요." 
                                              maxlength="2000" required
                                              data-rich-editor='{"height": "350px", "maxLength": 2000}'></textarea>
                                    <div class="form-text">
                                        <span id="contentLength">0</span>/2000자 (최소 10자 이상 작성해주세요)
                                    </div>
                                </div>

                                <!-- 버튼 -->
                                <div class="d-flex justify-content-between">
                                    <a th:href="@{/review/detail/{id}(id=${reviewDTO.reviewId})}" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left me-1"></i>취소
                                    </a>
                                    <button type="submit" class="btn btn-primary" id="submitBtn">
                                        <i class="fas fa-save me-1"></i>리뷰 수정
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 푸터 -->
    <footer th:replace="~{layout/footer :: footer}"></footer>

    <!-- 스타일 -->
    <style>
        /* 전체 평점 스타일 */
        #overallRating {
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        #overallRating .star {
            color: #ddd;
            transition: color 0.2s;
            cursor: pointer;
        }
        
        #overallRating .star:hover,
        #overallRating .star.active {
            color: #ffc107 !important;
        }
        
        /* 세부 평점 스타일 */
        .detailed-rating {
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .detailed-rating .star {
            color: #ddd;
            transition: color 0.2s;
            cursor: pointer;
        }
        
        .detailed-rating .star:hover,
        .detailed-rating .star.active {
            color: #ffc107 !important;
        }
        
        .rating-group {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 0.375rem;
            border: 1px solid #dee2e6;
        }
        
        .rating-text {
            font-weight: 500;
            color: #495057;
        }
    </style>

    <!-- JavaScript -->
    <script th:src="@{/js/review-write.js}"></script>
</body>
</html>
````

## File: CLAUDE.md
````markdown
# CLAUDE.md

이 문서는 이 저장소에서 Claude Code (claude.ai/code)가 코드를 다룰 때 참고할 가이드입니다.

---

## 📌 프로젝트 개요

이 프로젝트는 한국 팀원 4명이 개발하는 \*\*요양원 구인구직 웹사이트 "라이트케어(LightCare)"\*\*입니다. 이 플랫폼은 요양 시설과 요양업계 구직자를 연결해주는 서비스입니다.

---

## 🛠 기술 스택

* **백엔드**: Spring Boot 2.7.18, MyBatis, MySQL
* **프론트엔드**: Thymeleaf 템플릿, Bootstrap 5, JavaScript
* **빌드 도구**: Gradle (Java 11 사용)
* **데이터베이스**: MySQL (문자 인코딩 utf8mb4)

---

## ⚙️ 공통 개발 명령어

### 빌드 및 실행

```bash
# 프로젝트 빌드
./gradlew build

# 애플리케이션 실행
./gradlew bootRun

# 빌드 결과물 정리
./gradlew clean

# 테스트 실행
./gradlew test

# 코드 품질 검사
./gradlew check
```

### 데이터베이스 설정

```bash
# MySQL 접속 및 DB 생성
mysql -u root -p
CREATE DATABASE carelink CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 스키마 초기화
# src/main/resources/schema.sql 파일을 MySQL에서 실행
```

### 개발 서버 정보

* 실행 주소: `http://localhost:8080`
* DB 연결 주소: `jdbc:mysql://localhost:3306/carelink`
* DevTools를 통한 핫 리로드(Hot Reload) 적용됨

---

## 🧱 아키텍처 개요

### 팀 구조 (4인 협업)

기능 중심의 분업 구조로 운영됩니다:

* **팀원 A**: 회원 관리 (로그인, 회원가입, 내 정보)
* **팀원 B**: 시설 검색 및 지도 연동 (카카오맵)
* **팀원 C**: 구인구직 게시판 (공고 작성, 지원)
* **팀원 D**: 리뷰 시스템 및 정보 게시판

### 패키지 구조

```
com.example.carelink/
├── controller/          # 컨트롤러 계층
├── service/            # 서비스 계층 (비즈니스 로직)
├── dao/               # DAO 계층 (MyBatis 매퍼)
├── dto/               # DTO 객체
└── common/            # 공통 유틸 및 상수
```

### 데이터베이스 설계

관계형 테이블 기반으로 외래키(FK)를 적절히 사용:

* **member**: 사용자 계정 및 인증 정보
* **facility**: 요양시설 정보 (위치 좌표 포함)
* **job\_posting**: 구인공고 정보
* **review**: 시설 리뷰 및 평점
* **board**: 커뮤니티/정보 게시판

### MyBatis 구성

* 설정 파일: `src/main/resources/mybatis-config.xml`
* 매퍼 XML: `src/main/resources/mapper/*.xml`
* camelCase → underscore 자동 매핑 설정
* DTO용 typeAlias 사용

---

## 🎨 프론트엔드 구조

* **Thymeleaf**: Spring Boot 연동 서버사이드 템플릿
* **레이아웃 시스템**: `templates/layout/` 폴더에 header/footer 분리
* **정적 리소스**: `src/main/resources/static/` 폴더에 CSS/JS 저장
* **Bootstrap 5**: 반응형 UI 프레임워크 적용

---

## 🧾 주요 설정 파일

### application.yml

* 서버 포트: 8080
* 데이터베이스 연결 정보
* 개발 시 Thymeleaf 캐시 비활성화
* 파일 업로드 최대 용량 10MB
* MyBatis 매퍼 위치 지정

### 기타 설정 사항

* UTF-8 한글 지원 활성화
* MyBatis 및 Spring Web 로그 출력 설정
* DB 타임존: Asia/Seoul

---

## 🔄 개발 패턴

### 컨트롤러 패턴

Spring MVC 구조를 따름:

* `@Controller` 사용
* Model로 View 데이터 전달
* HTTP Method (@GetMapping, @PostMapping 등) 명확히 구분
* `@Slf4j`로 로깅

### 서비스 계층

컨트롤러와 로직 분리:

* 트랜잭션 처리
* 입력 검증
* 횡단 관심사 관리

### MyBatis 매퍼

XML 기반 SQL 정의:

* `#{}` 사용한 파라미터 바인딩
* DTO 매핑 설정
* JOIN 활용한 복합 조회 처리

---

## ✅ 테스트

### 테스트 구조

* 단위 테스트: JUnit 5
* 통합 테스트: Spring Boot Test
* 테스트 설정은 운영과 별도 구성

### 테스트 명령어

```bash
# 전체 테스트 실행
./gradlew test

# 특정 클래스만 실행
./gradlew test --tests "ClassName"
```

---

## 🤝 팀 협업 규칙

### Git 워크플로우

* 기능 브랜치 명: `feature/member-기능명`
* 커밋 메시지: `[feat] 기능 설명`
* PR을 통한 코드 리뷰 진행

### 코드 컨벤션

* 클래스명: PascalCase
* 메서드명: camelCase
* 상수명: UPPER\_SNAKE\_CASE
* 패키지명: 모두 소문자

---

## ⚠️ 특이 사항

### 한글 지원

* 모든 텍스트 콘텐츠는 한글로 작성
* UTF-8 인코딩 유지
* 주석/문서도 한글 기반

### 지도 연동

* 카카오맵 API 연동 예정
* 위도/경도 기반 시설 검색 기능 포함

### 사용자 역할

* `USER`: 일반 구직자
* `FACILITY`: 요양시설 관리자
* `ADMIN`: 시스템 관리자

---

## 🌐 환경 변수

환경 설정 시 아래 항목 필요:

* `spring.datasource.password`: MySQL 비밀번호
* DB 주소가 다를 경우 `spring.datasource.url` 수정
* 추후 지도 API 키 등록 필요 (예정)

### 🟢 팀원 D (리뷰/게시판) - 진행률: 100%

#### ✅ **완료된 작업**
**백엔드 완전 구현**:
- ✅ `ReviewService.java` (238줄) - **완전 구현**
  - 리뷰 CRUD 로직
  - 트랜잭션 처리
  - 로깅 추가
  - 유효성 검증
  - 평점 시스템
  - 추천/비추천 기능

- ✅ `BoardService.java` (253줄) - **완전 구현**
  - 게시글 CRUD 로직
  - 페이징 처리
  - 검색 및 카테고리 필터링
  - 인기 게시글 기능
  - 조회수 증가 로직

- ✅ `ReviewMapper.java` & `reviewMapper.xml` - **완전 구현**
  - 모든 필요 메서드 정의
  - XML 쿼리 매핑 완료

- ✅ `BoardMapper.java` & `boardMapper.xml` - **완전 구현**
  - 모든 필요 메서드 정의
  - XML 쿼리 매핑 완료

**프론트엔드 완성**:
- ✅ `templates/review/list.html` (108줄) - **완전 구현**
- ✅ `templates/review/write.html` (122줄) - **완전 구현**
- ✅ `templates/board/list.html` - **완전 구현**
- ✅ `templates/board/write.html` - **완전 구현**
- ✅ `templates/board/detail.html` - **완전 구현**

#### 📊 **실제 Story Point 달성률**
- **완료**: LC-010 (리뷰 작성) - 13/13 SP ✅
- **완료**: LC-011 (리뷰 목록 관리) - 13/13 SP ✅
- **완료**: LC-012 (정보 게시판) - 13/13 SP ✅

**총 달성**: 39/39 SP (100%)

#### 🚀 **다음 단계**
1. **단위 테스트 작성**
   - ReviewService 테스트
   - BoardService 테스트
   - 통합 테스트

2. **성능 최적화**
   - 쿼리 최적화
   - 캐싱 적용
   - N+1 문제 해결

3. **추가 기능 개발**
   - 댓글 시스템 고도화
   - 파일 첨부 기능
   - 에디터 기능 강화
````

## File: docker-compose.yml
````yaml
version: '3.8'

services:
  # Spring Boot 애플리케이션
  app:
    build: .
    container_name: carelink-app
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - DB_URL=${DB_URL:-jdbc:mysql://db:3306/carelink?useSSL=false&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=UTF-8}
      - DB_USERNAME=${DB_USERNAME:-root}
      - DB_PASSWORD=${DB_PASSWORD:-mysql}
      - KAKAO_APP_KEY=${KAKAO_APP_KEY:-0948e3e4faa457fb6083f68e1ce10458}
      - KAKAO_REST_API_KEY=${KAKAO_REST_API_KEY:-0948e3e4faa457fb6083f68e1ce10458}
      - UPLOAD_BASE_PATH=${UPLOAD_BASE_PATH:-/carelink-uploads/}
    volumes:
      - carelink-uploads:/carelink-uploads
    depends_on:
      - db
    restart: unless-stopped
    networks:
      - carelink-network

  # MySQL 데이터베이스
  db:
    image: mysql:8.0
    container_name: carelink-db
    ports:
      - "3306:3306"
    environment:
      - MYSQL_DATABASE=${MYSQL_DATABASE:-carelink}
      - MYSQL_ROOT_PASSWORD=${DB_PASSWORD:-mysql}
      - TZ=Asia/Seoul
    volumes:
      - carelink-db-data:/var/lib/mysql
      - ./src/main/resources/schema.sql:/docker-entrypoint-initdb.d/1.schema.sql
    command: 
      - --character-set-server=utf8mb4
      - --collation-server=utf8mb4_unicode_ci
      - --skip-character-set-client-handshake
      - --default-authentication-plugin=mysql_native_password
    restart: unless-stopped
    networks:
      - carelink-network

volumes:
  carelink-uploads:
    name: carelink-uploads
  carelink-db-data:
    name: carelink-db-data

networks:
  carelink-network:
    name: carelink-network
````

## File: README.md
````markdown
# LightCare (라이트케어) - 요양원 구인구직 플랫폼

![Spring Boot](https://img.shields.io/badge/Spring%20Boot-2.7.18-brightgreen.svg)
![Java](https://img.shields.io/badge/Java-11-orange.svg)
![MySQL](https://img.shields.io/badge/MySQL-8.0-blue.svg)
![MyBatis](https://img.shields.io/badge/MyBatis-2.3.1-red.svg)
![Build Status](https://img.shields.io/badge/Build-Passing-success.svg)

## 📖 프로젝트 개요

LightCare는 한국의 요양원 및 노인요양시설과 구직자를 연결하는 전문 구인구직 플랫폼입니다. 고령화 사회에 필요한 요양 서비스 인력을 효율적으로 매칭하고, 시설과 근로자 모두에게 최적화된 환경을 제공합니다.

### 🎯 주요 기능

- **👥 회원 관리**: 구직자 및 시설 관리자 회원가입/로그인
- **🏥 시설 검색**: 카카오맵 연동 시설 위치 검색 및 상세 정보
- **💼 구인구직**: 채용공고 등록/검색, 지원 시스템
- **⭐ 리뷰 시스템**: 시설 평가 및 후기 공유
- **📋 정보 게시판**: 업계 정보 및 공지사항

## 🛠 기술 스택

### Backend
- **Framework**: Spring Boot 2.7.18
- **Language**: Java 11
- **Database**: MySQL 8.0
- **ORM**: MyBatis 2.3.1
- **Build Tool**: Gradle
- **Template Engine**: Thymeleaf

### Frontend
- **Template**: Thymeleaf
- **Styling**: Bootstrap 5, CSS3
- **JavaScript**: Vanilla JS
- **Maps**: Kakao Maps API

### Development Tools
- **IDE**: IntelliJ IDEA
- **Version Control**: Git/GitHub
- **Database Tool**: MySQL Workbench

## 🚀 빠른 시작

### 사전 요구사항

- Java 11 이상
- MySQL 8.0 이상
- Git

### 설치 및 실행

1. **레포지토리 클론**
   ```bash
   git clone https://github.com/dooseob/lightcare.git
   cd lightcare
   ```

2. **데이터베이스 설정**
   ```sql
   CREATE DATABASE carelink CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

3. **데이터베이스 연결 설정** (`src/main/resources/application.yml`)
   ```yaml
   spring:
     datasource:
       url: jdbc:mysql://localhost:3306/carelink
       username: root
       password: mysql
   ```

4. **스키마 초기화**
   ```bash
   # MySQL에서 schema.sql 실행
   mysql -u root -p carelink < src/main/resources/schema.sql
   ```

5. **애플리케이션 실행**
   ```bash
   ./gradlew bootRun
   ```

6. **브라우저에서 접속**
   ```
   http://localhost:8080
   ```

## 📁 프로젝트 구조

```
src/
├── main/
│   ├── java/com/example/carelink/
│   │   ├── controller/          # 웹 요청 처리
│   │   │   ├── HomeController.java
│   │   │   ├── MemberController.java
│   │   │   ├── FacilityController.java
│   │   │   ├── JobController.java
│   │   │   ├── ReviewController.java
│   │   │   └── BoardController.java
│   │   ├── service/             # 비즈니스 로직
│   │   │   ├── MemberService.java
│   │   │   ├── FacilityService.java
│   │   │   ├── JobService.java
│   │   │   ├── ReviewService.java
│   │   │   └── BoardService.java
│   │   ├── dao/                 # 데이터 접근 계층
│   │   │   ├── MemberMapper.java
│   │   │   ├── FacilityMapper.java
│   │   │   ├── JobMapper.java
│   │   │   ├── ReviewMapper.java
│   │   │   └── BoardMapper.java
│   │   ├── dto/                 # 데이터 전송 객체
│   │   │   ├── MemberDTO.java
│   │   │   ├── FacilityDTO.java
│   │   │   ├── JobDTO.java
│   │   │   ├── ReviewDTO.java
│   │   │   └── BoardDTO.java
│   │   └── common/              # 공통 유틸리티
│   │       ├── BaseDTO.java
│   │       ├── PageInfo.java
│   │       └── Constants.java
│   └── resources/
│       ├── static/              # 정적 리소스
│       │   ├── css/
│       │   └── js/
│       ├── templates/           # Thymeleaf 템플릿
│       │   ├── layout/
│       │   ├── member/
│       │   ├── facility/
│       │   ├── job/
│       │   ├── review/
│       │   └── board/
│       ├── mapper/              # MyBatis SQL 매퍼
│       │   ├── memberMapper.xml
│       │   ├── facilityMapper.xml
│       │   ├── jobMapper.xml
│       │   ├── reviewMapper.xml
│       │   └── boardMapper.xml
│       ├── application.yml      # 애플리케이션 설정
│       ├── mybatis-config.xml   # MyBatis 설정
│       └── schema.sql          # 데이터베이스 스키마
```

## 👥 팀 구성 및 역할

| 팀원 | 담당 기능 | 주요 구현 사항 |
|------|----------|---------------|
| **팀원 A** | 회원 관리 | 로그인, 회원가입, 프로필 관리, 세션 관리 |
| **팀원 B** | 시설 검색 | 카카오맵 연동, 시설 정보 관리, 위치 기반 검색 |
| **팀원 C** | 구인구직 | 채용공고 게시판, 지원 시스템, 채용 관리 |
| **팀원 D** | 리뷰 & 게시판 | 시설 리뷰, 평점 시스템, 정보 게시판 |

## 🗄 데이터베이스 설계

### 주요 테이블

- **member**: 회원 정보 (구직자, 시설 관리자)
- **facility**: 요양시설 정보 및 위치 데이터
- **job_posting**: 채용공고 정보
- **review**: 시설 리뷰 및 평점
- **board**: 정보 게시판

### ERD
```sql
-- 주요 테이블 관계
-- member (1) ←→ (N) job_posting
-- member (1) ←→ (N) review
-- facility (1) ←→ (N) job_posting
-- facility (1) ←→ (N) review
```

## 🔧 개발 가이드

### 코딩 컨벤션

- **클래스명**: PascalCase (`MemberController`)
- **메서드명**: camelCase (`getMemberInfo`)
- **상수**: UPPER_SNAKE_CASE (`DEFAULT_PAGE_SIZE`)
- **패키지명**: 소문자 (`com.example.carelink`)

### Git 브랜치 전략

```
main                 # 메인 브랜치
├── feature/member   # 팀원 A - 회원 관리
├── feature/facility # 팀원 B - 시설 검색
├── feature/job      # 팀원 C - 구인구직
└── feature/review   # 팀원 D - 리뷰 시스템
```

### 커밋 메시지 형식

```
[feat] 새로운 기능 추가
[fix] 버그 수정
[docs] 문서 수정
[style] 코드 스타일 수정
[refactor] 코드 리팩토링
[test] 테스트 코드 추가
```

## 🧪 테스트

```bash
# 전체 테스트 실행
./gradlew test

# 빌드 및 테스트
./gradlew build

# 코드 품질 검사
./gradlew check
```

## 📝 API 문서

### 주요 엔드포인트

| Method | URL | 설명 |
|--------|-----|------|
| GET | `/` | 메인 페이지 |
| GET/POST | `/member/login` | 로그인 |
| GET/POST | `/member/join` | 회원가입 |
| GET | `/facility/search` | 시설 검색 |
| GET | `/job/list` | 채용공고 목록 |
| GET | `/review/list` | 리뷰 목록 |
| GET | `/board/list` | 게시판 목록 |

## 🐛 트러블슈팅

### 자주 발생하는 문제

1. **데이터베이스 연결 오류**
   ```
   해결: application.yml의 데이터베이스 설정 확인
   ```

2. **MyBatis 매퍼 오류**
   ```
   해결: mapper XML의 namespace와 인터페이스 경로 일치 확인
   ```

3. **Thymeleaf 템플릿 오류**
   ```
   해결: templates 폴더 경로와 컨트롤러 반환값 일치 확인
   ```

## 🔄 최근 업데이트

### v1.0.0 (2025-06-22)
- ✅ 프로젝트 기본 구조 완성
- ✅ 전체 파일 에러 디버깅 완료
- ✅ 페이징 로직 오류 수정
- ✅ Gradle 빌드 설정 개선
- ✅ 코드 품질 개선 (NPE 방지, 중복 코드 제거)

## 🚀 향후 개발 계획

- [ ] **v1.1**: 보안 강화 (비밀번호 암호화, CSRF 보호)
- [ ] **v1.2**: 카카오맵 API 연동 완성
- [ ] **v1.3**: 실시간 알림 시스템
- [ ] **v1.4**: 모바일 반응형 UI 개선
- [ ] **v2.0**: AI 기반 매칭 시스템

## 🤝 기여 방법

1. Fork 프로젝트
2. Feature 브랜치 생성 (`git checkout -b feature/새기능`)
3. 변경사항 커밋 (`git commit -m '[feat] 새기능 추가'`)
4. 브랜치에 Push (`git push origin feature/새기능`)
5. Pull Request 생성

## 📞 지원

- **팀 이메일**: lightcare-team@gmail.com
- **이슈 트래킹**: [GitHub Issues](https://github.com/dooseob/lightcare/issues)
- **위키**: [프로젝트 위키](https://github.com/dooseob/lightcare/wiki)

## 📄 라이센스

이 프로젝트는 MIT 라이센스 하에 있습니다. 자세한 내용은 [LICENSE](LICENSE) 파일을 참조하세요.

---

**LightCare 팀** - 요양 서비스의 미래를 밝히는 플랫폼 💡

### 🟢 팀원 D (리뷰/게시판) - 진행률: 100%

#### ✅ **완료된 작업**
**백엔드 완전 구현**:
- ✅ `ReviewService.java` (238줄) - **완전 구현**
  - 리뷰 CRUD 로직
  - 트랜잭션 처리
  - 로깅 추가
  - 유효성 검증
  - 평점 시스템
  - 추천/비추천 기능

- ✅ `BoardService.java` (253줄) - **완전 구현**
  - 게시글 CRUD 로직
  - 페이징 처리
  - 검색 및 카테고리 필터링
  - 인기 게시글 기능
  - 조회수 증가 로직

- ✅ `ReviewMapper.java` & `reviewMapper.xml` - **완전 구현**
  - 모든 필요 메서드 정의
  - XML 쿼리 매핑 완료

- ✅ `BoardMapper.java` & `boardMapper.xml` - **완전 구현**
  - 모든 필요 메서드 정의
  - XML 쿼리 매핑 완료

**프론트엔드 완성**:
- ✅ `templates/review/list.html` (108줄) - **완전 구현**
- ✅ `templates/review/write.html` (122줄) - **완전 구현**
- ✅ `templates/board/list.html` - **완전 구현**
- ✅ `templates/board/write.html` - **완전 구현**
- ✅ `templates/board/detail.html` - **완전 구현**

#### 📊 **실제 Story Point 달성률**
- **완료**: LC-010 (리뷰 작성) - 13/13 SP ✅
- **완료**: LC-011 (리뷰 목록 관리) - 13/13 SP ✅
- **완료**: LC-012 (정보 게시판) - 13/13 SP ✅

**총 달성**: 39/39 SP (100%)

#### 🚀 **다음 단계**
1. **단위 테스트 작성**
   - ReviewService 테스트
   - BoardService 테스트
   - 통합 테스트

2. **성능 최적화**
   - 쿼리 최적화
   - 캐싱 적용
   - N+1 문제 해결

3. **추가 기능 개발**
   - 댓글 시스템 고도화
   - 파일 첨부 기능
   - 에디터 기능 강화
````

## File: reset_all_data.sql
````sql
-- ================================================
-- 전체 데이터베이스 초기화 (완전 초기화용)
-- 주의: 모든 데이터가 삭제됩니다!
-- 실행 방법: mysql -u root -p mysql < reset_all_data.sql
-- ================================================

USE carelink;

-- 외래키 제약조건 비활성화
SET FOREIGN_KEY_CHECKS = 0;

-- 모든 테이블 데이터 삭제 (순서 중요)
DELETE FROM facility_images;
DELETE FROM review;
DELETE FROM board;
DELETE FROM job_posting;
DELETE FROM facility;
DELETE FROM member WHERE user_id != 'admin'; -- admin 계정은 유지

-- AUTO_INCREMENT 리셋
ALTER TABLE facility_images AUTO_INCREMENT = 1;
ALTER TABLE review AUTO_INCREMENT = 1;
ALTER TABLE board AUTO_INCREMENT = 1;
ALTER TABLE job_posting AUTO_INCREMENT = 1;
ALTER TABLE facility AUTO_INCREMENT = 1;
-- ALTER TABLE member AUTO_INCREMENT = 1; -- admin 계정 유지를 위해 주석

-- 외래키 제약조건 재활성화
SET FOREIGN_KEY_CHECKS = 1;

-- 확인용 쿼리
SELECT 'Database reset completed' AS status;
SELECT TABLE_NAME, TABLE_ROWS 
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'carelink' 
  AND TABLE_TYPE = 'BASE TABLE';

COMMIT;
````

## File: reset_facility_images.sql
````sql
-- ================================================
-- 시설 이미지 데이터만 초기화 (문제 해결용)
-- 실행 방법: mysql -u root -p mysql < reset_facility_images.sql
-- ================================================

USE carelink;

-- 1. 시설 이미지 테이블 데이터 삭제
DELETE FROM facility_images;

-- 2. AUTO_INCREMENT 리셋
ALTER TABLE facility_images AUTO_INCREMENT = 1;

-- 3. 시설 테이블의 이미지 관련 필드 초기화
UPDATE facility 
SET facility_image = NULL, 
    facility_image_alt_text = NULL, 
    image_count = 0;

-- 4. 확인용 쿼리
SELECT 'facility_images 테이블 초기화 완료' AS status;
SELECT COUNT(*) AS remaining_images FROM facility_images;
SELECT facility_id, facility_name, facility_image, image_count FROM facility;

COMMIT;
````

## File: src/main/java/com/example/carelink/config/SecurityConfig.java
````java
package com.example.carelink.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.firewall.HttpFirewall;
import org.springframework.security.web.firewall.StrictHttpFirewall;
import org.springframework.security.web.util.matcher.AntPathRequestMatcher;

@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public HttpFirewall httpFirewall() {
        StrictHttpFirewall firewall = new StrictHttpFirewall();
        firewall.setAllowUrlEncodedDoubleSlash(true);
        return firewall;
    }

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .csrf(csrf -> csrf.disable()) // CSRF 보호 비활성화 (개발 시 편의, 실제 서비스에서는 활성화 권장)
                .authorizeHttpRequests(authorize -> authorize
                        // 정적 리소스에 대한 접근 허용 설정
                        .requestMatchers(
                                new AntPathRequestMatcher("/css/**"),
                                new AntPathRequestMatcher("/js/**"),
                                new AntPathRequestMatcher("/images/**"),
                                new AntPathRequestMatcher("/favicon.ico")
                        ).permitAll()
                        // 인증 없이 접근을 허용할 URL 설정
                        .requestMatchers(
                                new AntPathRequestMatcher("/"),                    // 메인 페이지
                                new AntPathRequestMatcher("/member/login"),       // 로그인 폼 페이지 및 처리
                                new AntPathRequestMatcher("/member/join"),        // 회원가입 폼 페이지 및 처리
                                new AntPathRequestMatcher("/member/checkUserId"), // 아이디 중복 확인 Ajax
                                new AntPathRequestMatcher("/facility/**"),        // 시설 검색 페이지 (비회원도 접근 가능)
                                new AntPathRequestMatcher("/board/**"),           // 게시판 페이지 (비회원도 접근 가능)
                                new AntPathRequestMatcher("/review/**"),          // 리뷰 페이지 (비회원도 접근 가능)
                                new AntPathRequestMatcher("/job/**"),             // 구인구직 페이지 (비회원도 접근 가능)
                                new AntPathRequestMatcher("/api/**"),             // API 경로 (필요시)
                                new AntPathRequestMatcher("/error")               // 에러 페이지 (필요시)
                        ).permitAll()
                        .anyRequest().permitAll() // 개발 편의상 모든 요청 허용 (운영 시에는 authenticated()로 변경)
                )
                .formLogin(formLogin -> formLogin.disable()) // 기본 폼 로그인 비활성화 (커스텀 로그인 사용)
                .logout(logout -> logout
                        .logoutRequestMatcher(new AntPathRequestMatcher("/member/logout")) // 로그아웃 URL
                        .logoutSuccessUrl("/") // 로그아웃 성공 시 이동 페이지
                        .invalidateHttpSession(true) // 세션 무효화
                        .deleteCookies("JSESSIONID") // 쿠키 삭제
                        .permitAll()
                );

        return http.build();
    }

}
````

## File: src/main/java/com/example/carelink/config/WebConfig.java
````java
package com.example.carelink.config;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/**
 * 웹 설정 클래스
 * 정적 리소스 매핑 등을 담당
 */
@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Value("${file.upload-dir.facility}")
    private String facilityUploadDir;
    
    @Value("${file.upload-dir.profile}")
    private String profileUploadDir;

    /**
     * 정적 리소스 핸들러 추가
     * 로컬 업로드 디렉토리와 테스트 이미지 폴더 매핑
     */
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        // 로컬 업로드 디렉토리 매핑 (실제 운영 이미지)
        registry.addResourceHandler("/uploads/facility/**")
                .addResourceLocations("file:" + facilityUploadDir);
        
        registry.addResourceHandler("/uploads/profile/**")
                .addResourceLocations("file:" + profileUploadDir);
        
        // 테스트 이미지 매핑 (Git 공유용)
        String projectRoot = System.getProperty("user.dir");
        registry.addResourceHandler("/test-images/facilities/**")
                .addResourceLocations("file:" + projectRoot + "/images/facilities/");
        
        registry.addResourceHandler("/test-images/profiles/**")
                .addResourceLocations("file:" + projectRoot + "/images/profiles/");
    }
}
````

## File: src/main/java/com/example/carelink/controller/FacilityImageApiController.java
````java
package com.example.carelink.controller;

import com.example.carelink.dto.FacilityImageDTO;
import com.example.carelink.dto.FacilityDTO;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.service.FacilityImageService;
import com.example.carelink.service.FacilityService;
import com.example.carelink.common.Constants;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import javax.servlet.http.HttpSession;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * 시설 이미지 API 전용 컨트롤러
 * Ajax 요청 처리 및 JSON 응답 전용
 */
@RestController
@RequestMapping("/facility/facility-images")
@RequiredArgsConstructor
@Slf4j
public class FacilityImageApiController {

    private final FacilityImageService facilityImageService;
    private final FacilityService facilityService;

    /**
     * 시설 이미지 순서 일괄 업데이트 API
     */
    @PostMapping("/reorder/{facilityId}")
    public ResponseEntity<Map<String, Object>> reorderImages(
            @PathVariable Long facilityId,
            @RequestBody List<Long> imageIds) {
        
        Map<String, Object> response = new HashMap<>();
        
        try {
            log.info("🔄 시설 이미지 순서 재정렬 API 요청 - facilityId: {}, imageIds: {}", facilityId, imageIds);
            
            // 배치로 이미지 순서 업데이트
            boolean success = facilityImageService.updateImageOrdersBatch(facilityId, imageIds);
            
            if (success) {
                response.put("success", true);
                response.put("message", "이미지 순서가 성공적으로 업데이트되었습니다.");
                
                // 업데이트된 이미지 목록 반환
                List<FacilityImageDTO> updatedImages = facilityImageService.getImagesByFacilityId(facilityId);
                response.put("images", updatedImages);
                
                log.info("✅ 시설 이미지 순서 재정렬 API 성공 - facilityId: {}", facilityId);
                return ResponseEntity.ok(response);
            } else {
                response.put("success", false);
                response.put("message", "이미지 순서 업데이트에 실패했습니다.");
                
                log.warn("⚠️ 시설 이미지 순서 재정렬 API 실패 - facilityId: {}", facilityId);
                return ResponseEntity.badRequest().body(response);
            }
            
        } catch (Exception e) {
            log.error("❌ 시설 이미지 순서 재정렬 API 오류 - facilityId: {}", facilityId, e);
            
            response.put("success", false);
            response.put("message", "서버 오류가 발생했습니다: " + e.getMessage());
            return ResponseEntity.internalServerError().body(response);
        }
    }

    /**
     * 시설 이미지 자동 순서 재정렬 API (중복 제거)
     */
    @PostMapping("/auto-reorder/{facilityId}")
    public ResponseEntity<Map<String, Object>> autoReorderImages(@PathVariable Long facilityId) {
        
        Map<String, Object> response = new HashMap<>();
        
        try {
            log.info("🔄 시설 이미지 자동 순서 재정렬 API 요청 - facilityId: {}", facilityId);
            
            // 모든 이미지 순서 자동 재정렬
            boolean success = facilityImageService.reorderAllFacilityImages(facilityId);
            
            if (success) {
                response.put("success", true);
                response.put("message", "이미지 순서가 자동으로 재정렬되었습니다.");
                
                // 재정렬된 이미지 목록 반환
                List<FacilityImageDTO> reorderedImages = facilityImageService.getImagesByFacilityId(facilityId);
                response.put("images", reorderedImages);
                response.put("imageCount", reorderedImages.size());
                
                log.info("✅ 시설 이미지 자동 순서 재정렬 API 성공 - facilityId: {}, 총 {}장", facilityId, reorderedImages.size());
                return ResponseEntity.ok(response);
            } else {
                response.put("success", false);
                response.put("message", "이미지 순서 재정렬에 실패했습니다.");
                
                log.warn("⚠️ 시설 이미지 자동 순서 재정렬 API 실패 - facilityId: {}", facilityId);
                return ResponseEntity.badRequest().body(response);
            }
            
        } catch (Exception e) {
            log.error("❌ 시설 이미지 자동 순서 재정렬 API 오류 - facilityId: {}", facilityId, e);
            
            response.put("success", false);
            response.put("message", "서버 오류가 발생했습니다: " + e.getMessage());
            return ResponseEntity.internalServerError().body(response);
        }
    }

    /**
     * 시설 이미지 목록 조회 API (권한 확인 포함)
     */
    @GetMapping("/{facilityId}")
    public ResponseEntity<Map<String, Object>> getFacilityImages(@PathVariable Long facilityId, HttpSession session) {
        
        Map<String, Object> response = new HashMap<>();
        
        try {
            log.info("📋 시설 이미지 목록 조회 API 요청 - facilityId: {}", facilityId);
            
            // 권한 확인
            MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (member == null) {
                response.put("success", false);
                response.put("message", "로그인이 필요합니다.");
                return ResponseEntity.status(401).body(response);
            }
            
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                response.put("success", false);
                response.put("message", "시설을 찾을 수 없습니다.");
                return ResponseEntity.badRequest().body(response);
            }
            
            // 시설 소유자 또는 관리자만 접근 가능
            if (!facility.getRegisteredMemberId().equals(member.getMemberId()) 
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                response.put("success", false);
                response.put("message", "해당 시설 이미지를 조회할 권한이 없습니다.");
                return ResponseEntity.status(403).body(response);
            }
            
            List<FacilityImageDTO> images = facilityImageService.getImagesByFacilityId(facilityId);
            FacilityImageDTO mainImage = facilityImageService.getMainImageByFacilityId(facilityId);
            
            response.put("success", true);
            response.put("images", images);
            response.put("mainImage", mainImage);
            response.put("imageCount", images.size());
            response.put("maxImages", 5); // 최대 이미지 수
            
            log.info("✅ 시설 이미지 목록 조회 API 성공 - facilityId: {}, 총 {}장, memberId: {}", facilityId, images.size(), member.getMemberId());
            return ResponseEntity.ok(response);
            
        } catch (Exception e) {
            log.error("❌ 시설 이미지 목록 조회 API 오류 - facilityId: {}", facilityId, e);
            
            response.put("success", false);
            response.put("message", "서버 오류가 발생했습니다: " + e.getMessage());
            return ResponseEntity.internalServerError().body(response);
        }
    }

    /**
     * 개별 이미지 순서 업데이트 API
     */
    @PutMapping("/{imageId}/order")
    public ResponseEntity<Map<String, Object>> updateImageOrder(
            @PathVariable Long imageId,
            @RequestParam Integer order) {
        
        Map<String, Object> response = new HashMap<>();
        
        try {
            log.info("🔢 개별 이미지 순서 업데이트 API 요청 - imageId: {}, order: {}", imageId, order);
            
            boolean success = facilityImageService.updateImageOrder(imageId, order);
            
            if (success) {
                response.put("success", true);
                response.put("message", "이미지 순서가 업데이트되었습니다.");
                
                log.info("✅ 개별 이미지 순서 업데이트 API 성공 - imageId: {}, order: {}", imageId, order);
                return ResponseEntity.ok(response);
            } else {
                response.put("success", false);
                response.put("message", "이미지 순서 업데이트에 실패했습니다.");
                
                log.warn("⚠️ 개별 이미지 순서 업데이트 API 실패 - imageId: {}, order: {}", imageId, order);
                return ResponseEntity.badRequest().body(response);
            }
            
        } catch (Exception e) {
            log.error("❌ 개별 이미지 순서 업데이트 API 오류 - imageId: {}, order: {}", imageId, order, e);
            
            response.put("success", false);
            response.put("message", "서버 오류가 발생했습니다: " + e.getMessage());
            return ResponseEntity.internalServerError().body(response);
        }
    }

    /**
     * 이미지 삭제 API
     */
    @DeleteMapping("/{imageId}")
    public ResponseEntity<Map<String, Object>> deleteImage(@PathVariable Long imageId) {
        Map<String, Object> response = new HashMap<>();
        
        try {
            log.info("🗑️ 이미지 삭제 API 요청 - imageId: {}", imageId);
            
            boolean success = facilityImageService.deleteFacilityImage(imageId);
            
            if (success) {
                response.put("success", true);
                response.put("message", "이미지가 삭제되었습니다.");
                log.info("✅ 이미지 삭제 API 성공 - imageId: {}", imageId);
                return ResponseEntity.ok(response);
            } else {
                response.put("success", false);
                response.put("message", "이미지 삭제에 실패했습니다.");
                return ResponseEntity.badRequest().body(response);
            }
            
        } catch (Exception e) {
            log.error("❌ 이미지 삭제 API 오류 - imageId: {}", imageId, e);
            response.put("success", false);
            response.put("message", "서버 오류가 발생했습니다: " + e.getMessage());
            return ResponseEntity.internalServerError().body(response);
        }
    }

    /**
     * 메인 이미지 설정 API
     */
    @PostMapping("/{imageId}/set-main")
    public ResponseEntity<Map<String, Object>> setMainImage(@PathVariable Long imageId) {
        Map<String, Object> response = new HashMap<>();
        
        try {
            log.info("⭐ 메인 이미지 설정 API 요청 - imageId: {}", imageId);
            
            // 이미지 정보를 먼저 조회하여 facilityId를 얻음
            FacilityImageDTO imageInfo = facilityImageService.getImageById(imageId);
            if (imageInfo == null) {
                response.put("success", false);
                response.put("message", "이미지를 찾을 수 없습니다.");
                return ResponseEntity.badRequest().body(response);
            }
            
            boolean success = facilityImageService.setMainImage(imageInfo.getFacilityId(), imageId);
            
            if (success) {
                response.put("success", true);
                response.put("message", "메인 이미지가 설정되었습니다.");
                log.info("✅ 메인 이미지 설정 API 성공 - imageId: {}", imageId);
                return ResponseEntity.ok(response);
            } else {
                response.put("success", false);
                response.put("message", "메인 이미지 설정에 실패했습니다.");
                return ResponseEntity.badRequest().body(response);
            }
            
        } catch (Exception e) {
            log.error("❌ 메인 이미지 설정 API 오류 - imageId: {}", imageId, e);
            response.put("success", false);
            response.put("message", "서버 오류가 발생했습니다: " + e.getMessage());
            return ResponseEntity.internalServerError().body(response);
        }
    }

    /**
     * 다중 이미지 업로드 API (Blob 방식)
     */
    @PostMapping("/upload")
    public ResponseEntity<Map<String, Object>> uploadImages(
            @RequestParam("facilityId") Long facilityId,
            @RequestParam("images") List<MultipartFile> images,
            HttpSession session) {
        
        Map<String, Object> response = new HashMap<>();
        
        try {
            log.info("📤 시설 이미지 업로드 API 요청 - facilityId: {}, 이미지 수: {}", facilityId, images.size());
            
            // 권한 확인
            MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (member == null) {
                response.put("success", false);
                response.put("message", "로그인이 필요합니다.");
                return ResponseEntity.status(401).body(response);
            }
            
            // 시설 확인
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                response.put("success", false);
                response.put("message", "시설을 찾을 수 없습니다.");
                return ResponseEntity.badRequest().body(response);
            }
            
            // 시설 소유자 또는 관리자만 업로드 가능
            if (!facility.getRegisteredMemberId().equals(member.getMemberId()) 
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                response.put("success", false);
                response.put("message", "해당 시설 이미지를 업로드할 권한이 없습니다.");
                return ResponseEntity.status(403).body(response);
            }
            
            // 파일 검증
            if (images == null || images.isEmpty()) {
                response.put("success", false);
                response.put("message", "업로드할 이미지가 없습니다.");
                return ResponseEntity.badRequest().body(response);
            }
            
            // 최대 파일 수 체크 (10MB 제한)
            final long MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
            final int MAX_FILES = 5;
            
            if (images.size() > MAX_FILES) {
                response.put("success", false);
                response.put("message", "최대 " + MAX_FILES + "장까지만 업로드할 수 있습니다.");
                return ResponseEntity.badRequest().body(response);
            }
            
            // 파일 크기 및 형식 검증
            for (MultipartFile image : images) {
                if (image.getSize() > MAX_FILE_SIZE) {
                    response.put("success", false);
                    response.put("message", "파일 크기가 10MB를 초과할 수 없습니다: " + image.getOriginalFilename());
                    return ResponseEntity.badRequest().body(response);
                }
                
                String contentType = image.getContentType();
                if (contentType == null || !contentType.startsWith("image/")) {
                    response.put("success", false);
                    response.put("message", "이미지 파일만 업로드할 수 있습니다: " + image.getOriginalFilename());
                    return ResponseEntity.badRequest().body(response);
                }
            }
            
            // 이미지 업로드 처리
            List<FacilityImageDTO> uploadedImages = facilityImageService.uploadMultipleImages(facilityId, images);
            
            response.put("success", true);
            response.put("message", images.size() + "개의 이미지가 성공적으로 업로드되었습니다.");
            response.put("uploadedImages", uploadedImages);
            response.put("uploadCount", uploadedImages.size());
            
            log.info("✅ 시설 이미지 업로드 API 성공 - facilityId: {}, 업로드 수: {}, memberId: {}", 
                    facilityId, uploadedImages.size(), member.getMemberId());
            return ResponseEntity.ok(response);
            
        } catch (Exception e) {
            log.error("❌ 시설 이미지 업로드 API 오류 - facilityId: {}", facilityId, e);
            
            response.put("success", false);
            response.put("message", "서버 오류가 발생했습니다: " + e.getMessage());
            return ResponseEntity.internalServerError().body(response);
        }
    }
}
````

## File: src/main/java/com/example/carelink/dao/FacilityImageMapper.java
````java
package com.example.carelink.dao;

import com.example.carelink.dto.FacilityImageDTO;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;

/**
 * 시설 이미지 관련 데이터 액세스 매퍼
 */
@Mapper
public interface FacilityImageMapper {

    /**
     * 시설의 모든 이미지 조회 (순서대로)
     */
    List<FacilityImageDTO> getImagesByFacilityId(@Param("facilityId") Long facilityId);

    /**
     * 시설의 메인 이미지 조회
     */
    FacilityImageDTO getMainImageByFacilityId(@Param("facilityId") Long facilityId);

    /**
     * 시설 이미지 추가
     */
    int insertFacilityImage(FacilityImageDTO facilityImageDTO);

    /**
     * 시설 이미지 수정
     */
    int updateFacilityImage(FacilityImageDTO facilityImageDTO);

    /**
     * 시설 이미지 삭제
     */
    int deleteFacilityImage(@Param("imageId") Long imageId);

    /**
     * 시설의 모든 이미지 삭제
     */
    int deleteAllImagesByFacilityId(@Param("facilityId") Long facilityId);

    /**
     * 시설의 이미지 개수 조회
     */
    int countImagesByFacilityId(@Param("facilityId") Long facilityId);

    /**
     * 메인 이미지 설정 (기존 메인 이미지 해제 후 새로 설정)
     */
    int updateMainImage(@Param("facilityId") Long facilityId, @Param("imageId") Long imageId);

    /**
     * 기존 메인 이미지 해제
     */
    int clearMainImages(@Param("facilityId") Long facilityId);
    
    /**
     * 특정 이미지 ID로 이미지 조회
     */
    FacilityImageDTO getImageById(@Param("imageId") Long imageId);
    
    /**
     * 이미지 순서 업데이트 (데이터 정합성 보장)
     */
    int updateImageOrder(@Param("imageId") Long imageId, @Param("imageOrder") Integer imageOrder);
}
````

## File: src/main/java/com/example/carelink/dao/ReviewMapper.java
````java
package com.example.carelink.dao;

import com.example.carelink.dto.ReviewDTO;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;

/**
 * 리뷰 관련 데이터 액세스 매퍼
 * 팀원 D 담당
 */
@Mapper
public interface ReviewMapper {
    
    /**
     * 리뷰 목록 조회 (기본)
     */
    List<ReviewDTO> getReviewList(ReviewDTO searchDTO);
    
    /**
     * 리뷰 목록 조회 (검색 포함) - XML에서 정의됨
     */
    List<ReviewDTO> findReviewsWithSearch(ReviewDTO searchDTO);
    
    /**
     * 리뷰 총 개수 조회 (검색 포함)
     */
    int countReviewsWithSearch(ReviewDTO searchDTO);
    
    /**
     * 리뷰 상세 정보 조회 (기본)
     */
    ReviewDTO getReviewById(@Param("reviewId") Long reviewId);
    
    /**
     * 리뷰 상세 정보 조회 - XML에서 정의됨
     */
    ReviewDTO findReviewById(@Param("reviewId") Long reviewId);
    
    /**
     * 리뷰 등록
     */
    int insertReview(ReviewDTO reviewDTO);
    
    /**
     * 리뷰 수정
     */
    int updateReview(ReviewDTO reviewDTO);
    
    /**
     * 리뷰 삭제
     */
    int deleteReview(@Param("reviewId") Long reviewId);
    
    /**
     * 조회수 증가
     */
    int incrementViewCount(@Param("reviewId") Long reviewId);
    
    /**
     * 추천수 증가
     */
    int incrementLikeCount(@Param("reviewId") Long reviewId);
    
    /**
     * 비추천수 증가
     */
    int incrementDislikeCount(@Param("reviewId") Long reviewId);
    
    /**
     * 시설별 리뷰 목록 조회 (기본)
     */
    List<ReviewDTO> getReviewsByFacilityId(@Param("facilityId") Long facilityId);
    
    /**
     * 시설별 리뷰 목록 조회 - XML에서 정의됨
     */
    List<ReviewDTO> findReviewsByFacilityId(@Param("facilityId") Long facilityId);
    
    /**
     * 회원별 리뷰 목록 조회
     */
    List<ReviewDTO> findReviewsByMemberId(@Param("memberId") Long memberId);
    
    /**
     * 시설의 평균 평점 조회
     */
    Double getAverageRating(@Param("facilityId") Long facilityId);
    
    /**
     * 최근 리뷰 목록 조회
     */
    List<ReviewDTO> getRecentReviews();
    
    /**
     * 리뷰 총 개수 조회 (검색 포함)
     */
    int getReviewCount(ReviewDTO searchDTO);

    /**
     * 전체 리뷰 수 조회 (통계용)
     */
    int getReviewCount();

    /**
     * 회원 ID로 리뷰 삭제 (회원 탈퇴 시 사용)
     */
    int deleteByMemberId(@Param("memberId") Long memberId);

    /**
     * 시설 회원 ID로 리뷰 삭제 (시설 삭제 시 사용)
     */
    int deleteByFacilityMemberId(@Param("memberId") Long memberId);
}
````

## File: src/main/java/Crolling.java
````java
import java.io.*;
import java.util.*;

public class Crolling {
    public static void main(String[] args) {
        String rootDirectory = "D:\\cch\\project_2\\LightCare\\src\\main";

        String outputFilePath = "D:/LightCare.txt";

        try (BufferedWriter writer = new BufferedWriter(new FileWriter(outputFilePath))) {
            List<File> files = getAllFilesWithExtensions(rootDirectory, Arrays.asList(".java", ".jsp", ".xml", ".js", ".html", ".css"));
            
            for (File file : files) {
                System.out.println("파일 읽기: " + file.getAbsolutePath());
                writeFileContentToFile(file, writer);
            }
            System.out.println("모든 파일을 크롤링하여 " + outputFilePath + "에 저장했습니다.");
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    // 여러 확장자를 포함하는 파일들을 재귀적으로 찾는 함수
    public static List<File> getAllFilesWithExtensions(String directoryPath, List<String> extensions) {
        List<File> matchedFiles = new ArrayList<>();
        File rootDirectory = new File(directoryPath);

        File[] files = rootDirectory.listFiles();
        if (files != null) {
            for (File file : files) {
                if (file.isDirectory()) {
                    matchedFiles.addAll(getAllFilesWithExtensions(file.getAbsolutePath(), extensions));
                } else {
                    for (String ext : extensions) {
                        if (file.getName().toLowerCase().endsWith(ext)) {
                            matchedFiles.add(file);
                            break;  // 한번 매칭되면 다음 파일로 넘어감
                        }
                    }
                }
            }
        }
        return matchedFiles;
    }

    public static void writeFileContentToFile(File file, BufferedWriter writer) throws IOException {
        try (BufferedReader reader = new BufferedReader(new FileReader(file))) {
            writer.write("파일명: " + file.getName() + "\n");
            writer.write("경로: " + file.getAbsolutePath() + "\n");
            writer.write("----------------------------------------------------\n");

            String line;
            while ((line = reader.readLine()) != null) {
                writer.write(line + "\n");
            }

            writer.write("\n\n");
        }
    }
}
````

## File: src/main/resources/mapper/facilityImageMapper.xml
````xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.carelink.dao.FacilityImageMapper">

    <!-- ResultMap 정의 -->
    <resultMap id="FacilityImageResultMap" type="com.example.carelink.dto.FacilityImageDTO">
        <id property="imageId" column="image_id"/>
        <result property="facilityId" column="facility_id"/>
        <result property="imagePath" column="image_path"/>
        <result property="imageAltText" column="image_alt_text"/>
        <result property="imageOrder" column="image_order"/>
        <result property="isMainImage" column="is_main_image"/>
        <result property="uploadDate" column="upload_date"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <!-- 시설의 모든 이미지 조회 (순서대로) -->
    <select id="getImagesByFacilityId" resultMap="FacilityImageResultMap">
        SELECT 
            image_id,
            facility_id,
            image_path,
            image_alt_text,
            image_order,
            is_main_image,
            upload_date,
            updated_at
        FROM facility_images
        WHERE facility_id = #{facilityId}
        ORDER BY image_order ASC, upload_date ASC
    </select>

    <!-- 시설의 메인 이미지 조회 -->
    <select id="getMainImageByFacilityId" resultMap="FacilityImageResultMap">
        SELECT 
            image_id,
            facility_id,
            image_path,
            image_alt_text,
            image_order,
            is_main_image,
            upload_date,
            updated_at
        FROM facility_images
        WHERE facility_id = #{facilityId} 
        AND is_main_image = TRUE
        LIMIT 1
    </select>

    <!-- 시설 이미지 추가 -->
    <insert id="insertFacilityImage" useGeneratedKeys="true" keyProperty="imageId">
        INSERT INTO facility_images (
            facility_id,
            image_path,
            image_alt_text,
            image_order,
            is_main_image,
            upload_date
        ) VALUES (
            #{facilityId},
            #{imagePath},
            #{imageAltText},
            #{imageOrder},
            #{isMainImage},
            NOW()
        )
    </insert>

    <!-- 시설 이미지 수정 -->
    <update id="updateFacilityImage">
        UPDATE facility_images 
        SET 
            image_path = #{imagePath},
            image_alt_text = #{imageAltText},
            image_order = #{imageOrder},
            is_main_image = #{isMainImage},
            updated_at = NOW()
        WHERE image_id = #{imageId}
    </update>

    <!-- 시설 이미지 삭제 -->
    <delete id="deleteFacilityImage">
        DELETE FROM facility_images 
        WHERE image_id = #{imageId}
    </delete>

    <!-- 시설의 모든 이미지 삭제 -->
    <delete id="deleteAllImagesByFacilityId">
        DELETE FROM facility_images 
        WHERE facility_id = #{facilityId}
    </delete>

    <!-- 시설의 이미지 개수 조회 -->
    <select id="countImagesByFacilityId" resultType="int">
        SELECT COUNT(*) 
        FROM facility_images 
        WHERE facility_id = #{facilityId}
    </select>

    <!-- 기존 메인 이미지 해제 -->
    <update id="clearMainImages">
        UPDATE facility_images 
        SET is_main_image = FALSE, updated_at = NOW()
        WHERE facility_id = #{facilityId}
    </update>

    <!-- 메인 이미지 설정 -->
    <update id="updateMainImage">
        UPDATE facility_images 
        SET is_main_image = TRUE, updated_at = NOW()
        WHERE facility_id = #{facilityId} AND image_id = #{imageId}
    </update>

    <!-- 특정 이미지 ID로 이미지 조회 -->
    <select id="getImageById" resultMap="FacilityImageResultMap">
        SELECT 
            image_id,
            facility_id,
            image_path,
            image_alt_text,
            image_order,
            is_main_image,
            upload_date,
            updated_at
        FROM facility_images
        WHERE image_id = #{imageId}
    </select>

    <!-- 이미지 순서 업데이트 (데이터 정합성 보장) -->
    <update id="updateImageOrder">
        UPDATE facility_images 
        SET image_order = #{imageOrder}, updated_at = NOW()
        WHERE image_id = #{imageId}
    </update>

</mapper>
````

## File: src/main/resources/mapper/reviewMapper.xml
````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.carelink.dao.ReviewMapper">

    <!-- ResultMap 정의 -->
    <resultMap id="reviewResultMap" type="com.example.carelink.dto.ReviewDTO">
        <id property="reviewId" column="review_id"/>
        <result property="facilityId" column="facility_id"/>
        <result property="facilityName" column="facility_name"/>
        <result property="memberId" column="member_id"/>
        <result property="memberName" column="member_name"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="rating" column="rating"/>
        <result property="serviceRating" column="service_rating"/>
        <result property="facilityRating" column="facility_rating"/>
        <result property="staffRating" column="staff_rating"/>
        <result property="priceRating" column="price_rating"/>
        <result property="reviewImage1" column="review_image1"/>
        <result property="reviewImage2" column="review_image2"/>
        <result property="reviewImage3" column="review_image3"/>
        <result property="likeCount" column="like_count"/>
        <result property="dislikeCount" column="dislike_count"/>
        <result property="viewCount" column="view_count"/>
        <result property="isVisible" column="is_visible"/>
        <result property="status" column="status"/>
        <result property="parentReviewId" column="parent_review_id"/>
        <result property="replyCount" column="reply_count"/>
        <result property="replyDepth" column="reply_depth"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="isDeleted" column="is_deleted"/>
    </resultMap>

    <!-- 리뷰 목록 조회 (검색 포함) -->
    <select id="findReviewsWithSearch" parameterType="com.example.carelink.dto.ReviewDTO" resultMap="reviewResultMap">
        SELECT 
            r.*,
            m.name as member_name,
            f.facility_name
        FROM review r
        LEFT JOIN member m ON r.member_id = m.member_id
        LEFT JOIN facility f ON r.facility_id = f.facility_id
        WHERE r.is_deleted = false AND r.is_visible = true
        <if test="facilityId != null">
            AND r.facility_id = #{facilityId}
        </if>
        <if test="searchKeyword != null and searchKeyword != ''">
            AND (r.title LIKE CONCAT('%', #{searchKeyword}, '%') 
                 OR r.content LIKE CONCAT('%', #{searchKeyword}, '%'))
        </if>
        <if test="minRating != null">
            AND r.rating >= #{minRating}
        </if>
        <if test="maxRating != null">
            AND r.rating &lt;= #{maxRating}
        </if>
        <choose>
            <when test="sortBy != null and sortBy == 'RATING_HIGH'">
                ORDER BY r.rating DESC, r.created_at DESC
            </when>
            <when test="sortBy != null and sortBy == 'RATING_LOW'">
                ORDER BY r.rating ASC, r.created_at DESC
            </when>
            <when test="sortBy != null and sortBy == 'LIKE_COUNT'">
                ORDER BY r.like_count DESC, r.created_at DESC
            </when>
            <otherwise>
                ORDER BY r.created_at DESC
            </otherwise>
        </choose>
        <if test="size != null and size > 0 and offset != null and offset >= 0">
            LIMIT #{size} OFFSET #{offset}
        </if>
    </select>

    <!-- 리뷰 총 개수 조회 -->
    <select id="countReviewsWithSearch" parameterType="com.example.carelink.dto.ReviewDTO" resultType="int">
        SELECT COUNT(*)
        FROM review r
        WHERE r.is_deleted = false AND r.is_visible = true
        <if test="facilityId != null">
            AND r.facility_id = #{facilityId}
        </if>
        <if test="searchKeyword != null and searchKeyword != ''">
            AND (r.title LIKE CONCAT('%', #{searchKeyword}, '%') 
                 OR r.content LIKE CONCAT('%', #{searchKeyword}, '%'))
        </if>
        <if test="minRating != null">
            AND r.rating >= #{minRating}
        </if>
        <if test="maxRating != null">
            AND r.rating &lt;= #{maxRating}
        </if>
    </select>

    <!-- 리뷰 상세 조회 -->
    <select id="findReviewById" parameterType="long" resultMap="reviewResultMap">
        SELECT 
            r.*,
            m.name as member_name,
            f.facility_name
        FROM review r
        LEFT JOIN member m ON r.member_id = m.member_id
        LEFT JOIN facility f ON r.facility_id = f.facility_id
        WHERE r.review_id = #{reviewId} AND r.is_deleted = false
    </select>

    <!-- 리뷰 등록 -->
    <insert id="insertReview" parameterType="com.example.carelink.dto.ReviewDTO" useGeneratedKeys="true" keyProperty="reviewId">
        INSERT INTO review (
            facility_id, member_id, title, content, rating,
            service_rating, facility_rating, staff_rating, price_rating,
            review_image1, review_image2, review_image3,
            is_visible, status, parent_review_id, reply_depth,
            is_deleted, created_at
        ) VALUES (
            #{facilityId}, #{memberId}, #{title}, #{content}, #{rating},
            #{serviceRating}, #{facilityRating}, #{staffRating}, #{priceRating},
            #{reviewImage1}, #{reviewImage2}, #{reviewImage3},
            #{isVisible}, #{status}, #{parentReviewId}, #{replyDepth},
            #{isDeleted}, NOW()
        )
    </insert>

    <!-- 리뷰 수정 -->
    <update id="updateReview" parameterType="com.example.carelink.dto.ReviewDTO">
        UPDATE review SET
            title = #{title},
            content = #{content},
            rating = #{rating},
            service_rating = #{serviceRating},
            facility_rating = #{facilityRating},
            staff_rating = #{staffRating},
            price_rating = #{priceRating},
            review_image1 = #{reviewImage1},
            review_image2 = #{reviewImage2},
            review_image3 = #{reviewImage3},
            is_visible = #{isVisible},
            status = #{status},
            updated_at = NOW()
        WHERE review_id = #{reviewId}
    </update>

    <!-- 리뷰 삭제 (논리 삭제) -->
    <update id="deleteReview" parameterType="long">
        UPDATE review SET
            is_deleted = true,
            updated_at = NOW()
        WHERE review_id = #{reviewId}
    </update>

    <!-- 조회수 증가 -->
    <update id="incrementViewCount" parameterType="long">
        UPDATE review SET
            view_count = view_count + 1,
            updated_at = NOW()
        WHERE review_id = #{reviewId}
    </update>

    <!-- 추천수 증가 -->
    <update id="incrementLikeCount" parameterType="long">
        UPDATE review SET
            like_count = like_count + 1,
            updated_at = NOW()
        WHERE review_id = #{reviewId}
    </update>

    <!-- 비추천수 증가 -->
    <update id="incrementDislikeCount" parameterType="long">
        UPDATE review SET
            dislike_count = dislike_count + 1,
            updated_at = NOW()
        WHERE review_id = #{reviewId}
    </update>

    <!-- 회원별 리뷰 목록 조회 -->
    <select id="findReviewsByMemberId" parameterType="long" resultMap="reviewResultMap">
        SELECT 
            r.*,
            m.name as member_name,
            f.facility_name
        FROM review r
        LEFT JOIN member m ON r.member_id = m.member_id
        LEFT JOIN facility f ON r.facility_id = f.facility_id
        WHERE r.member_id = #{memberId} AND r.is_deleted = false
        ORDER BY r.created_at DESC
    </select>

    <!-- 시설별 리뷰 목록 조회 -->
    <select id="findReviewsByFacilityId" parameterType="long" resultMap="reviewResultMap">
        SELECT 
            r.*,
            m.name as member_name,
            f.facility_name
        FROM review r
        LEFT JOIN member m ON r.member_id = m.member_id
        LEFT JOIN facility f ON r.facility_id = f.facility_id
        WHERE r.facility_id = #{facilityId} AND r.is_deleted = false AND r.is_visible = true
        ORDER BY r.created_at DESC
    </select>

    <!-- 시설별 평균 평점 조회 -->
    <select id="getAverageRatingByFacilityId" parameterType="long" resultType="float">
        SELECT ROUND(AVG(rating), 1)
        FROM review
        WHERE facility_id = #{facilityId} AND is_deleted = false AND is_visible = true
    </select>

    <!-- 시설별 리뷰 개수 조회 -->
    <select id="getReviewCountByFacilityId" parameterType="long" resultType="int">
        SELECT COUNT(*)
        FROM review
        WHERE facility_id = #{facilityId} AND is_deleted = false AND is_visible = true
    </select>

    <!-- 전체 리뷰 수 조회 (통계용) -->
    <select id="getReviewCount" resultType="int">
        SELECT COUNT(*) 
        FROM review 
        WHERE is_deleted = false AND is_visible = true
    </select>

    <!-- 시설 평균 평점 조회 -->
    <select id="getAverageRating" parameterType="long" resultType="double">
        SELECT AVG(rating) 
        FROM review 
        WHERE facility_id = #{facilityId} 
          AND is_deleted = false 
          AND is_visible = true
    </select>

    <!-- 회원 ID로 리뷰 삭제 (회원 탈퇴 시 사용) -->
    <delete id="deleteByMemberId" parameterType="long">
        DELETE FROM review WHERE member_id = #{memberId}
    </delete>

    <!-- 시설 회원 ID로 리뷰 삭제 (시설 삭제 시 사용) -->
    <delete id="deleteByFacilityMemberId" parameterType="long">
        DELETE FROM review 
        WHERE facility_id IN (
            SELECT facility_id FROM facility WHERE registered_member_id = #{memberId}
        )
    </delete>

</mapper>
````

## File: src/main/resources/static/css/rich-text-editor.css
````css
/**
 * 라이트케어 리치 텍스트 에디터 v2.0 스타일
 * 보안 강화 및 성능 최적화 버전
 */

/* 에디터 컨테이너 */
.rich-text-editor-v2 {
    border: 1px solid #ced4da;
    border-radius: 0.375rem;
    background-color: #fff;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.rich-text-editor-v2:focus-within {
    border-color: #86b7fe;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

/* 툴바 스타일 */
.rte-toolbar {
    background-color: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
    padding: 0.5rem;
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
    border-radius: 0.375rem 0.375rem 0 0;
}

.rte-toolbar-group {
    display: flex;
    gap: 0.125rem;
    align-items: center;
}

.rte-toolbar-group:not(:last-child)::after {
    content: '';
    width: 1px;
    height: 1.5rem;
    background-color: #dee2e6;
    margin: 0 0.5rem;
}

/* 툴바 버튼 */
.rte-btn {
    background: none;
    border: 1px solid transparent;
    border-radius: 0.25rem;
    padding: 0.375rem 0.5rem;
    font-size: 0.875rem;
    line-height: 1;
    color: #495057;
    cursor: pointer;
    transition: all 0.15s ease-in-out;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 2rem;
    height: 2rem;
}

.rte-btn:hover {
    background-color: #e9ecef;
    border-color: #adb5bd;
    color: #212529;
}

.rte-btn:active,
.rte-btn.active {
    background-color: #0d6efd;
    border-color: #0d6efd;
    color: #fff;
    box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
}

.rte-btn:focus {
    outline: 0;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

.rte-btn:disabled {
    opacity: 0.65;
    cursor: not-allowed;
}

/* 툴바 셀렉트 박스 */
.rte-select {
    border: 1px solid #ced4da;
    border-radius: 0.25rem;
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
    line-height: 1.25;
    color: #495057;
    background-color: #fff;
    cursor: pointer;
    min-width: 5rem;
    height: 2rem;
}

.rte-select:focus {
    border-color: #86b7fe;
    outline: 0;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

/* 툴바 색상 선택기 */
.rte-color {
    border: 1px solid #ced4da;
    border-radius: 0.25rem;
    padding: 0.125rem;
    width: 2rem;
    height: 2rem;
    cursor: pointer;
    background: none;
}

.rte-color:focus {
    border-color: #86b7fe;
    outline: 0;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

/* 에디터 콘텐츠 영역 */
.rte-content {
    padding: 1rem;
    font-size: 1rem;
    line-height: 1.5;
    color: #212529;
    background-color: #fff;
    outline: none;
    overflow-y: auto;
    min-height: 200px;
    max-height: 600px;
}

.rte-content:focus {
    outline: none;
}

/* 링크 스타일 (에디터 내부) */
.rte-content a {
    color: #0066cc !important;
    text-decoration: underline !important;
    cursor: pointer;
}

.rte-content a:hover {
    color: #004499 !important;
    text-decoration: underline !important;
}

.rte-content a:visited {
    color: #663399 !important;
}

/* 링크 스타일 (상세보기 페이지) */
.rich-text-content a {
    color: #0066cc !important;
    text-decoration: underline !important;
    cursor: pointer;
}

.rich-text-content a:hover {
    color: #004499 !important;
    text-decoration: underline !important;
}

.rich-text-content a:visited {
    color: #663399 !important;
}

/* 플레이스홀더 */
.rte-placeholder {
    color: #6c757d;
    font-style: italic;
    margin: 0;
    user-select: none;
    pointer-events: none;
}

/* 상태바 */
.rte-statusbar {
    background-color: #f8f9fa;
    border-top: 1px solid #dee2e6;
    padding: 0.25rem 0.75rem;
    font-size: 0.75rem;
    color: #6c757d;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 0 0 0.375rem 0.375rem;
}

.rte-char-count.text-danger {
    color: #dc3545 !important;
    font-weight: 600;
}

/* 에디터 내 콘텐츠 스타일 */
.rte-content p {
    margin-bottom: 0.75rem;
}

.rte-content ul,
.rte-content ol {
    margin-bottom: 0.75rem;
    padding-left: 2rem;
}

.rte-content li {
    margin-bottom: 0.25rem;
}

.rte-content blockquote {
    margin: 1rem 0;
    padding: 0.75rem 1rem;
    border-left: 4px solid #0d6efd;
    background-color: #f8f9fa;
    font-style: italic;
}

.rte-content a {
    color: #0d6efd;
    text-decoration: underline;
}

.rte-content a:hover {
    color: #0a58ca;
}

/* 테이블 스타일 */
.rte-table {
    width: 100%;
    margin: 1rem 0;
    border-collapse: collapse;
}

.rte-table th,
.rte-table td {
    border: 1px solid #dee2e6;
    padding: 0.5rem;
    text-align: left;
    vertical-align: top;
}

.rte-table th {
    background-color: #f8f9fa;
    font-weight: 600;
}

.rte-table tr:nth-child(even) {
    background-color: rgba(0, 0, 0, 0.05);
}

/* 경고 메시지 */
.rte-warning {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    max-width: 300px;
    margin: 0;
    animation: slideInRight 0.3s ease-out;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* 반응형 디자인 */
@media (max-width: 768px) {
    .rte-toolbar {
        padding: 0.25rem;
        gap: 0.125rem;
    }
    
    .rte-toolbar-group:not(:last-child)::after {
        margin: 0 0.25rem;
    }
    
    .rte-btn {
        padding: 0.25rem;
        min-width: 1.75rem;
        height: 1.75rem;
        font-size: 0.75rem;
    }
    
    .rte-select {
        font-size: 0.75rem;
        min-width: 4rem;
        height: 1.75rem;
    }
    
    .rte-color {
        width: 1.75rem;
        height: 1.75rem;
    }
    
    .rte-content {
        padding: 0.75rem;
        font-size: 0.875rem;
    }
    
    .rte-statusbar {
        padding: 0.25rem 0.5rem;
        font-size: 0.6875rem;
        flex-direction: column;
        gap: 0.125rem;
    }
}

/* 접근성 개선 */
.sr-only {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
}
````

## File: src/main/resources/static/js/delete-member.js
````javascript
// 회원탈퇴 페이지 JavaScript
// Thymeleaf 인라인 JavaScript를 사용하지 않고 완전히 분리된 JavaScript 파일

document.addEventListener('DOMContentLoaded', function() {
    // DOM 요소 선택
    const elements = {
        form: document.getElementById('deleteMemberForm'),
        password: document.getElementById('password'),
        confirmName: document.getElementById('confirmName'),
        confirmDelete: document.getElementById('confirmDelete'),
        submitButton: document.getElementById('submitButton'),
        togglePassword: document.getElementById('togglePassword'),
        passwordFeedback: document.getElementById('passwordFeedback'),
        nameValidationFeedback: document.getElementById('nameValidationFeedback')
    };
    
    // 서버에서 전달된 사용자 이름 (전역 변수로 설정)
    const memberName = document.querySelector('.form-text strong').textContent.trim();

    // 디버깅: DOM 요소 확인
    console.log('회원탈퇴 페이지 DOM 요소:', elements);

    // 비밀번호 표시/숨김 토글
    function setupPasswordToggle() {
        if (!elements.password || !elements.togglePassword) {
            console.warn('비밀번호 토글 요소가 없습니다.');
            return;
        }

        elements.togglePassword.addEventListener('click', function() {
            const icon = this.querySelector('i');
            if (elements.password.type === 'password') {
                elements.password.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                elements.password.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });
    }

    // 입력 필드 유효성 검사 상태 초기화
    function clearValidationState(inputElement) {
        if (inputElement) {
            inputElement.classList.remove('is-valid', 'is-invalid');
        }
    }

    // 피드백 메시지 설정
    function setFeedback(feedbackElement, message, isValid) {
        if (!feedbackElement) return;
        
        feedbackElement.textContent = message;
        feedbackElement.style.display = message ? 'block' : 'none';
    }

    // 입력 필드 유효성 상태 설정
    function setValidationState(inputElement, isValid) {
        if (!inputElement) return;
        
        if (isValid) {
            inputElement.classList.remove('is-invalid');
            inputElement.classList.add('is-valid');
        } else {
            inputElement.classList.remove('is-valid');
            inputElement.classList.add('is-invalid');
        }
    }

    // 비밀번호 검증 (기본 입력 여부만 확인, 실제 비밀번호 일치는 서버에서 처리)
    function validatePassword() {
        const value = elements.password.value.trim();
        const isValid = value.length >= 8; // 최소 8자리 이상 입력되어야 함
        
        if (value === '') {
            clearValidationState(elements.password);
            setFeedback(elements.passwordFeedback, '', true);
            return false;
        }
        
        setValidationState(elements.password, isValid);
        if (!isValid) {
            setFeedback(elements.passwordFeedback, '비밀번호는 최소 8자 이상 입력해주세요.', false);
        } else {
            setFeedback(elements.passwordFeedback, '비밀번호 형식이 유효합니다. (실제 일치 여부는 제출 시 확인)', true);
        }
        
        return isValid;
    }
    
    // 이름 검증
    function validateName() {
        const value = elements.confirmName.value.trim();
        const isValid = value === memberName;
        
        if (value === '') {
            clearValidationState(elements.confirmName);
            setFeedback(elements.nameValidationFeedback, '', true);
            return false;
        }
        
        setValidationState(elements.confirmName, isValid);
        if (!isValid) {
            setFeedback(elements.nameValidationFeedback, `이름이 일치하지 않습니다. '입력값: ${value}' ≠ '등록된 이름: ${memberName}'`, false);
        } else {
            setFeedback(elements.nameValidationFeedback, '이름이 확인되었습니다.', true);
        }
        
        return isValid;
    }

    // 동의 체크박스 검증
    function validateConfirmDelete() {
        return elements.confirmDelete && elements.confirmDelete.checked;
    }

    // 제출 버튼 활성화/비활성화
    function updateSubmitButton() {
        const isPasswordValid = validatePassword();
        const isNameValid = validateName();
        const isConfirmChecked = validateConfirmDelete();
        
        const isFormValid = isPasswordValid && isNameValid && isConfirmChecked;
        
        if (elements.submitButton) {
            elements.submitButton.disabled = !isFormValid;
        }
        
        return isFormValid;
    }

    // 탈퇴 확인 다이얼로그
    function showConfirmDialog() {
        const confirmMessage = 
            `최종 확인: ${memberName}님의 회원탈퇴를 진행하시겠습니까?\n\n` +
            "⚠️ 마지막 경고:\n" +
            "• 모든 개인정보가 영구 삭제됩니다\n" +
            "• 동일한 아이디로 재가입이 불가능합니다\n" +
            "• 탈퇴 후에는 절대 복구할 수 없습니다\n\n" +
            "지금 탈퇴하시겠습니까?";
        
        return confirm(confirmMessage);
    }

    // 이벤트 리스너 등록
    function setupEventListeners() {
        // 비밀번호 입력 이벤트
        if (elements.password) {
            elements.password.addEventListener('input', function() {
                updateSubmitButton();
            });
            
            elements.password.addEventListener('blur', function() {
                validatePassword();
                updateSubmitButton();
            });
            
            elements.password.addEventListener('focus', function() {
                clearValidationState(this);
                setFeedback(elements.passwordFeedback, '', true);
            });
        }

        // 이름 입력 이벤트
        if (elements.confirmName) {
            elements.confirmName.addEventListener('input', function() {
                updateSubmitButton();
            });
            
            elements.confirmName.addEventListener('blur', function() {
                validateName();
                updateSubmitButton();
            });
            
            elements.confirmName.addEventListener('focus', function() {
                clearValidationState(this);
                setFeedback(elements.nameValidationFeedback, '', true);
            });
        }
        
        // 동의 체크박스 이벤트
        if (elements.confirmDelete) {
            elements.confirmDelete.addEventListener('change', function() {
                updateSubmitButton();
                
                // 체크박스 유효성 상태 업데이트
                if (this.checked) {
                    this.classList.remove('is-invalid');
                    this.classList.add('is-valid');
                } else {
                    this.classList.remove('is-valid');
                    this.classList.add('is-invalid');
                }
            });
        }

        // 폼 제출 이벤트
        if (elements.form) {
            elements.form.addEventListener('submit', function(event) {
                event.preventDefault(); // 기본 제출 방지
                
                // 최종 유효성 검사
                const isFormValid = updateSubmitButton();
                
                if (!isFormValid) {
                    console.log('폼 유효성 검사 실패');
                    
                    // 첫 번째 오류 필드에 포커스
                    if (!validatePassword() && elements.password) {
                        elements.password.focus();
                        alert('비밀번호를 올바르게 입력해주세요.');
                    } else if (!validateName() && elements.confirmName) {
                        elements.confirmName.focus();
                        alert(`이름을 정확히 입력해주세요. 등록된 이름: '${memberName}'`);
                    } else if (!validateConfirmDelete() && elements.confirmDelete) {
                        elements.confirmDelete.focus();
                        elements.confirmDelete.classList.add('is-invalid');
                        alert('탈퇴 동의 체크박스를 선택해주세요.');
                    }
                    
                    return false;
                }
                
                // 최종 확인 다이얼로그
                if (!showConfirmDialog()) {
                    console.log('사용자가 탈퇴를 취소했습니다.');
                    return false;
                }
                
                // 제출 중 버튼 비활성화 및 진행 상태 표시
                if (elements.submitButton) {
                    elements.submitButton.disabled = true;
                    elements.submitButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>탈퇴 처리 중...';
                    elements.submitButton.classList.remove('btn-danger');
                    elements.submitButton.classList.add('btn-warning');
                }
                
                // 페이지 되돌아가기 방지 (중복 제출 방지)
                window.onbeforeunload = null;
                
                console.log('회원탈퇴 폼 제출');
                
                // 실제 폼 제출
                this.submit();
                return true;
            });
        }
    }

    // 페이지 로드 시 경고 메시지
    function showInitialWarning() {
        // 페이지 진입 시 한 번만 경고
        if (!sessionStorage.getItem('deletePageWarningShown')) {
            setTimeout(() => {
                alert('⚠️ 회원탈퇴 페이지입니다.\n신중히 결정해주세요.');
                sessionStorage.setItem('deletePageWarningShown', 'true');
            }, 500);
        }
    }

    // 페이지 나가기 전 경고
    function setupBeforeUnloadWarning() {
        let formChanged = false;
        let isSubmitting = false; // 폼 제출 상태 플래그
        
        // 폼 변경 감지
        if (elements.password) {
            elements.password.addEventListener('input', () => {
                formChanged = true;
            });
        }
        
        if (elements.confirmName) {
            elements.confirmName.addEventListener('input', () => {
                formChanged = true;
            });
        }
        
        if (elements.confirmDelete) {
            elements.confirmDelete.addEventListener('change', () => {
                formChanged = true;
            });
        }
        
        // 폼 제출 시 경고 비활성화
        if (elements.form) {
            elements.form.addEventListener('submit', function() {
                isSubmitting = true;
            });
        }
        
        // 페이지 나가기 전 경고 (폼 제출 시에는 비활성화)
        window.addEventListener('beforeunload', function(event) {
            if (formChanged && !isSubmitting) {
                event.preventDefault();
                event.returnValue = '입력된 내용이 있습니다. 정말로 페이지를 나가시겠습니까?';
                return event.returnValue;
            }
        });
    }

    // 초기화 함수
    function init() {
        setupPasswordToggle();
        setupEventListeners();
        updateSubmitButton(); // 초기 상태 설정
        showInitialWarning();
        // setupBeforeUnloadWarning(); // 탈퇴 페이지에서는 비활성화
        
        console.log('회원탈퇴 페이지 JavaScript 초기화 완료');
    }

    // 초기화 실행
    init();
});
````

## File: src/main/resources/static/js/facility-image-main-controller.js
````javascript
/**
 * 시설 이미지 메인 컨트롤러 (Main Controller)
 * 모든 시설 이미지 모듈을 통합 관리하는 중앙 컨트롤러
 * 
 * @version 1.0.0
 * @author LightCare Team
 * @requires FacilityImageCore, FacilityImageCropper, FacilityImageUpload, FacilityImageUI, FacilityImageData, FacilityImageSEO, FacilityImageUtils
 */

(function() {
    'use strict';
    
    // ================================================
    // 의존성 체크
    // ================================================
    
    const requiredModules = [
        'FacilityImageCore',
        'FacilityImageCropper', 
        'FacilityImageUpload',
        'FacilityImageUI',
        'FacilityImageData',
        'FacilityImageSEO',
        'FacilityImageUtils'
    ];
    
    const missingModules = requiredModules.filter(module => !window[module]);
    if (missingModules.length > 0) {
        throw new Error(`필수 모듈이 없습니다: ${missingModules.join(', ')}`);
    }
    
    // 모듈 단축 참조
    const Core = window.FacilityImageCore;
    const Cropper = window.FacilityImageCropper;
    const Upload = window.FacilityImageUpload;
    const UI = window.FacilityImageUI;
    const Data = window.FacilityImageData;
    const SEO = window.FacilityImageSEO;
    const Utils = window.FacilityImageUtils;
    
    // ================================================
    // 메인 컨트롤러 네임스페이스
    // ================================================
    
    if (!window.FacilityImageSystem.Main) {
        window.FacilityImageSystem.Main = {};
    }
    
    // ================================================
    // 상수 정의
    // ================================================
    
    const MAIN_CONSTANTS = {
        MODULE_NAME: 'FacilityImageMainController',
        VERSION: '1.0.0',
        
        WORKFLOW_STEPS: {
            UPLOAD: 1,
            CROP: 2,
            MANAGE: 3
        },
        
        STATES: {
            INITIALIZING: 'initializing',
            READY: 'ready',
            UPLOADING: 'uploading',
            CROPPING: 'cropping',
            PROCESSING: 'processing',
            COMPLETE: 'complete',
            ERROR: 'error'
        }
    };
    
    // ================================================
    // 메인 컨트롤러 상태
    // ================================================
    
    const mainState = {
        isInitialized: false,
        currentState: MAIN_CONSTANTS.STATES.INITIALIZING,
        currentStep: MAIN_CONSTANTS.WORKFLOW_STEPS.UPLOAD,
        facilityId: null,
        facilityName: '',
        
        // 모듈 초기화 상태
        moduleStates: {
            core: false,
            cropper: false,
            upload: false,
            ui: false,
            data: false,
            seo: false,
            utils: false
        },
        
        // 작업 데이터
        selectedFiles: [],
        processedImages: [],
        currentImageIndex: 0,
        
        // 설정
        settings: {
            maxFiles: 5,
            enableSEO: true,
            enableCompression: true,
            autoAdvanceSteps: true
        }
    };
    
    // ================================================
    // 모듈 초기화 관리
    // ================================================
    
    const moduleInitializer = {
        async initializeAllModules(facilityId, facilityName, options = {}) {
            Core.logger.log('모든 모듈 초기화 시작');
            Core.logger.log('초기화 매개변수:', { facilityId, facilityName, options });
            
            // UI 모듈 상태 먼저 확인
            if (typeof UI.showProgress === 'function') {
                UI.showProgress('initialization', '모듈 초기화 중...');
            } else {
                Core.logger.warn('UI.showProgress를 사용할 수 없음');
            }
            
            try {
                // 1. Core 모듈 초기화 (이미 초기화됨)
                mainState.moduleStates.core = true;
                UI.updateProgress('initialization', 15, 'Core 모듈 준비됨');
                
                // 2. Utils 모듈 초기화
                mainState.moduleStates.utils = await Utils.initialize();
                UI.updateProgress('initialization', 25, 'Utils 모듈 초기화 완료');
                
                // 3. UI 모듈 초기화
                mainState.moduleStates.ui = await UI.initialize();
                UI.updateProgress('initialization', 40, 'UI 모듈 초기화 완료');
                
                // 4. Data 모듈 초기화
                mainState.moduleStates.data = await Data.initialize(facilityId);
                UI.updateProgress('initialization', 55, 'Data 모듈 초기화 완료');
                
                // 5. SEO 모듈 초기화
                mainState.moduleStates.seo = await SEO.initialize(facilityName);
                UI.updateProgress('initialization', 70, 'SEO 모듈 초기화 완료');
                
                // 6. Upload 모듈 초기화
                const uploadCallbacks = this.getUploadCallbacks();
                mainState.moduleStates.upload = await Upload.initialize({ callbacks: uploadCallbacks });
                UI.updateProgress('initialization', 85, 'Upload 모듈 초기화 완료');
                
                // 7. Cropper 모듈 초기화 (안전한 초기화)
                try {
                    mainState.moduleStates.cropper = await Cropper.initialize();
                    Core.logger.success('크롭퍼 모듈 초기화 완료');
                } catch (cropperError) {
                    Core.logger.error('크롭퍼 모듈 초기화 실패:', cropperError);
                    mainState.moduleStates.cropper = false;
                    // 크롭퍼 초기화 실패 시에도 시스템은 계속 작동
                    Core.logger.warn('크롭퍼 없이 시스템을 계속 진행합니다.');
                }
                UI.updateProgress('initialization', 100, '모든 모듈 초기화 완료');
                
                // 진행률 숨김
                setTimeout(() => {
                    UI.hideProgress('initialization');
                }, 1000);
                
                Core.logger.success('모든 모듈 초기화 완료');
                return true;
                
            } catch (error) {
                UI.hideProgress('initialization');
                UI.showNotification('모듈 초기화에 실패했습니다.', UI.CONSTANTS.NOTIFICATION_TYPES.ERROR);
                Core.logger.error('모듈 초기화 실패:', error);
                return false;
            }
        },
        
        getUploadCallbacks() {
            return {
                onFileSelect: this.handleFileSelect.bind(this),
                onFileValidate: this.handleFileValidate.bind(this),
                onUploadProgress: this.handleUploadProgress.bind(this),
                onUploadComplete: this.handleUploadComplete.bind(this),
                onError: this.handleUploadError.bind(this)
            };
        },
        
        handleFileSelect(files) {
            Core.logger.log('파일 선택됨:', files.length);
            
            // 1단계에서는 원본 File 객체만 사용 (압축 없이)
            const originalFiles = files.map(fileData => fileData.file || fileData);
            mainState.selectedFiles = originalFiles;
            
            // 메인 이미지 상태 초기화 (사용자가 직접 선택하도록 변경)
            mainState.mainImageIndex = -1; // 초기에는 메인 이미지 미선택
            
            // 이미지 순서 설정 UI 표시
            this.showImageOrderInterface(originalFiles);
        },
        
        handleFileValidate(validation) {
            if (validation.errors.length > 0) {
                UI.showNotification(
                    `파일 검증 오류: ${validation.errors.join(', ')}`,
                    UI.CONSTANTS.NOTIFICATION_TYPES.ERROR
                );
            }
        },
        
        handleUploadProgress(progress) {
            UI.updateProgress('upload', progress.percentage, progress.message);
        },
        
        handleUploadComplete(result) {
            UI.showNotification('업로드가 완료되었습니다.', UI.CONSTANTS.NOTIFICATION_TYPES.SUCCESS);
            controller.moveToStep(MAIN_CONSTANTS.WORKFLOW_STEPS.MANAGE);
        },
        
        handleUploadError(error) {
            UI.showNotification(`업로드 오류: ${error.message}`, UI.CONSTANTS.NOTIFICATION_TYPES.ERROR);
        },
        
        // 이미지 순서 설정 UI 표시
        showImageOrderInterface(files) {
            try {
                // 더 유연한 DOM 요소 찾기
                let previewContainer = document.getElementById('selectedImagesPreview') || 
                                     document.querySelector('.selected-images-preview, .image-preview-container, .preview-area');
                
                let orderList = document.getElementById('imageOrderList') || 
                              document.querySelector('.image-order-list, .preview-grid, .image-list');
                
                // DOM 요소가 없으면 동적으로 생성
                if (!previewContainer) {
                    previewContainer = this.createPreviewContainer();
                    Core.logger.log('미리보기 컨테이너 동적 생성');
                }
                
                if (!orderList) {
                    orderList = this.createOrderList(previewContainer);
                    Core.logger.log('이미지 순서 목록 동적 생성');
                }
                
                const selectedCount = document.getElementById('selectedCount') || 
                                    document.querySelector('.selected-count, .file-count');
                const proceedBtn = document.getElementById('proceedToCropBtn') || 
                                 document.querySelector('.proceed-btn, .next-step-btn');
                const addMoreBtn = document.getElementById('addMoreImagesBtn') || 
                                 document.querySelector('.add-more-btn, .add-images-btn');
                
                if (!previewContainer || !orderList) {
                    Core.logger.warn('필요한 DOM 요소를 찾을 수 없습니다');
                    Core.logger.log('DOM 상태:', {
                        previewContainer: !!previewContainer,
                        orderList: !!orderList,
                        body: !!document.body
                    });
                    return;
                }
                
                // 선택된 파일 수 업데이트
                if (selectedCount) {
                    selectedCount.textContent = files.length;
                }
                
                // 이미지 목록 생성
                orderList.innerHTML = '';
                files.forEach((file, index) => {
                    try {
                        const imageItem = this.createImageOrderItem(file, index);
                        orderList.appendChild(imageItem);
                    } catch (itemError) {
                        Core.logger.error(`이미지 아이템 ${index} 생성 실패:`, itemError);
                        // 오류가 발생해도 계속 진행
                    }
                });
                
                // 버튼 활성화
                if (proceedBtn) {
                    proceedBtn.style.display = 'inline-block';
                    proceedBtn.onclick = () => {
                        controller.moveToStep(MAIN_CONSTANTS.WORKFLOW_STEPS.CROP);
                    };
                }
                
                // 중복 파일선택 버튼 제거 - 기본 mainFileSelectBtn만 사용
                if (addMoreBtn && files.length < 5) {
                    // 이미지 추가 버튼은 숨김 처리 (중복 파일선택 방지)
                    addMoreBtn.style.display = 'none';
                    Core.logger.log('중복 파일선택 버튼 숨김 처리');
                }
                
                // 메인 이미지 정보 표시
                this.updateMainImageInfo();
                
                // 미리보기 컨테이너 표시
                previewContainer.style.display = 'block';
                
            } catch (error) {
                Core.logger.error('이미지 순서 인터페이스 표시 실패:', error);
                UI.showNotification('이미지 목록 표시에 실패했습니다.', UI.CONSTANTS.NOTIFICATION_TYPES.ERROR);
            }
        },
        
        // 이미지 순서 아이템 생성
        createImageOrderItem(file, index) {
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4 image-order-item';
            
            // 이미지 미리보기 URL 생성 (1단계는 원본 파일만)
            let imageUrl;
            try {
                if (file instanceof File) {
                    imageUrl = URL.createObjectURL(file);
                } else {
                    throw new Error('File 객체가 아님');
                }
            } catch (error) {
                console.warn('이미지 URL 생성 실패:', error, file);
                imageUrl = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSIjOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+SW1hZ2U8L3RleHQ+PC9zdmc+';
            }
            
            const isMainImage = mainState.mainImageIndex >= 0 && index === mainState.mainImageIndex;
            
            col.innerHTML = `
                <div class="card h-100 ${isMainImage ? 'border-warning border-3' : 'border-secondary'}" style="cursor: pointer; transition: all 0.3s ease;">
                    <div class="position-relative">
                        <img src="${imageUrl}" class="card-img-top" style="height: 150px; object-fit: cover;" alt="이미지 ${index + 1}">
                        
                        <!-- 메인 이미지 선택 버튼 -->
                        <div class="position-absolute top-0 start-0 p-2">
                            <button type="button" class="btn btn-sm ${isMainImage ? 'btn-warning' : 'btn-outline-warning'}" 
                                    onclick="event.stopPropagation(); selectMainImage(${index})" 
                                    title="${isMainImage ? '메인 이미지 해제' : '메인 이미지로 설정'}">
                                <i class="fas fa-star"></i>
                            </button>
                        </div>
                        
                        <!-- 순서 표시 -->
                        <div class="position-absolute top-0 end-0 p-2">
                            <span class="badge ${isMainImage ? 'bg-warning text-dark' : 'bg-primary'} order-badge">${index + 1}</span>
                            ${isMainImage ? '<small class="badge bg-warning text-dark mt-1 d-block">메인</small>' : ''}
                        </div>
                        
                        <!-- 삭제 버튼 -->
                        <div class="position-absolute bottom-0 end-0 p-2">
                            <button type="button" class="btn btn-sm btn-danger" onclick="event.stopPropagation(); removeImageFromOrder(${index})">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-2">
                        <h6 class="card-title text-truncate mb-1" style="font-size: 0.875rem;">
                            ${file.name || `이미지 ${index + 1}`}
                        </h6>
                        <small class="text-muted d-block">${this.formatFileSize(file.size || 0)}</small>
                        <div class="mt-2">
                            <div class="btn-group w-100" role="group">
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="event.stopPropagation(); moveImageUp(${index})" ${index === 0 ? 'disabled' : ''}>
                                    <i class="fas fa-chevron-up"></i>
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="event.stopPropagation(); moveImageDown(${index})" ${index === mainState.selectedFiles.length - 1 ? 'disabled' : ''}>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return col;
        },
        
        // 메인 이미지 정보 업데이트
        updateMainImageInfo() {
            const mainImageInfo = document.getElementById('mainImageInfo');
            const mainImageText = document.getElementById('mainImageText');
            
            if (mainImageInfo && mainImageText && mainState.selectedFiles.length > 0) {
                if (mainState.mainImageIndex >= 0 && mainState.mainImageIndex < mainState.selectedFiles.length) {
                    const mainFile = mainState.selectedFiles[mainState.mainImageIndex];
                    mainImageText.textContent = `메인 이미지: ${mainFile.name || `이미지 ${mainState.mainImageIndex + 1}`}`;
                    mainImageInfo.style.display = 'block';
                } else {
                    mainImageText.textContent = '메인 이미지: 선택하지 않음 (각 이미지에서 별 아이콘 클릭하여 선택)';
                    mainImageInfo.style.display = 'block';
                }
            }
        },
        
        // 파일 크기 포맷
        formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        },
        
        // 미리보기 컨테이너 동적 생성
        createPreviewContainer() {
            const container = document.createElement('div');
            container.id = 'selectedImagesPreview';
            container.className = 'selected-images-preview mt-4';
            container.style.display = 'block';
            
            // 적절한 위치에 삽입
            const uploadSection = document.getElementById('uploadSection') || 
                                document.querySelector('.upload-section, .content-wrapper, main');
            if (uploadSection) {
                uploadSection.appendChild(container);
            } else {
                document.body.appendChild(container);
            }
            
            return container;
        },
        
        // 이미지 순서 목록 동적 생성
        createOrderList(parentContainer) {
            const orderListHtml = `
                <div class="row mb-3">
                    <div class="col-12">
                        <h5>선택된 이미지 <span id="selectedCount" class="badge bg-primary">0</span></h5>
                        <div id="mainImageInfo" class="alert alert-info" style="display: none;">
                            <i class="fas fa-star text-warning me-2"></i>
                            <span id="mainImageText">메인 이미지: </span>
                        </div>
                    </div>
                </div>
                <div id="imageOrderList" class="row g-3"></div>
                <div class="row mt-3">
                    <div class="col-12 text-center">
                        <button type="button" id="addMoreImagesBtn" class="btn btn-outline-primary me-2" style="display: none;">
                            <i class="fas fa-plus me-1"></i>이미지 추가
                        </button>
                        <button type="button" id="proceedToCropBtn" class="btn btn-success" style="display: none;">
                            <i class="fas fa-arrow-right me-1"></i>다음 단계
                        </button>
                    </div>
                </div>
            `;
            
            parentContainer.innerHTML = orderListHtml;
            
            return document.getElementById('imageOrderList');
        }
    };
    
    // ================================================
    // 워크플로우 관리
    // ================================================
    
    const workflowManager = {
        async moveToStep(step) {
            if (step === mainState.currentStep) return;
            
            // 🔥 새창 방식 강제: 2단계 이동 차단
            if (step === 2) {
                Core.logger.log(`🚫 2단계 이동 차단 - 새창 방식 사용`);
                
                // 시설 ID 가져오기
                const facilityId = document.querySelector('meta[name="facility-id"]')?.content || '1';
                
                // 🔥 1단계 압축 후 세션 저장 (이 코드는 edit.html의 덮어쓰기로 대체됨)
                Core.logger.log('⚠️ 이 코드는 edit.html의 압축 모듈로 대체되었습니다.');
                
                // 폴백: 압축 없이 직접 전송
                if (window.selectedImageFiles && window.selectedImageFiles.length > 0) {
                    window.transferSelectedFiles = window.selectedImageFiles;
                    Core.logger.log('✅ 폴백: 원본 파일로 크롭 페이지 이동');
                    window.location.href = `/facility/crop-images/${facilityId}`;
                } else {
                    Core.logger.log('⚠️ 선택된 파일이 없어 빈 크롭 페이지로 이동');
                    window.location.href = `/facility/crop-images/${facilityId}`;
                }
                
                return; // 여기서 함수 종료
            }
            
            Core.logger.log(`단계 이동: ${mainState.currentStep} → ${step}`);
            
            try {
                // 이전 단계 정리
                await this.cleanupCurrentStep();
                
                // 새 단계 설정
                mainState.currentStep = step;
                UI.updateStep(step);
                
                // 새 단계 초기화
                await this.initializeStep(step);
                
                Core.emit(Core.CONSTANTS.EVENTS.STEP_CHANGED, {
                    step: step,
                    previousStep: mainState.currentStep
                });
                
            } catch (error) {
                Core.logger.error('단계 이동 실패:', error);
                UI.showNotification('단계 이동에 실패했습니다.', UI.CONSTANTS.NOTIFICATION_TYPES.ERROR);
            }
        },
        
        async cleanupCurrentStep() {
            switch (mainState.currentStep) {
                case MAIN_CONSTANTS.WORKFLOW_STEPS.UPLOAD:
                    // 업로드 단계 정리
                    break;
                case MAIN_CONSTANTS.WORKFLOW_STEPS.CROP:
                    // 크롭 단계 정리
                    if (mainState.moduleStates.cropper) {
                        // 현재 크롭 저장
                        await this.savePendingCrops();
                    }
                    break;
                case MAIN_CONSTANTS.WORKFLOW_STEPS.MANAGE:
                    // 관리 단계 정리
                    break;
            }
        },
        
        async initializeStep(step) {
            switch (step) {
                case MAIN_CONSTANTS.WORKFLOW_STEPS.UPLOAD:
                    await this.initializeUploadStep();
                    break;
                case MAIN_CONSTANTS.WORKFLOW_STEPS.CROP:
                    await this.initializeCropStep();
                    break;
                case MAIN_CONSTANTS.WORKFLOW_STEPS.MANAGE:
                    await this.initializeManageStep();
                    break;
            }
        },
        
        async initializeUploadStep() {
            UI.show('#uploadSection');
            UI.hide('#cropSection');
            UI.hide('#manageSection');
            
            mainState.currentState = MAIN_CONSTANTS.STATES.READY;
        },
        
        async initializeCropStep() {
            if (mainState.selectedFiles.length === 0) {
                UI.showNotification('먼저 이미지를 선택해주세요.', UI.CONSTANTS.NOTIFICATION_TYPES.WARNING);
                await this.moveToStep(MAIN_CONSTANTS.WORKFLOW_STEPS.UPLOAD);
                return;
            }
            
            Core.logger.log('크롭 단계 초기화 시작');
            
            // 1. 단계별 UI 표시/숨김 (먼저 처리)
            const uploadSection = document.getElementById('uploadSection');
            const cropSection = document.getElementById('cropSection');
            const manageSection = document.getElementById('manageSection');
            
            if (uploadSection) {
                uploadSection.style.display = 'none';
                Core.logger.log('업로드 섹션 숨김');
            }
            if (cropSection) {
                cropSection.style.display = 'block';
                cropSection.style.visibility = 'visible';
                Core.logger.log('크롭 섹션 표시');
            } else {
                Core.logger.error('크롭 섹션을 찾을 수 없습니다.');
                // 크롭 섹션이 없으면 동적 생성
                this.createCropSection();
            }
            if (manageSection) {
                manageSection.style.display = 'none';
            }
            
            // 2. 크롭퍼 모듈 상태 확인 및 강제 초기화
            if (!mainState.moduleStates.cropper) {
                Core.logger.warn('크롭퍼 모듈이 초기화되지 않았습니다. 강제 초기화를 시도합니다.');
                try {
                    await Cropper.initialize();
                    mainState.moduleStates.cropper = true;
                    Core.logger.success('크롭퍼 모듈 강제 초기화 성공');
                } catch (error) {
                    Core.logger.error('크롭퍼 모듈 강제 초기화 실패:', error);
                    UI.showNotification('크롭 기능을 사용할 수 없어 최종 단계로 이동합니다.', UI.CONSTANTS.NOTIFICATION_TYPES.WARNING);
                    await this.moveToStep(MAIN_CONSTANTS.WORKFLOW_STEPS.MANAGE);
                    return;
                }
            }
            
            // 3. 파일 선택 이벤트 임시 차단 (2단계 진입 시 파일 선택창 방지)
            const fileInput = document.getElementById('imageInput');
            if (fileInput) {
                fileInput.style.pointerEvents = 'none';
                setTimeout(() => {
                    if (fileInput) fileInput.style.pointerEvents = 'auto';
                }, 1000); // 1초 후 다시 활성화
            }
            
            // 4. 첫 번째 이미지 로드 (500ms 지연으로 DOM 안정화 대기)
            setTimeout(async () => {
                if (mainState.selectedFiles.length > 0) {
                    await this.loadImageForCrop(0);
                }
            }, 500);
            
            mainState.currentState = MAIN_CONSTANTS.STATES.CROPPING;
            Core.logger.success('크롭 단계 초기화 완료');
        },
        
        // 크롭 섹션 동적 생성 (HTML에 없는 경우)
        createCropSection() {
            const mainContainer = document.querySelector('.upload-section') || document.querySelector('main .container');
            if (!mainContainer) {
                Core.logger.error('메인 컨테이너를 찾을 수 없습니다.');
                return;
            }
            
            const cropSection = document.createElement('div');
            cropSection.id = 'cropSection';
            cropSection.className = 'crop-section';
            cropSection.style.display = 'none';
            
            cropSection.innerHTML = `
                <div class="compression-header mb-3">
                    <h6 class="text-success">
                        <i class="fas fa-crop-alt me-2"></i>이미지 크롭 및 고성능 압축
                    </h6>
                    <div class="compression-progress">
                        <small class="text-muted">현재 이미지: <span id="currentImageInfo">1 / 1</span></small>
                    </div>
                </div>
                
                <!-- 크롭 영역 -->
                <div id="cropContainer" class="crop-container mb-3">
                    <div class="crop-image-container">
                        <img id="cropImage" style="max-width: 100%; max-height: 500px; display: block; margin: 0 auto;">
                        <canvas id="cropCanvas" style="display: none;"></canvas>
                    </div>
                </div>
                
                <!-- 크롭 컨트롤 -->
                <div id="cropControls" class="crop-controls mb-3">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="crop-navigation d-flex align-items-center">
                                <button type="button" id="prevImage" class="btn btn-sm btn-outline-secondary me-2">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button type="button" id="nextImage" class="btn btn-sm btn-outline-secondary me-3">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                                <button type="button" id="resetCrop" class="btn btn-sm btn-outline-warning me-2">
                                    <i class="fas fa-undo me-1"></i>리셋
                                </button>
                                <button type="button" id="autoFit" class="btn btn-sm btn-outline-info">
                                    <i class="fas fa-expand-arrows-alt me-1"></i>16:9 자동맞춤
                                </button>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button type="button" id="completeImageProcessing" class="btn btn-success">
                                <i class="fas fa-save me-1"></i>압축 완료
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            mainContainer.appendChild(cropSection);
            Core.logger.log('크롭 섹션 동적 생성 완료');
        },
        
        async initializeManageStep() {
            UI.hide('#uploadSection');
            UI.hide('#cropSection');
            UI.show('#manageSection');
            
            // 최종 업로드 준비
            await this.prepareForFinalUpload();
            
            mainState.currentState = MAIN_CONSTANTS.STATES.PROCESSING;
        },
        
        async loadImageForCrop(index) {
            if (index >= mainState.selectedFiles.length) return;
            
            // 크롭퍼 모듈 상태 재확인
            if (!mainState.moduleStates.cropper) {
                Core.logger.warn('크롭퍼 모듈이 사용 불가능합니다.');
                UI.showNotification('크롭 기능을 사용할 수 없습니다.', UI.CONSTANTS.NOTIFICATION_TYPES.WARNING);
                return;
            }
            
            mainState.currentImageIndex = index;
            const file = mainState.selectedFiles[index];
            
            try {
                Core.logger.log('크롭을 위한 이미지 로드:', { index, file: file.name, type: file.type });
                
                // 크롭 이미지 요소 강제 확인 및 생성
                let cropImage = document.getElementById('cropImage');
                if (!cropImage) {
                    Core.logger.warn('cropImage 요소가 없습니다. 동적 생성 시도');
                    cropImage = this.createCropImageElement();
                }
                
                // 크롭퍼 모듈 상태 확인 후 로드
                if (Cropper && typeof Cropper.loadImage === 'function') {
                    await Cropper.loadImage(file, index);
                    
                    // 크롭 이미지가 제대로 로드되었는지 확인
                    setTimeout(() => {
                        const cropImageCheck = document.getElementById('cropImage');
                        if (cropImageCheck && cropImageCheck.src) {
                            Core.logger.success('크롭 이미지 로드 확인됨:', cropImageCheck.src.substring(0, 50) + '...');
                        } else {
                            Core.logger.error('크롭 이미지가 로드되지 않았습니다.');
                            // 직접 이미지 소스 설정 시도
                            this.fallbackImageLoad(file, cropImageCheck);
                        }
                    }, 500);
                    
                    // 크롭 네비게이션 업데이트
                    this.updateCropNavigation();
                    
                    // 2단계 압축 설정 초기화
                    this.initializeCompressionSettings();
                    
                    // SEO 기능 초기화
                    this.initializeSEOFeatures(file, index);
                    
                    // 이미지 정보 업데이트
                    this.updateImageInfo(file, index);
                } else {
                    throw new Error('크롭퍼 모듈을 사용할 수 없습니다.');
                }
                
            } catch (error) {
                Core.logger.error('이미지 로드 실패:', error);
                UI.showNotification('이미지 로드에 실패했습니다.', UI.CONSTANTS.NOTIFICATION_TYPES.ERROR);
                
                // 크롭퍼 실패 시 대체 로드 시도
                this.fallbackImageLoad(file, document.getElementById('cropImage'));
            }
        },
        
        // 크롭 이미지 요소 동적 생성
        createCropImageElement() {
            const cropContainer = document.querySelector('.crop-image-container') || document.getElementById('cropContainer');
            if (!cropContainer) {
                Core.logger.error('크롭 컨테이너를 찾을 수 없습니다.');
                return null;
            }
            
            let cropImage = document.createElement('img');
            cropImage.id = 'cropImage';
            cropImage.style.cssText = 'max-width: 100%; max-height: 500px; display: block; margin: 0 auto;';
            
            cropContainer.appendChild(cropImage);
            Core.logger.log('cropImage 요소 동적 생성 완료');
            
            return cropImage;
        },
        
        // 대체 이미지 로드 (크롭퍼 실패 시)
        fallbackImageLoad(file, imageElement) {
            if (!imageElement || !file) return;
            
            Core.logger.warn('대체 이미지 로드 시도:', file.name);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                imageElement.src = e.target.result;
                imageElement.style.display = 'block';
                Core.logger.success('대체 이미지 로드 성공');
            };
            reader.onerror = function() {
                Core.logger.error('대체 이미지 로드도 실패');
                imageElement.style.display = 'none';
            };
            reader.readAsDataURL(file);
        },
        
        // 2단계 압축 설정 초기화
        initializeCompressionSettings() {
            const compressionContainer = document.getElementById('compressionSettings');
            if (!compressionContainer) return;
            
            // 압축 설정 UI 표시
            compressionContainer.style.display = 'block';
            
            // 압축 품질 슬라이더 초기화
            const qualitySlider = document.getElementById('compressionQuality');
            const qualityValue = document.getElementById('qualityValue');
            
            if (qualitySlider && qualityValue) {
                qualitySlider.value = 85;
                qualityValue.textContent = '85%';
                
                qualitySlider.addEventListener('input', (e) => {
                    qualityValue.textContent = e.target.value + '%';
                });
            }
        },
        
        // SEO 기능 초기화 (완전 기능)
        initializeSEOFeatures(file, index) {
            const seoContainer = document.getElementById('seoSettings');
            if (!seoContainer) return;
            
            seoContainer.style.display = 'block';
            
            // 파일명 영문 변환 (안전한 방식)
            const originalName = file.name.split('.')[0];
            let englishName;
            
            try {
                // SEO 모듈이 있으면 사용, 없으면 기본 변환
                if (window.FacilityImageSystem?.SEO?.cleanFileName) {
                    englishName = window.FacilityImageSystem.SEO.cleanFileName(originalName);
                } else {
                    englishName = this.simpleCleanFileName(originalName);
                }
            } catch (error) {
                englishName = this.simpleCleanFileName(originalName);
            }
            
            const filenameInput = document.getElementById('englishFilename');
            if (filenameInput) {
                filenameInput.value = englishName || `facility-image-${index + 1}`;
            }
            
            // Alt 텍스트 설정
            const altTextInput = document.getElementById('altText');
            if (altTextInput) {
                altTextInput.value = `${mainState.facilityName || '시설'} 시설 이미지 ${index + 1}`;
            }
            
            // 키워드 목록 초기화
            this.initializeKeywordList();
        },
        
        // 간단한 파일명 정리 (백업용)
        simpleCleanFileName(fileName) {
            if (!fileName || typeof fileName !== 'string') {
                return 'facility-image';
            }
            
            // 한글을 영어로 기본 변환
            const koreanToEnglish = {
                '시설': 'facility',
                '요양원': 'nursing-home',
                '로비': 'lobby',
                '복도': 'corridor',
                '거실': 'living-room',
                '침실': 'bedroom',
                '식당': 'dining-room',
                '정원': 'garden'
            };
            
            let result = fileName.toLowerCase();
            for (const [korean, english] of Object.entries(koreanToEnglish)) {
                result = result.replace(new RegExp(korean, 'g'), english);
            }
            
            // 특수문자 제거 및 대시로 변환
            result = result.replace(/[^a-zA-Z0-9]/g, '-').replace(/-+/g, '-').replace(/^-|-$/g, '');
            
            return result || 'facility-image';
        },
        
        // 키워드 목록 초기화
        initializeKeywordList() {
            const keywordContainer = document.getElementById('keywordList');
            if (!keywordContainer) return;
            
            const defaultKeywords = [
                '시설', '요양원', '노인요양', '복지시설', '데이케어',
                '간병', '건강관리', '의료서비스', '재활치료', '요양보호'
            ];
            
            keywordContainer.innerHTML = '';
            
            defaultKeywords.forEach(keyword => {
                const badge = document.createElement('span');
                badge.className = 'badge bg-outline-secondary me-1 mb-1 keyword-badge';
                badge.style.cursor = 'pointer';
                badge.textContent = keyword;
                badge.onclick = () => this.toggleKeyword(badge, keyword);
                keywordContainer.appendChild(badge);
            });
        },
        
        // 키워드 토글
        toggleKeyword(badge, keyword) {
            if (badge.classList.contains('bg-primary')) {
                badge.classList.remove('bg-primary');
                badge.classList.add('bg-outline-secondary');
            } else {
                badge.classList.remove('bg-outline-secondary');
                badge.classList.add('bg-primary');
            }
            
            // 선택된 키워드 업데이트
            this.updateSelectedKeywords();
        },
        
        // 선택된 키워드 업데이트
        updateSelectedKeywords() {
            const selectedKeywords = [];
            const keywordBadges = document.querySelectorAll('.keyword-badge.bg-primary');
            
            keywordBadges.forEach(badge => {
                selectedKeywords.push(badge.textContent);
            });
            
            // 현재 파일에 키워드 저장
            const currentFile = mainState.selectedFiles[mainState.currentImageIndex];
            if (currentFile) {
                currentFile.keywords = selectedKeywords;
            }
        },
        
        // 이미지 정보 업데이트
        updateImageInfo(file, index) {
            const imageFileName = document.getElementById('imageFileName');
            const imageDimensions = document.getElementById('imageDimensions');
            
            if (imageFileName) {
                imageFileName.textContent = file.name || `이미지 ${index + 1}`;
                imageFileName.title = file.name || `이미지 ${index + 1}`;
            }
            
            // 이미지 크기 정보 업데이트 (파일 로드 후)
            if (imageDimensions && file instanceof File) {
                const img = new Image();
                img.onload = () => {
                    imageDimensions.textContent = `${img.width} × ${img.height}`;
                };
                img.src = URL.createObjectURL(file);
            }
        },
        
        updateCropNavigation() {
            const current = mainState.currentImageIndex + 1;
            const total = mainState.selectedFiles.length;
            
            // 네비게이션 UI 업데이트
            const navInfo = document.querySelector('.crop-navigation-info');
            if (navInfo) {
                navInfo.textContent = `${current} / ${total}`;
            }
            
            // 이전/다음 버튼 상태 업데이트
            const prevBtn = document.getElementById('prevImageBtn');
            const nextBtn = document.getElementById('nextImageBtn');
            
            if (prevBtn) {
                prevBtn.disabled = (current === 1);
            }
            
            if (nextBtn) {
                if (current === total) {
                    nextBtn.innerHTML = '<i class="fas fa-check me-1"></i>완료';
                    nextBtn.className = 'btn btn-success';
                } else {
                    nextBtn.innerHTML = '<i class="fas fa-arrow-right me-1"></i>다음';
                    nextBtn.className = 'btn btn-primary';
                }
            }
        },
        
        async savePendingCrops() {
            // 현재 크롭 데이터 저장
            const cropData = Cropper.getCropData();
            if (cropData) {
                const currentFile = mainState.selectedFiles[mainState.currentImageIndex];
                if (currentFile) {
                    currentFile.cropData = cropData;
                    currentFile.croppedBlob = await Cropper.getCroppedBlob();
                }
            }
        },
        
        async prepareForFinalUpload() {
            UI.showProgress('final-upload', '최종 업로드 준비 중...');
            
            try {
                // 모든 파일의 크롭 데이터 확인
                for (let i = 0; i < mainState.selectedFiles.length; i++) {
                    const fileData = mainState.selectedFiles[i];
                    
                    if (!fileData.croppedBlob) {
                        // 크롭되지 않은 파일은 원본 사용
                        fileData.croppedBlob = fileData.compressedBlob || fileData.file;
                    }
                    
                    UI.updateProgress('final-upload', (i + 1) / mainState.selectedFiles.length * 100, 
                        `파일 준비 중... ${i + 1}/${mainState.selectedFiles.length}`);
                }
                
                UI.hideProgress('final-upload');
                mainState.processedImages = mainState.selectedFiles;
                
            } catch (error) {
                UI.hideProgress('final-upload');
                Core.logger.error('최종 업로드 준비 실패:', error);
                throw error;
            }
        },
        
        // 크롭 단계에서 압축 적용 (안전한 완전 기능)
        async applyCompressionToCrop() {
            const currentFile = mainState.selectedFiles[mainState.currentImageIndex];
            if (!currentFile || !window.FacilityImageCropper) return;
            
            try {
                const qualitySlider = document.getElementById('compressionQuality');
                const quality = qualitySlider ? parseInt(qualitySlider.value) / 100 : 0.85;
                
                // 크롭된 이미지 얻기
                const croppedBlob = await window.FacilityImageCropper.getCroppedBlob({
                    quality: quality,
                    format: 'image/jpeg',
                    maxWidth: 1920,
                    maxHeight: 1080
                });
                
                if (croppedBlob) {
                    let finalBlob = croppedBlob;
                    
                    // 압축 모듈이 있으면 추가 압축 적용
                    try {
                        if (window.FacilityImageUpload?.compressImage) {
                            finalBlob = await window.FacilityImageUpload.compressImage(croppedBlob, {
                                quality: quality,
                                maxWidth: 1920,
                                maxHeight: 1080
                            });
                        }
                    } catch (compressError) {
                        Core.logger.warn('추가 압축 실패, 크롭된 이미지 사용:', compressError);
                        finalBlob = croppedBlob;
                    }
                    
                    // 파일에 저장
                    currentFile.croppedBlob = finalBlob;
                    currentFile.compressed = true;
                    
                    // 실시간 미리보기 업데이트
                    this.updateRealTimePreview(finalBlob);
                    
                    Core.logger.log('크롭 및 압축 완료:', {
                        original: currentFile.size,
                        final: finalBlob.size,
                        reduction: Math.round((1 - finalBlob.size / currentFile.size) * 100) + '%'
                    });
                }
                
            } catch (error) {
                Core.logger.error('압축 적용 실패:', error);
                UI.showNotification('이미지 처리에 실패했습니다.', UI.CONSTANTS.NOTIFICATION_TYPES.WARNING);
            }
        },
        
        // 실시간 미리보기 업데이트
        updateRealTimePreview(blob) {
            try {
                const previewImg = document.getElementById('cropPreviewImage') || 
                                 document.querySelector('.crop-preview-image, .preview-img');
                
                if (previewImg && blob) {
                    const url = URL.createObjectURL(blob);
                    previewImg.src = url;
                    previewImg.style.display = 'block';
                    
                    // 이전 URL 정리
                    if (previewImg.dataset.previousUrl) {
                        URL.revokeObjectURL(previewImg.dataset.previousUrl);
                    }
                    previewImg.dataset.previousUrl = url;
                    
                    Core.logger.log('실시간 미리보기 업데이트 완료');
                } else {
                    Core.logger.warn('미리보기 이미지 요소 또는 blob을 찾을 수 없음');
                }
            } catch (error) {
                Core.logger.error('실시간 미리보기 업데이트 실패:', error);
            }
        },
        
        // 다음 이미지로 이동
        async proceedToNextImage() {
            // 현재 설정 저장
            await this.saveCurrentImageSettings();
            
            const nextIndex = mainState.currentImageIndex + 1;
            if (nextIndex < mainState.selectedFiles.length) {
                await this.loadImageForCrop(nextIndex);
            } else {
                // 모든 이미지 완료 - 3단계로 이동
                await this.moveToStep(MAIN_CONSTANTS.WORKFLOW_STEPS.MANAGE);
            }
        },
        
        // 이전 이미지로 이동
        async proceedToPrevImage() {
            // 현재 설정 저장
            await this.saveCurrentImageSettings();
            
            const prevIndex = mainState.currentImageIndex - 1;
            if (prevIndex >= 0) {
                await this.loadImageForCrop(prevIndex);
            }
        },
        
        // 현재 이미지 설정 저장
        async saveCurrentImageSettings() {
            const currentFile = mainState.selectedFiles[mainState.currentImageIndex];
            if (!currentFile) return;
            
            try {
                // 크롭 데이터 저장
                const cropData = Cropper.getCropData();
                if (cropData) {
                    currentFile.cropData = cropData;
                }
                
                // Alt 텍스트 저장
                const altTextInput = document.getElementById('altText');
                if (altTextInput) {
                    currentFile.altText = altTextInput.value;
                }
                
                // 파일명 저장
                const filenameInput = document.getElementById('englishFilename');
                if (filenameInput) {
                    currentFile.englishFilename = filenameInput.value;
                }
                
                // 선택된 키워드 업데이트
                this.updateSelectedKeywords();
                
                // 압축 적용
                await this.applyCompressionToCrop();
                
            } catch (error) {
                Core.logger.error('설정 저장 실패:', error);
            }
        }
    };
    
    // ================================================
    // 이벤트 관리
    // ================================================
    
    const eventManager = {
        setupGlobalEvents() {
            // 크롭퍼 이벤트
            Core.on('imageCropped', this.handleImageCropped.bind(this));
            Core.on('nextImage', this.handleNextImage.bind(this));
            Core.on('prevImage', this.handlePrevImage.bind(this));
            
            // 데이터 이벤트
            Core.on('uploadComplete', this.handleDataUploadComplete.bind(this));
            
            // 키보드 단축키
            document.addEventListener('keydown', this.handleKeyboardShortcuts.bind(this));
        },
        
        handleImageCropped(data) {
            const currentFile = mainState.selectedFiles[data.index];
            if (currentFile) {
                currentFile.croppedBlob = data.blob;
                currentFile.cropData = data.cropData;
            }
            
            // 자동 이돔을 제거하고 수동 제어로 변경
            // 사용자가 직접 다음 버튼을 눌러야 이동
            this.updateRealTimePreview(data.blob);
        },
        
        async handleNextImage() {
            await workflowManager.proceedToNextImage();
        },
        
        async handlePrevImage() {
            await workflowManager.proceedToPrevImage();
        },
        
        handleDataUploadComplete(data) {
            UI.showNotification('모든 이미지가 성공적으로 업로드되었습니다!', UI.CONSTANTS.NOTIFICATION_TYPES.SUCCESS);
            mainState.currentState = MAIN_CONSTANTS.STATES.COMPLETE;
            
            // 페이지 새로고침 또는 리다이렉트
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        },
        
        handleKeyboardShortcuts(event) {
            if (mainState.currentStep !== MAIN_CONSTANTS.WORKFLOW_STEPS.CROP) return;
            
            // Cropper 모듈의 키보드 단축키는 이미 처리됨
            // 추가적인 전역 단축키만 여기서 처리
            
            if (event.key === 'Escape') {
                // ESC: 1단계로 돌아가기
                event.preventDefault();
                controller.moveToStep(MAIN_CONSTANTS.WORKFLOW_STEPS.UPLOAD);
            }
        }
    };
    
    // ================================================
    // 메인 컨트롤러 객체
    // ================================================
    
    const controller = {
        async initialize(options = {}) {
            if (mainState.isInitialized) {
                Core.logger.warn('메인 컨트롤러가 이미 초기화됨');
                return true;
            }
            
            Core.logger.log('메인 컨트롤러 초기화 시작');
            
            try {
                // 설정 병합
                Object.assign(mainState.settings, options.settings || {});
                
                // 시설 정보 설정
                mainState.facilityId = options.facilityId || Core.utils.extractFacilityId();
                mainState.facilityName = options.facilityName || '';
                
                if (!mainState.facilityId) {
                    throw new Error('시설 ID를 찾을 수 없습니다.');
                }
                
                // 모든 모듈 초기화
                const initSuccess = await moduleInitializer.initializeAllModules(
                    mainState.facilityId, 
                    mainState.facilityName, 
                    options
                );
                
                if (!initSuccess) {
                    throw new Error('모듈 초기화 실패');
                }
                
                // 이벤트 설정
                eventManager.setupGlobalEvents();
                
                // 초기 단계 설정
                await workflowManager.initializeStep(MAIN_CONSTANTS.WORKFLOW_STEPS.UPLOAD);
                
                mainState.isInitialized = true;
                mainState.currentState = MAIN_CONSTANTS.STATES.READY;
                
                Core.logger.success('메인 컨트롤러 초기화 완료');
                
                // 초기화 완료 알림
                UI.showNotification('시설 이미지 시스템이 준비되었습니다.', UI.CONSTANTS.NOTIFICATION_TYPES.SUCCESS);
                
                return true;
                
            } catch (error) {
                mainState.currentState = MAIN_CONSTANTS.STATES.ERROR;
                Core.logger.error('메인 컨트롤러 초기화 실패:', error);
                UI.showNotification('시스템 초기화에 실패했습니다.', UI.CONSTANTS.NOTIFICATION_TYPES.ERROR);
                return false;
            }
        },
        
        async moveToStep(step) {
            return workflowManager.moveToStep(step);
        },
        
        async uploadImages() {
            if (mainState.processedImages.length === 0) {
                UI.showNotification('업로드할 이미지가 없습니다.', UI.CONSTANTS.NOTIFICATION_TYPES.WARNING);
                return;
            }
            
            try {
                mainState.currentState = MAIN_CONSTANTS.STATES.UPLOADING;
                UI.showProgress('upload', '이미지 업로드 중...');
                
                const result = await Data.uploadImages(mainState.processedImages);
                
                UI.hideProgress('upload');
                return result;
                
            } catch (error) {
                UI.hideProgress('upload');
                mainState.currentState = MAIN_CONSTANTS.STATES.ERROR;
                throw error;
            }
        },
        
        getCurrentState() {
            return {
                ...mainState,
                moduleInfo: {
                    core: Core.getInfo(),
                    cropper: Cropper.getInfo(),
                    upload: Upload.getInfo(),
                    ui: UI.getInfo(),
                    data: Data.getInfo(),
                    seo: SEO.getInfo(),
                    utils: Utils.getInfo()
                }
            };
        },
        
        async destroy() {
            Core.logger.log('메인 컨트롤러 종료');
            
            // 각 모듈 정리
            if (mainState.moduleStates.cropper) Cropper.destroy();
            if (mainState.moduleStates.upload) Upload.destroy();
            if (mainState.moduleStates.ui) UI.destroy();
            if (mainState.moduleStates.data) Data.destroy();
            if (mainState.moduleStates.seo) SEO.destroy();
            
            // 상태 초기화
            mainState.isInitialized = false;
            mainState.currentState = MAIN_CONSTANTS.STATES.INITIALIZING;
            
            Core.logger.success('메인 컨트롤러 종료 완료');
        },
        
        // 공용 파일 처리 함수 (다양한 입력 소스에서 사용)
        processFiles(files) {
            if (!files || files.length === 0) return;
            
            try {
                Core.logger.log('공용 파일 처리 시작:', { count: files.length });
                
                // 파일 배열로 변환
                const fileArray = Array.from(files);
                
                // 업로드 모듈의 파일 처리 함수 호출
                if (Upload && typeof Upload.handleFileSelect === 'function') {
                    Upload.handleFileSelect(fileArray);
                } else {
                    Core.logger.warn('업로드 모듈을 사용할 수 없습니다.');
                }
                
            } catch (error) {
                Core.logger.error('파일 처리 실패:', error);
                UI.showNotification('파일 처리 중 오류가 발생했습니다.', UI.CONSTANTS.NOTIFICATION_TYPES.ERROR);
            }
        },
        
        getInfo() {
            return {
                name: MAIN_CONSTANTS.MODULE_NAME,
                version: MAIN_CONSTANTS.VERSION,
                isInitialized: mainState.isInitialized,
                currentState: mainState.currentState,
                currentStep: mainState.currentStep,
                facilityId: mainState.facilityId,
                moduleStates: mainState.moduleStates
            };
        }
    };
    
    // ================================================
    // 전역 함수 정의 (HTML에서 호출됨)
    // ================================================
    
    // 메인 이미지 선택/해제 함수
    window.selectMainImage = function(index) {
        try {
            // 현재 메인 이미지와 같은 인덱스면 해제, 다른 인덱스면 설정
            if (mainState.mainImageIndex === index) {
                mainState.mainImageIndex = -1; // 메인 이미지 해제
                Core.logger.log(`메인 이미지 해제: ${index}`);
            } else {
                mainState.mainImageIndex = index; // 새 메인 이미지 설정
                Core.logger.log(`메인 이미지 설정: ${index}`);
            }
            
            // UI 업데이트
            moduleInitializer.updateMainImageInfo();
            
            // 이미지 목록 재생성 (메인 이미지 표시 업데이트)
            if (mainState.selectedFiles.length > 0) {
                moduleInitializer.showImageOrderInterface(mainState.selectedFiles);
            }
            
        } catch (error) {
            Core.logger.error('메인 이미지 선택 실패:', error);
        }
    };
    
    // 이미지 제거 함수
    window.removeImageFromOrder = function(index) {
        try {
            if (index >= 0 && index < mainState.selectedFiles.length) {
                const removedFile = mainState.selectedFiles[index];
                mainState.selectedFiles.splice(index, 1);
                
                // 메인 이미지 인덱스 조정
                if (mainState.mainImageIndex === index) {
                    mainState.mainImageIndex = -1; // 메인 이미지가 제거된 경우 해제
                } else if (mainState.mainImageIndex > index) {
                    mainState.mainImageIndex--; // 메인 이미지가 뒤에 있는 경우 인덱스 조정
                }
                
                Core.logger.log(`이미지 제거: ${removedFile.name}`);
                
                // UI 업데이트
                if (mainState.selectedFiles.length > 0) {
                    moduleInitializer.showImageOrderInterface(mainState.selectedFiles);
                } else {
                    // 모든 이미지가 제거된 경우 컨테이너 숨김
                    const previewContainer = document.querySelector('.selected-images-preview');
                    if (previewContainer) {
                        previewContainer.style.display = 'none';
                    }
                }
            }
        } catch (error) {
            Core.logger.error('이미지 제거 실패:', error);
        }
    };
    
    // 이미지 순서 변경 함수들
    window.moveImageUp = function(index) {
        try {
            if (index > 0 && index < mainState.selectedFiles.length) {
                // 파일 순서 변경
                [mainState.selectedFiles[index], mainState.selectedFiles[index - 1]] = 
                [mainState.selectedFiles[index - 1], mainState.selectedFiles[index]];
                
                // 메인 이미지 인덱스 조정
                if (mainState.mainImageIndex === index) {
                    mainState.mainImageIndex = index - 1;
                } else if (mainState.mainImageIndex === index - 1) {
                    mainState.mainImageIndex = index;
                }
                
                // UI 업데이트
                moduleInitializer.showImageOrderInterface(mainState.selectedFiles);
                Core.logger.log(`이미지 위로 이동: ${index} → ${index - 1}`);
            }
        } catch (error) {
            Core.logger.error('이미지 위로 이동 실패:', error);
        }
    };
    
    window.moveImageDown = function(index) {
        try {
            if (index >= 0 && index < mainState.selectedFiles.length - 1) {
                // 파일 순서 변경
                [mainState.selectedFiles[index], mainState.selectedFiles[index + 1]] = 
                [mainState.selectedFiles[index + 1], mainState.selectedFiles[index]];
                
                // 메인 이미지 인덱스 조정
                if (mainState.mainImageIndex === index) {
                    mainState.mainImageIndex = index + 1;
                } else if (mainState.mainImageIndex === index + 1) {
                    mainState.mainImageIndex = index;
                }
                
                // UI 업데이트
                moduleInitializer.showImageOrderInterface(mainState.selectedFiles);
                Core.logger.log(`이미지 아래로 이동: ${index} → ${index + 1}`);
            }
        } catch (error) {
            Core.logger.error('이미지 아래로 이동 실패:', error);
        }
    };
    
    // ================================================
    // 모듈 노출
    // ================================================
    
    window.FacilityImageSystem.Main = {
        CONSTANTS: MAIN_CONSTANTS,
        controller,
        workflowManager,
        eventManager,
        moduleInitializer,
        getState: () => ({ ...mainState }),
        initialize: controller.initialize.bind(controller),
        moveToStep: controller.moveToStep.bind(controller),
        uploadImages: controller.uploadImages.bind(controller),
        processFiles: controller.processFiles.bind(controller),
        getCurrentState: controller.getCurrentState.bind(controller),
        destroy: controller.destroy.bind(controller)
    };
    
    // 전역 접근을 위한 단축 참조
    window.FacilityImageMainController = window.FacilityImageSystem.Main;
    
    // workflowManager를 전역에서 접근 가능하도록 노출
    window.FacilityImageSystem.Main.workflowManager = workflowManager;
    
    // 자동 초기화 (DOM 준비 시)
    document.addEventListener('DOMContentLoaded', async function() {
        // 시설 이미지 관련 페이지에서만 자동 초기화
        if (document.querySelector('#uploadSection, .upload-area, #cropSection') ||
            window.location.pathname.includes('/facility/') && 
            window.location.pathname.includes('/crop-images')) {
            
            Core.logger.log('시설 이미지 페이지 감지 - 자동 초기화 시작');
            
            try {
                const success = await controller.initialize();
                if (success) {
                    Core.logger.success('시설 이미지 시스템 자동 초기화 완료');
                } else {
                    Core.logger.error('시설 이미지 시스템 자동 초기화 실패');
                }
            } catch (error) {
                Core.logger.error('자동 초기화 중 오류:', error);
            }
        }
    });
    
    Core.logger.log('메인 컨트롤러 로드 완료');
    
})();

// ================================================
// 전역 함수들 (HTML에서 호출)
// ================================================

// 이미지 순서 조작 함수들 (전역 함수로 HTML에서 호출)
function removeImageFromOrder(index) {
    try {
        console.log('이미지 제거 시도:', index);
        
        if (!window.FacilityImageSystem?.Main) {
            console.error('FacilityImageSystem.Main을 찾을 수 없음');
            return;
        }
        
        const mainController = window.FacilityImageSystem.Main;
        const currentState = mainController.getState();
        
        console.log('현재 상태:', {
            selectedFilesLength: currentState.selectedFiles?.length,
            index: index,
            moduleInitializer: !!mainController.moduleInitializer
        });
        
        if (index >= 0 && index < (currentState.selectedFiles?.length || 0)) {
            currentState.selectedFiles.splice(index, 1);
            console.log('이미지 제거 완료. 남은 파일:', currentState.selectedFiles.length);
            
            // moduleInitializer의 showImageOrderInterface 호출
            if (mainController.moduleInitializer?.showImageOrderInterface) {
                mainController.moduleInitializer.showImageOrderInterface(currentState.selectedFiles);
            } else {
                console.error('showImageOrderInterface 함수를 찾을 수 없음');
            }
            
            // 파일이 없으면 미리보기 숨기기
            if (currentState.selectedFiles.length === 0) {
                const previewContainer = document.getElementById('selectedImagesPreview');
                if (previewContainer) {
                    previewContainer.style.display = 'none';
                }
            }
        } else {
            console.error('잘못된 인덱스:', index);
        }
    } catch (error) {
        console.error('이미지 제거 실패:', error);
    }
}

function moveImageUp(index) {
    try {
        if (!window.FacilityImageSystem?.Main) return;
        
        const mainController = window.FacilityImageSystem.Main;
        const currentState = mainController.getState();
        
        if (index > 0 && index < currentState.selectedFiles.length) {
            // 배열 요소 교체
            [currentState.selectedFiles[index], currentState.selectedFiles[index - 1]] = 
            [currentState.selectedFiles[index - 1], currentState.selectedFiles[index]];
            
            // UI 다시 그리기
            if (mainController.moduleInitializer?.showImageOrderInterface) {
                mainController.moduleInitializer.showImageOrderInterface(currentState.selectedFiles);
            }
        }
    } catch (error) {
        console.error('이미지 위로 이동 실패:', error);
    }
}

function moveImageDown(index) {
    try {
        if (!window.FacilityImageSystem?.Main) return;
        
        const mainController = window.FacilityImageSystem.Main;
        const currentState = mainController.getState();
        
        if (index >= 0 && index < currentState.selectedFiles.length - 1) {
            // 배열 요소 교체
            [currentState.selectedFiles[index], currentState.selectedFiles[index + 1]] = 
            [currentState.selectedFiles[index + 1], currentState.selectedFiles[index]];
            
            // UI 다시 그리기
            if (mainController.moduleInitializer?.showImageOrderInterface) {
                mainController.moduleInitializer.showImageOrderInterface(currentState.selectedFiles);
            }
        }
    } catch (error) {
        console.error('이미지 아래로 이동 실패:', error);
    }
}

// 메인 이미지 선택 (1단계용)
function selectMainImage(index) {
    try {
        if (!window.FacilityImageSystem?.Main) return;
        
        const mainController = window.FacilityImageSystem.Main;
        const currentState = mainController.getState();
        
        if (index >= 0 && index < currentState.selectedFiles.length) {
            currentState.mainImageIndex = index;
            
            // UI 다시 그리기
            if (mainController.moduleInitializer?.showImageOrderInterface) {
                mainController.moduleInitializer.showImageOrderInterface(currentState.selectedFiles);
            }
        }
    } catch (error) {
        console.error('메인 이미지 설정 실패:', error);
    }
}

// 키워드 클릭 핸들러
function handleKeywordClick(keyword) {
    try {
        // 키워드 버튼 토글 (간단하게)
        const buttons = document.querySelectorAll(`[data-keyword="${keyword}"]`);
        buttons.forEach(button => {
            if (button.classList.contains('btn-outline-primary')) {
                button.classList.remove('btn-outline-primary');
                button.classList.add('btn-primary');
            } else {
                button.classList.remove('btn-primary');
                button.classList.add('btn-outline-primary');
            }
        });
        
        // 선택된 키워드 업데이트
        if (window.FacilityImageSystem?.Main?.moduleInitializer) {
            window.FacilityImageSystem.Main.moduleInitializer.updateSelectedKeywords();
        }
    } catch (error) {
        console.error('키워드 선택 오류:', error);
    }
}

// 2단계 컴트롤 전역 함수들
function proceedToNextImage() {
    try {
        if (window.FacilityImageSystem?.Main?.workflowManager) {
            window.FacilityImageSystem.Main.workflowManager.proceedToNextImage();
        }
    } catch (error) {
        console.error('다음 이미지 이동 실패:', error);
    }
}

function proceedToPrevImage() {
    try {
        if (window.FacilityImageSystem?.Main?.workflowManager) {
            window.FacilityImageSystem.Main.workflowManager.proceedToPrevImage();
        }
    } catch (error) {
        console.error('이전 이미지 이동 실패:', error);
    }
}

function applyCompression() {
    try {
        if (window.FacilityImageSystem?.Main?.workflowManager) {
            window.FacilityImageSystem.Main.workflowManager.applyCompressionToCrop();
        }
    } catch (error) {
        console.error('압축 적용 실패:', error);
    }
}

function saveCropAndNext() {
    try {
        if (window.FacilityImageSystem?.Main?.workflowManager) {
            window.FacilityImageSystem.Main.workflowManager.saveCurrentImageSettings();
        }
    } catch (error) {
        console.error('크롭 저장 실패:', error);
    }
}

function resetCrop() {
    try {
        if (window.FacilityImageCropper?.cropperControls) {
            window.FacilityImageCropper.cropperControls.reset();
        }
    } catch (error) {
        console.error('크롭 초기화 실패:', error);
    }
}

function zoomIn() {
    try {
        if (window.FacilityImageCropper?.cropperControls) {
            window.FacilityImageCropper.cropperControls.zoomIn();
        }
    } catch (error) {
        console.error('확대 실패:', error);
    }
}

function zoomOut() {
    try {
        if (window.FacilityImageCropper?.cropperControls) {
            window.FacilityImageCropper.cropperControls.zoomOut();
        }
    } catch (error) {
        console.error('축소 실패:', error);
    }
}
````

## File: src/main/resources/static/js/kakaomap.js
````javascript
// kakaomap.js

// 맵 객체, 마커 배열, 인포윈도우를 전역적으로 접근 가능하도록 선언합니다.
// 'var'는 전역 스코프에 할당하고, 'let'은 모듈/스크립트 스코프에 할당됩니다.
// 여기서는 다른 인라인 스크립트에서도 `map`을 직접 참조할 수 있도록 var를 사용하거나
// 아니면 인라인 스크립트에서도 map을 `window.map`으로 참조하도록 합니다.
// 가장 간단하게, 'map' 변수가 다른 곳에서도 'map'이라는 이름으로 참조될 수 있도록 합니다.
let map = null;
let markers = []; // 지도에 표시된 마커들을 관리할 배열
let infoWindow = null; // 인포윈도우 객체

// 시설 이미지 미리보기 함수
function previewFacilityImage(input) {
    const preview = document.getElementById('facilityImagePreview');
    const previewImg = document.getElementById('facilityImagePreviewImg');
    
    if (input.files && input.files[0]) {
        const file = input.files[0];
        
        // 파일 크기 체크 (5MB = 5 * 1024 * 1024 bytes)
        if (file.size > 5 * 1024 * 1024) {
            alert('파일 크기가 5MB를 초과합니다. 더 작은 파일을 선택해주세요.');
            input.value = '';
            preview.style.display = 'none';
            return;
        }
        
        // 파일 형식 체크
        if (!file.type.match('image.*')) {
            alert('이미지 파일만 업로드 가능합니다.');
            input.value = '';
            preview.style.display = 'none';
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            previewImg.src = e.target.result;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    } else {
        preview.style.display = 'none';
    }
}

// 지도를 초기화하는 함수
function initKakaoMap(mapId) {
    const mapContainer = document.getElementById(mapId);
    if (!mapContainer) {
        console.error("Error: Map container not found with ID:", mapId);
        return;
    }

    const mapOption = {
        center: new kakao.maps.LatLng(37.566826, 126.9786567), // 기본 중심 (서울 시청)
        level: 3 // 기본 확대 레벨
    };

    // 지도를 생성합니다.
    map = new kakao.maps.Map(mapContainer, mapOption);

    // 인포윈도우 생성 (마커 클릭 시 정보 표시용)
    infoWindow = new kakao.maps.InfoWindow({zIndex:1});

    // 지도 확대/축소 컨트롤을 생성한다
    const zoomControl = new kakao.maps.ZoomControl();
    map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

    // 지도가 이동이 멈췄을 때 (idle 이벤트 발생) 시설을 다시 검색
    // 이 부분을 주석 해제하면 지도 이동 시 자동으로 검색하여 마커를 업데이트합니다.
    /*
    kakao.maps.event.addListener(map, 'idle', function() {
        console.log("Map idle event detected. Searching facilities in bounds...");
        searchFacilitiesInBounds(); // 지도 이동이 멈췄을 때 자동 검색
    });
    */

    console.log("Kakao Map initialized successfully on element:", mapId);
}

// 마커를 추가하고 인포윈도우를 설정하는 함수
function addMarker(lat, lng, title, content) {
    if (!map) {
        console.error("Error: Map object is not initialized. Cannot add marker for:", title);
        return null;
    }

    const position = new kakao.maps.LatLng(lat, lng);
    const marker = new kakao.maps.Marker({
        map: map,
        position: position,
        title: title // 마커의 타이틀, 마우스 오버 시 표시됩니다
    });

    markers.push(marker); // 마커 배열에 추가

    // 마커에 클릭 이벤트를 등록합니다
    kakao.maps.event.addListener(marker, 'click', function() {
        // 마커를 클릭하면 장소명이 인포윈도우에 표출됩니다
        infoWindow.setContent('<div style="padding:5px;font-size:12px;">' + content + '</div>');
        infoWindow.open(map, marker);
        // 클릭된 마커로 지도 중심 이동 (선택 사항)
        map.panTo(position);
    });

    return marker;
}

// 지도에 표시된 모든 마커를 제거하는 함수
function clearMarkers() {
    for (let i = 0; i < markers.length; i++) {
        markers[i].setMap(null); // 지도에서 마커 제거
    }
    markers = []; // 마커 배열 초기화
    if (infoWindow) {
        infoWindow.close(); // 열려있는 인포윈도우 닫기
    }
    console.log("All markers cleared.");
}

// 현재 지도 영역 내 시설을 검색하는 함수 (AJAX 호출)
// 이 함수는 'map.addListener('idle', ...)' 이벤트 리스너에 연결하여 사용될 수 있습니다.
// 폼 검색과는 별개로 지도 이동에 따라 시설을 업데이트하는 기능입니다.
function searchFacilitiesInBounds() {
    if (!map) {
        console.error("Error: Map object is not initialized. Cannot search facilities in bounds.");
        return;
    }

    const bounds = map.getBounds(); // 현재 지도의 영역을 얻어옵니다
    const swLat = bounds.getSouthWest().getLat();
    const swLng = bounds.getSouthWest().getLng();
    const neLat = bounds.getNorthEast().getLat();
    const neLng = bounds.getNorthEast().getLng();

    // 현재 폼 필터 값들도 함께 전송하여 지도 영역과 필터가 결합된 검색을 수행할 수 있습니다.
    const facilityName = document.getElementById('facilityName')?.value || '';
    const region = document.getElementById('region')?.value || '';
    const facilityType = document.getElementById('facilityType')?.value || '';
    const gradeRating = document.getElementById('gradeRating')?.value || '';

    // 서버의 /facility/api/list API를 호출하여 해당 영역 내 시설 데이터를 가져옵니다.
    const url = `/facility/api/list?swLat=${swLat}&swLng=${swLng}&neLat=${neLat}&neLng=${neLng}` +
        `&facilityName=${encodeURIComponent(facilityName)}` +
        `&region=${encodeURIComponent(region)}` +
        `&facilityType=${encodeURIComponent(facilityType)}` +
        `&gradeRating=${encodeURIComponent(gradeRating)}`;

    console.log("Fetching facilities for map bounds and filters:", url);

    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            clearMarkers(); // 기존 마커 지우기
            if (data && data.length > 0) {
                data.forEach(facility => {
                    addMarker(
                        parseFloat(facility.latitude),
                        parseFloat(facility.longitude),
                        facility.name,
                        `주소: ${facility.address}<br>전화: ${facility.phone}<br>평점: ${facility.averageRating}/5.0`
                    );
                });
                console.log(`Updated map with ${data.length} facilities from AJAX.`);
            } else {
                console.log("No facilities found in current map bounds with applied filters.");
            }
        })
        .catch(error => {
            console.error("Error fetching facilities for map API:", error);
        });
}

// searchWithFilters 함수는 더 이상 HTML 폼 제출에서 직접 호출되지 않으므로,
// 만약 이 함수가 다른 목적으로 (예: 특정 필터 버튼 클릭 시 지도 업데이트) 사용된다면
// 그에 맞는 로직으로 변경해야 합니다. 현재는 필요 없으므로 제거하거나 주석 처리합니다.
/*
function searchWithFilters(filters) {
    console.warn("searchWithFilters is called. This function is likely deprecated for main form submission.");
    // 만약 AJAX 방식으로 필터링된 검색 결과를 가져와 지도나 목록을 업데이트하려면 이곳에 로직 구현
    // 예: const queryString = new URLSearchParams(filters).toString();
    // fetch(`/facility/api/list?${queryString}`)
    // ...
}
*/

// ===============================
// 주소 검색 관련 함수들
// ===============================

/**
 * 카카오 우편번호 서비스를 이용한 주소 검색 팝업을 띄우는 함수
 * @param {string} addressInputId - 주소를 입력받을 input 요소의 ID
 * @param {string} detailAddressInputId - 상세주소를 입력받을 input 요소의 ID (선택사항)
 * @param {function} callback - 주소 선택 완료 후 실행될 콜백 함수 (선택사항)
 */
function openAddressSearch(addressInputId, detailAddressInputId = null, callback = null) {
    new daum.Postcode({
        oncomplete: function(data) {
            // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.
            
            // 각 주소의 노출 규칙에 따라 주소를 조합한다.
            let addr = ''; // 주소 변수
            let extraAddr = ''; // 참고항목 변수

            // 사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
            if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                addr = data.roadAddress;
            } else { // 사용자가 지번 주소를 선택했을 경우(J)
                addr = data.jibunAddress;
            }

            // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
            if(data.userSelectedType === 'R'){
                // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                    extraAddr += data.bname;
                }
                // 건물명이 있고, 공동주택일 경우 추가한다.
                if(data.buildingName !== '' && data.apartment === 'Y'){
                    extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                }
                // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                if(extraAddr !== ''){
                    extraAddr = ' (' + extraAddr + ')';
                }
            }

            // 우편번호와 주소 정보를 해당 필드에 넣는다.
            const addressInput = document.getElementById(addressInputId);
            if (addressInput) {
                addressInput.value = addr + extraAddr;
            }

            // 상세주소 입력란이 있으면 포커스를 이동한다.
            if (detailAddressInputId) {
                const detailAddressInput = document.getElementById(detailAddressInputId);
                if (detailAddressInput) {
                    detailAddressInput.focus();
                }
            }

            // 주소로부터 위도/경도를 가져와서 콜백 함수 실행
            if (callback && typeof callback === 'function') {
                getCoordinatesFromAddress(addr, callback);
            }

            console.log('주소 검색 완료:', {
                zonecode: data.zonecode,
                address: addr + extraAddr,
                roadAddress: data.roadAddress,
                jibunAddress: data.jibunAddress
            });
        }
    }).open();
}

/**
 * 주소를 이용해서 위도/경도를 가져오는 함수
 * @param {string} address - 검색할 주소
 * @param {function} callback - 좌표를 받을 콜백 함수 (latitude, longitude를 매개변수로 받음)
 */
function getCoordinatesFromAddress(address, callback) {
    // 주소-좌표 변환 객체를 생성합니다
    const geocoder = new kakao.maps.services.Geocoder();

    // 주소로 좌표를 검색합니다
    geocoder.addressSearch(address, function(result, status) {
        // 정상적으로 검색이 완료됐으면
        if (status === kakao.maps.services.Status.OK) {
            const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
            
            console.log('주소로부터 좌표 변환 성공:', {
                address: address,
                latitude: result[0].y,
                longitude: result[0].x
            });

            // 콜백 함수에 위도/경도 전달
            if (callback && typeof callback === 'function') {
                callback(parseFloat(result[0].y), parseFloat(result[0].x));
            }
        } else {
            console.error('주소로부터 좌표 변환 실패:', status);
            alert('주소로부터 좌표를 가져올 수 없습니다.');
        }
    });
}

/**
 * 회원가입 페이지에서 시설 주소 검색에 사용되는 함수
 * 주소 선택 시 자동으로 위도/경도를 히든 필드에 설정
 */
function searchFacilityAddress() {
    console.log('searchFacilityAddress 함수 호출됨');
    
    // 기존 주소가 있는지 확인
    const currentAddress = document.getElementById('facilityAddress').value;
    if (currentAddress && currentAddress.trim() !== '') {
        const confirmChange = confirm('기존 주소가 있습니다. 새로운 주소로 변경하시겠습니까?\n\n현재 주소: ' + currentAddress);
        if (!confirmChange) {
            console.log('주소 변경 취소됨');
            return;
        }
    }
    
    // Daum 우편번호 서비스 직접 사용
    new daum.Postcode({
        oncomplete: function(data) {
            console.log('주소 선택 완료:', data);
            
            // 주소 조합
            let addr = '';
            let extraAddr = '';
            
            if (data.userSelectedType === 'R') {
                addr = data.roadAddress;
            } else {
                addr = data.jibunAddress;
            }
            
            if(data.userSelectedType === 'R'){
                if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                    extraAddr += data.bname;
                }
                if(data.buildingName !== '' && data.apartment === 'Y'){
                    extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                }
                if(extraAddr !== ''){
                    extraAddr = ' (' + extraAddr + ')';
                }
            }
            
            const finalAddress = addr + extraAddr;
            
            // 주소 필드에 설정
            const addressInput = document.getElementById('facilityAddress');
            if (addressInput) {
                // readonly 속성 임시 제거
                addressInput.removeAttribute('readonly');
                addressInput.value = finalAddress;
                // readonly 속성 다시 적용
                addressInput.setAttribute('readonly', 'readonly');
                console.log('주소 설정 완료:', finalAddress);
                
                // 시각적 피드백 - 배경색 잠시 변경
                addressInput.style.backgroundColor = '#d4edda';
                setTimeout(function() {
                    addressInput.style.backgroundColor = '';
                }, 1000);
            } else {
                console.error('facilityAddress 필드를 찾을 수 없음');
            }
            
            // 상세주소 입력란에 포커스
            const detailAddressInput = document.getElementById('detailAddress');
            if (detailAddressInput) {
                detailAddressInput.focus();
            }
            
            // 주소로부터 위도/경도 가져오기
            getCoordinatesFromAddress(addr, function(latitude, longitude) {
                // 위도/경도를 히든 필드에 설정
                const latitudeInput = document.getElementById('latitude');
                const longitudeInput = document.getElementById('longitude');
                
                if (latitudeInput) {
                    latitudeInput.value = latitude;
                    console.log('위도 설정:', latitude);
                } else {
                    console.error('latitude 필드를 찾을 수 없음');
                }
                
                if (longitudeInput) {
                    longitudeInput.value = longitude;
                    console.log('경도 설정:', longitude);
                } else {
                    console.error('longitude 필드를 찾을 수 없음');
                }
                
                // 위도/경도 설정 완료 알림
                const notification = document.createElement('div');
                notification.innerHTML = `
                    <div class="alert alert-success alert-dismissible fade show position-fixed" 
                         style="top: 20px; right: 20px; z-index: 9999; max-width: 300px;">
                        <i class="fas fa-check-circle me-2"></i>
                        주소와 위치 좌표가 설정되었습니다!
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                `;
                document.body.appendChild(notification);
                
                // 3초 후 자동 제거
                setTimeout(function() {
                    if (notification && notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 3000);
                
                console.log('시설 위치 좌표 설정 완료:', { latitude, longitude });
                
                // 미리보기 지도 컨테이너 표시
                const mapPreviewContainer = document.getElementById('mapPreviewContainer');
                if (mapPreviewContainer) {
                    mapPreviewContainer.style.display = 'block';
                }
                
                // 미리보기 지도가 있다면 해당 위치로 이동
                updatePreviewMap(latitude, longitude);
            });
        },
        onclose: function(state) {
            console.log('주소 검색 창 닫힘. 상태:', state);
        }
    }).open();
}

/**
 * 주소 검색 결과를 미리보기 지도에 표시하는 함수
 * @param {number} latitude - 위도
 * @param {number} longitude - 경도
 */
function updatePreviewMap(latitude, longitude) {
    const previewMapContainer = document.getElementById('previewMap');
    if (!previewMapContainer) return;

    // 미리보기 지도 생성 또는 업데이트
    const coords = new kakao.maps.LatLng(latitude, longitude);
    
    if (!window.previewMap) {
        // 지도가 없으면 새로 생성
        const mapOption = {
            center: coords,
            level: 3
        };
        window.previewMap = new kakao.maps.Map(previewMapContainer, mapOption);
    } else {
        // 기존 지도가 있으면 중심 이동
        window.previewMap.setCenter(coords);
    }

    // 기존 마커 제거
    if (window.previewMarker) {
        window.previewMarker.setMap(null);
    }

    // 새 마커 추가
    window.previewMarker = new kakao.maps.Marker({
        position: coords,
        map: window.previewMap
    });

    console.log('미리보기 지도 업데이트 완료');
}
````

## File: src/main/resources/templates/facility/manage.html
````html
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/header :: header}">
    <title>시설 관리 - 라이트케어</title>
</head>

<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="container my-4">
    <!-- 브레드크럼 -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">홈</a></li>
            <li class="breadcrumb-item"><a href="/facility/search">시설 찾기</a></li>
            <li class="breadcrumb-item active" aria-current="page">내 시설 관리</li>
        </ol>
    </nav>
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-building me-2"></i>내 시설 관리
                    </h3>
                </div>
                <div class="card-body">
                    <!-- 시설 정보가 없는 경우 -->
                    <div th:if="${#lists.isEmpty(facilities)}" class="text-center py-5">
                        <i class="fas fa-building fa-3x text-muted mb-3"></i>
                        <h4 class="text-muted">등록된 시설 정보가 없습니다</h4>
                        <p class="text-muted">시설 정보를 등록하여 구인구직과 리뷰 서비스를 이용해보세요.</p>
                        <a th:href="@{/facility/register}" class="btn btn-primary btn-lg">
                            <i class="fas fa-plus me-2"></i>시설 등록하기
                        </a>
                    </div>

                    <!-- 시설 정보가 있는 경우 -->
                    <div th:if="${not #lists.isEmpty(facilities)}">
                        <div class="row">
                            <!-- 왼쪽: 시설 목록 (40%) -->
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">
                                            <i class="fas fa-list me-2"></i>내 시설 목록 
                                            <span class="badge bg-primary ms-2" th:text="${facilityCount}">0</span>
                                        </h5>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="list-group list-group-flush">
                                            <a th:each="facility : ${facilities}" 
                                               href="#" 
                                               class="list-group-item list-group-item-action facility-item"
                                               th:data-facility-id="${facility.facilityId}"
                                               th:data-facility-info="${facility}">
                                                <div class="d-flex w-100 justify-content-between">
                                                    <h6 class="mb-1" th:text="${facility.facilityName}">시설명</h6>
                                                    <small>
                                                        <span th:if="${facility.approvalStatus == 'APPROVED'}" class="badge bg-success">승인완료</span>
                                                        <span th:if="${facility.approvalStatus == 'PENDING'}" class="badge bg-warning">승인대기</span>
                                                        <span th:if="${facility.approvalStatus == 'REJECTED'}" class="badge bg-danger">승인거절</span>
                                                    </small>
                                                </div>
                                                <p class="mb-1 text-muted small" th:text="${facility.address}">주소</p>
                                                <small class="text-muted">
                                                    <i class="fas fa-star me-1"></i>
                                                    <span th:text="${facility.averageRating ?: '0.0'}">0.0</span>
                                                    <span class="mx-2">|</span>
                                                    <i class="fas fa-comment me-1"></i>
                                                    <span th:text="${facility.reviewCount ?: '0'}">0</span>
                                                </small>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 오른쪽: 선택된 시설 상세 관리 (60%) -->
                            <div class="col-md-8">
                                <!-- 시설 선택 안내 (초기 상태) -->
                                <div id="no-selection" class="text-center py-5">
                                    <i class="fas fa-arrow-left fa-3x text-muted mb-3"></i>
                                    <h5 class="text-muted">관리할 시설을 선택해주세요</h5>
                                    <p class="text-muted">왼쪽 목록에서 시설을 클릭하면 상세 관리 화면이 표시됩니다.</p>
                                </div>

                                <!-- 선택된 시설 상세 정보 (숨김 상태) -->
                                <div id="facility-detail" style="display: none;">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0" id="selected-facility-name">시설명</h5>
                                        </div>
                                        <div class="card-body">
                                            <!-- 승인 상태 -->
                                            <div id="approval-status" class="alert mb-4">
                                                <i class="fas fa-info-circle me-2"></i>
                                                <strong>승인 상태: </strong>
                                                <span id="approval-text"></span>
                                            </div>

                                            <!-- 통계 정보 -->
                                            <div class="row mb-4">
                                                <div class="col-md-3 col-sm-6 mb-3">
                                                    <div class="card bg-primary text-white text-center">
                                                        <div class="card-body">
                                                            <i class="fas fa-star fa-2x mb-2"></i>
                                                            <h4 id="avg-rating">0.0</h4>
                                                            <small>평균 평점</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-3 col-sm-6 mb-3">
                                                    <div class="card bg-info text-white text-center">
                                                        <div class="card-body">
                                                            <i class="fas fa-comment fa-2x mb-2"></i>
                                                            <h4 id="review-count">0</h4>
                                                            <small>리뷰 수</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-3 col-sm-6 mb-3">
                                                    <div class="card bg-success text-white text-center">
                                                        <div class="card-body">
                                                            <i class="fas fa-briefcase fa-2x mb-2"></i>
                                                            <h4 id="job-count">0</h4>
                                                            <small>구인공고 수</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-3 col-sm-6 mb-3">
                                                    <div class="card bg-warning text-white text-center">
                                                        <div class="card-body">
                                                            <i class="fas fa-users fa-2x mb-2"></i>
                                                            <h4 id="capacity">0</h4>
                                                            <small>수용인원</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 시설 기본 정보 -->
                                            <div class="row mb-4">
                                                <div class="col-12">
                                                    <h6><i class="fas fa-info-circle me-2"></i>기본 정보</h6>
                                                    <div class="table-responsive">
                                                        <table class="table table-sm">
                                                            <tr>
                                                                <td width="30%"><strong>시설 유형</strong></td>
                                                                <td id="facility-type">-</td>
                                                            </tr>
                                                            <tr>
                                                                <td><strong>주소</strong></td>
                                                                <td id="facility-address">-</td>
                                                            </tr>
                                                            <tr>
                                                                <td><strong>전화번호</strong></td>
                                                                <td id="facility-phone">-</td>
                                                            </tr>
                                                            <tr>
                                                                <td><strong>운영시간</strong></td>
                                                                <td id="operating-hours">-</td>
                                                            </tr>
                                                            <tr>
                                                                <td><strong>홈페이지</strong></td>
                                                                <td id="homepage">-</td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 관리 버튼들 -->
                                            <div class="row">
                                                <div class="col-12">
                                                    <div class="d-flex gap-2 flex-wrap">
                                                        <a id="edit-btn" href="#" class="btn btn-primary">
                                                            <i class="fas fa-edit me-2"></i>시설 정보 수정
                                                        </a>
                                                        <a href="/job/write" class="btn btn-success">
                                                            <i class="fas fa-plus me-2"></i>구인공고 작성
                                                        </a>
                                                        <a id="detail-btn" href="#" class="btn btn-info">
                                                            <i class="fas fa-eye me-2"></i>시설 페이지 보기
                                                        </a>
                                                        <button type="button" id="delete-btn" class="btn btn-danger">
                                                            <i class="fas fa-trash me-2"></i>시설 삭제
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<script>
let currentFacilityId = null;

$(document).ready(function() {
    // 시설 선택 이벤트
    $('.facility-item').on('click', function(e) {
        e.preventDefault();
        
        // 기존 선택 제거
        $('.facility-item').removeClass('active');
        
        // 현재 선택 표시
        $(this).addClass('active');
        
        // 시설 정보 가져오기
        const facilityId = $(this).data('facility-id');
        currentFacilityId = facilityId;
        
        // 시설 정보를 data 속성에서 가져오거나 AJAX로 조회
        loadFacilityDetail(facilityId);
    });
    
    // 삭제 버튼 이벤트
    $('#delete-btn').on('click', function() {
        if (currentFacilityId) {
            deleteFacility(currentFacilityId);
        }
    });
});

function loadFacilityDetail(facilityId) {
    // AJAX로 시설 상세 정보 조회 (통합된 API 사용)
    $.get(`/facility/facility-info/${facilityId}`, function(data) {
        if (data.success) {
            updateFacilityDetail(data.facility);
        } else {
            alert(data.message || '시설 정보를 불러올 수 없습니다.');
        }
    }).fail(function() {
        alert('시설 정보를 불러오는데 실패했습니다.');
    });
}

function updateFacilityDetail(facility) {
    // 화면 전환
    $('#no-selection').hide();
    $('#facility-detail').show();
    
    // 기본 정보 업데이트
    $('#selected-facility-name').text(facility.facilityName);
    $('#facility-type').text(getFacilityTypeText(facility.facilityType));
    $('#facility-address').text(facility.address + (facility.detailAddress ? ' ' + facility.detailAddress : ''));
    $('#facility-phone').text(facility.phone || '-');
    $('#operating-hours').text(facility.operatingHours || '-');
    $('#homepage').html(facility.homepage ? 
        `<a href="${facility.homepage}" target="_blank">${facility.homepage}</a>` : '-');
    
    // 통계 정보 업데이트
    $('#avg-rating').text(facility.averageRating || '0.0');
    $('#review-count').text(facility.reviewCount || '0');
    $('#job-count').text(facility.jobCount || '0');
    $('#capacity').text(facility.capacity || '0');
    
    // 승인 상태 업데이트
    updateApprovalStatus(facility.approvalStatus);
    
    // 버튼 링크 업데이트
    $('#edit-btn').attr('href', `/facility/edit/${facility.facilityId}`);
    $('#detail-btn').attr('href', `/facility/detail/${facility.facilityId}`);
}

function updateApprovalStatus(status) {
    const alertDiv = $('#approval-status');
    const textSpan = $('#approval-text');
    
    alertDiv.removeClass('alert-success alert-warning alert-danger');
    
    switch(status) {
        case 'APPROVED':
            alertDiv.addClass('alert-success');
            textSpan.text('승인 완료');
            break;
        case 'PENDING':
            alertDiv.addClass('alert-warning');
            textSpan.text('승인 대기 중 (관리자 승인 후 검색 결과에 표시됩니다)');
            break;
        case 'REJECTED':
            alertDiv.addClass('alert-danger');
            textSpan.text('승인 거절');
            break;
        default:
            alertDiv.addClass('alert-secondary');
            textSpan.text('상태 불명');
    }
}

function getFacilityTypeText(type) {
    switch(type) {
        case 'NURSING_HOME': return '요양원';
        case 'HOSPITAL': return '요양병원';
        case 'DAY_CARE': return '데이케어센터';
        default: return type;
    }
}

function deleteFacility(facilityId) {
    if (confirm('정말로 이 시설을 삭제하시겠습니까?\n삭제된 시설은 복구할 수 없습니다.')) {
        $.post(`/facility/delete/${facilityId}`, function() {
            alert('시설이 삭제되었습니다.');
            location.reload();
        }).fail(function() {
            alert('시설 삭제에 실패했습니다.');
        });
    }
}
</script>

</body>
</html>
````

## File: src/main/resources/templates/member/deleteMember.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>회원탈퇴 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <!-- 브레드크럼 -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item"><a href="/member/myinfo/edit">내 정보</a></li>
                <li class="breadcrumb-item active" aria-current="page">회원탈퇴</li>
            </ol>
        </nav>
        
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-5">
                <!-- 회원탈퇴 확인 카드 -->
                <div class="card shadow border-danger">
                    <div class="card-body p-4">
                        <!-- 제목 -->
                        <div class="text-center mb-4">
                            <h3 class="card-title fw-bold text-danger">
                                <i class="fas fa-user-times me-2"></i>
                                회원탈퇴
                            </h3>
                            <p class="text-muted">정말로 탈퇴하시겠습니까?</p>
                        </div>
                        
                        <!-- 탈퇴 안내 -->
                        <div class="alert alert-danger" role="alert">
                            <h6 class="alert-heading">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                탈퇴 시 주의사항
                            </h6>
                            <ul class="mb-0 small">
                                <li>회원탈퇴 시 모든 개인정보가 삭제됩니다</li>
                                <li>작성하신 게시글과 댓글은 유지됩니다</li>
                                <li>동일한 아이디로 재가입이 불가능합니다</li>
                                <li>탈퇴 처리 후에는 복구할 수 없습니다</li>
                            </ul>
                        </div>
                        
                        <!-- 회원 정보 확인 -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <h6 class="card-title">탈퇴할 회원정보</h6>
                                <div class="row">
                                    <div class="col-4 text-muted">아이디:</div>
                                    <div class="col-8" th:text="${member.userId}">user01</div>
                                </div>
                                <div class="row">
                                    <div class="col-4 text-muted">이름:</div>
                                    <div class="col-8" th:text="${member.name}">홍길동</div>
                                </div>
                                <div class="row">
                                    <div class="col-4 text-muted">이메일:</div>
                                    <div class="col-8" th:text="${member.email ?: '등록된 이메일 없음'}">example@email.com</div>
                                </div>
                                <div class="row">
                                    <div class="col-4 text-muted">가입일:</div>
                                    <div class="col-8" th:text="${#temporals.format(member.createdAt, 'yyyy-MM-dd')}">2024-01-01</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 비밀번호 확인 폼 -->
                        <form id="deleteMemberForm" th:action="@{/member/mypage/delete}" method="post" novalidate>
                            <div class="mb-3">
                                <label for="password" class="form-label">
                                    <i class="fas fa-lock me-1"></i>현재 비밀번호 <span class="text-danger">*</span>
                                </label>
                                <div class="input-group">
                                    <input type="password" 
                                           class="form-control" 
                                           id="password" 
                                           name="password"
                                           placeholder="탈퇴 확인을 위해 현재 비밀번호를 입력하세요"
                                           required>
                                    <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div id="passwordFeedback" class="invalid-feedback"></div>
                            </div>
                            
                            <!-- 작성 콘텐츠 안내 -->
                            <div th:if="${contentCounts.total > 0}" class="alert alert-warning mb-3" role="alert">
                                <h6 class="alert-heading">
                                    <i class="fas fa-edit me-2"></i>
                                    작성하신 콘텐츠가 있습니다
                                </h6>
                                <ul class="mb-2 small">
                                    <li th:if="${contentCounts.board > 0}">게시글: <strong th:text="${contentCounts.board}">..</strong>개</li>
                                    <li th:if="${contentCounts.review > 0}">리뷰: <strong th:text="${contentCounts.review}">..</strong>개</li>
                                    <li th:if="${contentCounts.job > 0}">구인구직: <strong th:text="${contentCounts.job}">..</strong>개</li>
                                </ul>
                                <div class="mb-3">
                                    <label class="form-label fw-bold text-warning">콘텐츠 처리 방식 선택 <span class="text-danger">*</span></label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="deleteOption" id="anonymousOption" value="anonymous" checked required>
                                        <label class="form-check-label" for="anonymousOption">
                                            <strong>익명화</strong> - 개인정보만 삭제, 콘텐츠는 "탈퇴회원"으로 표시
                                        </label>
                                        <div class="form-text text-muted small">추천: 작성한 콘텐츠가 다른 사용자에게 도움이 될 수 있습니다</div>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="deleteOption" id="completeOption" value="complete" required>
                                        <label class="form-check-label" for="completeOption">
                                            <strong class="text-danger">완전삭제</strong> - 모든 개인정보와 콘텐츠 완전 삭제
                                        </label>
                                        <div class="form-text text-danger small">경고: 작성한 모든 게시글, 리뷰 등이 영구 삭제됩니다</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 콘텐츠가 없는 경우 숨겨진 필드 -->
                            <input th:if="${contentCounts.total == 0}" type="hidden" name="deleteOption" value="complete">
                            
                            <!-- 이름 확인 입력 -->
                            <div class="mb-3">
                                <label for="confirmName" class="form-label">
                                    <i class="fas fa-user-check me-1"></i>탈퇴 확인을 위해 본인 이름을 입력하세요 <span class="text-danger">*</span>
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light text-muted">이름:</span>
                                    <input type="text" 
                                           class="form-control" 
                                           id="confirmName" 
                                           name="confirmName"
                                           placeholder="정확한 이름을 입력하세요"
                                           autocomplete="off"
                                           spellcheck="false"
                                           required>
                                </div>
                                <div class="form-text text-muted small">
                                    <i class="fas fa-info-circle me-1"></i>
                                    회원정보에 등록된 이름 '<strong th:text="${member.name}">홍길동</strong>'을 정확히 입력해주세요.
                                </div>
                                <div id="nameValidationFeedback" class="invalid-feedback"></div>
                            </div>
                            
                            <!-- 탈퇴 확인 체크박스 -->
                            <div class="mb-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="confirmDelete" required>
                                    <label class="form-check-label text-danger fw-bold" for="confirmDelete">
                                        위의 주의사항을 모두 확인했으며, 회원탈퇴에 동의합니다.
                                    </label>
                                    <div class="invalid-feedback">
                                        탈퇴 동의 체크박스를 선택해주세요.
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 버튼들 -->
                            <div class="row g-2">
                                <div class="col-6">
                                    <a href="/member/myinfo/edit" class="btn btn-secondary w-100">
                                        <i class="fas fa-arrow-left me-1"></i>
                                        취소
                                    </a>
                                </div>
                                <div class="col-6">
                                    <button type="submit" class="btn btn-danger w-100" id="submitButton" disabled>
                                        <i class="fas fa-user-times me-2"></i>
                                        탈퇴하기
                                    </button>
                                </div>
                            </div>
                        </form>
                        
                        <!-- 추가 안내 -->
                        <hr class="my-4">
                        <div class="text-center">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                문의사항이 있으시면 <a href="/board?type=qna">Q&A 게시판</a>을 이용해주세요.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 회원탈퇴 전용 JavaScript -->
<script src="/js/delete-member.js"></script>

</body>
</html>
````

## File: src/main/resources/templates/index.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>CareLink - 요양원 구인구직 사이트</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>
    
    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <!-- 히어로 섹션 -->
        <section class="bg-gradient-primary text-white py-5">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6">
                        <h1 class="display-4 fw-bold mb-3">
                            <i class="fas fa-heart text-danger me-3"></i>
                            CareLink
                        </h1>
                        <p class="lead mb-4">
                            믿을 수 있는 요양원 구인구직 플랫폼<br>
                            좋은 사람과 좋은 시설을 연결합니다
                        </p>
                        <div class="d-flex flex-wrap gap-3">
                            <a href="/facility/search" class="btn btn-light btn-lg">
                                <i class="fas fa-map-marker-alt me-2"></i>
                                시설 찾기
                            </a>
                            <a href="/job?type=recruit" class="btn btn-outline-light btn-lg">
                                <i class="fas fa-briefcase me-2"></i>
                                채용정보
                            </a>
                        </div>
                    </div>
                    <div class="col-lg-6 text-center">
                        <i class="fas fa-hospital-alt" style="font-size: 15rem; opacity: 0.3;"></i>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- 통계 섹션 -->
        <section class="py-5 bg-light">
            <div class="container">
                <h2 class="text-center mb-5">
                    <i class="fas fa-chart-bar text-primary me-2"></i>
                    실시간 현황
                </h2>
                <div class="row">
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-4">
                        <div class="stats-card">
                            <h3 th:text="${facilityCount}">150</h3>
                            <p><i class="fas fa-building me-2"></i>등록 시설</p>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-4">
                        <div class="stats-card">
                            <h3 th:text="${jobCount}">89</h3>
                            <p><i class="fas fa-briefcase me-2"></i>채용 공고</p>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-4">
                        <div class="stats-card">
                            <h3 th:text="${reviewCount}">234</h3>
                            <p><i class="fas fa-star me-2"></i>시설 리뷰</p>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-4">
                        <div class="stats-card">
                            <h3 th:text="${memberCount}">512</h3>
                            <p><i class="fas fa-users me-2"></i>가입 회원</p>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-4">
                        <div class="stats-card">
                            <h3 th:text="${boardCount}">324</h3>
                            <p><i class="fas fa-clipboard-list me-2"></i>정보 게시글</p>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-4">
                        <div class="stats-card">
                            <h3>5</h3>
                            <p><i class="fas fa-handshake me-2"></i>운영 년수</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- 주요 기능 섹션 -->
        <section class="py-5">
            <div class="container">
                <h2 class="text-center mb-5">
                    <i class="fas fa-star text-warning me-2"></i>
                    주요 기능
                </h2>
                <div class="row">
                    <!-- 시설 검색 -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 text-center">
                            <div class="card-body">
                                <div class="mb-3">
                                    <i class="fas fa-map-marker-alt fa-3x text-primary"></i>
                                </div>
                                <h5 class="card-title">시설 찾기</h5>
                                <p class="card-text">
                                    지도를 통해 주변 요양 시설을 쉽게 찾아보세요.
                                    상세 정보와 리뷰를 확인할 수 있습니다.
                                </p>
                                <a href="/facility/search" class="btn btn-primary">
                                    <i class="fas fa-search me-1"></i>검색하기
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 구인정보 -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 text-center">
                            <div class="card-body">
                                <div class="mb-3">
                                    <i class="fas fa-briefcase fa-3x text-success"></i>
                                </div>
                                <h5 class="card-title">구인정보</h5>
                                <p class="card-text">
                                    요양원에서 제공하는 다양한 구인 정보를 
                                    확인하고 지원해보세요.
                                </p>
                                <a href="/job?type=recruit" class="btn btn-success">
                                    <i class="fas fa-eye me-1"></i>보러가기
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 구직정보 -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 text-center">
                            <div class="card-body">
                                <div class="mb-3">
                                    <i class="fas fa-user-tie fa-3x text-info"></i>
                                </div>
                                <h5 class="card-title">구직정보</h5>
                                <p class="card-text">
                                    구직자들의 정보를 확인하고 
                                    우수한 인재를 찾아보세요.
                                </p>
                                <a href="/job?type=search" class="btn btn-info">
                                    <i class="fas fa-search me-1"></i>찾아보기
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 리뷰 -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 text-center">
                            <div class="card-body">
                                <div class="mb-3">
                                    <i class="fas fa-star fa-3x text-warning"></i>
                                </div>
                                <h5 class="card-title">시설 리뷰</h5>
                                <p class="card-text">
                                    실제 이용자들의 솔직한 리뷰를 통해
                                    시설 정보를 확인해보세요.
                                </p>
                                <a href="/review" class="btn btn-warning">
                                    <i class="fas fa-comments me-1"></i>리뷰보기
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 추가 기능 섹션 -->
                <div class="row mt-4">
                    <!-- 정보마당 -->
                    <div class="col-lg-6 col-md-12 mb-4">
                        <div class="card h-100 text-center">
                            <div class="card-body">
                                <div class="mb-3">
                                    <i class="fas fa-clipboard-list fa-3x text-secondary"></i>
                                </div>
                                <h5 class="card-title">정보마당</h5>
                                <p class="card-text">
                                    요양 관련 유용한 정보와 팁, Q&A 등을 
                                    확인하고 공유해보세요.
                                </p>
                                <a href="/board" class="btn btn-secondary">
                                    <i class="fas fa-book-open me-1"></i>정보보기
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 공지사항 -->
                    <div class="col-lg-6 col-md-12 mb-4">
                        <div class="card h-100 text-center">
                            <div class="card-body">
                                <div class="mb-3">
                                    <i class="fas fa-bullhorn fa-3x text-danger"></i>
                                </div>
                                <h5 class="card-title">공지사항</h5>
                                <p class="card-text">
                                    CareLink의 새로운 소식과 
                                    중요한 공지사항을 확인하세요.
                                </p>
                                <a href="/board?type=notice" class="btn btn-danger">
                                    <i class="fas fa-bell me-1"></i>공지보기
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- 팀 프로젝트 안내 -->
        <section class="py-5 bg-light">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8 text-center">
                        <h3 class="mb-4">
                            <i class="fas fa-users text-primary me-2"></i>
                            4인 팀 프로젝트
                        </h3>
                        <p class="lead mb-4">
                            이 사이트는 Spring Boot를 학습하는 4명의 팀원이 협업하여 개발한 프로젝트입니다.
                        </p>
                        <div class="row">
                            <div class="col-sm-6 col-lg-3 mb-3">
                                <div class="border rounded p-3">
                                    <h6 class="text-primary">팀원 A</h6>
                                    <small>회원 관리</small>
                                </div>
                            </div>
                            <div class="col-sm-6 col-lg-3 mb-3">
                                <div class="border rounded p-3">
                                    <h6 class="text-success">팀원 B</h6>
                                    <small>시설 검색</small>
                                </div>
                            </div>
                            <div class="col-sm-6 col-lg-3 mb-3">
                                <div class="border rounded p-3">
                                    <h6 class="text-info">팀원 C</h6>
                                    <small>구인구직</small>
                                </div>
                            </div>
                            <div class="col-sm-6 col-lg-3 mb-3">
                                <div class="border rounded p-3">
                                    <h6 class="text-warning">팀원 D</h6>
                                    <small>리뷰&게시판</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- 푸터 -->
    <footer th:replace="~{layout/footer :: footer}"></footer>
    
    <!-- JavaScript -->
    <div th:replace="~{layout/footer :: scripts}"></div>
    
    <script>
        $(document).ready(function() {
            // 카드 애니메이션
            $('.card').addClass('fade-in');
            
            // 통계 카운터 애니메이션
            $('.stats-card h3').each(function() {
                var $this = $(this);
                var countTo = parseInt($this.text());
                
                $({ countNum: 0 }).animate({
                    countNum: countTo
                }, {
                    duration: 2000,
                    easing: 'linear',
                    step: function() {
                        $this.text(Math.floor(this.countNum));
                    },
                    complete: function() {
                        $this.text(this.countNum);
                    }
                });
            });
        });
    </script>
</body>
</html>
````

## File: Dockerfile
````dockerfile
FROM openjdk:11-jre-slim

WORKDIR /app

# 애플리케이션 JAR 파일 복사
COPY build/libs/*.jar app.jar

# 포트 노출
EXPOSE 8080

# 환경변수 설정
ENV SPRING_PROFILES_ACTIVE=production

# 애플리케이션 실행
ENTRYPOINT ["java", "-jar", "app.jar"]
````

## File: src/main/java/com/example/carelink/common/BaseDTO.java
````java
package com.example.carelink.common;

import lombok.Data;
import java.time.LocalDateTime;
import com.fasterxml.jackson.annotation.JsonFormat;
/**
 * 모든 DTO 클래스가 상속받을 기본 클래스
 * 공통 필드(생성일시, 수정일시, 삭제여부)를 포함
 */

@Data
public class BaseDTO {

    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime createdAt;  // 생성일시

    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime updatedAt;  // 수정일시
    private boolean isDeleted;        // 삭제 여부

    // 페이징 관련 필드 타입을 Integer로 변경
    private Integer page;               // 현재 페이지 (기본값은 필요에 따라 생성자에서 설정)
    private Integer pageSize;           // 페이지 크기
    private Integer offset;             // 조회 시작 위치
    private Integer size;               // 조회할 레코드 수 (pageSize와 동일한 의미)

    // 필요하다면 초기값 설정을 위한 생성자를 추가할 수 있습니다.
    public BaseDTO() {
        this.page = 1;
        this.pageSize = Constants.DEFAULT_PAGE_SIZE;
        this.offset = (this.page - 1) * this.pageSize; // 초기 offset 계산
        this.size = this.pageSize;
    }

    /*
    *//**
     * 페이징 처리를 위한 offset 계산
     *//*
    public int getOffset() {
        return (page - 1) * pageSize;
    }
    
    *//**
     * 페이징을 위한 size 설정 (MyBatis용)
     *//*
    public void setSize(int size) {
        this.size = size;
        this.pageSize = size;
    }
    
    *//**
     * 페이징을 위한 page 설정 (offset 자동 계산)
     *//*
    public void setPage(int page) {
        this.page = page;
        this.offset = (page - 1) * this.pageSize;  // offset 자동 계산
    }
    */

}
````

## File: src/main/java/com/example/carelink/dao/MemberMapper.java
````java
package com.example.carelink.dao;

import com.example.carelink.dto.MemberDTO;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;

/**
 * 회원 관리 매퍼 인터페이스
 * 팀원 A 담당: 회원 관리 데이터 액세스
 */
@Mapper
public interface MemberMapper {

    /**
     * 사용자 ID로 회원 정보 조회
     * is_deleted = FALSE 인 활성화된 회원만 조회하도록 XML 쿼리 수정 필요
     */
    MemberDTO findByUserId(@Param("userId") String userId);

    /**
     * 회원 ID로 회원 정보 조회
     * is_deleted = FALSE 인 활성화된 회원만 조회하도록 XML 쿼리 수정 필요
     */
    MemberDTO findById(@Param("memberId") Long memberId);

    /**
     * 이메일로 회원 정보 조회
     * is_deleted = FALSE 인 활성화된 회원만 조회하도록 XML 쿼리 수정 필요
     */
    MemberDTO findByEmail(@Param("email") String email);

    /**
     * 회원 정보 저장
     */
    int insertMember(MemberDTO memberDTO); // insert는 보통 int(영향받은 행 수) 반환

    /**
     * 회원 정보 수정
     */
    int updateMember(MemberDTO memberDTO); // update는 보통 int(영향받은 행 수) 반환

    /**
     * 회원 탈퇴 (논리 삭제) - 메서드 이름을 좀 더 명확하게 변경
     * 기존의 deleteMember를 softDeleteMember로 변경하고 파라미터도 userId로 변경
     */
    int softDeleteMember(@Param("userId") String userId); // deleteMember -> softDeleteMember로 변경, memberId -> userId

    /**
     * 비밀번호 변경
     * MemberDTO를 받아 password만 업데이트하는 용도
     */
    int updatePassword(MemberDTO memberDTO); // 새로 추가

    /**
     * 로그인 성공 시 정보 업데이트 (실패 횟수 초기화, 마지막 로그인 시간 업데이트)
     */
    int updateLoginSuccess(@Param("memberId") Long memberId); // update는 보통 int(영향받은 행 수) 반환

    /**
     * 로그인 실패 시 실패 횟수 증가
     */
    int updateLoginFail(@Param("memberId") Long memberId); // update는 보통 int(영향받은 행 수) 반환

    /**
     * 전체 회원 수 조회
     */
    int getTotalCount();

    /**
     * 페이징된 회원 목록 조회 (관리자용)
     */
    List<MemberDTO> findMembersWithPaging(MemberDTO searchDTO);

    /**
     * 특정 역할의 회원 목록 조회
     */
    List<MemberDTO> findMembersByRole(@Param("role") String role);

    /**
     * 회원 상태 변경 (활성화/비활성화)
     */
    void updateMemberStatus(@Param("memberId") Long memberId, @Param("isActive") boolean isActive);

    /**
     * 전체 회원 수 조회 (통계용)
     */
    int getMemberCount();

    /**
     * 특정 사용자 ID가 존재하는지 확인
     * (활성/비활성 여부, 삭제 여부와 상관없이 ID 자체의 중복 확인)
     */
    boolean existsByUserId(@Param("userId") String userId);

    /**
     * 특정 이메일이 존재하는지 확인
     * (활성/비활성 여부, 삭제 여부와 상관없이 이메일 자체의 중복 확인)
     */
    boolean existsByEmail(@Param("email") String email);
    
    /**
     * 회원 익명화 (개인정보만 삭제, 콘텐츠는 유지)
     */
    int anonymizeMember(@Param("userId") String userId);
    
    /**
     * 회원 물리 삭제 (완전 삭제)
     */
    int hardDeleteMember(@Param("userId") String userId);

    // ================== 관리자용 메서드들 ==================

    /**
     * 시설 회원 수 조회 (관리자용)
     */
    int getFacilityMemberCount();

    /**
     * 일반 회원 수 조회 (관리자용)
     */
    int getUserMemberCount();

    /**
     * 역할별 회원 수 조회 (관리자용)
     */
    int getMemberCountByRole(@Param("role") String role);

}
````

## File: src/main/resources/mapper/MemberMapper.xml
````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.carelink.dao.MemberMapper">

    <resultMap id="memberResultMap" type="com.example.carelink.dto.MemberDTO">
        <id property="memberId" column="member_id"/>
        <result property="userId" column="user_id"/>
        <result property="password" column="password"/>
        <result property="name" column="name"/>
        <result property="email" column="email"/>
        <result property="phone" column="phone"/>
        <result property="role" column="role"/>
        <result property="address" column="address"/>
        <result property="detailAddress" column="detail_address"/>
        <result property="profileImage" column="profile_image"/>
        <result property="profileImageAltText" column="profile_image_alt_text"/>
        <result property="isActive" column="is_active"/>
        <result property="loginFailCount" column="login_fail_count"/>
        <result property="lastLoginAt" column="last_login_at"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="isDeleted" column="is_deleted"/>
    </resultMap>

    <select id="findByUserId" resultMap="memberResultMap">
        SELECT *
        FROM member
        WHERE user_id = #{userId}
          AND is_deleted = false
    </select>

    <select id="findById" resultMap="memberResultMap">
        SELECT *
        FROM member
        WHERE member_id = #{memberId}
          AND is_deleted = false
    </select>

    <select id="findByEmail" resultMap="memberResultMap">
        SELECT *
        FROM member
        WHERE email = #{email}
          AND is_deleted = false
    </select>

    <insert id="insertMember" parameterType="com.example.carelink.dto.MemberDTO" useGeneratedKeys="true" keyProperty="memberId">
        INSERT INTO member (
        member_id,          <!-- 1 (자동 증가) -->
        user_id,            <!-- 2 -->
        password,           <!-- 3 -->
        name,               <!-- 4 -->
        email,              <!-- 5 -->
        phone,              <!-- 6 -->
        role,               <!-- 7 -->
        address,            <!-- 8 -->
        detail_address,     <!-- 9 -->
        profile_image,      <!-- 10 -->
        is_active,          <!-- 11 -->
        login_fail_count,   <!-- 12 -->
        last_login_at,      <!-- 13 -->
        is_deleted          <!-- 14 -->
        <!-- created_at, updated_at은 DB DEFAULT이므로 제외 -->
        ) VALUES (
        #{memberId},              <!-- DTO에 null 또는 0으로 설정 -->
        #{userId, jdbcType=VARCHAR},
        #{password, jdbcType=VARCHAR},
        #{name, jdbcType=VARCHAR},
        #{email, jdbcType=VARCHAR},
        #{phone, jdbcType=VARCHAR},
        #{role, jdbcType=VARCHAR},
        #{address, jdbcType=VARCHAR},
        #{detailAddress, jdbcType=VARCHAR},
        #{profileImage, jdbcType=VARCHAR},
        #{isActive, jdbcType=BOOLEAN},
        #{loginFailCount, jdbcType=INTEGER},
        #{lastLoginAt, jdbcType=TIMESTAMP},
        #{isDeleted, jdbcType=BOOLEAN}
        )
    </insert>

    <select id="existsByUserId" resultType="boolean">
        SELECT COUNT(*) > 0 FROM member WHERE user_id = #{userId}
    </select>

    <select id="existsByEmail" resultType="boolean">
        SELECT COUNT(*) > 0 FROM member WHERE email = #{email}
    </select>

    <update id="updateMember" parameterType="MemberDTO">
        UPDATE member
        SET
            name = #{name},
            email = #{email},
            phone = #{phone},
            address = #{address},
            detail_address = #{detailAddress},
            profile_image = #{profileImage},
            profile_image_alt_text = #{profileImageAltText},
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>

    <update id="softDeleteMember">
        UPDATE member
        SET
            is_deleted = TRUE,
            is_active = FALSE,
            updated_at = NOW()
        WHERE user_id = #{userId}
    </update>
    
    <!-- 익명화: 개인정보만 삭제, 콘텐츠는 유지 -->
    <update id="anonymizeMember">
        UPDATE member
        SET
            name = '탈퇴회원',
            email = NULL,
            phone = NULL,
            address = NULL,
            profile_image = NULL,
            password = 'DELETED',
            is_deleted = TRUE,
            is_active = FALSE,
            updated_at = NOW()
        WHERE user_id = #{userId}
    </update>
    
    <!-- 물리 삭제: 완전히 데이터 제거 -->
    <delete id="hardDeleteMember">
        DELETE FROM member WHERE user_id = #{userId}
    </delete>

    <update id="updatePassword" parameterType="MemberDTO">
        UPDATE member
        SET
            password = #{password},
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>

    <update id="updateLoginSuccess">
        UPDATE member
        SET login_fail_count = 0,
            last_login_at = NOW(),
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>

    <update id="updateLoginFail">
        UPDATE member
        SET login_fail_count = login_fail_count + 1,
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>

    <!-- 전체 회원 수 조회 (관리자용) -->
    <select id="getTotalCount" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE is_deleted = FALSE
    </select>

    <select id="findMembersWithPaging" resultMap="memberResultMap">
        SELECT *
        FROM member
        WHERE is_deleted = FALSE
        <if test="role != null and !role.isEmpty()">
            AND role = #{role}
        </if>
        ORDER BY created_at DESC
        LIMIT #{pageSize} OFFSET #{offset}
    </select>

    <select id="findMembersByRole" resultMap="memberResultMap">
        SELECT *
        FROM member
        WHERE is_deleted = FALSE
        <if test="role != null and role != ''">
            AND role = #{role}
        </if>
        ORDER BY created_at DESC
    </select>

    <update id="updateMemberStatus">
        UPDATE member
        SET is_active = #{isActive},
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>

    <!-- 전체 회원 수 조회 (통계용) -->
    <select id="getMemberCount" resultType="int">
        SELECT COUNT(*) 
        FROM member 
        WHERE is_deleted = false AND is_active = true
    </select>

    <!-- ================== 관리자용 쿼리들 ================== -->

    <!-- 시설 회원 수 조회 (관리자용) -->
    <select id="getFacilityMemberCount" resultType="int">
        SELECT COUNT(*) 
        FROM member 
        WHERE is_deleted = false 
        AND role = 'FACILITY'
    </select>

    <!-- 일반 회원 수 조회 (관리자용) -->
    <select id="getUserMemberCount" resultType="int">
        SELECT COUNT(*) 
        FROM member 
        WHERE is_deleted = false 
        AND role = 'USER'
    </select>

    <!-- 역할별 회원 수 조회 (관리자용) -->
    <select id="getMemberCountByRole" resultType="int">
        SELECT COUNT(*) 
        FROM member 
        WHERE is_deleted = false
        <if test="role != null and role != ''">
            AND role = #{role}
        </if>
    </select>

</mapper>
````

## File: src/main/resources/static/css/common.css
````css
/* ===================================
   CareLink 공통 스타일
   4인 팀 프로젝트 전용
   =================================== */

/* 기본 설정 */
:root {
    --primary-color: #0d6efd;
    --secondary-color: #6c757d;
    --success-color: #198754;
    --danger-color: #dc3545;
    --warning-color: #ffc107;
    --info-color: #0dcaf0;
    --light-color: #f8f9fa;
    --dark-color: #212529;
    --border-radius: 8px;
    --box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    --navbar-height: 56px;
}

body {
    font-family: 'Noto Sans KR', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    color: var(--dark-color);
    background-color: #f8f9fa;
}

/* 고정 네비게이션바를 위한 여백 */
body.pt-5 {
    padding-top: calc(var(--navbar-height) + 1rem) !important;
}

/* 네비게이션바 고정 스타일 */
.navbar.fixed-top {
    z-index: 1030;
    box-shadow: 0 2px 4px rgba(0,0,0,.1);
}

/* 레이아웃 */
.min-vh-100 {
    min-height: 100vh;
}

/* 카드 스타일 */
.card {
    border: none;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}

/* 카드 헤더 스타일 개선 */
.card-header {
    border-bottom: 1px solid rgba(0,0,0,.125);
    font-weight: 600;
}

.card-header.bg-primary {
    background-color: var(--primary-color) !important;
    border-color: var(--primary-color);
}

/* 버튼 스타일 */
.btn {
    border-radius: var(--border-radius);
    font-weight: 500;
    padding: 0.5rem 1rem;
    transition: all 0.2s ease-in-out;
}

.btn:hover {
    transform: translateY(-1px);
}

/* 폼 스타일 */
.form-control {
    border-radius: var(--border-radius);
    border: 1px solid #ced4da;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.form-control:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
}

/* 네비게이션 스타일 */
.navbar-brand {
    font-size: 1.5rem;
    font-weight: 700;
}

.navbar-nav .nav-link {
    font-weight: 500;
    transition: color 0.2s ease-in-out;
}

.navbar-nav .nav-link:hover {
    color: rgba(255, 255, 255, 0.8) !important;
}

/* 드롭다운 메뉴 스타일 */
.dropdown-menu {
    border: none;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    border-radius: var(--border-radius);
}

.dropdown-item {
    transition: background-color 0.2s ease-in-out;
}

.dropdown-item:hover {
    background-color: rgba(13, 110, 253, 0.1);
}

/* 푸터 스타일 */
footer {
    background: linear-gradient(135deg, #343a40 0%, #495057 100%) !important;
}

footer a {
    transition: color 0.2s ease-in-out;
}

footer a:hover {
    color: var(--info-color) !important;
}

/* 알림 메시지 스타일 */
.alert {
    border: none;
    border-radius: var(--border-radius);
    border-left: 4px solid;
}

.alert-success {
    border-left-color: var(--success-color);
    background-color: rgba(25, 135, 84, 0.1);
}

.alert-danger {
    border-left-color: var(--danger-color);
    background-color: rgba(220, 53, 69, 0.1);
}

.alert-warning {
    border-left-color: var(--warning-color);
    background-color: rgba(255, 193, 7, 0.1);
}

.alert-info {
    border-left-color: var(--info-color);
    background-color: rgba(13, 202, 240, 0.1);
}

/* 테이블 스타일 */
.table {
    border-radius: var(--border-radius);
    overflow: hidden;
}

.table thead th {
    background-color: var(--primary-color);
    color: white;
    border: none;
    font-weight: 600;
    vertical-align: middle;
}

.table-primary th {
    background-color: var(--primary-color) !important;
    color: white !important;
}

.table tbody tr {
    transition: background-color 0.2s ease-in-out;
}

.table tbody tr:hover {
    background-color: rgba(13, 110, 253, 0.05);
}

/* 리스트 그룹 스타일 */
.list-group-item {
    border: 1px solid rgba(0,0,0,.125);
    transition: all 0.2s ease-in-out;
}

.list-group-item:hover {
    background-color: rgba(13, 110, 253, 0.05);
    transform: translateX(2px);
}

.list-group-item-action:hover {
    color: var(--primary-color);
    text-decoration: none;
}

/* 페이지네이션 스타일 */
.pagination .page-link {
    border-radius: var(--border-radius);
    margin: 0 2px;
    border: 1px solid #dee2e6;
    color: var(--primary-color);
    transition: all 0.2s ease-in-out;
}

.pagination .page-item.active .page-link {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}

.pagination .page-link:hover {
    background-color: rgba(13, 110, 253, 0.1);
    border-color: var(--primary-color);
    transform: translateY(-1px);
}

/* 배지 스타일 */
.badge {
    font-size: 0.75em;
    border-radius: 0.375rem;
}

.badge.bg-danger {
    background-color: var(--danger-color) !important;
}

.badge.bg-secondary {
    background-color: var(--secondary-color) !important;
}

/* 검색 필터 스타일 */
.search-filters {
    background-color: white;
    border-radius: var(--border-radius);
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: var(--box-shadow);
}

/* 통계 카드 스타일 */
.stats-card {
    background: linear-gradient(135deg, var(--primary-color) 0%, #0a58ca 100%);
    color: white;
    border-radius: var(--border-radius);
    padding: 1.5rem;
    text-align: center;
    transition: transform 0.2s ease-in-out;
}

.stats-card:hover {
    transform: translateY(-3px);
}

.stats-card h3 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.stats-card p {
    margin-bottom: 0;
    opacity: 0.9;
}

/* 평점 별 스타일 */
.rating .fa-star {
    transition: color 0.2s ease-in-out;
}

.rating .fa-star.text-warning {
    color: #ffc107 !important;
}

.rating .fa-star.text-muted {
    color: #6c757d !important;
}

/* 로딩 스피너 */
.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* 입력 필드 아이콘 */
.input-group-text {
    background-color: var(--light-color);
    border-color: #ced4da;
}

/* 파일 업로드 스타일 */
.file-upload-area {
    border: 2px dashed #ced4da;
    border-radius: var(--border-radius);
    padding: 2rem;
    text-align: center;
    transition: border-color 0.2s ease-in-out;
    cursor: pointer;
}

.file-upload-area:hover {
    border-color: var(--primary-color);
    background-color: rgba(13, 110, 253, 0.05);
}

.file-upload-area.dragover {
    border-color: var(--success-color);
    background-color: rgba(25, 135, 84, 0.1);
}

/* 태그 스타일 */
.tag {
    display: inline-block;
    background-color: var(--primary-color);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.75rem;
    margin: 0.125rem;
}

.tag-secondary {
    background-color: var(--secondary-color);
}

.tag-success {
    background-color: var(--success-color);
}

.tag-warning {
    background-color: var(--warning-color);
    color: var(--dark-color);
}

/* 모바일 반응형 */
@media (max-width: 768px) {
    .navbar-brand {
        font-size: 1.25rem;
    }
    
    .card-body {
        padding: 1rem;
    }
    
    .btn {
        padding: 0.75rem 1rem;
        width: 100%;
        margin-bottom: 0.5rem;
    }
    
    .stats-card h3 {
        font-size: 2rem;
    }
    
    .search-filters {
        padding: 1rem;
    }
}

/* 다크 모드 지원 준비 */
@media (prefers-color-scheme: dark) {
    /* 추후 다크 모드 스타일 추가 예정 */
}

/* 유틸리티 클래스 */
.text-hover:hover {
    color: var(--primary-color) !important;
    text-decoration: underline;
}

.bg-gradient-primary {
    background: linear-gradient(135deg, var(--primary-color) 0%, #0a58ca 100%) !important;
}

.border-primary-soft {
    border: 1px solid rgba(13, 110, 253, 0.3) !important;
}

.shadow-soft {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075) !important;
}

/* 애니메이션 */
.fade-in {
    animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* 지도 관련 스타일 */
#map {
    border-radius: var(--border-radius);
    overflow: hidden;
    transition: all 0.3s ease-in-out;
}

.info-window {
    padding: 15px;
    max-width: 300px;
    border-radius: var(--border-radius);
}

.info-window h5 {
    margin: 0 0 10px 0;
    color: var(--primary-color);
    font-weight: 600;
}

.info-window p {
    margin: 5px 0;
    font-size: 0.9rem;
    color: var(--dark-color);
}

.facility-item {
    cursor: pointer;
    transition: all 0.2s ease-in-out;
}

.facility-item:hover {
    background-color: rgba(13, 110, 253, 0.05);
    transform: translateX(5px);
}

.facility-item.active {
    background-color: rgba(13, 110, 253, 0.1);
    border-left: 4px solid var(--primary-color);
}

/* 지도 컨트롤 스타일 */
.custom-control {
    background-color: white;
    border-radius: 4px;
    box-shadow: var(--box-shadow);
    padding: 5px;
    margin: 5px;
}

.custom-control:hover {
    background-color: #f8f9fa;
}

/* 별점 스타일 */
.rating-stars {
    display: inline-flex;
    gap: 4px;
    cursor: pointer;
}

.rating-stars .star {
    font-size: 24px;
    color: #ddd;
    transition: color 0.2s;
}

.rating-stars .star:hover,
.rating-stars .star.active {
    color: #ffc107;
}

.rating-group {
    margin-bottom: 1rem;
}

.rating-group label {
    display: block;
    margin-bottom: 0.5rem;
}

.detailed-rating .star {
    font-size: 20px;
}

/* 별점 텍스트 스타일 */
#ratingText {
    font-size: 14px;
    color: #6c757d;
}

/* 별점 그룹 스타일 */
.rating-input-group {
    background-color: #f8f9fa;
    padding: 1rem;
    border-radius: 0.5rem;
    margin-bottom: 1rem;
}

.rating-group {
    background-color: #fff;
    padding: 1rem;
    border-radius: 0.5rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

/* 별점 호버 효과 */
.rating-stars .star:hover ~ .star {
    color: #ddd;
}

.rating-stars:hover .star {
    color: #ffc107;
}

.rating-stars .star:hover ~ .star {
    color: #ddd !important;
}

/* 별점 애니메이션 */
@keyframes star-pop {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.rating-stars .star.active {
    animation: star-pop 0.3s ease-out;
}

/* 이미지 모달 스타일 */
.modal {
    display: none;
    position: fixed;
    z-index: 1050;
    padding-top: 100px;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.9);
}

.modal-content {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
}

.close-modal {
    position: absolute;
    right: 35px;
    top: 15px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
}

.close-modal:hover,
.close-modal:focus {
    color: #bbb;
    text-decoration: none;
    cursor: pointer;
}

/* 리뷰 이미지 스타일 */
.review-image {
    cursor: pointer;
    transition: transform 0.2s ease-in-out;
}

.review-image:hover {
    transform: scale(1.05);
}

/* 리뷰 상세 페이지 스타일 */
.rating-detail {
    font-size: 0.9rem;
}

.rating-detail .fas.fa-star {
    color: #ffc107;
}

.rating-detail .far.fa-star {
    color: #dee2e6;
}

.content-area {
    white-space: pre-wrap;
    word-break: break-word;
}

.list-group-item-action:hover {
    background-color: rgba(13, 110, 253, 0.05);
}

.list-group-item-action .rating-stars {
    font-size: 0.8rem;
}
````

## File: src/main/resources/templates/job/edit.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>구인구직 수정 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item"><a href="/job">구인구직</a></li>
                <li class="breadcrumb-item"><a th:href="@{/job/detail/{id}(id=${jobDTO.jobId})}">상세보기</a></li>
                <li class="breadcrumb-item active" aria-current="page">
                    <span th:if="${jobDTO.jobType == 'RECRUIT'}">구인 수정</span>
                    <span th:if="${jobDTO.jobType == 'SEARCH'}">구직 수정</span>
                </li>
            </ol>
        </nav>

        <div class="d-flex align-items-center mb-4">
            <h2 class="me-3">
                <i class="fas fa-edit me-2"></i>
                <span th:if="${jobDTO.jobType == 'RECRUIT'}" class="text-success">구인공고 수정</span>
                <span th:if="${jobDTO.jobType == 'SEARCH'}" class="text-info">구직공고 수정</span>
            </h2>
        </div>

        <form th:action="@{/job/edit/{id}(id=${jobDTO.jobId})}" method="post" th:object="${jobDTO}">
            <!-- 수정 시 필요한 hidden 필드들 -->
            <input type="hidden" th:field="*{jobId}" />
            <input type="hidden" th:field="*{jobType}" id="hiddenJobType" />
            
            <!-- 향상된 UI 레이아웃 -->
            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="jobTitle" class="form-label">제목 *</label>
                                <input type="text" class="form-control" id="jobTitle" th:field="*{title}" required
                                       autocomplete="off"
                                       th:placeholder="${jobDTO.jobType == 'RECRUIT' ? '구인공고 제목을 입력하세요' : '구직공고 제목을 입력하세요'}">
                            </div>
                            
                            <div class="row">
                                <!-- 구인글(시설회원): 회사명 입력 -->
                                <div class="col-md-6 mb-3" id="facilityNameField" 
                                     th:style="${jobDTO.jobType == 'SEARCH' ? 'display: none;' : ''}">
                                    <label for="facilityNameInput" class="form-label">
                                        <span class="facility-mode">회사명 *</span>
                                        <span class="search-mode" style="display: none;">희망 근무지 *</span>
                                    </label>
                                    <input type="text" class="form-control" th:field="*{facilityName}" 
                                           id="facilityNameInput" autocomplete="organization"
                                           placeholder="회사명을 입력하세요">
                                </div>
                                
                                <!-- 구직글(일반사용자): 희망 근무지 입력 -->
                                <div class="col-md-6 mb-3" id="workLocationField"
                                     th:style="${jobDTO.jobType == 'RECRUIT' ? 'display: none;' : ''}">
                                    <label for="workLocationInput" class="form-label">희망 근무지 *</label>
                                    <input type="text" class="form-control" th:field="*{workLocation}" 
                                           id="workLocationInput" autocomplete="address-level2"
                                           placeholder="희망 근무지를 입력하세요">
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="jobPosition" class="form-label">직종 *</label>
                                    <select class="form-select" th:field="*{position}" id="jobPosition"
                                            autocomplete="off" required>
                                        <option value="">선택해주세요</option>
                                        <option value="간병인">간병인</option>
                                        <option value="요양보호사">요양보호사</option>
                                        <option value="사회복지사">사회복지사</option>
                                        <option value="물리치료사">물리치료사</option>
                                        <option value="간호사">간호사</option>
                                        <option value="영양사">영양사</option>
                                        <option value="사무직">사무직</option>
                                        <option value="조리원">조리원</option>
                                        <option value="운전원">운전원</option>
                                        <option value="기타">기타</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="contentTextarea" class="form-label">
                                    <span class="facility-mode">업무 내용 *</span>
                                    <span class="search-mode" style="display: none;">자기소개 및 경력사항 *</span>
                                </label>
                                <textarea class="form-control" rows="10" th:field="*{content}" required
                                          id="contentTextarea" autocomplete="off"
                                          data-rich-editor='{"height": "350px"}'></textarea>
                            </div>
                            
                            <!-- 구직글 전용 필드들 -->
                            <div id="jobSeekerFields" th:style="${jobDTO.jobType == 'RECRUIT' ? 'display: none;' : ''}">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="jobExperience" class="form-label">경력</label>
                                        <select class="form-select" th:field="*{experience}" id="jobExperience"
                                                autocomplete="off">
                                            <option value="">선택해주세요</option>
                                            <option value="신입">신입</option>
                                            <option value="1년 이상">1년 이상</option>
                                            <option value="3년 이상">3년 이상</option>
                                            <option value="5년 이상">5년 이상</option>
                                            <option value="10년 이상">10년 이상</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="jobEducation" class="form-label">학력</label>
                                        <select class="form-select" th:field="*{education}" id="jobEducation"
                                                autocomplete="off">
                                            <option value="">선택해주세요</option>
                                            <option value="중학교 졸업">중학교 졸업</option>
                                            <option value="고등학교 졸업">고등학교 졸업</option>
                                            <option value="전문대학 졸업">전문대학 졸업</option>
                                            <option value="대학교 졸업">대학교 졸업</option>
                                            <option value="대학원 졸업">대학원 졸업</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="jobQualifications" class="form-label">보유 자격증</label>
                                    <textarea class="form-control" rows="3" th:field="*{qualifications}"
                                              id="jobQualifications" autocomplete="off"
                                              placeholder="보유하신 자격증을 입력해주세요 (예: 요양보호사 1급, 간병인 자격증 등)"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <!-- 구인글: 급여 정보 -->
                            <div id="recruitFields" th:style="${jobDTO.jobType == 'SEARCH' ? 'display: none;' : ''}">
                                <div class="mb-3">
                                    <label for="editSalaryType" class="form-label">급여 유형 *</label>
                                    <select class="form-select" th:field="*{salaryType}" id="editSalaryType"
                                            autocomplete="off">
                                        <option value="">선택해주세요</option>
                                        <option value="HOURLY">시급</option>
                                        <option value="MONTHLY">월급</option>
                                        <option value="ANNUAL">연봉</option>
                                    </select>
                                </div>
                                
                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <label for="editSalaryMin" class="form-label">최소 급여</label>
                                        <input type="number" class="form-control" th:field="*{salaryMin}" 
                                               id="editSalaryMin" autocomplete="off"
                                               placeholder="최소 급여">
                                    </div>
                                    <div class="col-6 mb-3">
                                        <label for="editSalaryMax" class="form-label">최대 급여</label>
                                        <input type="number" class="form-control" th:field="*{salaryMax}" 
                                               id="editSalaryMax" autocomplete="off"
                                               placeholder="최대 급여">
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="editSalaryDescription" class="form-label">급여 설명</label>
                                    <input type="text" class="form-control" th:field="*{salaryDescription}" 
                                           id="editSalaryDescription" autocomplete="off"
                                           placeholder="예: 시급 10,000원, 야간수당 별도">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="editRecruitCount" class="form-label">모집인원</label>
                                    <input type="number" class="form-control" th:field="*{recruitCount}" 
                                           id="editRecruitCount" autocomplete="off"
                                           placeholder="모집인원" min="1">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="editWorkHours" class="form-label">근무시간</label>
                                    <input type="text" class="form-control" th:field="*{workHours}" 
                                           id="editWorkHours" autocomplete="off"
                                           placeholder="예: 09:00~18:00, 주 5일">
                                </div>
                            </div>
                            
                            <!-- 구직글: 희망 조건 -->
                            <div id="searchFields" th:style="${jobDTO.jobType == 'RECRUIT' ? 'display: none;' : ''}">
                                <div class="mb-3">
                                    <label for="editSearchSalaryType" class="form-label">희망 급여 유형</label>
                                    <select class="form-select" th:field="*{salaryType}" id="editSearchSalaryType"
                                            autocomplete="off">
                                        <option value="">상관없음</option>
                                        <option value="HOURLY">시급</option>
                                        <option value="MONTHLY">월급</option>
                                        <option value="ANNUAL">연봉</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="editSearchSalaryDescription" class="form-label">희망 급여</label>
                                    <input type="text" class="form-control" th:field="*{salaryDescription}" 
                                           id="editSearchSalaryDescription" autocomplete="off"
                                           placeholder="예: 시급 12,000원 이상">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="editSearchWorkHours" class="form-label">희망 근무시간</label>
                                    <input type="text" class="form-control" th:field="*{workHours}" 
                                           id="editSearchWorkHours" autocomplete="off"
                                           placeholder="예: 주간근무 선호, 야간 가능">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="editContactPhone" class="form-label">연락처 *</label>
                                    <input type="tel" class="form-control" th:field="*{contactPhone}" 
                                           id="editContactPhone" autocomplete="tel"
                                           placeholder="연락 가능한 전화번호" required>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="editWorkType" class="form-label">고용형태 *</label>
                                <select class="form-select" th:field="*{workType}" id="editWorkType"
                                        autocomplete="off" required>
                                    <option value="">선택해주세요</option>
                                    <option value="FULL_TIME">정규직</option>
                                    <option value="PART_TIME">파트타임</option>
                                    <option value="TEMPORARY">임시직</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="editStatus" class="form-label">게시글 상태 *</label>
                                <select class="form-select" th:field="*{status}" id="editStatus"
                                        autocomplete="off" required>
                                    <option value="">상태 선택</option>
                                    <option value="ACTIVE">활성</option>
                                    <option value="CLOSED">마감</option>
                                    <option value="DRAFT">임시저장</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-grid gap-2 mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i>
                    <span th:if="${jobDTO.jobType == 'RECRUIT'}">구인공고 수정 완료</span>
                    <span th:if="${jobDTO.jobType == 'SEARCH'}">구직공고 수정 완료</span>
                </button>
                <a th:href="@{/job/detail/{id}(id=${jobDTO.jobId})}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i>취소
                </a>
            </div>
        </form>
    </div>
</main>

<!-- 푸터 -->
<footer th:replace="~{layout/footer :: footer}"></footer>

<!-- JavaScript -->
<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 구인구직 수정 페이지 전용 JavaScript -->
<script src="/js/job-edit.js"></script>

<script>
    // 페이지 로드 시 초기 설정
    document.addEventListener('DOMContentLoaded', function() {
        const jobType = '[[${jobDTO.jobType}]]';
        
        // 권한별 초기 상태 설정
        if (jobType === 'SEARCH') {
            switchToSearchMode();
        } else if (jobType === 'RECRUIT') {
            switchToRecruitMode();
        }
        
        // 리치 텍스트 에디터 초기화
        initRichTextEditor();
    });
    
    // 구인 모드로 전환
    function switchToRecruitMode() {
        // 숨겨진 jobType 필드 업데이트
        const hiddenJobType = document.getElementById('hiddenJobType');
        if (hiddenJobType) {
            hiddenJobType.value = 'RECRUIT';
        }
        
        // 필드 표시/숨김
        const facilityNameField = document.getElementById('facilityNameField');
        const workLocationField = document.getElementById('workLocationField');
        const jobSeekerFields = document.getElementById('jobSeekerFields');
        const recruitFields = document.getElementById('recruitFields');
        const searchFields = document.getElementById('searchFields');
        
        if (facilityNameField) facilityNameField.style.display = 'block';
        if (workLocationField) workLocationField.style.display = 'none';
        if (jobSeekerFields) jobSeekerFields.style.display = 'none';
        if (recruitFields) recruitFields.style.display = 'block';
        if (searchFields) searchFields.style.display = 'none';
        
        // 라벨 표시
        document.querySelectorAll('.facility-mode').forEach(el => el.style.display = 'inline');
        document.querySelectorAll('.search-mode').forEach(el => el.style.display = 'none');
        
        // 필수 필드 설정
        const facilityNameInput = document.getElementById('facilityNameInput');
        if (facilityNameInput) {
            facilityNameInput.required = true;
        }
        
        const contactPhoneInput = document.querySelector('[name="contactPhone"]');
        if (contactPhoneInput) {
            contactPhoneInput.required = false;
        }
    }
    
    // 구직 모드로 전환
    function switchToSearchMode() {
        // 숨겨진 jobType 필드 업데이트
        const hiddenJobType = document.getElementById('hiddenJobType');
        if (hiddenJobType) {
            hiddenJobType.value = 'SEARCH';
        }
        
        // 필드 표시/숨김
        const facilityNameField = document.getElementById('facilityNameField');
        const workLocationField = document.getElementById('workLocationField');
        const jobSeekerFields = document.getElementById('jobSeekerFields');
        const recruitFields = document.getElementById('recruitFields');
        const searchFields = document.getElementById('searchFields');
        
        if (facilityNameField) facilityNameField.style.display = 'none';
        if (workLocationField) workLocationField.style.display = 'block';
        if (jobSeekerFields) jobSeekerFields.style.display = 'block';
        if (recruitFields) recruitFields.style.display = 'none';
        if (searchFields) searchFields.style.display = 'block';
        
        // 라벨 표시
        document.querySelectorAll('.facility-mode').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.search-mode').forEach(el => el.style.display = 'inline');
        
        // 필수 필드 설정
        const facilityNameInput = document.getElementById('facilityNameInput');
        if (facilityNameInput) {
            facilityNameInput.required = false;
        }
        
        const contactPhoneInput = document.querySelector('[name="contactPhone"]');
        if (contactPhoneInput) {
            contactPhoneInput.required = true;
        }
    }
    
    // 리치 텍스트 에디터 초기화
    function initRichTextEditor() {
        const contentTextarea = document.getElementById('contentTextarea');
        if (contentTextarea && typeof window.RichTextEditor !== 'undefined') {
            const editor = new RichTextEditor(contentTextarea, {
                height: '350px',
                placeholder: '내용을 입력하세요...',
                toolbar: [
                    'bold', 'italic', 'underline', 'strikethrough', '|',
                    'h1', 'h2', 'h3', '|',
                    'ul', 'ol', '|',
                    'link', 'image', '|',
                    'align-left', 'align-center', 'align-right', '|',
                    'table', 'quote', 'code', '|',
                    'undo', 'redo', '|',
                    'fullscreen'
                ]
            });
            
            // 기존 내용 설정
            const existingContent = contentTextarea.value;
            if (existingContent) {
                editor.setContent(existingContent);
            }
            
            // 폼 제출 시 에디터 내용 동기화
            const form = document.querySelector('form');
            if (form) {
                form.addEventListener('submit', function() {
                    contentTextarea.value = editor.getContent();
                });
            }
        }
    }
</script>
</body>
</html>
````

## File: src/main/java/com/example/carelink/dao/BoardMapper.java
````java
package com.example.carelink.dao;

import com.example.carelink.dto.BoardDTO;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;

/**
 * 게시판 관련 데이터 액세스 매퍼
 * 팀원 D 담당
 */
@Mapper
public interface BoardMapper {
    
    /**
     * 게시글 목록 조회
     */
    List<BoardDTO> getBoardList(BoardDTO searchDTO);
    
    /**
     * 게시글 상세 정보 조회
     */
    BoardDTO getBoardById(@Param("boardId") Long boardId);
    
    /**
     * 게시글 상세 정보 조회 (삭제된 것 포함)
     */
    BoardDTO getBoardByIdIncludeDeleted(@Param("boardId") Long boardId);
    
    /**
     * 게시글 등록
     */
    int insertBoard(BoardDTO boardDTO);
    
    /**
     * 게시글 수정
     */
    int updateBoard(BoardDTO boardDTO);
    
    /**
     * 게시글 삭제
     */
    int deleteBoard(@Param("boardId") Long boardId);
    
    /**
     * 조회수 증가
     */
    void increaseViewCount(@Param("boardId") Long boardId);
    
    /**
     * 조회수 증가 (별칭)
     */
    void incrementViewCount(@Param("boardId") Long boardId);
    
    /**
     * 인기 게시글 목록 조회
     */
    List<BoardDTO> getPopularBoards();
    
    /**
     * 카테고리별 게시글 목록 조회
     */
    List<BoardDTO> getBoardsByCategory(@Param("category") String category);
    
    /**
     * 게시글 총 개수 조회
     */
    int getBoardCount(BoardDTO searchDTO);
    
    /**
     * 카테고리별 인기 게시글 목록 조회
     */
    List<BoardDTO> getPopularBoardsByCategory(@Param("category") String category);
    

    
    /**
     * 게시글 추천수 증가
     */
    void incrementLikeCount(@Param("boardId") Long boardId);
    
    /**
     * 게시글 추천수 감소
     */
    void decrementLikeCount(@Param("boardId") Long boardId);

    /**
     * 이전 게시글 조회
     */
    BoardDTO getPreviousBoard(@Param("boardId") Long boardId);

    /**
     * 다음 게시글 조회
     */
    BoardDTO getNextBoard(@Param("boardId") Long boardId);
    
    /**
     * 특정 회원이 작성한 게시글 목록 조회
     */
    List<BoardDTO> findBoardsByMemberId(@Param("memberId") Long memberId);

    /**
     * 회원 ID로 게시글 삭제 (회원 탈퇴 시 사용)
     */
    int deleteByMemberId(@Param("memberId") Long memberId);

}
````

## File: src/main/java/com/example/carelink/dao/FacilityMapper.java
````java
package com.example.carelink.dao;


import com.example.carelink.dto.FacilityDTO;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;

/**
 * 시설 관련 데이터 액세스 매퍼
 * 팀원 B 담당
 */
@Mapper
public interface FacilityMapper {

    /**
     * 시설 검색
     */
    List<FacilityDTO> searchFacilities(FacilityDTO searchDTO);

    /**
     * 시설 상세 정보 조회
     */
    FacilityDTO getFacilityById(@Param("facilityId") Long facilityId);

    /**
     * 전체 시설 목록 조회
     */
    List<FacilityDTO> getAllFacilities();

    /**
     * 활성화된 모든 시설 목록 조회 (리뷰 작성용)
     */
    List<FacilityDTO> getAllActiveFacilities();

    /**
     * 시설 등록
     */
    int insertFacility(FacilityDTO facilityDTO);

    /**
     * 시설 정보 수정
     */
    int updateFacility(FacilityDTO facilityDTO);

    /**
     * 시설 삭제
     */
    int deleteFacility(@Param("facilityId") Long facilityId);

    /**
     * 지역별 시설 개수 조회
     */
    int countFacilitiesByRegion(@Param("region") String region);

    /**
     * 전체 시설 수 조회 (통계용)
     */
    int getFacilityCount();

    /**
     * 회원 ID로 시설 삭제 (회원 탈퇴 시 사용)
     */
    int deleteByMemberId(@Param("memberId") Long memberId);

    /**
     * 회원 ID로 시설 목록 조회
     */
    List<FacilityDTO> getFacilitiesByMemberId(@Param("memberId") Long memberId);
    
    /**
     * 회원 ID로 시설 조회 (단일 조회 - 하위 호환성 유지)
     */
    FacilityDTO getFacilityByMemberId(@Param("memberId") Long memberId);
    
    /**
     * 시설 메인 이미지 정보 업데이트
     */
    int updateFacilityMainImage(@Param("facilityId") Long facilityId, 
                               @Param("mainImagePath") String mainImagePath, 
                               @Param("imageCount") Integer imageCount);

    // ================== 관리자용 메서드들 ==================

    /**
     * 승인 상태별 시설 목록 조회 (관리자용)
     */
    List<FacilityDTO> getFacilitiesByApprovalStatus(@Param("approvalStatus") String approvalStatus);

    /**
     * 시설 승인 상태 업데이트 (관리자용)
     */
    int updateFacilityApprovalStatus(@Param("facilityId") Long facilityId, 
                                   @Param("approvalStatus") String approvalStatus, 
                                   @Param("rejectionReason") String rejectionReason);

    /**
     * 승인 상태별 시설 수 조회 (관리자용)
     */
    int countFacilitiesByStatus(@Param("approvalStatus") String approvalStatus);
}
````

## File: src/main/java/com/example/carelink/dao/JobMapper.java
````java
package com.example.carelink.dao;

import com.example.carelink.dto.JobDTO;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;

/**
 * 구인구직 관련 데이터 액세스 매퍼
 * 팀원 C 담당
 */
@Mapper
public interface JobMapper {
    
    /**
     * 구인구직 목록 조회 (검색 포함) - 메인 검색 메서드
     */
    List<JobDTO> findJobsWithSearch(JobDTO searchDTO);
    
    /**
     * 기본 구인구직 목록 조회 (기존 호환성 유지)
     */
    List<JobDTO> getJobList(JobDTO searchDTO);
    
    /**
     * 구인구직 상세 정보 조회
     */
    JobDTO findJobById(@Param("jobId") Long jobId);
    
    /**
     * 구인구직 등록
     */
    int insertJob(JobDTO jobDTO);
    
    /**
     * 구인구직 수정
     */
    int updateJob(JobDTO jobDTO);
    
    /**
     * 구인구직 삭제
     */
    int deleteJob(@Param("jobId") Long jobId);
    
    /**
     * 인기 구인구직 목록 조회
     */
    List<JobDTO> getPopularJobs();
    
    /**
     * 구인구직 검색 (별칭)
     */
    List<JobDTO> searchJobs(JobDTO searchDTO);
    
    /**
     * 검색 조건에 따른 구인구직 총 개수 조회
     */
    int countJobsWithSearch(JobDTO searchDTO);

    /**
     * 전체 구인구직 수 조회 (통계용 - 검색 조건 없음)
     */
    int getJobCount();

    // --- applyCount 증가를 위한 메서드 추가 ---
    /**
     * 특정 구인구직 공고의 지원자 수 (applyCount)를 1 증가시킵니다.
     */
    void incrementApplyCount(@Param("jobId") Long jobId);
    
    /**
     * 특정 회원이 작성한 구인구직 게시글 목록 조회
     */
    List<JobDTO> findJobsByMemberId(@Param("memberId") Long memberId);

    /**
     * 회원 ID로 구인구직 게시글 삭제 (회원 탈퇴 시 사용)
     */
    int deleteByMemberId(@Param("memberId") Long memberId);

    /**
     * 시설 회원 ID로 구인구직 게시글 삭제 (시설 삭제 시 사용)
     */
    int deleteByFacilityMemberId(@Param("memberId") Long memberId);
}
````

## File: src/main/java/com/example/carelink/dto/BoardDTO.java
````java
package com.example.carelink.dto;

import com.example.carelink.common.BaseDTO;
import lombok.Data;
import lombok.EqualsAndHashCode;

import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;
import java.time.LocalDateTime;

/**
 * 정보 게시판 DTO
 * 팀원 D 담당: 정보 게시판 기능
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class BoardDTO extends BaseDTO {
    
    private Long boardId;           // 게시글 ID (자동증가)
    
    @NotBlank(message = "게시판 유형은 필수입니다")
    private String boardType;       // 게시판 유형 (NOTICE, INFO, QNA, FAQ)
    
    @NotBlank(message = "제목은 필수입니다")
    private String title;           // 제목
    
    @NotBlank(message = "내용은 필수입니다")
    private String content;         // 내용
    
    @NotNull(message = "작성자 정보는 필수입니다")
    private Long memberId;          // 작성자 ID
    private String memberName;      // 작성자 이름
    private String author;          // 작성자 표시명 (회원명 또는 닉네임)
    
    // 조회수 및 추천
    private Integer viewCount;      // 조회수
    private Integer likeCount;      // 추천수
    private Integer commentCount;   // 댓글수
    
    // 첨부파일
    private String attachmentPath;  // 첨부파일 경로
    private String attachmentName;  // 첨부파일 원본명
    private Long attachmentSize;    // 첨부파일 크기
    
    // 상태 관리
    private Boolean isNotice;        // 공지사항 여부
    private Boolean isSecret;        // 비밀글 여부
    private Boolean isActive;        // 활성 상태 (true: 활성, false: 비활성)
    private Boolean isDeleted;       // 삭제 여부 (true: 삭제됨, false: 활성)
    private String status;           // 상태 (ACTIVE, HIDDEN, DELETED)
    
    // 카테고리
    private String category;        // 카테고리
    private String subCategory;     // 서브 카테고리
    
    // 우선순위 (상단 고정용)
    private Integer priority = 1;    // 우선순위 (기본값 설정)
    private Boolean isPinned;        // 상단 고정 여부
    
    // 답글/댓글 관련
    private Long parentBoardId;      // 부모 게시글 ID (답글인 경우)
    private Integer replyDepth;      // 답글 깊이
    private Integer replyOrder;      // 답글 순서
    
    // Q&A 관련 (질문-답변 구조)
    private String qaType;           // Q&A 타입 (QUESTION: 질문, ANSWER: 답변)
    private Boolean isAnswered;      // 답변 완료 여부 (질문글인 경우)
    private Integer answerCount;     // 답변 수 (질문글인 경우)
    
    // 검색용 필드
    private String searchKeyword;    // 검색 키워드
    private String searchType;       // 검색 유형 (TITLE, CONTENT, AUTHOR, ALL)
    private String searchCategory;   // 검색 카테고리
    
    // 정렬용
    private String sortBy;           // 정렬 기준 (LATEST, VIEW_COUNT, LIKE_COUNT)
    private String sortOrder;        // 정렬 순서 (ASC, DESC)
    
    // 태그
    private String tags;             // 태그 (콤마로 구분)
    
    // SEO 관련
    private String metaDescription;  // 메타 설명
    private String metaKeywords;     // 메타 키워드
    
    // 페이징을 위한 필드 (BaseDTO와 일치하도록 Integer 타입 사용)
    private Integer page = 1;
    private Integer size = 10;
    private Integer offset = 0;
    
    private LocalDateTime createdAt;  // 생성일시
    private LocalDateTime updatedAt;  // 수정일시
    
    /**
     * 작성자 표시명 설정
     * memberName이 있으면 memberName을, 없으면 주어진 author 값을 사용
     */
    public void setAuthor(String author) {
        this.author = (this.memberName != null && !this.memberName.isEmpty()) ? this.memberName : author;
    }
    
    /**
     * 작성자 표시명 조회
     * memberName이 있으면 memberName을, 없으면 author 값을 반환
     */
    public String getAuthor() {
        return (this.memberName != null && !this.memberName.isEmpty()) ? this.memberName : this.author;
    }
    
    /**
     * 새 글 여부 확인 (24시간 이내 작성)
     */
    public boolean getIsNew() {
        if (this.getCreatedAt() == null) return false;
        return this.getCreatedAt().isAfter(java.time.LocalDateTime.now().minusDays(1));
    }
    
    /**
     * 인기 글 여부 확인 (조회수 100 이상 또는 추천수 10 이상)
     */
    public boolean getIsHot() {
        return (this.viewCount != null && this.viewCount >= 100) || 
               (this.likeCount != null && this.likeCount >= 10);
    }
    
    /**
     * 댓글이 있는지 확인
     */
    public boolean getHasComments() {
        return this.commentCount != null && this.commentCount > 0;
    }
    
}
````

## File: src/main/java/com/example/carelink/service/BoardService.java
````java
package com.example.carelink.service;

import com.example.carelink.common.PageInfo;
import com.example.carelink.dao.BoardMapper;
import com.example.carelink.dto.BoardDTO;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.Map;
import java.util.HashMap;

/**
 * 게시판 관련 비즈니스 로직 서비스
 * 팀원 D 담당
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class BoardService {
    
    private final BoardMapper boardMapper;
    
    private static final int DEFAULT_PAGE_SIZE = 10;
    
    /**
     * 게시글 목록 조회 (페이징)
     */
    public PageInfo<BoardDTO> getBoardList(int page, String keyword, String category) {
        log.info("게시글 목록 조회 시작 - page: {}, keyword: {}, category: {}", page, keyword, category);
        
        try {
            // 검색 조건 설정
            BoardDTO searchDTO = new BoardDTO();
            searchDTO.setPage(page);
            searchDTO.setSize(DEFAULT_PAGE_SIZE);
            searchDTO.setOffset((page - 1) * DEFAULT_PAGE_SIZE);
            
            if (keyword != null && !keyword.trim().isEmpty()) {
                searchDTO.setSearchKeyword(keyword.trim());
            }
            if (category != null && !category.trim().isEmpty() && !"all".equals(category)) {
                searchDTO.setCategory(category.trim());
            }
            
            log.info("검색 조건 - searchDTO: page={}, size={}, offset={}, keyword={}, category={}", 
                searchDTO.getPage(), searchDTO.getSize(), searchDTO.getOffset(), 
                searchDTO.getSearchKeyword(), searchDTO.getCategory());
            
            // 전체 게시글 수 조회
            int totalCount = boardMapper.getBoardCount(searchDTO);
            log.info("전체 게시글 수: {}", totalCount);
            
            // 게시글 목록 조회
            List<BoardDTO> boardList = boardMapper.getBoardList(searchDTO);
            log.info("조회된 게시글 수: {}", boardList != null ? boardList.size() : 0);
            
            if (boardList != null && !boardList.isEmpty()) {
                log.info("첫 번째 게시글 정보 - ID: {}, 제목: {}, 작성자: {}, is_active: {}, is_deleted: {}", 
                    boardList.get(0).getBoardId(), 
                    boardList.get(0).getTitle(), 
                    boardList.get(0).getMemberName(),
                    boardList.get(0).getIsActive(),
                    boardList.get(0).getIsDeleted());
            } else {
                log.warn("조회된 게시글이 없습니다.");
            }
            
            // 페이징 정보 생성
            PageInfo<BoardDTO> pageInfo = new PageInfo<>(boardList, page, DEFAULT_PAGE_SIZE, totalCount);
            log.info("페이징 정보 - 현재페이지: {}, 전체페이지: {}, 전체건수: {}", 
                pageInfo.getCurrentPage(), pageInfo.getTotalPages(), pageInfo.getTotalCount());
            
            return pageInfo;
        } catch (Exception e) {
            log.error("게시글 목록 조회 중 오류 발생", e);
            throw new RuntimeException("게시글 목록을 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 게시글 상세 정보 조회
     */
    @Transactional
    public BoardDTO getBoardById(Long id) {
        log.info("게시글 상세 조회 시작 - boardId: {}", id);
        
        try {
            BoardDTO board = boardMapper.getBoardById(id);
            if (board == null) {
                throw new RuntimeException("해당 게시글을 찾을 수 없습니다. ID: " + id);
            }
            
            log.info("게시글 상세 조회 완료 - boardId: {}, title: {}", id, board.getTitle());
            return board;
        } catch (Exception e) {
            log.error("게시글 상세 조회 중 오류 발생 - boardId: {}", id, e);
            throw new RuntimeException("게시글 상세 정보를 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 게시글 상세 조회 (삭제된 것 포함)
     */
    public BoardDTO getBoardByIdIncludeDeleted(Long id) {
        log.info("게시글 상세 조회 (삭제 포함) 시작 - boardId: {}", id);
        
        try {
            BoardDTO board = boardMapper.getBoardByIdIncludeDeleted(id);
            if (board != null) {
                log.info("📄 게시글 조회 성공 (삭제 포함) - boardId: {}, title: {}", id, board.getTitle());
                log.info("   🔍 DB에서 조회된 isDeleted 원본값: {}", board.getIsDeleted());
                log.info("   🔍 isDeleted null 체크: {}", board.getIsDeleted() == null ? "NULL" : "NOT NULL");
                if (board.getIsDeleted() != null) {
                    log.info("   🔍 isDeleted boolean 값: {} ({})", board.getIsDeleted(), 
                        board.getIsDeleted() ? "삭제됨" : "정상");
                }
            } else {
                log.warn("존재하지 않는 게시글 조회 시도 (삭제 포함) - boardId: {}", id);
            }
            return board;
        } catch (Exception e) {
            log.error("게시글 상세 조회 (삭제 포함) 중 오류 발생 - boardId: {}", id, e);
            throw new RuntimeException("게시글을 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 게시글 등록
     */
    @Transactional
    public int insertBoard(BoardDTO boardDTO) {
        log.info("게시글 등록 시작 - title: {}, memberId: {}", boardDTO.getTitle(), boardDTO.getMemberId());
        
        try {
            // 필수 값 검증
            validateBoardData(boardDTO);
            
            // 기본값 설정
            if (boardDTO.getStatus() == null) {
                boardDTO.setStatus("ACTIVE");
            }
            
            // priority 기본값 설정 (null이면 기본값 0)
            if (boardDTO.getPriority() == null) {
                boardDTO.setPriority(0);
            }
            
            // 댓글 관련 필드 기본값 설정
            if (boardDTO.getReplyDepth() == null) {
                boardDTO.setReplyDepth(0);
            }
            if (boardDTO.getReplyOrder() == null) {
                boardDTO.setReplyOrder(0);
            }
            
            // Boolean 필드 기본값 설정
            if (boardDTO.getIsNotice() == null) {
                boardDTO.setIsNotice(false);
            }
            if (boardDTO.getIsSecret() == null) {
                boardDTO.setIsSecret(false);
            }
            if (boardDTO.getIsActive() == null) {
                boardDTO.setIsActive(true);  // 활성 상태로 기본 설정
            }
            if (boardDTO.getIsDeleted() == null) {
                boardDTO.setIsDeleted(false);
            }
            if (boardDTO.getIsPinned() == null) {
                boardDTO.setIsPinned(false);
            }
            
            // 카테고리에 따라 공지사항 여부 설정
            if (boardDTO.getCategory() != null && "NOTICE".equals(boardDTO.getCategory())) {
                boardDTO.setIsNotice(true);
            }
            
            if (boardDTO.getBoardType() == null) {
                // 카테고리에 따라 boardType 설정
                String category = boardDTO.getCategory();
                if ("NOTICE".equals(category)) {
                    boardDTO.setBoardType("NOTICE");
                } else if ("INFO".equals(category)) {
                    boardDTO.setBoardType("INFO");
                } else if ("QNA".equals(category)) {
                    boardDTO.setBoardType("QNA");
                } else if ("FAQ".equals(category)) {
                    boardDTO.setBoardType("FAQ");
                } else {
                    boardDTO.setBoardType("GENERAL");
                }
            }
            
            // 등록 전 상태 로그
            log.info("📝 등록 전 상태 확인 - isDeleted: {}, isActive: {}", 
                boardDTO.getIsDeleted(), boardDTO.getIsActive());
            
            int result = boardMapper.insertBoard(boardDTO);
            log.info("✅ 게시글 등록 완료 - boardId: {}", boardDTO.getBoardId());
            
            // 등록 직후 DB에서 다시 조회해서 확인
            if (boardDTO.getBoardId() != null) {
                BoardDTO savedBoard = boardMapper.getBoardByIdIncludeDeleted(boardDTO.getBoardId());
                if (savedBoard != null) {
                    log.info("🔍 등록 직후 DB 상태 확인 - boardId: {}, isDeleted: {}, isActive: {}", 
                        savedBoard.getBoardId(), savedBoard.getIsDeleted(), savedBoard.getIsActive());
                } else {
                    log.warn("⚠️ 등록 직후 게시글을 찾을 수 없습니다. boardId: {}", boardDTO.getBoardId());
                }
            }
            
            return result;
        } catch (Exception e) {
            log.error("게시글 등록 중 오류 발생", e);
            throw new RuntimeException("게시글 등록 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 게시글 수정
     */
    @Transactional
    public int updateBoard(BoardDTO boardDTO) {
        log.info("게시글 수정 시작 - boardId: {}, title: {}", boardDTO.getBoardId(), boardDTO.getTitle());
        
        try {
            // 게시글 존재 확인 (삭제된 것 포함)
            BoardDTO existingBoard = boardMapper.getBoardByIdIncludeDeleted(boardDTO.getBoardId());
            if (existingBoard == null) {
                throw new RuntimeException("수정할 게시글을 찾을 수 없습니다. ID: " + boardDTO.getBoardId());
            }
            
            // 필수 값 검증 및 기본값 설정
            validateBoardData(boardDTO);
            if (boardDTO.getPriority() == null) {
                boardDTO.setPriority(1); // 기본 우선순위
            }
            
            int result = boardMapper.updateBoard(boardDTO);
            log.info("게시글 수정 완료 - boardId: {}", boardDTO.getBoardId());
            
            return result;
        } catch (Exception e) {
            log.error("게시글 수정 중 오류 발생 - boardId: {}", boardDTO.getBoardId(), e);
            throw new RuntimeException("게시글 수정 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 게시글 삭제 (논리적 삭제)
     */
    @Transactional
    public Map<String, Object> deleteBoard(Long id) {
        log.info("게시글 삭제 시작 - boardId: {}", id);
        
        Map<String, Object> result = new HashMap<>();
        
        try {
            // 게시글 존재 확인 (삭제된 것 포함하여 조회)
            BoardDTO existingBoard = boardMapper.getBoardByIdIncludeDeleted(id);
            if (existingBoard == null) {
                log.warn("삭제 요청된 게시글을 찾을 수 없습니다. ID: {}", id);
                result.put("success", false);
                result.put("code", "NOT_FOUND");
                result.put("message", "게시글을 찾을 수 없습니다.");
                return result;
            }
            
            // 디버깅: 현재 게시글 상태 상세 로그
            log.info("🔍 게시글 상태 확인 - boardId: {}", id);
            log.info("   - title: {}", existingBoard.getTitle());
            log.info("   - isDeleted 값: {}", existingBoard.getIsDeleted());
            log.info("   - isDeleted 타입: {}", existingBoard.getIsDeleted() != null ? existingBoard.getIsDeleted().getClass().getSimpleName() : "null");
            
            // 삭제 상태 상세 분석
            log.info("🔍 삭제 상태 상세 분석:");
            log.info("   - isDeleted 원본값: {}", existingBoard.getIsDeleted());
            log.info("   - isDeleted == null: {}", existingBoard.getIsDeleted() == null);
            log.info("   - isDeleted != null: {}", existingBoard.getIsDeleted() != null);
            if (existingBoard.getIsDeleted() != null) {
                log.info("   - isDeleted.booleanValue(): {}", existingBoard.getIsDeleted().booleanValue());
                log.info("   - Boolean.TRUE.equals(isDeleted): {}", Boolean.TRUE.equals(existingBoard.getIsDeleted()));
            }
            
            // 이미 삭제된 게시글인지 확인
            boolean isAlreadyDeleted = existingBoard.getIsDeleted() != null && existingBoard.getIsDeleted();
            log.info("🔍 최종 삭제 판정: {}", isAlreadyDeleted);
            
            if (isAlreadyDeleted) {
                log.info("❌ 이미 삭제된 게시글입니다. boardId: {}, isDeleted: {}", id, existingBoard.getIsDeleted());
                result.put("success", false);
                result.put("code", "ALREADY_DELETED");
                result.put("message", "이미 삭제된 게시글입니다.");
                return result;
            }
            
            log.info("✅ 삭제 가능한 게시글입니다. boardId: {}, isDeleted: {}", id, existingBoard.getIsDeleted());
            
            // 삭제 실행
            int deleteResult = boardMapper.deleteBoard(id);
            if (deleteResult > 0) {
                log.info("게시글 삭제 완료 - boardId: {}, 영향받은 행: {}", id, deleteResult);
                result.put("success", true);
                result.put("code", "DELETED");
                result.put("message", "게시글이 삭제되었습니다.");
            } else {
                log.warn("게시글 삭제 실패 - boardId: {}, 영향받은 행: {}", id, deleteResult);
                result.put("success", false);
                result.put("code", "DELETE_FAILED");
                result.put("message", "게시글 삭제에 실패했습니다.");
            }
            
            return result;
        } catch (Exception e) {
            log.error("게시글 삭제 중 오류 발생 - boardId: {}", id, e);
            result.put("success", false);
            result.put("code", "ERROR");
            result.put("message", "게시글 삭제 중 오류가 발생했습니다: " + e.getMessage());
            return result;
        }
    }
    
    /**
     * 조회수 증가
     */
    @Transactional
    public void incrementViewCount(Long id) {
        log.info("조회수 증가 시작 - boardId: {}", id);
        
        try {
            boardMapper.incrementViewCount(id);
            log.info("조회수 증가 완료 - boardId: {}", id);
        } catch (Exception e) {
            log.warn("조회수 증가 중 오류 발생 - boardId: {} (무시하고 진행)", id, e);
            // 조회수 증가 실패는 치명적이지 않으므로 예외를 던지지 않음
        }
    }
    
    /**
     * 인기 게시글 목록 조회
     */
    public List<BoardDTO> getPopularBoards() {
        log.info("인기 게시글 목록 조회 시작");
        
        try {
            List<BoardDTO> popularBoards = boardMapper.getPopularBoards();
            log.info("인기 게시글 목록 조회 완료 - 조회된 건수: {}", popularBoards.size());
            
            return popularBoards;
        } catch (Exception e) {
            log.error("인기 게시글 목록 조회 중 오류 발생", e);
            throw new RuntimeException("인기 게시글을 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 카테고리별 게시글 목록 조회
     */
    public List<BoardDTO> getBoardsByCategory(String category) {
        log.info("카테고리별 게시글 목록 조회 시작 - category: {}", category);
        
        try {
            List<BoardDTO> boards = boardMapper.getBoardsByCategory(category);
            log.info("카테고리별 게시글 목록 조회 완료 - category: {}, 조회된 건수: {}", category, boards.size());
            
            return boards;
        } catch (Exception e) {
            log.error("카테고리별 게시글 목록 조회 중 오류 발생 - category: {}", category, e);
            throw new RuntimeException("카테고리별 게시글을 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 공지사항 목록 조회
     */
    public List<BoardDTO> getNoticeBoards() {
        log.info("공지사항 목록 조회 시작");
        
        try {
            BoardDTO searchDTO = new BoardDTO();
            searchDTO.setCategory("NOTICE");
            searchDTO.setSize(5); // 최신 5개만
            searchDTO.setPage(1); // 1페이지부터 시작
            
            List<BoardDTO> notices = boardMapper.getBoardList(searchDTO);
            log.info("공지사항 목록 조회 완료 - 조회된 건수: {}", notices.size());
            
            return notices;
        } catch (Exception e) {
            log.error("공지사항 목록 조회 중 오류 발생", e);
            throw new RuntimeException("공지사항을 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 게시글 데이터 유효성 검증
     */
    private void validateBoardData(BoardDTO boardDTO) {
        if (boardDTO.getMemberId() == null) {
            throw new IllegalArgumentException("작성자 ID는 필수입니다.");
        }
        if (boardDTO.getTitle() == null || boardDTO.getTitle().trim().isEmpty()) {
            throw new IllegalArgumentException("게시글 제목은 필수입니다.");
        }
        if (boardDTO.getContent() == null || boardDTO.getContent().trim().isEmpty()) {
            throw new IllegalArgumentException("게시글 내용은 필수입니다.");
        }
        if (boardDTO.getTitle().length() > 200) {
            throw new IllegalArgumentException("게시글 제목은 200자를 초과할 수 없습니다.");
        }
    }
    
    /**
     * 카테고리별 인기 게시글 목록 조회
     */
    public List<BoardDTO> getPopularBoardsByCategory(String category) {
        log.info("카테고리별 인기 게시글 목록 조회 시작 - category: {}", category);
        
        try {
            List<BoardDTO> popularBoards;
            if (category == null || category.trim().isEmpty()) {
                popularBoards = boardMapper.getPopularBoards();
            } else {
                popularBoards = boardMapper.getPopularBoardsByCategory(category);
            }
            log.info("카테고리별 인기 게시글 목록 조회 완료 - 조회된 건수: {}", popularBoards.size());
            
            return popularBoards;
        } catch (Exception e) {
            log.error("카테고리별 인기 게시글 목록 조회 중 오류 발생", e);
            throw new RuntimeException("인기 게시글을 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 이전 게시글 조회
     */
    public BoardDTO getPreviousBoard(Long currentId) {
        log.info("이전 게시글 조회 시작 - currentId: {}", currentId);
        
        try {
            BoardDTO prevBoard = boardMapper.getPreviousBoard(currentId);
            log.info("이전 게시글 조회 완료 - prevBoardId: {}", prevBoard != null ? prevBoard.getBoardId() : "없음");
            
            return prevBoard;
        } catch (Exception e) {
            log.error("이전 게시글 조회 중 오류 발생", e);
            return null; // 이전 게시글이 없거나 오류가 발생한 경우 null 반환
        }
    }
    
    /**
     * 다음 게시글 조회
     */
    public BoardDTO getNextBoard(Long currentId) {
        log.info("다음 게시글 조회 시작 - currentId: {}", currentId);
        
        try {
            BoardDTO nextBoard = boardMapper.getNextBoard(currentId);
            log.info("다음 게시글 조회 완료 - nextBoardId: {}", nextBoard != null ? nextBoard.getBoardId() : "없음");
            
            return nextBoard;
        } catch (Exception e) {
            log.error("다음 게시글 조회 중 오류 발생", e);
            return null; // 다음 게시글이 없거나 오류가 발생한 경우 null 반환
        }
    }
    
    /**
     * 게시글 추천수 증가
     */
    @Transactional
    public void incrementLikeCount(Long id) {
        log.info("게시글 추천수 증가 시작 - boardId: {}", id);
        
        try {
            boardMapper.incrementLikeCount(id);
            log.info("게시글 추천수 증가 완료 - boardId: {}", id);
        } catch (Exception e) {
            log.error("게시글 추천수 증가 중 오류 발생 - boardId: {}", id, e);
            throw new RuntimeException("추천 처리 중 오류가 발생했습니다.", e);
        }
    }

    /**
     * 게시글 추천수 감소
     */
    @Transactional
    public void decrementLikeCount(Long id) {
        log.info("게시글 추천수 감소 시작 - boardId: {}", id);
        
        try {
            boardMapper.decrementLikeCount(id);
            log.info("게시글 추천수 감소 완료 - boardId: {}", id);
        } catch (Exception e) {
            log.error("게시글 추천수 감소 중 오류 발생 - boardId: {}", id, e);
            throw new RuntimeException("추천 취소 처리 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 전체 게시글 수 조회 (홈페이지 통계용)
     */
    public int getBoardCount() {
        log.info("전체 게시글 수 조회 시작");
        
        try {
            BoardDTO searchDTO = new BoardDTO();
            int count = boardMapper.getBoardCount(searchDTO);
            log.info("전체 게시글 수 조회 완료 - 총 {}건", count);
            
            return count;
        } catch (Exception e) {
            log.error("전체 게시글 수 조회 중 오류 발생", e);
            return 0; // 오류 시 0 반환
        }
    }
    

}
````

## File: src/main/resources/mapper/boardMapper.xml
````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.carelink.dao.BoardMapper">

    <!-- ResultMap 정의 -->
    <resultMap id="boardResultMap" type="com.example.carelink.dto.BoardDTO">
        <id property="boardId" column="board_id"/>
        <result property="boardType" column="board_type"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="memberId" column="member_id"/>
        <result property="memberName" column="member_name"/>
        <result property="viewCount" column="view_count"/>
        <result property="likeCount" column="like_count"/>
        <result property="commentCount" column="comment_count"/>
        <result property="attachmentPath" column="attachment_path"/>
        <result property="attachmentName" column="attachment_name"/>
        <result property="attachmentSize" column="attachment_size"/>
        <result property="isNotice" column="is_notice"/>
        <result property="isSecret" column="is_secret"/>
        <result property="isDeleted" column="is_deleted"/>
        <result property="status" column="status"/>
        <result property="category" column="category"/>
        <result property="subCategory" column="sub_category"/>
        <result property="priority" column="priority"/>
        <result property="isPinned" column="is_pinned"/>
        <result property="parentBoardId" column="parent_board_id"/>
        <result property="replyDepth" column="reply_depth"/>
        <result property="replyOrder" column="reply_order"/>
        <result property="tags" column="tags"/>
        <result property="metaDescription" column="meta_description"/>
        <result property="metaKeywords" column="meta_keywords"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <!-- 게시글 목록 조회 -->
    <select id="getBoardList" parameterType="com.example.carelink.dto.BoardDTO" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.board_type,
            b.title,
            b.content,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.is_notice,
            b.is_secret,
            COALESCE(b.is_active, true) as is_active,
            COALESCE(b.is_deleted, false) as is_deleted,
            b.status,
            b.category,
            b.sub_category,
            b.priority,
            b.is_pinned,
            b.tags,
            b.created_at,
            b.updated_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            <if test="searchKeyword != null and searchKeyword != ''">
                AND (b.title LIKE CONCAT('%', #{searchKeyword}, '%') OR b.content LIKE CONCAT('%', #{searchKeyword}, '%'))
            </if>
            <if test="category != null and category != ''">
                AND b.category = #{category}
            </if>
        ORDER BY
            b.is_notice DESC,
            b.created_at DESC
        LIMIT #{size} OFFSET #{offset}
    </select>

    <!-- 게시글 수 조회 -->
    <select id="getBoardCount" parameterType="com.example.carelink.dto.BoardDTO" resultType="int">
        SELECT COUNT(*)
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            <if test="searchKeyword != null and searchKeyword != ''">
                AND (b.title LIKE CONCAT('%', #{searchKeyword}, '%') OR b.content LIKE CONCAT('%', #{searchKeyword}, '%'))
            </if>
            <if test="category != null and category != ''">
                AND b.category = #{category}
            </if>
    </select>

    <!-- 게시글 상세 조회 -->
    <select id="getBoardById" parameterType="long" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.board_type,
            b.title,
            b.content,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.attachment_path,
            b.attachment_name,
            b.attachment_size,
            b.is_notice,
            b.is_secret,
            COALESCE(b.is_active, true) as is_active,
            COALESCE(b.is_deleted, false) as is_deleted,
            b.status,
            b.category,
            b.sub_category,
            b.priority,
            b.is_pinned,
            b.parent_board_id,
            b.reply_depth,
            b.reply_order,
            b.tags,
            b.meta_description,
            b.meta_keywords,
            b.created_at,
            b.updated_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            b.board_id = #{boardId}
            AND COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
    </select>

    <!-- 게시글 상세 조회 (삭제된 것 포함) -->
    <select id="getBoardByIdIncludeDeleted" parameterType="long" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.board_type,
            b.title,
            b.content,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.attachment_path,
            b.attachment_name,
            b.attachment_size,
            b.is_notice,
            b.is_secret,
            COALESCE(b.is_active, true) as is_active,
            COALESCE(b.is_deleted, false) as is_deleted,
            b.status,
            b.category,
            b.sub_category,
            b.priority,
            b.is_pinned,
            b.parent_board_id,
            b.reply_depth,
            b.reply_order,
            b.tags,
            b.meta_description,
            b.meta_keywords,
            b.created_at,
            b.updated_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            b.board_id = #{boardId}
    </select>

    <!-- 게시글 등록 -->
    <insert id="insertBoard" parameterType="com.example.carelink.dto.BoardDTO" useGeneratedKeys="true" keyProperty="boardId">
        INSERT INTO board (
            board_type,
            title,
            content,
            member_id,
            attachment_path,
            attachment_name,
            attachment_size,
            is_notice,
            is_secret,
            is_active,
            is_deleted,
            category,
            sub_category,
            priority,
            is_pinned,
            parent_board_id,
            reply_depth,
            reply_order,
            tags,
            meta_description,
            meta_keywords,
            created_at,
            updated_at
        ) VALUES (
            #{boardType},
            #{title},
            #{content},
            #{memberId},
            #{attachmentPath},
            #{attachmentName},
            #{attachmentSize},
            #{isNotice},
            #{isSecret},
            #{isActive},
            #{isDeleted},
            #{category},
            #{subCategory},
            COALESCE(#{priority}, 1),
            #{isPinned},
            #{parentBoardId},
            #{replyDepth},
            #{replyOrder},
            #{tags},
            #{metaDescription},
            #{metaKeywords},
            NOW(),
            NOW()
        )
    </insert>

    <!-- 게시글 수정 -->
    <update id="updateBoard" parameterType="com.example.carelink.dto.BoardDTO">
        UPDATE board
        SET
            board_type = #{boardType},
            title = #{title},
            content = #{content},
            attachment_path = #{attachmentPath},
            attachment_name = #{attachmentName},
            attachment_size = #{attachmentSize},
            is_notice = #{isNotice},
            is_secret = #{isSecret},
            category = #{category},
            sub_category = #{subCategory},
            priority = COALESCE(#{priority}, 1),
            is_pinned = #{isPinned},
            tags = #{tags},
            meta_description = #{metaDescription},
            meta_keywords = #{metaKeywords},
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
    </update>

    <!-- 게시글 삭제 (논리적 삭제) -->
    <update id="deleteBoard" parameterType="long">
        UPDATE board
        SET
            is_deleted = true,
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
            AND COALESCE(is_deleted, false) = false
    </update>



    <!-- 조회수 증가 -->
    <update id="incrementViewCount" parameterType="long">
        UPDATE board
        SET
            view_count = view_count + 1,
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
            AND COALESCE(is_active, true) = true
            AND COALESCE(is_deleted, false) = false
    </update>
    
    <!-- 조회수 증가 (별칭) -->
    <update id="increaseViewCount" parameterType="long">
        UPDATE board
        SET
            view_count = view_count + 1,
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
            AND COALESCE(is_active, true) = true
            AND COALESCE(is_deleted, false) = false
    </update>

    <!-- 인기 게시글 목록 조회 -->
    <select id="getPopularBoards" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.title,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.category,
            b.is_notice,
            b.is_pinned,
            b.created_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            AND b.created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)
        ORDER BY
            (b.view_count * 0.4 + b.like_count * 0.4 + b.comment_count * 0.2) DESC
        LIMIT 5
    </select>

    <!-- 카테고리별 게시글 목록 조회 -->
    <select id="getBoardsByCategory" parameterType="string" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.title,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.category,
            b.is_notice,
            b.is_pinned,
            b.created_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            AND b.category = #{category}
        ORDER BY
            b.created_at DESC
        LIMIT 10
    </select>

    <!-- 카테고리별 인기 게시글 목록 조회 -->
    <select id="getPopularBoardsByCategory" parameterType="string" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.title,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.category,
            b.is_notice,
            b.is_pinned,
            b.created_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            AND b.created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)
            <if test="category != null and category != ''">
                AND b.category = #{category}
            </if>
        ORDER BY
            (b.view_count * 0.4 + b.like_count * 0.4 + b.comment_count * 0.2) DESC
        LIMIT 5
    </select>
    
    <!-- 이전 게시글 조회 -->
    <select id="getPreviousBoard" parameterType="long" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.title
        FROM
            board b
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            AND b.board_id &lt; #{boardId}
        ORDER BY
            b.board_id DESC
        LIMIT 1
    </select>
    
    <!-- 다음 게시글 조회 -->
    <select id="getNextBoard" parameterType="long" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.title
        FROM
            board b
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            AND b.board_id &gt; #{boardId}
        ORDER BY
            b.board_id ASC
        LIMIT 1
    </select>
    
    <!-- 게시글 추천수 증가 -->
    <update id="incrementLikeCount" parameterType="long">
        UPDATE board
        SET
            like_count = like_count + 1,
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
            AND COALESCE(is_active, true) = true
            AND COALESCE(is_deleted, false) = false
    </update>
    
    <!-- 게시글 추천수 감소 -->
    <update id="decrementLikeCount" parameterType="long">
        UPDATE board
        SET
            like_count = GREATEST(0, like_count - 1),
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
            AND COALESCE(is_active, true) = true
            AND COALESCE(is_deleted, false) = false
    </update>
    
    <!-- 특정 회원이 작성한 게시글 목록 조회 -->
    <select id="findBoardsByMemberId" resultMap="boardResultMap">
        SELECT b.*, m.name as author_name
        FROM board b
        LEFT JOIN member m ON b.member_id = m.member_id
        WHERE b.member_id = #{memberId}
          AND b.is_deleted = false
        ORDER BY b.created_at DESC
    </select>

    <!-- 회원 ID로 게시글 삭제 (회원 탈퇴 시 사용) -->
    <delete id="deleteByMemberId" parameterType="long">
        DELETE FROM board WHERE member_id = #{memberId}
    </delete>

</mapper>
````

## File: src/main/resources/templates/board/write.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title th:text="${pageTitle + ' - CareLink'}">게시글 작성 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>

    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <div class="container mt-4">
            <!-- 페이지 제목 (동적) -->
            <div class="row mb-4">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">홈</a></li>
                            <li class="breadcrumb-item"><a href="/board">정보마당</a></li>
                            <li class="breadcrumb-item">
                                <a th:href="@{/board(type=${type})}" th:text="${boardTitle}">게시판</a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">글 작성</li>
                        </ol>
                    </nav>
                    <h2>
                        <i class="fas fa-edit text-primary me-2"></i> 
                        <span th:text="${boardTitle + ' 작성'}">게시글 작성</span>
                    </h2>
                    <p class="text-muted">유용한 정보를 다른 사용자들과 공유해보세요.</p>
                </div>
            </div>
            
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <form th:action="@{/board/write}" method="post" th:object="${boardDTO}">
                        <!-- 게시판 타입 유지를 위한 hidden 필드 -->
                        <input type="hidden" name="type" th:value="${type}">
                        
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">
                                    <i class="fas fa-pen me-2"></i>
                                    <span th:text="${boardTitle + ' 작성'}">새 게시글 작성</span>
                                </h5>
                            </div>
                            <div class="card-body">
                                <!-- 카테고리 선택 -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">카테고리 <span class="text-danger">*</span></label>
                                        <select class="form-select" th:field="*{category}" required>
                                            <option value="" th:if="${type == 'all'}">카테고리를 선택해주세요</option>
                                            <option value="NOTICE" th:selected="${type == 'notice'}" th:if="${type == 'all' or type == 'notice'}">공지사항</option>
                                            <option value="INFO" th:selected="${type == 'info'}" th:if="${type == 'all' or type == 'info'}">정보공유</option>
                                            <option value="QNA" th:selected="${type == 'qna'}" th:if="${type == 'all' or type == 'qna'}">Q&A</option>
                                            <option value="FAQ" th:selected="${type == 'faq'}" th:if="${type == 'all' or type == 'faq'}">자주묻는질문</option>
                                            <option value="TIP" th:if="${type == 'all'}">팁&노하우</option>
                                            <option value="NEWS" th:if="${type == 'all'}">뉴스</option>
                                            <option value="FREE" th:if="${type == 'all'}">자유게시판</option>
                                        </select>
                                        <div class="form-text">
                                            현재 게시판: <strong th:text="${boardTitle}">게시판</strong>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">게시글 설정</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" th:field="*{isNotice}" id="isNotice">
                                            <label class="form-check-label" for="isNotice">
                                                공지사항으로 등록
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" th:field="*{isPinned}" id="isPinned">
                                            <label class="form-check-label" for="isPinned">
                                                상단 고정
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- 제목 -->
                                <div class="mb-3">
                                    <label class="form-label">제목 <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" th:field="*{title}" 
                                           placeholder="제목을 입력해주세요" required maxlength="100">
                                    <div class="form-text">
                                        최대 100자까지 입력 가능합니다.
                                        <small class="float-end">
                                            <span id="titleLength">0</span>/100자
                                        </small>
                                    </div>
                                </div>

                                <!-- 내용 -->
                                <div class="mb-4">
                                    <label class="form-label">내용 <span class="text-danger">*</span></label>
                                    <textarea class="form-control" id="content" rows="15" th:field="*{content}" 
                                              placeholder="내용을 입력해주세요" required minlength="20"
                                              data-rich-editor='{"height": "400px"}'></textarea>
                                    <div class="form-text">
                                        최소 20자 이상 작성해주세요. 리치 텍스트 에디터로 이미지, 테이블, 링크 등을 추가할 수 있습니다.
                                        <small class="float-end">
                                            <span id="contentLength">0</span>자
                                        </small>
                                    </div>
                                </div>

                                <!-- 태그 -->
                                <div class="mb-4">
                                    <label class="form-label">태그</label>
                                    <input type="text" class="form-control" th:field="*{tags}" 
                                           placeholder="태그를 입력해주세요 (예: 요양원, 간병, 보험)">
                                    <div class="form-text">쉼표(,)로 구분하여 입력해주세요. 최대 5개까지 추가 가능합니다.</div>
                                </div>

                                <!-- 버튼 -->
                                <div class="d-flex justify-content-between">
                                    <a th:href="@{/board(type=${type})}" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left me-1"></i> 취소
                                    </a>
                                    <div>
                                        <button type="button" class="btn btn-outline-primary me-2" onclick="saveDraft()">
                                            <i class="fas fa-save me-1"></i> 임시저장
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary me-2" onclick="previewBoard()">
                                            <i class="fas fa-eye me-1"></i> 미리보기
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-paper-plane me-1"></i> 등록하기
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>

                    <!-- 작성 가이드 -->
                    <div class="card mt-4">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i> 게시글 작성 가이드</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-success"><i class="fas fa-check-circle me-1"></i> 권장사항</h6>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-check text-success me-2"></i> 다른 사용자에게 도움이 되는 정보를 공유해주세요</li>
                                        <li><i class="fas fa-check text-success me-2"></i> 명확하고 이해하기 쉽게 작성해주세요</li>
                                        <li><i class="fas fa-check text-success me-2"></i> 관련 태그를 추가하여 검색이 용이하도록 해주세요</li>
                                        <li><i class="fas fa-check text-success me-2"></i> 적절한 카테고리를 선택해주세요</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-danger"><i class="fas fa-exclamation-triangle me-1"></i> 주의사항</h6>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-times text-danger me-2"></i> 개인정보나 민감한 정보는 포함하지 마세요</li>
                                        <li><i class="fas fa-times text-danger me-2"></i> 광고성 글이나 스팸은 금지됩니다</li>
                                        <li><i class="fas fa-times text-danger me-2"></i> 욕설이나 비방은 삼가해주세요</li>
                                        <li><i class="fas fa-times text-danger me-2"></i> 저작권을 침해하는 내용은 금지됩니다</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 푸터 -->
    <footer th:replace="~{layout/footer :: footer}"></footer>
    
    <!-- JavaScript -->
    <div th:replace="~{layout/footer :: scripts}"></div>

    <script>
        // 문자 수 카운팅
        document.addEventListener('DOMContentLoaded', function() {
            const titleInput = document.querySelector('input[name="title"]');
            const contentTextarea = document.querySelector('textarea[name="content"]');
            const titleLength = document.getElementById('titleLength');
            const contentLength = document.getElementById('contentLength');
            
            // 제목 글자 수 카운팅
            titleInput.addEventListener('input', function() {
                titleLength.textContent = this.value.length;
                if (this.value.length > 100) {
                    titleLength.style.color = 'red';
                } else {
                    titleLength.style.color = '';
                }
            });
            
            // 내용 글자 수 카운팅
            contentTextarea.addEventListener('input', function() {
                contentLength.textContent = this.value.length;
                if (this.value.length < 20) {
                    contentLength.style.color = 'red';
                } else {
                    contentLength.style.color = 'green';
                }
            });
            
            // 폼 유효성 검사
            const form = document.querySelector('form');
            form.addEventListener('submit', function(e) {
                const title = titleInput.value.trim();
                const content = contentTextarea.value.trim();
                const category = document.querySelector('select[name="category"]').value;
                
                if (!category) {
                    e.preventDefault();
                    alert('카테고리를 선택해주세요.');
                    return false;
                }
                
                if (title.length === 0) {
                    e.preventDefault();
                    alert('제목을 입력해주세요.');
                    titleInput.focus();
                    return false;
                }
                
                if (title.length > 100) {
                    e.preventDefault();
                    alert('제목은 100자 이하로 입력해주세요.');
                    titleInput.focus();
                    return false;
                }
                
                if (content.length < 20) {
                    e.preventDefault();
                    alert('내용을 최소 20자 이상 입력해주세요.');
                    contentTextarea.focus();
                    return false;
                }
            });
        });

        // 임시저장 기능
        function saveDraft() {
            const title = document.querySelector('input[name="title"]').value;
            const content = document.querySelector('textarea[name="content"]').value;
            
            if (title.trim() === '' && content.trim() === '') {
                alert('제목 또는 내용을 입력한 후 임시저장해주세요.');
                return;
            }
            
            // localStorage에 임시저장
            const draftData = {
                title: title,
                content: content,
                category: document.querySelector('select[name="category"]').value,
                tags: document.querySelector('input[name="tags"]').value,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('boardDraft', JSON.stringify(draftData));
            alert('임시저장되었습니다.');
        }
        
        // 미리보기 기능
        function previewBoard() {
            const title = document.querySelector('input[name="title"]').value;
            const content = document.querySelector('textarea[name="content"]').value;
            
            if (title.trim() === '' || content.trim() === '') {
                alert('제목과 내용을 입력한 후 미리보기를 사용해주세요.');
                return;
            }
            
            // 새 창에서 미리보기 표시
            const previewWindow = window.open('', 'preview', 'width=800,height=600,scrollbars=yes');
            previewWindow.document.write(`
                <html>
                <head>
                    <title>미리보기</title>
                    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
                </head>
                <body class="p-4">
                    <div class="container">
                        <h2>${title}</h2>
                        <hr>
                        <div style="white-space: pre-wrap;">${content}</div>
                    </div>
                </body>
                </html>
            `);
        }
        
        // 페이지 로드 시 임시저장된 데이터 복원
        document.addEventListener('DOMContentLoaded', function() {
            const draftData = localStorage.getItem('boardDraft');
            if (draftData) {
                const data = JSON.parse(draftData);
                const timeDiff = new Date() - new Date(data.timestamp);
                
                // 24시간 이내 데이터만 복원
                if (timeDiff < 24 * 60 * 60 * 1000) {
                    if (confirm('임시저장된 데이터가 있습니다. 복원하시겠습니까?')) {
                        document.querySelector('input[name="title"]').value = data.title;
                        document.querySelector('textarea[name="content"]').value = data.content;
                        document.querySelector('select[name="category"]').value = data.category;
                        document.querySelector('input[name="tags"]').value = data.tags;
                        
                        // 문자 수 업데이트
                        document.getElementById('titleLength').textContent = data.title.length;
                        document.getElementById('contentLength').textContent = data.content.length;
                    }
                } else {
                    // 24시간 지난 데이터는 삭제
                    localStorage.removeItem('boardDraft');
                }
            }
        });
    </script>
    
</body>
</html>
````

## File: src/main/resources/templates/job/detail.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title th:text="${job.title + ' - CareLink'}">구인구직 상세 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>

    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <div class="container py-4">
            <!-- 브레드크럼 -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">홈</a></li>
                    <li class="breadcrumb-item"><a href="/job">구인구직</a></li>
                    <li class="breadcrumb-item active" aria-current="page">상세보기</li>
                </ol>
            </nav>

            <div class="row">
                <!-- 구인구직 상세 정보 -->
                <div class="col-lg-8">
                    <div class="card">
                        <!-- 구인구직 헤더 -->
                        <div class="card-header bg-gradient-primary text-white">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <div class="mb-2">
                                        <div class="d-flex align-items-center gap-2 mb-3">
                                            <span th:if="${job.jobType == 'RECRUIT'}" class="badge bg-white text-primary">구인</span>
                                            <span th:if="${job.jobType == 'SEARCH'}" class="badge bg-white text-success">구직</span>
                                            <span th:if="${job.workType == 'FULL_TIME'}" class="badge bg-success">정규직</span>
                                            <span th:if="${job.workType == 'PART_TIME'}" class="badge bg-info">파트타임</span>
                                            <span th:if="${job.workType == 'TEMPORARY'}" class="badge bg-warning text-dark">임시직</span>
                                            <span th:if="${job.priority > 0}" class="badge bg-danger">
                                                <i class="fas fa-fire me-1"></i>긴급
                                            </span>
                                        </div>
                                        <h3 class="mb-2 fw-bold" th:text="${job.title}">구인구직 제목</h3>
                                        <h5 class="mb-0 fw-normal opacity-75" th:text="${job.facilityName ?: '개인 사업자'}">회사명</h5>
                                    </div>
                                    <div class="text-white-50 small">
                                        <i class="fas fa-user me-1"></i>
                                        <span th:text="${job.memberName ?: '작성자'}">작성자</span>
                                        <span class="mx-2">|</span>
                                        <i class="fas fa-calendar me-1"></i>
                                        <span th:text="${#temporals.format(job.createdAt, 'yyyy-MM-dd')}">작성일</span>
                                        <span class="mx-2">|</span>
                                        <i class="fas fa-eye me-1"></i>
                                        조회 <span th:text="${job.viewCount ?: 0}">0</span>
                                    </div>
                                </div>
                                <div class="col-md-4 text-end">
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-light btn-sm" onclick="bookmarkJob()">
                                            <i class="fas fa-bookmark me-1"></i>관심등록
                                        </button>
                                        <button type="button" class="btn btn-light btn-sm" onclick="shareJob()">
                                            <i class="fas fa-share me-1"></i>공유
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 구인구직 상세 내용 -->
                        <div class="card-body">
                            <!-- 기본 정보 카드 -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="card border-0 bg-light h-100">
                                        <div class="card-body">
                                            <h6 class="card-title text-primary mb-3">
                                                <i class="fas fa-briefcase me-2"></i>기본 정보
                                            </h6>
                                            <div class="info-grid">
                                                <div class="info-item mb-3" th:if="${job.position}">
                                                    <div class="d-flex align-items-center">
                                                        <div class="icon-box bg-primary text-white me-3">
                                                            <i class="fas fa-user-tie"></i>
                                                        </div>
                                                        <div>
                                                            <small class="text-muted d-block">직종</small>
                                                            <strong th:text="${job.position}">직종</strong>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="info-item mb-3" th:if="${job.recruitCount}">
                                                    <div class="d-flex align-items-center">
                                                        <div class="icon-box bg-success text-white me-3">
                                                            <i class="fas fa-users"></i>
                                                        </div>
                                                        <div>
                                                            <small class="text-muted d-block">모집인원</small>
                                                            <strong><span th:text="${job.recruitCount}">1</span>명</strong>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="info-item mb-3" th:if="${job.workLocation}">
                                                    <div class="d-flex align-items-center">
                                                        <div class="icon-box bg-info text-white me-3">
                                                            <i class="fas fa-map-marker-alt"></i>
                                                        </div>
                                                        <div>
                                                            <small class="text-muted d-block">근무지역</small>
                                                            <strong th:text="${job.workLocation}">근무지역</strong>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="info-item mb-3" th:if="${job.workHours}">
                                                    <div class="d-flex align-items-center">
                                                        <div class="icon-box bg-warning text-white me-3">
                                                            <i class="fas fa-clock"></i>
                                                        </div>
                                                        <div>
                                                            <small class="text-muted d-block">근무시간</small>
                                                            <strong th:text="${job.workHours}">근무시간</strong>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card border-0 bg-light h-100">
                                        <div class="card-body">
                                            <h6 class="card-title text-success mb-3">
                                                <i class="fas fa-won-sign me-2"></i>급여 정보
                                            </h6>
                                            <div class="info-grid">
                                                <div class="info-item mb-3" th:if="${job.salaryType}">
                                                    <div class="d-flex align-items-center">
                                                        <div class="icon-box bg-success text-white me-3">
                                                            <i class="fas fa-coins"></i>
                                                        </div>
                                                        <div>
                                                            <small class="text-muted d-block">급여형태</small>
                                                            <strong>
                                                                <span th:if="${job.salaryType == 'HOURLY'}">시급</span>
                                                                <span th:if="${job.salaryType == 'MONTHLY'}">월급</span>
                                                                <span th:if="${job.salaryType == 'ANNUAL'}">연봉</span>
                                                            </strong>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="info-item mb-3" th:if="${job.salaryMin != null and job.salaryMax != null}">
                                                    <div class="d-flex align-items-center">
                                                        <div class="icon-box bg-primary text-white me-3">
                                                            <i class="fas fa-chart-line"></i>
                                                        </div>
                                                        <div>
                                                            <small class="text-muted d-block">급여범위</small>
                                                            <strong class="text-success">
                                                                <span th:text="${#numbers.formatDecimal(job.salaryMin, 0, 'COMMA', 0, 'POINT')}">0</span>원
                                                                ~ <span th:text="${#numbers.formatDecimal(job.salaryMax, 0, 'COMMA', 0, 'POINT')}">0</span>원
                                                            </strong>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="info-item mb-3" th:if="${job.salaryDescription}">
                                                    <div class="d-flex align-items-center">
                                                        <div class="icon-box bg-info text-white me-3">
                                                            <i class="fas fa-info-circle"></i>
                                                        </div>
                                                        <div>
                                                            <small class="text-muted d-block">급여설명</small>
                                                            <strong th:text="${job.salaryDescription}">급여설명</strong>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 지원 자격 -->
                            <div th:if="${not #strings.isEmpty(job.experience) or not #strings.isEmpty(job.education) or not #strings.isEmpty(job.qualifications)}">
                                <h6><i class="fas fa-user-graduate me-2"></i>지원 자격</h6>
                                <div class="row">
                                    <div class="col-md-4" th:if="${job.experience}">
                                        <strong>경력:</strong> <span th:text="${job.experience}">경력</span>
                                    </div>
                                    <div class="col-md-4" th:if="${job.education}">
                                        <strong>학력:</strong> <span th:text="${job.education}">학력</span>
                                    </div>
                                    <div class="col-md-4" th:if="${job.qualifications}">
                                        <strong>자격요건:</strong> <span th:text="${job.qualifications}">자격요건</span>
                                    </div>
                                </div>
                            </div>

                            <!-- 복리후생 -->
                            <div class="mb-4" th:if="${job.benefits}">
                                <h6><i class="fas fa-gift me-2"></i>복리후생</h6>
                                <p th:text="${job.benefits}">복리후생</p>
                            </div>

                            <!-- 상세 내용 -->
                            <div class="mb-4">
                                <h6><i class="fas fa-file-alt me-2"></i>상세 내용</h6>
                                <div class="content-area border rounded p-3" style="min-height: 200px; line-height: 1.8; background-color: #f8f9fa;">
                                    <div th:utext="${formattedJobContent}"></div>
                                        구인구직 상세 내용이 여기에 표시됩니다.
                                    </div>
                                </div>
                            </div>

                            <!-- 모집 기간 -->
                            <div class="mb-4" th:if="${job.startDate != null or job.endDate != null}">
                                <h6><i class="fas fa-calendar-alt me-2"></i>모집 기간</h6>
                                <div class="alert alert-info">
                                    <span th:if="${job.startDate}">
                                        <strong>시작일:</strong> <span th:text="${#temporals.format(job.startDate, 'yyyy-MM-dd')}">시작일</span>
                                    </span>
                                    <span th:if="${job.endDate}" class="ms-3">
                                        <strong>마감일:</strong> <span th:text="${#temporals.format(job.endDate, 'yyyy-MM-dd')}">마감일</span>
                                    </span>
                                </div>
                            </div>

                            <!-- 연락처 정보 -->
                            <div class="mb-4" th:if="${(job.contactName != null and !#strings.isEmpty(job.contactName)) or
                             (job.contactPhone != null and !#strings.isEmpty(job.contactPhone)) or
                             (job.contactEmail != null and !#strings.isEmpty(job.contactEmail))}">
                                <h6><i class="fas fa-phone me-2"></i>연락처 정보</h6>
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <div th:if="${job.contactName != null and !#strings.isEmpty(job.contactName)}">
                                            <strong>담당자:</strong> <span th:text="${job.contactName}">담당자</span>
                                        </div>
                                        <div th:if="${job.contactPhone != null and !#strings.isEmpty(job.contactPhone)}">
                                            <strong>연락처:</strong> <span th:text="${job.contactPhone}">연락처</span>
                                        </div>
                                        <div th:if="${job.contactEmail != null and !#strings.isEmpty(job.contactEmail)}">
                                            <strong>이메일:</strong> <span th:text="${job.contactEmail}">이메일</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 구인구직 푸터 -->
                        <div class="card-footer bg-light">
                            <div class="row">
                                <div class="col-md-6">
                                    <small class="text-muted">
                                        <i class="fas fa-clock me-1"></i>
                                        최종 수정: <span th:text="${#temporals.format(job.updatedAt, 'yyyy-MM-dd HH:mm')}">수정일</span>
                                    </small>
                                </div>
                                <div class="col-md-6 text-end">
                                    <!-- 작성자 또는 관리자만 수정/삭제 가능 -->
                                    <div th:if="${(session.memberId != null and session.memberId == job.memberId) or (session.loginMember != null and session.loginMember.role == 'ADMIN')}" 
                                         class="btn-group" role="group">
                                        <a th:href="@{/job/edit/{id}(id=${job.jobId})}" 
                                           class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-edit me-1"></i>수정
                                        </a>
                                        <button type="button" class="btn btn-outline-danger btn-sm" 
                                                onclick="deleteJob()">
                                            <i class="fas fa-trash me-1"></i>삭제
                                        </button>
                                    </div>
                                    <!-- 작성자가 아닌 경우 신고 버튼만 표시 (관리자 제외) -->
                                    <button type="button" class="btn btn-outline-warning btn-sm" 
                                            th:if="${session.loginMember != null and session.loginMember.memberId != job.memberId and session.loginMember.role != 'ADMIN'}"
                                            onclick="reportJob()">
                                        <i class="fas fa-exclamation-triangle me-1"></i>신고
                                    </button>
                                    <!-- 비로그인 사용자 -->
                                    <a th:if="${session.loginMember == null}" 
                                       href="/member/login" class="btn btn-outline-secondary btn-sm">
                                        <i class="fas fa-sign-in-alt me-1"></i>로그인
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 지원하기 버튼 (구인글인 경우) -->
                    <div class="text-center mt-4" th:if="${job.jobType == 'RECRUIT'}">
                        <div class="btn-group" role="group">
                            <!-- 일반회원(USER)만 지원하기 가능 (작성자 제외) -->
                            <button class="btn btn-primary btn-lg" 
                                    th:if="${session.loginMember != null and session.loginMember.role == 'USER' and session.memberId != job.memberId}"
                                    onclick="applyJob()">
                                <i class="fas fa-paper-plane me-2"></i>지원하기
                            </button>
                            
                            <!-- 비로그인 사용자 -->
                            <a th:if="${session.loginMember == null}" 
                               href="/member/login" class="btn btn-outline-primary btn-lg">
                                <i class="fas fa-sign-in-alt me-2"></i>로그인 후 지원하기
                            </a>
                            
                            <!-- 지원 불가 사용자들 메시지 -->
                            <div th:if="${session.loginMember != null and (session.loginMember.role == 'FACILITY' or session.loginMember.role == 'ADMIN' or session.loginMember.memberId == job.memberId)}" 
                                 class="alert alert-info">
                                <i class="fas fa-info-circle me-1"></i>
                                <span th:if="${session.loginMember.memberId == job.memberId}">작성자는 자신의 공고에 지원할 수 없습니다</span>
                                <span th:if="${session.loginMember.role == 'FACILITY' and session.loginMember.memberId != job.memberId}">시설회원은 지원할 수 없습니다. 구직자를 채용하는 역할입니다.</span>
                                <span th:if="${session.loginMember.role == 'ADMIN'}">관리자는 지원할 수 없습니다</span>
                            </div>
                            
                            <a href="/job" class="btn btn-secondary">
                                <i class="fas fa-list me-1"></i>목록으로
                            </a>
                            
                            <!-- 시설회원(FACILITY) 또는 관리자(ADMIN)만 구인글쓰기 가능 -->
                            <a th:if="${session.loginMember != null and (session.loginMember.role == 'FACILITY' or session.loginMember.role == 'ADMIN')}" 
                               href="/job/write" class="btn btn-outline-success">
                                <i class="fas fa-plus me-1"></i>구인글쓰기
                            </a>
                            
                            <!-- 일반사용자(USER)는 구직글쓰기만 가능 -->
                            <a th:if="${session.loginMember != null and session.loginMember.role == 'USER'}" 
                               href="/job/write" class="btn btn-outline-info">
                                <i class="fas fa-plus me-1"></i>구직글쓰기
                            </a>
                        </div>
                    </div>

                    <!-- 연락하기 버튼 (구직글인 경우) -->
                    <div class="text-center mt-4" th:if="${job.jobType == 'SEARCH'}">
                        <div class="btn-group" role="group">
                            <!-- 시설회원(FACILITY)만 구직자에게 연락 가능 (작성자 제외) -->
                            <button class="btn btn-success btn-lg" 
                                    th:if="${session.loginMember != null and session.loginMember.role == 'FACILITY' and session.memberId != job.memberId}"
                                    onclick="contactJob()">
                                <i class="fas fa-phone me-2"></i>연락하기
                            </button>
                            
                            <!-- 비로그인 사용자 -->
                            <a th:if="${session.loginMember == null}" 
                               href="/member/login" class="btn btn-outline-success btn-lg">
                                <i class="fas fa-sign-in-alt me-2"></i>로그인 후 연락하기
                            </a>
                            
                            <!-- 연락 불가 사용자들 메시지 -->
                            <div th:if="${session.loginMember != null and (session.loginMember.role == 'USER' or session.loginMember.role == 'ADMIN' or session.loginMember.memberId == job.memberId)}" 
                                 class="alert alert-warning">
                                <i class="fas fa-info-circle me-1"></i>
                                <span th:if="${session.loginMember.memberId == job.memberId}">작성자는 자신의 글에 연락할 수 없습니다</span>
                                <span th:if="${session.loginMember.role == 'USER' and session.loginMember.memberId != job.memberId}">시설회원만 구직자에게 연락할 수 있습니다</span>
                                <span th:if="${session.loginMember.role == 'ADMIN'}">관리자는 연락할 수 없습니다</span>
                            </div>
                            
                            <a href="/job" class="btn btn-secondary">
                                <i class="fas fa-list me-1"></i>목록으로
                            </a>
                            
                            <!-- 시설회원(FACILITY) 또는 관리자(ADMIN)만 구인글쓰기 가능 -->
                            <a th:if="${session.loginMember != null and (session.loginMember.role == 'FACILITY' or session.loginMember.role == 'ADMIN')}" 
                               href="/job/write" class="btn btn-outline-success">
                                <i class="fas fa-plus me-1"></i>구인글쓰기
                            </a>
                            
                            <!-- 일반사용자(USER)는 구직글쓰기만 가능 -->
                            <a th:if="${session.loginMember != null and session.loginMember.role == 'USER'}" 
                               href="/job/write" class="btn btn-outline-info">
                                <i class="fas fa-plus me-1"></i>구직글쓰기
                            </a>
                        </div>
                    </div>
                </div>

                <!-- 사이드바 -->
                <div class="col-lg-4">
                    <!-- 시설 정보 (구인글이고 시설 정보가 있는 경우) -->
                    <div th:if="${job.jobType == 'RECRUIT' and (job.facilityName != null and !#strings.isEmpty(job.facilityName))}"> </div>
                        <div class="card-header bg-primary text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-building me-2"></i>시설 정보
                            </h6>
                        </div>
                        <div class="card-body">
                            <h6 th:text="${job.facilityName}">시설명</h6>
                            <p class="text-muted mb-2">관련 시설에서 모집하는 구인 정보입니다.</p>
                            <a th:href="@{/facility/detail/{id}(id=${job.facilityId})}" 
                               class="btn btn-outline-primary btn-sm"
                               th:if="${job.facilityId}">
                                <i class="fas fa-info-circle me-1"></i>시설 상세보기
                            </a>
                        </div>
                    </div>

                    <!-- 지원 현황 -->
                    <div class="card mb-4" th:if="${job.jobType == 'RECRUIT'}">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-users me-2"></i>지원 현황
                            </h6>
                        </div>
                        <div class="card-body text-center">
                            <div class="row">
                                <div class="col-6">
                                    <div class="border-end">
                                        <h4 class="text-primary mb-0" th:text="${job.applyCount ?: 0}">0</h4>
                                        <small class="text-muted">지원자 수</small>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <h4 class="text-success mb-0" th:text="${job.recruitCount ?: 1}">1</h4>
                                    <small class="text-muted">모집 인원</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 작성자 정보 -->
                    <div class="card">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-user me-2"></i>작성자 정보
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <div class="avatar-circle bg-primary text-white me-3">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0" th:text="${job.memberName ?: '작성자'}">작성자</h6>
                                    <small class="text-muted">
                                        <span th:text="${#temporals.format(job.createdAt, 'yyyy-MM-dd')}">2024-01-01</span> 가입
                                    </small>
                                </div>
                            </div>
                            <div class="text-center">
                                <button class="btn btn-outline-primary btn-sm me-2" onclick="sendMessage()">
                                    <i class="fas fa-envelope me-1"></i>쪽지
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="reportJob()">
                                    <i class="fas fa-exclamation-triangle me-1"></i>신고
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- JavaScript용 hidden inputs -->
    <input type="hidden" id="contactPhone" th:value="${job.contactPhone}">
    <input type="hidden" id="contactEmail" th:value="${job.contactEmail}">
    <input type="hidden" id="jobId" th:value="${job.jobId}">
    
    
    <!-- 푸터 -->
    <footer th:replace="~{layout/footer :: footer}"></footer>
    
    <!-- JavaScript -->
    <div th:replace="~{layout/footer :: scripts}"></div>
    
    <!-- 구인구직 상세보기 전용 JavaScript -->
    <script src="/js/job-detail.js"></script>

    <style>
        .avatar-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 구인구직 상세 페이지 추가 스타일 */
        .bg-gradient-primary {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        }

        .icon-box {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .info-item {
            transition: all 0.3s ease;
        }

        .info-item:hover {
            transform: translateX(5px);
        }

        .content-area {
            transition: all 0.3s ease;
        }

        .content-area:hover {
            border-color: #007bff;
        }
    </style>

</body>
</html>
````

## File: src/main/resources/templates/member/crop-image.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>프로필 이미지 크롭 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <!-- 브레드크럼 -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item"><a href="/member/myinfo">마이페이지</a></li>
                <li class="breadcrumb-item active" aria-current="page">프로필 이미지 크롭</li>
            </ol>
        </nav>
        
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="card shadow">
                    <div class="card-body p-4">
                        <div class="text-center mb-4">
                            <h3 class="card-title fw-bold text-primary">
                                <i class="fas fa-crop me-2"></i>
                                프로필 이미지 크롭
                            </h3>
                            <p class="text-muted">증명사진 비율(3:4)에 맞춰 프로필 사진을 조절하세요</p>
                        </div>

                        <!-- 단계 표시기 -->
                        <div class="steps-indicator mb-4">
                            <div class="step-item" id="step1">
                                <div class="step-circle">
                                    <i class="fas fa-upload"></i>
                                </div>
                                <div class="step-label">이미지 선택</div>
                            </div>
                            <div class="step-connector"></div>
                            <div class="step-item" id="step2">
                                <div class="step-circle">
                                    <i class="fas fa-crop-alt"></i>
                                </div>
                                <div class="step-label">비율 조절</div>
                            </div>
                            <div class="step-connector"></div>
                            <div class="step-item" id="step3">
                                <div class="step-circle">
                                    <i class="fas fa-compress-alt"></i>
                                </div>
                                <div class="step-label">압축 & SEO</div>
                            </div>
                            <div class="step-connector"></div>
                            <div class="step-item" id="step4">
                                <div class="step-circle">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div class="step-label">완료</div>
                            </div>
                        </div>

                        <!-- 1단계: 파일 업로드 -->
                        <div id="uploadSection" class="upload-section">
                            <div class="upload-area" id="uploadArea">
                                <div class="upload-content">
                                    <div class="upload-icon">
                                        <i class="fas fa-cloud-upload-alt fa-3x text-primary"></i>
                                    </div>
                                    <h5 class="upload-title">프로필 이미지 업로드</h5>
                                    <p class="upload-description text-muted">
                                        이미지를 드래그하여 업로드하거나 클릭하여 선택하세요
                                    </p>
                                    <div class="upload-format-info">
                                        <small class="text-muted">
                                            <i class="fas fa-info-circle me-1"></i>
                                            JPG, PNG, WebP 파일 지원 (큰 파일도 자동 압축)
                                        </small>
                                        <br>
                                        <small class="text-info">
                                            <i class="fas fa-crop-alt me-1"></i>
                                            증명사진 비율 (3:4) 자동 조정
                                        </small>
                                        <br>
                                        <small class="text-success">
                                            <i class="fas fa-compress-alt me-1"></i>
                                            AVIF/WebP로 용량 최적화
                                        </small>
                                    </div>
                                    <button type="button" class="btn btn-primary btn-lg mt-3" id="fileSelectBtn">
                                        <i class="fas fa-folder-open me-2"></i>파일 선택
                                    </button>
                                </div>
                            </div>
                            <input type="file" id="imageInput" accept="image/*" style="display: none;">
                        </div>

                        <!-- 2단계: 크롭 및 조정 -->
                        <div id="cropSection" class="crop-section" style="display: none;">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="crop-container">
                                        <h6 class="mb-3">
                                            <i class="fas fa-crop-alt me-2"></i>이미지 크롭 및 조정
                                        </h6>
                                        <div class="crop-image-container">
                                            <img id="cropImage" alt="크롭할 이미지" style="max-width: 100%; max-height: 400px;">
                                        </div>
                                        <div class="crop-controls mt-3">
                                            <div class="btn-group" role="group">
                                                <button type="button" class="btn btn-outline-secondary btn-sm" id="zoomIn">
                                                    <i class="fas fa-search-plus me-1"></i>확대
                                                </button>
                                                <button type="button" class="btn btn-outline-secondary btn-sm" id="zoomOut">
                                                    <i class="fas fa-search-minus me-1"></i>축소
                                                </button>
                                                <button type="button" class="btn btn-outline-secondary btn-sm" id="resetZoom">
                                                    <i class="fas fa-undo me-1"></i>초기화
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="crop-preview-panel">
                                        <h6 class="mb-3">
                                            <i class="fas fa-eye me-2"></i>미리보기
                                        </h6>
                                        
                                        <div class="profile-preview mb-3">
                                            <div class="profile-card text-center p-3 bg-light rounded">
                                                <canvas id="previewCanvas" width="90" height="120" 
                                                        style="border-radius: 8px; border: 2px solid #dee2e6;"></canvas>
                                                <div class="mt-2">
                                                    <small class="text-muted">프로필 미리보기</small>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 줌 표시기 -->
                                        <div class="zoom-indicator" id="zoomIndicator" style="display: none;">
                                            <small class="text-muted">
                                                <i class="fas fa-search me-1"></i>
                                                줌: <span id="zoomLevel">100%</span>
                                                <span id="zoomStatus" class="ms-1"></span>
                                            </small>
                                        </div>

                                        <!-- 이미지 정보 -->
                                        <div class="image-info-panel mt-3">
                                            <small class="text-muted">
                                                <div class="mb-1">
                                                    <i class="fas fa-file-image me-1"></i>
                                                    크기: <span id="imageSize">-</span>
                                                </div>
                                                <div class="mb-1">
                                                    <i class="fas fa-arrows-alt me-1"></i>
                                                    해상도: <span id="imageDimensions">-</span>
                                                </div>
                                                <div class="mb-1">
                                                    <i class="fas fa-crop-alt me-1"></i>
                                                    최종: 300 × 400px
                                                </div>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="crop-actions mt-4">
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-outline-secondary" id="backToUpload">
                                        <i class="fas fa-arrow-left me-1"></i>다른 이미지 선택
                                    </button>
                                    <button type="button" class="btn btn-primary" id="cropAndSave">
                                        <i class="fas fa-crop-alt me-1"></i>크롭 완료
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 3단계: 압축 및 SEO 최적화 -->
                        <div id="compressionSection" class="compression-section" style="display: none;">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="compression-settings">
                                        <h6 class="mb-3">
                                            <i class="fas fa-compress-alt me-2"></i>이미지 압축 설정
                                        </h6>
                                        
                                        <!-- 이미지 형식 선택 -->
                                        <div class="mb-3">
                                            <label class="form-label">이미지 형식</label>
                                            <div class="btn-group w-100" role="group">
                                                <input type="radio" class="btn-check" name="imageFormat" id="formatAVIF" value="avif" checked>
                                                <label class="btn btn-outline-success btn-sm" for="formatAVIF">
                                                    <i class="fas fa-bolt me-1"></i>AVIF
                                                    <small class="d-block text-muted">용량 최소 (권장)</small>
                                                </label>
                                                
                                                <input type="radio" class="btn-check" name="imageFormat" id="formatWEBP" value="webp">
                                                <label class="btn btn-outline-primary btn-sm" for="formatWEBP">
                                                    <i class="fas fa-rocket me-1"></i>WebP
                                                    <small class="d-block text-muted">빠른 로딩</small>
                                                </label>
                                                
                                                <input type="radio" class="btn-check" name="imageFormat" id="formatJPEG" value="jpeg">
                                                <label class="btn btn-outline-secondary btn-sm" for="formatJPEG">
                                                    <i class="fas fa-check me-1"></i>JPEG
                                                    <small class="d-block text-muted">범용 호환</small>
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <!-- 압축 품질 -->
                                        <div class="mb-3">
                                            <label class="form-label">
                                                압축 품질: <span id="qualityPercent">80%</span>
                                            </label>
                                            <input type="range" class="form-range" id="qualitySlider" 
                                                   min="0.3" max="1.0" step="0.1" value="0.8">
                                            <div class="d-flex justify-content-between small text-muted">
                                                <span>높은 압축</span>
                                                <span>높은 품질</span>
                                            </div>
                                        </div>
                                        
                                        <!-- 자동 최적화 -->
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="autoOptimize" checked>
                                            <label class="form-check-label" for="autoOptimize">
                                                <i class="fas fa-magic me-1"></i>자동 최적화
                                                <small class="d-block text-muted">브라우저별 최적 형식 자동 선택</small>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="compression-preview">
                                        <h6 class="mb-3">
                                            <i class="fas fa-eye me-2"></i>압축 결과
                                        </h6>
                                        <div class="compression-info text-center mb-3">
                                            <div class="compression-savings text-success fw-bold mb-2">
                                                <span id="compressionSavings">계산 중...</span>
                                            </div>
                                            <small class="text-muted">
                                                현재 형식: <span id="currentFormat" class="fw-bold">AVIF</span>
                                            </small>
                                        </div>
                                        
                                        <div class="final-preview-container">
                                            <img id="finalPreviewImage" class="img-fluid rounded" 
                                                 style="max-width: 100%; height: auto; border: 2px solid #dee2e6;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- SEO 최적화 섹션 -->
                            <div class="seo-optimization-section mt-4">
                                <h6 class="mb-3">
                                    <i class="fas fa-search me-2"></i>SEO 최적화 & 파일명 관리
                                </h6>
                                
                                <!-- 이미지 파일명 수정 -->
                                <div class="mb-4">
                                    <label for="profileNameInput" class="form-label">
                                        <i class="fas fa-file-signature me-1"></i>이미지 파일명
                                    </label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="profileNameInput" 
                                               placeholder="예: 김철수-증명사진">
                                        <button type="button" class="btn btn-outline-info" id="previewProfileNameBtn">
                                            <i class="fas fa-eye me-1"></i>미리보기
                                        </button>
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-info">
                                            <i class="fas fa-info-circle me-1"></i>
                                            실제 저장명: <span id="previewProfileName" class="fw-bold">profile_user_photo.jpg</span>
                                        </small>
                                    </div>
                                </div>

                                <!-- 추천 키워드 -->
                                <div class="mb-3">
                                    <label class="form-label">
                                        <i class="fas fa-tags me-1"></i>추천 키워드 (클릭하여 추가)
                                    </label>
                                    <div class="keyword-suggestions">
                                        <div class="mb-2">
                                            <small class="text-muted fw-bold">사진 종류:</small>
                                            <div class="keyword-group">
                                                <button type="button" class="btn btn-outline-primary btn-sm keyword-btn" data-keyword="증명사진">증명사진</button>
                                                <button type="button" class="btn btn-outline-primary btn-sm keyword-btn" data-keyword="프로필">프로필</button>
                                                <button type="button" class="btn btn-outline-primary btn-sm keyword-btn" data-keyword="정면사진">정면사진</button>
                                                <button type="button" class="btn btn-outline-primary btn-sm keyword-btn" data-keyword="여권사진">여권사진</button>
                                            </div>
                                        </div>
                                        <div class="mb-2">
                                            <small class="text-muted fw-bold">용도:</small>
                                            <div class="keyword-group">
                                                <button type="button" class="btn btn-outline-success btn-sm keyword-btn" data-keyword="이력서">이력서</button>
                                                <button type="button" class="btn btn-outline-success btn-sm keyword-btn" data-keyword="자격증">자격증</button>
                                                <button type="button" class="btn btn-outline-success btn-sm keyword-btn" data-keyword="신분증">신분증</button>
                                                <button type="button" class="btn btn-outline-success btn-sm keyword-btn" data-keyword="입사지원">입사지원</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Alt 텍스트 -->
                                <div class="mb-3">
                                    <label for="altTextInput" class="form-label">
                                        <i class="fas fa-tag me-1"></i>이미지 설명 (Alt 텍스트)
                                    </label>
                                    <div class="input-group">
                                        <textarea class="form-control" id="altTextInput" rows="2" 
                                                  placeholder="프로필 이미지에 대한 설명을 입력하세요 (SEO 최적화용)">사용자 프로필 사진</textarea>
                                        <button type="button" class="btn btn-outline-secondary" id="autoGenerateAltBtn">
                                            <i class="fas fa-magic me-1"></i>자동 생성
                                        </button>
                                    </div>
                                    <small class="text-muted">
                                        <i class="fas fa-lightbulb me-1"></i>
                                        검색 엔진 최적화를 위한 이미지 설명입니다
                                    </small>
                                </div>

                                <!-- SEO 팁 -->
                                <div class="seo-tips alert alert-info">
                                    <h6 class="alert-heading">
                                        <i class="fas fa-graduation-cap me-2"></i>SEO 최적화 팁
                                    </h6>
                                    <ul class="mb-0 small">
                                        <li>구체적인 프로필 사진 설명 작성</li>
                                        <li>용도나 목적을 포함한 키워드 사용</li>
                                        <li>예: "김철수 요양보호사 증명사진"</li>
                                        <li>한글 키워드로 국내 검색에 최적화</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="compression-actions mt-4 text-center">
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-outline-secondary" id="backToCropBtn">
                                        <i class="fas fa-arrow-left me-2"></i>크롭으로 돌아가기
                                    </button>
                                    <button type="button" class="btn btn-success" id="saveImageBtn">
                                        <i class="fas fa-save me-2"></i>완료
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 4단계: 완료 -->
                        <div id="completeSection" class="complete-section" style="display: none;">
                            <div class="text-center">
                                <div class="success-icon mb-3">
                                    <i class="fas fa-check-circle fa-4x text-success"></i>
                                </div>
                                <h4 class="text-success mb-2">프로필 이미지 저장 완료!</h4>
                                <p class="text-muted mb-4">새로운 프로필 이미지가 성공적으로 저장되었습니다.</p>
                                
                                <div class="final-preview mb-4">
                                    <img id="finalPreview" style="width: 150px; height: 200px; border-radius: 8px; object-fit: cover;" alt="최종 프로필 이미지">
                                </div>
                                
                                <div class="d-flex justify-content-center gap-3">
                                    <button type="button" class="btn btn-outline-primary" id="cropAnother">
                                        <i class="fas fa-redo me-1"></i>다른 이미지 선택
                                    </button>
                                    <a href="/member/myinfo/edit" class="btn btn-success">
                                        <i class="fas fa-user me-1"></i>마이페이지로 이동
                                    </a>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 백업 기반 고급 크롭 스크립트 -->
<script>
/**
 * 프로필 이미지 크롭 전용 JavaScript
 * 한국 표준 증명사진 비율(3:4) 최적화 버전
 * Cropper.js 라이브러리 사용
 */

// 전역 변수
let cropper = null;
let originalImageData = null;
let originalImage = null;

// DOM 요소
const elements = {};

// 초기화
document.addEventListener('DOMContentLoaded', function() {
    initializeElements();
    setupEventListeners();
    console.log('프로필 이미지 크롭 페이지 초기화 완료 (Cropper.js)');
});

// DOM 요소 초기화
function initializeElements() {
    elements.imageInput = document.getElementById('imageInput');
    elements.cropImage = document.getElementById('cropImage');
    elements.uploadSection = document.getElementById('uploadSection');
    elements.cropSection = document.getElementById('cropSection');
    elements.compressionSection = document.getElementById('compressionSection');
    elements.completeSection = document.getElementById('completeSection');
    elements.previewCanvas = document.getElementById('previewCanvas');
    elements.finalPreview = document.getElementById('finalPreview');
    elements.finalPreviewImage = document.getElementById('finalPreviewImage');
    elements.zoomIndicator = document.getElementById('zoomIndicator');
    elements.zoomLevel = document.getElementById('zoomLevel');
    elements.zoomStatus = document.getElementById('zoomStatus');
    elements.compressionSavings = document.getElementById('compressionSavings');
    elements.qualitySlider = document.getElementById('qualitySlider');
    elements.qualityLabel = document.getElementById('qualityLabel');
    elements.altTextInput = document.getElementById('altTextInput');
    elements.currentFormat = document.getElementById('currentFormat');
    elements.formatJPEG = document.getElementById('formatJPEG');
    elements.formatAVIF = document.getElementById('formatAVIF');
    elements.formatWEBP = document.getElementById('formatWEBP');
    
    // 단계 요소
    elements.steps = {
        step1: document.getElementById('step1'),
        step2: document.getElementById('step2'),
        step3: document.getElementById('step3'),
        step4: document.getElementById('step4')
    };
    
    // 버튼 요소
    elements.buttons = {
        zoomIn: document.getElementById('zoomIn'),
        zoomOut: document.getElementById('zoomOut'),
        resetZoom: document.getElementById('resetZoom'),
        backToUpload: document.getElementById('backToUpload'),
        cropAndSave: document.getElementById('cropAndSave'),
        cropAnother: document.getElementById('cropAnother'),
        backToCrop: document.getElementById('backToCropBtn'),
        removeImage: document.getElementById('removeImageBtn'),
        saveImage: document.getElementById('saveImageBtn'),
        recompress: document.getElementById('recompressBtn'),
        autoGenerateAlt: document.getElementById('autoGenerateAltBtn'),
        optimize: document.getElementById('optimizeBtn')
    };
}

// 이벤트 리스너 설정
function setupEventListeners() {
    // 파일 입력 이벤트 등록
    if (elements.imageInput) {
        elements.imageInput.removeEventListener('change', handleImageUpload);
        elements.imageInput.addEventListener('change', handleImageUpload);
        console.log('파일 입력 이벤트 리스너 등록됨');
    }
    
    // 확대/축소 버튼
    if (elements.buttons.zoomIn) {
        elements.buttons.zoomIn.addEventListener('click', () => {
            if (cropper) {
                cropper.zoom(0.1);
            }
        });
    }
    
    if (elements.buttons.zoomOut) {
        elements.buttons.zoomOut.addEventListener('click', () => {
            if (cropper) {
                cropper.zoom(-0.1);
            }
        });
    }
    
    if (elements.buttons.resetZoom) {
        elements.buttons.resetZoom.addEventListener('click', () => {
            if (cropper) {
                cropper.reset();
            }
        });
    }
    
    // 네비게이션 버튼
    if (elements.buttons.backToUpload) {
        elements.buttons.backToUpload.addEventListener('click', goToUploadStep);
    }
    
    if (elements.buttons.cropAndSave) {
        elements.buttons.cropAndSave.addEventListener('click', cropAndSaveImage);
    }
    
    if (elements.buttons.cropAnother) {
        elements.buttons.cropAnother.addEventListener('click', goToUploadStep);
    }
    
    // 3단계 압축 관련 버튼
    if (elements.buttons.backToCrop) {
        elements.buttons.backToCrop.addEventListener('click', goToCropStep);
    }
    
    if (elements.buttons.removeImage) {
        elements.buttons.removeImage.addEventListener('click', goToUploadStep);
    }
    
    if (elements.buttons.saveImage) {
        elements.buttons.saveImage.addEventListener('click', saveCompressedImageToServer);
    }
    
    if (elements.buttons.recompress) {
        elements.buttons.recompress.addEventListener('click', updateCompression);
    }
    
    if (elements.buttons.autoGenerateAlt) {
        elements.buttons.autoGenerateAlt.addEventListener('click', generateAltText);
    }
    
    if (elements.buttons.optimize) {
        elements.buttons.optimize.addEventListener('click', autoOptimizeImage);
    }
    
    // 압축 품질 슬라이더
    if (elements.qualitySlider) {
        elements.qualitySlider.addEventListener('input', (e) => {
            const quality = Math.round(e.target.value * 100);
            elements.qualityLabel.textContent = quality;
            updateCompression();
        });
    }
    
    // 이미지 형식 선택
    ['formatJPEG', 'formatAVIF', 'formatWEBP'].forEach(formatId => {
        const element = document.getElementById(formatId);
        if (element) {
            element.addEventListener('change', updateCompression);
        }
    });
    
    // 파일 선택 버튼
    const fileSelectBtn = document.getElementById('fileSelectBtn');
    if (fileSelectBtn) {
        fileSelectBtn.addEventListener('click', () => {
            console.log('파일 선택 버튼 클릭됨');
            if (elements.imageInput) {
                elements.imageInput.click();
            }
        });
    }
    
    // 드래그 앤 드롭 (업로드 영역 전체)
    const uploadArea = document.querySelector('.upload-area');
    if (uploadArea) {
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('drop', handleDrop);
        
        // 업로드 영역 클릭 시 파일 선택 (버튼 영역 제외)
        uploadArea.addEventListener('click', (event) => {
            if (!event.target.closest('#fileSelectBtn')) {
                console.log('업로드 영역 클릭됨');
                if (elements.imageInput) {
                    elements.imageInput.click();
                }
            }
        });
    }
}

// 드래그 오버 처리
function handleDragOver(event) {
    event.preventDefault();
    event.currentTarget.style.borderColor = '#0d6efd';
    event.currentTarget.style.backgroundColor = '#f8f9ff';
}

// 드롭 처리
function handleDrop(event) {
    event.preventDefault();
    const files = event.dataTransfer.files;
    if (files.length > 0) {
        handleImageFile(files[0]);
    }
    
    // 스타일 리셋
    event.currentTarget.style.borderColor = '';
    event.currentTarget.style.backgroundColor = '';
}

// 이미지 업로드 처리
function handleImageUpload(event) {
    console.log('파일 업로드 이벤트 발생:', event);
    const file = event.target.files[0];
    if (file) {
        console.log('선택된 파일:', file.name, file.size, file.type);
        handleImageFile(file);
    } else {
        console.log('선택된 파일이 없습니다');
    }
}

// 이미지 파일 처리
function handleImageFile(file) {
    console.log('이미지 파일 처리 시작:', file.name, '크기:', (file.size / 1024 / 1024).toFixed(2) + 'MB');
    
    // 파일 타입 검증
    if (!file.type.startsWith('image/')) {
        alert('이미지 파일만 업로드 가능합니다.');
        return;
    }
    
    // 지원되는 형식 검증
    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
    if (!allowedTypes.includes(file.type)) {
        alert('JPG, PNG, WebP 파일만 지원됩니다.');
        return;
    }
    
    console.log('파일 검증 통과, FileReader 시작');
    
    // 큰 파일도 허용하고 압축으로 해결
    if (file.size > 5 * 1024 * 1024) {
        console.log('⚠️ 큰 파일 감지 (' + (file.size / 1024 / 1024).toFixed(2) + 'MB) - 압축으로 처리');
        showLargeFileNotice(file.size);
    }
    
    // 로컬에서 이미지 로드
    const reader = new FileReader();
    reader.onload = function(e) {
        console.log('FileReader 로드 완료');
        originalImageData = e.target.result;
        loadImageToCropper(originalImageData);
        goToCropStep();
    };
    reader.onerror = function(e) {
        console.error('FileReader 오류:', e);
        alert('파일 읽기 중 오류가 발생했습니다.');
    };
    reader.readAsDataURL(file);
}

// 큰 파일 안내 메시지 표시
function showLargeFileNotice(fileSize) {
    const sizeMB = (fileSize / 1024 / 1024).toFixed(2);
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-info alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3';
    alertDiv.style.cssText = 'z-index: 10000; min-width: 350px;';
    alertDiv.innerHTML = `
        <i class="fas fa-info-circle me-2"></i>
        큰 파일(${sizeMB}MB)을 업로드하셨습니다. 자동으로 압축하여 최적화합니다.
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    // 8초 후 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 8000);
}

// 크롭퍼에 이미지 로드
function loadImageToCropper(imageData) {
    if (!elements.cropImage) return;
    
    elements.cropImage.src = imageData;
    elements.cropImage.style.display = 'block';
    
    // 이미지가 로드된 후 크롭퍼 초기화
    elements.cropImage.onload = function() {
        console.log('이미지 로드 완료, 크롭퍼 초기화 시작');
        setTimeout(() => {
            initializeCropper();
        }, 100);
    };
}

// 크롭퍼 초기화 (Cropper.js 사용)
function initializeCropper() {
    if (cropper) {
        cropper.destroy();
    }
    
    console.log('🚀 Cropper.js 초기화 시작');
    
    // 한국 표준 증명사진 비율 적용 (가로3:세로4)
    const aspectRatio = 3 / 4; // 0.75 (세로가 더 긴 형태)
    
    cropper = new Cropper(elements.cropImage, {
        aspectRatio: aspectRatio, // 3:4 비율
        viewMode: 1, // 크롭 박스를 캔버스 내부로 제한
        dragMode: 'move', // 드래그 모드
        autoCropArea: 0.8, // 자동 크롭 영역 크기
        restore: false, // 크기 조정 시 크롭 박스 복원 안함
        guides: true, // 가이드 라인 표시
        center: true, // 중앙 표시자 표시
        highlight: true, // 크롭 박스 하이라이트
        cropBoxMovable: true, // 크롭 박스 이동 가능
        cropBoxResizable: true, // 크롭 박스 크기 조정 가능
        toggleDragModeOnDblclick: false, // 더블클릭으로 드래그 모드 토글 안함
        
        // 초기화 완료 시
        ready: function() {
            console.log('✅ Cropper.js 초기화 완료');
            console.log('📏 설정된 aspectRatio:', aspectRatio);
            console.log('🎯 목표: 증명사진 비율 (3:4, 세로가 더 긴 형태)');
            
            // 초기 크롭 데이터 확인
            const cropData = cropper.getData();
            const currentRatio = cropData.width / cropData.height;
            console.log('📊 초기 크롭 영역:', Math.round(cropData.width), 'x', Math.round(cropData.height));
            console.log('📊 초기 실제 비율:', currentRatio.toFixed(3), '목표:', aspectRatio.toFixed(3));
            
            // 초기 미리보기 업데이트
            updatePreview();
        },
        
        // 크롭 변경 시
        crop: function(event) {
            const data = event.detail;
            const currentRatio = data.width / data.height;
            const targetRatio = aspectRatio;
            
            // 비율 차이 허용 오차 (0.5%) - 더 엄격하게
            const tolerance = 0.005;
            
            // 비율이 목표에서 벗어날 경우 강제 조정 (대각선 비례 조정)
            if (Math.abs(currentRatio - targetRatio) > tolerance) {
                console.log('🔧 비율 자동 조정 (대각선 비례):', currentRatio.toFixed(3), '→', targetRatio.toFixed(3));
                
                // 대각선 비례 조정: 중심점을 유지하면서 비율 맞춤
                const centerX = data.x + data.width / 2;
                const centerY = data.y + data.height / 2;
                
                let newWidth, newHeight;
                
                // 현재 크기에서 비율에 맞게 조정 (대각선 확대/축소)
                if (currentRatio > targetRatio) {
                    // 너무 넓음 - 높이 기준으로 조정
                    newHeight = data.height;
                    newWidth = newHeight * targetRatio;
                } else {
                    // 너무 높음 - 너비 기준으로 조정
                    newWidth = data.width;
                    newHeight = newWidth / targetRatio;
                }
                
                // 중심점 유지하면서 새 위치 계산
                const newX = centerX - newWidth / 2;
                const newY = centerY - newHeight / 2;
                
                // 비율 강제 적용 (대각선 비례 유지)
                cropper.setData({
                    x: newX,
                    y: newY,
                    width: newWidth,
                    height: newHeight
                });
                
                console.log('✅ 대각선 비율 조정 완료:', newWidth.toFixed(1), 'x', newHeight.toFixed(1));
            } else {
                // 정상 범위 내 비율
                if (Math.abs(currentRatio - targetRatio) > 0.002) {
                    console.log('📏 비율 체크 (정상):', currentRatio.toFixed(3), '목표:', targetRatio.toFixed(3));
                }
            }
            
            // 미리보기 업데이트
            updatePreview();
        }
    });
    
    // 스마트 스크롤 기능 추가 (이미지 확대/축소 우선, 한계점에서 페이지 스크롤)
    setupSmartScroll();
}

// 스마트 스크롤 기능
function setupSmartScroll() {
    if (!cropper || !elements.cropImage) return;
    
    const cropContainer = elements.cropImage.parentElement;
    if (!cropContainer) return;
    
    // 최대/최소 줌 레벨 설정
    const MIN_ZOOM = 0.1;  // 최소 줌 (10%)
    const MAX_ZOOM = 3.0;  // 최대 줌 (300%)
    
    console.log('🖱️ 스마트 스크롤 기능 활성화');
    
    cropContainer.addEventListener('wheel', function(event) {
        if (!cropper) return;
        
        // 현재 줌 레벨 확인 (더 정확한 방식)
        const canvasData = cropper.getCanvasData();
        const containerData = cropper.getContainerData();
        const currentZoom = canvasData.naturalWidth > 0 ? canvasData.width / canvasData.naturalWidth : 1;
        
        const isZoomingIn = event.deltaY < 0;  // 휠을 위로 올리면 확대
        const isZoomingOut = event.deltaY > 0; // 휠을 아래로 내리면 축소
        
        console.log('🔍 현재 줌:', currentZoom.toFixed(2), '방향:', isZoomingIn ? '확대' : '축소');
        
        // 더 관대한 임계값 설정
        const maxThreshold = 2.8;  // 조금 더 낮은 최대값
        const minThreshold = 0.2;  // 조금 더 높은 최소값
        
        // 확대 시: 최대 줌 근처에서 페이지 스크롤 허용
        if (isZoomingIn && currentZoom >= maxThreshold) {
            updateZoomIndicator(currentZoom, '최대 확대');
            console.log('📈 최대 확대 근처 - 페이지 스크롤 실행');
            
            // 페이지 스크롤을 더 부드럽게 실행
            const scrollAmount = event.deltaY * 0.5; // 스크롤 강도 조절
            window.scrollBy({
                top: scrollAmount,
                behavior: 'smooth'
            });
            return;
        }
        
        // 축소 시: 최소 줌 근처에서 페이지 스크롤 허용  
        if (isZoomingOut && currentZoom <= minThreshold) {
            updateZoomIndicator(currentZoom, '최소 축소');
            console.log('📉 최소 축소 근처 - 페이지 스크롤 실행');
            
            // 페이지 스크롤을 더 부드럽게 실행
            const scrollAmount = event.deltaY * 0.5; // 스크롤 강도 조절
            window.scrollBy({
                top: scrollAmount,
                behavior: 'smooth'
            });
            return;
        }
        
        // 이미지 확대/축소 범위 내에서는 기본 스크롤 차단하고 줌 적용
        event.preventDefault();
        event.stopPropagation();
        
        const zoomDelta = isZoomingIn ? 0.1 : -0.1;
        cropper.zoom(zoomDelta);
        
        // 줌 표시기 업데이트
        const newZoom = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, currentZoom + zoomDelta));
        updateZoomIndicator(newZoom, isZoomingIn ? '확대' : '축소');
        
    }, { passive: false }); // passive: false로 설정해야 preventDefault 작동
}

// 줌 표시기 업데이트
function updateZoomIndicator(zoomLevel, status) {
    if (!elements.zoomIndicator || !elements.zoomLevel || !elements.zoomStatus) return;
    
    // 줌 레벨을 퍼센트로 표시
    const zoomPercent = Math.round(zoomLevel * 100);
    elements.zoomLevel.textContent = zoomPercent + '%';
    
    // 상태 메시지 업데이트
    let statusMessage = '';
    let statusClass = '';
    
    if (status === '최대 확대') {
        statusMessage = '(최대 - 페이지 스크롤 가능)';
        statusClass = 'text-warning';
    } else if (status === '최소 축소') {
        statusMessage = '(최소 - 페이지 스크롤 가능)';
        statusClass = 'text-info';
    } else {
        statusMessage = `(${status} 중)`;
        statusClass = 'text-success';
    }
    
    elements.zoomStatus.textContent = statusMessage;
    elements.zoomStatus.className = `ms-2 ${statusClass}`;
    
    // 줌 표시기 보이기
    elements.zoomIndicator.style.display = 'block';
    
    // 3초 후 자동 숨김
    clearTimeout(window.zoomIndicatorTimeout);
    window.zoomIndicatorTimeout = setTimeout(() => {
        if (elements.zoomIndicator) {
            elements.zoomIndicator.style.display = 'none';
        }
    }, 3000);
}

// 미리보기 업데이트
function updatePreview() {
    if (!cropper || !elements.previewCanvas) {
        return;
    }
    
    console.log('🖼️ 미리보기 업데이트 시작');
    
    // 크롭된 이미지를 캔버스에 그리기
    const canvas = cropper.getCroppedCanvas({
        width: 90,  // 미리보기 캔버스 크기와 동일
        height: 120,
        imageSmoothingEnabled: true,
        imageSmoothingQuality: 'high'
    });
    
    if (canvas) {
        const ctx = elements.previewCanvas.getContext('2d');
        ctx.clearRect(0, 0, elements.previewCanvas.width, elements.previewCanvas.height);
        
        // 크롭된 이미지를 미리보기 캔버스에 그리기
        ctx.drawImage(canvas, 0, 0, elements.previewCanvas.width, elements.previewCanvas.height);
        
        console.log('✅ 미리보기 업데이트 완료');
    }
}

// 크롭 완료 후 3단계로 이동
function cropAndSaveImage() {
    if (!cropper) {
        alert('이미지를 먼저 로드해주세요.');
        return;
    }
    
    setButtonLoading(elements.buttons.cropAndSave, true, '처리 중...');
    
    try {
        // 최종 크롭된 이미지 생성 (고품질)
        const canvas = cropper.getCroppedCanvas({
            width: 300,   // 최종 이미지 가로 크기
            height: 400,  // 최종 이미지 세로 크기 (3:4 비율)
            imageSmoothingEnabled: true,
            imageSmoothingQuality: 'high'
        });
        
        if (canvas) {
            // 크롭된 원본 데이터를 전역 변수에 저장
            window.croppedCanvas = canvas;
            window.originalFile = elements.imageInput.files[0];
            
            console.log('✅ 크롭 완료 - 3단계로 이동');
            
            // 3단계 압축 단계로 이동
            goToCompressionStep();
            
        } else {
            throw new Error('캔버스 생성 실패');
        }
        
    } catch (error) {
        console.error('크롭 처리 오류:', error);
        alert('이미지 처리 중 오류가 발생했습니다.');
    } finally {
        setButtonLoading(elements.buttons.cropAndSave, false);
    }
}

// 3단계: 압축 및 SEO 최적화 단계로 이동
function goToCompressionStep() {
    hideAllSections();
    if (elements.compressionSection) elements.compressionSection.style.display = 'block';
    updateStepIndicator(3);
    
    // 초기 압축 적용 및 미리보기 업데이트
    updateCompression();
    generateAltText();
}

// 이미지 압축 업데이트 (다중 형식 지원)
function updateCompression() {
    if (!window.croppedCanvas) {
        console.error('❌ 크롭된 캔버스가 없습니다');
        return;
    }
    
    const quality = parseFloat(elements.qualitySlider.value || 0.8);
    const selectedFormat = getSelectedImageFormat();
    
    console.log('🔄 이미지 압축 업데이트 - 형식:', selectedFormat.toUpperCase(), '품질:', Math.round(quality * 100) + '%');
    
    try {
        let compressedImageData;
        let actualFormat = selectedFormat;
        let formatSupported = false;
        
        // 단계별 형식 지원 확인 및 압축
        if (selectedFormat === 'avif') {
            console.log('🔍 AVIF 지원 확인 중...');
            formatSupported = isFormatSupported('image/avif');
            if (formatSupported) {
                compressedImageData = window.croppedCanvas.toDataURL('image/avif', quality);
                console.log('✅ AVIF 형식으로 압축 성공');
            } else {
                console.log('⚠️ AVIF 미지원 - WebP 시도');
                formatSupported = isFormatSupported('image/webp');
                if (formatSupported) {
                    compressedImageData = window.croppedCanvas.toDataURL('image/webp', quality);
                    actualFormat = 'webp';
                    console.log('✅ WebP 형식으로 압축 성공 (AVIF 대체)');
                    showFormatFallbackMessage('AVIF', 'WebP');
                } else {
                    console.log('⚠️ WebP도 미지원 - JPEG 사용');
                    compressedImageData = window.croppedCanvas.toDataURL('image/jpeg', quality);
                    actualFormat = 'jpeg';
                    console.log('✅ JPEG 형식으로 압축 성공 (AVIF 대체)');
                    showFormatFallbackMessage('AVIF', 'JPEG');
                }
            }
        } else if (selectedFormat === 'webp') {
            console.log('🔍 WebP 지원 확인 중...');
            formatSupported = isFormatSupported('image/webp');
            if (formatSupported) {
                compressedImageData = window.croppedCanvas.toDataURL('image/webp', quality);
                console.log('✅ WebP 형식으로 압축 성공');
            } else {
                console.log('⚠️ WebP 미지원 - JPEG 사용');
                compressedImageData = window.croppedCanvas.toDataURL('image/jpeg', quality);
                actualFormat = 'jpeg';
                console.log('✅ JPEG 형식으로 압축 성공 (WebP 대체)');
                showFormatFallbackMessage('WebP', 'JPEG');
            }
        } else {
            // JPEG는 모든 브라우저에서 지원
            compressedImageData = window.croppedCanvas.toDataURL('image/jpeg', quality);
            console.log('✅ JPEG 형식으로 압축 성공');
        }
        
        // 데이터 유효성 검증
        if (!compressedImageData || !compressedImageData.startsWith('data:image/')) {
            throw new Error('압축된 이미지 데이터가 유효하지 않습니다');
        }
        
        // 현재 형식 표시 업데이트
        if (elements.currentFormat) {
            elements.currentFormat.textContent = actualFormat.toUpperCase();
        }
        
        // 최종 미리보기 업데이트
        if (elements.finalPreviewImage) {
            elements.finalPreviewImage.src = compressedImageData;
            elements.finalPreviewImage.onload = function() {
                console.log('✅ 최종 미리보기 이미지 로드 완료');
            };
            elements.finalPreviewImage.onerror = function() {
                console.error('❌ 최종 미리보기 이미지 로드 실패');
            };
        }
        
        // 압축 정보 업데이트
        updateCompressionInfo(compressedImageData, actualFormat);
        
        // 압축된 데이터 및 형식 저장
        window.compressedImageData = compressedImageData;
        window.selectedImageFormat = actualFormat;
        
        console.log('✅ 압축 처리 완료 - 형식:', actualFormat.toUpperCase(), '데이터 크기:', Math.round(compressedImageData.length / 1024) + 'KB');
        
    } catch (error) {
        console.error('❌ 압축 처리 오류:', error);
        
        // 오류 시 안전한 JPEG 폴백
        try {
            const fallbackData = window.croppedCanvas.toDataURL('image/jpeg', 0.8);
            if (elements.finalPreviewImage) {
                elements.finalPreviewImage.src = fallbackData;
            }
            updateCompressionInfo(fallbackData, 'jpeg');
            window.compressedImageData = fallbackData;
            window.selectedImageFormat = 'jpeg';
            
            console.log('🔄 JPEG 폴백 처리 완료');
            showFormatFallbackMessage(selectedFormat.toUpperCase(), 'JPEG');
        } catch (fallbackError) {
            console.error('❌ 폴백 처리도 실패:', fallbackError);
            alert('이미지 압축 처리 중 오류가 발생했습니다. 다른 이미지를 선택해주세요.');
        }
    }
}

// 선택된 이미지 형식 가져오기
function getSelectedImageFormat() {
    if (elements.formatAVIF && elements.formatAVIF.checked) return 'avif';
    if (elements.formatWEBP && elements.formatWEBP.checked) return 'webp';
    if (elements.formatJPEG && elements.formatJPEG.checked) return 'jpeg';
    return 'avif'; // 기본값
}

// 브라우저 형식 지원 여부 확인 (개선된 버전)
function isFormatSupported(mimeType) {
    // 1. 기본 브라우저 지원 확인
    const canvas = document.createElement('canvas');
    canvas.width = 2;
    canvas.height = 2;
    const ctx = canvas.getContext('2d');
    
    // 작은 이미지 데이터 생성
    ctx.fillStyle = 'rgb(255, 0, 0)';
    ctx.fillRect(0, 0, 1, 1);
    ctx.fillStyle = 'rgb(0, 255, 0)';
    ctx.fillRect(1, 0, 1, 1);
    ctx.fillStyle = 'rgb(0, 0, 255)';
    ctx.fillRect(0, 1, 1, 1);
    ctx.fillStyle = 'rgb(255, 255, 255)';
    ctx.fillRect(1, 1, 1, 1);
    
    try {
        const dataURL = canvas.toDataURL(mimeType, 0.9);
        const isSupported = dataURL.startsWith(`data:${mimeType}`);
        
        console.log(`🔍 형식 지원 확인: ${mimeType} - ${isSupported ? '지원됨' : '미지원'}`);
        console.log(`📄 DataURL 시작: ${dataURL.substring(0, 50)}...`);
        
        return isSupported;
    } catch (e) {
        console.warn(`⚠️ 형식 지원 확인 오류: ${mimeType}`, e);
        return false;
    }
}

// 형식 폴백 메시지 표시
function showFormatFallbackMessage(original, fallback) {
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-warning alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3';
    alertDiv.style.cssText = 'z-index: 10000; min-width: 300px;';
    alertDiv.innerHTML = `
        <i class="fas fa-exclamation-triangle me-2"></i>
        ${original} 형식이 지원되지 않아 ${fallback}로 변환됩니다.
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    // 5초 후 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}

// 자동 최적화 기능
function autoOptimizeImage() {
    console.log('🚀 자동 최적화 시작');
    
    // AVIF가 지원되면 AVIF + 70% 품질 사용
    if (isFormatSupported('image/avif')) {
        elements.formatAVIF.checked = true;
        elements.qualitySlider.value = 0.7;
        elements.qualityLabel.textContent = '70';
        console.log('✅ AVIF 70% 품질로 자동 최적화');
    } 
    // WebP가 지원되면 WebP + 75% 품질 사용
    else if (isFormatSupported('image/webp')) {
        elements.formatWEBP.checked = true;
        elements.qualitySlider.value = 0.75;
        elements.qualityLabel.textContent = '75';
        console.log('✅ WebP 75% 품질로 자동 최적화');
    } 
    // 둘 다 안되면 JPEG + 80% 품질
    else {
        elements.formatJPEG.checked = true;
        elements.qualitySlider.value = 0.8;
        elements.qualityLabel.textContent = '80';
        console.log('✅ JPEG 80% 품질로 자동 최적화');
    }
    
    // 압축 업데이트
    updateCompression();
    
    // 성공 메시지
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-success alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3';
    alertDiv.style.cssText = 'z-index: 10000; min-width: 300px;';
    alertDiv.innerHTML = `
        <i class="fas fa-magic me-2"></i>자동 최적화가 완료되었습니다!
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    setTimeout(() => alertDiv.remove(), 3000);
}

// 압축 정보 업데이트 (형식 정보 포함)
function updateCompressionInfo(compressedImageData, format) {
    if (!window.originalFile || !elements.compressionSavings) return;
    
    // 원본 파일 크기
    const originalSize = window.originalFile.size;
    
    // 압축된 파일 크기 (Base64를 Blob으로 변환하여 계산)
    const compressedSize = dataURLtoBlob(compressedImageData).size;
    
    // 절약률 계산
    const savings = ((originalSize - compressedSize) / originalSize * 100).toFixed(1);
    
    // 형식별 예상 추가 절약률 표시
    let formatBenefit = '';
    if (format === 'avif') {
        formatBenefit = ' (AVIF로 최대 절약)';
    } else if (format === 'webp') {
        formatBenefit = ' (WebP로 효율적 압축)';
    } else if (format === 'jpeg') {
        formatBenefit = ' (JPEG 호환성 우선)';
    }
    
    console.log('📊 압축 정보:', {
        format: format.toUpperCase(),
        originalSize: formatFileSize(originalSize),
        compressedSize: formatFileSize(compressedSize),
        savings: savings + '%'
    });
    
    elements.compressionSavings.innerHTML = 
        `<div>${savings}% 절약 (${formatFileSize(originalSize)} → ${formatFileSize(compressedSize)})</div>
         <small class="text-muted">${format.toUpperCase()} 형식${formatBenefit}</small>`;
}

// Alt 텍스트 자동 생성
function generateAltText() {
    if (!elements.altTextInput) return;
    
    // 기본 Alt 텍스트 생성
    let altText = '사용자 프로필 사진';
    
    // 파일명에서 추가 정보 추출
    if (window.originalFile && window.originalFile.name) {
        const fileName = window.originalFile.name.replace(/\.[^/.]+$/, ''); // 확장자 제거
        if (fileName.length > 0 && fileName !== 'image') {
            altText += ` - ${fileName}`;
        }
    }
    
    elements.altTextInput.value = altText;
    console.log('🏷️ Alt 텍스트 자동 생성:', altText);
}

// 압축된 이미지를 서버에 저장
function saveCompressedImageToServer() {
    console.log('📤 최종 이미지 업로드 시작');
    
    if (!window.compressedImageData) {
        console.error('❌ 압축된 이미지 데이터가 없습니다');
        alert('압축된 이미지가 없습니다. 다시 시도해주세요.');
        return;
    }
    
    const altText = elements.altTextInput?.value?.trim() || '사용자 프로필 사진';
    const selectedFormat = window.selectedImageFormat || 'jpeg';
    const quality = Math.round((elements.qualitySlider?.value || 0.8) * 100);
    
    console.log('📋 업로드 정보:');
    console.log('  - Alt 텍스트:', altText);
    console.log('  - 형식:', selectedFormat.toUpperCase());
    console.log('  - 품질:', quality + '%');
    console.log('  - 데이터 크기:', Math.round(window.compressedImageData.length / 1024) + 'KB');
    
    if (elements.buttons.saveImage) {
        setButtonLoading(elements.buttons.saveImage, true, '저장 중...');
    }
    
    // Base64 데이터를 Blob으로 변환
    const blob = dataURLtoBlob(window.compressedImageData);
    console.log('📦 Blob 생성 완료 - 크기:', formatFileSize(blob.size), '타입:', blob.type);
    
    const formData = new FormData();
    formData.append('croppedImage', blob, `profile.${selectedFormat}`);
    formData.append('altText', altText);
    formData.append('format', selectedFormat);
    formData.append('quality', quality.toString());
    
    console.log('📤 FormData 전송 시작...');
    
    fetch('/member/myinfo/crop-image/save', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        console.log('📨 서버 응답 수신:', response.status, response.statusText);
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        return response.json();
    })
    .then(data => {
        if (elements.buttons.saveImage) {
            setButtonLoading(elements.buttons.saveImage, false);
        }
        
        console.log('📄 서버 응답 데이터:', data);
        
        if (data.success) {
            // 최종 완료 미리보기 설정
            if (elements.finalPreview) {
                elements.finalPreview.src = window.compressedImageData;
            }
            
            // 성공 시 완료 단계 표시
            goToCompleteStep();
            console.log('✅ 프로필 이미지 저장 성공');
            
            // 성공 메시지 표시
            showSuccessMessage('프로필 이미지가 성공적으로 저장되었습니다!');
            
        } else {
            console.error('❌ 서버에서 실패 응답:', data.message);
            alert(data.message || '이미지 저장에 실패했습니다.');
        }
    })
    .catch(error => {
        if (elements.buttons.saveImage) {
            setButtonLoading(elements.buttons.saveImage, false);
        }
        console.error('❌ 업로드 오류:', error);
        alert('이미지 저장 중 오류가 발생했습니다: ' + error.message);
    });
}

// 성공 메시지 표시
function showSuccessMessage(message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-success alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3';
    alertDiv.style.cssText = 'z-index: 10000; min-width: 350px;';
    alertDiv.innerHTML = `
        <i class="fas fa-check-circle me-2"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    // 5초 후 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}

// Base64를 Blob으로 변환
function dataURLtoBlob(dataurl) {
    const arr = dataurl.split(',');
    const mime = arr[0].match(/:(.*?);/)[1];
    const bstr = atob(arr[1]);
    let n = bstr.length;
    const u8arr = new Uint8Array(n);
    while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
    }
    return new Blob([u8arr], { type: mime });
}

// 파일 크기 포맷팅
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// 서버에 크롭된 이미지 저장
function saveImageToServer(compressedImageData, altText) {
    const formData = new FormData();
    formData.append('croppedImage', compressedImageData);
    formData.append('altText', altText);
    
    console.log('📤 서버 업로드 시작 - Alt 텍스트:', altText);
    
    fetch('/member/myinfo/crop-image/save', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        setButtonLoading(elements.buttons.cropAndSave, false);
        
        if (data.success) {
            // 최종 미리보기 설정
            if (elements.finalPreview) {
                elements.finalPreview.src = compressedImageData;
            }
            
            // 성공 시 완료 단계 표시
            goToCompleteStep();
            console.log('✅ 프로필 이미지 저장 성공');
            
        } else {
            alert(data.message || '이미지 저장에 실패했습니다.');
        }
    })
    .catch(error => {
        setButtonLoading(elements.buttons.cropAndSave, false);
        console.error('저장 오류:', error);
        alert('이미지 저장 중 오류가 발생했습니다.');
    });
}

// 단계 이동 함수들
function goToUploadStep() {
    hideAllSections();
    if (elements.uploadSection) elements.uploadSection.style.display = 'block';
    updateStepIndicator(1);
    
    // 전체 초기화
    if (elements.imageInput) elements.imageInput.value = '';
    if (cropper) {
        cropper.destroy();
        cropper = null;
    }
    originalImageData = null;
    originalImage = null;
    window.croppedCanvas = null;
    window.originalFile = null;
    window.compressedImageData = null;
}

function goToCropStep() {
    hideAllSections();
    if (elements.cropSection) elements.cropSection.style.display = 'block';
    updateStepIndicator(2);
}

function goToCompleteStep() {
    hideAllSections();
    if (elements.completeSection) elements.completeSection.style.display = 'block';
    updateStepIndicator(4);
}

// 모든 섹션 숨기기
function hideAllSections() {
    if (elements.uploadSection) elements.uploadSection.style.display = 'none';
    if (elements.cropSection) elements.cropSection.style.display = 'none';
    if (elements.compressionSection) elements.compressionSection.style.display = 'none';
    if (elements.completeSection) elements.completeSection.style.display = 'none';
}

// 단계 표시기 업데이트
function updateStepIndicator(currentStep) {
    // 모든 단계 초기화
    Object.values(elements.steps).forEach(step => {
        if (step) {
            step.classList.remove('active', 'completed');
        }
    });
    
    // 현재 단계까지 활성화
    for (let i = 1; i <= currentStep; i++) {
        const step = elements.steps[`step${i}`];
        if (step) {
            if (i === currentStep) {
                step.classList.add('active');
            } else {
                step.classList.add('completed');
            }
        }
    }
}

// 버튼 로딩 상태 설정
function setButtonLoading(button, isLoading, loadingText = '처리 중...') {
    if (!button) return;
    
    if (isLoading) {
        button.disabled = true;
        button.classList.add('loading');
        button.setAttribute('data-original-text', button.innerHTML);
        button.innerHTML = `<i class="fas fa-spinner fa-spin me-1"></i>${loadingText}`;
    } else {
        button.disabled = false;
        button.classList.remove('loading');
        const originalText = button.getAttribute('data-original-text');
        if (originalText) {
            button.innerHTML = originalText;
        }
    }
}
</script>

<!-- 스타일 추가 -->
<style>
/* 단계 표시기 스타일 */
.steps-indicator {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 30px;
}

.step-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
}

.step-circle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: #e9ecef;
    border: 3px solid #dee2e6;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6c757d;
    font-size: 18px;
    transition: all 0.3s ease;
    margin-bottom: 8px;
}

.step-item.active .step-circle {
    background: #007bff;
    border-color: #007bff;
    color: white;
    transform: scale(1.1);
    box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
}

.step-item.completed .step-circle {
    background: #28a745;
    border-color: #28a745;
    color: white;
}

.step-label {
    font-size: 12px;
    color: #6c757d;
    font-weight: 500;
    text-align: center;
    margin-top: 5px;
}

.step-item.active .step-label {
    color: #007bff;
    font-weight: 600;
}

/* SEO 최적화 기능 스타일 */
.keyword-suggestions {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
}

.keyword-group {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 5px;
}

.keyword-btn {
    font-size: 0.875rem;
    padding: 5px 10px;
    border-radius: 15px;
    transition: all 0.2s ease;
    cursor: pointer;
}

.keyword-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.keyword-btn.btn-success {
    animation: keywordClick 0.5s ease;
}

@keyframes keywordClick {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.seo-optimization-section {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 10px;
    padding: 20px;
    border: 1px solid #dee2e6;
}

.seo-tips {
    border-left: 4px solid #17a2b8;
    background: rgba(23, 162, 184, 0.1);
}

#profileNameInput {
    border-radius: 8px;
}

#previewProfileName {
    color: #17a2b8;
    background: rgba(23, 162, 184, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
}

.input-group .btn {
    border-radius: 0 8px 8px 0;
}

.form-label {
    font-weight: 600;
    color: #495057;
}

/* Cropper.js 가시성 개선 */
.cropper-center::before,
.cropper-center::after {
    background-color: #007bff !important;
    opacity: 0.8 !important;
    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8) !important;
}

.cropper-line {
    background-color: #007bff !important;
    opacity: 0.6 !important;
}

.cropper-point {
    background-color: #007bff !important;
    opacity: 0.8 !important;
    width: 8px !important;
    height: 8px !important;
    border-radius: 50% !important;
    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8) !important;
}

.step-item.completed .step-label {
    color: #28a745;
    font-weight: 600;
}

.step-connector {
    width: 80px;
    height: 3px;
    background: #dee2e6;
    margin: 0 10px;
    margin-top: -25px;
    z-index: 1;
    transition: background 0.3s ease;
}

.step-item.completed + .step-connector {
    background: #28a745;
}

/* 업로드 영역 스타일 */
.upload-area {
    border: 2px dashed #dee2e6;
    border-radius: 12px;
    padding: 40px 20px;
    text-align: center;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    transition: all 0.3s ease;
    cursor: pointer;
}

.upload-area:hover {
    border-color: #007bff;
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,123,255,0.15);
}

.upload-icon i {
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

.crop-container, .crop-preview-panel {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.crop-image-container {
    border-radius: 8px;
    overflow: hidden;
    background: #f8f9fa;
    min-height: 300px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.image-info-panel {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    border: 1px solid #e9ecef;
}

.zoom-indicator {
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 8px 12px;
    border-radius: 20px;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 9999;
    animation: fadeInOut 0.3s ease;
}

@keyframes fadeInOut {
    from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}

.crop-actions {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    border: 1px solid #e9ecef;
}

/* 3단계 압축 섹션 */
.compression-section {
    padding: 20px 0;
}

.final-preview-panel, .compression-settings {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.final-image-container {
    text-align: center;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: inline-block;
}

.compression-info {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    border: 1px solid #e9ecef;
    text-align: center;
}

.compression-savings {
    font-size: 18px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
}

/* Alt 텍스트 섹션 */
.alt-text-section {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 15px;
}

.alt-text-section .form-label {
    color: #856404;
    font-weight: 600;
}

/* 슬라이더 스타일 */
.form-range {
    appearance: none;
    background: transparent;
    cursor: pointer;
    height: 6px;
}

.form-range::-webkit-slider-track {
    background: #dee2e6;
    height: 6px;
    border-radius: 3px;
}

.form-range::-webkit-slider-thumb {
    appearance: none;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #007bff;
    cursor: pointer;
    border: 2px solid #fff;
    box-shadow: 0 2px 6px rgba(0,123,255,0.3);
    transition: all 0.2s ease;
}

.form-range::-webkit-slider-thumb:hover {
    background: #0056b3;
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0,123,255,0.5);
}

.final-actions {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    border: 1px solid #e9ecef;
}

.complete-section {
    text-align: center;
    padding: 40px 20px;
}

.success-icon {
    animation: bounceIn 0.6s ease;
}

@keyframes bounceIn {
    0% { transform: scale(0.3); opacity: 0; }
    50% { transform: scale(1.05); }
    70% { transform: scale(0.9); }
    100% { transform: scale(1); opacity: 1; }
}

/* Cropper.js 가시성 개선 (중앙 십자가를 파란색으로) */
.cropper-center::before,
.cropper-center::after {
    background-color: #007bff !important;
    opacity: 0.8 !important;
    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8) !important;
}

.cropper-line {
    background-color: #007bff !important;
    opacity: 0.6 !important;
}

.cropper-point {
    background-color: #007bff !important;
    opacity: 0.8 !important;
    width: 8px !important;
    height: 8px !important;
    border: 2px solid #ffffff !important;
    border-radius: 50% !important;
    box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3) !important;
}

.cropper-point:hover {
    background-color: #0056b3 !important;
    opacity: 1 !important;
    transform: scale(1.2) !important;
}

.cropper-face {
    background-color: rgba(0, 123, 255, 0.1) !important;
}

.cropper-crop-box {
    border: 2px solid #007bff !important;
    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.5) !important;
}

/* 파일명 변환 UI 스타일 */
.filename-section {
    background: linear-gradient(135deg, #e3f2fd 0%, #f8f9fa 100%);
    border: 1px solid #bbdefb;
    border-radius: 10px;
    padding: 20px;
}

.filename-section h6 {
    color: #1976d2;
    font-weight: 600;
}

.keyword-suggestions {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    border: 1px solid #e9ecef;
}

.keyword-group {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 5px;
}

.keyword-btn {
    font-size: 0.875rem;
    padding: 5px 10px;
    border-radius: 15px;
    transition: all 0.2s ease;
    cursor: pointer;
}

.keyword-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.keyword-btn.btn-success {
    animation: keywordClick 0.5s ease;
}

@keyframes keywordClick {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

#previewProfileName {
    color: #1976d2;
    background: rgba(25, 118, 210, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
}

.filename-section .input-group .btn {
    border-radius: 0 8px 8px 0;
}

.filename-section .form-label {
    font-weight: 600;
    color: #495057;
}
</style>

</body>
</html>
````

## File: src/main/resources/templates/member/login.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>로그인 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>
    
    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <div class="container mt-4">
            <!-- 브레드크럼 -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">홈</a></li>
                    <li class="breadcrumb-item active" aria-current="page">로그인</li>
                </ol>
            </nav>
            
            <div class="row justify-content-center">
                <div class="col-md-6 col-lg-4">
                    <!-- 로그인 카드 -->
                    <div class="card shadow">
                        <div class="card-body p-4">
                            <!-- 제목 -->
                            <div class="text-center mb-4">
                                <h3 class="card-title fw-bold text-primary">
                                    <i class="fas fa-sign-in-alt me-2"></i>
                                    로그인
                                </h3>
                                <p class="text-muted">CareLink에 오신 것을 환영합니다</p>
                            </div>
                            
                            <!-- 로그인 폼 -->
                            <form th:action="@{/member/login}" th:object="${loginDTO}" method="post" novalidate>
                                <!-- 사용자 ID -->
                                <div class="mb-3">
                                    <label for="userId" class="form-label">
                                        <i class="fas fa-user me-1"></i>아이디
                                    </label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="userId" 
                                           th:field="*{userId}"
                                           placeholder="아이디를 입력하세요"
                                           required>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('userId')}" th:errors="*{userId}"></div>
                                </div>
                                
                                <!-- 비밀번호 -->
                                <div class="mb-3">
                                    <label for="password" class="form-label">
                                        <i class="fas fa-lock me-1"></i>비밀번호
                                    </label>
                                    <div class="input-group">
                                        <input type="password" 
                                               class="form-control" 
                                               id="password" 
                                               th:field="*{password}"
                                               placeholder="비밀번호를 입력하세요"
                                               required>
                                        <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
                                </div>
                                
                                <!-- 로그인 상태 유지 -->
                                <div class="mb-3 form-check">
                                    <input type="checkbox" 
                                           class="form-check-input" 
                                           id="rememberMe" 
                                           th:field="*{rememberMe}">
                                    <label class="form-check-label" for="rememberMe">
                                        로그인 상태 유지
                                    </label>
                                </div>
                                
                                <!-- 로그인 버튼 -->
                                <div class="d-grid mb-3">
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <i class="fas fa-sign-in-alt me-2"></i>
                                        로그인
                                    </button>
                                </div>
                            </form>
                            
                            <!-- 링크들 -->
                            <div class="row text-center">
                                <div class="col">
                                    <a href="/member/join" class="btn btn-outline-primary">
                                        <i class="fas fa-user-plus me-1"></i>
                                        회원가입
                                    </a>
                                </div>
                            </div>
                            
                            <hr class="my-4">
                            
                            <!-- 테스트 계정 안내 -->
                            <div class="alert alert-info" role="alert">
                                <h6 class="alert-heading">
                                    <i class="fas fa-info-circle me-2"></i>
                                    테스트 계정 안내
                                </h6>
                                <div class="row text-center">
                                    <div class="col-6">
                                        <small>
                                            <strong>관리자</strong><br>
                                            ID: admin<br>
                                            PW: admin123
                                        </small>
                                    </div>
                                    <div class="col-6">
                                        <small>
                                            <strong>일반 사용자</strong><br>
                                            ID: user01<br>
                                            PW: user123
                                        </small>
                                    </div>
                                </div>
                                <div class="row text-center mt-2">
                                    <div class="col-6">
                                        <small>
                                            <strong>사용자2</strong><br>
                                            ID: user02<br>
                                            PW: user123
                                        </small>
                                    </div>
                                    <div class="col-6">
                                        <small>
                                            <strong>시설관리자</strong><br>
                                            ID: facility01<br>
                                            PW: facility123
                                        </small>
                                    </div>
                                </div>
                                <hr class="my-2">
                                <div class="text-center">
                                    <small class="text-muted">
                                        <i class="fas fa-info-circle me-1"></i>
                                        테스트 계정을 클릭하면 자동으로 입력됩니다
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </main>
    
    <!-- 푸터 -->
    <footer th:replace="~{layout/footer :: footer}"></footer>
    
    <!-- JavaScript -->
    <div th:replace="~{layout/footer :: scripts}"></div>
    
    <script>
        $(document).ready(function() {
            // 비밀번호 표시/숨김 토글
            $('#togglePassword').click(function() {
                const passwordField = $('#password');
                const icon = $(this).find('i');
                
                if (passwordField.attr('type') === 'password') {
                    passwordField.attr('type', 'text');
                    icon.removeClass('fa-eye').addClass('fa-eye-slash');
                } else {
                    passwordField.attr('type', 'password');
                    icon.removeClass('fa-eye-slash').addClass('fa-eye');
                }
            });
            
            // 테스트 계정 클릭 시 자동 입력
            $('.alert').on('click', 'small', function() {
                const text = $(this).text();
                if (text.includes('admin')) {
                    $('#userId').val('admin');
                    $('#password').val('admin123');
                } else if (text.includes('user01')) {
                    $('#userId').val('user01');
                    $('#password').val('user123');
                } else if (text.includes('user02')) {
                    $('#userId').val('user02');
                    $('#password').val('user123');
                } else if (text.includes('facility01')) {
                    $('#userId').val('facility01');
                    $('#password').val('facility123');
                }
            });
            
            // 로그인 폼에서는 유효성 검사 스타일 제거
            $('#userId, #password').on('input blur', function() {
                $(this).removeClass('is-valid is-invalid');
            });
        });
    </script>
</body>
</html>
````

## File: src/main/resources/templates/member/myinfo.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>마이페이지 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <!-- 브레드크럼 -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item active" aria-current="page">마이페이지</li>
            </ol>
        </nav>
        
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <div class="card shadow">
                    <div class="card-body p-4">
                        <div class="text-center mb-4">
                            <h3 class="card-title fw-bold text-primary">
                                <i class="fas fa-user-circle me-2"></i>
                                마이페이지
                            </h3>
                            <p class="text-muted">내 정보를 관리하세요</p>
                        </div>

                        <form th:action="@{/member/myinfo/update}" th:object="${memberDTO}" method="post" id="mypageForm" enctype="multipart/form-data">
                            <input type="hidden" th:field="*{memberId}">
                            <input type="hidden" th:field="*{userId}">
                            <input type="hidden" th:field="*{password}">

                            <div class="mb-3">
                                <label for="userId" class="form-label">
                                    <i class="fas fa-user me-1"></i>아이디
                                </label>
                                <input type="text"
                                       class="form-control"
                                       id="userIdDisplay"
                                       th:value="*{userId}"
                                       readonly disabled >
                            </div>

                            <div class="mb-3">
                                <label for="name" class="form-label">
                                    <i class="fas fa-user-tag me-1"></i>이름
                                </label>
                                <input type="text"
                                       class="form-control"
                                       th:classappend="${#fields.hasErrors('name')} ? 'is-invalid'"
                                       id="name"
                                       th:field="*{name}"
                                       placeholder="이름을 입력하세요"
                                       required>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                            </div>

                            <div class="mb-3">
                                <label for="email" class="form-label">
                                    <i class="fas fa-envelope me-1"></i>이메일
                                </label>
                                <input type="email"
                                       class="form-control"
                                       th:classappend="${#fields.hasErrors('email')} ? 'is-invalid'"
                                       id="email"
                                       th:field="*{email}"
                                       placeholder="이메일을 입력하세요"
                                       required>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
                            </div>

                            <div class="mb-3">
                                <label for="phone" class="form-label">
                                    <i class="fas fa-mobile-alt me-1"></i>휴대폰 번호
                                </label>
                                <input type="tel"
                                       class="form-control"
                                       th:classappend="${#fields.hasErrors('phone')} ? 'is-invalid'"
                                       id="phone"
                                       th:field="*{phone}"
                                       placeholder="휴대폰 번호를 입력하세요 (예: 010-1234-5678)">
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}"></div>
                            </div>

                            <div class="mb-3">
                                <label for="address" class="form-label">
                                    <i class="fas fa-map-marker-alt me-1"></i>주소 (선택사항)
                                </label>
                                <div class="input-group mb-2">
                                    <input type="text"
                                           class="form-control"
                                           th:classappend="${#fields.hasErrors('address')} ? 'is-invalid'"
                                           id="address"
                                           th:field="*{address}" 
                                           placeholder="주소 검색 버튼을 클릭하세요"
                                           readonly>
                                    <button type="button" class="btn btn-outline-primary" onclick="openAddressSearch('address')">
                                        <i class="fas fa-search me-1"></i>주소 검색
                                    </button>
                                </div>
                                <input type="text" 
                                       class="form-control" 
                                       id="detailAddress" 
                                       th:field="*{detailAddress}"
                                       placeholder="상세 주소를 입력하세요 (예: 101동 201호, 2층)">
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('address')}" th:errors="*{address}"></div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-image me-1"></i>프로필 이미지 <span class="text-muted">(구직 신청 시 사용)</span>
                                </label>
                                <div class="text-center p-3 border border-2 border-dashed rounded">
                                    <!-- 현재 등록된 프로필 이미지 -->
                                    <div th:if="${memberDTO.profileImage}" class="current-profile-image mb-3">
                                        <p class="text-success mb-2">
                                            <i class="fas fa-check-circle me-1"></i>현재 등록된 프로필 이미지:
                                        </p>
                                        <img th:src="@{/profile_images/{image}(image=${memberDTO.profileImage})}" 
                                             class="img-thumbnail" 
                                             style="width: 90px; height: 120px; object-fit: cover;"
                                             alt="현재 프로필 이미지">
                                        <p class="small text-muted mt-1">증명사진 비율 (3:4)</p>
                                    </div>
                                    
                                    <!-- 이미지 등록/수정 버튼 -->
                                    <div>
                                        <a href="/member/myinfo/crop-image" class="btn btn-primary">
                                            <i class="fas fa-crop me-1"></i>
                                            <span th:text="${memberDTO.profileImage} ? '프로필 이미지 수정' : '프로필 이미지 등록'">프로필 이미지 등록</span>
                                        </a>
                                        <p class="small text-muted mt-2">
                                            <i class="fas fa-info-circle me-1"></i>
                                            권장: 증명사진 비율 (3:4), 최대 5MB, JPG/PNG 형식
                                        </p>
                                    </div>
                                </div>
                                
                                <!-- 간단한 가이드라인 -->
                                <div class="mt-2">
                                    <small class="text-muted">
                                        <i class="fas fa-info-circle me-1"></i>
                                        <strong>권장:</strong> 증명사진 비율 (3:4), 최대 5MB, JPG/PNG 형식
                                        <span class="ms-2 text-primary">|</span>
                                        <strong class="text-primary">고급 크롭 버튼</strong>으로 정확한 비율 조절 가능
                                    </small>
                                </div>

                                <!-- 현재 프로필 이미지 표시 -->
                                <div th:if="${memberDTO.profileImage}" class="mt-3">
                                    <p class="text-muted mb-2">
                                        <i class="fas fa-check-circle text-success me-1"></i>현재 등록된 프로필 이미지:
                                    </p>
                                    <div class="d-flex align-items-center">
                                        <img th:src="@{${memberDTO.profileImage}}" 
                                             alt="프로필 이미지" 
                                             class="img-thumbnail me-3" 
                                             style="width: 90px; height: 120px; object-fit: cover; border: 2px solid #dee2e6; border-radius: 8px;" 
                                             id="currentProfileImage" 
                                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                        <div class="alert alert-warning mb-0" style="display: none;">
                                            <i class="fas fa-exclamation-triangle me-1"></i>
                                            이미지를 불러올 수 없습니다.
                                        </div>
                                        <div class="ms-2">
                                            <small class="text-muted">
                                                증명사진 비율 (3:4)<br>
                                                구직 신청 시 사용됩니다
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <!-- 이미지 크롭 모달 -->
                                <div class="modal fade" id="cropModal" tabindex="-1" aria-labelledby="cropModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="cropModalLabel">
                                                    <i class="fas fa-crop me-2"></i>프로필 이미지 크롭
                                                </h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="mb-3">
                                                    <div class="alert alert-info">
                                                        <i class="fas fa-info-circle me-1"></i>
                                                        <strong>크롭 가이드:</strong> 반명함 비율(3.5:2.2)에 맞춰 원하는 영역을 선택하세요.
                                                    </div>
                                                    <div class="row text-center">
                                                        <div class="col-md-6">
                                                            <h6 class="text-primary mb-2">
                                                                <i class="fas fa-mouse-pointer me-1"></i>크롭 영역 조절
                                                            </h6>
                                                            <ul class="small text-start mb-0">
                                                                <li>마우스로 크롭 영역을 드래그하여 이동</li>
                                                                <li>모서리를 드래그하여 크기 조절</li>
                                                                <li>비율은 자동으로 3.5:2.2 유지</li>
                                                            </ul>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <h6 class="text-success mb-2">
                                                                <i class="fas fa-expand-arrows-alt me-1"></i>이미지 조절
                                                            </h6>
                                                            <div class="btn-group-vertical d-grid gap-1">
                                                                <button type="button" class="btn btn-sm btn-outline-success" id="zoomIn">
                                                                    <i class="fas fa-search-plus me-1"></i>확대
                                                                </button>
                                                                <button type="button" class="btn btn-sm btn-outline-success" id="zoomOut">
                                                                    <i class="fas fa-search-minus me-1"></i>축소
                                                                </button>
                                                                <button type="button" class="btn btn-sm btn-outline-info" id="resetZoom">
                                                                    <i class="fas fa-undo me-1"></i>원래크기
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="text-center">
                                                    <div id="cropContainer" style="max-width: 100%; max-height: 450px; overflow: hidden; border: 2px solid #dee2e6; border-radius: 8px; position: relative;">
                                                        <img id="cropImage" style="max-width: 100%; height: auto; cursor: move;">
                                                    </div>
                                                </div>
                                                <div class="mt-2 text-center">
                                                    <small class="text-muted">
                                                        <i class="fas fa-hand-paper me-1"></i>
                                                        이미지를 드래그하여 위치를 조절하세요. 마우스 휠로 확대/축소할 수 있습니다.
                                                    </small>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                                    <i class="fas fa-times me-1"></i>취소
                                                </button>
                                                <button type="button" class="btn btn-primary" id="cropConfirm">
                                                    <i class="fas fa-check me-1"></i>크롭 적용
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 이미지 미리보기 영역 -->
                                <div id="imagePreview" class="mt-3" style="display: none;">
                                    <p class="text-muted mb-2">
                                        <i class="fas fa-eye me-1"></i>새 이미지 미리보기:
                                    </p>
                                    <div class="d-flex align-items-center">
                                        <img id="previewImage" 
                                             class="img-thumbnail me-3" 
                                             style="width: 105px; height: 66px; object-fit: cover; border: 2px solid #28a745; border-radius: 8px;">
                                        <div class="ms-2">
                                            <small class="text-success">
                                                <i class="fas fa-check me-1"></i>새 이미지가 선택되었습니다<br>
                                                저장 버튼을 눌러 변경사항을 적용하세요
                                            </small>
                                            <div class="mt-1">
                                                <button type="button" class="btn btn-sm btn-outline-primary" id="recropButton">
                                                    <i class="fas fa-crop me-1"></i>다시 크롭하기
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <input type="hidden" th:field="*{profileImage}">
                            </div>

                            <div class="mb-3">
                                <label for="role" class="form-label">
                                    <i class="fas fa-user-shield me-1"></i>역할
                                </label>
                                <input type="text"
                                       class="form-control"
                                       id="role"
                                       th:field="*{role}"
                                       readonly
                                       disabled>
                            </div>

                            <hr class="my-4">

                            <div class="d-grid mb-3">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-save me-2"></i>
                                    정보 수정
                                </button>
                            </div>
                        </form>

                        <div class="mt-4 text-center">
                            <a th:href="@{/member/mypage/change-password}" class="btn btn-outline-secondary me-2">
                                <i class="fas fa-key me-1"></i> 비밀번호 변경
                            </a>
                            <a th:href="@{/member/mypage/delete}" class="btn btn-outline-danger">
                                <i class="fas fa-user-minus me-1"></i> 회원 탈퇴
                            </a>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</main>


<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 다음 우편번호 서비스 -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

<!-- 카카오 주소 검색 -->
<script>
function openAddressSearch(targetId) {
    new daum.Postcode({
        oncomplete: function(data) {
            // 도로명 주소 우선, 없으면 지번 주소 사용
            var addr = data.roadAddress || data.jibunAddress;
            
            // 선택된 주소를 해당 필드에 입력
            document.getElementById(targetId).value = addr;
            
            // 상세주소 입력 필드에 포커스
            if (targetId === 'address') {
                document.getElementById('detailAddress').focus();
            } else if (targetId === 'facilityAddress') {
                document.getElementById('facilityDetailAddress').focus();
            }
        },
        theme: {
            searchBgColor: "#0d6efd",
            queryTextColor: "#FFFFFF"
        }
    }).open();
}
</script>

<!-- 내정보수정 전용 JavaScript (단순화) -->
<script src="/js/myinfo.js"></script>
</body>
</html>
````

## File: src/main/resources/templates/review/list.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>시설 리뷰 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>

    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <div class="container mt-4">
            <!-- 탐색 경로 -->
            <nav aria-label="breadcrumb" class="mb-3">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">홈</a></li>
                    <li class="breadcrumb-item"><a href="/facility/search">시설 찾기</a></li>
                    <li class="breadcrumb-item active" aria-current="page">시설 리뷰</li>
                </ol>
            </nav>
            
            <div class="row mb-4">
                <div class="col-md-8">
                    <h2><i class="fas fa-star text-warning me-2"></i> 시설 리뷰</h2>
                    <p class="text-muted">실제 이용자들의 생생한 시설 후기를 확인하세요.</p>
                </div>
                <div class="col-md-4 text-end">
                    <a href="/review/write" class="btn btn-primary">
                        <i class="fas fa-plus me-1"></i> 리뷰 작성
                    </a>
                </div>
            </div>

            <div class="row">
                <div class="col-md-3">
                    <!-- 검색 필터 -->
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white">
                            <h6 class="mb-0"><i class="fas fa-filter me-1"></i> 검색 필터</h6>
                        </div>
                        <div class="card-body">
                            <form method="get" th:action="@{/review}">
                                <div class="mb-3">
                                    <label class="form-label">키워드</label>
                                    <input type="text" name="keyword" class="form-control" 
                                           placeholder="시설명, 내용 등" th:value="${keyword}">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">평점</label>
                                    <select name="minRating" class="form-select">
                                        <option value="">전체</option>
                                        <option value="5" th:selected="${param.minRating == '5'}">5점</option>
                                        <option value="4" th:selected="${param.minRating == '4'}">4점 이상</option>
                                        <option value="3" th:selected="${param.minRating == '3'}">3점 이상</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-search me-1"></i> 검색
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-md-9">
                    <!-- 리뷰 목록 -->
                    <div id="reviewList">
                        <!-- 실제 리뷰 목록 -->
                        <div th:if="${not #lists.isEmpty(reviewList)}">
                            <div class="card mb-3" th:each="review : ${reviewList}">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <div>
                                            <h6 class="mb-1" th:text="${review.title}">리뷰 제목</h6>
                                            <div class="rating mb-2">
                                                <th:block th:each="i : ${#numbers.sequence(1, 5)}">
                                                    <i class="fas fa-star" 
                                                       th:classappend="${i <= review.rating} ? 'text-warning' : 'text-muted'"></i>
                                                </th:block>
                                                <span class="ms-2" th:text="${review.rating + '.0'}">5.0</span>
                                            </div>
                                        </div>
                                        <small class="text-muted" th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd')}">2024-01-15</small>
                                    </div>
                                    <p class="card-text rich-text-content" th:utext="${#strings.abbreviate(review.content, 100)}">
                                        시설이 깨끗하고 직원분들이 매우 친절합니다...
                                    </p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted">
                                            작성자: <span th:text="${review.memberName}">김○○</span> |
                                            조회 <span th:text="${review.viewCount}">0</span> |
                                            추천 <span th:text="${review.likeCount}">0</span>
                                        </small>
                                        <a th:href="@{/review/detail/{id}(id=${review.reviewId})}" 
                                           class="btn btn-sm btn-outline-primary">자세히 보기</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 리뷰가 없는 경우 -->
                        <div th:if="${#lists.isEmpty(reviewList)}" class="text-center text-muted py-5">
                            <i class="fas fa-comments fa-3x mb-3"></i>
                            <h5>등록된 리뷰가 없습니다</h5>
                            <p>첫 번째 리뷰를 작성해보세요!</p>
                            <a href="/review/write" class="btn btn-primary">
                                <i class="fas fa-plus me-1"></i> 리뷰 작성하기
                            </a>
                        </div>
                    </div>

                    <!-- 페이징 -->
                    <nav th:if="${pageInfo != null and pageInfo.totalPages > 1}" aria-label="리뷰 페이징">
                        <ul class="pagination justify-content-center">
                            <!-- 이전 페이지 -->
                            <li class="page-item" th:classappend="${pageInfo == null or not pageInfo.hasPrevious} ? 'disabled'">
                                <a class="page-link" 
                                   th:href="@{/review(page=${pageInfo != null ? pageInfo.currentPage - 1 : 1}, keyword=${keyword ?: ''}, minRating=${minRating})}"
                                   aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <!-- 페이지 번호 -->
                            <li class="page-item" 
                                th:each="page : ${pageInfo != null ? #numbers.sequence(pageInfo.startPage, pageInfo.endPage) : #numbers.sequence(1, 1)}"
                                th:classappend="${pageInfo != null and page == pageInfo.currentPage} ? 'active'">
                                <a class="page-link" 
                                   th:href="@{/review(page=${page}, keyword=${keyword ?: ''}, minRating=${minRating})}"
                                   th:text="${page}">1</a>
                            </li>
                            <!-- 다음 페이지 -->
                            <li class="page-item" th:classappend="${pageInfo == null or not pageInfo.hasNext} ? 'disabled'">
                                <a class="page-link" 
                                   th:href="@{/review(page=${pageInfo != null ? pageInfo.currentPage + 1 : 1}, keyword=${keyword ?: ''}, minRating=${minRating})}"
                                   aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </main>

    <!-- 푸터 -->
    <footer th:replace="~{layout/footer :: footer}"></footer>
    
    <!-- JavaScript -->
    <div th:replace="~{layout/footer :: scripts}"></div>
</body>
</html>
````

## File: src/main/java/com/example/carelink/controller/BoardController.java
````java
package com.example.carelink.controller;

import com.example.carelink.common.PageInfo;
import com.example.carelink.common.Constants;
import com.example.carelink.dto.BoardDTO;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.service.BoardService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

/**
 * 정보 게시판 컨트롤러
 * 팀원 D 담당 - 완전 개선 버전
 */
@Slf4j
@Controller
@RequestMapping("/board")
@RequiredArgsConstructor
public class BoardController {
    
    private final BoardService boardService;
    
    // 게시판 타입별 정보 매핑
    private final Map<String, Map<String, String>> boardTypeInfo = Map.of(
        "notice", Map.of("title", "공지사항", "description", "중요한 공지사항을 확인하세요", "category", "NOTICE"),
        "info", Map.of("title", "정보공유", "description", "유용한 정보를 공유하고 함께 나누세요", "category", "INFO"),
        "qna", Map.of("title", "Q&A", "description", "궁금한 점을 질문하고 답변을 받아보세요", "category", "QNA"),
        "faq", Map.of("title", "자주묻는질문", "description", "자주 묻는 질문과 답변을 확인하세요", "category", "FAQ"),
        "all", Map.of("title", "전체 게시판", "description", "모든 게시판의 글을 한번에 확인하세요", "category", "")
    );
    
    /**
     * 게시판 목록 페이지 (타입별 구분 지원)
     */
    @GetMapping
    public String listPage(Model model,
                          @RequestParam(defaultValue = "1") int page,
                          @RequestParam(defaultValue = "") String keyword,
                          @RequestParam(defaultValue = "") String category,
                          @RequestParam(defaultValue = "all") String type,
                          HttpServletResponse response) {
        
        // 캐시 방지 헤더 설정
        response.setHeader("Cache-Control", "no-cache, no-store, must-revalidate");
        response.setHeader("Pragma", "no-cache");
        response.setDateHeader("Expires", 0);
        
        // 게시판 타입 정보 설정
        Map<String, String> currentBoardInfo = boardTypeInfo.getOrDefault(type, boardTypeInfo.get("all"));
        String actualCategory = currentBoardInfo.get("category");
        
        // category 파라미터가 있으면 우선 사용, 없으면 type에서 가져온 category 사용
        if (category.isEmpty() && !actualCategory.isEmpty()) {
            category = actualCategory;
        }
        
        try {
            // 게시글 목록 조회 (페이징 포함)
            PageInfo<BoardDTO> pageInfo = boardService.getBoardList(page, keyword, category);
            
            // 인기 게시글 목록 조회 (해당 카테고리 내에서)
            List<BoardDTO> popularBoards = boardService.getPopularBoardsByCategory(category);
            
            // Model에 데이터 추가
            model.addAttribute("pageInfo", pageInfo);
            model.addAttribute("boardList", pageInfo.getList());
            model.addAttribute("popularBoards", popularBoards != null ? popularBoards : List.of());
            model.addAttribute("keyword", keyword != null ? keyword : "");
            model.addAttribute("category", category != null ? category : "");
            model.addAttribute("type", type);
            model.addAttribute("currentPage", page);
        } catch (Exception e) {
            // 에러 발생 시 빈 페이지 정보 전달
            model.addAttribute("pageInfo", new PageInfo<>(List.of(), page, 10, 0));
            model.addAttribute("boardList", List.of());
            model.addAttribute("popularBoards", List.of());
            model.addAttribute("keyword", keyword != null ? keyword : "");
            model.addAttribute("category", category != null ? category : "");
            model.addAttribute("type", type);
            model.addAttribute("currentPage", page);
            model.addAttribute("error", "게시글을 불러오는 중 오류가 발생했습니다: " + e.getMessage());
        }
        
        // 게시판 타입별 정보
        model.addAttribute("boardTitle", currentBoardInfo.get("title"));
        model.addAttribute("boardDescription", currentBoardInfo.get("description"));
        model.addAttribute("pageTitle", currentBoardInfo.get("title"));
        
        // 카테고리별 전용 템플릿 사용
        if ("faq".equals(type)) {
            return "board/faq-list";
        } else if ("notice".equals(type)) {
            return "board/notice-list";
        } else if ("qna".equals(type)) {
            return "board/qna-list";
        }
        
        return "board/list";
    }
    
    /**
     * 게시글 작성 페이지
     */
    @GetMapping("/write")
    public String writePage(Model model, 
                          @RequestParam(defaultValue = "all") String type,
                          @RequestParam(required = false) String qaType,
                          HttpSession session,
                          RedirectAttributes redirectAttributes) {
        
        // 로그인 체크
        Long memberId = (Long) session.getAttribute("memberId");
        if (memberId == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        
        // 권한 체크 - 공지사항과 FAQ는 관리자만 작성 가능
        MemberDTO loginMember = (MemberDTO) session.getAttribute("loginMember");
        if (("notice".equals(type) || "faq".equals(type)) && 
            (loginMember == null || !"ADMIN".equals(loginMember.getRole()))) {
            redirectAttributes.addFlashAttribute("error", "해당 게시판에 글을 작성할 권한이 없습니다.");
            return "redirect:/board?type=" + type;
        }
        
        // Q&A 답변하기는 관리자만 가능
        if ("qna".equals(type) && "ANSWER".equals(qaType) && 
            (loginMember == null || !"ADMIN".equals(loginMember.getRole()))) {
            redirectAttributes.addFlashAttribute("error", "답변하기는 관리자만 가능합니다.");
            return "redirect:/board?type=" + type;
        }
        
        BoardDTO boardDTO = new BoardDTO();
        boardDTO.setMemberId(memberId); // 세션에서 가져온 사용자 ID 설정
        
        // 게시판 타입에 따라 기본 카테고리 설정
        Map<String, String> currentBoardInfo = boardTypeInfo.getOrDefault(type, boardTypeInfo.get("all"));
        String defaultCategory = currentBoardInfo.get("category");
        if (!defaultCategory.isEmpty()) {
            boardDTO.setCategory(defaultCategory);
        }
        
        // Q&A 타입 설정
        if ("qna".equals(type) && qaType != null) {
            boardDTO.setQaType(qaType);
            // 질문인 경우 답변 상태 초기값 설정
            if ("QUESTION".equals(qaType)) {
                boardDTO.setIsAnswered(false);
                boardDTO.setAnswerCount(0);
            }
        }
        
        model.addAttribute("boardDTO", boardDTO);
        model.addAttribute("type", type);
        model.addAttribute("qaType", qaType);
        model.addAttribute("boardTitle", currentBoardInfo.get("title"));
        
        // Q&A 타입에 따른 페이지 제목 설정
        String pageTitle = currentBoardInfo.get("title");
        if ("qna".equals(type) && qaType != null) {
            pageTitle += ("QUESTION".equals(qaType) ? " - 질문하기" : " - 답변하기");
        } else {
            pageTitle += " 작성";
        }
        model.addAttribute("pageTitle", pageTitle);
        
        // 타입별 전용 작성 템플릿 사용
        if ("faq".equals(type)) {
            return "board/faq-write";
        } else if ("notice".equals(type)) {
            return "board/write";  // 공지사항은 일반 작성 폼 사용
        } else if ("qna".equals(type)) {
            return "board/write";  // Q&A는 일반 작성 폼 사용  
        } else if ("info".equals(type)) {
            return "board/write";  // 정보공유는 일반 작성 폼 사용
        }
        
        return "board/write";
    }
    
    /**
     * 게시글 등록 처리
     */
    @PostMapping("/write")
    public String writeBoard(@ModelAttribute BoardDTO boardDTO, 
                           @RequestParam(defaultValue = "all") String type,
                           @RequestParam(required = false) String qaType,
                           HttpSession session,
                           RedirectAttributes redirectAttributes) {
        try {
            // 로그인 체크
            Long memberId = (Long) session.getAttribute("memberId");
            if (memberId == null) {
                redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
                return "redirect:/member/login";
            }
            
            // 권한 체크 - 공지사항과 FAQ는 관리자만 작성 가능
            MemberDTO loginMember = (MemberDTO) session.getAttribute("loginMember");
            if (("notice".equals(type) || "faq".equals(type)) && 
                (loginMember == null || !"ADMIN".equals(loginMember.getRole()))) {
                redirectAttributes.addFlashAttribute("error", "해당 게시판에 글을 작성할 권한이 없습니다.");
                return "redirect:/board?type=" + type;
            }
            
            // Q&A 답변하기는 관리자만 가능
            if ("qna".equals(type) && "ANSWER".equals(qaType) && 
                (loginMember == null || !"ADMIN".equals(loginMember.getRole()))) {
                redirectAttributes.addFlashAttribute("error", "답변하기는 관리자만 가능합니다.");
                return "redirect:/board?type=" + type;
            }
            
            // 세션에서 가져온 사용자 ID 설정 (보안 강화)
            boardDTO.setMemberId(memberId);
            
            // Q&A 타입별 처리
            if ("qna".equals(type) && qaType != null) {
                boardDTO.setQaType(qaType);
                if ("QUESTION".equals(qaType)) {
                    // 질문인 경우 답변 상태 초기화
                    boardDTO.setIsAnswered(false);
                    boardDTO.setAnswerCount(0);
                } else if ("ANSWER".equals(qaType)) {
                    // 답변인 경우 (관리자만 가능)
                    boardDTO.setIsAnswered(null); // 답변글은 답변 상태를 null로 설정
                    boardDTO.setAnswerCount(null);
                }
            }
            
            // 기본값 설정
            if (boardDTO.getIsNotice() == null) {
                boardDTO.setIsNotice(false);
            }
            if (boardDTO.getIsSecret() == null) {
                boardDTO.setIsSecret(false);
            }
            if (boardDTO.getIsActive() == null) {
                boardDTO.setIsActive(true);  // 활성 상태로 기본 설정
            }
            if (boardDTO.getIsDeleted() == null) {
                boardDTO.setIsDeleted(false);  // 삭제되지 않은 상태로 기본 설정
            }
            
            boardService.insertBoard(boardDTO);
            
            // 성공 메시지 설정
            String successMessage = "게시글이 성공적으로 등록되었습니다.";
            if ("qna".equals(type) && qaType != null) {
                successMessage = "QUESTION".equals(qaType) ? "질문이 성공적으로 등록되었습니다." : "답변이 성공적으로 등록되었습니다.";
            }
            redirectAttributes.addFlashAttribute("message", successMessage);
            
            // 원래 게시판 타입으로 돌아가기
            if ("all".equals(type)) {
                return "redirect:/board";
            } else {
                return "redirect:/board?type=" + type;
            }
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("error", "게시글 등록 중 오류가 발생했습니다: " + e.getMessage());
            String redirectUrl = "redirect:/board/write?type=" + type;
            if (qaType != null) {
                redirectUrl += "&qaType=" + qaType;
            }
            return redirectUrl;
        }
    }
    
    /**
     * 게시글 상세보기
     */
    @GetMapping("/detail/{id}")
    public String detailPage(@PathVariable Long id, 
                           @RequestParam(defaultValue = "all") String type,
                           @RequestParam(defaultValue = "1") int page,
                           Model model,
                           RedirectAttributes redirectAttributes) {
        try {
            BoardDTO board = boardService.getBoardById(id);
            // 조회수 증가
            boardService.incrementViewCount(id);
            
            // 이전글/다음글 조회
            BoardDTO prevBoard = boardService.getPreviousBoard(id);
            BoardDTO nextBoard = boardService.getNextBoard(id);
            
            model.addAttribute("board", board);
            model.addAttribute("prevBoard", prevBoard);
            model.addAttribute("nextBoard", nextBoard);
            model.addAttribute("type", type);
            model.addAttribute("page", page);
            model.addAttribute("pageTitle", board.getTitle());
            
            // 카테고리별 상세보기 템플릿 분기 (현재는 모두 동일한 템플릿 사용)
            // 향후 카테고리별 특화 상세보기가 필요한 경우 여기서 분기 처리
            return "board/detail";
        } catch (Exception e) {
            log.error("게시글 상세보기 오류 - boardId: {}", id, e);
            redirectAttributes.addFlashAttribute("error", "게시글을 불러올 수 없습니다: " + e.getMessage());
            return "redirect:/board?type=" + type;
        }
    }
    
    /**
     * 게시글 수정 페이지
     */
    @GetMapping("/edit/{id}")
    public String editPage(@PathVariable Long id, 
                          @RequestParam(name = "type", required = false) String type,
                         HttpSession session,
                         Model model,
                         RedirectAttributes redirectAttributes) {
        try {
            // 로그인 체크
            Long memberId = (Long) session.getAttribute("memberId");
            if (memberId == null) {
                redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
                return "redirect:/member/login";
            }
            
            // 게시글 조회 (삭제된 것 포함)
            BoardDTO board = boardService.getBoardByIdIncludeDeleted(id);
            if (board == null) {
                redirectAttributes.addFlashAttribute("error", "수정할 게시글을 찾을 수 없습니다.");
                return "redirect:/board?type=" + (type != null ? type : "all");
            }
            
            // 삭제된 게시글인지 확인
            if (board.getIsDeleted() != null && board.getIsDeleted()) {
                redirectAttributes.addFlashAttribute("error", "삭제된 게시글은 수정할 수 없습니다.");
                return "redirect:/board/detail/" + id + "?type=" + (type != null ? type : "all");
            }
            
            log.info("수정 페이지 접근 - 게시글 ID: {}, 작성자 ID: {}, 요청자 ID: {}", id, board.getMemberId(), memberId);
            
            // 권한 체크
            MemberDTO loginMember = (MemberDTO) session.getAttribute("loginMember");
            boolean isAdmin = loginMember != null && "ADMIN".equals(loginMember.getRole());
            boolean isAuthor = board.getMemberId().equals(memberId);
            
            // 공지사항과 FAQ는 관리자만 수정 가능
            if (("NOTICE".equals(board.getCategory()) || "FAQ".equals(board.getCategory())) && !isAdmin) {
                log.warn("권한 없는 수정 시도 - 공지사항/FAQ 수정 권한 없음. 요청자: {}", memberId);
                redirectAttributes.addFlashAttribute("error", "해당 게시글을 수정할 권한이 없습니다.");
                return "redirect:/board/detail/" + id + "?type=" + (type != null ? type : "all");
            }
            
            // 일반 게시글은 작성자 본인 또는 관리자만 수정 가능
            if (!isAuthor && !isAdmin) {
                log.warn("권한 없는 수정 시도 - 게시글 작성자: {}, 요청자: {}", board.getMemberId(), memberId);
                redirectAttributes.addFlashAttribute("error", "작성자만 수정할 수 있습니다.");
                return "redirect:/board/detail/" + id + "?type=" + (type != null ? type : "all");
            }
            
            // 게시판 타입별 정보
            Map<String, String> currentBoardInfo = boardTypeInfo.getOrDefault(type != null ? type : "all", boardTypeInfo.get("all"));
            
            model.addAttribute("boardDTO", board);
            model.addAttribute("type", type != null ? type : "all");
            model.addAttribute("boardTitle", currentBoardInfo.get("title"));
            model.addAttribute("pageTitle", currentBoardInfo.get("title") + " 수정");
            
            return "board/edit";
        } catch (Exception e) {
            log.error("수정 페이지 로드 중 오류 발생 - boardId: {}", id, e);
            redirectAttributes.addFlashAttribute("error", "수정 페이지를 불러오는 중 오류가 발생했습니다: " + e.getMessage());
            return "redirect:/board?type=" + (type != null ? type : "all");
        }
    }
    
    /**
     * 게시글 수정 처리
     */
    @PostMapping("/edit/{id}")
    public String editBoard(@PathVariable Long id, 
                          @ModelAttribute BoardDTO boardDTO,
                          @RequestParam(defaultValue = "all") String type,
                          HttpSession session,
                          RedirectAttributes redirectAttributes) {
        try {
            // 로그인 체크
            Long memberId = (Long) session.getAttribute("memberId");
            if (memberId == null) {
                redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
                return "redirect:/member/login";
            }
            
            // 기존 게시글 정보 조회 (삭제된 것 포함)
            BoardDTO existingBoard = boardService.getBoardByIdIncludeDeleted(id);
            if (existingBoard == null) {
                redirectAttributes.addFlashAttribute("error", "수정할 게시글을 찾을 수 없습니다.");
                return getRedirectUrl(type);
            }
            
            // 삭제된 게시글인지 확인
            if (existingBoard.getIsDeleted() != null && existingBoard.getIsDeleted()) {
                redirectAttributes.addFlashAttribute("error", "삭제된 게시글은 수정할 수 없습니다.");
                return getRedirectUrl(type);
            }
            
            log.info("수정 요청 - 게시글 ID: {}, 작성자 ID: {}, 요청자 ID: {}", id, existingBoard.getMemberId(), memberId);
            
            // 권한 체크
            MemberDTO loginMember = (MemberDTO) session.getAttribute("loginMember");
            boolean isAdmin = loginMember != null && "ADMIN".equals(loginMember.getRole());
            boolean isAuthor = existingBoard.getMemberId().equals(memberId);
            
            // 공지사항과 FAQ는 관리자만 수정 가능
            if (("NOTICE".equals(existingBoard.getCategory()) || "FAQ".equals(existingBoard.getCategory())) && !isAdmin) {
                log.warn("권한 없는 수정 시도 - 공지사항/FAQ 수정 권한 없음. 요청자: {}", memberId);
                redirectAttributes.addFlashAttribute("error", "해당 게시글을 수정할 권한이 없습니다.");
                return "redirect:/board/detail/" + id + "?type=" + type;
            }
            
            // 일반 게시글은 작성자 본인 또는 관리자만 수정 가능
            if (!isAuthor && !isAdmin) {
                log.warn("권한 없는 수정 시도 - 게시글 작성자: {}, 요청자: {}", existingBoard.getMemberId(), memberId);
                redirectAttributes.addFlashAttribute("error", "작성자만 수정할 수 있습니다.");
                return "redirect:/board/detail/" + id + "?type=" + type;
            }
            
            // 수정할 게시글 정보 설정
            boardDTO.setBoardId(id);
            boardDTO.setMemberId(memberId);
            
            // 기본값 설정
            if (boardDTO.getIsNotice() == null) {
                boardDTO.setIsNotice(false);
            }
            if (boardDTO.getIsSecret() == null) {
                boardDTO.setIsSecret(false);
            }
            if (boardDTO.getIsActive() == null) {
                boardDTO.setIsActive(true);  // 활성 상태 유지
            }
            if (boardDTO.getIsDeleted() == null) {
                boardDTO.setIsDeleted(false);  // 삭제되지 않은 상태 유지
            }
            
            boardService.updateBoard(boardDTO);
            log.info("수정 완료 - 게시글 ID: {}", id);
            redirectAttributes.addFlashAttribute("message", "✅ 게시글이 성공적으로 수정되었습니다.");
            return "redirect:/board/detail/" + id + "?type=" + type;
        } catch (Exception e) {
            log.error("수정 처리 중 오류 발생 - boardId: {}", id, e);
            redirectAttributes.addFlashAttribute("error", "❌ 게시글 수정 중 오류가 발생했습니다: " + e.getMessage());
            return "redirect:/board/edit/" + id + "?type=" + type;
        }
    }
    
    /**
     * 게시글 삭제 처리
     */
    @PostMapping("/delete/{id}")
    public String deleteBoard(@PathVariable Long id,
                             @RequestParam(name = "type", required = false) String type,
                            HttpSession session,
                            RedirectAttributes redirectAttributes) {
        
        try {
            log.info("🚀 삭제 요청 시작 - 게시글 ID: {}", id);
            
            // 로그인 확인
            Long memberId = (Long) session.getAttribute("memberId");
            log.info("🔍 세션 확인 - memberId: {}", memberId);
            
            if (memberId == null) {
                log.warn("❌ 로그인 안됨 - 삭제 실패");
                redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
                return "redirect:/member/login";
            }
            
            // 게시글 조회 (삭제된 것 포함)
            BoardDTO board = boardService.getBoardByIdIncludeDeleted(id);
            log.info("🔍 게시글 조회 결과 - board: {}", board != null ? "존재함" : "없음");
            
            if (board == null) {
                log.warn("❌ 게시글 없음 - 삭제 실패");
                redirectAttributes.addFlashAttribute("error", "게시글을 찾을 수 없습니다.");
                return getRedirectUrl(type);
            }
            
            log.info("🔍 권한 체크 - 게시글 작성자: {}, 요청자: {}", board.getMemberId(), memberId);
            log.info("삭제 요청 - 게시글 ID: {}, 작성자 ID: {}, 요청자 ID: {}", id, board.getMemberId(), memberId);
            
            // 권한 체크
            MemberDTO loginMember = (MemberDTO) session.getAttribute("loginMember");
            boolean isAdmin = loginMember != null && "ADMIN".equals(loginMember.getRole());
            boolean isAuthor = board.getMemberId().equals(memberId);
            
            // 공지사항과 FAQ는 관리자만 삭제 가능
            if (("NOTICE".equals(board.getCategory()) || "FAQ".equals(board.getCategory())) && !isAdmin) {
                log.warn("❌ 권한 없는 삭제 시도 - 공지사항/FAQ 삭제 권한 없음. 요청자: {}", memberId);
                redirectAttributes.addFlashAttribute("error", "해당 게시글을 삭제할 권한이 없습니다.");
                return getRedirectUrl(type);
            }
            
            // 일반 게시글은 작성자 본인 또는 관리자만 삭제 가능
            if (!isAuthor && !isAdmin) {
                log.warn("❌ 권한 없는 삭제 시도 - 게시글 작성자: {}, 요청자: {}", board.getMemberId(), memberId);
                redirectAttributes.addFlashAttribute("error", "작성자만 삭제할 수 있습니다.");
                return getRedirectUrl(type);
            }
            
            log.info("✅ 권한 체크 통과 - 삭제 진행");
            
            // 삭제 실행
            Map<String, Object> deleteResult = boardService.deleteBoard(id);
            Boolean success = (Boolean) deleteResult.get("success");
            String message = (String) deleteResult.get("message");
            
            log.info("삭제 결과 - 성공: {}, 메시지: {}", success, message);
            
            if (success) {
                redirectAttributes.addFlashAttribute("message", "✅ " + message);
            } else {
                redirectAttributes.addFlashAttribute("error", "❌ " + message);
            }
            
            return getRedirectUrl(type);
            
        } catch (Exception e) {
            log.error("게시글 삭제 처리 중 오류 발생 - boardId: {}", id, e);
            redirectAttributes.addFlashAttribute("error", "❌ 게시글 삭제 중 오류가 발생했습니다: " + e.getMessage());
            return getRedirectUrl(type);
        }
    }
    
    /**
     * 리다이렉트 URL 생성 (중복 코드 제거)
     */
    private String getRedirectUrl(String type) {
        if ("all".equals(type)) {
            return "redirect:/board";
        } else {
            return "redirect:/board?type=" + type;
        }
    }
    
    /**
     * 게시글 추천/비추천
     */
    @PostMapping("/like/{id}")
    @ResponseBody
    public Map<String, Object> toggleLike(@PathVariable Long id, 
                                        @RequestParam String action) {
        Map<String, Object> result = new HashMap<>();
        try {
            if ("like".equals(action)) {
                boardService.incrementLikeCount(id);
                result.put("success", true);
                result.put("message", "추천되었습니다.");
            } else if ("dislike".equals(action)) {
                boardService.decrementLikeCount(id);
                result.put("success", true);
                result.put("message", "추천이 취소되었습니다.");
            }
        } catch (Exception e) {
            result.put("success", false);
            result.put("message", "처리 중 오류가 발생했습니다.");
        }
        return result;
    }
    
    /**
     * 디버깅: 게시글 상태 확인
     */
    @GetMapping("/debug/board/{id}")
    @ResponseBody
    public Map<String, Object> debugBoardStatus(@PathVariable Long id) {
        Map<String, Object> result = new HashMap<>();
        
        try {
            log.info("🔧 디버그 API 호출 - boardId: {}", id);
            
            // 삭제된 것 포함하여 조회
            BoardDTO board = boardService.getBoardByIdIncludeDeleted(id);
            if (board == null) {
                result.put("error", "게시글을 찾을 수 없습니다");
                log.warn("🔧 디버그 - 게시글을 찾을 수 없음: {}", id);
                return result;
            }
            
            result.put("boardId", board.getBoardId());
            result.put("title", board.getTitle());
            result.put("isDeleted", board.getIsDeleted());
            result.put("isDeletedType", board.getIsDeleted() != null ? board.getIsDeleted().getClass().getSimpleName() : "null");
            result.put("isDeletedValue", board.getIsDeleted() != null ? board.getIsDeleted().toString() : "null");
            result.put("isActive", board.getIsActive());
            result.put("isActiveType", board.getIsActive() != null ? board.getIsActive().getClass().getSimpleName() : "null");
            result.put("createdAt", board.getCreatedAt());
            
            // 삭제 조건 체크
            boolean wouldBeDeleted = board.getIsDeleted() != null && board.getIsDeleted();
            result.put("wouldBeConsideredDeleted", wouldBeDeleted);
            
            log.info("🔧 디버그 결과 - boardId: {}, isDeleted: {}, wouldBeDeleted: {}", 
                id, board.getIsDeleted(), wouldBeDeleted);
            
            return result;
        } catch (Exception e) {
            log.error("🔧 디버그 API 오류 - boardId: {}", id, e);
            result.put("error", "오류 발생: " + e.getMessage());
            return result;
        }
    }
    
    /**
     * 현재 로그인한 사용자 정보 조회
     */
    private MemberDTO getCurrentMember(HttpSession session) {
        return (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
    }
    
    /**
     * 현재 로그인한 사용자 ID 조회 (기존 memberId 세션 키 사용)
     */
    private Long getCurrentMemberId(HttpSession session) {
        return (Long) session.getAttribute("memberId");
    }
    
    /**
     * 현재 사용자가 관리자인지 확인
     */
    private boolean isAdmin(HttpSession session) {
        MemberDTO loginMember = getCurrentMember(session);
        return loginMember != null && "ADMIN".equals(loginMember.getRole());
    }
    
    /**
     * 수정/삭제 권한 확인 (작성자 또는 관리자)
     */
    private boolean hasEditPermission(HttpSession session, Long authorMemberId) {
        Long currentMemberId = getCurrentMemberId(session);
        return (currentMemberId != null && currentMemberId.equals(authorMemberId)) || isAdmin(session);
    }


}
````

## File: src/main/java/com/example/carelink/controller/ReviewController.java
````java
package com.example.carelink.controller;

import com.example.carelink.common.PageInfo;
import com.example.carelink.common.Constants;
import com.example.carelink.dto.ReviewDTO;
import com.example.carelink.dto.FacilityDTO;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.service.ReviewService;
import com.example.carelink.service.FacilityService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import javax.servlet.http.HttpSession;
import java.util.List;
import java.util.Map;
import java.util.HashMap;

/**
 * 시설 리뷰 컨트롤러
 * 팀원 D 담당 - 완전 개선 버전
 */
@Slf4j
@Controller
@RequestMapping("/review")
@RequiredArgsConstructor
public class ReviewController {
    
    private final ReviewService reviewService;
    private final FacilityService facilityService;
    
    /**
     * 리뷰 목록 페이지
     */
    @GetMapping
    public String listPage(Model model,
                          @RequestParam(defaultValue = "1") int page,
                          @RequestParam(defaultValue = "") String keyword,
                          @RequestParam(required = false) Integer minRating,
                          @RequestParam(required = false) Long facilityId) {
        
        try {
            log.info("리뷰 목록 페이지 접속 - page: {}, keyword: {}, minRating: {}, facilityId: {}", 
                    page, keyword, minRating, facilityId);
            
            PageInfo<ReviewDTO> pageInfo = reviewService.getReviewList(page, keyword, minRating, facilityId);
            model.addAttribute("pageInfo", pageInfo);
            model.addAttribute("reviewList", pageInfo.getList());
            model.addAttribute("keyword", keyword != null ? keyword : "");
            model.addAttribute("minRating", minRating);
            model.addAttribute("facilityId", facilityId);
            model.addAttribute("currentPage", page);
            model.addAttribute("pageTitle", "시설 리뷰");
            
            // 시설별 필터링인 경우 시설 정보도 함께 조회
            if (facilityId != null) {
                try {
                    FacilityDTO facility = facilityService.getFacilityById(facilityId);
                    model.addAttribute("selectedFacility", facility);
                    model.addAttribute("pageTitle", facility.getFacilityName() + " 리뷰");
                } catch (Exception e) {
                    log.warn("시설 정보 조회 실패 - facilityId: {}", facilityId, e);
                }
            }
            
            return "review/list";
        } catch (Exception e) {
            log.error("리뷰 목록 조회 중 오류 발생", e);
            // 에러 발생 시 빈 페이지 정보 전달
            model.addAttribute("pageInfo", new PageInfo<>(List.of(), page, 10, 0));
            model.addAttribute("reviewList", List.of());
            model.addAttribute("keyword", keyword != null ? keyword : "");
            model.addAttribute("minRating", minRating);
            model.addAttribute("facilityId", facilityId);
            model.addAttribute("currentPage", page);
            model.addAttribute("error", "리뷰를 불러오는 중 오류가 발생했습니다: " + e.getMessage());
            
            return "review/list";
        }
    }
    
    /**
     * 리뷰 작성 페이지
     */
    @GetMapping("/write")
    public String writePage(Model model,
                           @RequestParam(required = false) Long facilityId,
                           HttpSession session,
                           RedirectAttributes redirectAttributes) {
        
        // 로그인 체크
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            log.warn("로그인하지 않은 사용자의 리뷰 작성 페이지 접속 시도");
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        try {
            log.info("리뷰 작성 페이지 접속 - facilityId: {}", facilityId);
            
            ReviewDTO reviewDTO = new ReviewDTO();
            
            // 시설 목록 조회 (시설 선택을 위해)
            List<FacilityDTO> facilityList = facilityService.getAllActiveFacilities();
            log.info("활성화된 시설 목록 조회 완료 - 조회된 건수: {}", facilityList.size());
            
            if (facilityId != null) {
                FacilityDTO selectedFacility = facilityService.getFacilityById(facilityId);
                if (selectedFacility != null) {
                    log.info("선택된 시설 정보 조회 성공 - facilityId: {}, facilityName: {}, status: {}", 
                            facilityId, selectedFacility.getFacilityName(), selectedFacility.getStatus());
                    
                    // 시설 상태 체크
                    if ("삭제됨".equals(selectedFacility.getStatus())) {
                        model.addAttribute("error", "선택하신 시설은 삭제되어 리뷰를 작성할 수 없습니다.");
                    } else if ("승인대기".equals(selectedFacility.getStatus())) {
                        model.addAttribute("error", "선택하신 시설은 아직 승인되지 않아 리뷰를 작성할 수 없습니다.");
                    } else {
                        reviewDTO.setFacilityId(facilityId);
                        model.addAttribute("selectedFacility", selectedFacility);
                    }
                } else {
                    log.warn("선택된 시설을 찾을 수 없음 - facilityId: {}", facilityId);
                    model.addAttribute("error", "선택하신 시설을 찾을 수 없습니다.");
                }
            }
            
            model.addAttribute("reviewDTO", reviewDTO);
            model.addAttribute("facilityList", facilityList);
            model.addAttribute("pageTitle", "리뷰 작성");
            
            return "review/write";
        } catch (Exception e) {
            log.error("리뷰 작성 페이지 로딩 중 오류 발생", e);
            model.addAttribute("error", "리뷰 작성 페이지를 불러오는 중 오류가 발생했습니다: " + e.getMessage());
            return "review/write";
        }
    }
    
    /**
     * 리뷰 등록 처리
     */
    @PostMapping("/write")
    public String writeReview(@ModelAttribute ReviewDTO reviewDTO,
                             HttpSession session,
                             RedirectAttributes redirectAttributes) {
        try {
            log.info("리뷰 등록 요청 - title: {}, facilityId: {}", reviewDTO.getTitle(), reviewDTO.getFacilityId());
            
            // 현재 로그인한 사용자 ID 설정 (세션에서 가져오기)
            MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (loginMember == null) {
                log.warn("로그인하지 않은 사용자의 리뷰 작성 시도");
                redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
                return "redirect:/member/login";
            }
            
            reviewDTO.setMemberId(loginMember.getMemberId());
            log.info("리뷰 작성자 설정 - memberId: {}, userId: {}", loginMember.getMemberId(), loginMember.getUserId());
            
            // 필수 값 검증
            if (reviewDTO.getFacilityId() == null) {
                log.warn("시설이 선택되지 않음");
                redirectAttributes.addFlashAttribute("error", "시설을 선택해주세요.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/write";
            }
            
            // 시설 존재 여부 및 상태 확인
            FacilityDTO facility = facilityService.getFacilityById(reviewDTO.getFacilityId());
            if (facility == null) {
                log.warn("선택된 시설을 찾을 수 없음 - facilityId: {}", reviewDTO.getFacilityId());
                redirectAttributes.addFlashAttribute("error", "선택한 시설을 찾을 수 없습니다.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/write";
            }
            
            // 시설 상태 검증
            if (!facilityService.validateFacilityStatus(facility)) {
                log.warn("유효하지 않은 시설 상태 - facilityId: {}, status: {}", 
                        facility.getFacilityId(), facility.getStatus());
                redirectAttributes.addFlashAttribute("error", facility.getStatusMessage());
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/write";
            }
            
            log.info("시설 정보 확인 완료 - facilityId: {}, facilityName: {}, status: {}", 
                    facility.getFacilityId(), facility.getFacilityName(), facility.getStatus());
            
            // 제목 검증
            if (reviewDTO.getTitle() == null || reviewDTO.getTitle().trim().isEmpty()) {
                log.warn("제목이 입력되지 않음");
                redirectAttributes.addFlashAttribute("error", "제목을 입력해주세요.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/write?facilityId=" + reviewDTO.getFacilityId();
            }
            
            // 내용 검증
            if (reviewDTO.getContent() == null || reviewDTO.getContent().trim().length() < 10) {
                log.warn("내용이 10자 미만임");
                redirectAttributes.addFlashAttribute("error", "내용을 10자 이상 입력해주세요.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/write?facilityId=" + reviewDTO.getFacilityId();
            }
            
            // 평점 검증
            if (reviewDTO.getRating() == null || reviewDTO.getRating() < 1 || reviewDTO.getRating() > 5) {
                log.warn("평점이 유효하지 않음 - rating: {}", reviewDTO.getRating());
                redirectAttributes.addFlashAttribute("error", "평점을 선택해주세요.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/write?facilityId=" + reviewDTO.getFacilityId();
            }
            
            // 리뷰 등록
            reviewService.insertReview(reviewDTO);
            log.info("리뷰 등록 성공 - reviewId: {}", reviewDTO.getReviewId());
            redirectAttributes.addFlashAttribute("message", "리뷰가 성공적으로 등록되었습니다.");
            
            return "redirect:/review";
        } catch (Exception e) {
            log.error("리뷰 등록 중 오류 발생", e);
            redirectAttributes.addFlashAttribute("error", "리뷰 등록 중 오류가 발생했습니다: " + e.getMessage());
            redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
            return "redirect:/review/write?facilityId=" + reviewDTO.getFacilityId();
        }
    }
    
    /**
     * 리뷰 상세보기
     */
    @GetMapping("/detail/{id}")
    public String detailPage(@PathVariable Long id, Model model, HttpSession session) {
        try {
            ReviewDTO review = reviewService.getReviewById(id);
            
            if (review == null) {
                model.addAttribute("error", "리뷰를 찾을 수 없습니다.");
                return "redirect:/review";
            }
            
            // 조회수 증가
            reviewService.incrementViewCount(id);
            
            // 같은 시설의 다른 리뷰들 조회 (최대 5개)
            List<ReviewDTO> otherReviews = reviewService.getReviewsByFacilityId(review.getFacilityId())
                    .stream()
                    .filter(r -> !r.getReviewId().equals(id))
                    .limit(5)
                    .collect(java.util.stream.Collectors.toList());
            
            model.addAttribute("review", review);
            model.addAttribute("otherReviews", otherReviews);
            model.addAttribute("pageTitle", review.getTitle());
            model.addAttribute("currentMemberId", getCurrentMemberId(session)); // 현재 사용자 ID 추가
            
            return "review/detail";
        } catch (Exception e) {
            log.error("리뷰 상세보기 중 오류 발생 - reviewId: {}", id, e);
            model.addAttribute("error", "리뷰를 불러올 수 없습니다: " + e.getMessage());
            return "redirect:/review";
        }
    }
    
    /**
     * 리뷰 수정 페이지
     */
    @GetMapping("/edit/{id}")
    public String editPage(@PathVariable Long id, Model model, HttpSession session, RedirectAttributes redirectAttributes) {
        try {
            ReviewDTO review = reviewService.getReviewById(id);
            
            if (review == null) {
                redirectAttributes.addFlashAttribute("error", "수정할 리뷰를 찾을 수 없습니다.");
                return "redirect:/review";
            }
            
            // 작성자 또는 관리자 권한 확인
            if (!hasEditPermission(session, review.getMemberId())) {
                redirectAttributes.addFlashAttribute("error", "작성자 또는 관리자만 수정할 수 있습니다.");
                return "redirect:/review/detail/" + id;
            }
            
            model.addAttribute("reviewDTO", review);
            model.addAttribute("pageTitle", "리뷰 수정");
            
            return "review/edit";
        } catch (Exception e) {
            log.error("리뷰 수정 페이지 로딩 중 오류 발생 - reviewId: {}", id, e);
            redirectAttributes.addFlashAttribute("error", "수정 페이지를 불러오는 중 오류가 발생했습니다: " + e.getMessage());
            return "redirect:/review";
        }
    }
    
    /**
     * 리뷰 수정 처리
     */
    @PostMapping("/update")
    public String updateReview(@ModelAttribute ReviewDTO reviewDTO, HttpSession session, RedirectAttributes redirectAttributes) {
        try {
            log.info("리뷰 수정 요청 - reviewId: {}, title: {}", reviewDTO.getReviewId(), reviewDTO.getTitle());
            
            // 기존 리뷰 조회
            ReviewDTO existingReview = reviewService.getReviewById(reviewDTO.getReviewId());
            if (existingReview == null) {
                redirectAttributes.addFlashAttribute("error", "수정할 리뷰를 찾을 수 없습니다.");
                return "redirect:/review";
            }
            
            // 작성자 또는 관리자 권한 확인
            if (!hasEditPermission(session, existingReview.getMemberId())) {
                redirectAttributes.addFlashAttribute("error", "작성자 또는 관리자만 수정할 수 있습니다.");
                return "redirect:/review/detail/" + reviewDTO.getReviewId();
            }
            
            // 제목 검증
            if (reviewDTO.getTitle() == null || reviewDTO.getTitle().trim().isEmpty()) {
                redirectAttributes.addFlashAttribute("error", "제목을 입력해주세요.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/edit/" + reviewDTO.getReviewId();
            }
            
            // 내용 검증
            if (reviewDTO.getContent() == null || reviewDTO.getContent().trim().length() < 10) {
                redirectAttributes.addFlashAttribute("error", "내용을 10자 이상 입력해주세요.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/edit/" + reviewDTO.getReviewId();
            }
            
            // 평점 검증
            if (reviewDTO.getRating() == null || reviewDTO.getRating() < 1 || reviewDTO.getRating() > 5) {
                redirectAttributes.addFlashAttribute("error", "평점을 선택해주세요.");
                redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
                return "redirect:/review/edit/" + reviewDTO.getReviewId();
            }
            
            // 수정할 수 없는 필드들 기존 값 유지
            reviewDTO.setFacilityId(existingReview.getFacilityId());
            reviewDTO.setMemberId(existingReview.getMemberId());
            reviewDTO.setViewCount(existingReview.getViewCount());
            reviewDTO.setLikeCount(existingReview.getLikeCount());
            reviewDTO.setDislikeCount(existingReview.getDislikeCount());
            reviewDTO.setCreatedAt(existingReview.getCreatedAt());
            
            // 리뷰 수정
            reviewService.updateReview(reviewDTO);
            log.info("리뷰 수정 성공 - reviewId: {}", reviewDTO.getReviewId());
            
            redirectAttributes.addFlashAttribute("message", "리뷰가 성공적으로 수정되었습니다.");
            return "redirect:/review/detail/" + reviewDTO.getReviewId();
        } catch (Exception e) {
            log.error("리뷰 수정 중 오류 발생 - reviewId: {}", reviewDTO.getReviewId(), e);
            redirectAttributes.addFlashAttribute("error", "리뷰 수정 중 오류가 발생했습니다: " + e.getMessage());
            redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
            return "redirect:/review/edit/" + reviewDTO.getReviewId();
        }
    }
    
    /**
     * 리뷰 삭제
     */
    @PostMapping("/delete/{id}")
    public String deleteReview(@PathVariable Long id, HttpSession session, RedirectAttributes redirectAttributes) {
        try {
            // 기존 리뷰 조회
            ReviewDTO existingReview = reviewService.getReviewById(id);
            if (existingReview == null) {
                redirectAttributes.addFlashAttribute("error", "삭제할 리뷰를 찾을 수 없습니다.");
                return "redirect:/review";
            }
            
            // 작성자 또는 관리자 권한 확인
            if (!hasEditPermission(session, existingReview.getMemberId())) {
                redirectAttributes.addFlashAttribute("error", "작성자 또는 관리자만 삭제할 수 있습니다.");
                return "redirect:/review/detail/" + id;
            }
            
            reviewService.deleteReview(id);
            redirectAttributes.addFlashAttribute("message", "리뷰가 성공적으로 삭제되었습니다.");
        } catch (Exception e) {
            log.error("리뷰 삭제 중 오류 발생 - reviewId: {}", id, e);
            redirectAttributes.addFlashAttribute("error", "리뷰 삭제 중 오류가 발생했습니다: " + e.getMessage());
        }
        
        return "redirect:/review";
    }
    
    /**
     * 리뷰 신고 API
     */
    @PostMapping("/report/{id}")
    @ResponseBody
    public Map<String, Object> reportReview(@PathVariable Long id, @RequestBody Map<String, String> request, HttpSession session) {
        Map<String, Object> result = new HashMap<>();
        
        try {
            String reason = request.get("reason");
            if (reason == null || reason.trim().isEmpty()) {
                result.put("success", false);
                result.put("message", "신고 사유를 입력해주세요.");
                return result;
            }
            
            // 리뷰 존재 확인
            ReviewDTO review = reviewService.getReviewById(id);
            if (review == null) {
                result.put("success", false);
                result.put("message", "신고할 리뷰를 찾을 수 없습니다.");
                return result;
            }
            
            // 본인 리뷰 신고 방지
            Long currentMemberId = getCurrentMemberId(session);
            if (review.getMemberId().equals(currentMemberId)) {
                result.put("success", false);
                result.put("message", "본인이 작성한 리뷰는 신고할 수 없습니다.");
                return result;
            }
            
            // TODO: 실제 신고 처리 로직 구현
            // 현재는 로그만 남김
            log.info("리뷰 신고 접수 - reviewId: {}, reason: {}, reporter: {}", id, reason, currentMemberId);
            
            result.put("success", true);
            result.put("message", "신고가 접수되었습니다. 검토 후 적절한 조치를 취하겠습니다.");
        } catch (Exception e) {
            log.error("리뷰 신고 처리 중 오류 발생 - reviewId: {}", id, e);
            result.put("success", false);
            result.put("message", "신고 처리 중 오류가 발생했습니다.");
        }
        
        return result;
    }
    
    /**
     * 조회수 증가 API
     */
    @PostMapping("/view/{id}")
    @ResponseBody
    public Map<String, Object> incrementViewCount(@PathVariable Long id) {
        Map<String, Object> result = new HashMap<>();
        
        try {
            reviewService.incrementViewCount(id);
            result.put("success", true);
        } catch (Exception e) {
            log.error("조회수 증가 중 오류 발생 - reviewId: {}", id, e);
            result.put("success", false);
            result.put("message", "조회수 업데이트 중 오류가 발생했습니다.");
        }
        
        return result;
    }
    
    /**
     * 시설별 리뷰 목록 API
     */
    @GetMapping("/api/facility/{facilityId}")
    @ResponseBody
    public Map<String, Object> getReviewsByFacility(@PathVariable Long facilityId,
                                                   @RequestParam(defaultValue = "1") int page) {
        Map<String, Object> result = new HashMap<>();
        
        try {
            List<ReviewDTO> reviews = reviewService.getReviewsByFacilityId(facilityId);
            Double averageRating = reviewService.getAverageRating(facilityId);
            
            result.put("success", true);
            result.put("reviews", reviews);
            result.put("averageRating", averageRating);
            result.put("reviewCount", reviews.size());
        } catch (Exception e) {
            result.put("success", false);
            result.put("message", "리뷰를 불러오는 중 오류가 발생했습니다.");
        }
        
        return result;
    }
    
    /**
     * 리뷰 추천 API
     */
    @PostMapping("/like/{id}")
    @ResponseBody
    public Map<String, Object> likeReview(@PathVariable Long id) {
        Map<String, Object> result = new HashMap<>();
        
        try {
            reviewService.likeReview(id);
            
            // 업데이트된 리뷰 정보 조회
            ReviewDTO review = reviewService.getReviewById(id);
            
            result.put("success", true);
            result.put("likeCount", review.getLikeCount());
            result.put("message", "추천하였습니다.");
        } catch (Exception e) {
            result.put("success", false);
            result.put("message", "추천 처리 중 오류가 발생했습니다.");
        }
        
        return result;
    }
    
    /**
     * 리뷰 비추천 API
     */
    @PostMapping("/dislike/{id}")
    @ResponseBody
    public Map<String, Object> dislikeReview(@PathVariable Long id) {
        Map<String, Object> result = new HashMap<>();
        
        try {
            reviewService.dislikeReview(id);
            
            // 업데이트된 리뷰 정보 조회
            ReviewDTO review = reviewService.getReviewById(id);
            
            result.put("success", true);
            result.put("dislikeCount", review.getDislikeCount());
            result.put("message", "비추천하였습니다.");
        } catch (Exception e) {
            result.put("success", false);
            result.put("message", "비추천 처리 중 오류가 발생했습니다.");
        }
        
        return result;
    }
    
    /**
     * 현재 로그인한 사용자 ID 조회 (세션 기반)
     */
    private Long getCurrentMemberId(HttpSession session) {
        return (Long) session.getAttribute("memberId");
    }
    
    /**
     * 현재 사용자가 관리자인지 확인
     */
    private boolean isAdmin(HttpSession session) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        return loginMember != null && "ADMIN".equals(loginMember.getRole());
    }
    
    /**
     * 수정/삭제 권한 확인 (작성자 또는 관리자)
     */
    private boolean hasEditPermission(HttpSession session, Long authorMemberId) {
        Long currentMemberId = getCurrentMemberId(session);
        return (currentMemberId != null && currentMemberId.equals(authorMemberId)) || isAdmin(session);
    }
}
````

## File: src/main/java/com/example/carelink/dto/FacilityDTO.java
````java
package com.example.carelink.dto;

import com.example.carelink.common.BaseDTO;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.NoArgsConstructor;
import lombok.AllArgsConstructor;

/**
 * 시설 정보를 담는 데이터 전송 객체 (DTO)
 * DB 스키마 및 Mapper의 property 이름에 맞춰 필드명을 설정합니다.
 */
@Data
@EqualsAndHashCode(callSuper = true)
@NoArgsConstructor
@AllArgsConstructor
public class FacilityDTO extends BaseDTO {

    // DB 컬럼과 일치하는 필드 (snake_case는 camelCase로 변환)
    private Long facilityId; // DB: facility_id
    private String facilityName; // DB: facility_name
    private String facilityType; // DB: facility_type
    private String address; // DB: address
    private String detailAddress; // DB: detail_address
    private String phone; // DB: phone_number (DB 스키마에 맞춰 'phone'으로 통일)
    private Double longitude; // DB: longitude
    private Double latitude; // DB: latitude
    private String description;
    private String facilityImage; // DB: facility_image
    private String facilityImageAltText; // DB: facility_image_alt_text (SEO 최적화용)
    private String homepage;
    private Integer capacity;
    private Integer currentOccupancy;
    private String operatingHours;
    private String features;
    private Boolean isApproved; // DB: is_approved
    private Boolean isDeleted; // DB: is_deleted
    private String approvalStatus; // DB: approval_status
    private String rejectionReason; // DB: rejection_reason (관리자용)
    private Long registeredMemberId; // DB: registered_member_id
    private String registeredMemberName; // DB: registered_member_name
    private String registeredUserName; // DB: registered_user_name (관리자용 - 로그인 ID)
    private Double averageRating; // DB: average_rating (스키마에 존재)
    private Integer reviewCount; // DB: review_count (스키마에 존재)
    private Integer gradeRating; // DB: grade_rating (스키마에 존재)

    // 검색 조건으로 사용되는 필드 (DB 컬럼과 직접 매핑되지 않음)
    private String region;
    private Double swLat;
    private Double swLng;
    private Double neLat;
    private Double neLng;

    // 상태 정보 (UI 표시용)
    private String status; // 시설 상태 (정상, 삭제됨, 승인대기)

    // 시설 상태 확인 메서드
    public boolean isNormalStatus() {
        return "정상".equals(status);
    }

    public boolean isDeletedStatus() {
        return "삭제됨".equals(status);
    }

    public boolean isPendingStatus() {
        return "승인대기".equals(status);
    }

    // 시설 상태 메시지 반환
    public String getStatusMessage() {
        if (isDeletedStatus()) {
            return "삭제된 시설입니다.";
        } else if (isPendingStatus()) {
            return "승인 대기 중인 시설입니다.";
        }
        return "";
    }
}
````

## File: src/main/java/com/example/carelink/dto/MemberDTO.java
````java
package com.example.carelink.dto;

import com.example.carelink.common.BaseDTO;
import com.example.carelink.validation.groups.OnFacilityJoin;
import lombok.Data;
import lombok.EqualsAndHashCode;
import org.springframework.web.multipart.MultipartFile; // MultipartFile import 유지

import javax.validation.constraints.Email;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.Pattern;
import javax.validation.constraints.Size; // Size 어노테이션 추가 (제공해주신 내용에 포함됨)

/**
 * 회원 정보 DTO
 * 팀원 A 담당: 회원 관리 기능 (로그인, 회원가입)
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class MemberDTO extends BaseDTO {

    private Long memberId;        // 회원 ID (자동증가)

    @NotBlank(message = "사용자 ID는 필수입니다.")
    @Pattern(regexp = "^[a-zA-Z0-9]{4,20}$", message = "사용자 ID는 4-20자의 영문, 숫자만 가능합니다.")
    private String userId;        // 사용자 ID (로그인용)

    // 비밀번호는 회원가입 시에만 @NotBlank를 적용하고, 회원 정보 수정 시에는 적용하지 않도록
    // 별도의 DTO를 만들거나 @Validated 그룹을 사용하는 것이 더 유연합니다.
    // 여기서는 일단 기본 설정만 유지하며, 필요 시 컨트롤러나 서비스에서 조건부 유효성 검사를 수행합니다.
    @NotBlank(message = "비밀번호는 필수입니다.")
    @Pattern(regexp = "^(?=.*[A-Za-z])(?=.*\\d)[A-Za-z\\d@$!%*#?&]{8,20}$",
            message = "비밀번호는 8-20자의 영문, 숫자, 특수문자를 1개 이상 포함해야 합니다.")
    private String password;      // 비밀번호

    @NotBlank(message = "이름은 필수입니다.")
    @Size(max = 50, message = "이름은 50자를 초과할 수 없습니다.") // 예시: 이름 길이 제한 추가
    private String name;          // 이름

    @NotBlank(message = "이메일은 필수 입력 항목입니다.")
    @Email(message = "올바른 이메일 형식이 아닙니다.")
    @Size(max = 100, message = "이메일은 100자를 초과할 수 없습니다.") // 예시: 이메일 길이 제한 추가
    private String email;         // 이메일 (필수사항)

    // 휴대폰 번호 패턴 수정: 빈 문자열("")도 허용하도록 ^$| 를 추가합니다.
    @Pattern(regexp = "^$|^01(?:0|1|[6-9])-(?:\\d{3}|\\d{4})-\\d{4}$",
            message = "올바른 휴대폰 번호 형식이 아닙니다.")
    private String phone;

    private String role;          // 회원 역할 (USER, FACILITY, ADMIN)

    // 시설회원 가입 시에만 address가 필수임을 지정 (OnFacilityJoin 그룹에 속할 때만 검사)
    @NotBlank(message = "시설 주소는 필수 입력 항목입니다.", groups = OnFacilityJoin.class)
    private String address;       // 주소 (DDL에 따라 VARCHAR 길이 제한 추가 고려)

    private String profileImage;  // 프로필 이미지 경로 (DB에 저장될 URL)
    private String profileImageAltText;  // 프로필 이미지 alt 텍스트 (SEO 최적화용)
    
    // 시설회원 추가 정보 (facility 테이블에 저장될 정보)
    private String facilityName;     // 시설명
    private String facilityType;     // 시설 유형 (NURSING_HOME, HOSPITAL, DAY_CARE)
    private String facilityAddress;  // 시설 주소 (카카오 주소 검색으로 입력)
    private String detailAddress;    // 상세 주소
    private String facilityPhone;    // 시설 전화번호
    private String description;      // 시설 설명
    private String homepage;         // 홈페이지 URL
    private Integer capacity;        // 수용 인원
    private String operatingHours;   // 운영 시간
    private String features;         // 시설 특징
    private Double latitude;         // 위도 (카카오 주소 검색으로 자동 설정)
    private Double longitude;        // 경도 (카카오 주소 검색으로 자동 설정)

    // DB 테이블의 is_active 컬럼과 매핑
    private Boolean isActive;     // 계정 활성화 여부 (Boolean으로 변경하여 null 허용, 기본값은 DB에서 설정)

    // 논리적 삭제 여부 (DDL의 is_deleted 컬럼과 매핑)
    private Boolean isDeleted;    // 계정 삭제 여부 (true: 삭제됨, false: 유지됨)

    // 비밀번호 확인용 (DB에 저장되지 않음, 회원가입/비밀번호 변경 폼에서만 사용)
    private transient String passwordConfirm;
    // 로그인 실패 횟수
    private int loginFailCount;

    // 마지막 로그인 시간
    private java.time.LocalDateTime lastLoginAt;

    // 프로필 이미지 파일 업로드용 (DB에 저장되지 않는 필드, DTO가 폼 데이터를 받을 때 사용)
    // myinfo.html의 <input type="file" name="profileImageFile"> 와 매핑됩니다.
    private transient MultipartFile profileImageFile; // 파일 자체를 받기 위한 필드
}
````

## File: src/main/java/com/example/carelink/service/FacilityImageService.java
````java
package com.example.carelink.service;

import com.example.carelink.dao.FacilityImageMapper;
import com.example.carelink.dao.FacilityMapper;
import com.example.carelink.dto.FacilityImageDTO;
import com.example.carelink.common.Constants;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.UUID;

@Service
public class FacilityImageService {

    private final FacilityImageMapper facilityImageMapper;
    private final FacilityMapper facilityMapper;
    private static final Logger log = LoggerFactory.getLogger(FacilityImageService.class);

    @Autowired
    public FacilityImageService(FacilityImageMapper facilityImageMapper, FacilityMapper facilityMapper) {
        this.facilityImageMapper = facilityImageMapper;
        this.facilityMapper = facilityMapper;
    }

    /**
     * 시설의 모든 이미지 조회
     */
    @Transactional(readOnly = true)
    public List<FacilityImageDTO> getImagesByFacilityId(Long facilityId) {
        log.info("시설 이미지 목록 조회 시작 - facilityId: {}", facilityId);
        List<FacilityImageDTO> images = facilityImageMapper.getImagesByFacilityId(facilityId);
        log.info("시설 이미지 목록 조회 완료 - facilityId: {}, 이미지 수: {}", facilityId, images.size());
        return images;
    }

    /**
     * 시설의 메인 이미지 조회
     */
    @Transactional(readOnly = true)
    public FacilityImageDTO getMainImageByFacilityId(Long facilityId) {
        log.info("시설 메인 이미지 조회 - facilityId: {}", facilityId);
        return facilityImageMapper.getMainImageByFacilityId(facilityId);
    }

    /**
     * 다중 시설 이미지 저장 (5장 제한 적용)
     */
    @Transactional
    public void saveFacilityImages(Long facilityId, List<MultipartFile> imageFiles, List<String> altTexts) {
        try {
            log.info("📸 다중 시설 이미지 저장 시작 - facilityId: {}, 요청 이미지 수: {}", facilityId, imageFiles.size());
            
            // 기존 이미지 개수 확인
            int existingImageCount = facilityImageMapper.countImagesByFacilityId(facilityId);
            
            // 저장할 이미지 수 계산 (기존 + 새로운 이미지가 5장을 넘지 않도록)
            List<MultipartFile> validFiles = new ArrayList<>();
            for (MultipartFile file : imageFiles) {
                if (!file.isEmpty() && validFiles.size() + existingImageCount < Constants.MAX_FACILITY_IMAGES) {
                    validateImageFile(file);
                    validFiles.add(file);
                }
            }
            
            if (validFiles.isEmpty()) {
                throw new IllegalArgumentException("저장할 유효한 이미지 파일이 없습니다.");
            }
            
            if (existingImageCount + validFiles.size() > Constants.MAX_FACILITY_IMAGES) {
                log.warn("⚠️ 일부 이미지는 5장 제한으로 인해 저장되지 않습니다. 기존: {}장, 요청: {}장, 저장 가능: {}장", 
                    existingImageCount, imageFiles.size(), validFiles.size());
            }
            
            log.info("📊 이미지 저장 계획 - 기존: {}장, 새로 저장: {}장, 총: {}장", 
                existingImageCount, validFiles.size(), existingImageCount + validFiles.size());
            
            for (int i = 0; i < validFiles.size(); i++) {
                MultipartFile file = validFiles.get(i);
                String altText = (altTexts != null && i < altTexts.size()) ? altTexts.get(i) : null;
                
                // 파일 저장
                String imagePath = saveImageFile(file, facilityId.toString(), existingImageCount + i);
                
                // 데이터베이스에 저장
                FacilityImageDTO imageDTO = new FacilityImageDTO();
                imageDTO.setFacilityId(facilityId);
                imageDTO.setImagePath(imagePath);
                imageDTO.setImageAltText(altText);
                imageDTO.setImageOrder(existingImageCount + i);
                // 전체 첫 번째 이미지인 경우에만 메인으로 설정
                imageDTO.setIsMainImage(existingImageCount == 0 && i == 0);
                
                facilityImageMapper.insertFacilityImage(imageDTO);
                log.info("✅ 시설 이미지 저장 완료 - order: {}, path: {}", existingImageCount + i, imagePath);
            }
            
            // 시설 테이블의 메인 이미지 정보 업데이트
            updateFacilityMainImageInfo(facilityId);
            
            log.info("🎉 다중 시설 이미지 저장 완료 - facilityId: {}, 총 {}장 저장", facilityId, validFiles.size());
            
        } catch (Exception e) {
            log.error("❌ 시설 이미지 저장 중 오류 발생 - facilityId: {}", facilityId, e);
            throw new RuntimeException("시설 이미지 저장에 실패했습니다.", e);
        }
    }

    /**
     * 단일 시설 이미지 저장 (5장 제한 적용)
     */
    @Transactional
    public FacilityImageDTO saveSingleFacilityImage(Long facilityId, MultipartFile imageFile, String altText, Integer imageOrder) {
        return saveSingleFacilityImage(facilityId, imageFile, altText, imageOrder, null);
    }
    
    /**
     * 단일 시설 이미지 저장 (사용자 지정 파일명 지원)
     */
    @Transactional
    public FacilityImageDTO saveSingleFacilityImage(Long facilityId, MultipartFile imageFile, String altText, Integer imageOrder, String customFileName) {
        try {
            log.info("📸 단일 시설 이미지 저장 시작 - facilityId: {}, order: {}, customFileName: '{}'", facilityId, imageOrder, customFileName);
            
            if (imageFile.isEmpty()) {
                throw new IllegalArgumentException("업로드된 이미지 파일이 비어있습니다.");
            }
            
            // 기존 이미지 개수 확인 (5장 제한)
            int existingImageCount = facilityImageMapper.countImagesByFacilityId(facilityId);
            if (existingImageCount >= Constants.MAX_FACILITY_IMAGES) {
                throw new IllegalArgumentException(String.format("시설 이미지는 최대 %d장까지만 등록할 수 있습니다. 현재 %d장 등록됨", 
                    Constants.MAX_FACILITY_IMAGES, existingImageCount));
            }
            
            // 파일 확장자 검증
            validateImageFile(imageFile);
            
            // 파일 저장 (사용자 지정 파일명 적용)
            String imagePath = saveImageFileWithCustomName(imageFile, facilityId.toString(), 
                imageOrder != null ? imageOrder : existingImageCount, customFileName);
            
            // 데이터베이스에 저장
            FacilityImageDTO imageDTO = new FacilityImageDTO();
            imageDTO.setFacilityId(facilityId);
            imageDTO.setImagePath(imagePath);
            imageDTO.setImageAltText(altText);
            imageDTO.setImageOrder(imageOrder != null ? imageOrder : existingImageCount);
            // 첫 번째 이미지인 경우 자동으로 메인 이미지로 설정
            imageDTO.setIsMainImage(existingImageCount == 0);
            
            facilityImageMapper.insertFacilityImage(imageDTO);
            log.info("✅ facility_images 테이블에 저장 완료 - imageId: {}, path: {}, 현재 총 {}장", 
                imageDTO.getImageId(), imagePath, existingImageCount + 1);
            
            // 시설 테이블의 메인 이미지 정보도 업데이트
            updateFacilityMainImageInfo(facilityId);
            
            return imageDTO;
            
        } catch (Exception e) {
            log.error("❌ 단일 시설 이미지 저장 중 오류 발생 - facilityId: {}", facilityId, e);
            throw new RuntimeException("시설 이미지 저장에 실패했습니다.", e);
        }
    }
    
    /**
     * 시설 테이블의 메인 이미지 정보 업데이트
     */
    private void updateFacilityMainImageInfo(Long facilityId) {
        try {
            // 시설의 총 이미지 수 조회
            int imageCount = facilityImageMapper.countImagesByFacilityId(facilityId);
            
            // 메인 이미지 조회
            FacilityImageDTO mainImage = facilityImageMapper.getMainImageByFacilityId(facilityId);
            String mainImagePath = mainImage != null ? mainImage.getImagePath() : null;
            
            log.info("🔄 시설 테이블 메인 이미지 정보 업데이트 시작 - facilityId: {}, imageCount: {}, mainImagePath: {}", 
                    facilityId, imageCount, mainImagePath);
            
            // 시설 테이블의 facility_image, image_count 업데이트
            int updateResult = facilityMapper.updateFacilityMainImage(facilityId, mainImagePath, imageCount);
            
            if (updateResult > 0) {
                log.info("✅ 시설 테이블 업데이트 성공 - facilityId: {}, 업데이트된 행: {}", facilityId, updateResult);
            } else {
                log.warn("⚠️ 시설 테이블 업데이트 실패 - facilityId: {}, 업데이트된 행: {}", facilityId, updateResult);
            }
            
        } catch (Exception e) {
            log.error("❌ 시설 테이블 메인 이미지 정보 업데이트 중 오류 - facilityId: {}", facilityId, e);
            throw new RuntimeException("시설 메인 이미지 정보 업데이트에 실패했습니다.", e);
        }
    }

    /**
     * 시설 이미지 파일 저장 메서드 (사용자 지정 파일명 지원)
     */
    private String saveImageFileWithCustomName(MultipartFile file, String facilityId, int index, String customFileName) {
        try {
            // 로컬 업로드 디렉토리 사용
            String uploadDir = Constants.FACILITY_UPLOAD_PATH;
            File uploadDirFile = new File(uploadDir);
            if (!uploadDirFile.exists()) {
                boolean created = uploadDirFile.mkdirs();
                log.info("업로드 디렉토리 생성: {} - {}", uploadDir, created ? "성공" : "실패");
            }
            
            // 확장자 먼저 추출 (프로필 이미지 방식 적용)
            String originalFilename = file.getOriginalFilename();
            String extension = "";
            String baseName = "";
            
            if (originalFilename != null && originalFilename.contains(".")) {
                extension = originalFilename.substring(originalFilename.lastIndexOf("."));
                baseName = originalFilename.substring(0, originalFilename.lastIndexOf("."));
            } else if (originalFilename != null) {
                baseName = originalFilename;
                extension = ".jpg"; // 기본 확장자
            }
            
            String finalFileName;
            
            if (customFileName != null && !customFileName.trim().isEmpty()) {
                // 사용자 지정 파일명에서도 확장자 분리
                String userFileName = customFileName.trim();
                String userBaseName = userFileName;
                String userExtension = extension; // 원본 파일의 확장자 유지
                
                // 사용자 파일명에 확장자가 포함된 경우 분리
                if (userFileName.contains(".")) {
                    userBaseName = userFileName.substring(0, userFileName.lastIndexOf("."));
                    userExtension = userFileName.substring(userFileName.lastIndexOf("."));
                }
                
                // 한글 파일명을 영문으로 변환 (확장자 제외)
                String englishBaseName = convertKoreanToEnglish(userBaseName);
                String cleanBaseName = sanitizeFilename(englishBaseName);
                
                // 최종 파일명 생성 (확장자를 맨 마지막에 추가)
                finalFileName = String.format("facility_%s_%d_%s_%s%s", 
                        facilityId, index, cleanBaseName, 
                        UUID.randomUUID().toString().substring(0, 8), userExtension);
                log.info("📝 사용자 지정 파일명 적용: '{}' → '{}'", customFileName, finalFileName);
            } else {
                // 기본 파일명 로직 사용
                return saveImageFile(file, facilityId, index);
            }
            
            // 파일 저장
            File savedFile = new File(uploadDir + finalFileName);
            file.transferTo(savedFile);
            log.info("시설 이미지 파일 저장 완료: {}", savedFile.getAbsolutePath());
            
            // 웹 경로 반환
            return "/uploads/facility/" + finalFileName;
            
        } catch (IOException e) {
            log.error("시설 이미지 파일 저장 중 오류 발생: facilityId={}, index={}, customFileName={}", facilityId, index, customFileName, e);
            throw new RuntimeException("이미지 파일 저장에 실패했습니다.", e);
        }
    }
    
    /**
     * 시설 이미지 파일 저장 메서드 (기본)
     */
    private String saveImageFile(MultipartFile file, String facilityId, int index) {
        try {
            // 로컬 업로드 디렉토리 사용
            String uploadDir = Constants.FACILITY_UPLOAD_PATH;
            File uploadDirFile = new File(uploadDir);
            if (!uploadDirFile.exists()) {
                boolean created = uploadDirFile.mkdirs();
                log.info("업로드 디렉토리 생성: {} - {}", uploadDir, created ? "성공" : "실패");
            }
            
            // 파일명 생성 (한글 파일명 영문 변환 포함)
            String originalFilename = file.getOriginalFilename();
            String extension = "";
            String baseName = "";
            
            if (originalFilename != null && originalFilename.contains(".")) {
                extension = originalFilename.substring(originalFilename.lastIndexOf("."));
                baseName = originalFilename.substring(0, originalFilename.lastIndexOf("."));
            } else if (originalFilename != null) {
                baseName = originalFilename;
            }
            
            // 한글 파일명을 영문으로 변환
            String englishBaseName = convertKoreanToEnglish(baseName);
            String cleanBaseName = sanitizeFilename(englishBaseName);
            
            // 최종 파일명 생성
            String savedFilename;
            if (!cleanBaseName.isEmpty() && !cleanBaseName.equals("facility_image")) {
                savedFilename = String.format("facility_%s_%d_%s_%s%s", 
                        facilityId, index, cleanBaseName, UUID.randomUUID().toString().substring(0, 8), extension);
            } else {
                savedFilename = String.format("facility_%s_%d_%s%s", 
                        facilityId, index, UUID.randomUUID().toString(), extension);
            }
            
            log.info("📝 파일명 변환: '{}' → '{}'", originalFilename, savedFilename);
            
            // 파일 저장
            File savedFile = new File(uploadDir + savedFilename);
            file.transferTo(savedFile);
            log.info("시설 이미지 파일 저장 완료: {}", savedFile.getAbsolutePath());
            
            // 웹 경로 반환
            return "/uploads/facility/" + savedFilename;
            
        } catch (IOException e) {
            log.error("시설 이미지 파일 저장 중 오류 발생: facilityId={}, index={}", facilityId, index, e);
            throw new RuntimeException("이미지 파일 저장에 실패했습니다.", e);
        }
    }

    /**
     * 메인 이미지 변경
     */
    @Transactional
    public void updateMainImage(Long facilityId, Long imageId) {
        try {
            log.info("메인 이미지 변경 시작 - facilityId: {}, imageId: {}", facilityId, imageId);
            
            // 기존 메인 이미지 해제
            facilityImageMapper.clearMainImages(facilityId);
            
            // 새 메인 이미지 설정
            int result = facilityImageMapper.updateMainImage(facilityId, imageId);
            if (result == 0) {
                throw new RuntimeException("메인 이미지 설정에 실패했습니다.");
            }
            
            log.info("메인 이미지 변경 완료 - facilityId: {}, imageId: {}", facilityId, imageId);
            
        } catch (Exception e) {
            log.error("메인 이미지 변경 중 오류 발생 - facilityId: {}, imageId: {}", facilityId, imageId, e);
            throw new RuntimeException("메인 이미지 변경에 실패했습니다.", e);
        }
    }

    /**
     * 시설 이미지 완전 삭제 (DB + 파일 시스템)
     */
    @Transactional
    public boolean deleteFacilityImage(Long imageId) {
        try {
            log.info("🗑️ 시설 이미지 완전 삭제 시작 - imageId: {}", imageId);
            
            // 1. 먼저 이미지 정보 조회 (파일 경로 확인용)
            FacilityImageDTO imageToDelete = facilityImageMapper.getImageById(imageId);
            if (imageToDelete == null) {
                log.warn("⚠️ 삭제할 이미지를 찾을 수 없음 - imageId: {}", imageId);
                return false;
            }
            
            String imagePath = imageToDelete.getImagePath();
            log.info("📁 삭제 대상 파일: {}", imagePath);
            
            // 2. 데이터베이스에서 삭제
            int result = facilityImageMapper.deleteFacilityImage(imageId);
            boolean dbDeleteSuccess = result > 0;
            
            if (dbDeleteSuccess) {
                log.info("✅ DB에서 이미지 삭제 완료 - imageId: {}", imageId);
                
                // 3. 파일 시스템에서 실제 파일 삭제
                boolean fileDeleteSuccess = deleteImageFile(imagePath);
                
                if (fileDeleteSuccess) {
                    log.info("✅ 파일 시스템에서 이미지 삭제 완료 - path: {}", imagePath);
                } else {
                    log.warn("⚠️ 파일 삭제 실패하였지만 DB 삭제는 성공 - path: {}", imagePath);
                }
                
                return true; // DB 삭제가 성공하면 성공으로 간주
                
            } else {
                log.warn("❌ DB에서 이미지 삭제 실패 - imageId: {} (결과: {})", imageId, result);
                return false;
            }
            
        } catch (Exception e) {
            log.error("❌ 시설 이미지 삭제 중 오류 발생 - imageId: {}", imageId, e);
            return false;
        }
    }
    
    /**
     * 파일 시스템에서 이미지 파일 삭제
     */
    private boolean deleteImageFile(String imagePath) {
        try {
            if (imagePath == null || imagePath.trim().isEmpty()) {
                log.warn("⚠️ 삭제할 파일 경로가 비어있음");
                return false;
            }
            
            // 웹 경로를 실제 파일 시스템 경로로 변환
            String actualFilePath;
            if (imagePath.startsWith("/uploads/facility/")) {
                String filename = imagePath.substring("/uploads/facility/".length());
                actualFilePath = Constants.FACILITY_UPLOAD_PATH + filename;
            } else {
                log.warn("⚠️ 예상치 못한 파일 경로 형식: {}", imagePath);
                return false;
            }
            
            log.info("🔍 실제 파일 경로: {}", actualFilePath);
            
            File fileToDelete = new File(actualFilePath);
            
            if (fileToDelete.exists()) {
                boolean deleted = fileToDelete.delete();
                if (deleted) {
                    log.info("✅ 파일 삭제 성공: {}", actualFilePath);
                    return true;
                } else {
                    log.error("❌ 파일 삭제 실패: {}", actualFilePath);
                    return false;
                }
            } else {
                log.warn("⚠️ 삭제할 파일이 존재하지 않음: {}", actualFilePath);
                return true; // 파일이 없으면 삭제된 것으로 간주
            }
            
        } catch (Exception e) {
            log.error("❌ 파일 삭제 중 오류 발생 - imagePath: {}", imagePath, e);
            return false;
        }
    }

    /**
     * 시설의 이미지 개수 조회
     */
    @Transactional(readOnly = true)
    public int getImageCountByFacilityId(Long facilityId) {
        return facilityImageMapper.countImagesByFacilityId(facilityId);
    }
    
    /**
     * 메인 이미지 설정 (boolean 반환)
     */
    @Transactional
    public boolean setMainImage(Long facilityId, Long imageId) {
        try {
            log.info("메인 이미지 설정 시작 - facilityId: {}, imageId: {}", facilityId, imageId);
            
            // 기존 메인 이미지 해제
            facilityImageMapper.clearMainImages(facilityId);
            
            // 새 메인 이미지 설정
            int result = facilityImageMapper.updateMainImage(facilityId, imageId);
            boolean success = result > 0;
            
            if (success) {
                log.info("메인 이미지 설정 완료 - facilityId: {}, imageId: {}", facilityId, imageId);
            } else {
                log.warn("메인 이미지 설정 실패 - facilityId: {}, imageId: {} (결과: {})", facilityId, imageId, result);
            }
            
            return success;
            
        } catch (Exception e) {
            log.error("메인 이미지 설정 중 오류 발생 - facilityId: {}, imageId: {}", facilityId, imageId, e);
            return false;
        }
    }
    
    /**
     * 특정 이미지 ID로 이미지 조회 (권한 확인용)
     */
    @Transactional(readOnly = true)
    public FacilityImageDTO getImageById(Long imageId) {
        log.info("시설 이미지 조회 - imageId: {}", imageId);
        return facilityImageMapper.getImageById(imageId);
    }
    
    /**
     * 모든 이미지 조회 (임시 - 더 나은 방법으로 대체 예정)
     */
    @Transactional(readOnly = true)
    public List<FacilityImageDTO> getAllImages() {
        // 임시 구현: 실제로는 특정 시설의 이미지만 조회하는 것이 좋음
        log.info("모든 시설 이미지 목록 조회 (임시)");
        // 임시로 빈 리스트 반환하고 getImageById 사용
        return java.util.Collections.emptyList();
    }
    
    /**
     * 한글 파일명을 영문으로 변환 (실제 번역 + 로마자 변환)
     */
    private String convertKoreanToEnglish(String korean) {
        if (korean == null || korean.trim().isEmpty()) {
            return "facility_image";
        }
        
        String input = korean.toLowerCase().trim();
        String result = input;
        
        // 1단계: 의미 있는 한글 키워드를 영문으로 번역
        java.util.Map<String, String> koreanToEnglish = java.util.Map.ofEntries(
            // 시설 종류
            java.util.Map.entry("시설", "facility"),
            java.util.Map.entry("요양원", "nursing_home"),
            java.util.Map.entry("요양병원", "nursing_hospital"),
            java.util.Map.entry("병원", "hospital"),
            java.util.Map.entry("의원", "clinic"),
            java.util.Map.entry("데이케어", "daycare"),
            java.util.Map.entry("센터", "center"),
            java.util.Map.entry("홈", "home"),
            java.util.Map.entry("케어", "care"),
            
            // 공간 (기본)
            java.util.Map.entry("외관", "exterior"),
            java.util.Map.entry("외부", "exterior"), 
            java.util.Map.entry("건물", "building"),
            java.util.Map.entry("입구", "entrance"),
            java.util.Map.entry("현관", "entrance"),
            java.util.Map.entry("내부", "interior"),
            java.util.Map.entry("로비", "lobby"),
            java.util.Map.entry("복도", "corridor"),
            java.util.Map.entry("홀", "hall"),
            
            // 공간 (거주)
            java.util.Map.entry("방", "room"),
            java.util.Map.entry("객실", "room"),
            java.util.Map.entry("침실", "bedroom"),
            java.util.Map.entry("생활실", "living_room"),
            java.util.Map.entry("휴게실", "rest_room"),
            
            // 공간 (생활)
            java.util.Map.entry("식당", "dining_room"),
            java.util.Map.entry("주방", "kitchen"),
            java.util.Map.entry("카페", "cafe"),
            java.util.Map.entry("화장실", "restroom"),
            java.util.Map.entry("욕실", "bathroom"),
            java.util.Map.entry("세탁실", "laundry"),
            
            // 공간 (의료)
            java.util.Map.entry("치료실", "treatment_room"),
            java.util.Map.entry("의무실", "medical_room"),
            java.util.Map.entry("상담실", "consultation_room"),
            java.util.Map.entry("간호사실", "nurses_station"),
            
            // 공간 (재활/운동)
            java.util.Map.entry("재활실", "rehabilitation_room"),
            java.util.Map.entry("물리치료실", "physical_therapy_room"),
            java.util.Map.entry("운동실", "exercise_room"),
            java.util.Map.entry("헬스장", "gym"),
            
            // 공간 (활동)
            java.util.Map.entry("프로그램실", "program_room"),
            java.util.Map.entry("강당", "auditorium"),
            java.util.Map.entry("도서실", "library"),
            java.util.Map.entry("오락실", "recreation_room"),
            
            // 공간 (외부)
            java.util.Map.entry("정원", "garden"),
            java.util.Map.entry("마당", "yard"),
            java.util.Map.entry("테라스", "terrace"),
            java.util.Map.entry("발코니", "balcony"),
            java.util.Map.entry("주차장", "parking_lot"),
            java.util.Map.entry("산책로", "walking_path"),
            
            // 공간 (기타)
            java.util.Map.entry("엘리베이터", "elevator"),
            java.util.Map.entry("계단", "stairs"),
            java.util.Map.entry("사무실", "office"),
            java.util.Map.entry("접수처", "reception"),
            
            // 서비스/의료
            java.util.Map.entry("간호", "nursing"),
            java.util.Map.entry("간병", "care"),
            java.util.Map.entry("치료", "treatment"),
            java.util.Map.entry("재활", "rehabilitation"),
            java.util.Map.entry("물리치료", "physical_therapy"),
            java.util.Map.entry("건강관리", "health_care"),
            
            // 특징/상태
            java.util.Map.entry("깨끗한", "clean"),
            java.util.Map.entry("밝은", "bright"),
            java.util.Map.entry("넓은", "spacious"),
            java.util.Map.entry("안전한", "safe"),
            java.util.Map.entry("편안한", "comfortable"),
            java.util.Map.entry("현대적", "modern"),
            java.util.Map.entry("고급", "premium"),
            
            // 시간/위치
            java.util.Map.entry("아침", "morning"),
            java.util.Map.entry("점심", "lunch"),
            java.util.Map.entry("저녁", "evening"),
            java.util.Map.entry("앞", "front"),
            java.util.Map.entry("뒤", "back"),
            java.util.Map.entry("층", "floor"),
            java.util.Map.entry("1층", "first_floor"),
            java.util.Map.entry("2층", "second_floor"),
            
            // 숫자
            java.util.Map.entry("1", "one"),
            java.util.Map.entry("2", "two"),
            java.util.Map.entry("3", "three"),
            java.util.Map.entry("4", "four"),
            java.util.Map.entry("5", "five"),
            java.util.Map.entry("첫번째", "first"),
            java.util.Map.entry("두번째", "second"),
            java.util.Map.entry("세번째", "third")
        );
        
        // 키워드 변환 적용
        for (java.util.Map.Entry<String, String> entry : koreanToEnglish.entrySet()) {
            result = result.replace(entry.getKey(), entry.getValue());
        }
        
        // 2단계: 남은 한글을 로마자로 변환
        if (containsKorean(result)) {
            result = convertKoreanToRomanization(result);
        }
        
        return result;
    }
    
    /**
     * 한글을 로마자로 변환 (간단한 로마자 변환)
     */
    private String convertKoreanToRomanization(String korean) {
        if (korean == null || korean.trim().isEmpty()) {
            return "korean_text";
        }
        
        // 기본적인 한글 자모 로마자 변환 테이블
        java.util.Map<String, String> koreanRomanization = java.util.Map.ofEntries(
            // 자음 (초성)
            java.util.Map.entry("ㄱ", "g"), java.util.Map.entry("ㄴ", "n"), java.util.Map.entry("ㄷ", "d"),
            java.util.Map.entry("ㄹ", "r"), java.util.Map.entry("ㅁ", "m"), java.util.Map.entry("ㅂ", "b"),
            java.util.Map.entry("ㅅ", "s"), java.util.Map.entry("ㅇ", ""), java.util.Map.entry("ㅈ", "j"),
            java.util.Map.entry("ㅊ", "ch"), java.util.Map.entry("ㅋ", "k"), java.util.Map.entry("ㅌ", "t"),
            java.util.Map.entry("ㅍ", "p"), java.util.Map.entry("ㅎ", "h"),
            
            // 모음
            java.util.Map.entry("ㅏ", "a"), java.util.Map.entry("ㅑ", "ya"), java.util.Map.entry("ㅓ", "eo"),
            java.util.Map.entry("ㅕ", "yeo"), java.util.Map.entry("ㅗ", "o"), java.util.Map.entry("ㅛ", "yo"),
            java.util.Map.entry("ㅜ", "u"), java.util.Map.entry("ㅠ", "yu"), java.util.Map.entry("ㅡ", "eu"),
            java.util.Map.entry("ㅣ", "i"), java.util.Map.entry("ㅐ", "ae"), java.util.Map.entry("ㅔ", "e"),
            
            // 일반적인 한글 단어 로마자 변환
            java.util.Map.entry("가", "ga"), java.util.Map.entry("나", "na"), java.util.Map.entry("다", "da"),
            java.util.Map.entry("라", "ra"), java.util.Map.entry("마", "ma"), java.util.Map.entry("바", "ba"),
            java.util.Map.entry("사", "sa"), java.util.Map.entry("자", "ja"), java.util.Map.entry("차", "cha"),
            java.util.Map.entry("카", "ka"), java.util.Map.entry("타", "ta"), java.util.Map.entry("파", "pa"),
            java.util.Map.entry("하", "ha"),
            
            // 자주 사용되는 한글 조합
            java.util.Map.entry("김", "kim"), java.util.Map.entry("이", "lee"), java.util.Map.entry("박", "park"),
            java.util.Map.entry("최", "choi"), java.util.Map.entry("정", "jung"), java.util.Map.entry("강", "kang"),
            java.util.Map.entry("조", "cho"), java.util.Map.entry("윤", "yoon"), java.util.Map.entry("장", "jang"),
            java.util.Map.entry("임", "lim"), java.util.Map.entry("한", "han"), java.util.Map.entry("오", "oh"),
            java.util.Map.entry("서", "seo"), java.util.Map.entry("신", "shin"), java.util.Map.entry("권", "kwon"),
            java.util.Map.entry("황", "hwang"), java.util.Map.entry("안", "ahn"), java.util.Map.entry("송", "song"),
            java.util.Map.entry("류", "ryu"), java.util.Map.entry("전", "jeon"), java.util.Map.entry("홍", "hong")
        );
        
        String result = korean;
        
        // 로마자 변환 적용
        for (java.util.Map.Entry<String, String> entry : koreanRomanization.entrySet()) {
            result = result.replace(entry.getKey(), entry.getValue());
        }
        
        // 변환되지 않은 한글이 있으면 안전한 기본값 사용
        if (containsKorean(result)) {
            result = "korean_" + System.currentTimeMillis() % 10000;
        }
        
        return result;
    }
    
    /**
     * 파일명 정리 (특수문자 제거, 영문자와 숫자만 유지)
     */
    private String sanitizeFilename(String filename) {
        if (filename == null || filename.trim().isEmpty()) {
            return "facility_image";
        }
        
        // 영문자, 숫자, 하이픈, 언더스코어만 유지
        String sanitized = filename.replaceAll("[^a-zA-Z0-9_-]", "_")
                                  .replaceAll("_{2,}", "_")  // 연속된 언더스코어 제거
                                  .replaceAll("^_+|_+$", ""); // 앞뒤 언더스코어 제거
        
        // 너무 길면 자르기 (최대 30자)
        if (sanitized.length() > 30) {
            sanitized = sanitized.substring(0, 30);
        }
        
        // 비어있으면 기본값
        if (sanitized.isEmpty()) {
            sanitized = "facility_image";
        }
        
        return sanitized;
    }
    
    /**
     * 문자열에 한글이 포함되어 있는지 확인
     */
    private boolean containsKorean(String text) {
        if (text == null) return false;
        return text.matches(".*[ㄱ-ㅎㅏ-ㅣ가-힣]+.*");
    }
    
    /**
     * 이미지 파일 유효성 검증 (확장자, 크기 등)
     */
    private void validateImageFile(MultipartFile file) {
        if (file == null || file.isEmpty()) {
            throw new IllegalArgumentException("이미지 파일이 비어있습니다.");
        }
        
        // 파일 크기 검증
        if (file.getSize() > Constants.MAX_FILE_SIZE) {
            throw new IllegalArgumentException(String.format("파일 크기가 너무 큽니다. 최대 %dMB까지 업로드 가능합니다.", 
                Constants.MAX_FILE_SIZE / (1024 * 1024)));
        }
        
        // 파일 확장자 검증
        String originalFilename = file.getOriginalFilename();
        if (originalFilename == null || !originalFilename.contains(".")) {
            throw new IllegalArgumentException("유효하지 않은 파일입니다.");
        }
        
        String extension = originalFilename.substring(originalFilename.lastIndexOf(".") + 1).toLowerCase();
        boolean isValidExtension = false;
        for (String allowedExt : Constants.ALLOWED_IMAGE_EXTENSIONS) {
            if (allowedExt.equals(extension)) {
                isValidExtension = true;
                break;
            }
        }
        
        if (!isValidExtension) {
            throw new IllegalArgumentException(String.format("지원하지 않는 파일 형식입니다. 지원 형식: %s", 
                String.join(", ", Constants.ALLOWED_IMAGE_EXTENSIONS)));
        }
        
        // Content-Type 검증 (추가 보안)
        String contentType = file.getContentType();
        if (contentType == null || !contentType.startsWith("image/")) {
            throw new IllegalArgumentException("이미지 파일만 업로드 가능합니다.");
        }
        
        log.debug("✅ 이미지 파일 검증 통과 - 파일명: {}, 크기: {}KB, 타입: {}", 
            originalFilename, file.getSize() / 1024, contentType);
    }
    
    /**
     * 이미지 순서 업데이트 (데이터 정합성 보장)
     */
    @Transactional
    public boolean updateImageOrder(Long imageId, Integer imageOrder) {
        try {
            log.info("🔢 이미지 순서 업데이트 - imageId: {}, newOrder: {}", imageId, imageOrder);
            
            int result = facilityImageMapper.updateImageOrder(imageId, imageOrder);
            boolean success = result > 0;
            
            if (success) {
                log.info("✅ 이미지 순서 업데이트 성공 - imageId: {}, newOrder: {}", imageId, imageOrder);
            } else {
                log.warn("⚠️ 이미지 순서 업데이트 실패 - imageId: {}, newOrder: {}", imageId, imageOrder);
            }
            
            return success;
            
        } catch (Exception e) {
            log.error("❌ 이미지 순서 업데이트 중 오류 발생 - imageId: {}, newOrder: {}", imageId, imageOrder, e);
            return false;
        }
    }
    
    /**
     * 시설의 모든 이미지 순서 재정렬 (중복 방지 및 데이터 정합성 보장)
     */
    @Transactional
    public boolean reorderAllFacilityImages(Long facilityId) {
        try {
            log.info("🔄 시설 이미지 순서 재정렬 시작 - facilityId: {}", facilityId);
            
            // 현재 이미지들을 순서대로 조회 (업로드 순서 기준)
            List<FacilityImageDTO> images = facilityImageMapper.getImagesByFacilityId(facilityId);
            
            if (images.isEmpty()) {
                log.info("ℹ️ 재정렬할 이미지가 없음 - facilityId: {}", facilityId);
                return true;
            }
            
            log.info("📊 재정렬할 이미지 수: {} - facilityId: {}", images.size(), facilityId);
            
            // 각 이미지의 순서를 0, 1, 2, 3, 4로 재설정
            for (int i = 0; i < images.size(); i++) {
                FacilityImageDTO image = images.get(i);
                int newOrder = i;
                
                // 기존 순서와 다른 경우에만 업데이트
                if (image.getImageOrder() == null || !image.getImageOrder().equals(newOrder)) {
                    int updateResult = facilityImageMapper.updateImageOrder(image.getImageId(), newOrder);
                    
                    if (updateResult > 0) {
                        log.debug("✅ 이미지 순서 재정렬 - imageId: {}, 기존: {} → 새로운: {}", 
                            image.getImageId(), image.getImageOrder(), newOrder);
                    } else {
                        log.warn("⚠️ 이미지 순서 재정렬 실패 - imageId: {}, 새로운 순서: {}", 
                            image.getImageId(), newOrder);
                    }
                }
            }
            
            log.info("✅ 시설 이미지 순서 재정렬 완료 - facilityId: {}", facilityId);
            return true;
            
        } catch (Exception e) {
            log.error("❌ 시설 이미지 순서 재정렬 중 오류 발생 - facilityId: {}", facilityId, e);
            return false;
        }
    }
    
    /**
     * 배치로 이미지 순서 업데이트 (프론트에서 전달받은 순서대로)
     */
    @Transactional
    public boolean updateImageOrdersBatch(Long facilityId, List<Long> imageIds) {
        try {
            log.info("🔢 배치 이미지 순서 업데이트 시작 - facilityId: {}, imageIds: {}", facilityId, imageIds);
            
            if (imageIds == null || imageIds.isEmpty()) {
                log.warn("⚠️ 업데이트할 이미지 ID 목록이 비어있음 - facilityId: {}", facilityId);
                return false;
            }
            
            // 시설의 기존 이미지 개수 확인
            int existingImageCount = facilityImageMapper.countImagesByFacilityId(facilityId);
            
            if (imageIds.size() > existingImageCount) {
                log.warn("⚠️ 전달받은 이미지 ID 수가 기존 이미지 수보다 많음 - facilityId: {}, 전달받은: {}, 기존: {}", 
                    facilityId, imageIds.size(), existingImageCount);
                return false;
            }
            
            int successCount = 0;
            
            // 각 이미지의 순서를 업데이트
            for (int i = 0; i < imageIds.size(); i++) {
                Long imageId = imageIds.get(i);
                int newOrder = i; // 0부터 시작
                
                // 해당 이미지가 실제로 해당 시설의 이미지인지 확인
                FacilityImageDTO existingImage = facilityImageMapper.getImageById(imageId);
                if (existingImage == null || !existingImage.getFacilityId().equals(facilityId)) {
                    log.warn("⚠️ 잘못된 이미지 ID 또는 시설 불일치 - imageId: {}, facilityId: {}", 
                        imageId, facilityId);
                    continue;
                }
                
                int updateResult = facilityImageMapper.updateImageOrder(imageId, newOrder);
                if (updateResult > 0) {
                    successCount++;
                    log.debug("✅ 이미지 순서 업데이트 - imageId: {}, 새로운 순서: {}", imageId, newOrder);
                } else {
                    log.warn("⚠️ 이미지 순서 업데이트 실패 - imageId: {}, 새로운 순서: {}", imageId, newOrder);
                }
            }
            
            boolean success = successCount == imageIds.size();
            
            if (success) {
                log.info("✅ 배치 이미지 순서 업데이트 완료 - facilityId: {}, 성공: {}/{}", 
                    facilityId, successCount, imageIds.size());
            } else {
                log.warn("⚠️ 배치 이미지 순서 업데이트 부분 실패 - facilityId: {}, 성공: {}/{}", 
                    facilityId, successCount, imageIds.size());
            }
            
            return success;
            
        } catch (Exception e) {
            log.error("❌ 배치 이미지 순서 업데이트 중 오류 발생 - facilityId: {}", facilityId, e);
            return false;
        }
    }
    
    /**
     * 시설의 모든 이미지 완전 삭제 (시설 삭제 시 사용)
     */
    @Transactional
    public boolean deleteAllFacilityImages(Long facilityId) {
        try {
            log.info("🗑️ 시설의 모든 이미지 완전 삭제 시작 - facilityId: {}", facilityId);
            
            // 1. 먼저 모든 이미지 목록 조회 (파일 경로 확인용)
            List<FacilityImageDTO> imagesToDelete = facilityImageMapper.getImagesByFacilityId(facilityId);
            
            if (imagesToDelete.isEmpty()) {
                log.info("ℹ️ 삭제할 이미지가 없음 - facilityId: {}", facilityId);
                return true;
            }
            
            log.info("📊 삭제할 이미지 수: {}", imagesToDelete.size());
            
            // 2. 각 이미지의 파일 경로 수집
            List<String> imagePaths = new ArrayList<>();
            for (FacilityImageDTO image : imagesToDelete) {
                if (image.getImagePath() != null && !image.getImagePath().trim().isEmpty()) {
                    imagePaths.add(image.getImagePath());
                }
            }
            
            // 3. 데이터베이스에서 모든 이미지 삭제
            int deletedCount = facilityImageMapper.deleteAllImagesByFacilityId(facilityId);
            log.info("✅ DB에서 {} 개 이미지 삭제 완료 - facilityId: {}", deletedCount, facilityId);
            
            // 4. 파일 시스템에서 모든 파일 삭제
            int fileDeletedCount = 0;
            for (String imagePath : imagePaths) {
                if (deleteImageFile(imagePath)) {
                    fileDeletedCount++;
                }
            }
            
            log.info("✅ 파일 시스템에서 {}/{} 개 파일 삭제 완료", fileDeletedCount, imagePaths.size());
            
            return deletedCount > 0;
            
        } catch (Exception e) {
            log.error("❌ 시설의 모든 이미지 삭제 중 오류 발생 - facilityId: {}", facilityId, e);
            return false;
        }
    }

    /**
     * 다중 이미지 업로드 (Blob 방식)
     */
    @Transactional
    public List<FacilityImageDTO> uploadMultipleImages(Long facilityId, List<MultipartFile> images) {
        List<FacilityImageDTO> uploadedImages = new ArrayList<>();
        
        try {
            log.info("📤 다중 이미지 업로드 시작 - facilityId: {}, 이미지 수: {}", facilityId, images.size());
            
            // 현재 이미지 수 체크
            List<FacilityImageDTO> existingImages = facilityImageMapper.getImagesByFacilityId(facilityId);
            int currentCount = existingImages.size();
            int nextOrderNum = currentCount + 1;
            
            log.info("기존 이미지 수: {}, 시작 순서 번호: {}", currentCount, nextOrderNum);
            
            // 업로드 디렉토리 생성
            String uploadDir = Constants.FACILITY_UPLOAD_PATH;
            File directory = new File(uploadDir);
            if (!directory.exists()) {
                boolean created = directory.mkdirs();
                log.info("업로드 디렉토리 생성: {} (성공: {})", uploadDir, created);
            }
            
            // 각 이미지 처리
            for (int i = 0; i < images.size(); i++) {
                MultipartFile image = images.get(i);
                
                try {
                    // 파일명 생성 (UUID + 확장자)
                    String originalFilename = image.getOriginalFilename();
                    String extension = "";
                    if (originalFilename != null && originalFilename.contains(".")) {
                        extension = originalFilename.substring(originalFilename.lastIndexOf("."));
                    }
                    
                    String uniqueFilename = UUID.randomUUID().toString() + extension;
                    String filePath = uploadDir + uniqueFilename;
                    
                    // 파일 저장
                    File destinationFile = new File(filePath);
                    image.transferTo(destinationFile);
                    
                    log.info("파일 저장 완료: {} -> {}", originalFilename, uniqueFilename);
                    
                    // DTO 생성
                    FacilityImageDTO imageDTO = new FacilityImageDTO();
                    imageDTO.setFacilityId(facilityId);
                    imageDTO.setImagePath("/uploads/facility/" + uniqueFilename);
                    imageDTO.setImageAltText(originalFilename); // ALT 텍스트에 원본 파일명 저장
                    imageDTO.setImageOrder(nextOrderNum + i);
                    imageDTO.setIsMainImage(currentCount == 0 && i == 0); // 첫 번째 이미지가 메인
                    
                    // DB 저장
                    int result = facilityImageMapper.insertFacilityImage(imageDTO);
                    
                    if (result > 0) {
                        uploadedImages.add(imageDTO);
                        log.info("이미지 DB 저장 완료: {} (순서: {})", uniqueFilename, imageDTO.getImageOrder());
                    } else {
                        log.warn("이미지 DB 저장 실패: {}", uniqueFilename);
                        // 실패한 파일 삭제
                        destinationFile.delete();
                    }
                    
                } catch (IOException e) {
                    log.error("이미지 파일 저장 실패: {}", image.getOriginalFilename(), e);
                } catch (Exception e) {
                    log.error("이미지 처리 중 오류: {}", image.getOriginalFilename(), e);
                }
            }
            
            log.info("✅ 다중 이미지 업로드 완료 - facilityId: {}, 성공: {}/{}", 
                    facilityId, uploadedImages.size(), images.size());
            
            return uploadedImages;
            
        } catch (Exception e) {
            log.error("❌ 다중 이미지 업로드 중 오류 발생 - facilityId: {}", facilityId, e);
            
            // 실패 시 업로드된 파일들 롤백
            for (FacilityImageDTO uploadedImage : uploadedImages) {
                try {
                    if (uploadedImage.getImageId() != null) {
                        facilityImageMapper.deleteFacilityImage(uploadedImage.getImageId());
                    }
                    deleteImageFile(uploadedImage.getImagePath());
                } catch (Exception rollbackException) {
                    log.error("롤백 중 오류:", rollbackException);
                }
            }
            
            throw new RuntimeException("이미지 업로드 중 오류가 발생했습니다.", e);
        }
    }
}
````

## File: src/main/java/com/example/carelink/service/ReviewService.java
````java
package com.example.carelink.service;

import com.example.carelink.common.PageInfo;
import com.example.carelink.dao.ReviewMapper;
import com.example.carelink.dto.ReviewDTO;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;

/**
 * 리뷰 관련 비즈니스 로직 서비스
 * 팀원 D 담당
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class ReviewService {
    
    private final ReviewMapper reviewMapper;
    
    private static final int DEFAULT_PAGE_SIZE = 10;
    
    /**
     * 리뷰 목록 조회 (페이징 및 검색 포함)
     */
    public PageInfo<ReviewDTO> getReviewList(int page, String keyword) {
        return getReviewList(page, keyword, null, null);
    }
    
    /**
     * 리뷰 목록 조회 (페이징, 검색, 평점 필터 포함)
     */
    public PageInfo<ReviewDTO> getReviewList(int page, String keyword, Integer minRating) {
        return getReviewList(page, keyword, minRating, null);
    }
    
    /**
     * 리뷰 목록 조회 (페이징, 검색, 평점 필터, 시설 필터 포함)
     */
    public PageInfo<ReviewDTO> getReviewList(int page, String keyword, Integer minRating, Long facilityId) {
        log.info("리뷰 목록 조회 시작 - page: {}, keyword: {}, minRating: {}, facilityId: {}", page, keyword, minRating, facilityId);
        
        try {
            // 검색 조건 설정
            ReviewDTO searchDTO = new ReviewDTO();
            // BaseDTO의 setPage() 메서드가 자동으로 offset을 계산해줌
            searchDTO.setPage(page);
            searchDTO.setSize(DEFAULT_PAGE_SIZE);
            
            if (keyword != null && !keyword.trim().isEmpty()) {
                searchDTO.setSearchKeyword(keyword.trim());
            }
            
            if (minRating != null) {
                searchDTO.setMinRating(minRating);
            }
            
            if (facilityId != null) {
                searchDTO.setFacilityId(facilityId);
            }
            
            // 전체 리뷰 수 조회
            int totalCount = reviewMapper.countReviewsWithSearch(searchDTO);
            
            // 리뷰 목록 조회
            List<ReviewDTO> reviewList = reviewMapper.findReviewsWithSearch(searchDTO);
            
            log.info("리뷰 목록 조회 완료 - 조회된 건수: {}, 전체: {}", reviewList.size(), totalCount);
            
            // 페이징 정보 생성
            return new PageInfo<>(reviewList, page, DEFAULT_PAGE_SIZE, totalCount);
            
        } catch (Exception e) {
            log.error("리뷰 목록 조회 중 오류 발생", e);
            throw new RuntimeException("리뷰 목록을 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 리뷰 상세 정보 조회
     */
    @Transactional
    public ReviewDTO getReviewById(Long id) {
        log.info("리뷰 상세 조회 시작 - reviewId: {}", id);
        
        try {
            ReviewDTO review = reviewMapper.findReviewById(id);
            if (review == null) {
                throw new RuntimeException("해당 리뷰를 찾을 수 없습니다. ID: " + id);
            }
            
            // 조회수 증가
            reviewMapper.incrementViewCount(id);
            log.info("리뷰 상세 조회 완료 - reviewId: {}, title: {}", id, review.getTitle());
            
            return review;
        } catch (Exception e) {
            log.error("리뷰 상세 조회 중 오류 발생 - reviewId: {}", id, e);
            throw new RuntimeException("리뷰 상세 정보를 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 리뷰 등록
     */
    @Transactional
    public int insertReview(ReviewDTO reviewDTO) {
        log.info("리뷰 등록 시작 - title: {}, facilityId: {}", reviewDTO.getTitle(), reviewDTO.getFacilityId());
        
        try {
            // 필수 값 검증
            validateReviewData(reviewDTO);
            
            // 기본값 설정 (필요한 경우에만)
            if (reviewDTO.getStatus() == null) {
                reviewDTO.setStatus("ACTIVE");
            }
            if (reviewDTO.getReplyDepth() == null) {
                reviewDTO.setReplyDepth(0);
            }
            // isVisible은 기본적으로 true로 설정 (boolean 타입)
            reviewDTO.setVisible(true);
            // isDeleted는 false로 설정 (논리적 삭제를 위해)
            reviewDTO.setDeleted(false);
            
            int result = reviewMapper.insertReview(reviewDTO);
            log.info("리뷰 등록 완료 - reviewId: {}", reviewDTO.getReviewId());
            
            return result;
        } catch (Exception e) {
            log.error("리뷰 등록 중 오류 발생", e);
            throw new RuntimeException("리뷰 등록 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 시설별 리뷰 목록 조회
     */
    public List<ReviewDTO> getReviewsByFacilityId(Long facilityId) {
        log.info("시설별 리뷰 조회 시작 - facilityId: {}", facilityId);
        
        try {
            List<ReviewDTO> reviews = reviewMapper.findReviewsByFacilityId(facilityId);
            log.info("시설별 리뷰 조회 완료 - facilityId: {}, 조회된 건수: {}", facilityId, reviews.size());
            
            return reviews;
        } catch (Exception e) {
            log.error("시설별 리뷰 조회 중 오류 발생 - facilityId: {}", facilityId, e);
            throw new RuntimeException("시설별 리뷰를 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 리뷰 삭제 (논리 삭제)
     */
    @Transactional
    public int deleteReview(Long id) {
        log.info("리뷰 삭제 시작 - reviewId: {}", id);
        
        try {
            // 리뷰 존재 확인
            ReviewDTO existingReview = reviewMapper.findReviewById(id);
            if (existingReview == null) {
                throw new RuntimeException("삭제할 리뷰를 찾을 수 없습니다. ID: " + id);
            }
            
            int result = reviewMapper.deleteReview(id);
            log.info("리뷰 삭제 완료 - reviewId: {}", id);
            
            return result;
        } catch (Exception e) {
            log.error("리뷰 삭제 중 오류 발생 - reviewId: {}", id, e);
            throw new RuntimeException("리뷰 삭제 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 시설의 평균 평점 조회
     */
    public Double getAverageRating(Long facilityId) {
        log.info("평균 평점 조회 시작 - facilityId: {}", facilityId);
        
        try {
            Double averageRating = reviewMapper.getAverageRating(facilityId);
            if (averageRating == null) {
                averageRating = 0.0;
            }
            
            log.info("평균 평점 조회 완료 - facilityId: {}, 평균 평점: {}", facilityId, averageRating);
            return averageRating;
        } catch (Exception e) {
            log.error("평균 평점 조회 중 오류 발생 - facilityId: {}", facilityId, e);
            // 평점 조회 실패 시 0.0 반환
            return 0.0;
        }
    }
    
    /**
     * 리뷰 추천
     */
    @Transactional
    public int likeReview(Long reviewId) {
        log.info("리뷰 추천 시작 - reviewId: {}", reviewId);
        
        try {
            int result = reviewMapper.incrementLikeCount(reviewId);
            log.info("리뷰 추천 완료 - reviewId: {}", reviewId);
            
            return result;
        } catch (Exception e) {
            log.error("리뷰 추천 중 오류 발생 - reviewId: {}", reviewId, e);
            throw new RuntimeException("리뷰 추천 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 리뷰 비추천
     */
    @Transactional
    public int dislikeReview(Long reviewId) {
        log.info("리뷰 비추천 시작 - reviewId: {}", reviewId);
        
        try {
            int result = reviewMapper.incrementDislikeCount(reviewId);
            log.info("리뷰 비추천 완료 - reviewId: {}", reviewId);
            
            return result;
        } catch (Exception e) {
            log.error("리뷰 비추천 중 오류 발생 - reviewId: {}", reviewId, e);
            throw new RuntimeException("리뷰 비추천 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 회원별 리뷰 목록 조회
     */
    public List<ReviewDTO> getReviewsByMemberId(Long memberId) {
        log.info("회원별 리뷰 조회 시작 - memberId: {}", memberId);
        
        try {
            List<ReviewDTO> reviews = reviewMapper.findReviewsByMemberId(memberId);
            log.info("회원별 리뷰 조회 완료 - memberId: {}, 조회된 건수: {}", memberId, reviews.size());
            
            return reviews;
        } catch (Exception e) {
            log.error("회원별 리뷰 조회 중 오류 발생 - memberId: {}", memberId, e);
            throw new RuntimeException("회원별 리뷰를 불러오는 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 리뷰 데이터 유효성 검증
     */
    private void validateReviewData(ReviewDTO reviewDTO) {
        if (reviewDTO.getFacilityId() == null) {
            throw new IllegalArgumentException("시설 ID는 필수입니다.");
        }
        if (reviewDTO.getMemberId() == null) {
            throw new IllegalArgumentException("회원 ID는 필수입니다.");
        }
        if (reviewDTO.getTitle() == null || reviewDTO.getTitle().trim().isEmpty()) {
            throw new IllegalArgumentException("리뷰 제목은 필수입니다.");
        }
        if (reviewDTO.getContent() == null || reviewDTO.getContent().trim().isEmpty()) {
            throw new IllegalArgumentException("리뷰 내용은 필수입니다.");
        }
        if (reviewDTO.getRating() == null || reviewDTO.getRating() < 1 || reviewDTO.getRating() > 5) {
            throw new IllegalArgumentException("평점은 1~5 사이의 값이어야 합니다.");
        }
    }

    /**
     * 전체 리뷰 수 조회 (통계용)
     */
    @Transactional(readOnly = true)
    public int getReviewCount() {
        try {
            return reviewMapper.getReviewCount();
        } catch (Exception e) {
            log.error("리뷰 수 조회 중 오류 발생", e);
            return 0; // 오류 시 0 반환
        }
    }

    /**
     * 리뷰 수정
     */
    @Transactional
    public int updateReview(ReviewDTO reviewDTO) {
        log.info("리뷰 수정 시작 - reviewId: {}, title: {}", reviewDTO.getReviewId(), reviewDTO.getTitle());
        
        try {
            // 기존 리뷰 존재 확인
            ReviewDTO existingReview = reviewMapper.findReviewById(reviewDTO.getReviewId());
            if (existingReview == null) {
                throw new RuntimeException("수정할 리뷰를 찾을 수 없습니다. ID: " + reviewDTO.getReviewId());
            }
            
            // 필수 값 검증
            validateReviewData(reviewDTO);
            
            // status 기본값 설정 (수정 시에도 기존 상태 유지 또는 기본값 설정)
            if (reviewDTO.getStatus() == null || reviewDTO.getStatus().isEmpty()) {
                reviewDTO.setStatus("ACTIVE");
            }
            
            int result = reviewMapper.updateReview(reviewDTO);
            log.info("리뷰 수정 완료 - reviewId: {}", reviewDTO.getReviewId());
            
            return result;
        } catch (Exception e) {
            log.error("리뷰 수정 중 오류 발생 - reviewId: {}", reviewDTO.getReviewId(), e);
            throw new RuntimeException("리뷰 수정 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 조회수 증가
     */
    @Transactional
    public int incrementViewCount(Long id) {
        log.info("조회수 증가 시작 - reviewId: {}", id);
        
        try {
            int result = reviewMapper.incrementViewCount(id);
            log.info("조회수 증가 완료 - reviewId: {}", id);
            
            return result;
        } catch (Exception e) {
            log.error("조회수 증가 중 오류 발생 - reviewId: {}", id, e);
            // 조회수 증가 실패는 전체 프로세스에 영향을 주지 않도록 예외를 던지지 않음
            return 0;
        }
    }
}
````

## File: src/main/resources/templates/board/detail.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title th:text="${board.title + ' - CareLink'}">게시글 상세 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>


    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <div class="container py-4">
            <!-- 브레드크럼 -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">홈</a></li>
                    <li class="breadcrumb-item"><a href="/board">정보마당</a></li>
                    <li class="breadcrumb-item">
                        <a th:href="@{/board(type=${type})}" th:text="${board.category}">게시판</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">게시글 상세</li>
                </ol>
            </nav>

            <!-- 게시글 상세 -->
            <div class="card">
                <!-- 게시글 헤더 -->
                <div class="card-header bg-light">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="d-flex align-items-center mb-2">
                                <span th:if="${board.category == 'NOTICE'}" class="badge bg-danger me-2">공지</span>
                                <span th:if="${board.category == 'INFO'}" class="badge bg-primary me-2">정보</span>
                                <span th:if="${board.category == 'QNA'}" class="badge bg-success me-2">Q&A</span>
                                <span th:if="${board.category == 'FAQ'}" class="badge bg-warning me-2">FAQ</span>
                                <span th:if="${board.isPinned}" class="badge bg-info me-2">고정</span>
                                <h4 class="mb-0" th:text="${board.title}">게시글 제목</h4>
                            </div>
                            <div class="text-muted small">
                                <i class="fas fa-user me-1"></i>
                                <span th:text="${board.memberName}">작성자</span>
                                <span class="mx-2">|</span>
                                <i class="fas fa-calendar me-1"></i>
                                <span th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd HH:mm')}">작성일</span>
                                <span class="mx-2">|</span>
                                <i class="fas fa-eye me-1"></i>
                                조회 <span th:text="${board.viewCount}">0</span>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-outline-success btn-sm" onclick="likeBoard()">
                                    <i class="fas fa-thumbs-up me-1"></i>
                                    추천 <span id="likeCount" th:text="${board.likeCount}">0</span>
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="shareBoard()">
                                    <i class="fas fa-share me-1"></i>
                                    공유
                                </button>
                                <button type="button" class="btn btn-outline-danger btn-sm" onclick="reportBoard()">
                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                    신고
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 게시글 내용 -->
                <div class="card-body">
                    <div class="content-area" style="min-height: 300px; line-height: 1.8;">
                        <div th:utext="${#strings.replace(#strings.replace(board.content, '\n', '&lt;br&gt;'), '\r\n', '&lt;br&gt;')}">
                            게시글 내용이 여기에 표시됩니다.
                        </div>
                    </div>
                    
                    <!-- 태그 -->
                    <div th:if="${not #strings.isEmpty(board.tags)}" class="mt-4 pt-3 border-top">
                        <small class="text-muted">태그: </small>
                        <span th:each="tag : ${#strings.arraySplit(board.tags, ',')}" class="badge bg-light text-dark me-1" th:text="${tag}">태그</span>
                    </div>
                </div>

                <!-- 게시글 푸터 -->
                <div class="card-footer bg-light">
                    <div class="row">
                        <div class="col-md-6">
                            <small class="text-muted">
                                <i class="fas fa-clock me-1"></i>
                                최종 수정: <span th:text="${#temporals.format(board.updatedAt, 'yyyy-MM-dd HH:mm')}">수정일</span>
                            </small>
                        </div>
                        <div class="col-md-6 text-end">
                            <!-- 수정/삭제 버튼 - 권한별 표시 -->
                            <!-- 공지사항과 FAQ는 관리자만 수정/삭제 가능 -->
                            <div th:if="${session.loginMember != null and (board.category == 'NOTICE' or board.category == 'FAQ') and session.loginMember.role == 'ADMIN'}" 
                                 class="btn-group" role="group">
                                <a th:href="@{/board/edit/{id}(id=${board.boardId}, type=${type})}" 
                                   class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-edit me-1"></i>수정
                                </a>
                                <button type="button" class="btn btn-outline-danger btn-sm" 
                                        onclick="deleteBoard(event)" 
                                        th:data-board-id="${board.boardId}"
                                        th:data-type="${type}">
                                    <i class="fas fa-trash me-1"></i>삭제
                                </button>
                                <span class="badge bg-warning text-dark ms-2">관리자</span>
                            </div>
                            
                            <!-- 일반 게시글(INFO, QNA)은 작성자 또는 관리자만 수정/삭제 가능 -->
                            <div th:if="${session.loginMember != null and (board.category == 'INFO' or board.category == 'QNA') and (session.loginMember.memberId == board.memberId or session.loginMember.role == 'ADMIN')}" 
                                 class="btn-group" role="group">
                                <a th:href="@{/board/edit/{id}(id=${board.boardId}, type=${type})}" 
                                   class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-edit me-1"></i>수정
                                </a>
                                <button type="button" class="btn btn-outline-danger btn-sm" 
                                        onclick="deleteBoard(event)" 
                                        th:data-board-id="${board.boardId}"
                                        th:data-type="${type}">
                                    <i class="fas fa-trash me-1"></i>삭제
                                </button>
                                <!-- 관리자인 경우 표시 -->
                                <span th:if="${session.loginMember.role == 'ADMIN' and session.loginMember.memberId != board.memberId}" 
                                      class="badge bg-warning text-dark ms-2">관리자</span>
                            </div>
                            
                            <!-- 권한이 없는 경우 안내 메시지 -->
                            <div th:if="${session.loginMember == null}">
                                <small class="text-muted">
                                    <i class="fas fa-info-circle me-1"></i>로그인 후 수정/삭제가 가능합니다.
                                </small>
                            </div>
                            <div th:if="${session.loginMember != null and (board.category == 'NOTICE' or board.category == 'FAQ') and session.loginMember.role != 'ADMIN'}">
                                <small class="text-muted">
                                    <i class="fas fa-lock me-1"></i>관리자만 수정/삭제가 가능합니다.
                                </small>
                            </div>
                            <div th:if="${session.loginMember != null and (board.category == 'INFO' or board.category == 'QNA') and session.loginMember.memberId != board.memberId and session.loginMember.role != 'ADMIN'}">
                                <small class="text-muted">
                                    <i class="fas fa-user-lock me-1"></i>작성자 또는 관리자만 수정/삭제가 가능합니다.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 이전글/다음글 -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body py-2">
                            <div class="row">
                                <!-- 이전글 -->
                                <div class="col-md-6">
                                    <div th:if="${prevBoard != null}">
                                        <small class="text-muted">
                                            <i class="fas fa-chevron-up me-1"></i>이전글
                                        </small>
                                        <a th:href="@{/board/detail/{id}(id=${prevBoard.boardId}, type=${type}, page=${page})}" 
                                           class="d-block text-decoration-none text-truncate" 
                                           th:text="${prevBoard.title}">이전 게시글 제목</a>
                                    </div>
                                    <div th:unless="${prevBoard != null}">
                                        <small class="text-muted">
                                            <i class="fas fa-chevron-up me-1"></i>이전글이 없습니다.
                                        </small>
                                    </div>
                                </div>
                                <!-- 다음글 -->
                                <div class="col-md-6 text-end">
                                    <div th:if="${nextBoard != null}">
                                        <small class="text-muted">
                                            다음글<i class="fas fa-chevron-down ms-1"></i>
                                        </small>
                                        <a th:href="@{/board/detail/{id}(id=${nextBoard.boardId}, type=${type}, page=${page})}" 
                                           class="d-block text-decoration-none text-truncate" 
                                           th:text="${nextBoard.title}">다음 게시글 제목</a>
                                    </div>
                                    <div th:unless="${nextBoard != null}">
                                        <small class="text-muted">
                                            다음글이 없습니다.<i class="fas fa-chevron-down ms-1"></i>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 하단 버튼 -->
            <div class="row mt-4">
                <div class="col-12 text-center">
                    <div class="btn-group" role="group">
                        <a th:href="@{/board(type=${type}, page=${page})}" class="btn btn-secondary">
                            <i class="fas fa-list me-1"></i>목록으로
                        </a>
                        <!-- 로그인한 사용자만 글쓰기 버튼 표시 -->
                        <a th:if="${session.memberId != null}" 
                           th:href="@{/board/write(type=${type})}" 
                           class="btn btn-primary">
                            <i class="fas fa-plus me-1"></i>글쓰기
                        </a>
                        <!-- 비로그인 사용자에게는 로그인 안내 -->
                        <a th:unless="${session.memberId != null}" 
                           href="/member/login" 
                           class="btn btn-outline-secondary">
                            <i class="fas fa-sign-in-alt me-1"></i>로그인 후 글쓰기
                        </a>
                        <button type="button" class="btn btn-info" onclick="window.scrollTo(0, 0)">
                            <i class="fas fa-arrow-up me-1"></i>맨 위로
                        </button>
                    </div>
                </div>
            </div>

            <!-- 댓글 영역 (향후 구현) -->
            <div class="card mt-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0">
                        <i class="fas fa-comments me-2"></i>댓글 
                        <span class="badge bg-secondary" th:text="${board.commentCount}">0</span>
                    </h6>
                </div>
                <div class="card-body">
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-comment-slash fa-2x mb-2"></i><br>
                        댓글 기능은 추후 구현 예정입니다.
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 푸터 -->
    <footer th:replace="~{layout/footer :: footer}"></footer>
    
    <!-- JavaScript -->
    <div th:replace="~{layout/footer :: scripts}"></div>

    <!-- 게시글 상세 페이지 전용 스크립트 -->
    <script src="/js/board-detail.js"></script>
</body>
</html>
````

## File: src/main/resources/templates/job/list.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>구인구직 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>

    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <div class="container mt-4">
            <!-- 브레드크럼 -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">홈</a></li>
                    <li class="breadcrumb-item active" aria-current="page">구인구직</li>
                </ol>
            </nav>
            
            <!-- 페이지 타이틀 -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <h2><i class="fas fa-briefcase text-success me-2"></i> 구인구직</h2>
                    <p class="text-muted">요양원, 요양병원 등 다양한 일자리 정보를 확인하세요.</p>
                </div>
                <div class="col-md-4 text-end">
                    <!-- 시설회원(FACILITY) 또는 관리자(ADMIN)만 구인등록 가능 -->
                    <a th:if="${session.loginMember != null and (session.loginMember.role == 'FACILITY' or session.loginMember.role == 'ADMIN')}" 
                       href="/job/write" class="btn btn-success me-2">
                        <i class="fas fa-plus me-1"></i>구인등록
                    </a>
                    
                    <!-- 일반사용자(USER)는 구직등록만 가능 -->
                    <a th:if="${session.loginMember != null and session.loginMember.role == 'USER'}" 
                       href="/job/write" class="btn btn-info">
                        <i class="fas fa-plus me-1"></i>구직등록
                    </a>
                    
                    <!-- 비로그인 사용자에게는 로그인 안내 -->
                    <div th:if="${session.loginMember == null}" class="btn-group">
                        <a href="/member/login" class="btn btn-outline-success">
                            <i class="fas fa-sign-in-alt me-1"></i>로그인 후 구인등록
                        </a>
                        <a href="/member/login" class="btn btn-outline-info">
                            <i class="fas fa-sign-in-alt me-1"></i>로그인 후 구직등록
                        </a>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- 필터 및 검색 영역 -->
                <div class="col-md-3">
                    <div class="card mb-4">
                        <div class="card-header bg-success text-white">
                            <h6 class="mb-0"><i class="fas fa-filter me-1"></i> 검색 필터</h6>
                        </div>
                        <div class="card-body">
                            <form id="searchForm" method="get" th:action="@{/job}">
                                <!-- 키워드 검색 -->
                                <div class="mb-3">
                                    <label for="keyword" class="form-label fw-bold">키워드 검색</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="keyword" 
                                               name="keyword" th:value="${keyword}"
                                               placeholder="직무, 회사명, 지역 등">
                                        <button type="submit" class="btn btn-outline-secondary">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- 구인/구직 구분 -->
                                <div class="mb-3">
                                    <label class="form-label fw-bold">구인/구직 구분</label>
                                    <div class="btn-group w-100" role="group">
                                        <input type="radio" class="btn-check" name="type" id="type_all" value="" th:checked="${type == null or type == ''}">
                                        <label class="btn btn-outline-primary" for="type_all">전체</label>
                                        
                                        <input type="radio" class="btn-check" name="type" id="type_recruit" value="recruit" th:checked="${type == 'recruit'}">
                                        <label class="btn btn-outline-primary" for="type_recruit">구인</label>
                                        
                                        <input type="radio" class="btn-check" name="type" id="type_search" value="search" th:checked="${type == 'search'}">
                                        <label class="btn btn-outline-primary" for="type_search">구직</label>
                                    </div>
                                </div>

                                <!-- 직종 선택 -->
                                <div class="mb-3">
                                    <label for="position" class="form-label fw-bold">직종</label>
                                    <select class="form-select" id="position" name="position">
                                        <option value="">전체</option>
                                        <option value="간병인" th:selected="${position == '간병인'}">간병인</option>
                                        <option value="요양보호사" th:selected="${position == '요양보호사'}">요양보호사</option>
                                        <option value="사회복지사" th:selected="${position == '사회복지사'}">사회복지사</option>
                                        <option value="물리치료사" th:selected="${position == '물리치료사'}">물리치료사</option>
                                        <option value="사무직" th:selected="${position == '사무직'}">사무직</option>
                                        <option value="조리원" th:selected="${position == '조리원'}">조리원</option>
                                        <option value="운전원" th:selected="${position == '운전원'}">운전원</option>
                                        <option value="간호사" th:selected="${position == '간호사'}">간호사</option>
                                        <option value="영양사" th:selected="${position == '영양사'}">영양사</option>
                                        <option value="기타" th:selected="${position == '기타'}">기타</option>
                                    </select>
                                </div>

                                <!-- 지역 선택 -->
                                <div class="mb-3">
                                    <label for="region" class="form-label fw-bold">근무지역</label>
                                    <select class="form-select" id="region" name="region">
                                        <option value="">전국</option>
                                        <option value="서울" th:selected="${region == '서울'}">서울특별시</option>
                                        <option value="부산" th:selected="${region == '부산'}">부산광역시</option>
                                        <option value="대구" th:selected="${region == '대구'}">대구광역시</option>
                                        <option value="인천" th:selected="${region == '인천'}">인천광역시</option>
                                        <option value="광주" th:selected="${region == '광주'}">광주광역시</option>
                                        <option value="대전" th:selected="${region == '대전'}">대전광역시</option>
                                        <option value="울산" th:selected="${region == '울산'}">울산광역시</option>
                                        <option value="세종" th:selected="${region == '세종'}">세종특별자치시</option>
                                        <option value="경기" th:selected="${region == '경기'}">경기도</option>
                                        <option value="강원" th:selected="${region == '강원'}">강원도</option>
                                        <option value="충북" th:selected="${region == '충북'}">충청북도</option>
                                        <option value="충남" th:selected="${region == '충남'}">충청남도</option>
                                        <option value="전북" th:selected="${region == '전북'}">전라북도</option>
                                        <option value="전남" th:selected="${region == '전남'}">전라남도</option>
                                        <option value="경북" th:selected="${region == '경북'}">경상북도</option>
                                        <option value="경남" th:selected="${region == '경남'}">경상남도</option>
                                        <option value="제주" th:selected="${region == '제주'}">제주특별자치도</option>
                                    </select>
                                </div>

                                <!-- 고용형태 -->
                                <div class="mb-3">
                                    <label for="workType" class="form-label fw-bold">고용형태</label>
                                    <select class="form-select" id="workType" name="workType">
                                        <option value="">전체</option>
                                        <option value="FULL_TIME" th:selected="${workType == 'FULL_TIME'}">정규직</option>
                                        <option value="PART_TIME" th:selected="${workType == 'PART_TIME'}">파트타임</option>
                                        <option value="TEMPORARY" th:selected="${workType == 'TEMPORARY'}">임시직</option>
                                    </select>
                                </div>

                                <!-- 경력 -->
                                <div class="mb-3">
                                    <label for="experience" class="form-label fw-bold">경력</label>
                                    <select class="form-select" id="experience" name="experience">
                                        <option value="">무관</option>
                                        <option value="신입" th:selected="${experience == '신입'}">신입</option>
                                        <option value="1년 이상" th:selected="${experience == '1년 이상'}">1년 이상</option>
                                        <option value="3년 이상" th:selected="${experience == '3년 이상'}">3년 이상</option>
                                        <option value="5년 이상" th:selected="${experience == '5년 이상'}">5년 이상</option>
                                        <option value="10년 이상" th:selected="${experience == '10년 이상'}">10년 이상</option>
                                    </select>
                                </div>

                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-success">
                                        <i class="fas fa-search me-1"></i>검색
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary" onclick="resetFilters()">
                                        <i class="fas fa-undo me-1"></i>초기화
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- 인기 검색어 -->
                    <div class="card">
                        <div class="card-header bg-warning text-dark">
                            <h6 class="mb-0"><i class="fas fa-fire me-1"></i> 인기 검색어</h6>
                        </div>
                        <div class="card-body">
                            <div class="d-flex flex-wrap gap-1">
                                <span class="badge bg-light text-dark">간병인</span>
                                <span class="badge bg-light text-dark">요양보호사</span>
                                <span class="badge bg-light text-dark">사회복지사</span>
                                <span class="badge bg-light text-dark">서울</span>
                                <span class="badge bg-light text-dark">정규직</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 구인구직 목록 -->
                <div class="col-md-9">
                    <!-- 결과 요약 및 정렬 -->
                    <div class="row align-items-center mb-4">
                        <div class="col-md-6">
                            <div class="d-flex align-items-center gap-3">
                                <h5 class="mb-0">
                                    <i class="fas fa-list me-2 text-success"></i>채용정보
                                </h5>
                                <span class="badge bg-success fs-6" th:text="${jobList != null ? #lists.size(jobList) : 0} + '건'">
                                    0건
                                </span>
                            </div>
                            <small class="text-muted">
                                전체 <strong th:text="${totalCount ?: 0}">0</strong>건 중 
                                <strong th:text="${jobList != null ? #lists.size(jobList) : 0}">0</strong>건 표시
                            </small>
                        </div>
                        <div class="col-md-6">
                            <div class="row">
                                <div class="col-auto">
                                    <label for="sortOrder" class="form-label small mb-0">정렬기준</label>
                                    <select class="form-select form-select-sm" id="sortOrder" name="sortOrder" onchange="changeSortOrder(this.value)">
                                        <option value="latest" th:selected="${sortOrder == 'latest' or sortOrder == null}">최신순</option>
                                        <option value="viewCount" th:selected="${sortOrder == 'viewCount'}">조회순</option>
                                        <option value="salary" th:selected="${sortOrder == 'salary'}">급여순</option>
                                        <option value="deadline" th:selected="${sortOrder == 'deadline'}">마감임박순</option>
                                    </select>
                                </div>
                                <div class="col-auto">
                                    <label for="viewType" class="form-label small mb-0">보기방식</label>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <input type="radio" class="btn-check" name="viewType" id="listView" value="list" checked>
                                        <label class="btn btn-outline-secondary" for="listView">
                                            <i class="fas fa-list"></i>
                                        </label>
                                        <input type="radio" class="btn-check" name="viewType" id="cardView" value="card">
                                        <label class="btn btn-outline-secondary" for="cardView">
                                            <i class="fas fa-th"></i>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 구인구직 카드 목록 -->
                    <div id="jobList">
                        <!-- 실제 구인구직 목록 -->
                        <div th:if="${not #lists.isEmpty(jobList)}">
                            <div class="card mb-3" th:each="job : ${jobList}">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <h5 class="card-title mb-0" th:text="${job.title}">구인 제목</h5>
                                                <div class="d-flex gap-1">
                                                    <span class="badge bg-primary" th:if="${job.jobType == 'RECRUIT'}">구인</span>
                                                    <span class="badge bg-success" th:if="${job.jobType == 'SEARCH'}">구직</span>
                                                    <span class="badge bg-secondary" th:if="${job.workType == 'FULL_TIME'}">정규직</span>
                                                    <span class="badge bg-info" th:if="${job.workType == 'PART_TIME'}">파트타임</span>
                                                    <span class="badge bg-warning" th:if="${job.workType == 'TEMPORARY'}">임시직</span>
                                                    <span class="badge bg-danger" th:if="${job.priority > 0}">긴급</span>
                                                </div>
                                            </div>
                                            <h6 class="text-primary mb-2" th:text="${job.facilityName ?: '개인 사업자'}">회사명</h6>
                                            <div class="job-info mb-2">
                                                <span class="text-muted me-3" th:if="${job.workLocation}">
                                                    <i class="fas fa-map-marker-alt me-1"></i><span th:text="${job.workLocation}">지역</span>
                                                </span>
                                                <span class="text-muted me-3" th:if="${job.workHours}">
                                                    <i class="fas fa-clock me-1"></i><span th:text="${job.workHours}">근무시간</span>
                                                </span>
                                                <span class="text-muted me-3" th:if="${job.salaryDescription}">
                                                    <i class="fas fa-won-sign me-1"></i><span th:text="${job.salaryDescription}">급여</span>
                                                </span>
                                                <span class="text-muted" th:if="${job.experience}">
                                                    <i class="fas fa-user-graduate me-1"></i><span th:text="${job.experience}">경력</span>
                                                </span>
                                            </div>
                                            <p class="card-text mb-2 rich-text-content" th:utext="${#strings.abbreviate(job.content, 120)}">구인 내용...</p>
                                            <div class="d-flex flex-wrap gap-1">
                                                <span class="badge bg-light text-dark" th:if="${job.position}" th:text="${job.position}">직종</span>
                                                <span class="badge bg-light text-dark" th:if="${job.education}" th:text="${job.education}">학력</span>
                                            </div>
                                        </div>
                                        <div class="col-md-4 text-end">
                                            <div class="job-meta mb-3">
                                                <small class="text-muted d-block">
                                                    <i class="fas fa-eye me-1"></i>조회 <span th:text="${job.viewCount ?: 0}">0</span>회
                                                </small>
                                                <small class="text-muted d-block">
                                                    <i class="fas fa-calendar me-1"></i><span th:text="${#temporals.format(job.createdAt, 'yyyy-MM-dd')}">날짜</span>
                                                </small>
                                                <small class="text-muted d-block" th:if="${job.endDate}">
                                                    <i class="fas fa-clock me-1"></i>마감: <span th:text="${#temporals.format(job.endDate, 'MM-dd')}">마감일</span>
                                                </small>
                                            </div>
                                            <div class="d-grid gap-2">
                                                <a th:href="@{/job/detail/{id}(id=${job.jobId})}" class="btn btn-outline-success btn-sm">
                                                    <i class="fas fa-eye me-1"></i>상세보기
                                                </a>
                                                <button class="btn btn-success btn-sm" th:if="${job.jobType == 'RECRUIT'}">
                                                    <i class="fas fa-paper-plane me-1"></i>지원하기
                                                </button>
                                                <button class="btn btn-primary btn-sm" th:if="${job.jobType == 'SEARCH'}">
                                                    <i class="fas fa-phone me-1"></i>연락하기
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 구인구직이 없는 경우 -->
                        <div th:if="${#lists.isEmpty(jobList)}" class="text-center text-muted py-5">
                            <i class="fas fa-briefcase fa-3x mb-3"></i>
                            <h5>등록된 채용정보가 없습니다</h5>
                            <p>첫 번째 채용정보를 등록해보세요!</p>
                            
                            <div class="btn-group mt-3" role="group">
                                <!-- 시설회원(FACILITY) 또는 관리자(ADMIN)만 구인등록 가능 -->
                                <a th:if="${session.loginMember != null and (session.loginMember.role == 'FACILITY' or session.loginMember.role == 'ADMIN')}" 
                                   href="/job/write" class="btn btn-success">
                                    <i class="fas fa-plus me-1"></i>구인등록하기
                                </a>
                                
                                <!-- 일반사용자(USER)는 구직등록만 가능 -->
                                <a th:if="${session.loginMember != null and session.loginMember.role == 'USER'}" 
                                   href="/job/write" class="btn btn-info">
                                    <i class="fas fa-plus me-1"></i>구직등록하기
                                </a>
                            </div>
                            
                            <!-- 비로그인 사용자 -->
                            <div th:if="${session.loginMember == null}" class="mt-3">
                                <div class="btn-group" role="group">
                                    <a href="/member/login" class="btn btn-outline-success">
                                        <i class="fas fa-sign-in-alt me-1"></i>로그인 후 구인등록
                                    </a>
                                    <a href="/member/login" class="btn btn-outline-info">
                                        <i class="fas fa-sign-in-alt me-1"></i>로그인 후 구직등록
                                    </a>
                                </div>
                                <div class="alert alert-light mt-3">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>채용 시스템 안내:</strong><br>
                                    • <span class="text-success">시설회원</span>: 구인공고 등록 및 구직자 채용<br>
                                    • <span class="text-info">일반사용자</span>: 구직공고 등록 및 구인공고 지원
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--
                    &lt;!&ndash; 페이징 &ndash;&gt;
                    <nav th:if="${not #lists.isEmpty(jobList)}" aria-label="구인구직 페이징">
                        <ul class="pagination justify-content-center">
                            &lt;!&ndash; 이전 페이지 &ndash;&gt;
                            <li class="page-item" th:classappend="${not pageInfo.hasPrevious} ? 'disabled'">
                                <a class="page-link" 
                                   th:href="@{/job(page=${pageInfo.currentPage - 1}, keyword=${keyword}, jobType=${jobType}, region=${region}, employmentType=${employmentType})}"
                                   aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            &lt;!&ndash; 페이지 번호 &ndash;&gt;
                            <li class="page-item" 
                                th:each="page : ${#numbers.sequence(pageInfo.startPage, pageInfo.endPage)}"
                                th:classappend="${page == pageInfo.currentPage} ? 'active'">
                                <a class="page-link" 
                                   th:href="@{/job(page=${page}, keyword=${keyword}, jobType=${jobType}, region=${region}, employmentType=${employmentType})}"
                                   th:text="${page}">1</a>
                            </li>
                            &lt;!&ndash; 다음 페이지 &ndash;&gt;
                            <li class="page-item" th:classappend="${not pageInfo.hasNext} ? 'disabled'">
                                <a class="page-link" 
                                   th:href="@{/job(page=${pageInfo.currentPage + 1}, keyword=${keyword}, jobType=${jobType}, region=${region}, employmentType=${employmentType})}"
                                   aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                    -->

                </div>
            </div>
        </div>
    </main>

    <!-- 푸터 -->
    <footer th:replace="~{layout/footer :: footer}"></footer>
    
    <!-- JavaScript -->
    <div th:replace="~{layout/footer :: scripts}"></div>
</body>
    <script>
        // 검색 필터 초기화
        function resetFilters() {
            document.getElementById('keyword').value = '';
            document.querySelectorAll('input[name="type"]')[0].checked = true;
            document.getElementById('position').value = '';
            document.getElementById('region').value = '';
            document.getElementById('workType').value = '';
            document.getElementById('experience').value = '';
            document.getElementById('searchForm').submit();
        }
        
        // 정렬 순서 변경
        function changeSortOrder(value) {
            const url = new URL(window.location);
            url.searchParams.set('sortOrder', value);
            window.location.href = url.toString();
        }
        
        // 인기 검색어 클릭
        document.addEventListener('DOMContentLoaded', function() {
            const popularKeywords = document.querySelectorAll('.badge.bg-light');
            popularKeywords.forEach(function(keyword) {
                keyword.style.cursor = 'pointer';
                keyword.addEventListener('click', function() {
                    document.getElementById('keyword').value = this.textContent;
                    document.getElementById('searchForm').submit();
                });
            });
            
            // 엔터키로 검색
            document.getElementById('keyword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('searchForm').submit();
                }
            });
        });
    </script>\n    \n    <style>\n        /* 구인구직 카드 스타일 */\n        .job-info {\n            font-size: 0.9rem;\n        }\n        \n        .job-meta {\n            font-size: 0.8rem;\n        }\n        \n        .badge.bg-light {\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n        \n        .badge.bg-light:hover {\n            background-color: #e9ecef !important;\n            transform: translateY(-1px);\n        }\n        \n        .card:hover {\n            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;\n            transform: translateY(-2px);\n            transition: all 0.3s;\n        }\n        \n        .btn-group .btn-check:checked + .btn {\n            background-color: var(--bs-primary);\n            border-color: var(--bs-primary);\n            color: white;\n        }\n    </style>\n</html>
````

## File: src/main/resources/templates/review/detail.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title th:text="${review.title + ' - CareLink'}">리뷰 상세 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>

    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <div class="container py-4">
            <!-- 브레드크럼 -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">홈</a></li>
                    <li class="breadcrumb-item"><a href="/review">리뷰</a></li>
                    <li class="breadcrumb-item active" aria-current="page">리뷰 상세</li>
                </ol>
            </nav>

            <!-- 리뷰 ID (hidden) -->
            <input type="hidden" id="reviewId" th:value="${review.reviewId}">

            <div class="row">
                <!-- 리뷰 상세 내용 -->
                <div class="col-lg-8">
                    <div class="card">
                        <!-- 리뷰 헤더 -->
                        <div class="card-header bg-light">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h4 class="mb-2" th:text="${review.title}">리뷰 제목</h4>
                                    <div class="d-flex align-items-center mb-2">
                                        <!-- 평점 표시 -->
                                        <div class="rating-stars me-3">
                                            <span th:each="i : ${#numbers.sequence(1, 5)}" 
                                                  th:class="${i <= review.rating} ? 'fas fa-star text-warning' : 'far fa-star text-muted'"></span>
                                            <span class="ms-2 fw-bold" th:text="${review.rating} + '.0'">5.0</span>
                                        </div>
                                        <!-- 시설명 -->
                                        <a th:href="@{/facility/detail/{id}(id=${review.facilityId})}" class="badge bg-primary text-decoration-none">
                                            <i class="fas fa-building me-1"></i>
                                            <span th:text="${review.facilityName}">시설명</span>
                                        </a>
                                    </div>
                                    <div class="text-muted small">
                                        <i class="fas fa-user me-1"></i>
                                        <span th:text="${review.memberName}">작성자</span>
                                        <span class="mx-2">|</span>
                                        <i class="fas fa-calendar me-1"></i>
                                        <span th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd HH:mm')}">작성일</span>
                                        <span class="mx-2">|</span>
                                        <i class="fas fa-eye me-1"></i>
                                        조회 <span th:text="${review.viewCount}">0</span>
                                    </div>
                                </div>
                                <div class="col-md-4 text-end">
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-outline-success btn-sm" data-action="likeReview">
                                            <i class="fas fa-thumbs-up me-1"></i>
                                            추천 <span id="likeCount" th:text="${review.likeCount}">0</span>
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm" data-action="shareReview">
                                            <i class="fas fa-share me-1"></i>
                                            공유
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 리뷰 내용 -->
                        <div class="card-body">
                            <!-- 세부 평점 -->
                            <div class="row mb-4" th:if="${review.serviceRating != null}">
                                <div class="col-12">
                                    <h6 class="mb-3">세부 평점</h6>
                                    <div class="row">
                                        <div class="col-md-3 col-6 mb-2">
                                            <small class="text-muted">서비스</small>
                                            <div class="rating-detail">
                                                <span th:each="i : ${#numbers.sequence(1, 5)}" 
                                                      th:class="${i <= (review.serviceRating != null ? review.serviceRating : 0)} ? 'fas fa-star text-warning' : 'far fa-star text-muted'"></span>
                                                <span class="ms-1" th:text="${review.serviceRating != null ? review.serviceRating : 0}">0</span>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-6 mb-2">
                                            <small class="text-muted">시설</small>
                                            <div class="rating-detail">
                                                <span th:each="i : ${#numbers.sequence(1, 5)}" 
                                                      th:class="${i <= (review.facilityRating != null ? review.facilityRating : 0)} ? 'fas fa-star text-warning' : 'far fa-star text-muted'"></span>
                                                <span class="ms-1" th:text="${review.facilityRating != null ? review.facilityRating : 0}">0</span>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-6 mb-2">
                                            <small class="text-muted">직원</small>
                                            <div class="rating-detail">
                                                <span th:each="i : ${#numbers.sequence(1, 5)}" 
                                                      th:class="${i <= (review.staffRating != null ? review.staffRating : 0)} ? 'fas fa-star text-warning' : 'far fa-star text-muted'"></span>
                                                <span class="ms-1" th:text="${review.staffRating != null ? review.staffRating : 0}">0</span>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-6 mb-2">
                                            <small class="text-muted">가격</small>
                                            <div class="rating-detail">
                                                <span th:each="i : ${#numbers.sequence(1, 5)}" 
                                                      th:class="${i <= (review.priceRating != null ? review.priceRating : 0)} ? 'fas fa-star text-warning' : 'far fa-star text-muted'"></span>
                                                <span class="ms-1" th:text="${review.priceRating != null ? review.priceRating : 0}">0</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 리뷰 내용 -->
                            <div class="content-area" style="min-height: 200px; line-height: 1.8;">
                                <div class="rich-text-content" th:utext="${review.content}" style="white-space: pre-line;">
                                    리뷰 내용이 여기에 표시됩니다.
                                </div>
                            </div>

                            <!-- 리뷰 이미지 -->
                            <div th:if="${not #strings.isEmpty(review.reviewImage1)}" class="mt-4">
                                <h6>첨부 이미지</h6>
                                <div class="row">
                                    <div th:if="${not #strings.isEmpty(review.reviewImage1)}" class="col-md-4 mb-2">
                                        <img th:src="${review.reviewImage1}" class="img-fluid rounded review-image" alt="리뷰 이미지 1">
                                    </div>
                                    <div th:if="${not #strings.isEmpty(review.reviewImage2)}" class="col-md-4 mb-2">
                                        <img th:src="${review.reviewImage2}" class="img-fluid rounded review-image" alt="리뷰 이미지 2">
                                    </div>
                                    <div th:if="${not #strings.isEmpty(review.reviewImage3)}" class="col-md-4 mb-2">
                                        <img th:src="${review.reviewImage3}" class="img-fluid rounded review-image" alt="리뷰 이미지 3">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 리뷰 푸터 -->
                        <div class="card-footer bg-light">
                            <div class="row">
                                <div class="col-md-6">
                                    <small class="text-muted">
                                        <i class="fas fa-clock me-1"></i>
                                        최종 수정: <span th:text="${#temporals.format(review.updatedAt, 'yyyy-MM-dd HH:mm')}">수정일</span>
                                    </small>
                                </div>
                                <div class="col-md-6 text-end">
                                    <!-- 작성자 또는 관리자만 수정/삭제 가능 -->
                                    <div class="btn-group" role="group" th:if="${session.loginMember != null and (session.loginMember.memberId == review.memberId or session.loginMember.role == 'ADMIN')}">
                                        <a th:href="@{/review/edit/{id}(id=${review.reviewId})}" class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-edit me-1"></i>수정
                                        </a>
                                        <button type="button" class="btn btn-outline-danger btn-sm" data-action="deleteReview">
                                            <i class="fas fa-trash me-1"></i>삭제
                                        </button>
                                        <!-- 관리자인 경우 표시 -->
                                        <span th:if="${session.loginMember.role == 'ADMIN' and session.loginMember.memberId != review.memberId}" 
                                              class="badge bg-warning text-dark ms-2">관리자</span>
                                    </div>
                                    <!-- 작성자도 아니고 관리자도 아닌 경우 신고 버튼만 표시 -->
                                    <button type="button" class="btn btn-outline-warning btn-sm" 
                                            th:if="${session.loginMember != null and session.loginMember.memberId != review.memberId and session.loginMember.role != 'ADMIN'}"
                                            data-action="reportReview">
                                        <i class="fas fa-exclamation-triangle me-1"></i>신고
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 하단 버튼 -->
                    <div class="text-center mt-4">
                        <div class="btn-group" role="group">
                            <a href="/review" class="btn btn-secondary">
                                <i class="fas fa-list me-1"></i>목록으로
                            </a>
                            <a href="/review/write" class="btn btn-primary">
                                <i class="fas fa-plus me-1"></i>리뷰 쓰기
                            </a>
                            <button type="button" class="btn btn-info" onclick="window.scrollTo(0, 0)">
                                <i class="fas fa-arrow-up me-1"></i>맨 위로
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 사이드바 -->
                <div class="col-lg-4">
                    <!-- 시설 정보 카드 -->
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-building me-2"></i>시설 정보
                            </h6>
                        </div>
                        <div class="card-body">
                            <h6>
                                <a th:href="@{/facility/detail/{id}(id=${review.facilityId})}" 
                                   class="text-decoration-none" 
                                   th:text="${review.facilityName}">시설명</a>
                            </h6>
                            <p class="text-muted mb-2">
                                <i class="fas fa-map-marker-alt me-1"></i>
                                시설 상세보기에서 주소 확인 가능
                            </p>
                            <div class="d-flex align-items-center mb-2">
                                <span class="me-2">평균 평점:</span>
                                <div class="rating-stars me-2">
                                    <span th:each="i : ${#numbers.sequence(1, 5)}" 
                                          th:class="${i <= (review.facilityAverageRating != null ? review.facilityAverageRating : 0)} ? 'fas fa-star text-warning' : 'far fa-star text-muted'"></span>
                                </div>
                                <span>
                                    <span th:text="${review.facilityAverageRating ?: 0}">0</span>
                                    (<span th:text="${review.facilityReviewCount ?: 0}">0</span>개)
                                </span>
                            </div>
                            <a th:href="@{/facility/detail/{id}(id=${review.facilityId})}" class="btn btn-outline-primary btn-sm w-100">
                                <i class="fas fa-info-circle me-1"></i>시설 상세보기
                            </a>
                        </div>
                    </div>

                    <!-- 다른 리뷰 카드 -->
                    <div class="card" th:if="${not #lists.isEmpty(otherReviews)}">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-comments me-2"></i>이 시설의 다른 리뷰
                            </h6>
                        </div>
                        <div class="list-group list-group-flush">
                            <a th:each="otherReview : ${otherReviews}"
                               th:href="@{/review/detail/{id}(id=${otherReview.reviewId})}"
                               class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1" th:text="${otherReview.title}">리뷰 제목</h6>
                                    <small class="text-muted">
                                        <span th:each="i : ${#numbers.sequence(1, 5)}" 
                                              th:class="${i <= otherReview.rating} ? 'fas fa-star text-warning' : 'far fa-star text-muted'"></span>
                                    </small>
                                </div>
                                <p class="mb-1 text-truncate rich-text-content" th:utext="${otherReview.content}">리뷰 내용</p>
                                <small class="text-muted">
                                    <span th:text="${otherReview.memberName}">작성자</span> |
                                    <span th:text="${#temporals.format(otherReview.createdAt, 'yyyy-MM-dd')}">작성일</span>
                                </small>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 이미지 모달 -->
    <div id="imageModal" class="modal">
        <span class="close-modal">&times;</span>
        <img id="modalImage" class="modal-content">
    </div>

    <!-- 푸터 -->
    <footer th:replace="~{layout/footer :: footer}"></footer>

    <!-- JavaScript -->
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery (review-detail.js에서 사용할 수도 있음) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- 공통 JS -->
    <script th:src="@{/js/common.js}"></script>
    <!-- 리뷰 상세 JS -->
    <script th:src="@{/js/review-detail.js}"></script>
</body>
</html>
````

## File: src/main/resources/templates/review/write.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>리뷰 작성 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>

    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <div class="container py-4">
            <!-- 브레드크럼 -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">홈</a></li>
                    <li class="breadcrumb-item"><a href="/facility/search">시설 찾기</a></li>
                    <li class="breadcrumb-item"><a href="/review">시설 리뷰</a></li>
                    <li class="breadcrumb-item active" aria-current="page">리뷰 작성</li>
                </ol>
            </nav>

            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h4 class="mb-0">
                                <i class="fas fa-star me-2"></i>시설 리뷰 작성
                            </h4>
                        </div>
                        <div class="card-body">
                            <form th:action="@{/review/write}" method="post" th:object="${reviewDTO}" id="reviewForm">
                                <!-- 시설 ID (hidden) -->
                                <input type="hidden" th:field="*{facilityId}" id="facilityId">
                                
                                <!-- 시설 선택 -->
                                <div class="mb-4" th:if="${reviewDTO.facilityId == null}">
                                    <label class="form-label fw-bold">시설 선택 *</label>
                                    <select class="form-select" name="facilityId" id="facilitySelect" required>
                                        <option value="">시설을 선택해주세요</option>
                                        <option th:each="facility : ${facilityList}" 
                                                th:value="${facility.facilityId}" 
                                                th:text="${facility.facilityName + ' (' + facility.address + ')'}"
                                                th:selected="${facility.facilityId == reviewDTO.facilityId}"
                                                th:data-status="${facility.status}"
                                                th:disabled="${!facility.normalStatus}">
                                            시설명 (주소)
                                        </option>
                                    </select>
                                    <div class="form-text text-danger" th:if="${facilityList.empty}">
                                        현재 등록된 시설이 없습니다. 시설 등록 후 리뷰를 작성해주세요.
                                    </div>
                                    <div class="form-text" th:unless="${facilityList.empty}">
                                        리뷰를 작성할 시설을 선택해주세요. 삭제되거나 승인되지 않은 시설은 선택할 수 없습니다.
                                    </div>
                                </div>

                                <!-- 선택된 시설 정보 표시 -->
                                <div class="mb-4" th:if="${reviewDTO.facilityId != null and selectedFacility != null}">
                                    <label class="form-label fw-bold">선택된 시설</label>
                                    <div class="alert" th:classappend="${selectedFacility.normalStatus ? 'alert-info' : 'alert-warning'}">
                                        <i class="fas fa-building me-2"></i>
                                        <strong>시설명:</strong> <span th:text="${selectedFacility.facilityName}">시설명</span><br>
                                        <i class="fas fa-map-marker-alt me-2"></i>
                                        <strong>주소:</strong> <span th:text="${selectedFacility.address}">주소</span><br>
                                        <i class="fas fa-tag me-2"></i>
                                        <strong>유형:</strong> <span th:text="${selectedFacility.facilityType}">유형</span><br>
                                        <i class="fas fa-phone me-2"></i>
                                        <strong>연락처:</strong> <span th:text="${selectedFacility.phone}">연락처</span><br>
                                        <i class="fas fa-info-circle me-2"></i>
                                        <strong>상태:</strong> <span th:text="${selectedFacility.status}">상태</span>
                                        <div class="mt-2 text-danger" th:if="${!selectedFacility.normalStatus}">
                                            <i class="fas fa-exclamation-triangle me-1"></i>
                                            <span th:text="${selectedFacility.statusMessage}">상태 메시지</span>
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <a href="/review/write" class="btn btn-outline-secondary btn-sm">
                                            <i class="fas fa-sync-alt me-1"></i>다른 시설 선택
                                        </a>
                                    </div>
                                </div>

                                <!-- 시설 선택 오류 메시지 -->
                                <div class="mb-4" th:if="${reviewDTO.facilityId != null and selectedFacility == null}">
                                    <div class="alert alert-danger">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        선택한 시설을 찾을 수 없습니다. 다른 시설을 선택해주세요.
                                    </div>
                                    <div class="mt-2">
                                        <a href="/review/write" class="btn btn-primary">
                                            <i class="fas fa-redo me-1"></i>시설 다시 선택하기
                                        </a>
                                    </div>
                                </div>

                                <!-- 제목 -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">제목 *</label>
                                    <input type="text" class="form-control" th:field="*{title}" id="title"
                                           placeholder="리뷰 제목을 입력해주세요 (예: 친절한 직원들과 깨끗한 시설)" 
                                           maxlength="200" required>
                                    <div class="form-text">최대 200자까지 입력 가능합니다.</div>
                                </div>

                                <!-- 전체 평점 -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">전체 평점 *</label>
                                    <div class="rating-input-group">
                                        <div class="d-flex align-items-center">
                                            <div class="rating-stars" id="overallRating">
                                                <span class="star" data-rating="1" title="매우 불만족">★</span>
                                                <span class="star" data-rating="2" title="불만족">★</span>
                                                <span class="star" data-rating="3" title="보통">★</span>
                                                <span class="star" data-rating="4" title="만족">★</span>
                                                <span class="star" data-rating="5" title="매우 만족">★</span>
                                            </div>
                                            <span id="ratingText" class="ms-2">평점을 선택해주세요</span>
                                        </div>
                                        <input type="hidden" name="rating" id="ratingValue" th:value="${reviewDTO != null ? reviewDTO.rating : ''}" required>
                                    </div>
                                    <div class="form-text">별표를 클릭하여 평점을 선택해주세요.</div>
                                </div>

                                <!-- 세부 평점 -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">세부 평점</label>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="rating-group">
                                                <label class="form-label">서비스 품질</label>
                                                <div class="d-flex align-items-center">
                                                    <div class="rating-stars detailed-rating" data-field="serviceRating">
                                                        <span class="star" data-rating="1" title="매우 불만족">★</span>
                                                        <span class="star" data-rating="2" title="불만족">★</span>
                                                        <span class="star" data-rating="3" title="보통">★</span>
                                                        <span class="star" data-rating="4" title="만족">★</span>
                                                        <span class="star" data-rating="5" title="매우 만족">★</span>
                                                    </div>
                                                </div>
                                                <input type="hidden" name="serviceRating" class="detailed-rating-input" th:value="${reviewDTO != null ? reviewDTO.serviceRating : ''}">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="rating-group">
                                                <label class="form-label">시설 환경</label>
                                                <div class="d-flex align-items-center">
                                                    <div class="rating-stars detailed-rating" data-field="facilityRating">
                                                        <span class="star" data-rating="1" title="매우 불만족">★</span>
                                                        <span class="star" data-rating="2" title="불만족">★</span>
                                                        <span class="star" data-rating="3" title="보통">★</span>
                                                        <span class="star" data-rating="4" title="만족">★</span>
                                                        <span class="star" data-rating="5" title="매우 만족">★</span>
                                                    </div>
                                                </div>
                                                <input type="hidden" name="facilityRating" class="detailed-rating-input" th:value="${reviewDTO != null ? reviewDTO.facilityRating : ''}">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="rating-group">
                                                <label class="form-label">직원 친절도</label>
                                                <div class="d-flex align-items-center">
                                                    <div class="rating-stars detailed-rating" data-field="staffRating">
                                                        <span class="star" data-rating="1" title="매우 불만족">★</span>
                                                        <span class="star" data-rating="2" title="불만족">★</span>
                                                        <span class="star" data-rating="3" title="보통">★</span>
                                                        <span class="star" data-rating="4" title="만족">★</span>
                                                        <span class="star" data-rating="5" title="매우 만족">★</span>
                                                    </div>
                                                </div>
                                                <input type="hidden" name="staffRating" class="detailed-rating-input" th:value="${reviewDTO != null ? reviewDTO.staffRating : ''}">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="rating-group">
                                                <label class="form-label">가격 만족도</label>
                                                <div class="d-flex align-items-center">
                                                    <div class="rating-stars detailed-rating" data-field="priceRating">
                                                        <span class="star" data-rating="1" title="매우 불만족">★</span>
                                                        <span class="star" data-rating="2" title="불만족">★</span>
                                                        <span class="star" data-rating="3" title="보통">★</span>
                                                        <span class="star" data-rating="4" title="만족">★</span>
                                                        <span class="star" data-rating="5" title="매우 만족">★</span>
                                                    </div>
                                                </div>
                                                <input type="hidden" name="priceRating" class="detailed-rating-input" th:value="${reviewDTO != null ? reviewDTO.priceRating : ''}">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-text mt-2">각 항목별로 세부 평점을 매겨주세요 (선택사항).</div>
                                </div>

                                <!-- 리뷰 내용 -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">리뷰 내용 *</label>
                                    <textarea class="form-control" rows="8" th:field="*{content}" id="content"
                                              placeholder="시설 이용 경험을 자세히 작성해주세요.&#10;&#10;예시:&#10;- 시설의 장점과 단점&#10;- 직원들의 서비스 품질&#10;- 시설 환경과 청결도&#10;- 다른 이용자들에게 도움이 될 정보" 
                                              maxlength="2000" required
                                              data-rich-editor='{"height": "350px", "maxLength": 2000}'></textarea>
                                    <div class="form-text">
                                        <span id="contentLength">0</span>/2000자 (최소 10자 이상 작성해주세요)
                                    </div>
                                </div>

                                <!-- 추천 여부 -->
                                <div class="mb-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="recommended" name="recommended">
                                        <label class="form-check-label fw-bold" for="recommended">
                                            <i class="fas fa-thumbs-up text-success me-1"></i>
                                            이 시설을 다른 분들께 추천하시겠습니까?
                                        </label>
                                    </div>
                                </div>

                                <!-- 버튼 -->
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-secondary" id="cancelBtn">
                                        <i class="fas fa-arrow-left me-1"></i>취소
                                    </button>
                                    <button type="submit" class="btn btn-primary" id="submitBtn">
                                        <i class="fas fa-save me-1"></i>리뷰 등록
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- 리뷰 작성 가이드 -->
                    <div class="card mt-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-lightbulb text-warning me-2"></i>리뷰 작성 가이드
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-success">
                                        <i class="fas fa-check-circle me-1"></i>좋은 리뷰 작성법
                                    </h6>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-check text-success me-2"></i>실제 이용 경험을 바탕으로 작성</li>
                                        <li><i class="fas fa-check text-success me-2"></i>시설의 장단점을 구체적으로 설명</li>
                                        <li><i class="fas fa-check text-success me-2"></i>다른 이용자들에게 도움이 되는 정보 포함</li>
                                        <li><i class="fas fa-check text-success me-2"></i>객관적이고 정확한 정보 제공</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-danger">
                                        <i class="fas fa-times-circle me-1"></i>주의사항
                                    </h6>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-times text-danger me-2"></i>욕설이나 비방 금지</li>
                                        <li><i class="fas fa-times text-danger me-2"></i>허위 정보 작성 금지</li>
                                        <li><i class="fas fa-times text-danger me-2"></i>개인정보 노출 금지</li>
                                        <li><i class="fas fa-times text-danger me-2"></i>광고성 내용 금지</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 푸터 -->
    <div th:replace="~{layout/footer :: footer}"></div>
    
    <!-- JavaScript -->
    <div th:replace="~{layout/footer :: scripts}"></div>
    
    <!-- 리뷰 작성 전용 JavaScript -->
    <script src="/js/review-write.js"></script>

    <style>
        /* 전체 평점 스타일 */
        #overallRating {
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        #overallRating .star {
            color: #ddd;
            transition: color 0.2s;
            cursor: pointer;
            user-select: none;
            display: inline-block;
            margin-right: 4px;
        }
        
        #overallRating .star:hover,
        #overallRating .star.active {
            color: #ffc107;
        }
        
        /* 세부 평점 스타일 */
        .detailed-rating {
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .detailed-rating .star {
            color: #ddd;
            transition: color 0.2s;
            cursor: pointer;
            user-select: none;
            display: inline-block;
            margin-right: 2px;
        }
        
        .detailed-rating .star:hover,
        .detailed-rating .star.active {
            color: #ffc107;
        }
        
        /* 별점 그룹 전용 스타일로 common.css 오버라이드 */
        .rating-input-group .rating-stars .star {
            font-size: 1.5rem !important;
            cursor: pointer !important;
            display: inline-block !important;
        }
        
        .rating-group .rating-stars .star {
            font-size: 1.2rem !important;
            cursor: pointer !important;
            display: inline-block !important;
        }
        
        /* 호버 효과 수정 */
        .detailed-rating .star:hover ~ .star {
            color: #ddd !important;
        }
        
        .detailed-rating:hover .star {
            color: #ffc107;
        }
        
        .detailed-rating .star:hover ~ .star {
            color: #ddd !important;
        }
        
        #overallRating .star:hover ~ .star {
            color: #ddd !important;
        }
        
        #overallRating:hover .star {
            color: #ffc107;
        }
        
        #overallRating .star:hover ~ .star {
            color: #ddd !important;
        }
        
        /* 평점에 대한 디버깅용 스타일 (임시) */
        .detailed-rating {
            border: 1px solid transparent;
        }
        
        .detailed-rating:hover {
            border: 1px solid #007bff;
            border-radius: 4px;
            padding: 2px;
        }
    </style>
    
</body>
</html>
````

## File: src/main/java/com/example/carelink/controller/JobController.java
````java
package com.example.carelink.controller;

import com.example.carelink.common.Constants;
import com.example.carelink.dto.JobDTO;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.service.JobService;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import javax.servlet.http.HttpSession;
import java.util.List;

/**
 * 구인구직 게시판 컨트롤러
 * 팀원 C 담당
 */
@Controller
@RequestMapping("/job")
@RequiredArgsConstructor
public class JobController {
    
    private final JobService jobService;

    /**
     * 구인구직 목록 페이지
     */
    @GetMapping
    public String listPage(Model model,
                          @RequestParam(defaultValue = "1") int page,
                          @RequestParam(defaultValue = "") String keyword,
                          @RequestParam(defaultValue = "") String jobType) {

        List<JobDTO> jobList = jobService.getJobList(page, keyword, jobType);
        model.addAttribute("jobList", jobList);
        model.addAttribute("keyword", keyword);
        model.addAttribute("jobType", jobType);
        model.addAttribute("currentPage", page);
        
        return "job/list";
    }

    /**
     * 구인구직 작성 페이지 로드
     * 로그인된 사용자 모두 접근 가능 (권한별 타입 제한은 POST에서 처리)
     */
    @GetMapping("/write")
    public String writePage(@RequestParam(defaultValue = "RECRUIT") String type, Model model, HttpSession session) {
        // 로그인 체크만 수행
        MemberDTO loggedInMember = getCurrentMember(session);
        if (loggedInMember == null) {
            session.setAttribute("errorMessage", "로그인 후 이용해주세요.");
            return "redirect:/member/login";
        }
        
        // 권한별 기본 타입 설정 (엄격한 체크 제거)
        String defaultType = type;
        if ("FACILITY".equals(loggedInMember.getRole())) {
            defaultType = "RECRUIT"; // 시설회원은 구인 기본
        } else if ("USER".equals(loggedInMember.getRole())) {
            defaultType = "SEARCH"; // 일반회원은 구직 기본
        }
        // 관리자는 요청받은 타입 그대로 사용

        JobDTO jobDTO = new JobDTO();
        jobDTO.setJobType(defaultType);
        model.addAttribute("jobDTO", jobDTO);
        model.addAttribute("selectedType", defaultType);
        model.addAttribute("currentMember", loggedInMember);
        return "job/write";
    }

    /**
     * 구인구직 등록 처리 (권한별 타입 제한 적용)
     */
    @PostMapping("/write")
    public String writeJob(@ModelAttribute JobDTO jobDTO, HttpSession session) {
        // 로그인 체크
        MemberDTO loggedInMember = getCurrentMember(session);
        if (loggedInMember == null) {
            session.setAttribute("errorMessage", "로그인 후 이용해주세요.");
            return "redirect:/member/login";
        }
        
        // 권한별 타입 유효성 검사 (POST 처리 시점에서 수행)
        String jobType = jobDTO.getJobType();
        String userRole = loggedInMember.getRole();
        
        // 시설회원이 구직글을 작성하려고 하는 경우
        if ("FACILITY".equals(userRole) && "SEARCH".equals(jobType)) {
            session.setAttribute("errorMessage", "시설회원은 구인공고만 작성할 수 있습니다.");
            return "redirect:/job/write?type=RECRUIT";
        }
        
        // 일반회원이 구인글을 작성하려고 하는 경우
        if ("USER".equals(userRole) && "RECRUIT".equals(jobType)) {
            session.setAttribute("errorMessage", "일반회원은 구직공고만 작성할 수 있습니다.");
            return "redirect:/job/write?type=SEARCH";
        }

        // 기본값 설정
        if (jobDTO.getStatus() == null || jobDTO.getStatus().isEmpty()) {
            jobDTO.setStatus("ACTIVE");
        }

        // 현재 로그인된 사용자 정보 설정
        jobDTO.setMemberId(loggedInMember.getMemberId());

        // priority 기본값 설정 (NULL 방지)
        if (jobDTO.getPriority() == null) {
            jobDTO.setPriority(0);
        }

        try {
            // 서비스 호출
            jobService.insertJob(jobDTO);
            session.setAttribute("successMessage", "공고가 성공적으로 등록되었습니다.");
            return "redirect:/job";
        } catch (Exception e) {
            session.setAttribute("errorMessage", "공고 등록 중 오류가 발생했습니다. 다시 시도해주세요.");
            return "redirect:/job/write?type=" + jobType;
        }
    }

    @GetMapping("/detail/{id}")
    public String detailPage(@PathVariable Long id, Model model, HttpSession session) {
        try {
            JobDTO job = jobService.getJobById(id);

            if (job == null) {
                session.setAttribute("errorMessage", "해당 구인공고를 찾을 수 없습니다.");
                return "redirect:/job";
            }

            String formattedContent = "";
            if (job.getContent() != null) {
                formattedContent = job.getContent().replace(System.lineSeparator(), "<br>");
                formattedContent = formattedContent.replace("\n", "<br>");
            }
            model.addAttribute("formattedJobContent", formattedContent);

            MemberDTO loggedInMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (loggedInMember == null || !job.getMemberId().equals(loggedInMember.getMemberId())) {
                // jobService.increaseViewCount(id);
            }

            model.addAttribute("job", job);

            return "job/detail";

        } catch (Exception e) {
            e.printStackTrace();
            session.setAttribute("errorMessage", "구인공고 조회 중 오류가 발생했습니다.");
            return "redirect:/job";
        }
    }

    /**
     * 구인구직 수정 페이지 (작성자만 접근 가능)
     */
    @GetMapping("/edit/{id}")
    public String editPage(@PathVariable Long id, Model model, HttpSession session) {
        // 로그인 체크
        MemberDTO loggedInMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loggedInMember == null) {
            return "redirect:/member/login";
        }
        
        JobDTO job = jobService.getJobById(id);
        if (job == null) {
            session.setAttribute("errorMessage", "해당 구인공고를 찾을 수 없습니다.");
            return "redirect:/job";
        }
        
        // 수정 권한 체크 (작성자 또는 관리자)
        if (!canEditJob(loggedInMember, job.getMemberId())) {
            session.setAttribute("errorMessage", "수정 권한이 없습니다. 작성자 또는 관리자만 수정할 수 있습니다.");
            return "redirect:/job/detail/" + id;
        }
        
        model.addAttribute("jobDTO", job);
        return "job/edit";
    }
    
    /**
     * 구인구직 수정 처리 (작성자만 가능)
     */
    @PostMapping("/edit/{id}")
    public String editJob(@PathVariable Long id, @ModelAttribute JobDTO jobDTO, HttpSession session) {
        // 로그인 체크
        MemberDTO loggedInMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loggedInMember == null) {
            return "redirect:/member/login";
        }
        
        JobDTO existingJob = jobService.getJobById(id);
        if (existingJob == null) {
            session.setAttribute("errorMessage", "해당 구인공고를 찾을 수 없습니다.");
            return "redirect:/job";
        }
        
        // 수정 권한 체크 (작성자 또는 관리자)
        if (!canEditJob(loggedInMember, existingJob.getMemberId())) {
            session.setAttribute("errorMessage", "수정 권한이 없습니다. 작성자 또는 관리자만 수정할 수 있습니다.");
            return "redirect:/job/detail/" + id;
        }
        
        jobDTO.setJobId(id);
        jobDTO.setMemberId(loggedInMember.getMemberId()); // 작성자 정보 유지
        jobService.updateJob(jobDTO);
        return "redirect:/job/detail/" + id;
    }
    
    /**
     * 구인구직 삭제 (작성자만 가능)
     */
    @PostMapping("/delete/{id}")
    public String deleteJob(@PathVariable Long id, HttpSession session) {
        // 로그인 체크
        MemberDTO loggedInMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loggedInMember == null) {
            return "redirect:/member/login";
        }
        
        JobDTO existingJob = jobService.getJobById(id);
        if (existingJob == null) {
            session.setAttribute("errorMessage", "해당 구인공고를 찾을 수 없습니다.");
            return "redirect:/job";
        }
        
        // 작성자 또는 관리자 권한 체크
        boolean isOwner = existingJob.getMemberId().equals(loggedInMember.getMemberId());
        boolean isAdmin = "ADMIN".equals(loggedInMember.getRole());
        
        if (!isOwner && !isAdmin) {
            session.setAttribute("errorMessage", "삭제 권한이 없습니다. 작성자만 삭제할 수 있습니다.");
            return "redirect:/job/detail/" + id;
        }
        
        jobService.deleteJob(id);
        session.setAttribute("successMessage", "구인공고가 삭제되었습니다.");
        return "redirect:/job";
    }

    /**
     * 구인공고에 지원하기 (개인 회원만 가능)
     * POST 요청으로 지원 처리를 수행합니다.
     */
    @PostMapping("/{id}/apply")
    public String applyForJob(@PathVariable Long id, HttpSession session, RedirectAttributes redirectAttributes) {
        // 1. 로그인 여부 및 회원 유형 확인 (개인 회원만 지원 가능하도록)
        MemberDTO loggedInMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loggedInMember == null) {
            redirectAttributes.addFlashAttribute("errorMessage", "로그인 후 이용해주세요.");
            return "redirect:/member/login";
        }
        if (!"USER".equals(loggedInMember.getRole())) {
            redirectAttributes.addFlashAttribute("errorMessage", "개인 회원만 구인공고에 지원할 수 있습니다.");
            return "redirect:/job/detail/" + id;
        }

        try {
            // 2. JobService를 통해 지원 로직 수행
            // 이 메서드는 JobService에 추가해야 합니다. (아래 참고)
            jobService.applyForJob(id, loggedInMember.getMemberId());

            redirectAttributes.addFlashAttribute("successMessage", "구인공고 지원이 완료되었습니다!");
            return "redirect:/job/detail/" + id; // 지원 완료 후 상세 페이지로 리다이렉트
        } catch (IllegalArgumentException e) {
            // 예를 들어, 이미 지원했거나, 없는 공고에 지원 시
            redirectAttributes.addFlashAttribute("errorMessage", e.getMessage());
            return "redirect:/job/detail/" + id;
        } catch (Exception e) {
            // 기타 예상치 못한 오류 발생 시
            redirectAttributes.addFlashAttribute("errorMessage", "구인공고 지원 중 오류가 발생했습니다. 다시 시도해주세요.");
            return "redirect:/job/detail/" + id;
        }
    }
    
    // ================= 권한 체크 메서드들 =================
    
    /**
     * 현재 로그인한 사용자 조회
     */
    private MemberDTO getCurrentMember(HttpSession session) {
        return (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
    }
    
    /**
     * 구인공고 작성 권한 확인 (시설회원, 관리자)
     */
    private boolean canWriteRecruit(MemberDTO member) {
        return member != null && ("FACILITY".equals(member.getRole()) || "ADMIN".equals(member.getRole()));
    }
    
    /**
     * 구직공고 작성 권한 확인 (일반회원, 관리자)
     */
    private boolean canWriteSearch(MemberDTO member) {
        return member != null && ("USER".equals(member.getRole()) || "ADMIN".equals(member.getRole()));
    }
    
    /**
     * 수정/삭제 권한 확인 (작성자, 관리자)
     */
    private boolean canEditJob(MemberDTO member, Long authorId) {
        return member != null && (member.getMemberId().equals(authorId) || "ADMIN".equals(member.getRole()));
    }
    
    /**
     * 지원/연락 권한 확인 (작성자가 아닌 로그인 사용자)
     */
    private boolean canApplyOrContact(MemberDTO member, Long authorId) {
        return member != null && !member.getMemberId().equals(authorId);
    }
    
    /**
     * 관리자 권한 확인
     */
    private boolean isAdmin(MemberDTO member) {
        return member != null && "ADMIN".equals(member.getRole());
    }
}
````

## File: src/main/java/com/example/carelink/service/JobService.java
````java
package com.example.carelink.service;

import com.example.carelink.dao.JobMapper;
import com.example.carelink.dto.JobApplicationDTO;
import com.example.carelink.dto.JobDTO;
import com.example.carelink.dao.JobApplicationMapper;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

/**
 * 구인구직 관련 비즈니스 로직 서비스
 * 팀원 C 담당 - 개선 버전
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class JobService {
    
    private final JobMapper jobMapper;
    private final JobApplicationMapper jobApplicationMapper;

    /**
     * 구인구직 목록 조회
     */
    public List<JobDTO> getJobList(int currentPage, String keyword, String jobType) {
        log.info("구인구직 목록 조회 시작 - page: {}, keyword: {}, jobType: {}", currentPage, keyword, jobType);
        
        try {
            JobDTO searchDTO = new JobDTO();
            
            int pageSize = 10;
            searchDTO.setSize(pageSize);
            searchDTO.setPage((currentPage - 1) * pageSize);
            
            if (keyword != null && !keyword.trim().isEmpty()) {
                searchDTO.setSearchKeyword(keyword.trim());
            }
            
            if (jobType != null && !jobType.trim().isEmpty()) {
                searchDTO.setJobType(jobType.trim());
            }
            
            List<JobDTO> jobList = jobMapper.getJobList(searchDTO);
            log.info("구인구직 목록 조회 완료 - 조회된 건수: {}", jobList.size());
            
            return jobList;
        } catch (Exception e) {
            log.error("구인구직 목록 조회 중 오류 발생", e);
            // 임시로 빈 리스트 반환 (개발 초기 에러 방지)
            return new ArrayList<>();
        }
    }
    
    /**
     * 구인구직 상세 정보 조회
     */
    public JobDTO getJobById(Long id) {
        log.info("구인구직 상세 조회 시작 - jobId: {}", id);
        
        try {
            JobDTO job = jobMapper.findJobById(id);
            if (job == null) {
                log.warn("구인구직 정보를 찾을 수 없습니다 - jobId: {}", id);
                throw new RuntimeException("해당 구인구직 정보를 찾을 수 없습니다. ID: " + id);
            }
            
            // 조회수 증가는 별도 메서드로 처리 (현재는 주석 처리)
            // jobMapper.incrementViewCount(id);
            log.info("구인구직 상세 조회 완료 - jobId: {}, title: {}", id, job.getTitle());
            
            return job;
        } catch (Exception e) {
            log.error("구인구직 상세 조회 중 오류 발생 - jobId: {}", id, e);
            
            // 임시로 기본 구인구직 정보 반환 (개발 초기 에러 방지)
            JobDTO job = new JobDTO();
            job.setJobId(id);
            job.setTitle("구인구직 정보를 불러오는 중 오류가 발생했습니다");
            job.setContent("시스템 오류로 인해 상세 정보를 불러올 수 없습니다. 잠시 후 다시 시도해주세요.");
            job.setJobType("RECRUIT");
            job.setWorkType("FULL_TIME");
            job.setPosition("미정");
            job.setSalaryMin(java.math.BigDecimal.ZERO);
            job.setSalaryMax(java.math.BigDecimal.ZERO);
            job.setWorkLocation("미정");
            job.setStatus("ACTIVE");
            job.setMemberId(1L);
            job.setViewCount(0);
            
            return job;
        }
    }
    
    /**
     * 구인구직 등록
     */
    public int insertJob(JobDTO jobDTO) {
        log.info("구인구직 등록 시작 - title: {}, jobType: {}", jobDTO.getTitle(), jobDTO.getJobType());
        
        try {
            // 필수 값 검증
            validateJobData(jobDTO);
            
            // 데이터 정리 및 중복 제거 (누적 방지)
            cleanAndValidateJobData(jobDTO);
            
            // 기본값 설정
            if (jobDTO.getStatus() == null) {
                jobDTO.setStatus("ACTIVE");
            }
            if (jobDTO.getPriority() == null) {
                jobDTO.setPriority(0);
            }
            
            int result = jobMapper.insertJob(jobDTO);
            log.info("구인구직 등록 완료 - jobId: {}", jobDTO.getJobId());
            
            return result;
        } catch (Exception e) {
            log.error("구인구직 등록 중 오류 발생", e);
            throw new RuntimeException("구인구직 등록 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 구인구직 수정
     */
    public int updateJob(JobDTO jobDTO) {
        log.info("구인구직 수정 시작 - jobId: {}, title: {}", jobDTO.getJobId(), jobDTO.getTitle());
        
        try {
            // 구인구직 존재 확인
            JobDTO existingJob = jobMapper.findJobById(jobDTO.getJobId());
            if (existingJob == null) {
                throw new RuntimeException("수정할 구인구직을 찾을 수 없습니다. ID: " + jobDTO.getJobId());
            }
            
            // 필수 값 검증
            validateJobData(jobDTO);
            
            // 데이터 정리 및 중복 제거 (누적 방지)
            cleanAndValidateJobData(jobDTO);

            // priority null 체크 및 기본값 설정 로직 추가
            if (jobDTO.getPriority() == null) {
                jobDTO.setPriority(0);
                log.warn("priority 값이 null이어서 0으로 자동 설정되었습니다. jobId: {}", jobDTO.getJobId());
            }

            int result = jobMapper.updateJob(jobDTO);
            log.info("구인구직 수정 완료 - jobId: {}", jobDTO.getJobId());
            
            return result;
        } catch (Exception e) {
            log.error("구인구직 수정 중 오류 발생 - jobId: {}", jobDTO.getJobId(), e);
            throw new RuntimeException("구인구직 수정 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 구인구직 삭제
     */
    public int deleteJob(Long id) {
        log.info("구인구직 삭제 시작 - jobId: {}", id);
        
        try {
            int result = jobMapper.deleteJob(id);
            log.info("구인구직 삭제 완료 - jobId: {}", id);
            
            return result;
        } catch (Exception e) {
            log.error("구인구직 삭제 중 오류 발생 - jobId: {}", id, e);
            throw new RuntimeException("구인구직 삭제 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 인기 구인구직 조회
     */
    public List<JobDTO> getPopularJobs() {
        try {
            return jobMapper.getPopularJobs();
        } catch (Exception e) {
            log.error("인기 구인구직 조회 중 오류 발생", e);
            return new ArrayList<>();
        }
    }
    
    /**
     * 전체 구인구직 수 조회 (통계용)
     */
    public int getJobCount() {
        try {
            return jobMapper.getJobCount();
        } catch (Exception e) {
            log.error("구인구직 수 조회 중 오류 발생", e);
            return 0; // 오류 시 0 반환
        }
    }
    
    /**
     * 구인구직 데이터 유효성 검증
     */
    private void validateJobData(JobDTO jobDTO) {
        if (jobDTO.getTitle() == null || jobDTO.getTitle().trim().isEmpty()) {
            throw new IllegalArgumentException("제목은 필수 입력값입니다.");
        }
        if (jobDTO.getContent() == null || jobDTO.getContent().trim().isEmpty()) {
            throw new IllegalArgumentException("내용은 필수 입력값입니다.");
        }
        if (jobDTO.getJobType() == null || jobDTO.getJobType().trim().isEmpty()) {
            throw new IllegalArgumentException("구인구직 유형은 필수 입력값입니다.");
        }
        if (jobDTO.getMemberId() == null) {
            throw new IllegalArgumentException("작성자 정보가 필요합니다.");
        }
    }
    
    /**
     * 구인구직 데이터 정리 및 중복 제거 (누적 방지)
     */
    private void cleanAndValidateJobData(JobDTO jobDTO) {
        log.info("데이터 정리 시작 - jobId: {}", jobDTO.getJobId());
        
        // 제목 정리
        if (jobDTO.getTitle() != null) {
            jobDTO.setTitle(jobDTO.getTitle().trim());
        }
        
        // 내용 정리
        if (jobDTO.getContent() != null) {
            jobDTO.setContent(jobDTO.getContent().trim());
        }
        
        // 급여 설명 정리 (중복 제거)
        if (jobDTO.getSalaryDescription() != null && !jobDTO.getSalaryDescription().trim().isEmpty()) {
            String cleanSalaryDesc = cleanDuplicateValues(jobDTO.getSalaryDescription());
            jobDTO.setSalaryDescription(cleanSalaryDesc);
            log.debug("급여 설명 정리됨: {} -> {}", jobDTO.getSalaryDescription(), cleanSalaryDesc);
        }
        
        // 근무시간 정리 (중복 제거)
        if (jobDTO.getWorkHours() != null && !jobDTO.getWorkHours().trim().isEmpty()) {
            String cleanWorkHours = cleanDuplicateValues(jobDTO.getWorkHours());
            jobDTO.setWorkHours(cleanWorkHours);
            log.debug("근무시간 정리됨: {} -> {}", jobDTO.getWorkHours(), cleanWorkHours);
        }
        
        // 회사명 정리
        if (jobDTO.getFacilityName() != null) {
            jobDTO.setFacilityName(jobDTO.getFacilityName().trim());
        }
        
        // 근무지 정리
        if (jobDTO.getWorkLocation() != null) {
            jobDTO.setWorkLocation(jobDTO.getWorkLocation().trim());
        }
        
        // 연락처 정리
        if (jobDTO.getContactPhone() != null) {
            jobDTO.setContactPhone(jobDTO.getContactPhone().trim());
        }
        
        // 자격증 정리 (중복 제거)
        if (jobDTO.getQualifications() != null && !jobDTO.getQualifications().trim().isEmpty()) {
            String cleanQualifications = cleanDuplicateValues(jobDTO.getQualifications());
            jobDTO.setQualifications(cleanQualifications);
        }
        
        log.info("데이터 정리 완료 - jobId: {}", jobDTO.getJobId());
    }
    
    /**
     * 콤마로 구분된 값들의 중복 제거 유틸리티 메서드
     */
    private String cleanDuplicateValues(String input) {
        if (input == null || input.trim().isEmpty()) {
            return input;
        }
        
        try {
            // 콤마로 분리하여 중복 제거
            String[] values = input.split(",");
            return java.util.Arrays.stream(values)
                    .map(String::trim)
                    .filter(s -> !s.isEmpty())
                    .distinct()
                    .collect(java.util.stream.Collectors.joining(", "));
        } catch (Exception e) {
            log.warn("값 정리 중 오류 발생, 원본 값 반환: {}", input, e);
            return input.trim();
        }
    }

    /**
     * 구인공고에 지원하는 로직
     * @param jobId 지원할 구인공고의 ID
     * @param applicantMemberId 지원하는 개인 회원의 ID
     * @throws IllegalArgumentException 유효성 검사 실패 시
     */
    @Transactional // 트랜잭션이 활성화되어 있는지 다시 한번 확인 (필수)
    public void applyForJob(Long jobId, Long applicantMemberId) {
        log.info("구인공고 지원 로직 시작 - jobId: {}, applicantMemberId: {}", jobId, applicantMemberId);

        JobDTO jobDTO = jobMapper.findJobById(jobId);

        if (jobDTO == null) {
            log.warn("지원할 구인공고를 찾을 수 없습니다 - jobId: {}", jobId);
            throw new IllegalArgumentException("지원할 구인공고를 찾을 수 없습니다.");
        }

        // 1. 이미 지원했는지 확인 (중복 지원 방지)
        int existingApplications = jobApplicationMapper.countByJobIdAndApplicantMemberId(jobId, applicantMemberId);
        if (existingApplications > 0) {
            log.warn("이미 지원한 구인공고입니다 - jobId: {}, applicantMemberId: {}", jobId, applicantMemberId);
            throw new IllegalArgumentException("이미 지원한 구인공고입니다.");
        }

        // 2. 지원 정보 DTO 생성 및 데이터베이스 저장
        JobApplicationDTO jobApplication = new JobApplicationDTO();
        jobApplication.setJobId(jobId);
        jobApplication.setApplicantMemberId(applicantMemberId);
        jobApplication.setApplicationDate(LocalDateTime.now()); // 현재 시간으로 설정
        jobApplication.setStatus("PENDING"); // 초기 상태를 "PENDING"으로 설정

        // JobApplicationMapper를 통해 DB에 삽입합니다.
        jobApplicationMapper.insertJobApplication(jobApplication); // 이 줄의 주석을 해제하고 사용합니다.

        // 3. apply_count 증가 (여기가 핵심적으로 추가되어야 하는 부분!)
        jobMapper.incrementApplyCount(jobId); // <-- 이 줄을 추가합니다!

        log.info("구인공고 지원 로직 완료 - jobId: {}, applicantMemberId: {}, 생성된 지원 ID: {}",
                jobId, applicantMemberId, jobApplication.getId());
    }

}
````

## File: src/main/resources/templates/job/write.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>구인구직 등록 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item"><a href="/job">구인구직</a></li>
                <li class="breadcrumb-item active" aria-current="page">
                    <span th:if="${session.loginMember != null and session.loginMember.role == 'FACILITY'}">구인 등록</span>
                    <span th:if="${session.loginMember != null and session.loginMember.role == 'USER'}">구직 등록</span>
                    <span th:if="${session.loginMember != null and session.loginMember.role == 'ADMIN'}">구인구직 등록</span>
                </li>
            </ol>
        </nav>

        <div class="d-flex align-items-center mb-4">
            <h2 class="me-3">
                <i class="fas fa-plus me-2"></i>
                <span th:if="${session.loginMember != null and session.loginMember.role == 'FACILITY'}" class="text-success">구인 등록</span>
                <span th:if="${session.loginMember != null and session.loginMember.role == 'USER'}" class="text-info">구직 등록</span>
                <span th:if="${session.loginMember != null and session.loginMember.role == 'ADMIN'}" class="text-primary">구인구직 등록</span>
            </h2>

            <!-- 관리자 전용: 구인/구직 타입 선택 (현재 브랜치의 권한 시스템 유지) -->
            <div th:if="${session.loginMember != null and session.loginMember.role == 'ADMIN'}" class="btn-group" role="group">
                <input type="radio" class="btn-check" name="postingType" id="postingTypeRecruit" value="RECRUIT"
                       th:field="${jobDTO.jobType}" th:checked="${jobDTO.jobType == 'RECRUIT'}">
                <label class="btn btn-outline-success" for="postingTypeRecruit">구인글</label>

                <input type="radio" class="btn-check" name="postingType" id="postingTypeSearch" value="SEARCH"
                       th:field="${jobDTO.jobType}" th:checked="${jobDTO.jobType == 'SEARCH'}">
                <label class="btn btn-outline-info" for="postingTypeSearch">구직글</label>
            </div>
        </div>

        <form th:action="@{/job/write}" method="post" th:object="${jobDTO}">
            <!-- 권한별 자동 jobType 설정 (현재 브랜치 권한 시스템 유지) -->
            <input type="hidden" th:if="${session.loginMember != null and session.loginMember.role != 'ADMIN'}"
                   th:field="*{jobType}" id="hiddenJobType"
                   th:value="${session.loginMember.role == 'FACILITY' ? 'RECRUIT' : 'SEARCH'}">
            
            <!-- 관리자는 라디오 버튼으로 동적 제어 -->
            <input type="hidden" th:if="${session.loginMember != null and session.loginMember.role == 'ADMIN'}" 
                   th:field="*{jobType}" id="hiddenJobType" 
                   th:value="${session.loginMember.role == 'FACILITY' ? 'RECRUIT' : (session.loginMember.role == 'USER' ? 'SEARCH' : 'RECRUIT')}">
            
            <!-- 향상된 UI 레이아웃 (메인 브랜치의 개선사항 적용) -->
            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="jobTitle" class="form-label">제목 *</label>
                                <input type="text" class="form-control" id="jobTitle" th:field="*{title}" required 
                                       autocomplete="off"
                                       th:placeholder="${session.loginMember.role == 'FACILITY' ? '구인공고 제목을 입력하세요' : (session.loginMember.role == 'USER' ? '구직공고 제목을 입력하세요' : '제목을 입력하세요')}">
                            </div>
                            
                            <div class="row">
                                <!-- 구인글(시설회원): 회사명 입력 -->
                                <div class="col-md-6 mb-3" id="facilityNameField" 
                                     th:style="${session.loginMember.role == 'USER' ? 'display: none;' : ''}">
                                    <label for="facilityNameInput" class="form-label">
                                        <span class="facility-mode">회사명 *</span>
                                        <span class="search-mode" style="display: none;">희망 근무지 *</span>
                                    </label>
                                    <input type="text" class="form-control" th:field="*{facilityName}" 
                                           id="facilityNameInput" autocomplete="organization"
                                           placeholder="회사명을 입력하세요">
                                </div>
                                
                                <!-- 구직글(일반사용자): 희망 근무지 입력 -->
                                <div class="col-md-6 mb-3" id="workLocationField"
                                     th:style="${session.loginMember.role == 'FACILITY' ? 'display: none;' : ''}">
                                    <label for="workLocationInput" class="form-label">희망 근무지 *</label>
                                    <input type="text" class="form-control" th:field="*{workLocation}" 
                                           id="workLocationInput" autocomplete="address-level2"
                                           placeholder="희망 근무지를 입력하세요">
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="jobPosition" class="form-label">직종 *</label>
                                    <select class="form-select" th:field="*{position}" id="jobPosition" 
                                            autocomplete="off" required>
                                        <option value="">선택해주세요</option>
                                        <option value="간병인">간병인</option>
                                        <option value="요양보호사">요양보호사</option>
                                        <option value="사회복지사">사회복지사</option>
                                        <option value="물리치료사">물리치료사</option>
                                        <option value="간호사">간호사</option>
                                        <option value="영양사">영양사</option>
                                        <option value="사무직">사무직</option>
                                        <option value="조리원">조리원</option>
                                        <option value="운전원">운전원</option>
                                        <option value="기타">기타</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="contentTextarea" class="form-label">
                                    <span class="facility-mode">업무 내용 *</span>
                                    <span class="search-mode" style="display: none;">자기소개 및 경력사항 *</span>
                                </label>
                                <textarea class="form-control" rows="10" th:field="*{content}" required
                                          id="contentTextarea" autocomplete="off"
                                          data-rich-editor='{"height": "350px"}'></textarea>
                            </div>
                            
                            <!-- 구직글 전용 필드들 (메인 브랜치의 추가 기능) -->
                            <div id="jobSeekerFields" th:style="${session.loginMember.role == 'FACILITY' ? 'display: none;' : ''}">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="jobExperience" class="form-label">경력</label>
                                        <select class="form-select" th:field="*{experience}" id="jobExperience"
                                                autocomplete="off">
                                            <option value="">선택해주세요</option>
                                            <option value="신입">신입</option>
                                            <option value="1년 이상">1년 이상</option>
                                            <option value="3년 이상">3년 이상</option>
                                            <option value="5년 이상">5년 이상</option>
                                            <option value="10년 이상">10년 이상</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="jobEducation" class="form-label">학력</label>
                                        <select class="form-select" th:field="*{education}" id="jobEducation"
                                                autocomplete="off">
                                            <option value="">선택해주세요</option>
                                            <option value="중학교 졸업">중학교 졸업</option>
                                            <option value="고등학교 졸업">고등학교 졸업</option>
                                            <option value="전문대학 졸업">전문대학 졸업</option>
                                            <option value="대학교 졸업">대학교 졸업</option>
                                            <option value="대학원 졸업">대학원 졸업</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="jobQualifications" class="form-label">보유 자격증</label>
                                    <textarea class="form-control" rows="3" th:field="*{qualifications}"
                                              id="jobQualifications" autocomplete="off"
                                              placeholder="보유하신 자격증을 입력해주세요 (예: 요양보호사 1급, 간병인 자격증 등)"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <!-- 구인글: 급여 정보 (메인 브랜치의 상세 필드들) -->
                            <div id="recruitFields" th:style="${session.loginMember.role == 'USER' ? 'display: none;' : ''}">
                                <div class="mb-3">
                                    <label for="salaryType" class="form-label">급여 유형 *</label>
                                    <select class="form-select" th:field="*{salaryType}" id="salaryType"
                                            autocomplete="off">
                                        <option value="">선택해주세요</option>
                                        <option value="HOURLY">시급</option>
                                        <option value="MONTHLY">월급</option>
                                        <option value="ANNUAL">연봉</option>
                                    </select>
                                </div>
                                
                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <label for="salaryMin" class="form-label">최소 급여</label>
                                        <input type="number" class="form-control" th:field="*{salaryMin}" 
                                               id="salaryMin" autocomplete="off"
                                               placeholder="최소 급여">
                                    </div>
                                    <div class="col-6 mb-3">
                                        <label for="salaryMax" class="form-label">최대 급여</label>
                                        <input type="number" class="form-control" th:field="*{salaryMax}" 
                                               id="salaryMax" autocomplete="off"
                                               placeholder="최대 급여">
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="salaryDescription" class="form-label">급여 설명</label>
                                    <input type="text" class="form-control" th:field="*{salaryDescription}" 
                                           id="salaryDescription" autocomplete="off"
                                           placeholder="예: 시급 10,000원, 야간수당 별도">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="recruitCount" class="form-label">모집인원</label>
                                    <input type="number" class="form-control" th:field="*{recruitCount}" 
                                           id="recruitCount" autocomplete="off"
                                           placeholder="모집인원" min="1" value="1">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="workHours" class="form-label">근무시간</label>
                                    <input type="text" class="form-control" th:field="*{workHours}" 
                                           id="workHours" autocomplete="off"
                                           placeholder="예: 09:00~18:00, 주 5일">
                                </div>
                            </div>
                            
                            <!-- 구직글: 희망 조건 (메인 브랜치의 추가 기능) -->
                            <div id="searchFields" th:style="${session.loginMember.role == 'FACILITY' ? 'display: none;' : ''}">
                                <div class="mb-3">
                                    <label for="searchSalaryType" class="form-label">희망 급여 유형</label>
                                    <select class="form-select" th:field="*{salaryType}" id="searchSalaryType"
                                            autocomplete="off">
                                        <option value="">상관없음</option>
                                        <option value="HOURLY">시급</option>
                                        <option value="MONTHLY">월급</option>
                                        <option value="ANNUAL">연봉</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="searchSalaryDescription" class="form-label">희망 급여</label>
                                    <input type="text" class="form-control" th:field="*{salaryDescription}" 
                                           id="searchSalaryDescription" autocomplete="off"
                                           placeholder="예: 시급 12,000원 이상">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="searchWorkHours" class="form-label">희망 근무시간</label>
                                    <input type="text" class="form-control" th:field="*{workHours}" 
                                           id="searchWorkHours" autocomplete="off"
                                           placeholder="예: 주간근무 선호, 야간 가능">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="contactPhone" class="form-label">연락처 *</label>
                                    <input type="tel" class="form-control" th:field="*{contactPhone}" 
                                           id="contactPhone" autocomplete="tel"
                                           placeholder="연락 가능한 전화번호" required>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="workType" class="form-label">고용형태 *</label>
                                <select class="form-select" th:field="*{workType}" id="workType" 
                                        autocomplete="off" required>
                                    <option value="">선택해주세요</option>
                                    <option value="FULL_TIME">정규직</option>
                                    <option value="PART_TIME">파트타임</option>
                                    <option value="TEMPORARY">임시직</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="d-grid gap-2 mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i>
                    <span th:if="${session.loginMember != null and session.loginMember.role == 'FACILITY'}">구인공고 등록</span>
                    <span th:if="${session.loginMember != null and session.loginMember.role == 'USER'}">구직공고 등록</span>
                    <span th:if="${session.loginMember != null and session.loginMember.role == 'ADMIN'}">공고 등록</span>
                </button>
                <a href="/job" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i>취소
                </a>
            </div>
        </form>
    </div>
</main>

<!-- 푸터 -->
<footer th:replace="~{layout/footer :: footer}"></footer>

<!-- JavaScript -->
<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 구인구직 작성 페이지 전용 JavaScript -->
<script>
    // 페이지 로드 시 초기 설정 (현재 브랜치 권한 시스템 + 메인 브랜치 동적 제어)
    document.addEventListener('DOMContentLoaded', function() {
        const userRole = '[[${session.loginMember?.role}]]';
        console.log('작성 페이지 로드 - 사용자 역할:', userRole);
        
        // 권한별 초기 상태 설정 (현재 브랜치 권한 시스템 유지)
        if (userRole === 'USER') {
            switchToSearchMode();
        } else if (userRole === 'FACILITY') {
            switchToRecruitMode();
        }
        
        // 폼 검증 이벤트 리스너 추가
        const form = document.querySelector('form');
        if (form) {
            form.addEventListener('submit', function(e) {
                console.log('폼 제출 시도 중...');
                if (!validateJobForm()) {
                    console.log('폼 검증 실패 - 제출 중단');
                    e.preventDefault();
                    return false;
                }
                console.log('폼 검증 성공 - 제출 계속');
            });
        }
        
        // 관리자 전용: 라디오 버튼 이벤트 (현재 브랜치 방식 유지 + 메인 브랜치 동적 기능 추가)
        if (userRole === 'ADMIN') {
            const recruitRadio = document.getElementById('postingTypeRecruit');
            const searchRadio = document.getElementById('postingTypeSearch');

            if (recruitRadio && searchRadio) {
                // 메인 브랜치 방식: 동적 전환 (추가 기능)
                recruitRadio.addEventListener('change', function() {
                    if (this.checked) {
                        switchToRecruitMode();
                    }
                });
                
                searchRadio.addEventListener('change', function() {
                    if (this.checked) {
                        switchToSearchMode();
                    }
                });
            }
        }
        
        // 플레이스홀더 설정 (메인 브랜치 기능)
        updatePlaceholders();
    });
    
    /**
     * 작성 페이지 전용 폼 검증 함수
     */
    function validateJobForm() {
        const hiddenJobType = document.getElementById('hiddenJobType');
        const jobType = hiddenJobType ? hiddenJobType.value : '';
        
        console.log('검증 시작 - jobType:', jobType);
        
        // 공통 필수 필드 검사
        const title = document.querySelector('[name="title"]')?.value?.trim() || '';
        const content = document.querySelector('[name="content"]')?.value?.trim() || '';
        const workType = document.querySelector('[name="workType"]')?.value || '';
        const position = document.querySelector('[name="position"]')?.value || '';
        
        if (!title) {
            alert('제목을 입력해주세요.');
            document.querySelector('[name="title"]')?.focus();
            return false;
        }
        
        if (!content) {
            alert('내용을 입력해주세요.');
            document.querySelector('[name="content"]')?.focus();
            return false;
        }
        
        if (!position) {
            alert('직종을 선택해주세요.');
            document.querySelector('[name="position"]')?.focus();
            return false;
        }
        
        if (!workType) {
            alert('고용형태를 선택해주세요.');
            document.querySelector('[name="workType"]')?.focus();
            return false;
        }
        
        // 구인글(RECRUIT) 전용 필수 필드 검사
        if (jobType === 'RECRUIT') {
            console.log('구인글 검증 중...');
            const facilityName = document.querySelector('[name="facilityName"]')?.value?.trim() || '';
            
            if (!facilityName) {
                alert('회사명을 입력해주세요.');
                document.querySelector('[name="facilityName"]')?.focus();
                return false;
            }
        }
        
        // 구직글(SEARCH) 전용 필수 필드 검사
        if (jobType === 'SEARCH') {
            console.log('구직글 검증 중...');
            const workLocation = document.querySelector('[name="workLocation"]')?.value?.trim() || '';
            const contactPhone = document.querySelector('[name="contactPhone"]')?.value?.trim() || '';
            
            if (!workLocation) {
                alert('희망 근무지를 입력해주세요.');
                document.querySelector('[name="workLocation"]')?.focus();
                return false;
            }
            
            if (!contactPhone) {
                alert('연락처를 입력해주세요.');
                document.querySelector('[name="contactPhone"]')?.focus();
                return false;
            }
        }
        
        // 길이 검사
        if (title.length > 100) {
            alert('제목은 100자 이하로 입력해주세요.');
            document.querySelector('[name="title"]')?.focus();
            return false;
        }
        
        if (content.length > 2000) {
            alert('내용은 2000자 이하로 입력해주세요.');
            document.querySelector('[name="content"]')?.focus();
            return false;
        }
        
        console.log('모든 검증 통과');
        return true;
    }
    
    // 구인 모드로 전환 (메인 브랜치의 동적 제어 기능)
    function switchToRecruitMode() {
        console.log('구인 모드로 전환');
        
        // 숨겨진 jobType 필드 업데이트
        const hiddenJobType = document.getElementById('hiddenJobType');
        if (hiddenJobType) {
            hiddenJobType.value = 'RECRUIT';
        }
        
        // 필드 표시/숨김
        const facilityNameField = document.getElementById('facilityNameField');
        const workLocationField = document.getElementById('workLocationField');
        const jobSeekerFields = document.getElementById('jobSeekerFields');
        const recruitFields = document.getElementById('recruitFields');
        const searchFields = document.getElementById('searchFields');
        
        if (facilityNameField) facilityNameField.style.display = 'block';
        if (workLocationField) workLocationField.style.display = 'none';
        if (jobSeekerFields) jobSeekerFields.style.display = 'none';
        if (recruitFields) recruitFields.style.display = 'block';
        if (searchFields) searchFields.style.display = 'none';
        
        // 라벨 표시
        document.querySelectorAll('.facility-mode').forEach(el => el.style.display = 'inline');
        document.querySelectorAll('.search-mode').forEach(el => el.style.display = 'none');
        
        // 필수 필드 설정
        const facilityNameInput = document.getElementById('facilityNameInput');
        if (facilityNameInput) {
            facilityNameInput.required = true;
        }
        
        const contactPhoneInput = document.querySelector('[name="contactPhone"]');
        if (contactPhoneInput) {
            contactPhoneInput.required = false;
        }
    }
    
    // 구직 모드로 전환 (메인 브랜치의 동적 제어 기능)
    function switchToSearchMode() {
        console.log('구직 모드로 전환');
        
        // 숨겨진 jobType 필드 업데이트
        const hiddenJobType = document.getElementById('hiddenJobType');
        if (hiddenJobType) {
            hiddenJobType.value = 'SEARCH';
        }
        
        // 필드 표시/숨김
        const facilityNameField = document.getElementById('facilityNameField');
        const workLocationField = document.getElementById('workLocationField');
        const jobSeekerFields = document.getElementById('jobSeekerFields');
        const recruitFields = document.getElementById('recruitFields');
        const searchFields = document.getElementById('searchFields');
        
        if (facilityNameField) facilityNameField.style.display = 'none';
        if (workLocationField) workLocationField.style.display = 'block';
        if (jobSeekerFields) jobSeekerFields.style.display = 'block';
        if (recruitFields) recruitFields.style.display = 'none';
        if (searchFields) searchFields.style.display = 'block';
        
        // 라벨 표시
        document.querySelectorAll('.facility-mode').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.search-mode').forEach(el => el.style.display = 'inline');
        
        // 필수 필드 설정
        const facilityNameInput = document.getElementById('facilityNameInput');
        if (facilityNameInput) {
            facilityNameInput.required = false;
        }
        
        const contactPhoneInput = document.querySelector('[name="contactPhone"]');
        if (contactPhoneInput) {
            contactPhoneInput.required = true;
        }
    }
    
    // 플레이스홀더 업데이트 함수 (메인 브랜치 기능)
    function updatePlaceholders() {
        // 필요에 따라 플레이스홀더 동적 변경 로직 추가
    }
</script>
</body>
</html>
````

## File: build.gradle
````
plugins {
    id 'org.springframework.boot' version '2.7.18'
    id 'io.spring.dependency-management' version '1.0.15.RELEASE'
    id 'java'
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'

java {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}

repositories {
    mavenCentral()
}

dependencies {
    // Spring Boot 기본 의존성
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-actuator'
    developmentOnly 'org.springframework.boot:spring-boot-devtools'

    // Thymeleaf 템플릿 엔진
    implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'

    // MySQL 데이터베이스 연결 (로컬 개발용)
    runtimeOnly 'com.mysql:mysql-connector-j'
    
    // PostgreSQL 데이터베이스 연결 (Heroku용)
    runtimeOnly 'org.postgresql:postgresql'

    // MyBatis 연동
    implementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter:2.3.1'

    // Lombok (코드 자동 생성)
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'

    // 유효성 검증
    implementation 'org.springframework.boot:spring-boot-starter-validation'

    // JSON 처리
    implementation 'com.fasterxml.jackson.core:jackson-databind'
    implementation 'com.fasterxml.jackson.datatype:jackson-datatype-jsr310'

    // 테스트 의존성
    testImplementation 'org.springframework.boot:spring-boot-starter-test'

    // Spring Security
    implementation 'org.springframework.boot:spring-boot-starter-security'

    // Thymeleaf와 Spring Security 연동을 위한 확장 라이브러리
    implementation 'org.thymeleaf.extras:thymeleaf-extras-springsecurity5'

    // SpringDoc OpenAPI 의존성 추가 (임시 비활성화 - 기능 구현 완료 후 활성화 예정)
    // implementation 'org.springdoc:springdoc-openapi-ui:1.7.0'
    // implementation 'org.springdoc:springdoc-openapi-security:1.7.0'

}

tasks.named('test') {
    useJUnitPlatform()
}
````

## File: src/main/java/com/example/carelink/service/FacilityService.java
````java
package com.example.carelink.service;

import com.example.carelink.dao.FacilityMapper;
import com.example.carelink.dto.FacilityDTO;
import com.example.carelink.dto.FacilityImageDTO;
import com.example.carelink.common.Constants;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.UUID;

@Service
public class FacilityService {

    private final FacilityMapper facilityMapper;
    private final FacilityImageService facilityImageService;
    private static final Logger log = LoggerFactory.getLogger(FacilityService.class);

    @Autowired
    public FacilityService(FacilityMapper facilityMapper, FacilityImageService facilityImageService) {
        this.facilityMapper = facilityMapper;
        this.facilityImageService = facilityImageService;
    }

    /**
     * 시설 검색 서비스 (메인 이미지 포함)
     */
    public List<FacilityDTO> searchFacilities(FacilityDTO searchDTO) {
        log.info("시설 검색 서비스 호출 - facilityName: {}, address: {}, facilityType: {}", 
                searchDTO.getFacilityName(), searchDTO.getAddress(), searchDTO.getFacilityType());
        
        List<FacilityDTO> results = facilityMapper.searchFacilities(searchDTO);
        log.info("시설 검색 결과 - 총 {}개 시설 발견", results.size());
        
        // 각 시설의 메인 이미지 설정
        for (FacilityDTO facility : results) {
            try {
                FacilityImageDTO mainImage = facilityImageService.getMainImageByFacilityId(facility.getFacilityId());
                if (mainImage != null && mainImage.getImagePath() != null) {
                    facility.setFacilityImage(mainImage.getImagePath());
                }
            } catch (Exception e) {
                log.warn("시설 검색 중 메인 이미지 조회 실패 - facilityId: {}", facility.getFacilityId(), e);
                facility.setFacilityImage(null);
            }
        }
        
        return results;
    }

    /**
     * 시설 상세 정보 조회 서비스 (메인 이미지 포함)
     */
    @Transactional(readOnly = true)
    public FacilityDTO getFacilityById(Long facilityId) {
        if (facilityId == null) {
            log.warn("시설 ID가 null입니다.");
            return null;
        }
        
        log.info("시설 상세 정보 조회 시작 - facilityId: {}", facilityId);
        FacilityDTO facility = facilityMapper.getFacilityById(facilityId);
        
        if (facility == null) {
            log.warn("시설을 찾을 수 없음 - facilityId: {}", facilityId);
            return null;
        }
        
        // 메인 이미지 정보 추가 조회
        try {
            FacilityImageDTO mainImage = facilityImageService.getMainImageByFacilityId(facilityId);
            if (mainImage != null && mainImage.getImagePath() != null) {
                facility.setFacilityImage(mainImage.getImagePath());
                log.info("✅ 시설 메인 이미지 설정 완료 - imagePath: {}", mainImage.getImagePath());
            } else {
                log.info("⚠️ 시설 메인 이미지 없음 - facilityId: {}", facilityId);
                facility.setFacilityImage(null); // 명시적으로 null 설정
            }
        } catch (Exception e) {
            log.error("❌ 시설 메인 이미지 조회 중 오류 발생 - facilityId: {}", facilityId, e);
            facility.setFacilityImage(null);
        }
        
        log.info("시설 상세 정보 조회 완료 - facilityName: {}, status: {}, mainImage: {}", 
                facility.getFacilityName(), facility.getStatus(), facility.getFacilityImage());
        return facility;
    }

    /**
     * 전체 시설 목록 조회 서비스
     */
    public List<FacilityDTO> getAllFacilities() {
        try {
            log.info("전체 시설 목록 조회 시작");
            List<FacilityDTO> facilities = facilityMapper.getAllFacilities();
            log.info("전체 시설 목록 조회 완료 - 조회된 건수: {}", facilities.size());
            return facilities;
        } catch (Exception e) {
            log.error("전체 시설 목록 조회 중 오류 발생", e);
            throw new RuntimeException("시설 목록을 불러오는 중 오류가 발생했습니다.", e);
        }
    }

    /**
     * 시설 등록 서비스
     */
    public int insertFacility(FacilityDTO facilityDTO) {
        return facilityMapper.insertFacility(facilityDTO);
    }

    /**
     * 시설 정보 수정 서비스
     */
    public int updateFacility(FacilityDTO facilityDTO) {
        return facilityMapper.updateFacility(facilityDTO);
    }

    /**
     * 시설 삭제 서비스
     */
    public int deleteFacility(Long facilityId) {
        return facilityMapper.deleteFacility(facilityId);
    }

    /**
     * 지역별 시설 개수 조회 서비스
     */
    public int countFacilitiesByRegion(String region) {
        return facilityMapper.countFacilitiesByRegion(region);
    }

    /**
     * 전체 시설 수 조회 (통계용)
     */
    public int getFacilityCount() {
        try {
            return facilityMapper.getFacilityCount();
        } catch (Exception e) {
            // 에러 시 임시 데이터 개수 반환 (개발 초기 에러 방지)
            return 3; // 임시로 생성한 시설 수
        }
    }

    /**
     * 활성화된 모든 시설 목록 조회 (리뷰 작성용)
     */
    @Transactional(readOnly = true)
    public List<FacilityDTO> getAllActiveFacilities() {
        log.info("활성화된 시설 목록 조회 시작");
        List<FacilityDTO> facilities = facilityMapper.getAllActiveFacilities();
        
        if (!facilities.isEmpty()) {
            FacilityDTO firstFacility = facilities.get(0);
            log.info("첫 번째 시설 정보 - ID: {}, 이름: {}, 승인상태: {}", 
                    firstFacility.getFacilityId(), 
                    firstFacility.getFacilityName(),
                    firstFacility.getStatus());
        }
        
        log.info("활성화된 시설 목록 조회 완료 - 조회된 건수: {}", facilities.size());
        return facilities;
    }

    /**
     * 시설 상태 검증
     */
    public boolean validateFacilityStatus(FacilityDTO facility) {
        if (facility == null) {
            log.warn("시설 정보가 null입니다.");
            return false;
        }
        
        if (facility.isDeletedStatus()) {
            log.warn("삭제된 시설입니다 - facilityId: {}", facility.getFacilityId());
            return false;
        }
        
        if (facility.isPendingStatus()) {
            log.warn("승인되지 않은 시설입니다 - facilityId: {}", facility.getFacilityId());
            return false;
        }
        
        return true;
    }

    /**
     * 회원 ID로 시설 목록 조회
     */
    public List<FacilityDTO> getFacilitiesByMemberId(Long memberId) {
        try {
            log.info("회원의 시설 목록 조회 시작 - memberId: {}", memberId);
            List<FacilityDTO> facilities = facilityMapper.getFacilitiesByMemberId(memberId);
            
            if (!facilities.isEmpty()) {
                log.info("회원의 시설 목록 조회 완료 - memberId: {}, 시설 수: {}", 
                        memberId, facilities.size());
            } else {
                log.info("회원의 시설 정보 없음 - memberId: {}", memberId);
            }
            
            return facilities;
        } catch (Exception e) {
            log.error("회원의 시설 목록 조회 중 오류 발생 - memberId: {}", memberId, e);
            throw new RuntimeException("시설 정보 조회에 실패했습니다.", e);
        }
    }

    /**
     * 회원 ID로 시설 조회 (첫 번째 시설 반환)
     */
    public FacilityDTO getFacilityByMemberId(Long memberId) {
        try {
            log.info("회원의 첫 번째 시설 정보 조회 시작 - memberId: {}", memberId);
            List<FacilityDTO> facilities = facilityMapper.getFacilitiesByMemberId(memberId);
            
            if (!facilities.isEmpty()) {
                FacilityDTO facility = facilities.get(0);
                log.info("회원의 첫 번째 시설 정보 조회 완료 - memberId: {}, facilityId: {}, facilityName: {}", 
                        memberId, facility.getFacilityId(), facility.getFacilityName());
                return facility;
            } else {
                log.info("회원의 시설 정보 없음 - memberId: {}", memberId);
                return null;
            }
        } catch (Exception e) {
            log.error("회원의 시설 정보 조회 중 오류 발생 - memberId: {}", memberId, e);
            throw new RuntimeException("시설 정보 조회에 실패했습니다.", e);
        }
    }

    /**
     * 시설 정보 수정 (파일 업로드 포함)
     */
    @Transactional
    public void updateFacility(FacilityDTO facilityDTO, MultipartFile facilityImageFile) {
        try {
            log.info("시설 정보 수정 시작 - facilityId: {}, facilityName: {}", 
                    facilityDTO.getFacilityId(), facilityDTO.getFacilityName());
            
            // 시설 이미지 파일 처리
            if (facilityImageFile != null && !facilityImageFile.isEmpty()) {
                String imagePath = saveFacilityImage(facilityImageFile, facilityDTO.getFacilityId().toString());
                facilityDTO.setFacilityImage(imagePath);
                log.info("시설 이미지 업데이트 - facilityId: {}, imagePath: {}", 
                        facilityDTO.getFacilityId(), imagePath);
            }
            
            // 시설 정보 업데이트
            int result = facilityMapper.updateFacility(facilityDTO);
            if (result == 0) {
                throw new RuntimeException("시설 정보 수정에 실패했습니다.");
            }
            
            log.info("시설 정보 수정 완료 - facilityId: {}", facilityDTO.getFacilityId());
        } catch (Exception e) {
            log.error("시설 정보 수정 중 오류 발생 - facilityId: {}", facilityDTO.getFacilityId(), e);
            throw new RuntimeException("시설 정보 수정에 실패했습니다.", e);
        }
    }

    /**
     * 시설 이미지 저장 메서드
     */
    private String saveFacilityImage(MultipartFile file, String facilityId) {
        try {
            // 로컬 업로드 디렉토리 사용
            String uploadDir = Constants.FACILITY_UPLOAD_PATH;
            File uploadDirFile = new File(uploadDir);
            if (!uploadDirFile.exists()) {
                boolean created = uploadDirFile.mkdirs();
                log.info("업로드 디렉토리 생성: {} - {}", uploadDir, created ? "성공" : "실패");
            }
            
            // 파일명 생성 (facilityId + UUID + 원본 확장자)
            String originalFilename = file.getOriginalFilename();
            String extension = "";
            if (originalFilename != null && originalFilename.contains(".")) {
                extension = originalFilename.substring(originalFilename.lastIndexOf("."));
            }
            String savedFilename = "facility_" + facilityId + "_" + UUID.randomUUID().toString() + extension;
            
            // 파일 저장
            File savedFile = new File(uploadDir + savedFilename);
            file.transferTo(savedFile);
            log.info("시설 이미지 저장 완료: {}", savedFile.getAbsolutePath());
            
            // 웹 경로 반환
            return "/uploads/facility/" + savedFilename;
            
        } catch (IOException e) {
            log.error("시설 이미지 저장 중 오류 발생: facilityId={}", facilityId, e);
            throw new RuntimeException("이미지 파일 저장에 실패했습니다.", e);
        }
    }

    // ================== 관리자용 메서드들 ==================

    /**
     * 승인 상태별 시설 목록 조회 (관리자용)
     */
    @Transactional(readOnly = true)
    public List<FacilityDTO> getFacilitiesByApprovalStatus(String status) {
        try {
            log.info("승인 상태별 시설 목록 조회 - status: {}", status);
            List<FacilityDTO> facilities = facilityMapper.getFacilitiesByApprovalStatus(status);
            log.info("승인 상태별 시설 목록 조회 완료 - status: {}, count: {}", status, facilities.size());
            return facilities;
        } catch (Exception e) {
            log.error("승인 상태별 시설 목록 조회 중 오류 발생 - status: {}", status, e);
            throw new RuntimeException("시설 목록 조회에 실패했습니다.", e);
        }
    }

    /**
     * 시설 승인 상태 업데이트 (관리자용)
     */
    @Transactional
    public void updateFacilityApprovalStatus(Long facilityId, String newStatus, String reason) {
        try {
            log.info("시설 승인 상태 업데이트 - facilityId: {}, newStatus: {}, reason: {}", 
                    facilityId, newStatus, reason);
            
            int result = facilityMapper.updateFacilityApprovalStatus(facilityId, newStatus, reason);
            if (result == 0) {
                throw new RuntimeException("시설 승인 상태 업데이트에 실패했습니다.");
            }
            
            log.info("시설 승인 상태 업데이트 완료 - facilityId: {}, newStatus: {}", facilityId, newStatus);
        } catch (Exception e) {
            log.error("시설 승인 상태 업데이트 중 오류 발생 - facilityId: {}", facilityId, e);
            throw new RuntimeException("시설 승인 상태 업데이트에 실패했습니다.", e);
        }
    }

    /**
     * 승인 대기 중인 시설 수 조회
     */
    @Transactional(readOnly = true)
    public int countPendingFacilities() {
        try {
            int count = facilityMapper.countFacilitiesByStatus("PENDING");
            log.info("승인 대기 시설 수 조회 완료 - count: {}", count);
            return count;
        } catch (Exception e) {
            log.error("승인 대기 시설 수 조회 중 오류 발생", e);
            return 0;
        }
    }

    /**
     * 승인된 시설 수 조회
     */
    @Transactional(readOnly = true)
    public int countApprovedFacilities() {
        try {
            int count = facilityMapper.countFacilitiesByStatus("APPROVED");
            log.info("승인된 시설 수 조회 완료 - count: {}", count);
            return count;
        } catch (Exception e) {
            log.error("승인된 시설 수 조회 중 오류 발생", e);
            return 0;
        }
    }

    /**
     * 거부된 시설 수 조회
     */
    @Transactional(readOnly = true)
    public int countRejectedFacilities() {
        try {
            int count = facilityMapper.countFacilitiesByStatus("REJECTED");
            log.info("거부된 시설 수 조회 완료 - count: {}", count);
            return count;
        } catch (Exception e) {
            log.error("거부된 시설 수 조회 중 오류 발생", e);
            return 0;
        }
    }
}
````

## File: src/main/resources/templates/board/list.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title th:text="${pageTitle + ' - CareLink'}">게시판 목록 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
    <!-- 네비게이션 바 -->
    <nav th:replace="~{layout/header :: navbar}"></nav>
    
    <!-- 메시지 표시 -->
    <div th:replace="~{layout/header :: messages}"></div>

    <!-- 메인 콘텐츠 -->
    <main class="flex-grow-1">
        <div class="container py-4">
            <!-- 페이지 제목 (동적) -->
            <div class="row mb-4">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">홈</a></li>
                            <li class="breadcrumb-item"><a href="/board">정보마당</a></li>
                            <li class="breadcrumb-item active" aria-current="page" th:text="${boardTitle}">게시판</li>
                        </ol>
                    </nav>
                    <h2>
                        <i class="fas fa-clipboard-list text-primary me-2"></i> 
                        <span th:text="${boardTitle}">게시판</span>
                    </h2>
                    <p class="text-muted mb-3" th:text="${boardDescription}">게시판 설명</p>
                    
                    <!-- 게시판 타입 메뉴 (기존 방식 그대로 유지) -->
                    <div class="btn-group mb-3" role="group" aria-label="게시판 타입">
                        <a th:href="@{/board(type='all')}" 
                           class="btn btn-sm board-type-link"
                           th:classappend="${type == 'all'} ? 'btn-primary' : 'btn-outline-primary'">
                            전체
                        </a>
                        <a th:href="@{/board(type='notice')}" 
                           class="btn btn-sm board-type-link"
                           th:classappend="${type == 'notice'} ? 'btn-primary' : 'btn-outline-primary'">
                            공지사항
                        </a>
                        <a th:href="@{/board(type='info')}" 
                           class="btn btn-sm board-type-link"
                           th:classappend="${type == 'info'} ? 'btn-primary' : 'btn-outline-primary'">
                            정보공유
                        </a>
                        <a th:href="@{/board(type='qna')}" 
                           class="btn btn-sm board-type-link"
                           th:classappend="${type == 'qna'} ? 'btn-primary' : 'btn-outline-primary'">
                            Q&A
                        </a>
                        <a th:href="@{/board(type='faq')}" 
                           class="btn btn-sm board-type-link"
                           th:classappend="${type == 'faq'} ? 'btn-primary' : 'btn-outline-primary'">
                            FAQ
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- 검색 폼 (개선된 파라미터 처리) -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <form th:action="@{/board}" method="get" class="d-flex gap-2">
                        <input type="hidden" name="type" th:value="${type}">
                        <select name="category" class="form-select" style="width: auto;">
                            <option value="">전체 카테고리</option>
                            <option value="NOTICE" th:selected="${category == 'NOTICE'}">공지사항</option>
                            <option value="INFO" th:selected="${category == 'INFO'}">정보공유</option>
                            <option value="QNA" th:selected="${category == 'QNA'}">질문답변</option>
                            <option value="FAQ" th:selected="${category == 'FAQ'}">자주묻는질문</option>
                        </select>
                        <input type="text" name="keyword" class="form-control" th:value="${keyword}"
                               placeholder="검색어를 입력하세요">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search me-1"></i>검색
                        </button>
                    </form>
                </div>
                <div class="col-md-4 text-end">
                    <!-- 글쓰기 버튼 - 권한별 표시 -->
                    <!-- 공지사항과 FAQ는 관리자만 작성 가능 -->
                    <a th:if="${session.memberId != null and (type == 'notice' or type == 'faq') and session.loginMember?.role == 'ADMIN'}" 
                       th:href="@{/board/write(type=${type})}" 
                       class="btn btn-success">
                        <i class="fas fa-plus me-1"></i>글쓰기
                    </a>
                    
                    <!-- 정보공유는 모든 로그인 사용자 작성 가능 -->
                    <a th:if="${session.memberId != null and (type == 'info' or type == 'all')}" 
                       th:href="@{/board/write(type=${type == 'all' ? 'info' : type})}" 
                       class="btn btn-success">
                        <i class="fas fa-plus me-1"></i>글쓰기
                    </a>
                    
                    <!-- Q&A: 일반 사용자는 질문하기, 관리자는 답변하기 -->
                    <div th:if="${session.memberId != null and type == 'qna'}" class="btn-group">
                        <!-- 일반 사용자: 질문하기 -->
                        <a th:if="${session.loginMember?.role != 'ADMIN'}" 
                           th:href="@{/board/write(type=qna, qaType=QUESTION)}" 
                           class="btn btn-primary">
                            <i class="fas fa-question-circle me-1"></i>질문하기
                        </a>
                        
                        <!-- 관리자: 질문하기 + 답변하기 -->
                        <a th:if="${session.loginMember?.role == 'ADMIN'}" 
                           th:href="@{/board/write(type=qna, qaType=QUESTION)}" 
                           class="btn btn-primary">
                            <i class="fas fa-question-circle me-1"></i>질문하기
                        </a>
                        <a th:if="${session.loginMember?.role == 'ADMIN'}" 
                           th:href="@{/board/write(type=qna, qaType=ANSWER)}" 
                           class="btn btn-success">
                            <i class="fas fa-reply me-1"></i>답변하기
                        </a>
                    </div>
                    
                    <!-- 권한 없는 사용자에게 안내 메시지 -->
                    <span th:if="${session.memberId != null and (type == 'notice' or type == 'faq') and session.loginMember?.role != 'ADMIN'}" 
                          class="text-muted small">
                        <i class="fas fa-lock me-1"></i>관리자만 작성 가능
                    </span>
                    
                    <!-- 비로그인 사용자에게는 로그인 안내 -->
                    <a th:unless="${session.memberId != null}" 
                       href="/member/login" 
                       class="btn btn-outline-secondary">
                        <i class="fas fa-sign-in-alt me-1"></i>로그인 후 글쓰기
                    </a>
                </div>
            </div>

            <!-- 동적 로딩될 게시판 컨텐츠 컨테이너 -->
            <div id="boardContentContainer">
            <!-- 통계 정보 -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card bg-light">
                        <div class="card-body py-2">
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <small class="text-muted">전체 게시글</small>
                                    <strong class="d-block" th:text="${pageInfo.totalCount}">0</strong>
                                </div>
                                <div class="col-md-3">
                                    <small class="text-muted">현재 페이지</small>
                                    <strong class="d-block" th:text="${pageInfo.currentPage + '/' + pageInfo.totalPages}">1/1</strong>
                                </div>
                                <div class="col-md-3">
                                    <small class="text-muted">오늘 작성글</small>
                                    <strong class="d-block text-primary">0</strong>
                                </div>
                                <div class="col-md-3">
                                    <small class="text-muted">이번주 인기글</small>
                                    <strong class="d-block text-success" th:text="${#lists.size(popularBoards)}">0</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 인기 게시글 -->
            <div class="card mb-4" th:if="${not #lists.isEmpty(popularBoards)}">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-fire me-2"></i>인기 게시글
                        <small class="ms-2" th:if="${not #strings.isEmpty(category)}" 
                               th:text="'(' + ${category} + ' 카테고리)'">(카테고리)</small>
                    </h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <a th:each="board : ${popularBoards}"
                           th:href="@{/board/detail/{id}(id=${board.boardId}, type=${type})}"
                           class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1" th:text="${board.title}">게시글 제목</h6>
                                <small th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd')}">작성일</small>
                            </div>
                            <small class="text-muted">
                                <span th:text="${board.memberName}">작성자</span> |
                                조회 <span th:text="${board.viewCount ?: 0}">0</span> |
                                추천 <span th:text="${board.likeCount ?: 0}">0</span>
                            </small>
                        </a>
                    </div>
                </div>
            </div>

            <!-- 게시글 목록 -->
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-list me-2"></i>게시글 목록
                        <small class="text-muted ms-2">
                            (총 <span th:text="${pageInfo.totalCount}">0</span>개)
                        </small>
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-primary">
                            <tr>
                                <th width="80">번호</th>
                                <th width="100">분류</th>
                                <th>제목</th>
                                <th width="120">작성자</th>
                                <th width="100">작성일</th>
                                <th width="80">조회</th>
                                <th width="60">추천</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:if="${#lists.isEmpty(boardList)}">
                                <td colspan="7" class="text-center py-4 text-muted">
                                    <i class="fas fa-inbox fa-2x mb-2"></i><br>
                                    등록된 게시글이 없습니다.
                                </td>
                            </tr>
                            <tr th:each="board, iterStat : ${boardList}">
                                <td class="text-center">
                                    <span th:if="${board.isNotice != null and board.isNotice}" class="badge bg-danger">공지</span>
                                    <span th:unless="${board.isNotice != null and board.isNotice}" 
                                          th:text="${pageInfo.totalCount - ((pageInfo.currentPage - 1) * pageInfo.pageSize + iterStat.index)}">1</span>
                                </td>
                                <td class="text-center">
                                    <span th:if="${board.category == 'NOTICE'}" class="badge bg-danger">공지</span>
                                    <span th:if="${board.category == 'INFO'}" class="badge bg-primary">정보</span>
                                    <span th:if="${board.category == 'QNA' and board.qaType == 'QUESTION'}" class="badge bg-success">질문</span>
                                    <span th:if="${board.category == 'QNA' and board.qaType == 'ANSWER'}" class="badge bg-info">답변</span>
                                    <span th:if="${board.category == 'QNA' and #strings.isEmpty(board.qaType)}" class="badge bg-success">Q&A</span>
                                    <span th:if="${board.category == 'FAQ'}" class="badge bg-warning">FAQ</span>
                                    <span th:if="${#strings.isEmpty(board.category)}" class="badge bg-secondary">일반</span>
                                </td>
                                <td>
                                    <a th:href="@{/board/detail/{id}(id=${board.boardId}, type=${type}, page=${currentPage})}"
                                       th:text="${board.title}" class="text-decoration-none">게시글 제목</a>
                                    <span th:if="${board.commentCount != null and board.commentCount > 0}"
                                          class="badge bg-secondary ms-1" th:text="'[' + ${board.commentCount} + ']'">0</span>
                                    <span th:if="${board.isNew != null and board.isNew}" class="badge bg-danger ms-1">NEW</span>
                                    <span th:if="${board.isPinned != null and board.isPinned}" class="badge bg-info ms-1">고정</span>
                                    <!-- Q&A 답변 상태 표시 -->
                                    <span th:if="${board.category == 'QNA' and board.qaType == 'QUESTION' and board.isAnswered != null and board.isAnswered}" 
                                          class="badge bg-success ms-1">답변완료</span>
                                    <span th:if="${board.category == 'QNA' and board.qaType == 'QUESTION' and (board.isAnswered == null or !board.isAnswered)}" 
                                          class="badge bg-warning ms-1">답변대기</span>
                                    <span th:if="${board.category == 'QNA' and board.qaType == 'QUESTION' and board.answerCount != null and board.answerCount > 0}" 
                                          class="badge bg-primary ms-1" th:text="'답변 ' + ${board.answerCount} + '개'">답변 0개</span>
                                </td>
                                <td th:text="${board.memberName}">작성자</td>
                                <td th:text="${#temporals.format(board.createdAt, 'MM-dd')}">01-01</td>
                                <td class="text-center" th:text="${board.viewCount}">0</td>
                                <td class="text-center">
                                    <span th:if="${board.likeCount != null and board.likeCount > 0}" class="text-success" th:text="${board.likeCount}">0</span>
                                    <span th:unless="${board.likeCount != null and board.likeCount > 0}" class="text-muted">0</span>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- 완전한 페이징 (모든 파라미터 포함) -->
                    <nav th:if="${pageInfo.totalPages > 1}" aria-label="Page navigation" class="mt-3">
                        <ul class="pagination justify-content-center">
                            <!-- 처음 페이지 -->
                            <li class="page-item" th:classappend="${pageInfo.firstPage} ? 'disabled'">
                                <a class="page-link" 
                                   th:href="@{/board(page=1, keyword=${keyword}, category=${category}, type=${type})}"
                                   aria-label="First">
                                    <span aria-hidden="true">&laquo;&laquo;</span>
                                </a>
                            </li>
                            <!-- 이전 페이지 -->
                            <li class="page-item" th:classappend="${not pageInfo.hasPrevious} ? 'disabled'">
                                <a class="page-link"
                                   th:href="@{/board(page=${pageInfo.currentPage - 1}, keyword=${keyword}, category=${category}, type=${type})}"
                                   aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <!-- 페이지 번호 -->
                            <li class="page-item"
                                th:each="page : ${#numbers.sequence(pageInfo.startPage, pageInfo.endPage)}"
                                th:classappend="${page == pageInfo.currentPage} ? 'active'">
                                <a class="page-link"
                                   th:href="@{/board(page=${page}, keyword=${keyword}, category=${category}, type=${type})}"
                                   th:text="${page}">1</a>
                            </li>
                            <!-- 다음 페이지 -->
                            <li class="page-item" th:classappend="${not pageInfo.hasNext} ? 'disabled'">
                                <a class="page-link"
                                   th:href="@{/board(page=${pageInfo.currentPage + 1}, keyword=${keyword}, category=${category}, type=${type})}"
                                   aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                            <!-- 마지막 페이지 -->
                            <li class="page-item" th:classappend="${pageInfo.lastPage} ? 'disabled'">
                                <a class="page-link"
                                   th:href="@{/board(page=${pageInfo.totalPages}, keyword=${keyword}, category=${category}, type=${type})}"
                                   aria-label="Last">
                                    <span aria-hidden="true">&raquo;&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
            </div> <!-- boardContentContainer 끝 -->
        </div>
    </main>

    <!-- 푸터 -->
    <footer th:replace="~{layout/footer :: footer}"></footer>
    
    <!-- JavaScript -->
    <div th:replace="~{layout/footer :: scripts}"></div>
    
    <!-- 게시판 네비게이션 공통 스크립트 -->
    <script src="/js/board-navigation.js"></script>
</body>
</html>
````

## File: src/main/resources/templates/facility/edit.html
````html
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/header :: header}">
    <title>시설 정보 수정 - 라이트케어</title>
    <!-- 시설 정보 메타 태그 (JavaScript에서 사용) -->
    <meta name="facility-id" th:content="${facility?.facilityId ?: ''}">
    <meta name="facility-name" th:content="${facility?.facilityName ?: '시설'}">
</head>

<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="container my-4">
    <!-- 브레드크럼 -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">홈</a></li>
            <li class="breadcrumb-item"><a href="/facility/search">시설 찾기</a></li>
            <li class="breadcrumb-item"><a href="/facility/manage">내 시설 관리</a></li>
            <li class="breadcrumb-item active" aria-current="page">시설 정보 수정</li>
        </ol>
    </nav>
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-edit me-2"></i>시설 정보 수정
                    </h3>
                </div>
                <div class="card-body">
                    <form id="facilityEditForm" th:action="@{/facility/edit/{id}(id=${facility.facilityId})}" 
                          method="post" enctype="multipart/form-data" th:object="${facility}">
                        
                        <!-- 시설명 -->
                        <div class="mb-3">
                            <label for="facilityName" class="form-label">
                                <i class="fas fa-building me-1"></i>시설명 <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="facilityName" th:field="*{facilityName}"
                                   placeholder="시설명을 입력하세요" required>
                        </div>

                        <!-- 시설 유형 -->
                        <div class="mb-3">
                            <label for="facilityType" class="form-label">
                                <i class="fas fa-tag me-1"></i>시설 유형 <span class="text-danger">*</span>
                            </label>
                            <select class="form-select" id="facilityType" th:field="*{facilityType}" required>
                                <option value="">시설 유형을 선택하세요</option>
                                <option value="NURSING_HOME">요양원</option>
                                <option value="HOSPITAL">요양병원</option>
                                <option value="DAY_CARE">데이케어센터</option>
                            </select>
                        </div>

                        <!-- 주소 -->
                        <div class="mb-3">
                            <label for="facilityAddress" class="form-label">
                                <i class="fas fa-map-marker-alt me-1"></i>주소 <span class="text-danger">*</span>
                            </label>
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" id="facilityAddress" th:field="*{address}"
                                       placeholder="주소 검색 버튼을 클릭하세요" readonly required>
                                <button type="button" class="btn btn-outline-primary" onclick="searchFacilityAddress()">
                                    <i class="fas fa-search me-1"></i>주소 검색
                                </button>
                            </div>
                            <input type="text" class="form-control" id="detailAddress" th:field="*{detailAddress}"
                                   placeholder="상세 주소를 입력하세요 (예: 101호, 2층)">
                            <!-- 위도/경도 히든 필드 -->
                            <input type="hidden" id="latitude" th:field="*{latitude}">
                            <input type="hidden" id="longitude" th:field="*{longitude}">
                        </div>
                        
                        <!-- 위치 미리보기 지도 -->
                        <div class="mb-3" id="mapPreviewContainer" style="display: none;">
                            <label class="form-label">
                                <i class="fas fa-map me-1"></i>위치 미리보기
                            </label>
                            <div id="previewMap" style="width:100%; height:200px; border-radius: 8px; border: 1px solid #dee2e6;"></div>
                            <small class="form-text text-muted">선택된 주소의 위치가 지도에 표시됩니다.</small>
                        </div>

                        <!-- 시설 전화번호 -->
                        <div class="mb-3">
                            <label for="phone" class="form-label">
                                <i class="fas fa-phone me-1"></i>시설 전화번호 <span class="text-danger">*</span>
                            </label>
                            <input type="tel" class="form-control" id="phone" th:field="*{phone}"
                                   placeholder="전화번호를 입력하세요 (지역번호에 맞게 자동 포맷팅)" required>
                            <small class="form-text text-muted">
                                <strong>지역번호 예시:</strong> 
                                서울(02), 부산(051), 대구(053), 인천(032), 광주(062), 대전(042), 울산(052) 등<br>
                                <strong>형식:</strong> 042는 3-3-4, 02는 2-3-4 또는 2-4-4 형식으로 자동 적용됩니다
                            </small>
                        </div>

                        <!-- 현재 시설 이미지 (있는 경우) -->
                        <div class="mb-3" th:if="${facility.facilityImage}">
                            <label class="form-label">
                                <i class="fas fa-image me-1"></i>현재 시설 사진
                            </label>
                            <div class="current-image-container mb-3" style="position: relative; display: inline-block;">
                                <img th:src="@{${facility.facilityImage}}" alt="현재 시설 사진" 
                                     style="max-width: 300px; max-height: 200px; border-radius: 12px; border: 2px solid #dee2e6; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                                <div class="current-image-overlay" style="position: absolute; top: 8px; right: 8px;">
                                    <span class="badge bg-primary">현재 이미지</span>
                                </div>
                            </div>
                        </div>

                        <!-- 시설 이미지 관리 -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-images me-1"></i>시설 사진 관리
                                <span th:if="${facility.facilityImage == null}" class="text-danger">*</span>
                            </label>
                            
                            <!-- 고급 이미지 압축 및 최적화 시스템 -->
                            <div class="image-management-section">
                                <div class="card border-success mb-3">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center mb-3">
                                            <i class="fas fa-compress-alt fa-2x text-success me-3"></i>
                                            <div>
                                                <h6 class="card-title mb-1">고성능 이미지 압축 시스템</h6>
                                                <p class="card-text text-muted small mb-0">
                                                    AVIF/WebP 압축으로 최대 80% 용량 절약 | 16:9 비율 최적화 | 최대 5장 등록
                                                </p>
                                            </div>
                                        </div>
                                        
                                        <!-- 1단계: 이미지 선택 -->
                                        <div id="uploadSection" class="upload-section">
                                            <!-- 파일 선택 영역 -->
                                            <div class="file-selection-area">
                                                <!-- 드래그앤드롭 영역 및 파일 선택 -->
                                                <div id="dropZone" class="drop-zone" style="
                                                    border: 2px dashed #dee2e6;
                                                    border-radius: 8px;
                                                    padding: 2rem;
                                                    text-align: center;
                                                    background-color: #f8f9fa;
                                                    transition: all 0.3s ease;
                                                ">
                                                    <div class="drop-zone-content">
                                                        <i class="fas fa-cloud-upload-alt fa-2x text-muted mb-3"></i>
                                                        <button type="button" id="mainFileSelectBtn" class="btn btn-primary btn-lg px-4 py-2 mb-3" style="display: none;">
                                                            <i class="fas fa-folder-open me-2"></i>파일 선택
                                                        </button>
                                                        <p class="text-muted mb-2">여기에 파일을 드래그하세요</p>
                                                        <small class="text-muted">JPG, PNG, WebP 지원 (최대 10MB, 5개 파일)</small>
                                                        <div class="mt-3">
                                                            <div class="d-flex justify-content-center align-items-center gap-3 flex-wrap">
                                                                <small class="text-success d-flex align-items-center">
                                                                    <i class="fas fa-chart-line me-1"></i>실시간 압축률 표시
                                                                </small>
                                                                <small class="text-success d-flex align-items-center">
                                                                    <i class="fas fa-tachometer-alt me-1"></i>최적화된 로딩 속도
                                                                </small>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <input type="file" id="imageInput" multiple accept="image/*" style="display: none;">
                                            </div>
                                            
                                            <!-- 추가 CSS 스타일 -->
                                            <style>
                                                /* 메인 파일 선택 버튼 스타일 */
                                                #mainFileSelectBtn {
                                                    transition: all 0.3s ease;
                                                    box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
                                                    pointer-events: auto;
                                                    position: relative;
                                                    z-index: 10;
                                                }
                                                
                                                #mainFileSelectBtn:hover {
                                                    transform: translateY(-1px);
                                                    box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
                                                }
                                                
                                                #mainFileSelectBtn:active {
                                                    transform: translateY(0);
                                                    box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
                                                }
                                                
                                                /* 드래그앤드롭 영역 스타일 */
                                                .drop-zone {
                                                    cursor: pointer;
                                                }
                                                
                                                .drop-zone:hover {
                                                    border-color: #007bff;
                                                    background-color: #f0f8ff;
                                                }
                                                
                                                .drop-zone:hover {
                                                    background-color: #e9ecef !important;
                                                    border-color: #28a745 !important;
                                                }
                                                
                                                .drop-zone.dragover {
                                                    background-color: #d4edda !important;
                                                    border-color: #28a745 !important;
                                                    border-style: solid !important;
                                                }
                                                
                                                /* 이미지 미리보기 스타일 */
                                                .image-preview-item {
                                                    transition: transform 0.3s ease;
                                                }
                                                
                                                .image-preview-item:hover {
                                                    transform: scale(1.05);
                                                }
                                                
                                                .image-preview-item.dragging {
                                                    opacity: 0.5;
                                                    transform: rotate(5deg);
                                                }
                                                
                                                .set-main-image:hover {
                                                    background-color: #ffc107 !important;
                                                    transform: scale(1.1);
                                                }
                                            </style>
                                            
                                            <!-- 선택된 이미지 미리보기 컨테이너 (메인 컨트롤러가 동적 생성) -->
                                            <!-- 중복 제거: 메인 컨트롤러가 selectedImagesPreview 컨테이너를 동적으로 생성하여 -->
                                            <!-- 순서 변경과 메인 이미지 지정 기능을 통합한 단일 목록을 제공합니다 -->
                                        </div>
                                        
                                        <!-- 1.5단계: 압축 진행 상황 표시 (새로 추가) -->
                                        <div id="compressionProgress" class="compression-progress-section" style="display: none;">
                                            <div class="card border-info mb-3">
                                                <div class="card-header bg-info text-white">
                                                    <h6 class="mb-0">
                                                        <i class="fas fa-compress me-2"></i>파일 압축 진행 중
                                                    </h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="progress mb-3" style="height: 20px;">
                                                        <div id="compressionProgressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-info" 
                                                             role="progressbar" style="width: 0%"></div>
                                                    </div>
                                                    <div id="compressionStatus" class="text-center text-muted">
                                                        <i class="fas fa-compress fa-spin me-2"></i>압축 준비 중...
                                                    </div>
                                                    <div id="compressionStats" class="mt-3 text-center" style="display: none;">
                                                        <small class="text-success">
                                                            <i class="fas fa-check-circle me-1"></i>
                                                            <span id="compressionResult"></span>
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- 2단계: 크롭 및 압축 (새창 방식 사용으로 비활성화) -->
                                        <div id="cropSection" class="crop-section" style="display: none !important;">
                                            <div class="compression-header mb-3">
                                                <h6 class="text-success">
                                                    <i class="fas fa-crop-alt me-2"></i>이미지 크롭 및 고성능 압축
                                                </h6>
                                                <div class="compression-progress">
                                                    <small class="text-muted">현재 이미지: <span id="currentImageInfo">1 / 1</span></small>
                                                </div>
                                            </div>
                                            
                                            <!-- 크롭 영역 -->
                                            <div id="cropContainer" class="crop-container mb-3">
                                                <div class="crop-image-container" style="min-height: 400px; background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px;">
                                                    <img id="cropImage" style="max-width: 100%; height: auto; display: block;">
                                                    <canvas id="cropCanvas" style="display: none;"></canvas>
                                                    
                                                    <!-- 로딩 인디케이터 -->
                                                    <div id="cropLoading" class="text-center py-5" style="display: none;">
                                                        <div class="spinner-border text-primary" role="status">
                                                            <span class="visually-hidden">크롭 준비 중...</span>
                                                        </div>
                                                        <p class="text-muted mt-2">이미지 크롭 준비 중...</p>
                                                    </div>
                                                    
                                                    <!-- 오류 메시지 -->
                                                    <div id="cropError" class="alert alert-warning text-center" style="display: none;">
                                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                                        <strong>크롭 기능을 사용할 수 없습니다.</strong><br>
                                                        <small>이미지는 원본 그대로 사용됩니다.</small>
                                                        <div class="mt-2">
                                                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="initializeCropperForce()">
                                                                <i class="fas fa-retry me-1"></i>크롭 기능 다시 시도
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- 크롭 컨트롤 -->
                                            <div id="cropControls" class="crop-controls mb-3">
                                                <div class="row">
                                                    <div class="col-md-8">
                                                        <div class="crop-navigation d-flex align-items-center">
                                                            <button type="button" id="prevImage" class="btn btn-sm btn-outline-secondary me-2">
                                                                <i class="fas fa-chevron-left"></i>
                                                            </button>
                                                            <button type="button" id="nextImage" class="btn btn-sm btn-outline-secondary me-3">
                                                                <i class="fas fa-chevron-right"></i>
                                                            </button>
                                                            <button type="button" id="resetCrop" class="btn btn-sm btn-outline-warning me-2">
                                                                <i class="fas fa-undo me-1"></i>리셋
                                                            </button>
                                                            <button type="button" id="autoFit" class="btn btn-sm btn-outline-info">
                                                                <i class="fas fa-expand-arrows-alt me-1"></i>16:9 자동맞춤
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4 text-end">
                                                        <button type="button" id="skipCrop" class="btn btn-outline-secondary me-2">
                                                            <i class="fas fa-forward me-1"></i>크롭 건너뛰기
                                                        </button>
                                                        <button type="button" id="completeImageProcessing" class="btn btn-success">
                                                            <i class="fas fa-save me-1"></i>압축 완료
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- 고급 압축 설정 -->
                                            <div id="compressionSettings" class="compression-settings border-top pt-3">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <h6 class="text-success mb-3">
                                                            <i class="fas fa-sliders-h me-2"></i>압축 최적화 설정
                                                        </h6>
                                                        <div class="mb-3">
                                                            <label for="compressionQuality" class="form-label">압축 품질</label>
                                                            <div class="d-flex align-items-center">
                                                                <input type="range" class="form-range flex-grow-1" id="compressionQuality" min="60" max="100" value="85">
                                                                <span class="badge bg-success ms-2" id="qualityValue">85%</span>
                                                            </div>
                                                            <small class="text-muted">품질이 높을수록 용량이 커집니다</small>
                                                        </div>
                                                        
                                                        <div class="mb-3">
                                                            <label class="form-label">압축 형식</label>
                                                            <div class="btn-group w-100" role="group">
                                                                <input type="radio" class="btn-check" name="compressionFormat" id="formatWebP" value="webp" checked>
                                                                <label class="btn btn-outline-success" for="formatWebP">WebP</label>
                                                                
                                                                <input type="radio" class="btn-check" name="compressionFormat" id="formatAVIF" value="avif">
                                                                <label class="btn btn-outline-success" for="formatAVIF">AVIF</label>
                                                                
                                                                <input type="radio" class="btn-check" name="compressionFormat" id="formatJPEG" value="jpeg">
                                                                <label class="btn btn-outline-success" for="formatJPEG">JPEG</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="col-md-6">
                                                        <h6 class="text-info mb-3">
                                                            <i class="fas fa-chart-bar me-2"></i>압축 효과 분석
                                                        </h6>
                                                        <div class="compression-stats-detailed">
                                                            <div class="stat-item mb-2">
                                                                <div class="d-flex justify-content-between">
                                                                    <span>원본 크기:</span>
                                                                    <strong id="originalSize">-</strong>
                                                                </div>
                                                            </div>
                                                            <div class="stat-item mb-2">
                                                                <div class="d-flex justify-content-between">
                                                                    <span>압축 후:</span>
                                                                    <strong class="text-success" id="compressedSize">-</strong>
                                                                </div>
                                                            </div>
                                                            <div class="stat-item mb-2">
                                                                <div class="d-flex justify-content-between">
                                                                    <span>절약량:</span>
                                                                    <strong class="text-warning" id="savedSize">-</strong>
                                                                </div>
                                                            </div>
                                                            <div class="stat-item mb-3">
                                                                <div class="d-flex justify-content-between">
                                                                    <span>압축률:</span>
                                                                    <strong class="text-primary" id="compressionRatio">-</strong>
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="data-cost-savings">
                                                                <div class="alert alert-success py-2">
                                                                    <small>
                                                                        <i class="fas fa-wifi me-1"></i>
                                                                        <strong>데이터 비용 절약:</strong><br>
                                                                        월 약 <span id="monthlySavings" class="text-success">0원</span> 절약 예상
                                                                    </small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- SEO 최적화 -->
                                            <div id="seoSettings" class="seo-settings border-top pt-3 mt-3">
                                                <h6 class="text-primary mb-3">
                                                    <i class="fas fa-search me-2"></i>SEO 검색 최적화
                                                </h6>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <label for="altText" class="form-label">Alt 텍스트 (웹접근성)</label>
                                                        <input type="text" class="form-control" id="altText" placeholder="이미지 설명을 입력하세요">
                                                        <small class="text-muted">시각 장애인을 위한 설명</small>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="englishFilename" class="form-label">영문 파일명 (자동생성)</label>
                                                        <input type="text" class="form-control" id="englishFilename" placeholder="자동 생성됨" readonly>
                                                        <small class="text-muted">검색엔진 최적화용</small>
                                                    </div>
                                                </div>
                                                <div class="mt-3">
                                                    <label class="form-label">키워드 태그</label>
                                                    <div id="keywordList" class="keyword-list">
                                                        <span class="badge bg-primary me-1 mb-1" onclick="selectKeyword('요양원')" style="cursor: pointer;">요양원</span>
                                                        <span class="badge bg-primary me-1 mb-1" onclick="selectKeyword('시설')" style="cursor: pointer;">시설</span>
                                                        <span class="badge bg-primary me-1 mb-1" onclick="selectKeyword('내부')" style="cursor: pointer;">내부</span>
                                                        <span class="badge bg-primary me-1 mb-1" onclick="selectKeyword('외관')" style="cursor: pointer;">외관</span>
                                                        <span class="badge bg-primary me-1 mb-1" onclick="selectKeyword('깨끗한')" style="cursor: pointer;">깨끗한</span>
                                                        <span class="badge bg-primary me-1 mb-1" onclick="selectKeyword('현대적')" style="cursor: pointer;">현대적</span>
                                                        <span class="badge bg-primary me-1 mb-1" onclick="selectKeyword('밝은')" style="cursor: pointer;">밝은</span>
                                                        <span class="badge bg-primary me-1 mb-1" onclick="selectKeyword('쾌적한')" style="cursor: pointer;">쾌적한</span>
                                                    </div>
                                                    <small class="text-muted">클릭하여 키워드를 선택하면 파일명에 자동 반영됩니다</small>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- 3단계: 최종 업로드 관리 -->
                                        <div id="manageSection" class="manage-section" style="display: none;">
                                            <div class="final-upload-header mb-3">
                                                <h6 class="text-success">
                                                    <i class="fas fa-check-circle me-2"></i>압축 완료 - 업로드 준비
                                                </h6>
                                            </div>
                                            <div id="finalImageList" class="final-image-list">
                                                <!-- 최종 압축된 이미지들이 여기에 표시됨 -->
                                            </div>
                                            <div class="mt-3">
                                                <button type="button" id="uploadOptimizedImages" class="btn btn-success btn-lg">
                                                    <i class="fas fa-cloud-upload-alt me-2"></i>최적화된 이미지 업로드
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Alt 텍스트 입력 (SEO용) -->
                            <input type="hidden" id="facilityImageAltText" name="facilityImageAltText" 
                                   th:value="${facility.facilityImageAltText}">
                            
                            <!-- 저장된 이미지 목록 (크롭 페이지에서 돌아온 경우 표시) -->
                            <div id="savedImagesSection" class="saved-images-section mt-3" style="display: none;">
                                <div class="card border-success">
                                    <div class="card-header bg-success text-white d-flex align-items-center">
                                        <i class="fas fa-check-circle me-2"></i>
                                        <h6 class="mb-0">저장된 이미지 목록</h6>
                                        <span class="badge bg-light text-success ms-auto" id="savedImageCount">0개</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3" id="savedImagesGrid">
                                            <!-- 저장된 이미지 카드들이 여기에 동적으로 생성됩니다 -->
                                        </div>
                                        <div class="mt-3 text-center">
                                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="openImageCropPage()">
                                                <i class="fas fa-plus me-2"></i>이미지 추가/편집
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 수용 인원 -->
                        <div class="mb-3">
                            <label for="capacity" class="form-label">
                                <i class="fas fa-users me-1"></i>수용 인원
                            </label>
                            <input type="number" class="form-control" id="capacity" th:field="*{capacity}"
                                   placeholder="수용 가능 인원을 입력하세요" min="1">
                        </div>

                        <!-- 운영 시간 -->
                        <div class="mb-3">
                            <label for="operatingHours" class="form-label">
                                <i class="fas fa-clock me-1"></i>운영 시간
                            </label>
                            <div class="row g-2">
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operatingType" id="operating24" 
                                               value="24시간" th:checked="${facility.operatingHours == '24시간'}">
                                        <label class="form-check-label fw-bold text-success" for="operating24">
                                            <i class="fas fa-clock me-1"></i>24시간 운영
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operatingType" id="operatingCustom" 
                                               value="custom" th:checked="${facility.operatingHours != '24시간' && facility.operatingHours != null}">
                                        <label class="form-check-label" for="operatingCustom">
                                            <i class="fas fa-clock me-1"></i>시간 직접 설정
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operatingType" id="operatingWeekly" value="weekly">
                                        <label class="form-check-label" for="operatingWeekly">
                                            <i class="fas fa-calendar-week me-1"></i>요일별 시간 설정
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 간단한 시간 설정 -->
                            <div id="simpleTimeContainer" class="mt-3" style="display: none;">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title mb-3">운영 시간 설정</h6>
                                        <div class="row g-2">
                                            <div class="col-md-6">
                                                <label class="form-label small">시작 시간</label>
                                                <select class="form-select" id="startHour">
                                                    <option value="">시</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label small">종료 시간</label>
                                                <select class="form-select" id="endHour">
                                                    <option value="">시</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle me-1"></i>
                                                매일 동일한 시간으로 설정됩니다
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 요일별 시간 설정 -->
                            <div id="weeklyTimeContainer" class="mt-3" style="display: none;">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title mb-3">요일별 운영 시간</h6>
                                        <div id="weeklySchedule">
                                            <!-- JavaScript로 동적 생성 -->
                                        </div>
                                        
                                        <div class="mt-3">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle me-1"></i>
                                                운영하지 않는 요일은 체크를 해제하세요
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 직접 입력 -->
                            <div id="customTimeContainer" class="mt-3" style="display: none;">
                                <input type="text" class="form-control" id="customOperatingHours" 
                                       placeholder="예: 09:00-18:00, 평일 09:00-18:00 주말 10:00-16:00"
                                       th:value="${facility.operatingHours != '24시간' ? facility.operatingHours : ''}">
                                <small class="form-text text-muted">
                                    자유 형식으로 운영 시간을 입력하세요
                                </small>
                            </div>
                            
                            <input type="hidden" id="operatingHours" th:field="*{operatingHours}">
                        </div>

                        <!-- 홈페이지 -->
                        <div class="mb-3">
                            <label for="homepage" class="form-label">
                                <i class="fas fa-globe me-1"></i>홈페이지 URL
                            </label>
                            <input type="url" class="form-control" id="homepage" th:field="*{homepage}"
                                   placeholder="https://www.example.com">
                        </div>

                        <!-- 시설 설명 -->
                        <div class="mb-3">
                            <label for="description" class="form-label">
                                <i class="fas fa-info-circle me-1"></i>시설 설명
                            </label>
                            <textarea class="form-control" id="description" th:field="*{description}" rows="4"
                                      placeholder="시설에 대한 설명을 입력하세요"
                                      data-rich-editor='{"height": "250px", "enableTable": false, "enableLink": true}'></textarea>
                        </div>

                        <!-- 시설 특징 -->
                        <div class="mb-3">
                            <label for="features" class="form-label">
                                <i class="fas fa-star me-1"></i>시설 특징
                            </label>
                            <input type="text" class="form-control" id="features" th:field="*{features}"
                                   placeholder="시설의 주요 특징을 쉼표로 구분하여 입력하세요 (예: 24시간 간병서비스, 물리치료실, 카페)">
                            <small class="form-text text-muted">쉼표(,)로 구분하여 여러 특징을 입력할 수 있습니다</small>
                        </div>

                        <!-- 버튼 -->
                        <div class="d-flex gap-2 justify-content-end">
                            <a th:href="@{/facility/manage}" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>취소
                            </a>
                            <button type="submit" class="btn btn-primary" id="submitButton">
                                <i class="fas fa-save me-2"></i>수정 완료
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 카카오 주소 검색 API -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<!-- 카카오맵 API (좌표 변환용) -->
<script type="text/javascript" th:src="@{//dapi.kakao.com/v2/maps/sdk.js(appkey=${KAKAO_APP_KEY}, libraries='services')}"></script>
<!-- 카카오맵 유틸리티 -->
<script src="/js/kakaomap.js"></script>
<script src="/js/facility-edit.js"></script>

<!-- 전화번호 포맷터 -->
<script src="/js/phone-formatter.js"></script>

<!-- 모듈화된 시설 이미지 시스템 CSS -->
<link th:href="@{/css/facility-image-uploader.css}" rel="stylesheet">
<link th:href="@{/css/image-compressor.css}" rel="stylesheet">
<link th:href="@{/css/advanced-image-cropper.css}" rel="stylesheet">

<!-- 스마트 스크롤 유틸리티 -->
<script th:src="@{/js/smart-scroll-utility.js}"></script>

<!-- 시설 이미지 모듈 시스템 -->
<script th:src="@{/js/facility-image-core.js}"></script>
<script th:src="@{/js/facility-image-utils-module.js}"></script>
<script th:src="@{/js/facility-image-ui-module.js}"></script>
<script th:src="@{/js/facility-image-upload-module.js}"></script>
<script th:src="@{/js/facility-image-cropper-module.js}"></script>
<script th:src="@{/js/facility-image-data-module.js}"></script>
<script th:src="@{/js/facility-image-seo-module.js}"></script>
<script th:src="@{/js/facility-image-main-controller.js}"></script>

<!-- 리치 텍스트 에디터는 header.html에서 전역으로 로드됨 -->

<script>
$(document).ready(function() {
    console.log('Initializing operating hours...');
    
    // 시간 옵션 동적 생성
    initializeTimeOptions();
    
    // 요일별 스케줄 미리 생성
    generateWeeklySchedule();
    
    // 직접 입력 변경 이벤트
    $('#customOperatingHours').on('input', function() {
        updateOperatingHours();
    });
    
    // 초기 상태 설정
    initializeOperatingHours();
});

function initializeTimeOptions() {
    // 시작 시간 옵션 생성
    for (let i = 0; i <= 23; i++) {
        const hour = String(i).padStart(2, '0');
        $('#startHour').append(`<option value="${hour}">${hour}시</option>`);
        $('#endHour').append(`<option value="${hour}">${hour}시</option>`);
    }
}

function generateWeeklySchedule() {
    console.log('Generating weekly schedule...');
    const days = ['월요일', '화요일', '수요일', '목요일', '금요일', '토요일', '일요일'];
    let html = '';
    
    days.forEach((day, index) => {
        html += `
            <div class="row g-2 mb-2">
                <div class="col-3">
                    <div class="form-check">
                        <input class="form-check-input day-check" type="checkbox" id="day${index}" checked>
                        <label class="form-check-label" for="day${index}">${day}</label>
                    </div>
                </div>
                <div class="col-9 time-controls">
                    <div class="d-flex align-items-center gap-2">
                        <select class="form-select form-select-sm day-start" id="start${index}" style="width: 80px;">
                            <option value="">시작</option>
                        </select>
                        <span>시 ~</span>
                        <select class="form-select form-select-sm day-end" id="end${index}" style="width: 80px;">
                            <option value="">종료</option>
                        </select>
                        <span>시</span>
                    </div>
                    <div class="rest-day-notice text-muted small mt-1" style="display: none;">
                        <i class="fas fa-moon me-1"></i>휴무일
                    </div>
                </div>
            </div>
        `;
    });
    
    $('#weeklySchedule').html(html);
    
    // 시간 옵션 추가
    for (let i = 0; i <= 23; i++) {
        const hour = String(i).padStart(2, '0');
        days.forEach((day, index) => {
            $(`#start${index}`).append(`<option value="${hour}">${hour}</option>`);
            $(`#end${index}`).append(`<option value="${hour}">${hour}</option>`);
        });
    }
    
    // 이벤트 리스너 추가
    setTimeout(function() {
        $('.day-check').off('change').on('change', function() {
            const index = $(this).attr('id').replace('day', '');
            const timeControls = $(this).closest('.row').find('.time-controls');
            const restNotice = timeControls.find('.rest-day-notice');
            const selects = timeControls.find('select');
            
            if ($(this).is(':checked')) {
                selects.show();
                timeControls.find('span').show();
                restNotice.hide();
            } else {
                selects.hide();
                timeControls.find('span').hide();
                restNotice.show();
            }
            
            updateOperatingHours();
        });
        
        $('.day-start, .day-end').off('change').on('change', function() {
            updateOperatingHours();
        });
        
        // 간단한 시간 설정 이벤트도 여기서 등록
        $('#startHour, #endHour').off('change').on('change', function() {
            updateOperatingHours();
        });
    }, 100);
}

function initializeOperatingHours() {
    const currentHours = $('#operatingHours').val();
    
    if (currentHours === '24시간') {
        $('#operating24').prop('checked', true);
    } else if (currentHours && currentHours !== '') {
        $('#operatingCustom').prop('checked', true);
        $('#customTimeContainer').show();
        $('#customOperatingHours').val(currentHours);
    }
}

function updateOperatingHours() {
    const operatingType = $('input[name="operatingType"]:checked').val();
    let operatingHours = '';
    
    if (operatingType === '24시간') {
        operatingHours = '24시간';
    } else if (operatingType === 'simple') {
        const startHour = $('#startHour').val();
        const endHour = $('#endHour').val();
        
        if (startHour && endHour) {
            operatingHours = `${startHour}:00-${endHour}:00`;
        }
    } else if (operatingType === 'weekly') {
        const weeklyHours = [];
        const days = ['월', '화', '수', '목', '금', '토', '일'];
        
        $('.day-check').each(function(index) {
            if ($(this).is(':checked')) {
                const startHour = $(`#start${index}`).val();
                const endHour = $(`#end${index}`).val();
                
                if (startHour && endHour) {
                    weeklyHours.push(`${days[index]} ${startHour}:00-${endHour}:00`);
                }
            } else {
                weeklyHours.push(`${days[index]} 휴무`);
            }
        });
        
        operatingHours = weeklyHours.join(', ');
    } else if (operatingType === 'custom') {
        operatingHours = $('#customOperatingHours').val();
    }
    
    $('#operatingHours').val(operatingHours);
}


// 간단한 시간 설정 라디오 버튼 동적 추가
$(document).ready(function() {
    const simpleOption = `
        <div class="col-12">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="operatingType" id="operatingSimple" value="simple">
                <label class="form-check-label" for="operatingSimple">
                    <i class="fas fa-clock me-1"></i>간단한 시간 설정
                </label>
            </div>
        </div>
    `;
    
    $('#operatingCustom').closest('.col-12').after(simpleOption);
    
    // 이벤트 리스너 다시 등록
    setTimeout(function() {
        $('input[name="operatingType"]').off('change').on('change', function() {
            const value = $(this).val();
            console.log('Operating type changed:', value);
            
            // 모든 컨테이너 숨기기
            $('#simpleTimeContainer, #weeklyTimeContainer, #customTimeContainer').hide();
            
            if (value === 'custom') {
                $('#customTimeContainer').show();
            } else if (value === 'weekly') {
                $('#weeklyTimeContainer').show();
                generateWeeklySchedule();
            } else if (value === 'simple') {
                $('#simpleTimeContainer').show();
            }
            
            updateOperatingHours();
        });
    }, 100);
    
    // 모듈화된 시설 이미지 시스템 초기화 (리치 텍스트 에디터 이후)
    // 여러 단계로 안전하게 초기화
    
    // 전역 초기화 방지 플래그 체크
    if (window.facilityImageSystemInitialized) {
        console.log('⚠️ 이미지 시스템이 이미 초기화되어 있습니다. 중복 실행을 방지합니다.');
        return;
    }
    
    let initAttempts = 0;
    const maxInitAttempts = 3;
    
    function attemptImageSystemInit() {
        initAttempts++;
        
        try {
            console.log(`🔄 이미지 시스템 초기화 시도 ${initAttempts}/${maxInitAttempts}`);
            
            // DOM이 완전히 로드되었는지 확인
            if (document.readyState !== 'complete') {
                console.log('⏳ DOM 로딩 대기 중...');
                setTimeout(attemptImageSystemInit, 200);
                return;
            }
            
            // 필수 DOM 요소 확인
            const requiredElements = {
                dropZone: document.getElementById('dropZone'),
                imageInput: document.getElementById('imageInput'),
                uploadSection: document.getElementById('uploadSection')
            };
            
            const missingElements = Object.entries(requiredElements)
                .filter(([key, element]) => !element)
                .map(([key]) => key);
            
            if (missingElements.length > 0) {
                console.warn('⚠️ 필수 DOM 요소가 없습니다:', missingElements);
                if (initAttempts < maxInitAttempts) {
                    setTimeout(attemptImageSystemInit, 500);
                    return;
                }
            }
            
            // 이미지 시스템 초기화 실행
            initializeModularImageSystem();
            window.facilityImageSystemInitialized = true; // 전역 초기화 완료 플래그 설정
            
        } catch (error) {
            console.error('❌ 이미지 시스템 초기화 실패:', error);
            
            if (initAttempts < maxInitAttempts) {
                console.log(`🔄 ${500 * initAttempts}ms 후 재시도...`);
                setTimeout(attemptImageSystemInit, 500 * initAttempts);
            } else {
                console.error('❌ 최대 재시도 횟수 초과. 기본 업로드로 폴백합니다.');
                showWarningMessage('고급 이미지 기능을 사용할 수 없어 기본 업로드를 사용합니다.');
                initializeBasicUpload();
            }
        }
    }
    
    // 첫 번째 시도
    setTimeout(attemptImageSystemInit, 300);
});

// 모듈화된 시설 이미지 시스템 초기화
function initializeModularImageSystem() {
    try {
        console.log('모듈화된 시설 이미지 시스템 초기화 시작...');
        
        // 전체 모듈 로드 상태 확인 및 디버깅
        console.log('모듈 시스템 로드 상태:', {
            FacilityImageSystem: !!window.FacilityImageSystem,
            FacilityImageMainController: !!window.FacilityImageMainController,
            FacilityImageCore: !!window.FacilityImageCore,
            FacilityImageUpload: !!window.FacilityImageUpload,
            FacilityImageCropper: !!window.FacilityImageCropper,
            FacilityImageSEO: !!window.FacilityImageSEO,
            FacilityImageUI: !!window.FacilityImageUI,
            FacilityImageUtils: !!window.FacilityImageUtils,
            FacilityImageData: !!window.FacilityImageData
        });
        
        // 브라우저 지원 확인
        console.log('브라우저 지원 상태:', {
            FileReader: !!window.FileReader,
            FormData: !!window.FormData,
            fetch: !!window.fetch,
            Promise: !!window.Promise,
            URL: !!window.URL,
            FileAPI: !!(window.File && window.FileReader && window.FileList && window.Blob)
        });
        
        // 모듈 시스템이 로드되었는지 확인
        if (!window.FacilityImageSystem || !window.FacilityImageMainController) {
            console.warn('⚠️ 시설 이미지 모듈 시스템이 로드되지 않았습니다.');
            console.log('사용 가능한 Facility 관련 객체:', Object.keys(window).filter(key => key.includes('Facility')));
            console.log('🔄 기본 업로드 시스템으로 폴백합니다.');
            
            // 기본 업로드 시스템 바로 연결
            connectWithExistingFileInput();
            return;
        }
        
        // 시설 정보 가져오기 (다중 방법으로 안전하게 추출)
        let facilityId = null;
        let facilityName = '시설';
        
        // 방법 1: 메타 태그에서 추출
        const facilityIdMeta = document.querySelector('meta[name="facility-id"]');
        const facilityNameMeta = document.querySelector('meta[name="facility-name"]');
        
        if (facilityIdMeta && facilityIdMeta.getAttribute('content')) {
            facilityId = facilityIdMeta.getAttribute('content');
        }
        if (facilityNameMeta && facilityNameMeta.getAttribute('content')) {
            facilityName = facilityNameMeta.getAttribute('content');
        }
        
        // 방법 2: 폼 action URL에서 추출
        if (!facilityId) {
            const form = document.getElementById('facilityEditForm');
            if (form && form.action) {
                const actionUrl = form.action;
                const match = actionUrl.match(/\/facility\/edit\/(\d+)/);
                if (match && match[1]) {
                    facilityId = match[1];
                    console.log('폼 URL에서 시설 ID 추출:', facilityId);
                }
            }
        }
        
        // 방법 3: 시설명 입력 필드에서 추출
        if (facilityName === '시설' || !facilityName) {
            const facilityNameInput = document.getElementById('facilityName');
            if (facilityNameInput && facilityNameInput.value) {
                facilityName = facilityNameInput.value;
            }
        }
        
        console.log('📋 시설 정보:', {facilityId, facilityName});
        
        if (!facilityId || facilityId === '' || facilityId === '0') {
            console.warn('시설 ID를 찾을 수 없습니다. 기존 파일 입력을 사용합니다.');
            return;
        }
        
        // 모듈 시스템 초기화 (비동기)
        window.FacilityImageMainController.initialize({
            facilityId: facilityId,
            facilityName: facilityName,
            settings: {
                maxFiles: 5,
                enableSEO: true,
                enableCompression: true,
                autoAdvanceSteps: false // edit 페이지에서는 자동 진행 비활성화
            }
        }).then(success => {
            if (success) {
                console.log('모듈화된 시설 이미지 시스템 초기화 완료');
                
                // 완료 콜백 설정
                setupImageSystemCallbacks();
                
                // 기존 파일 입력과 연결
                connectWithExistingFileInput();
            } else {
                console.warn('모듈 시스템 초기화 실패, 기존 파일 입력을 사용합니다.');
            }
        }).catch(error => {
            console.error('모듈 시스템 초기화 오류:', error);
            console.warn('기존 파일 입력을 사용합니다.');
        });
        
    } catch (error) {
        console.error('시설 이미지 시스템 초기화 실패:', error);
        console.warn('기존 파일 입력 방식을 사용합니다.');
    }
}

// 이미지 시스템 콜백 설정 (호환성 확보)
function setupImageSystemCallbacks() {
    if (!window.FacilityImageCore) return;
    
    // 이미지 업로드 완료 시 처리
    window.FacilityImageCore.on('uploadComplete', function(data) {
        console.log('이미지 업로드 완료:', data);
        
        // 성공 메시지 표시
        showSuccessMessage('시설 이미지가 성공적으로 업로드되었습니다.');
        
        // 기존 파일 입력 폼과 연결 (호환성)
        updateExistingFileInput(data);
        
        // 필요시 폼 업데이트
        setTimeout(() => {
            if (confirm('이미지 업로드가 완료되었습니다. 페이지를 새로고침하시겠습니까?')) {
                window.location.reload();
            }
        }, 2000);
    });
    
    // 이미지 크롭 완료 시 처리 (기존 AdvancedImageCropper와 호환)
    window.FacilityImageCore.on('imageCropped', function(data) {
        console.log('이미지 크롭 완료:', data);
        
        // 기존 파일 입력에 크롭된 파일 설정 (호환성 유지)
        const facilityImageFile = document.getElementById('facilityImageFile');
        const facilityImageAltText = document.getElementById('facilityImageAltText');
        
        if (facilityImageFile && data.blob) {
            try {
                // DataTransfer를 사용하여 File 객체를 input에 설정
                const dataTransfer = new DataTransfer();
                const compressedFile = new File([data.blob], 
                    'facility-image.jpg', {
                        type: 'image/jpeg',
                        lastModified: Date.now()
                    });
                
                dataTransfer.items.add(compressedFile);
                facilityImageFile.files = dataTransfer.files;
                
                // Alt 텍스트 설정
                if (facilityImageAltText && data.altText) {
                    facilityImageAltText.value = data.altText;
                }
                
                // 성공 메시지 표시
                showSuccessMessage('시설 이미지가 성공적으로 최적화되었습니다!');
                
            } catch (error) {
                console.error('파일 입력 연결 실패:', error);
            }
        }
    });
    
    // 에러 처리
    window.FacilityImageCore.on('error', function(error) {
        console.error('이미지 시스템 오류:', error);
        showErrorMessage('이미지 처리 중 오류가 발생했습니다: ' + error.message);
    });
}

// 모든 핵심 기능 완전 연결 (이미지 블러오기, 메인이미지 지정, 이미지순서, 크롭, 압축, SEO)
function connectWithExistingFileInput() {
    console.log('🔗 고성능 이미지 압축 시스템 연결 시작');
    
    // 모듈 시스템 상태 상세 확인
    const moduleStatus = {
        FacilityImageSystem: !!window.FacilityImageSystem,
        FacilityImageMainController: !!window.FacilityImageMainController,
        FacilityImageUpload: !!window.FacilityImageUpload,
        FacilityImageCore: !!window.FacilityImageCore,
        FacilityImageCropper: !!window.FacilityImageCropper
    };
    
    console.log('📊 모듈 시스템 상태:', moduleStatus);
    
    // 모듈 시스템이 성공한 경우 모든 핵심 기능 활성화
    if (window.FacilityImageMainController && window.FacilityImageSystem) {
        console.log('✅ 모듈 시스템 사용 가능 - 모든 압축 기능 활성화');
        
        try {
            // 1. 드래그앤드롭 파일 선택 기능 초기화
            initializeDragAndDrop();
            console.log('✅ 1단계: 드래그앤드롭 기능 초기화 완료');
            
            // 2. 이미지 순서 변경 기능 초기화
            initializeImageOrdering();
            console.log('✅ 2단계: 이미지 순서 변경 기능 초기화 완료');
            
            // 3. 메인 이미지 지정 기능 초기화
            initializeMainImageSelection();
            console.log('✅ 3단계: 메인 이미지 지정 기능 초기화 완료');
            
            // 4. 실시간 압축률 계산 초기화
            initializeCompressionCalculation();
            console.log('✅ 4단계: 실시간 압축률 계산 기능 초기화 완료');
            
            // 5. SEO 최적화 기능 초기화
            initializeSEOOptimization();
            console.log('✅ 5단계: SEO 최적화 기능 초기화 완료');
            
            // 6. 크롭 기능 초기화
            initializeCropFunctionality();
            console.log('✅ 6단계: 크롭 기능 초기화 완료');
            
            // 7. 최종 업로드 기능 초기화
            initializeFinalUpload();
            console.log('✅ 7단계: 최종 업로드 기능 초기화 완료');
            
        } catch (error) {
            console.error('❌ 기능 초기화 중 오류 발생:', error);
            // 기본 기능으로 폴백
            initializeBasicUpload();
        }
        
    } else {
        console.warn('⚠️ 모듈 시스템을 사용할 수 없음 - 기본 업로드 사용');
        // 기본 파일 업로드 기능 활성화
        initializeBasicUpload();
    }
    
    console.log('✅ 모든 핵심 기능 연결 완료');
}

// 기본 업로드 기능 (모듈 시스템 없이 작동)
function initializeBasicUpload() {
    console.log('🔄 기본 업로드 기능 초기화 시작');
    
    const dropZone = document.getElementById('dropZone');
    const imageInput = document.getElementById('imageInput');
    const fileSelectBtn = document.getElementById('mainFileSelectBtn');
    
    if (!dropZone || !imageInput) {
        console.error('❌ 기본 DOM 요소를 찾을 수 없습니다.');
        return;
    }
    
    // 기본 드래그앤드롭 기능
    dropZone.addEventListener('dragover', function(e) {
        e.preventDefault();
        dropZone.style.backgroundColor = '#e8f5e8';
        dropZone.style.borderColor = '#28a745';
    });
    
    dropZone.addEventListener('dragleave', function(e) {
        e.preventDefault();
        dropZone.style.backgroundColor = '';
        dropZone.style.borderColor = '';
    });
    
    dropZone.addEventListener('drop', function(e) {
        e.preventDefault();
        dropZone.style.backgroundColor = '';
        dropZone.style.borderColor = '';
        
        const files = Array.from(e.dataTransfer.files);
        handleBasicFileSelection(files);
    });
    
    // 첫 번째 드롭존 클릭 이벤트 제거 (중복 방지)
    
    if (fileSelectBtn) {
        fileSelectBtn.addEventListener('click', function(e) {
            e.preventDefault();
            imageInput.click();
        });
    }
    
    imageInput.addEventListener('change', function(e) {
        const files = Array.from(e.target.files);
        handleBasicFileSelection(files);
    });
    
    console.log('✅ 기본 업로드 기능 초기화 완료');
}

// 기본 파일 선택 처리
function handleBasicFileSelection(files) {
    console.log('📁 기본 파일 선택 처리:', files.length + '개');
    
    if (files.length === 0) return;
    
    // 간단한 검증
    const validFiles = files.filter(file => file.type.startsWith('image/') && file.size <= 10 * 1024 * 1024);
    
    if (validFiles.length === 0) {
        alert('유효한 이미지 파일을 선택해주세요 (최대 10MB)');
        return;
    }
    
    if (validFiles.length > 5) {
        validFiles.splice(5);
        alert('최대 5개 파일만 선택할 수 있습니다.');
    }
    
    // 미리보기 생성
    processSelectedFiles(validFiles);
}

// 1. 드래그앤드롭 파일 선택 기능 (완전한 기능 구현)
function initializeDragAndDrop() {
    console.log('🔄 드래그앤드롭 파일 선택 기능 초기화 시작');
    
    const dropZone = document.getElementById('dropZone');
    const imageInput = document.getElementById('imageInput');
    const fileSelectButton = document.getElementById('mainFileSelectBtn');
    
    console.log('🔍 DOM 요소 검색 결과:', {
        dropZone: !!dropZone,
        imageInput: !!imageInput,
        fileSelectButton: !!fileSelectButton,
        dropZoneExists: document.querySelector('#dropZone') !== null,
        imageInputExists: document.querySelector('#imageInput') !== null,
        mainFileSelectBtnExists: document.querySelector('#mainFileSelectBtn') !== null
    });
    
    if (!dropZone) {
        console.error('❌ dropZone 요소를 찾을 수 없습니다.');
        return;
    }
    
    if (!imageInput) {
        console.error('❌ imageInput 요소를 찾을 수 없습니다.');
        return;
    }
    
    console.log('✅ DOM 요소 확인 완료:', { dropZone: !!dropZone, imageInput: !!imageInput });
    
    // 드래그앤드롭 이벤트 (고성능 이벤트 처리)
    dropZone.addEventListener('dragover', function(e) {
        e.preventDefault();
        e.stopPropagation();
        dropZone.classList.add('dragover');
        dropZone.style.backgroundColor = '#e8f5e8';
        dropZone.style.borderColor = '#28a745';
    });
    
    dropZone.addEventListener('dragleave', function(e) {
        e.preventDefault();
        e.stopPropagation();
        dropZone.classList.remove('dragover');
        dropZone.style.backgroundColor = '';
        dropZone.style.borderColor = '';
    });
    
    dropZone.addEventListener('drop', function(e) {
        e.preventDefault();
        e.stopPropagation();
        dropZone.classList.remove('dragover');
        dropZone.style.backgroundColor = '';
        dropZone.style.borderColor = '';
        
        const files = Array.from(e.dataTransfer.files);
        console.log('📂 드롭으로 파일 선택:', files.length + '개');
        
        // 이미지 파일만 필터링
        const imageFiles = files.filter(file => file.type.startsWith('image/'));
        if (imageFiles.length !== files.length) {
            console.warn('⚠️ 이미지 파일만 선택 가능합니다.');
            alert('이미지 파일만 선택할 수 있습니다.');
        }
        
        processSelectedFiles(imageFiles);
    });
    
    // 클릭으로 파일 선택 (다중 방법으로 보장)
    // 두 번째 드롭존 클릭 이벤트 제거 (중복 방지) - 메인 클릭 핸들러만 사용
    
    // 드롭존 콘텐츠 클릭 이벤트 제거 (중복 방지)
    
    // 키워드 선택 함수 및 자동 업데이트 기능
    window.selectKeyword = function(keyword) {
        console.log('🏷️ 키워드 선택:', keyword);
        
        // SEO 모듈을 통해 키워드 선택
        if (window.FacilityImageSEO && window.FacilityImageSEO.selectKeyword) {
            window.FacilityImageSEO.selectKeyword(keyword);
        }
        
        // 키워드 버튼 시각적 활성화
        const keywordButtons = document.querySelectorAll('#keywordList .badge');
        keywordButtons.forEach(btn => {
            if (btn.textContent.trim() === keyword) {
                if (btn.classList.contains('bg-primary')) {
                    // 선택 해제
                    btn.classList.remove('bg-primary');
                    btn.classList.add('bg-secondary');
                    console.log('🏷️ 키워드 선택 해제:', keyword);
                } else {
                    // 선택
                    btn.classList.remove('bg-secondary');
                    btn.classList.add('bg-primary');
                    console.log('🏷️ 키워드 선택 활성화:', keyword);
                }
            }
        });
        
        // Alt 텍스트 및 파일명 자동 업데이트
        updateSEOFields();
    };
    
    // SEO 필드 자동 업데이트 함수
    function updateSEOFields() {
        const altTextInput = document.getElementById('altText');
        const filenameInput = document.getElementById('englishFilename');
        
        if (!altTextInput || !filenameInput) return;
        
        // 선택된 키워드 수집
        const selectedKeywords = [];
        const keywordButtons = document.querySelectorAll('#keywordList .badge.bg-primary');
        keywordButtons.forEach(btn => {
            selectedKeywords.push(btn.textContent.trim());
        });
        
        console.log('🏷️ 선택된 키워드:', selectedKeywords);
        
        // SEO 모듈을 통해 파일명 및 Alt 텍스트 생성
        if (window.FacilityImageSEO) {
            const facilityName = document.querySelector('meta[name="facility-name"]')?.content || '시설';
            const currentImageIndex = 0; // 현재 이미지 인덱스
            
            // 파일명 생성
            if (window.FacilityImageSEO.generateFileName) {
                const generatedFilename = window.FacilityImageSEO.generateFileName(
                    'facility-image.jpg',
                    selectedKeywords,
                    currentImageIndex
                );
                filenameInput.value = generatedFilename;
                console.log('📄 파일명 생성:', generatedFilename);
            }
            
            // Alt 텍스트 생성
            if (window.FacilityImageSEO.generateAltText) {
                const generatedAltText = window.FacilityImageSEO.generateAltText(
                    facilityName,
                    selectedKeywords,
                    currentImageIndex
                );
                altTextInput.value = generatedAltText;
                console.log('📝 Alt 텍스트 생성:', generatedAltText);
            }
        } else {
            // 기본 방식으로 생성
            const keywordText = selectedKeywords.join(' ');
            const facilityName = document.querySelector('meta[name="facility-name"]')?.content || '시설';
            
            // 기본 Alt 텍스트
            altTextInput.value = `${facilityName} ${keywordText} 이미지`;
            
            // 기본 파일명 (영문)
            const englishKeywords = selectedKeywords.map(keyword => {
                const translations = {
                    '요양원': 'nursing-home',
                    '시설': 'facility',
                    '내부': 'interior',
                    '외관': 'exterior',
                    '깨끗한': 'clean',
                    '현대적': 'modern',
                    '밝은': 'bright',
                    '쾌적한': 'comfortable'
                };
                return translations[keyword] || keyword;
            }).join('-');
            
            filenameInput.value = `${englishKeywords}-${Date.now()}.jpg`;
        }
    }
    
    // 크롭 기능 강제 초기화 함수
    window.initializeCropperForce = function() {
        console.log('🔄 크롭 기능 강제 초기화 시작');
        
        // 로딩 표시
        const cropLoading = document.getElementById('cropLoading');
        const cropError = document.getElementById('cropError');
        const cropImage = document.getElementById('cropImage');
        
        if (cropLoading) cropLoading.style.display = 'block';
        if (cropError) cropError.style.display = 'none';
        
        // 메인 컨트롤러를 통해 크롭 초기화 재시도
        if (window.FacilityImageMainController && window.FacilityImageMainController.workflowManager) {
            window.FacilityImageMainController.workflowManager.initializeCropStep()
                .then(() => {
                    console.log('✅ 크롭 강제 초기화 성공');
                    if (cropLoading) cropLoading.style.display = 'none';
                })
                .catch(error => {
                    console.error('❌ 크롭 강제 초기화 실패:', error);
                    if (cropLoading) cropLoading.style.display = 'none';
                    if (cropError) cropError.style.display = 'block';
                });
        } else {
            // 대체 방법: 직접 크롭퍼 초기화
            setTimeout(() => {
                if (window.FacilityImageCropper && window.FacilityImageCropper.initialize) {
                    window.FacilityImageCropper.initialize()
                        .then(() => {
                            console.log('✅ 크롭퍼 직접 초기화 성공');
                            if (cropLoading) cropLoading.style.display = 'none';
                        })
                        .catch(error => {
                            console.error('❌ 크롭퍼 직접 초기화 실패:', error);
                            if (cropLoading) cropLoading.style.display = 'none';
                            if (cropError) cropError.style.display = 'block';
                        });
                } else {
                    console.error('❌ 크롭퍼 모듈을 찾을 수 없음');
                    if (cropLoading) cropLoading.style.display = 'none';
                    if (cropError) cropError.style.display = 'block';
                }
            }, 1000);
        }
    };
    
    // 압축 품질 슬라이더 이벤트
    const qualitySlider = document.getElementById('compressionQuality');
    const qualityValue = document.getElementById('qualityValue');
    
    if (qualitySlider && qualityValue) {
        qualitySlider.addEventListener('input', function(e) {
            const quality = e.target.value;
            qualityValue.textContent = quality + '%';
            console.log('📊 압축 품질 변경:', quality + '%');
            
            // 압축 통계 업데이트
            updateCompressionStats(quality);
        });
    }
    
    // 압축 형식 선택 이벤트
    const formatRadios = document.querySelectorAll('input[name="compressionFormat"]');
    formatRadios.forEach(radio => {
        radio.addEventListener('change', function(e) {
            const format = e.target.value;
            console.log('📊 압축 형식 변경:', format);
            
            // 현재 품질로 압축 통계 업데이트
            const currentQuality = qualitySlider ? qualitySlider.value : 85;
            updateCompressionStats(currentQuality, format);
        });
    });
    
    // 압축 통계 업데이트 함수
    function updateCompressionStats(quality, format = 'webp') {
        const originalSizeEl = document.getElementById('originalSize');
        const compressedSizeEl = document.getElementById('compressedSize');
        const savedSizeEl = document.getElementById('savedSize');
        const compressionRatioEl = document.getElementById('compressionRatio');
        const monthlySavingsEl = document.getElementById('monthlySavings');
        
        if (!originalSizeEl || !compressedSizeEl) return;
        
        // 기본 예시 크기 (실제로는 선택된 파일들의 크기를 사용)
        const originalSize = 5 * 1024 * 1024; // 5MB
        
        // 형식별 압축률 계산
        const compressionRates = {
            'webp': 0.7,
            'avif': 0.6,
            'jpeg': 0.8
        };
        
        const baseRate = compressionRates[format] || 0.7;
        const qualityFactor = quality / 100;
        const compressionRate = baseRate * qualityFactor;
        
        const compressedSize = originalSize * compressionRate;
        const savedSize = originalSize - compressedSize;
        const compressionRatio = ((savedSize / originalSize) * 100).toFixed(1);
        
        // UI 업데이트
        originalSizeEl.textContent = formatFileSize(originalSize);
        compressedSizeEl.textContent = formatFileSize(compressedSize);
        savedSizeEl.textContent = formatFileSize(savedSize);
        compressionRatioEl.textContent = compressionRatio + '%';
        
        // 월간 절약 비용 계산 (예시)
        const monthlySavings = Math.round(savedSize / 1024 / 1024 * 100); // MB당 100원 가정
        if (monthlySavingsEl) {
            monthlySavingsEl.textContent = monthlySavings + '원';
        }
        
        console.log('📊 압축 통계 업데이트:', {
            original: formatFileSize(originalSize),
            compressed: formatFileSize(compressedSize),
            saved: formatFileSize(savedSize),
            ratio: compressionRatio + '%'
        });
    }
    
    // 파일 크기 포맷팅 함수
    function formatFileSize(bytes) {
        const sizes = ['B', 'KB', 'MB', 'GB'];
        if (bytes === 0) return '0 B';
        const i = Math.floor(Math.log(bytes) / Math.log(1024));
        return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
    }
    
    // 크롭 섹션 표시 감지 및 자동 초기화 (중복 방지)
    const cropSection = document.getElementById('cropSection');
    if (cropSection && !cropSection.hasObserver) {
        cropSection.hasObserver = true; // 중복 방지 플래그
        
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                    const isVisible = cropSection.style.display !== 'none';
                    if (isVisible && !cropSection.isInitialized) {
                        cropSection.isInitialized = true; // 중복 초기화 방지
                        console.log('🔄 크롭 섹션 표시됨 - 즉시 초기화 시작');
                        
                        // 크롭 섹션 강제 표시
                        cropSection.style.display = 'block';
                        cropSection.style.visibility = 'visible';
                        
                        // 즉시 크롭 이미지 로드 시도
                        setTimeout(() => {
                            loadCropImageFromMainState();
                        }, 100);
                        
                        // 압축 통계 초기화
                        setTimeout(() => {
                            updateCompressionStats(85, 'webp');
                        }, 200);
                        
                        // SEO 필드 초기화
                        setTimeout(() => {
                            initializeSEOFields();
                        }, 300);
                    }
                }
            });
        });
        
        observer.observe(cropSection, {
            attributes: true,
            attributeFilter: ['style']
        });
    }
    
    // 메인 상태에서 크롭 이미지 로드
    function loadCropImageFromMainState() {
        const cropImage = document.getElementById('cropImage');
        const cropLoading = document.getElementById('cropLoading');
        const cropError = document.getElementById('cropError');
        
        if (!cropImage) return;
        
        // 메인 컨트롤러에서 선택된 파일 가져오기
        let selectedFiles = [];
        if (window.FacilityImageMainController && window.FacilityImageMainController.selectedFiles) {
            selectedFiles = window.FacilityImageMainController.selectedFiles;
        }
        
        // 또는 전역 변수에서 선택된 파일 가져오기
        if (selectedFiles.length === 0 && window.selectedImageFiles) {
            selectedFiles = window.selectedImageFiles;
        }
        
        if (selectedFiles.length > 0) {
            const firstFile = selectedFiles[0];
            console.log('🖼️ 크롭을 위한 이미지 로드:', firstFile.name);
            
            // 파일을 Data URL로 변환
            const reader = new FileReader();
            reader.onload = function(e) {
                cropImage.src = e.target.result;
                cropImage.style.display = 'block';
                
                // 크롭 컨테이너 스타일 업데이트
                const cropContainer = cropImage.closest('.crop-image-container');
                if (cropContainer) {
                    cropContainer.style.minHeight = '400px';
                    cropContainer.style.backgroundColor = '#f8f9fa';
                    cropContainer.style.display = 'flex';
                    cropContainer.style.alignItems = 'center';
                    cropContainer.style.justifyContent = 'center';
                }
                
                // 로딩 숨기기
                if (cropLoading) cropLoading.style.display = 'none';
                if (cropError) cropError.style.display = 'none';
                
                console.log('✅ 크롭 이미지 로드 완료');
                
                // 크롭퍼 초기화 시도
                setTimeout(() => {
                    initializeCropperInstance();
                }, 500);
            };
            reader.onerror = function() {
                console.error('❌ 크롭 이미지 로드 실패');
                if (cropLoading) cropLoading.style.display = 'none';
                if (cropError) cropError.style.display = 'block';
            };
            reader.readAsDataURL(firstFile);
        } else {
            console.warn('⚠️ 선택된 파일이 없습니다.');
            if (cropLoading) cropLoading.style.display = 'none';
            if (cropError) cropError.style.display = 'block';
        }
    }
    
    // 크롭퍼 인스턴스 초기화
    function initializeCropperInstance() {
        const cropImage = document.getElementById('cropImage');
        if (!cropImage || !cropImage.src) {
            console.error('❌ 크롭 이미지 또는 소스를 찾을 수 없습니다.');
            return;
        }
        
        // 기존 크롭퍼 파괴
        if (cropImage.cropper) {
            cropImage.cropper.destroy();
        }
        
        // 이미지 로드 완료 확인
        if (cropImage.complete) {
            initializeCropper();
        } else {
            cropImage.onload = initializeCropper;
        }
        
        function initializeCropper() {
            console.log('🔄 크롭퍼 초기화 시작');
            
            // 새 크롭퍼 생성
            if (window.Cropper) {
                try {
                    cropImage.cropper = new Cropper(cropImage, {
                        aspectRatio: 16 / 9,
                        viewMode: 1,
                        dragMode: 'move',
                        autoCropArea: 1,
                        responsive: true,
                        restore: false,
                        guides: true,
                        center: true,
                        highlight: false,
                        cropBoxMovable: true,
                        cropBoxResizable: true,
                        toggleDragModeOnDblclick: false,
                        minCanvasWidth: 400,
                        minCanvasHeight: 300,
                        ready: function() {
                            console.log('✅ 크롭퍼 초기화 완료');
                            
                            // 크롭 섹션 표시
                            const cropSection = document.getElementById('cropSection');
                            if (cropSection) {
                                cropSection.style.display = 'block';
                            }
                            
                            // 크롭 컨트롤 표시
                            const cropControls = document.getElementById('cropControls');
                            if (cropControls) {
                                cropControls.style.display = 'block';
                            }
                        },
                        cropstart: function() {
                            console.log('🔄 크롭 시작');
                        },
                        cropmove: function() {
                            console.log('🔄 크롭 이동');
                        },
                        cropend: function() {
                            console.log('🔄 크롭 종료');
                        }
                    });
                } catch (error) {
                    console.error('❌ 크롭퍼 초기화 오류:', error);
                }
            } else {
                console.warn('⚠️ Cropper.js 라이브러리가 로드되지 않았습니다.');
                
                // 크롭퍼 없이도 이미지 표시
                const cropSection = document.getElementById('cropSection');
                if (cropSection) {
                    cropSection.style.display = 'block';
                }
            }
        }
    }
    
    // SEO 필드 초기화
    function initializeSEOFields() {
        const altTextInput = document.getElementById('altText');
        const filenameInput = document.getElementById('englishFilename');
        const facilityName = document.querySelector('meta[name="facility-name"]')?.content || '서울 행복요양원';
        
        if (altTextInput && !altTextInput.value) {
            altTextInput.value = `${facilityName} 시설 이미지`;
        }
        
        if (filenameInput && !filenameInput.value) {
            filenameInput.value = `${facilityName.replace(/\s+/g, '-').toLowerCase()}-facility-image.jpg`;
        }
    }
    
    // 크롭 건너뛰기 버튼 이벤트
    const skipCropBtn = document.getElementById('skipCrop');
    if (skipCropBtn) {
        skipCropBtn.addEventListener('click', function() {
            console.log('⏭️ 크롭 건너뛰기 - 최종 단계로 이동');
            
            // 메인 컨트롤러를 통해 3단계로 이동
            if (window.FacilityImageMainController && window.FacilityImageMainController.moveToStep) {
                window.FacilityImageMainController.moveToStep(3);
            } else {
                // 대체 방법: 수동으로 단계 이동
                document.getElementById('cropSection').style.display = 'none';
                document.getElementById('manageSection').style.display = 'block';
                
                // 간단한 알림
                alert('크롭을 건너뛰고 최종 단계로 이동했습니다.');
            }
        });
    }
    
    // 파일 선택 변경 이벤트
    imageInput.addEventListener('change', function(e) {
        const files = Array.from(e.target.files);
        console.log('📂 파일 입력으로 파일 선택:', files.length + '개');
        
        if (files.length > 0) {
            processSelectedFiles(files);
        }
    });
    
    // 키보드 접근성 지원
    dropZone.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            imageInput.click();
        }
    });
    
    // 접근성 속성 설정
    dropZone.setAttribute('role', 'button');
    dropZone.setAttribute('tabindex', '0');
    dropZone.setAttribute('aria-label', '이미지 파일 선택');
    
    // 단순하고 안정적인 파일 선택 이벤트 설정
    const fileSelectButtonElement = document.getElementById('mainFileSelectBtn');
    
    // 메인 파일 선택 버튼 이벤트 (우선 순위)
    if (fileSelectButtonElement && imageInput) {
        fileSelectButtonElement.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation(); // 버블링 방지
            console.log('🔵 파일 선택 버튼 클릭');
            imageInput.value = '';
            imageInput.click();
        });
    }
    
    // 세 번째 드롭존 클릭 이벤트 제거 (중복 방지)
    
    console.log('✅ 드래그앤드롭 파일 선택 기능 초기화 완료');
}

// 2. 이미지 순서 변경 기능
function initializeImageOrdering() {
    console.log('🔄 이미지 순서 변경 기능 초기화');
    
    // 순서 변경 이벤트 리스너
    document.addEventListener('dragstart', function(e) {
        if (e.target.classList.contains('image-preview-item')) {
            e.target.classList.add('dragging');
        }
    });
    
    document.addEventListener('dragend', function(e) {
        if (e.target.classList.contains('image-preview-item')) {
            e.target.classList.remove('dragging');
        }
    });
    
    document.addEventListener('dragover', function(e) {
        if (e.target.closest('.image-preview-list')) {
            e.preventDefault();
        }
    });
    
    document.addEventListener('drop', function(e) {
        if (e.target.closest('.image-preview-list')) {
            e.preventDefault();
            // 순서 변경 로직
            updateImageOrder();
        }
    });
}

// 3. 메인 이미지 지정 기능
function initializeMainImageSelection() {
    console.log('⭐ 메인 이미지 지정 기능 초기화');
    
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('set-main-image')) {
            const imageIndex = e.target.dataset.index;
            setMainImage(imageIndex);
        }
    });
}

// 4. 실시간 압축률 계산 초기화
function initializeCompressionCalculation() {
    console.log('📊 실시간 압축률 계산 기능 초기화');
    
    // 압축 품질 슬라이더 이벤트
    const compressionQuality = document.getElementById('compressionQuality');
    const qualityValue = document.getElementById('qualityValue');
    
    if (compressionQuality && qualityValue) {
        compressionQuality.addEventListener('input', function(e) {
            const quality = e.target.value;
            qualityValue.textContent = quality + '%';
            
            // 실시간 압축률 계산
            calculateCompressionStats(quality);
        });
    }
    
    // 압축 형식 변경 이벤트
    document.querySelectorAll('input[name="compressionFormat"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const format = this.value;
            console.log('압축 형식 변경:', format);
            calculateCompressionStats(compressionQuality.value, format);
        });
    });
}

// 5. SEO 최적화 기능 초기화
function initializeSEOOptimization() {
    console.log('🔍 SEO 최적화 기능 초기화');
    
    // Alt 텍스트 자동 생성
    const altText = document.getElementById('altText');
    if (altText) {
        altText.addEventListener('input', function() {
            generateSEOFilename();
        });
    }
    
    // 키워드 선택 이벤트는 이미 HTML에 onclick으로 연결됨
    // SEO.selectKeyword 함수 호출
}

// 6. 크롭 기능 초기화
function initializeCropFunctionality() {
    console.log('✂️ 크롭 기능 초기화');
    
    // 크롭 컨트롤 이벤트
    const prevImage = document.getElementById('prevImage');
    const nextImage = document.getElementById('nextImage');
    const resetCrop = document.getElementById('resetCrop');
    const autoFit = document.getElementById('autoFit');
    
    if (prevImage) {
        prevImage.addEventListener('click', function() {
            if (window.FacilityImageMainController) {
                window.FacilityImageMainController.proceedToPrevImage();
            }
        });
    }
    
    if (nextImage) {
        nextImage.addEventListener('click', function() {
            if (window.FacilityImageMainController) {
                window.FacilityImageMainController.proceedToNextImage();
            }
        });
    }
    
    if (resetCrop) {
        resetCrop.addEventListener('click', function() {
            if (window.FacilityImageCropper) {
                window.FacilityImageCropper.reset();
            }
        });
    }
    
    if (autoFit) {
        autoFit.addEventListener('click', function() {
            if (window.FacilityImageCropper) {
                window.FacilityImageCropper.setAspectRatio(16/9);
            }
        });
    }
}

// 7. 최종 업로드 기능 초기화
function initializeFinalUpload() {
    console.log('🚀 최종 업로드 기능 초기화');
    
    const uploadButton = document.getElementById('uploadOptimizedImages');
    if (uploadButton) {
        uploadButton.addEventListener('click', function() {
            if (window.FacilityImageMainController) {
                window.FacilityImageMainController.uploadImages();
            }
        });
    }
    
    const completeButton = document.getElementById('completeImageProcessing');
    if (completeButton) {
        completeButton.addEventListener('click', function() {
            if (window.FacilityImageMainController) {
                window.FacilityImageMainController.moveToStep(3);
            }
        });
    }
    
    const proceedButton = document.getElementById('proceedToStep2');
    if (proceedButton) {
        // 기존 이벤트 리스너 제거
        proceedButton.removeEventListener('click', arguments.callee);
        
        // 새로운 이벤트 리스너 추가 (최우선순위로 설정, 캡처 단계에서 실행)
        proceedButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            
            // 메인 컨트롤러 무력화
            if (window.FacilityImageMainController && window.FacilityImageMainController.moveToStep) {
                window.FacilityImageMainController.moveToStep = function() { 
                    console.log('🚫 메인 컨트롤러 단계 이동 차단됨'); 
                    return false; 
                };
            }
            
            console.log('🔄 새창 방식: 2단계 크롭 페이지로 이동');
            
            // 시설 ID 가져오기
            const facilityId = document.querySelector('meta[name="facility-id"]')?.content || '1';
            
            // 선택된 파일들을 세션 스토리지에 저장
            if (window.selectedImageFiles && window.selectedImageFiles.length > 0) {
                const fileDataArray = [];
                let processedCount = 0;
                
                // 로딩 표시
                proceedButton.disabled = true;
                proceedButton.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>파일 준비 중...';
                
                // 각 파일을 Base64로 변환하여 저장
                window.selectedImageFiles.forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        fileDataArray[index] = {
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            data: e.target.result
                        };
                        processedCount++;
                        
                        // 진행률 표시
                        const progress = Math.round((processedCount / window.selectedImageFiles.length) * 100);
                        proceedButton.innerHTML = `<i class="fas fa-spinner fa-spin me-1"></i>파일 준비 중... ${progress}%`;
                        
                        // 모든 파일 처리 완료 시 페이지 이동
                        if (processedCount === window.selectedImageFiles.length) {
                            sessionStorage.setItem('selectedImageFiles', JSON.stringify(fileDataArray));
                            console.log('✅ 파일 세션 저장 완료, 크롭 페이지로 이동');
                            window.location.href = `/facility/crop-images/${facilityId}`;
                        }
                    };
                    reader.readAsDataURL(file);
                });
            } else {
                // 선택된 파일이 없으면 바로 이동
                console.log('⚠️ 선택된 파일이 없어 빈 크롭 페이지로 이동');
                window.location.href = `/facility/${facilityId}/crop-images`;
            }
        }, true); // 캡처 단계에서 실행하여 다른 이벤트 리스너보다 먼저 실행
    }
}

// 파일 선택 처리 함수 (완전한 기능 구현 - 이미지 불러오기, 순서, 메인이미지, 압축률 계산)
// 전역 변수로 선택된 파일 저장
window.selectedImageFiles = [];

function processSelectedFiles(files) {
    if (!files || files.length === 0) {
        console.warn('⚠️ 선택된 파일이 없습니다.');
        return;
    }
    
    console.log('📂 파일 선택 처리 시작:', files.length + '개');
    
    // 전역 변수에 저장
    window.selectedImageFiles = files;
    
    // 파일 개수 제한 확인
    if (files.length > 5) {
        console.warn('⚠️ 최대 5개 파일만 선택 가능합니다.');
        alert('최대 5개 파일만 선택할 수 있습니다.');
        files = files.slice(0, 5);
    }
    
    // 이미지 파일 검증
    const validImageFiles = [];
    const invalidFiles = [];
    
    files.forEach(file => {
        if (file.type.startsWith('image/')) {
            // 파일 크기 검증 (10MB 제한)
            if (file.size <= 10 * 1024 * 1024) {
                validImageFiles.push(file);
            } else {
                console.warn('⚠️ 파일 크기가 너무 큽니다:', file.name);
                invalidFiles.push(file.name + ' (크기 초과)');
            }
        } else {
            invalidFiles.push(file.name + ' (이미지 파일 아님)');
        }
    });
    
    if (invalidFiles.length > 0) {
        const message = '다음 파일들은 업로드할 수 없습니다:\n' + invalidFiles.join('\n');
        // UI 모듈을 사용한 알림 표시
        if (window.FacilityImageUI && typeof window.FacilityImageUI.showNotification === 'function') {
            window.FacilityImageUI.showNotification(message, 'warning');
        } else {
            alert(message);
        }
    }
    
    if (validImageFiles.length === 0) {
        console.warn('⚠️ 유효한 이미지 파일이 없습니다.');
        // UI 모듈을 사용한 알림 표시
        if (window.FacilityImageUI && typeof window.FacilityImageUI.showNotification === 'function') {
            window.FacilityImageUI.showNotification('유효한 이미지 파일이 없습니다.', 'warning');
        }
        return;
    }
    
    console.log('✅ 유효한 이미지 파일:', validImageFiles.length + '개');
    
    // UI 모듈을 사용한 성공 알림 표시
    if (window.FacilityImageUI && typeof window.FacilityImageUI.showNotification === 'function') {
        window.FacilityImageUI.showNotification(
            `${validImageFiles.length}개의 이미지 파일이 성공적으로 선택되었습니다.`, 
            'success'
        );
    }
    
    // 1. 모듈 시스템으로 파일 전달
    if (window.FacilityImageMainController && typeof window.FacilityImageMainController.processFiles === 'function') {
        window.FacilityImageMainController.processFiles(validImageFiles);
    } else {
        // 모듈 시스템이 없으면 기본 처리
        console.warn('메인 컨트롤러를 사용할 수 없어 기본 처리 사용');
    }
    
    // 2. UI 모듈을 사용한 미리보기 컨테이너 관리
    let previewContainer = null;
    
    // UI 모듈 사용 시도
    if (window.FacilityImageUI && typeof window.FacilityImageUI.createPreviewContainer === 'function') {
        try {
            previewContainer = window.FacilityImageUI.createPreviewContainer();
            console.log('✅ UI 모듈로 미리보기 컨테이너 생성 성공');
        } catch (error) {
            console.warn('UI 모듈 미리보기 컨테이너 생성 실패:', error);
        }
    }
    
    // 기본 방법으로 미리보기 컨테이너 찾기
    if (!previewContainer) {
        const previewContainerSelectors = ['#imagePreviewContainer', '.image-preview-container', '.selected-images-preview'];
        
        for (const selector of previewContainerSelectors) {
            previewContainer = document.querySelector(selector);
            if (previewContainer) {
                console.log('✅ 기본 선택자로 미리보기 컨테이너 찾기 성공:', selector);
                break;
            }
        }
    }
    
    // 미리보기 컨테이너를 찾을 수 없으면 생성
    if (!previewContainer) {
        console.warn('미리보기 컨테이너를 찾을 수 없어 새로 생성합니다.');
        
        // UI 모듈을 사용한 알림 표시
        if (window.FacilityImageUI && typeof window.FacilityImageUI.showNotification === 'function') {
            window.FacilityImageUI.showNotification('이미지 미리보기 영역을 생성하고 있습니다.', 'info');
        }
        
        previewContainer = document.createElement('div');
        previewContainer.id = 'imagePreviewContainer';
        previewContainer.className = 'image-preview-container';
        previewContainer.style.display = 'block';
        
        // 적절한 위치에 삽입
        const uploadSection = document.getElementById('uploadSection');
        if (uploadSection) {
            uploadSection.appendChild(previewContainer);
        } else {
            document.body.appendChild(previewContainer);
        }
        
        console.log('✅ 미리보기 컨테이너 생성 완료');
    }
    
    if (previewContainer) {
        previewContainer.style.display = 'block';
    }
    
    // 3. 파일 개수 업데이트 (여러 선택자 시도)
    const selectedCountSelectors = ['#selectedCount', '.selected-count', '.image-count'];
    let selectedCountElement = null;
    
    for (const selector of selectedCountSelectors) {
        selectedCountElement = document.querySelector(selector);
        if (selectedCountElement) {
            selectedCountElement.textContent = validImageFiles.length;
            break;
        }
    }
    
    // 4. 통합 이미지 목록은 메인 컨트롤러에서 처리됨 (중복 제거)
    
    // 5. 버튼 표시 및 기능 연결
    const addMoreBtnSelectors = ['#addMoreImages', '.add-more-images', '.add-more-btn'];
    const proceedBtnSelectors = ['#proceedToStep2', '.proceed-btn', '.next-step-btn'];
    
    let addMoreBtn = null;
    let proceedBtn = null;
    
    for (const selector of addMoreBtnSelectors) {
        addMoreBtn = document.querySelector(selector);
        if (addMoreBtn) break;
    }
    
    for (const selector of proceedBtnSelectors) {
        proceedBtn = document.querySelector(selector);
        if (proceedBtn) break;
    }
    
    if (addMoreBtn) {
        addMoreBtn.style.display = validImageFiles.length < 5 ? 'inline-block' : 'none';
        
        // 추가 파일 선택 이벤트 - 중복 클릭 방지
        addMoreBtn.onclick = function(e) {
            e.stopPropagation();
            console.log('🔵 추가 이미지 버튼 클릭 - 파일 선택창 열기');
            const imageInput = document.getElementById('imageInput');
            if (imageInput) {
                imageInput.click();
            }
        };
    }
    
    if (proceedBtn) {
        proceedBtn.style.display = 'inline-block';
    }
    
    // 6. 파일 정보 표시
    displayFileInformation(validImageFiles);
    
    // 7. 전체 압축률 계산 표시
    calculateTotalCompressionStats(validImageFiles);
    
    console.log('✅ 파일 선택 처리 완료');
}

// 중복 이미지 목록 생성 함수 완전 제거됨 - 메인 컨트롤러에서 통합 관리
// 이 함수는 더 이상 사용되지 않으며 메인 컨트롤러의 createImageOrderItem 함수가 모든 기능을 통합 처리합니다.

// 동적 이미지 미리보기 컨테이너 생성
function createImagePreviewContainer() {
    console.log('🏗️ 이미지 미리보기 컨테이너 동적 생성 시작');
    
    const container = document.createElement('div');
    container.id = 'imagePreviewContainer';
    container.className = 'image-preview-container mt-4';
    container.style.display = 'none';
    
    container.innerHTML = `
        <div class="card border-success">
            <div class="card-header bg-light">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 text-primary">
                        <i class="fas fa-images me-2"></i>선택된 이미지 (<span id="selectedCount">0</span>/5)
                    </h6>
                    <div class="compression-stats">
                        <small class="text-success fw-bold">
                            <i class="fas fa-save me-1"></i>예상 절약: <span id="totalSavings">0MB</span>
                        </small>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="imagePreviewList" class="image-preview-list d-flex flex-wrap gap-3 justify-content-center" style="min-height: 200px; padding: 20px;">
                    <!-- 이미지 미리보기가 여기에 표시됩니다 -->
                </div>
                <div class="text-center mt-3">
                    <button type="button" id="addMoreImages" class="btn btn-outline-success me-2" style="display: none;">
                        <i class="fas fa-plus me-1"></i>이미지 추가
                    </button>
                    <button type="button" id="proceedToStep2" class="btn btn-success btn-lg px-4" style="display: none;">
                        <i class="fas fa-compress me-1"></i>압축 및 최적화 시작
                    </button>
                </div>
            </div>
        </div>
    `;
    
    // 적절한 위치에 추가
    const uploadSection = document.getElementById('uploadSection');
    const dropZone = document.getElementById('dropZone');
    
    if (uploadSection) {
        uploadSection.appendChild(container);
    } else if (dropZone && dropZone.parentElement) {
        dropZone.parentElement.appendChild(container);
    } else {
        document.body.appendChild(container);
    }
    
    console.log('✅ 이미지 미리보기 컨테이너 동적 생성 완료');
    return container;
}

// 전체 압축률 계산
function calculateTotalCompressionStats(files) {
    let totalOriginalSize = 0;
    let totalCompressedSize = 0;
    
    files.forEach(file => {
        totalOriginalSize += file.size;
        
        // 압축 형식에 따른 예상 압축률 계산
        const format = document.querySelector('input[name="compressionFormat"]:checked')?.value || 'webp';
        const quality = document.getElementById('compressionQuality')?.value || 85;
        
        const compressionRatio = format === 'avif' ? 0.2 : format === 'webp' ? 0.3 : 0.5;
        const qualityFactor = quality / 100;
        
        totalCompressedSize += file.size * compressionRatio * qualityFactor;
    });
    
    const savedSize = totalOriginalSize - totalCompressedSize;
    const compressionPercentage = ((savedSize / totalOriginalSize) * 100).toFixed(1);
    
    // UI 업데이트
    const totalSavings = document.getElementById('totalSavings');
    if (totalSavings) {
        totalSavings.textContent = formatFileSize(savedSize);
    }
    
    const compressionRatioEl = document.getElementById('compressionRatio');
    if (compressionRatioEl) {
        compressionRatioEl.textContent = compressionPercentage + '%';
    }
    
    const monthlySavings = document.getElementById('monthlySavings');
    if (monthlySavings) {
        const estimatedMonthlySavings = Math.round((savedSize / 1024 / 1024) * 100 * 30); // MB당 100원 * 30일
        monthlySavings.textContent = estimatedMonthlySavings.toLocaleString();
    }
    
    console.log('📊 압축 통계:', {
        원본: formatFileSize(totalOriginalSize),
        압축: formatFileSize(totalCompressedSize),
        절약: formatFileSize(savedSize),
        압축률: compressionPercentage + '%'
    });
}

// 파일 정보 표시
function displayFileInformation(files) {
    console.log('📋 선택된 파일 정보:');
    files.forEach((file, index) => {
        console.log(`${index + 1}. ${file.name} (${formatFileSize(file.size)}, ${file.type})`);
    });
}

// 파일 크기 포맷터
function formatFileSize(bytes) {
    if (bytes === 0) return '0 B';
    const k = 1024;
    const sizes = ['B', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// 미리보기에서 이미지 제거
function removeImageFromPreview(index) {
    console.log('🗑️ 이미지 제거:', index);
    
    // 실제 파일 배열에서 제거하는 로직 구현
    if (window.FacilityImageMainController && typeof window.FacilityImageMainController.removeFile === 'function') {
        window.FacilityImageMainController.removeFile(index);
    }
    
    // 미리보기 업데이트
    const previewItem = document.querySelector(`[data-index="${index}"]`);
    if (previewItem) {
        previewItem.remove();
    }
}

// 이미지 순서 업데이트
function updateImageOrder() {
    console.log('🔄 이미지 순서 업데이트');
    // 순서 변경 로직 구현
}

// 메인 이미지 설정 (완전한 기능 구현)
function setMainImage(index) {
    console.log('⭐ 메인 이미지 설정:', index);
    
    // 기존 메인 이미지 마크 제거
    document.querySelectorAll('.main-image-badge').forEach(badge => {
        badge.remove();
    });
    
    // 기존 메인 이미지 버튼 스타일 복원
    document.querySelectorAll('.set-main-image').forEach(btn => {
        btn.classList.remove('btn-success');
        btn.classList.add('btn-warning');
        btn.querySelector('i').className = 'fas fa-star';
    });
    
    // 새 메인 이미지 마크 추가
    const imageItem = document.querySelector(`[data-index="${index}"]`);
    if (imageItem) {
        const badge = document.createElement('div');
        badge.className = 'main-image-badge badge bg-warning position-absolute';
        badge.style.top = '30px';
        badge.style.left = '5px';
        badge.style.zIndex = '15';
        badge.textContent = '메인';
        imageItem.appendChild(badge);
        
        // 메인 이미지 버튼 스타일 변경
        const mainBtn = imageItem.querySelector('.set-main-image');
        if (mainBtn) {
            mainBtn.classList.remove('btn-warning');
            mainBtn.classList.add('btn-success');
            mainBtn.querySelector('i').className = 'fas fa-check';
        }
    }
    
    // 메인 이미지 데이터 저장 (모듈 시스템 연동)
    if (window.FacilityImageMainController && typeof window.FacilityImageMainController.setMainImage === 'function') {
        window.FacilityImageMainController.setMainImage(index);
    }
    
    // 성공 메시지 표시
    const notification = document.createElement('div');
    notification.className = 'alert alert-success alert-dismissible fade show position-fixed';
    notification.style.top = '20px';
    notification.style.right = '20px';
    notification.style.zIndex = '9999';
    notification.innerHTML = `
        <i class="fas fa-check-circle me-2"></i>
        메인 이미지로 설정되었습니다.
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    document.body.appendChild(notification);
    
    // 3초 후 자동 제거
    setTimeout(() => {
        if (notification.parentNode) {
            notification.remove();
        }
    }, 3000);
}

// 압축 통계 계산 (정교한 계산 - 실제 파일 크기 기반)
function calculateCompressionStats(quality, format = 'webp') {
    console.log('📊 압축 통계 계산:', quality + '%, ' + format);
    
    // 현재 선택된 파일들의 실제 크기 계산
    const selectedFiles = getCurrentSelectedFiles();
    let totalOriginalSize = 0;
    let totalCompressedSize = 0;
    
    selectedFiles.forEach(file => {
        totalOriginalSize += file.size;
        
        // 압축 형식별 압축률 (실제 테스트 기반)
        let compressionRatio;
        switch (format) {
            case 'avif':
                compressionRatio = 0.15; // AVIF: 85% 압축
                break;
            case 'webp':
                compressionRatio = 0.25; // WebP: 75% 압축
                break;
            case 'jpeg':
            default:
                compressionRatio = 0.6; // JPEG: 40% 압축
                break;
        }
        
        // 품질 팩터 적용
        const qualityFactor = quality / 100;
        const finalCompressionRatio = compressionRatio + (1 - compressionRatio) * (1 - qualityFactor);
        
        totalCompressedSize += file.size * finalCompressionRatio;
    });
    
    if (totalOriginalSize === 0) return;
    
    const savedSize = totalOriginalSize - totalCompressedSize;
    const compressionPercentage = ((savedSize / totalOriginalSize) * 100).toFixed(1);
    
    // UI 업데이트
    const originalSizeEl = document.getElementById('originalSize');
    if (originalSizeEl) {
        originalSizeEl.textContent = formatFileSize(totalOriginalSize);
    }
    
    const compressedSizeEl = document.getElementById('compressedSize');
    if (compressedSizeEl) {
        compressedSizeEl.textContent = formatFileSize(totalCompressedSize);
    }
    
    const savedSizeEl = document.getElementById('savedSize');
    if (savedSizeEl) {
        savedSizeEl.textContent = formatFileSize(savedSize);
    }
    
    const compressionRatioEl = document.getElementById('compressionRatio');
    if (compressionRatioEl) {
        compressionRatioEl.textContent = compressionPercentage + '%';
    }
    
    // 월간 데이터 비용 절약 계산 (더 정교한 계산)
    const monthlySavings = document.getElementById('monthlySavings');
    if (monthlySavings) {
        // 이미지 월간 로딩 횟수 예상 (시설당 평균 1000회)
        const monthlyLoadings = 1000;
        const dataPerMB = 100; // 1MB당 데이터 비용 (원)
        const estimatedMonthlySavings = Math.round((savedSize / 1024 / 1024) * monthlyLoadings * dataPerMB);
        
        monthlySavings.textContent = estimatedMonthlySavings.toLocaleString();
    }
    
    console.log('📊 상세 압축 통계:', {
        원본크기: formatFileSize(totalOriginalSize),
        압축크기: formatFileSize(totalCompressedSize),
        절약크기: formatFileSize(savedSize),
        압축률: compressionPercentage + '%',
        형식: format.toUpperCase(),
        품질: quality + '%'
    });
}

// 현재 선택된 파일들 가져오기
function getCurrentSelectedFiles() {
    if (window.FacilityImageMainController && typeof window.FacilityImageMainController.getSelectedFiles === 'function') {
        return window.FacilityImageMainController.getSelectedFiles();
    }
    
    // 대체 방법: DOM에서 추출
    const previewItems = document.querySelectorAll('.image-preview-item');
    return Array.from(previewItems).map(item => ({
        size: parseInt(item.dataset.size) || 1024000 // 기본 1MB
    }));
}

// SEO 파일명 생성
function generateSEOFilename() {
    const altText = document.getElementById('altText');
    const englishFilename = document.getElementById('englishFilename');
    
    if (altText && englishFilename && window.FacilityImageSEO) {
        const keywords = window.FacilityImageSEO.getKeywords();
        const filename = window.FacilityImageSEO.generateFileName(altText.value, keywords);
        englishFilename.value = filename;
    }
}

// 기존 파일 입력 업데이트 (호환성)
function updateExistingFileInput(uploadData) {
    if (!uploadData || !uploadData.files) return;
    
    const facilityImageFile = document.getElementById('facilityImageFile');
    const facilityImageAltText = document.getElementById('facilityImageAltText');
    
    if (facilityImageFile && uploadData.files.length > 0) {
        try {
            const dataTransfer = new DataTransfer();
            
            // 업로드된 파일들을 기존 입력에 설정
            uploadData.files.forEach(fileData => {
                if (fileData.croppedBlob || fileData.file) {
                    const blob = fileData.croppedBlob || fileData.file;
                    const fileName = fileData.englishFilename || fileData.name || 'facility-image.jpg';
                    
                    const file = new File([blob], fileName, {
                        type: blob.type || 'image/jpeg',
                        lastModified: Date.now()
                    });
                    
                    dataTransfer.items.add(file);
                    
                    // Alt 텍스트 설정 (첫 번째 파일의 것 사용)
                    if (facilityImageAltText && fileData.altText) {
                        facilityImageAltText.value = fileData.altText;
                    }
                }
            });
            
            facilityImageFile.files = dataTransfer.files;
            console.log('기존 파일 입력 업데이트 완료');
            
        } catch (error) {
            console.error('기존 파일 입력 업데이트 실패:', error);
        }
    }
}

// 향상된 성공 메시지 표시
function showSuccessMessage(message) {
    console.log('✅ 성공:', message);
    
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-success alert-dismissible fade show position-relative';
    alertDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        max-width: 400px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        border: none;
        border-radius: 8px;
    `;
    alertDiv.innerHTML = `
        <div class="d-flex align-items-center">
            <i class="fas fa-check-circle me-2 text-success fa-lg"></i>
            <div class="flex-grow-1">
                <strong>성공!</strong><br>
                <small>${message}</small>
            </div>
            <button type="button" class="btn-close ms-2" onclick="this.parentElement.parentElement.remove()"></button>
        </div>
    `;
    
    document.body.appendChild(alertDiv);
    
    // 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.style.opacity = '0';
            setTimeout(() => alertDiv.remove(), 300);
        }
    }, 4000);
}

// 향상된 에러 메시지 표시
function showErrorMessage(message) {
    console.error('❌ 에러:', message);
    
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-danger alert-dismissible fade show position-relative';
    alertDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        max-width: 400px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        border: none;
        border-radius: 8px;
    `;
    alertDiv.innerHTML = `
        <div class="d-flex align-items-center">
            <i class="fas fa-exclamation-triangle me-2 text-danger fa-lg"></i>
            <div class="flex-grow-1">
                <strong>오류!</strong><br>
                <small>${message}</small>
            </div>
            <button type="button" class="btn-close ms-2" onclick="this.parentElement.parentElement.remove()"></button>
        </div>
    `;
    
    document.body.appendChild(alertDiv);
    
    // 자동 제거 (에러는 더 오래 표시)
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.style.opacity = '0';
            setTimeout(() => alertDiv.remove(), 300);
        }
    }, 8000);
}

// 경고 메시지 표시
function showWarningMessage(message) {
    console.warn('⚠️ 경고:', message);
    
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-warning alert-dismissible fade show position-relative';
    alertDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        max-width: 400px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        border: none;
        border-radius: 8px;
    `;
    alertDiv.innerHTML = `
        <div class="d-flex align-items-center">
            <i class="fas fa-exclamation-circle me-2 text-warning fa-lg"></i>
            <div class="flex-grow-1">
                <strong>주의!</strong><br>
                <small>${message}</small>
            </div>
            <button type="button" class="btn-close ms-2" onclick="this.parentElement.parentElement.remove()"></button>
        </div>
    `;
    
    document.body.appendChild(alertDiv);
    
    // 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.style.opacity = '0';
            setTimeout(() => alertDiv.remove(), 300);
        }
    }, 6000);
}

// 정보 메시지 표시
function showInfoMessage(message) {
    console.info('ℹ️ 정보:', message);
    
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-info alert-dismissible fade show position-relative';
    alertDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        max-width: 400px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        border: none;
        border-radius: 8px;
    `;
    alertDiv.innerHTML = `
        <div class="d-flex align-items-center">
            <i class="fas fa-info-circle me-2 text-info fa-lg"></i>
            <div class="flex-grow-1">
                <strong>정보</strong><br>
                <small>${message}</small>
            </div>
            <button type="button" class="btn-close ms-2" onclick="this.parentElement.parentElement.remove()"></button>
        </div>
    `;
    
    document.body.appendChild(alertDiv);
    
    // 자동 제거
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.style.opacity = '0';
            setTimeout(() => alertDiv.remove(), 300);
        }
    }, 5000);
}

// 간단 업로드 토글 기능
document.addEventListener('DOMContentLoaded', function() {
    const useSimpleUpload = document.getElementById('useSimpleUpload');
    const simpleUploadContainer = document.getElementById('simpleUploadContainer');
    
    if (useSimpleUpload && simpleUploadContainer) {
        useSimpleUpload.addEventListener('change', function() {
            if (this.checked) {
                simpleUploadContainer.style.display = 'block';
            } else {
                simpleUploadContainer.style.display = 'none';
                // 파일 입력 초기화
                const fileInput = document.getElementById('facilityImageFile');
                if (fileInput) fileInput.value = '';
            }
        });
    }
    
    // 드래그앤드롭 영역 클릭 이벤트 제거 (중복 방지 - 모듈 시스템에서 처리)
    
    // 🔥 1단계 파일 압축 모듈
    function compressImageFile(file, quality = 0.8, maxWidth = 1920, maxHeight = 1080) {
        return new Promise((resolve, reject) => {
            // 이미지 파일이 아닌 경우 원본 반환
            if (!file.type.startsWith('image/')) {
                resolve(file);
                return;
            }
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                // 비율 유지하면서 리사이즈
                let { width, height } = img;
                
                if (width > maxWidth || height > maxHeight) {
                    const ratio = Math.min(maxWidth / width, maxHeight / height);
                    width *= ratio;
                    height *= ratio;
                }
                
                canvas.width = width;
                canvas.height = height;
                
                // 이미지 그리기
                ctx.drawImage(img, 0, 0, width, height);
                
                // 압축된 Blob 생성
                canvas.toBlob(
                    (blob) => {
                        if (blob) {
                            // 압축된 File 객체 생성
                            const compressedFile = new File([blob], file.name, {
                                type: blob.type,
                                lastModified: Date.now()
                            });
                            
                            console.log(`📦 압축 완료: ${file.name}`);
                            console.log(`   원본: ${(file.size / 1024 / 1024).toFixed(2)}MB → 압축: ${(compressedFile.size / 1024 / 1024).toFixed(2)}MB`);
                            console.log(`   압축률: ${(((file.size - compressedFile.size) / file.size) * 100).toFixed(1)}%`);
                            
                            resolve(compressedFile);
                        } else {
                            reject(new Error('압축 실패'));
                        }
                    },
                    'image/webp', // WebP 형식으로 압축 (최고 압축률)
                    quality
                );
            };
            
            img.onerror = () => reject(new Error('이미지 로드 실패'));
            
            // 파일을 이미지로 로드
            const reader = new FileReader();
            reader.onload = (e) => img.src = e.target.result;
            reader.onerror = () => reject(new Error('파일 읽기 실패'));
            reader.readAsDataURL(file);
        });
    }
    
    // 🔥 압축 진행 상황 UI 업데이트 함수
    function updateCompressionUI(progress) {
        const progressSection = document.getElementById('compressionProgress');
        const progressBar = document.getElementById('compressionProgressBar');
        const statusText = document.getElementById('compressionStatus');
        const statsDiv = document.getElementById('compressionStats');
        const resultSpan = document.getElementById('compressionResult');
        
        // 진행 상황 섹션 표시
        if (progressSection) {
            progressSection.style.display = 'block';
        }
        
        // 진행률 바 업데이트
        if (progressBar) {
            const percentage = Math.round((progress.current / progress.total) * 100);
            progressBar.style.width = percentage + '%';
            progressBar.setAttribute('aria-valuenow', percentage);
        }
        
        // 상태 텍스트 업데이트
        if (statusText) {
            if (progress.status === 'compressing') {
                statusText.innerHTML = `<i class="fas fa-compress fa-spin me-2"></i>압축 중... ${progress.current}/${progress.total} - ${progress.fileName}`;
            } else if (progress.status === 'completed') {
                statusText.innerHTML = `<i class="fas fa-check me-2"></i>압축 완료: ${progress.fileName}`;
            } else if (progress.status === 'error') {
                statusText.innerHTML = `<i class="fas fa-exclamation-triangle me-2"></i>오류: ${progress.fileName} - ${progress.error}`;
            }
        }
        
        // 완료 시 통계 표시
        if (progress.current === progress.total && progress.stats) {
            if (statsDiv && resultSpan) {
                const stats = progress.stats;
                resultSpan.textContent = `${(stats.originalSize / 1024 / 1024).toFixed(2)}MB → ${(stats.compressedSize / 1024 / 1024).toFixed(2)}MB (${stats.compressionRatio}% 절약)`;
                statsDiv.style.display = 'block';
            }
            
            // 상태 텍스트를 완료로 업데이트
            if (statusText) {
                statusText.innerHTML = `<i class="fas fa-check text-success me-2"></i>모든 파일 압축 완료! 잠시 후 크롭 페이지로 이동합니다...`;
            }
        }
    }
    
    // 🔥 압축 진행 상황 숨기기 함수
    function hideCompressionUI() {
        const progressSection = document.getElementById('compressionProgress');
        if (progressSection) {
            progressSection.style.display = 'none';
        }
    }
    
    // 🔥 다중 파일 압축 함수
    async function compressMultipleFiles(files, onProgress = null) {
        const compressedFiles = [];
        let totalOriginalSize = 0;
        let totalCompressedSize = 0;
        
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            totalOriginalSize += file.size;
            
            try {
                if (onProgress) {
                    onProgress({
                        current: i + 1,
                        total: files.length,
                        fileName: file.name,
                        status: 'compressing'
                    });
                }
                
                const compressedFile = await compressImageFile(file, 0.85, 1920, 1080);
                compressedFiles.push(compressedFile);
                totalCompressedSize += compressedFile.size;
                
                if (onProgress) {
                    onProgress({
                        current: i + 1,
                        total: files.length,
                        fileName: file.name,
                        status: 'completed'
                    });
                }
                
            } catch (error) {
                console.error(`❌ ${file.name} 압축 실패:`, error);
                
                if (onProgress) {
                    onProgress({
                        current: i + 1,
                        total: files.length,
                        fileName: file.name,
                        status: 'error',
                        error: error.message
                    });
                }
                
                // 압축 실패 시 원본 파일 사용
                compressedFiles.push(file);
                totalCompressedSize += file.size;
            }
        }
        
        const savedSize = totalOriginalSize - totalCompressedSize;
        const compressionRatio = ((savedSize / totalOriginalSize) * 100).toFixed(1);
        
        console.log('📊 전체 압축 결과:');
        console.log(`   원본 총 크기: ${(totalOriginalSize / 1024 / 1024).toFixed(2)}MB`);
        console.log(`   압축 총 크기: ${(totalCompressedSize / 1024 / 1024).toFixed(2)}MB`);
        console.log(`   절약된 크기: ${(savedSize / 1024 / 1024).toFixed(2)}MB (${compressionRatio}%)`);
        
        const stats = {
            originalSize: totalOriginalSize,
            compressedSize: totalCompressedSize,
            savedSize: savedSize,
            compressionRatio: parseFloat(compressionRatio)
        };
        
        // 최종 완료 시 UI 업데이트
        if (onProgress) {
            onProgress({
                current: files.length,
                total: files.length,
                status: 'completed',
                stats: stats
            });
        }
        
        return {
            files: compressedFiles,
            stats: stats
        };
    }
    
    // 🔥 메인 컨트롤러 moveToStep 함수 완전 덮어쓰기
    function overrideMainController() {
        if (window.FacilityImageMainController && window.FacilityImageMainController.moveToStep) {
            const originalMoveToStep = window.FacilityImageMainController.moveToStep;
            
            window.FacilityImageMainController.moveToStep = async function(step) {
                console.log(`🔄 moveToStep 호출됨: ${step}`);
                
                if (step === 2) {
                    console.log('🚫 2단계 이동 차단 - 새창 방식으로 전환');
                    
                    const facilityId = document.querySelector('meta[name="facility-id"]')?.content || '1';
                    
                    if (window.selectedImageFiles && window.selectedImageFiles.length > 0) {
                        console.log('📦 파일 압축 시작 - 1단계에서 처리');
                        
                        // 1단계 업로드 섹션 숨기기
                        const uploadSection = document.getElementById('uploadSection');
                        if (uploadSection) {
                            uploadSection.style.display = 'none';
                        }
                        
                        // 압축 진행 UI 표시
                        const compressionProgress = document.getElementById('compressionProgress');
                        if (compressionProgress) {
                            compressionProgress.style.display = 'block';
                        }
                        
                        // 압축 진행 표시를 위한 UI 업데이트
                        const proceedBtn = document.getElementById('proceedToStep2');
                        if (proceedBtn) {
                            proceedBtn.disabled = true;
                            proceedBtn.innerHTML = '<i class="fas fa-compress fa-spin me-1"></i>파일 압축 중...';
                        }
                        
                        try {
                            // 파일 압축 실행 (UI 업데이트 포함)
                            const compressionResult = await compressMultipleFiles(window.selectedImageFiles, (progress) => {
                                updateCompressionUI(progress);
                                if (proceedBtn) {
                                    proceedBtn.innerHTML = `<i class="fas fa-compress fa-spin me-1"></i>압축 중... ${progress.current}/${progress.total}`;
                                }
                            });
                            
                            const compressedFiles = compressionResult.files;
                            const stats = compressionResult.stats;
                            
                            // 압축된 파일을 Base64로 변환하여 세션 저장
                            const fileDataArray = [];
                            let processedCount = 0;
                            
                            if (proceedBtn) {
                                proceedBtn.innerHTML = '<i class="fas fa-upload fa-spin me-1"></i>세션 저장 중...';
                            }
                            
                            for (let i = 0; i < compressedFiles.length; i++) {
                                const file = compressedFiles[i];
                                const reader = new FileReader();
                                
                                reader.onload = function(e) {
                                    fileDataArray[i] = {
                                        name: file.name,
                                        type: file.type,
                                        size: file.size,
                                        data: e.target.result,
                                        originalSize: window.selectedImageFiles[i]?.size || file.size
                                    };
                                    processedCount++;
                                    
                                    if (proceedBtn) {
                                        const progress = Math.round((processedCount / compressedFiles.length) * 100);
                                        proceedBtn.innerHTML = `<i class="fas fa-upload fa-spin me-1"></i>세션 저장 중... ${progress}%`;
                                    }
                                    
                                    // 모든 파일 처리 완료
                                    if (processedCount === compressedFiles.length) {
                                        try {
                                            sessionStorage.setItem('selectedImageFiles', JSON.stringify(fileDataArray));
                                            
                                            // 압축 통계도 함께 저장
                                            sessionStorage.setItem('compressionStats', JSON.stringify(stats));
                                            
                                            console.log('✅ 압축 및 세션 저장 완료, 크롭 페이지로 이동');
                                            console.log(`📊 압축 효과: ${(stats.originalSize / 1024 / 1024).toFixed(2)}MB → ${(stats.compressedSize / 1024 / 1024).toFixed(2)}MB (${stats.compressionRatio}% 절약)`);
                                            
                                            // 잠시 후 페이지 이동
                                            setTimeout(() => {
                                                window.location.href = `/facility/crop-images/${facilityId}`;
                                            }, 1000);
                                            
                                        } catch (storageError) {
                                            console.error('❌ 세션 저장 실패:', storageError);
                                            
                                            // 세션 저장 실패 시 전역 변수 사용
                                            window.transferSelectedFiles = compressedFiles;
                                            window.transferCompressionStats = stats;
                                            
                                            if (proceedBtn) {
                                                proceedBtn.innerHTML = '<i class="fas fa-exclamation-triangle me-1"></i>저장 실패 - 직접 이동';
                                            }
                                            
                                            setTimeout(() => {
                                                window.location.href = `/facility/crop-images/${facilityId}`;
                                            }, 1000);
                                        }
                                    }
                                };
                                
                                reader.onerror = function() {
                                    console.error(`❌ 파일 읽기 실패: ${file.name}`);
                                    processedCount++;
                                    
                                    if (processedCount === compressedFiles.length) {
                                        console.log('⚠️ 일부 파일 읽기 실패 - 가능한 파일로 진행');
                                        window.transferSelectedFiles = compressedFiles;
                                        window.location.href = `/facility/crop-images/${facilityId}`;
                                    }
                                };
                                
                                reader.readAsDataURL(file);
                            }
                            
                        } catch (compressionError) {
                            console.error('❌ 파일 압축 실패:', compressionError);
                            
                            // 압축 실패 시 원본 파일로 진행
                            window.transferSelectedFiles = window.selectedImageFiles;
                            
                            if (proceedBtn) {
                                proceedBtn.innerHTML = '<i class="fas fa-exclamation-triangle me-1"></i>압축 실패 - 원본으로 진행';
                                proceedBtn.disabled = false;
                            }
                            
                            setTimeout(() => {
                                window.location.href = `/facility/crop-images/${facilityId}`;
                            }, 1000);
                        }
                        
                    } else {
                        console.log('⚠️ 선택된 파일이 없어 빈 크롭 페이지로 이동');
                        window.location.href = `/facility/${facilityId}/crop-images`;
                    }
                    
                    return; // 여기서 함수 종료
                }
                
                // 다른 단계는 원래 함수 실행
                return originalMoveToStep.call(this, step);
            };
            
            console.log('✅ 메인 컨트롤러 moveToStep 함수 덮어쓰기 완료');
        }
    }
    
    // 메인 컨트롤러 감시 및 덮어쓰기
    const controllerObserver = setInterval(function() {
        if (window.FacilityImageMainController && window.FacilityImageMainController.moveToStep) {
            overrideMainController();
            clearInterval(controllerObserver);
        }
    }, 100);
    
    // 즉시 실행도 시도
    overrideMainController();
    
    // 🔥 새창 방식 강제 구현: 메인 컨트롤러 우회 (안전 장치 포함)
    function forceNewWindowApproach() {
        try {
            const proceedButton = document.getElementById('proceedToStep2');
            if (!proceedButton) {
                console.warn('⚠️ proceedToStep2 버튼을 찾을 수 없습니다.');
                return false;
            }
            
            // 이미 덮어쓰기 처리된 버튼인지 확인
            if (proceedButton.hasAttribute('data-overridden')) {
                console.log('🔄 이미 새창 방식으로 설정된 버튼');
                return true;
            }
            
            // 기존 모든 이벤트 리스너 제거 (안전하게)
            const newButton = proceedButton.cloneNode(true);
            if (proceedButton.parentNode) {
                proceedButton.parentNode.replaceChild(newButton, proceedButton);
            } else {
                console.error('❌ 버튼의 부모 요소를 찾을 수 없습니다.');
                return false;
            }
            
            // 새로운 이벤트 리스너 등록
            newButton.addEventListener('click', function(e) {
                try {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    
                        console.log('🔄 새창 방식 강제 실행: 크롭 페이지로 이동');
                    
                    const facilityId = document.querySelector('meta[name="facility-id"]')?.content || '1';
                    
                    if (window.selectedImageFiles && window.selectedImageFiles.length > 0) {
                        const fileDataArray = [];
                        let processedCount = 0;
                        
                        newButton.disabled = true;
                        newButton.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>파일 준비 중...';
                        
                        window.selectedImageFiles.forEach((file, index) => {
                            try {
                                const reader = new FileReader();
                                reader.onload = function(e) {
                                    try {
                                        fileDataArray[index] = {
                                            name: file.name,
                                            type: file.type,
                                            size: file.size,
                                            data: e.target.result
                                        };
                                        processedCount++;
                                        
                                        const progress = Math.round((processedCount / window.selectedImageFiles.length) * 100);
                                        newButton.innerHTML = `<i class="fas fa-spinner fa-spin me-1"></i>파일 준비 중... ${progress}%`;
                                        
                                        if (processedCount === window.selectedImageFiles.length) {
                                            sessionStorage.setItem('selectedImageFiles', JSON.stringify(fileDataArray));
                                            console.log('✅ 파일 세션 저장 완료, 크롭 페이지로 이동');
                                            window.location.href = `/facility/crop-images/${facilityId}`;
                                        }
                                    } catch (error) {
                                        console.error('❌ 파일 처리 중 오류:', error);
                                        newButton.innerHTML = '<i class="fas fa-exclamation-triangle me-1"></i>파일 처리 오류';
                                        newButton.disabled = false;
                                    }
                                };
                                reader.onerror = function() {
                                    console.error('❌ 파일 읽기 오류:', file.name);
                                    newButton.innerHTML = '<i class="fas fa-exclamation-triangle me-1"></i>파일 읽기 오류';
                                    newButton.disabled = false;
                                };
                                reader.readAsDataURL(file);
                            } catch (error) {
                                console.error('❌ FileReader 초기화 오류:', error);
                                newButton.innerHTML = '<i class="fas fa-exclamation-triangle me-1"></i>파일 처리 오류';
                                newButton.disabled = false;
                            }
                        });
                    } else {
                        console.log('⚠️ 선택된 파일이 없어 빈 크롭 페이지로 이동');
                        window.location.href = `/facility/${facilityId}/crop-images`;
                    }
                } catch (error) {
                    console.error('❌ 버튼 클릭 처리 중 오류:', error);
                    // 폴백: 기본 이동
                    const facilityId = document.querySelector('meta[name="facility-id"]')?.content || '1';
                    window.location.href = `/facility/${facilityId}/crop-images`;
                }
            }, true);
            
            // 덮어쓰기 완료 마킹
            newButton.setAttribute('data-overridden', 'true');
            console.log('✅ 새창 방식 버튼 이벤트 리스너 등록 완료');
            return true;
            
        } catch (error) {
            console.error('❌ 새창 방식 버튼 덮어쓰기 중 오류:', error);
            return false;
        }
    }
    
    // 버튼 감시 및 덮어쓰기 (안전 장치 포함)
    let buttonObserver = null;
    try {
        buttonObserver = new MutationObserver(function(mutations) {
            try {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        const proceedButton = document.getElementById('proceedToStep2');
                        if (proceedButton && !proceedButton.hasAttribute('data-overridden')) {
                            forceNewWindowApproach();
                        }
                    }
                });
            } catch (error) {
                console.error('❌ MutationObserver 처리 중 오류:', error);
            }
        });
        
        buttonObserver.observe(document.body, {
            childList: true,
            subtree: true
        });
    } catch (error) {
        console.error('❌ MutationObserver 설정 중 오류:', error);
    }
    
    // 즉시 실행 (안전하게)
    setTimeout(function() {
        try {
            forceNewWindowApproach();
        } catch (error) {
            console.error('❌ 즉시 실행 중 오류:', error);
        }
    }, 100);
    
    // 주기적으로 확인 (메인 컨트롤러가 늦게 로드될 수 있음)
    let retryCount = 0;
    const maxRetries = 20; // 최대 10초 동안 시도
    
    const retryInterval = setInterval(function() {
        try {
            retryCount++;
            const proceedButton = document.getElementById('proceedToStep2');
            if (proceedButton && !proceedButton.hasAttribute('data-overridden')) {
                const success = forceNewWindowApproach();
                if (success) {
                    console.log('✅ 새창 방식 버튼 설정 완료');
                    clearInterval(retryInterval);
                }
            }
            
            // 최대 재시도 횟수 초과시 정리
            if (retryCount >= maxRetries) {
                console.log('⚠️ 새창 방식 버튼 설정 재시도 완료');
                clearInterval(retryInterval);
            }
        } catch (error) {
            console.error('❌ 주기적 확인 중 오류:', error);
        }
    }, 500);
    
    // 저장된 이미지들을 로드하고 표시하는 함수
    function loadSavedImages() {
        const savedImages = sessionStorage.getItem('savedImages');
        if (savedImages) {
            try {
                const images = JSON.parse(savedImages);
                displaySavedImages(images);
                
                // 세션 스토리지 정리
                sessionStorage.removeItem('savedImages');
                
                console.log('✅ 저장된 이미지 표시 완료:', images.length + '개');
                
            } catch (error) {
                console.error('❌ 저장된 이미지 로드 실패:', error);
            }
        }
    }
    
    // 저장된 이미지들을 화면에 표시하는 함수  
    function displaySavedImages(images) {
        if (!images || images.length === 0) {
            return;
        }
        
        const savedImagesSection = document.getElementById('savedImagesSection');
        const savedImagesGrid = document.getElementById('savedImagesGrid');
        const savedImageCount = document.getElementById('savedImageCount');
        
        if (!savedImagesSection || !savedImagesGrid || !savedImageCount) {
            console.error('❌ 저장된 이미지 섹션 DOM 요소를 찾을 수 없습니다');
            return;
        }
        
        // 카운트 업데이트
        savedImageCount.textContent = images.length + '개';
        
        // 이미지 카드들 생성
        let html = '';
        images.forEach((image, index) => {
            const imageUrl = image.url || image.path || '/images/default_facility.jpg';
            const imageName = image.name || `이미지 ${index + 1}`;
            const altText = image.altText || image.seoData?.altText || '';
            const keywords = image.keywords || image.seoData?.keywords || [];
            const isMain = image.isMain || index === 0;
            
            html += `
                <div class="col-md-6 col-lg-4">
                    <div class="card saved-image-card h-100">
                        <div class="position-relative">
                            <img src="${imageUrl}" class="card-img-top" alt="${altText}" 
                                 style="height: 200px; object-fit: cover;">
                            ${isMain ? '<span class="badge bg-warning position-absolute top-0 end-0 m-2">메인</span>' : ''}
                        </div>
                        <div class="card-body p-3">
                            <h6 class="card-title text-truncate">${imageName}</h6>
                            ${altText ? `<p class="card-text small text-muted mb-2">${altText}</p>` : ''}
                            ${keywords.length > 0 ? `
                                <div class="mb-2">
                                    ${keywords.map(keyword => `<span class="badge bg-light text-dark me-1">${keyword}</span>`).join('')}
                                </div>
                            ` : ''}
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">
                                    <i class="fas fa-check-circle text-success me-1"></i>저장됨
                                </small>
                                <button type="button" class="btn btn-sm btn-outline-danger" 
                                        onclick="removeSavedImage(${index})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        
        savedImagesGrid.innerHTML = html;
        savedImagesSection.style.display = 'block';
        
        // 저장된 이미지가 있으면 기본 업로드 섹션을 축소
        const uploadSection = document.getElementById('uploadSection');
        if (uploadSection) {
            uploadSection.style.opacity = '0.6';
        }
    }
    
    // 저장된 이미지 삭제 함수
    function removeSavedImage(index) {
        if (confirm('이 이미지를 삭제하시겠습니까?')) {
            const savedImages = getCurrentSavedImages();
            if (savedImages && savedImages.length > index) {
                savedImages.splice(index, 1);
                displaySavedImages(savedImages);
                
                if (savedImages.length === 0) {
                    document.getElementById('savedImagesSection').style.display = 'none';
                    const uploadSection = document.getElementById('uploadSection');
                    if (uploadSection) {
                        uploadSection.style.opacity = '1';
                    }
                }
            }
        }
    }
    
    // 현재 저장된 이미지 목록 가져오기
    function getCurrentSavedImages() {
        const savedImagesGrid = document.getElementById('savedImagesGrid');
        if (!savedImagesGrid) return [];
        
        // DOM에서 현재 이미지 정보 추출 (단순화)
        const imageCards = savedImagesGrid.querySelectorAll('.saved-image-card');
        const images = [];
        
        imageCards.forEach((card, index) => {
            const img = card.querySelector('.card-img-top');
            const title = card.querySelector('.card-title');
            const altText = card.querySelector('.card-text');
            const keywords = Array.from(card.querySelectorAll('.badge')).map(badge => badge.textContent);
            
            if (img) {
                images.push({
                    url: img.src,
                    name: title ? title.textContent : `이미지 ${index + 1}`,
                    altText: altText ? altText.textContent : '',
                    keywords: keywords,
                    isMain: card.querySelector('.badge.bg-warning') !== null
                });
            }
        });
        
        return images;
    }
    
    // 크롭 페이지로 이동하는 함수
    function openImageCropPage() {
        const facilityId = getFacilityId();
        if (!facilityId) {
            alert('시설 정보를 찾을 수 없습니다.');
            return;
        }
        
        console.log('🖼️ 이미지 크롭 페이지로 이동:', facilityId);
        window.location.href = `/facility/crop-images/${facilityId}`;
    }
    
    // 시설 ID 가져오기 헬퍼 함수
    function getFacilityId() {
        // 메타 태그에서 추출
        const facilityIdMeta = document.querySelector('meta[name="facility-id"]');
        if (facilityIdMeta && facilityIdMeta.getAttribute('content')) {
            return facilityIdMeta.getAttribute('content');
        }
        
        // 폼 action URL에서 추출
        const form = document.getElementById('facilityEditForm');
        if (form && form.action) {
            const match = form.action.match(/\/facility\/edit\/(\d+)/);
            if (match && match[1]) {
                return match[1];
            }
        }
        
        return null;
    }
    
    // 전역 함수로 등록
    window.openImageCropPage = openImageCropPage;
    window.removeSavedImage = removeSavedImage;
    
    // 페이지 로드 시 저장된 이미지 확인
    setTimeout(loadSavedImages, 1000);
    
});
</script>

</body>
</html>
````

## File: src/main/java/com/example/carelink/service/MemberService.java
````java
package com.example.carelink.service;

import com.example.carelink.dao.MemberMapper;
import com.example.carelink.dao.FacilityMapper;
import com.example.carelink.dao.BoardMapper;
import com.example.carelink.dao.ReviewMapper;
import com.example.carelink.dao.JobMapper;
import com.example.carelink.dto.LoginDTO;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.dto.FacilityDTO;
import org.springframework.web.multipart.MultipartFile;
import java.io.File;
import java.io.IOException;
import java.util.UUID;
import com.example.carelink.dto.BoardDTO;
import com.example.carelink.dto.ReviewDTO;
import com.example.carelink.dto.JobDTO;
import com.example.carelink.common.Constants;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import java.util.List; // List 유지 (페이징, 역할별 조회)
import java.util.Map; // Map 인터페이스
import java.util.HashMap; // HashMap 클래스
import java.util.ArrayList; // ArrayList 클래스
import java.util.UUID; // UUID 유지 (파일 이름 생성)

/**
 * 회원 관리 서비스
 * 팀원 A 담당: 회원 관리 비즈니스 로직
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class MemberService {

    private final MemberMapper memberMapper;
    private final FacilityMapper facilityMapper;
    private final BoardMapper boardMapper;
    private final ReviewMapper reviewMapper;
    private final JobMapper jobMapper;
    private final PasswordEncoder passwordEncoder; // 비밀번호 암호화를 위해 주입


    /**
     * 로그인 처리
     */
    public MemberDTO login(LoginDTO loginDTO) {
        try {
            MemberDTO member = memberMapper.findByUserId(loginDTO.getUserId());

            if (member == null) {
                log.warn("로그인 실패: 존재하지 않는 사용자 ID: {}", loginDTO.getUserId());
                return null;
            }

            if (member.getIsDeleted() != null && member.getIsDeleted()) {
                log.warn("로그인 실패: 삭제 처리된 계정입니다. ID: {}", loginDTO.getUserId());
                return null;
            }

            if (member.getIsActive() != null && !member.getIsActive()) {
                log.warn("로그인 실패: 비활성화된 계정: {}", loginDTO.getUserId());
                return null;
            }

            if (member.getLoginFailCount() >= Constants.MAX_LOGIN_ATTEMPTS) {
                log.warn("로그인 실패: 로그인 시도 횟수 초과. ID: {}", loginDTO.getUserId());
                return null;
            }

            // 비밀번호 검증 (개발용: 평문 비교)
            log.info("=== 비밀번호 검증 디버그 ===");
            log.info("DB 저장된 비밀번호: {}", member.getPassword());
            log.info("입력된 비밀번호: {}", loginDTO.getPassword());
            
            // 개발용: 평문 비밀번호 비교
            boolean passwordMatches = loginDTO.getPassword().equals(member.getPassword());
            log.info("비밀번호 매칭 결과: {}", passwordMatches);
            
            if (passwordMatches) {
                memberMapper.updateLoginSuccess(member.getMemberId());
                log.info("로그인 성공: {}", loginDTO.getUserId());
                return member;
            } else {
                memberMapper.updateLoginFail(member.getMemberId());
                log.warn("로그인 실패: 비밀번호 불일치. ID: {}, DB 비밀번호 시작: {}", 
                    loginDTO.getUserId(), member.getPassword().substring(0, Math.min(10, member.getPassword().length())));
                return null;
            }

        } catch (Exception e) {
            log.error("로그인 처리 중 오류 발생: {}", loginDTO.getUserId(), e);
            throw new RuntimeException("로그인 처리 중 오류가 발생했습니다.", e);
        }
    }

    /**
     * 회원가입 처리 (기존 메서드 - 파일 없이)
     */
    @Transactional
    public void join(MemberDTO memberDTO) {
        join(memberDTO, null);
    }

    /**
     * 회원가입 처리 (파일 포함)
     */
    @Transactional
    public void join(MemberDTO memberDTO, MultipartFile facilityImageFile) {
        try {
            log.info("회원가입 처리 시작 - userId: {}, address: {}, detailAddress: {}", 
                    memberDTO.getUserId(), memberDTO.getAddress(), memberDTO.getDetailAddress());
            
            // 1. 아이디 중복 확인
            if (isUserIdDuplicate(memberDTO.getUserId())) {
                throw new IllegalArgumentException("이미 사용중인 아이디입니다.");
            }

            // 2. 이메일 중복 확인 (이메일이 제공된 경우에만)
            if (memberDTO.getEmail() != null && !memberDTO.getEmail().trim().isEmpty()) {
                if (memberMapper.existsByEmail(memberDTO.getEmail())) {
                    throw new IllegalArgumentException("이미 사용중인 이메일입니다.");
                }
            }

            // 3. 비밀번호 처리 (개발용: 평문 저장)
            // 나중에 배포할 때 passwordEncoder.encode() 사용
            // String encodedPassword = passwordEncoder.encode(memberDTO.getPassword());
            // memberDTO.setPassword(encodedPassword);

            // 4. 기타 필드 기본값 설정 (DDL의 DEFAULT 값과 일치하도록 명시적 설정)
            // memberId는 AUTO_INCREMENT이므로 null로 설정하여 DB가 자동 생성하도록 합니다.
            memberDTO.setMemberId(null); // 이 라인을 추가하여 memberId가 null로 시작하도록 합니다.

            if (memberDTO.getRole() == null || memberDTO.getRole().isEmpty()) {
                memberDTO.setRole(Constants.MEMBER_ROLE_USER); // Constants.MEMBER_ROLE_USER는 "USER" 문자열을 반환한다고 가정
            }
            memberDTO.setIsActive(true); // SQL DEFAULT TRUE
            memberDTO.setLoginFailCount(0); // SQL DEFAULT 0
            memberDTO.setIsDeleted(false); // SQL DEFAULT FALSE

            // DDL에 따라 NULL을 허용하는 필드에 값이 없으면 명시적으로 null 설정
            if (memberDTO.getPhone() != null && memberDTO.getPhone().isEmpty()) {
                memberDTO.setPhone(null);
            }
            if (memberDTO.getAddress() != null && memberDTO.getAddress().isEmpty()) {
                memberDTO.setAddress(null);
            }
            if (memberDTO.getDetailAddress() != null && memberDTO.getDetailAddress().isEmpty()) {
                memberDTO.setDetailAddress(null);
            }
            memberDTO.setProfileImage(null); // 프로필 이미지는 폼에서 직접 받지 않는다면 null로 설정

            // lastLoginAt은 회원가입 시에는 null로 설정
            memberDTO.setLastLoginAt(null);

            // created_at, updated_at은 DB DEFAULT CURRENT_TIMESTAMP이므로 DTO에 설정해도 DB가 우선합니다.
            // 명시적으로 설정해도 무방하나, DB의 자동 생성 기능을 신뢰하는 것이 일반적입니다.
            // memberDTO.setCreatedAt(LocalDateTime.now());
            // memberDTO.setUpdatedAt(LocalDateTime.now());


            log.info("DB 저장 전 memberDTO - address: {}, detailAddress: {}", 
                    memberDTO.getAddress(), memberDTO.getDetailAddress());
            
            // 5. Mapper를 통해 데이터베이스에 저장
            int result = memberMapper.insertMember(memberDTO);
            if (result == 0) { // insert 쿼리의 반환값(영향받은 행 수)이 0이면 실패
                throw new RuntimeException("회원가입 데이터 저장에 실패했습니다. (영향받은 행 없음)");
            }
            
            log.info("회원가입 DB 저장 성공 - memberId: {}", memberDTO.getMemberId());
            
            // 6. 시설회원인 경우 시설 정보도 저장
            if (Constants.MEMBER_ROLE_FACILITY.equals(memberDTO.getRole()) && memberDTO.getFacilityName() != null) {
                FacilityDTO facilityDTO = new FacilityDTO();
                facilityDTO.setFacilityName(memberDTO.getFacilityName());
                facilityDTO.setFacilityType(memberDTO.getFacilityType());
                facilityDTO.setAddress(memberDTO.getAddress());
                facilityDTO.setDetailAddress(memberDTO.getDetailAddress());
                facilityDTO.setPhone(memberDTO.getFacilityPhone());
                facilityDTO.setDescription(memberDTO.getDescription());
                facilityDTO.setHomepage(memberDTO.getHomepage());
                facilityDTO.setCapacity(memberDTO.getCapacity());
                facilityDTO.setOperatingHours(memberDTO.getOperatingHours());
                facilityDTO.setFeatures(memberDTO.getFeatures());
                // 위도/경도 설정 추가
                facilityDTO.setLatitude(memberDTO.getLatitude());
                facilityDTO.setLongitude(memberDTO.getLongitude());
                facilityDTO.setRegisteredMemberId(memberDTO.getMemberId());
                facilityDTO.setIsApproved(false); // 기본값: 승인 대기
                facilityDTO.setApprovalStatus("PENDING");
                
                // 시설 이미지 파일 처리
                if (facilityImageFile != null && !facilityImageFile.isEmpty()) {
                    String imagePath = saveFacilityImage(facilityImageFile, memberDTO.getUserId());
                    facilityDTO.setFacilityImage(imagePath);
                }
                
                int facilityResult = facilityMapper.insertFacility(facilityDTO);
                if (facilityResult == 0) {
                    throw new RuntimeException("시설 정보 저장에 실패했습니다.");
                }
                log.info("시설 정보 저장 성공: {}", facilityDTO.getFacilityName());
            }
            
            log.info("회원가입 성공: {}", memberDTO.getUserId());

        } catch (IllegalArgumentException e) { // 아이디/이메일 중복 등 비즈니스 로직 예외
            log.warn("회원가입 실패 (비즈니스 로직): {}", e.getMessage());
            throw e; // 호출한 곳으로 예외를 다시 던짐
        } catch (Exception e) { // 그 외 예상치 못한 모든 예외
            log.error("회원가입 처리 중 알 수 없는 오류 발생: {}", memberDTO.getUserId(), e);
            // 더 구체적인 오류 메시지를 사용자에게 전달하기 위해 예외를 래핑할 수 있습니다.
            throw new RuntimeException("회원가입 처리 중 알 수 없는 오류가 발생했습니다. 잠시 후 다시 시도해주세요.", e);
        }
    }

    /**
     * 사용자 ID 중복 체크
     */
    @Transactional(readOnly = true)
    public boolean isUserIdDuplicate(String userId) {
        try {
            // existsByUserId 메서드 사용으로 변경
            return memberMapper.existsByUserId(userId);
        } catch (Exception e) {
            log.error("사용자 ID 중복 체크 중 오류 발생: {}", userId, e);
            throw new RuntimeException("중복 체크 중 오류가 발생했습니다.", e);
        }
    }

    /**
     * 회원 ID로 회원 정보 조회 (유지)
     */
    @Transactional(readOnly = true)
    public MemberDTO findById(Long memberId) {
        try {
            return memberMapper.findById(memberId);
        } catch (Exception e) {
            log.error("회원 정보 조회 중 오류 발생: {}", memberId, e);
            throw new RuntimeException("회원 정보 조회 중 오류가 발생했습니다.", e);
        }
    }

    /**
     * 사용자 ID로 회원 정보 조회 (컨트롤러에서 Principal 사용 시 호출 - Principal 사용 안 하면 DTO 그대로 반환)
     * Principal을 사용하지 않더라도, userId로 정보를 조회하는 로직이 필요할 수 있으므로 유지
     */
    @Transactional(readOnly = true)
    public MemberDTO getMemberByUserId(String userId) {
        try {
            return memberMapper.findByUserId(userId);
        } catch (Exception e) {
            log.error("사용자 ID로 회원 정보 조회 중 오류 발생: {}", userId, e);
            throw new RuntimeException("회원 정보 조회 중 오류가 발생했습니다.", e);
        }
    }

    /**
     * 회원 정보 수정 (프로필 이미지 파일 처리 로직 포함) (유지)
     */
    public void updateMember(MemberDTO memberDTO, MultipartFile profileImageFile) throws Exception {
        log.info("회원정보 수정 요청: memberId={}, name={}, email={}", 
                memberDTO.getMemberId(), memberDTO.getName(), memberDTO.getEmail());
        
        MemberDTO existingMember = memberMapper.findById(memberDTO.getMemberId());
        if (existingMember == null) {
            throw new IllegalArgumentException("존재하지 않는 회원입니다.");
        }
        
        log.info("기존 회원 정보: memberId={}, name={}, email={}", 
                existingMember.getMemberId(), existingMember.getName(), existingMember.getEmail());

        // 비밀번호는 이 메서드에서 변경하지 않음 (기존 비밀번호 유지)
        memberDTO.setPassword(existingMember.getPassword());
        
        // 권한과 기타 중요 정보는 기존 값 유지
        memberDTO.setRole(existingMember.getRole());
        memberDTO.setIsActive(existingMember.getIsActive());
        memberDTO.setIsDeleted(existingMember.getIsDeleted());
        memberDTO.setLoginFailCount(existingMember.getLoginFailCount());
        memberDTO.setLastLoginAt(existingMember.getLastLoginAt());
        memberDTO.setCreatedAt(existingMember.getCreatedAt());

        if (profileImageFile != null && !profileImageFile.isEmpty()) {
            // 프로필 이미지 저장 (새로운 방식 사용)
            String profileImagePath = saveProfileImage(profileImageFile, existingMember.getUserId());
            memberDTO.setProfileImage(profileImagePath);
            
            // 기존 프로필 이미지 삭제 (기존 이미지가 있고, 새 이미지가 업로드된 경우)
            if (existingMember.getProfileImage() != null && !existingMember.getProfileImage().isEmpty()) {
                try {
                    // 기존 파일 삭제
                    String projectRoot = System.getProperty("user.dir");
                    String oldImagePath = existingMember.getProfileImage();
                    if (oldImagePath.startsWith("/uploads/profile/")) {
                        String oldFileName = oldImagePath.substring("/uploads/profile/".length());
                        File oldFile = new File(projectRoot + "/src/main/resources/static" + oldImagePath);
                        if (oldFile.exists() && oldFile.delete()) {
                            log.info("기존 프로필 이미지 삭제 성공: {}", oldFile.getAbsolutePath());
                        }
                    }
                } catch (Exception e) {
                    log.warn("기존 프로필 이미지 삭제 실패: {}", e.getMessage());
                }
            }
        } else {
            // 새 이미지가 없으면 기존 이미지 경로 유지
            memberDTO.setProfileImage(existingMember.getProfileImage());
            log.debug("새로운 프로필 이미지가 없어 기존 이미지 유지: {}", existingMember.getProfileImage());
        }
        
        log.info("업데이트할 회원 정보: memberId={}, name={}, email={}, phone={}, address={}", 
                memberDTO.getMemberId(), memberDTO.getName(), memberDTO.getEmail(), 
                memberDTO.getPhone(), memberDTO.getAddress());

        int result = memberMapper.updateMember(memberDTO);
        log.info("회원정보 업데이트 쿼리 실행 결과: {} 행이 영향받음", result);
        
        if (result == 0) {
            throw new RuntimeException("회원 정보 수정에 실패했습니다. 영향받은 행: 0");
        }
        log.info("회원정보 수정 완료: userId={}, memberId={}", memberDTO.getUserId(), memberDTO.getMemberId());
    }

    /**
     * 비밀번호 변경 처리 (유지)
     */
    @Transactional
    public void changePassword(String userId, String currentPassword, String newPassword, String confirmNewPassword) {
        MemberDTO member = memberMapper.findByUserId(userId);
        if (member == null) {
            throw new IllegalArgumentException("사용자를 찾을 수 없습니다.");
        }

        // 현재 비밀번호 확인 (개발 환경에서는 평문 비교)
        if (!currentPassword.equals(member.getPassword())) {
            throw new IllegalArgumentException("현재 비밀번호가 일치하지 않습니다.");
        }

        if (!newPassword.equals(confirmNewPassword)) {
            throw new IllegalArgumentException("새 비밀번호와 확인 비밀번호가 일치하지 않습니다.");
        }

        if (newPassword.length() < 8) {
            throw new IllegalArgumentException("새 비밀번호는 최소 8자 이상이어야 합니다.");
        }

        // 개발 환경에서는 평문으로 저장
        member.setPassword(newPassword);
        int result = memberMapper.updatePassword(member);
        if (result == 0) {
            throw new RuntimeException("비밀번호 변경에 실패했습니다.");
        }
        log.info("비밀번호 변경 서비스: {} 사용자의 비밀번호가 성공적으로 변경됨.", userId);
    }

    /**
     * 사용자가 작성한 콘텐츠 개수 조회
     */
    @Transactional(readOnly = true)
    public Map<String, Integer> getUserContentCounts(Long memberId) {
        Map<String, Integer> counts = new HashMap<>();
        try {
            // 각 매퍼에서 콘텐츠 개수 조회
            List<BoardDTO> boards = boardMapper.findBoardsByMemberId(memberId);
            List<ReviewDTO> reviews = reviewMapper.findReviewsByMemberId(memberId);
            List<JobDTO> jobs = jobMapper.findJobsByMemberId(memberId);
            
            int boardCount = boards != null ? boards.size() : 0;
            int reviewCount = reviews != null ? reviews.size() : 0;
            int jobCount = jobs != null ? jobs.size() : 0;
            
            counts.put("board", boardCount);
            counts.put("review", reviewCount);
            counts.put("job", jobCount);
            counts.put("total", boardCount + reviewCount + jobCount);
            
            log.info("사용자 콘텐츠 개수 조회: memberId={}, 결과={}", memberId, counts);
            return counts;
            
        } catch (Exception e) {
            log.error("콘텐츠 개수 조회 중 오류: memberId={}", memberId, e);
            // 오류 시 기본값 반환
            counts.put("board", 0);
            counts.put("review", 0);
            counts.put("job", 0);
            counts.put("total", 0);
            return counts;
        }
    }
    
    /**
     * 내가 쓴 글 조회 (유형별 필터링 및 페이징)
     */
    @Transactional(readOnly = true)
    public Map<String, Object> getMyPosts(Long memberId, String type, int page, int pageSize, int offset) {
        Map<String, Object> result = new HashMap<>();
        List<Map<String, Object>> posts = new ArrayList<>();
        
        try {
            // 콘텐츠 타입별 개수 조회
            Map<String, Integer> contentCounts = getUserContentCounts(memberId);
            result.put("contentCounts", contentCounts);
            
            if ("board".equals(type)) {
                // 게시글만 조회
                List<BoardDTO> boards = boardMapper.findBoardsByMemberId(memberId);
                for (BoardDTO board : boards) {
                    Map<String, Object> post = new HashMap<>();
                    post.put("id", board.getBoardId());
                    post.put("title", board.getTitle());
                    post.put("content", board.getContent());
                    post.put("createdAt", board.getCreatedAt());
                    post.put("viewCount", board.getViewCount() != null ? board.getViewCount() : 0);
                    post.put("likeCount", board.getLikeCount() != null ? board.getLikeCount() : 0);
                    post.put("rating", null); // 게시글에는 평점 없음
                    post.put("salary", null); // 게시글에는 급여 없음
                    post.put("type", "board");
                    post.put("category", board.getBoardType());
                    post.put("url", "/board/detail/" + board.getBoardId());
                    posts.add(post);
                }
            } else if ("review".equals(type)) {
                // 리뷰만 조회
                List<ReviewDTO> reviews = reviewMapper.findReviewsByMemberId(memberId);
                for (ReviewDTO review : reviews) {
                    Map<String, Object> post = new HashMap<>();
                    post.put("id", review.getReviewId());
                    post.put("title", review.getTitle());
                    post.put("content", review.getContent());
                    post.put("createdAt", review.getCreatedAt());
                    post.put("viewCount", null); // 리뷰에는 조회수 없음
                    post.put("likeCount", review.getLikeCount() != null ? review.getLikeCount() : 0);
                    post.put("rating", review.getRating());
                    post.put("salary", null); // 리뷰에는 급여 없음
                    post.put("type", "review");
                    post.put("category", "리뷰");
                    post.put("url", "/review/detail/" + review.getReviewId());
                    posts.add(post);
                }
            } else if ("job".equals(type)) {
                // 구인구직만 조회
                List<JobDTO> jobs = jobMapper.findJobsByMemberId(memberId);
                for (JobDTO job : jobs) {
                    Map<String, Object> post = new HashMap<>();
                    post.put("id", job.getJobId());
                    post.put("title", job.getTitle());
                    post.put("content", job.getContent());
                    post.put("createdAt", job.getCreatedAt());
                    post.put("viewCount", job.getViewCount() != null ? job.getViewCount() : 0);
                    post.put("likeCount", null); // 구인구직에는 추천 없음
                    post.put("rating", null); // 구인구직에는 평점 없음
                    post.put("salary", job.getSalaryDescription());
                    post.put("type", "job");
                    post.put("category", job.getJobType());
                    post.put("url", "/job/detail/" + job.getJobId());
                    posts.add(post);
                }
            } else {
                // 전체 조회
                List<BoardDTO> boards = boardMapper.findBoardsByMemberId(memberId);
                List<ReviewDTO> reviews = reviewMapper.findReviewsByMemberId(memberId);
                List<JobDTO> jobs = jobMapper.findJobsByMemberId(memberId);
                
                // 게시글 추가
                for (BoardDTO board : boards) {
                    Map<String, Object> post = new HashMap<>();
                    post.put("id", board.getBoardId());
                    post.put("title", board.getTitle());
                    post.put("content", board.getContent());
                    post.put("createdAt", board.getCreatedAt());
                    post.put("viewCount", board.getViewCount() != null ? board.getViewCount() : 0);
                    post.put("likeCount", board.getLikeCount() != null ? board.getLikeCount() : 0);
                    post.put("rating", null); // 게시글에는 평점 없음
                    post.put("salary", null); // 게시글에는 급여 없음
                    post.put("type", "board");
                    post.put("category", board.getBoardType());
                    post.put("url", "/board/detail/" + board.getBoardId());
                    posts.add(post);
                }
                
                // 리뷰 추가
                for (ReviewDTO review : reviews) {
                    Map<String, Object> post = new HashMap<>();
                    post.put("id", review.getReviewId());
                    post.put("title", review.getTitle());
                    post.put("content", review.getContent());
                    post.put("createdAt", review.getCreatedAt());
                    post.put("viewCount", null); // 리뷰에는 조회수 없음
                    post.put("likeCount", review.getLikeCount() != null ? review.getLikeCount() : 0);
                    post.put("rating", review.getRating());
                    post.put("salary", null); // 리뷰에는 급여 없음
                    post.put("type", "review");
                    post.put("category", "리뷰");
                    post.put("url", "/review/detail/" + review.getReviewId());
                    posts.add(post);
                }
                
                // 구인구직 추가
                for (JobDTO job : jobs) {
                    Map<String, Object> post = new HashMap<>();
                    post.put("id", job.getJobId());
                    post.put("title", job.getTitle());
                    post.put("content", job.getContent());
                    post.put("createdAt", job.getCreatedAt());
                    post.put("viewCount", job.getViewCount() != null ? job.getViewCount() : 0);
                    post.put("likeCount", null); // 구인구직에는 추천 없음
                    post.put("rating", null); // 구인구직에는 평점 없음
                    post.put("salary", job.getSalaryDescription());
                    post.put("type", "job");
                    post.put("category", job.getJobType());
                    post.put("url", "/job/detail/" + job.getJobId());
                    posts.add(post);
                }
            }
            
            // 날짜 순으로 정렬 (최신순)
            posts.sort((a, b) -> ((java.time.LocalDateTime) b.get("createdAt")).compareTo((java.time.LocalDateTime) a.get("createdAt")));
            
            // 페이징 처리
            int totalCount = posts.size();
            int startIndex = Math.min(offset, totalCount);
            int endIndex = Math.min(offset + pageSize, totalCount);
            
            List<Map<String, Object>> pagedPosts = posts.subList(startIndex, endIndex);
            
            result.put("posts", pagedPosts);
            result.put("totalCount", totalCount);
            
            log.info("내가 쓴 글 조회 완료: memberId={}, type={}, 총{}\uac1c, 현재페이지 {}\uac1c", 
                    memberId, type, totalCount, pagedPosts.size());
            
            return result;
            
        } catch (Exception e) {
            log.error("내가 쓴 글 조회 중 오류: memberId={}, type={}", memberId, type, e);
            result.put("posts", new ArrayList<>());
            result.put("totalCount", 0);
            result.put("contentCounts", Map.of("board", 0, "review", 0, "job", 0, "total", 0));
            return result;
        }
    }
    
    /**
     * 회원 탈퇴 (옵션에 따라 처리 방식 결정)
     */
    @Transactional
    public String deleteMemberWithOption(String userId, String deleteOption) {
        try {
            if ("anonymous".equals(deleteOption)) {
                // 익명화: 개인정보만 삭제, 콘텐츠는 "탈퇴회원"으로 표시
                int result = memberMapper.anonymizeMember(userId);
                if (result == 0) {
                    throw new RuntimeException("회원 익명화 처리 중 오류가 발생했습니다.");
                }
                log.info("회원 익명화 처리 완료: {}", userId);
                return "회원 탈퇴가 완료되었습니다. 작성하신 게시글은 '탈퇴회원'으로 표시됩니다.";
            } else if ("complete".equals(deleteOption)) {
                // 완전삭제: 모든 콘텐츠와 함께 물리 삭제
                deleteAllUserContent(userId);
                int result = memberMapper.hardDeleteMember(userId);
                if (result == 0) {
                    throw new RuntimeException("회원 완전삭제 처리 중 오류가 발생했습니다.");
                }
                log.info("회원 완전삭제 처리 완료: {}", userId);
                return "회원 탈퇴가 완료되었습니다. 모든 개인정보와 작성 콘텐츠가 완전히 삭제되었습니다.";
            } else {
                // 기본: 논리 삭제
                int result = memberMapper.softDeleteMember(userId);
                if (result == 0) {
                    throw new RuntimeException("회원 탈퇴 처리 중 오류가 발생했습니다.");
                }
                log.info("회원 논리삭제 처리 완료: {}", userId);
                return "회원 탈퇴가 완료되었습니다.";
            }
        } catch (Exception e) {
            log.error("회원 탈퇴 처리 중 오류 발생: userId={}, option={}", userId, deleteOption, e);
            throw new RuntimeException("회원 탈퇴 처리 중 오류가 발생했습니다.", e);
        }
    }
    
    /**
     * 사용자의 모든 콘텐츠 삭제 (시설회원인 경우 관련 시설도 삭제)
     */
    @Transactional
    public void deleteAllUserContent(String userId) {
        try {
            MemberDTO member = memberMapper.findByUserId(userId);
            if (member == null) {
                throw new RuntimeException("회원 정보를 찾을 수 없습니다.");
            }
            
            Long memberId = member.getMemberId();
            
            // 1. 시설회원인 경우 관련 시설 삭제
            if (Constants.MEMBER_ROLE_FACILITY.equals(member.getRole())) {
                // 시설의 구인공고 먼저 삭제
                jobMapper.deleteByFacilityMemberId(memberId);
                log.info("시설 구인공고 삭제 완료: memberId={}", memberId);
                
                // 시설 리뷰 삭제
                reviewMapper.deleteByFacilityMemberId(memberId);
                log.info("시설 리뷰 삭제 완료: memberId={}", memberId);
                
                // 시설 정보 삭제
                facilityMapper.deleteByMemberId(memberId);
                log.info("시설 정보 삭제 완료: memberId={}", memberId);
            }
            
            // 2. 회원이 작성한 모든 콘텐츠 삭제
            boardMapper.deleteByMemberId(memberId);
            reviewMapper.deleteByMemberId(memberId);
            jobMapper.deleteByMemberId(memberId);
            
            log.info("사용자 콘텐츠 삭제 완료: userId={}, memberId={}", userId, memberId);
        } catch (Exception e) {
            log.error("사용자 콘텐츠 삭제 중 오류: userId={}", userId, e);
            throw e;
        }
    }
    
    /**
     * 회원 탈퇴 (논리 삭제) - 이전 버전 호환성
     */
    @Transactional
    public void deleteMember(String userId) {
        int result = memberMapper.softDeleteMember(userId);
        if (result == 0) {
            throw new RuntimeException("회원 탈퇴 처리 중 오류가 발생했습니다.");
        }
        log.info("회원 탈퇴 처리 완료: {}", userId);
    }

    /**
     * 프로필 이미지 저장 메서드
     */
    private String saveProfileImage(MultipartFile file, String userId) {
        try {
            // 로컬 업로드 디렉토리 사용
            String uploadDir = Constants.PROFILE_UPLOAD_PATH;
            File uploadDirFile = new File(uploadDir);
            if (!uploadDirFile.exists()) {
                boolean created = uploadDirFile.mkdirs();
                log.info("프로필 이미지 업로드 디렉토리 생성: {} - {}", uploadDir, created ? "성공" : "실패");
            }
            
            // 파일명 생성 (userId + UUID + 원본 확장자)
            String originalFilename = file.getOriginalFilename();
            String extension = "";
            if (originalFilename != null && originalFilename.contains(".")) {
                extension = originalFilename.substring(originalFilename.lastIndexOf("."));
            }
            String savedFilename = "profile_" + userId + "_" + UUID.randomUUID().toString() + extension;
            
            // 파일 저장
            File savedFile = new File(uploadDir + savedFilename);
            file.transferTo(savedFile);
            log.info("프로필 이미지 저장 완료: {}", savedFile.getAbsolutePath());
            
            // 웹 경로 반환
            return "/uploads/profile/" + savedFilename;
            
        } catch (IOException e) {
            log.error("프로필 이미지 저장 중 오류 발생: userId={}", userId, e);
            throw new RuntimeException("프로필 이미지 저장에 실패했습니다.", e);
        }
    }

    /**
     * 시설 이미지 저장 메서드
     */
    private String saveFacilityImage(MultipartFile file, String userId) {
        try {
            // 로컬 업로드 디렉토리 사용
            String uploadDir = Constants.FACILITY_UPLOAD_PATH;
            File uploadDirFile = new File(uploadDir);
            if (!uploadDirFile.exists()) {
                boolean created = uploadDirFile.mkdirs();
                log.info("시설 이미지 업로드 디렉토리 생성: {} - {}", uploadDir, created ? "성공" : "실패");
            }
            
            // 파일명 생성 (userId + UUID + 원본 확장자)
            String originalFilename = file.getOriginalFilename();
            String extension = "";
            if (originalFilename != null && originalFilename.contains(".")) {
                extension = originalFilename.substring(originalFilename.lastIndexOf("."));
            }
            String savedFilename = "facility_" + userId + "_" + UUID.randomUUID().toString() + extension;
            
            // 파일 저장
            File savedFile = new File(uploadDir + savedFilename);
            file.transferTo(savedFile);
            log.info("시설 이미지 저장 완료: {}", savedFile.getAbsolutePath());
            
            // 웹 경로 반환
            return "/uploads/facility/" + savedFilename;
            
        } catch (IOException e) {
            log.error("시설 이미지 저장 중 오류 발생: userId={}", userId, e);
            throw new RuntimeException("시설 이미지 저장에 실패했습니다.", e);
        }
    }

    /**
     * 전체 회원 수 조회 (유지)
     */
    @Transactional(readOnly = true)
    public int getTotalMembersCount() {
        try {
            return memberMapper.getTotalCount();
        } catch (Exception e) {
            log.error("전체 회원 수 조회 중 오류 발생", e);
            throw new RuntimeException("회원 수 조회 중 오류가 발생했습니다.", e);
        }
    }

    /**
     * 전체 회원 수 조회 (통계용)
     */
    @Transactional(readOnly = true)
    public int getMemberCount() {
        try {
            return memberMapper.getMemberCount();
        } catch (Exception e) {
            log.error("회원 수 조회 중 오류 발생", e);
            return 0; // 오류 시 0 반환
        }
    }

    /**
     * 페이징된 회원 목록 조회 (관리자용) (유지)
     */
    @Transactional(readOnly = true)
    public List<MemberDTO> getMembersWithPaging(MemberDTO searchDTO) {
        try {
            return memberMapper.findMembersWithPaging(searchDTO);
        } catch (Exception e) {
            log.error("페이징된 회원 목록 조회 중 오류 발생", e);
            throw new RuntimeException("회원 목록 조회 중 오류가 발생했습니다.", e);
        }
    }

    /**
     * 특정 역할의 회원 목록 조회 (유지)
     */
    @Transactional(readOnly = true)
    public List<MemberDTO> getMembersByRole(String role) {
        try {
            return memberMapper.findMembersByRole(role);
        } catch (Exception e) {
            log.error("역할별 회원 목록 조회 중 오류 발생: {}", role, e);
            throw new RuntimeException("역할별 회원 목록 조회 중 오류가 발생했습니다.", e);
        }
    }

    /**
     * 회원 상태 변경 (활성화/비활성화) (유지)
     */
    @Transactional
    public void updateMemberStatus(Long memberId, boolean isActive) {
        try {
            memberMapper.updateMemberStatus(memberId, isActive);
            log.info("회원 상태 변경 완료: memberId={}, isActive={}", memberId, isActive);
        } catch (Exception e) {
            log.error("회원 상태 변경 중 오류 발생: memberId={}", memberId, e);
            throw new RuntimeException("회원 상태 변경 중 오류가 발생했습니다.", e);
        }
    }

    // ================== 관리자용 추가 메서드들 ==================

    /**
     * 전체 회원 수 조회 (관리자용)
     */
    @Transactional(readOnly = true)
    public int getTotalMemberCount() {
        try {
            return memberMapper.getTotalCount();
        } catch (Exception e) {
            log.error("전체 회원 수 조회 중 오류 발생", e);
            return 0;
        }
    }

    /**
     * 시설 회원 수 조회 (관리자용)
     */
    @Transactional(readOnly = true)
    public int getFacilityMemberCount() {
        try {
            return memberMapper.getFacilityMemberCount();
        } catch (Exception e) {
            log.error("시설 회원 수 조회 중 오류 발생", e);
            return 0;
        }
    }

    /**
     * 역할별 회원 목록 조회 (페이징 포함, 관리자용)
     */
    @Transactional(readOnly = true)
    public List<MemberDTO> getMembersByRole(String role, int page, int pageSize) {
        try {
            log.info("역할별 회원 목록 조회 시작: role={}, page={}, pageSize={}", role, page, pageSize);
            
            // "ALL"일 때는 null을 전달하여 모든 역할 조회
            String searchRole = "ALL".equals(role) ? null : role;
            List<MemberDTO> members = memberMapper.findMembersByRole(searchRole);
            
            log.info("역할별 회원 조회 완료: role={}, count={} 명", role, members.size());
            return members;
        } catch (Exception e) {
            log.error("역할별 회원 목록 조회 중 오류 발생: role={}, page={}", role, page, e);
            return new ArrayList<>();
        }
    }

    /**
     * 역할별 회원 수 조회 (관리자용)
     */
    @Transactional(readOnly = true)
    public int getMemberCountByRole(String role) {
        try {
            if ("ALL".equals(role)) {
                return memberMapper.getTotalCount();
            } else if ("FACILITY".equals(role)) {
                return memberMapper.getFacilityMemberCount();
            } else if ("USER".equals(role)) {
                return memberMapper.getUserMemberCount();
            } else {
                return memberMapper.getMemberCountByRole(role);
            }
        } catch (Exception e) {
            log.error("역할별 회원 수 조회 중 오류 발생: role={}", role, e);
            return 0;
        }
    }

    /**
     * 회원 활성화 상태 토글 (관리자용)
     */
    @Transactional
    public boolean toggleMemberActive(Long memberId) {
        try {
            MemberDTO member = memberMapper.findById(memberId);
            if (member == null) {
                throw new RuntimeException("회원을 찾을 수 없습니다.");
            }
            
            boolean newStatus = !Boolean.TRUE.equals(member.getIsActive());
            memberMapper.updateMemberStatus(memberId, newStatus);
            
            log.info("회원 활성화 상태 토글 완료: memberId={}, newStatus={}", memberId, newStatus);
            return true;
        } catch (Exception e) {
            log.error("회원 활성화 상태 토글 중 오류 발생: memberId={}", memberId, e);
            return false;
        }
    }
}
````

## File: src/main/resources/templates/facility/search.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>시설 검색</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <!-- 브레드크럼 -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item active" aria-current="page">시설 찾기</li>
            </ol>
        </nav>
        
        <!-- 상단 타이틀 -->
        <div class="row mb-4">
            <div class="col-12">
                <h2><i class="fas fa-map-marker-alt text-info me-2"></i> 시설 검색</h2>
                <p class="text-muted">지도를 통해 주변 요양 시설을 찾아보세요.</p>
            </div>
        </div>

        <!-- 검색 필터 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <form th:action="@{/facility/search}" method="get" class="row g-3">
                            <div class="col-md-3">
                                <label for="searchKeyword" class="form-label">검색어</label>
                                <input type="text" class="form-control" id="searchKeyword" name="facilityName" th:value="${facilityName}" placeholder="시설명 또는 주소">
                            </div>
                            <div class="col-md-3">
                                <label for="region" class="form-label">지역</label>
                                <select id="region" name="region" class="form-select">
                                    <option value="">전체</option>
                                    <option value="서울" th:selected="${region == '서울'}">서울</option>
                                    <option value="경기" th:selected="${region == '경기'}">경기</option>
                                    <option value="인천" th:selected="${region == '인천'}">인천</option>
                                    <option value="부산" th:selected="${region == '부산'}">부산</option>
                                    <option value="대구" th:selected="${region == '대구'}">대구</option>
                                    <option value="광주" th:selected="${region == '광주'}">광주</option>
                                    <option value="대전" th:selected="${region == '대전'}">대전</option>
                                    <option value="울산" th:selected="${region == '울산'}">울산</option>
                                    <option value="세종" th:selected="${region == '세종'}">세종</option>
                                    <option value="강원" th:selected="${region == '강원'}">강원</option>
                                    <option value="충북" th:selected="${region == '충북'}">충북</option>
                                    <option value="충남" th:selected="${region == '충남'}">충남</option>
                                    <option value="전북" th:selected="${region == '전북'}">전북</option>
                                    <option value="전남" th:selected="${region == '전남'}">전남</option>
                                    <option value="경북" th:selected="${region == '경북'}">경북</option>
                                    <option value="경남" th:selected="${region == '경남'}">경남</option>
                                    <option value="제주" th:selected="${region == '제주'}">제주</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="facilityType" class="form-label">유형</label>
                                <select id="facilityType" name="facilityType" class="form-select">
                                    <option value="">전체</option>
                                    <option value="nursing_home" th:selected="${facilityType == 'nursing_home'}">요양원</option>
                                    <option value="day_care" th:selected="${facilityType == 'day_care'}">주간/야간보호센터</option>
                                    <option value="home_care" th:selected="${facilityType == 'home_care'}">재가복지센터</option>
                                    <option value="hospital" th:selected="${facilityType == 'hospital'}">병원</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="gradeRating" class="form-label">등급</label>
                                <select id="gradeRating" name="gradeRating" class="form-select" disabled title="현재 사용할 수 없습니다">
                                    <option value="">전체</option>
                                    <option value="1" th:selected="${gradeRating == '1'}">1등급</option>
                                    <option value="2" th:selected="${gradeRating == '2'}">2등급</option>
                                    <option value="3" th:selected="${gradeRating == '3'}">3등급</option>
                                    <option value="4" th:selected="${gradeRating == '4'}">4등급</option>
                                    <option value="5" th:selected="${gradeRating == '5'}">5등급</option>
                                </select>
                                <div class="form-text text-muted small">현재 등급 정보가 준비 중입니다</div>
                            </div>
                            <div class="col-md-1 d-flex align-items-end">
                                <button type="submit" class="btn btn-primary w-100"><i class="fas fa-search"></i></button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- 검색 결과 -->
        <div class="row">
            <!-- 시설 목록 (4) -->
            <div class="col-5">
                <div class="card shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="mb-0"><i class="fas fa-list me-2"></i> 검색 결과 <span class="badge bg-info" th:text="${#lists.size(facilityList)}">0</span>개</h5>
                    </div>
                    <div class="card-body p-0">
                        <div th:if="${#lists.isEmpty(facilityList)}" class="alert alert-warning m-3" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i> 검색 결과가 없습니다.
                        </div>
                        <div th:unless="${#lists.isEmpty(facilityList)}" class="facility-list" style="height: 75vh; overflow-y: auto;">
                            <div th:each="facility : ${facilityList}" class="facility-item p-3 border-bottom" 
                                 th:attr="data-lat=${facility.latitude}, data-lng=${facility.longitude}">
                                <div class="row">
                                    <div class="col-12">
                                        <h5 class="mb-2 text-primary" th:text="${facility.facilityName}">시설명</h5>
                                        <p class="mb-2 text-muted"><i class="fas fa-map-marker-alt me-1"></i> <span th:text="${facility.address}">주소</span></p>
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="me-3">
                                                <i class="fas fa-star text-warning"></i>
                                                <span th:text="${facility.averageRating}">4.5</span>/5.0
                                            </div>
                                            <div class="me-3">
                                                <i class="fas fa-comment text-info"></i>
                                                리뷰 <span th:text="${facility.reviewCount}">12</span>개
                                            </div>
                                            <div>
                                                <i class="fas fa-building me-1"></i>
                                                <span th:if="${facility.facilityType == 'nursing_home'}">요양원</span>
                                                <span th:if="${facility.facilityType == 'day_care'}">주간/야간보호센터</span>
                                                <span th:if="${facility.facilityType == 'home_care'}">재가복지센터</span>
                                                <span th:if="${facility.facilityType == 'hospital'}">병원</span>
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <a th:href="@{/facility/detail/{id}(id=${facility.facilityId})}" class="btn btn-outline-info btn-sm">
                                                <i class="fas fa-info-circle me-1"></i> 상세 정보
                                            </a>
                                            <span class="badge bg-success" th:if="${facility.isApproved}">승인됨</span>
                                            <span class="badge bg-secondary" th:if="${!facility.isApproved}">미승인</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 지도 (6) -->
            <div class="col-7">
                <div class="card shadow-sm">
                    <div class="card-body p-0">
                        <div id="map" style="width:100%; height:75vh;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<div th:replace="~{layout/footer :: footer}"></div>

<!-- 공통 JavaScript -->
<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 카카오맵 Javascript SDK -->
<script src="/js/kakaomap.js"></script>

<!-- 디버깅용 API 키 확인 -->
<script th:inline="javascript">
    /*<![CDATA[*/
    const API_KEY = /*[[${KAKAO_APP_KEY}]]*/ '';
    console.log('전달받은 API 키:', API_KEY);
    if (!API_KEY || API_KEY === '') {
        console.error('API 키가 전달되지 않았습니다!');
    }
    /*]]>*/
</script>

<script type="text/javascript" th:src="@{//dapi.kakao.com/v2/maps/sdk.js(appkey=${KAKAO_APP_KEY}, libraries='services,clusterer,drawing')}"></script>

<script th:inline="javascript">
    /*<![CDATA[*/
    // Thymeleaf 모델에서 자바 객체를 JavaScript 배열로 변환
    const facilities = /*[[${facilityList}]]*/ '[]';

    $(document).ready(function() {
        // 카카오맵 SDK 로드 대기
        setTimeout(function() {
            if (typeof kakao === 'undefined' || !kakao.maps) {
                console.error('카카오맵 SDK를 로드할 수 없습니다.');
                return;
            }
            
            initializeMap();
        }, 100);
    });

    function initializeMap() {
        const mapContainer = document.getElementById('map');
        let mapCenter = new kakao.maps.LatLng(37.566826, 126.9786567); // 기본값: 서울 시청
        
        // 시설 목록이 있다면 첫 번째 시설을 기본 중심으로 설정
        if (facilities.length > 0) {
            mapCenter = new kakao.maps.LatLng(facilities[0].latitude, facilities[0].longitude);
        }
        
        const mapOption = {
            center: mapCenter,
            level: 8
        };
        const map = new kakao.maps.Map(mapContainer, mapOption);
        const markers = [];
        const infowindows = [];

        // 시설 목록 항목 호버 시 해당 마커 강조
        $('.facility-item').hover(
            function() {
                const lat = $(this).data('lat');
                const lng = $(this).data('lng');
                const index = markers.findIndex(marker => 
                    marker.getPosition().getLat() === lat && 
                    marker.getPosition().getLng() === lng
                );
                if (index > -1) {
                    markers[index].setZIndex(100);
                    infowindows[index].open(map, markers[index]);
                }
            },
            function() {
                infowindows.forEach(iw => iw.close());
            }
        );

        let currentMarker = null;
        let currentInfoWindow = null;

        // 시설 목록 항목 클릭 시 지도 중심 이동 및 마커 표시
        $('.facility-item').click(function(e) {
            // 상세보기 버튼을 직접 클릭한 경우는 기본 동작 유지
            if ($(e.target).closest('.btn').length > 0) {
                return;
            }
            
            const lat = $(this).data('lat');
            const lng = $(this).data('lng');
            if (lat && lng) {
                const position = new kakao.maps.LatLng(lat, lng);
                map.setCenter(position);
                map.setLevel(3); // 확대하여 해당 시설 위치 상세히 보기
                
                // 기존 마커 제거
                if (currentMarker) {
                    currentMarker.setMap(null);
                }
                if (currentInfoWindow) {
                    currentInfoWindow.close();
                }
                
                // 클릭된 시설 정보 찾기
                const facilityData = facilities.find(f => 
                    parseFloat(f.latitude) === lat && parseFloat(f.longitude) === lng
                );
                
                if (facilityData) {
                    // 새 마커 생성
                    currentMarker = new kakao.maps.Marker({
                        position: position,
                        map: map
                    });
                    
                    // 새 인포윈도우 생성
                    currentInfoWindow = new kakao.maps.InfoWindow({
                        content: `
                            <div class="p-2" style="width:250px;">
                                <h6 class="mb-1">${facilityData.facilityName}</h6>
                                <p class="mb-1 small">${facilityData.address}</p>
                                <p class="mb-0 small">
                                    평점: ${facilityData.averageRating}/5.0
                                </p>
                                <a href="/facility/detail/${facilityData.facilityId}"
                                   class="btn btn-sm btn-info mt-2 w-100">상세보기</a>
                            </div>
                        `
                    });
                    
                    // 마커 클릭 이벤트
                    kakao.maps.event.addListener(currentMarker, 'click', function() {
                        currentInfoWindow.open(map, currentMarker);
                    });
                    
                    // 인포윈도우 자동 열기
                    currentInfoWindow.open(map, currentMarker);
                }
            }
        });

        // 페이지 로드 시 첫 번째 시설에 마커 표시
        if (facilities.length > 0) {
            const firstFacility = facilities[0];
            const position = new kakao.maps.LatLng(firstFacility.latitude, firstFacility.longitude);
            
            currentMarker = new kakao.maps.Marker({
                position: position,
                map: map
            });
            
            currentInfoWindow = new kakao.maps.InfoWindow({
                content: `
                    <div class="p-2" style="width:250px;">
                        <h6 class="mb-1">${firstFacility.facilityName}</h6>
                        <p class="mb-1 small">${firstFacility.address}</p>
                        <p class="mb-0 small">
                            평점: ${firstFacility.averageRating}/5.0
                        </p>
                        <a href="/facility/detail/${firstFacility.facilityId}"
                           class="btn btn-sm btn-info mt-2 w-100">상세보기</a>
                    </div>
                `
            });
            
            kakao.maps.event.addListener(currentMarker, 'click', function() {
                currentInfoWindow.open(map, currentMarker);
            });
        }
    }
    /*]]>*/
</script>

<style>
.facility-list::-webkit-scrollbar {
    width: 8px;
}
.facility-list::-webkit-scrollbar-track {
    background: #f1f1f1;
}
.facility-list::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
}
.facility-list::-webkit-scrollbar-thumb:hover {
    background: #555;
}
.facility-item {
    transition: background-color 0.2s;
    cursor: pointer;
}
.facility-item:hover {
    background-color: #f8f9fa;
}
</style>
</body>
</html>
````

## File: src/main/resources/templates/layout/header.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:fragment="header">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle != null ? pageTitle + ' - CareLink' : 'CareLink - 요양원 구인구직 사이트'}">CareLink</title>
    
    <!-- 캐시 방지 메타 태그 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts - 한글 폰트 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Cropper.js CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet">
    <!-- 공통 CSS -->
    <link href="/css/common.css" rel="stylesheet">
    <!-- 스마트 스크롤 유틸리티 -->
    <script src="/js/smart-scroll-utility.js"></script>
    <!-- 리치 텍스트 에디터 CSS -->
    <link href="/css/rich-text-editor.css" rel="stylesheet">
    <!-- 리치 텍스트 에디터 JS (보안 강화 버전) -->
    <script src="/js/rich-text-editor-v2.js"></script>
</head>

<body class="pt-5">
    <!-- 네비게이션 바 (고정형) -->
    <nav th:fragment="navbar" class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container">
            <!-- 로고 -->
            <a class="navbar-brand fw-bold" href="/">
                <i class="fas fa-heart text-danger me-2"></i>
                CareLink
            </a>
            
            <!-- 모바일 메뉴 토글 버튼 -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <!-- 메뉴 -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <!-- 시설 검색 (팀원 B) -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-map-marker-alt me-1"></i>
                            시설 찾기
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/facility/search">시설 검색</a></li>
                            <li><a class="dropdown-item" href="/review">시설 리뷰</a></li>
                            <li><a class="dropdown-item" href="/review/write">리뷰 작성</a></li>
                            <!-- 시설회원만 시설 관리 메뉴 표시 -->
                            <li th:if="${session.loginMember != null and session.loginMember.role == 'FACILITY'}"><hr class="dropdown-divider"></li>
                            <li th:if="${session.loginMember != null and session.loginMember.role == 'FACILITY'}">
                                <a class="dropdown-item" href="/facility/manage">
                                    <i class="fas fa-cogs me-1"></i>내 시설 관리
                                </a>
                            </li>
                        </ul>
                    </li>
                    
                    <!-- 구인구직 (팀원 C) -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-briefcase me-1"></i>
                            구인구직
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/job?type=recruit">구인 정보</a></li>
                            <li><a class="dropdown-item" href="/job?type=search">구직 정보</a></li>
                            <!-- 시설회원 또는 관리자만 채용공고 작성 메뉴 표시 -->
                            <li th:if="${session.loginMember != null and (session.loginMember.role == 'FACILITY' or session.loginMember.role == 'ADMIN')}"><hr class="dropdown-divider"></li>
                            <li th:if="${session.loginMember != null and (session.loginMember.role == 'FACILITY' or session.loginMember.role == 'ADMIN')}">
                                <a class="dropdown-item" href="/job/write">
                                    <i class="fas fa-plus me-1"></i>채용공고 작성
                                </a>
                            </li>
                        </ul>
                    </li>
                    
                    <!-- 정보 게시판 (팀원 D) -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-clipboard-list me-1"></i>
                            정보마당
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/board?type=notice">공지사항</a></li>
                            <li><a class="dropdown-item" href="/board?type=info">정보공유</a></li>
                            <li><a class="dropdown-item" href="/board?type=qna">Q&A</a></li>
                            <li><a class="dropdown-item" href="/board?type=faq">FAQ</a></li>
                        </ul>
                    </li>
                </ul>
                
                <!-- 사용자 메뉴 -->
                <ul class="navbar-nav">
                    <!-- 로그인된 경우 -->
                    <li class="nav-item dropdown" th:if="${session.memberId != null}">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i>
                            <span th:if="${session.loginMember != null}" th:text="${session.loginMember.name}">사용자명</span>
                            <span th:unless="${session.loginMember != null}" th:text="'테스트사용자' + ${session.memberId}">테스트사용자</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="/member/myinfo" onclick="event.stopPropagation();">내 정보</a></li>
                            <!-- 관리자인 경우 관리자 페이지 표시 -->
                            <li th:if="${session.loginMember != null and session.loginMember.role == 'ADMIN'}">
                                <a class="dropdown-item" href="/admin" onclick="event.stopPropagation();">
                                    <i class="fas fa-cog me-1"></i>관리자 페이지
                                </a>
                            </li>
                            <!-- 관리자가 아닌 경우 내가 쓴 글 표시 -->
                            <li th:if="${session.loginMember == null or session.loginMember.role != 'ADMIN'}">
                                <a class="dropdown-item" href="/member/mypost" onclick="event.stopPropagation();">내가 쓴 글</a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/member/logout" onclick="event.stopPropagation();">로그아웃</a></li>
                        </ul>
                    </li>
                    
                    <!-- 로그인 안된 경우 -->
                    <li class="nav-item" th:unless="${session.memberId != null}">
                        <a class="nav-link" href="/member/login">
                            <i class="fas fa-sign-in-alt me-1"></i>
                            로그인
                        </a>
                    </li>
                    <li class="nav-item" th:unless="${session.memberId != null}">
                        <a class="nav-link" href="/member/join">
                            <i class="fas fa-user-plus me-1"></i>
                            회원가입
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <!-- 메시지 표시 영역 -->
    <div th:fragment="messages" class="container mt-3" style="position: relative; z-index: 1030;">
        <!-- 성공 메시지 -->
        <div class="alert alert-success alert-dismissible fade show" role="alert" th:if="${message}">
            <i class="fas fa-check-circle me-2"></i>
            <span th:text="${message}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <!-- 에러 메시지 -->
        <div class="alert alert-danger alert-dismissible fade show" role="alert" th:if="${error}">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <!-- 경고 메시지 -->
        <div class="alert alert-warning alert-dismissible fade show" role="alert" th:if="${warning}">
            <i class="fas fa-exclamation-circle me-2"></i>
            <span th:text="${warning}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    </div>
    
    <!-- 드롭다운 메뉴와 메시지 충돌 방지 스크립트 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 드롭다운이 열릴 때 메시지 자동 숨김
            var dropdownToggles = document.querySelectorAll('.dropdown-toggle');
            dropdownToggles.forEach(function(toggle) {
                toggle.addEventListener('click', function() {
                    // 메시지 알림 즉시 숨김
                    var alerts = document.querySelectorAll('.alert');
                    alerts.forEach(function(alert) {
                        alert.style.display = 'none';
                    });
                });
            });
        });
    </script>
</body>
</html>
````

## File: src/main/resources/templates/member/join.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>회원가입 - CareLink</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <!-- 브레드크럼 -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item active" aria-current="page">회원가입</li>
            </ol>
        </nav>
        
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-5"> <div class="card shadow">
                <div class="card-body p-4">
                    <div class="text-center mb-4">
                        <h3 class="card-title fw-bold text-primary">
                            <i class="fas fa-user-plus me-2"></i>
                            회원가입
                        </h3>
                        <p class="text-muted">새로운 CareLink 계정을 만드세요</p>
                    </div>

                    <form th:action="@{/member/join}" method="post" id="joinForm" th:object="${memberDTO}">
                        <!-- 회원 유형 선택 -->
                        <div class="mb-4">
                            <label class="form-label mb-3">
                                <i class="fas fa-users me-1"></i>회원 유형 <span class="text-danger">*</span>
                            </label>
                            <div class="row g-3">
                                <div class="col-6">
                                    <input type="radio" class="btn-check" name="role" id="roleUser" value="USER" th:field="*{role}" checked>
                                    <label class="btn btn-outline-primary h-100 w-100 user-type-card" for="roleUser">
                                        <div class="d-flex flex-column align-items-center justify-content-center h-100 p-3">
                                            <i class="fas fa-user-friends fa-2x mb-2 text-primary"></i>
                                            <h6 class="mb-1 fw-bold">일반회원</h6>
                                            <small class="text-muted text-center">구직자, 가족<br>요양 서비스를 찾는 분</small>
                                        </div>
                                    </label>
                                </div>
                                <div class="col-6">
                                    <input type="radio" class="btn-check" name="role" id="roleFacility" value="FACILITY" th:field="*{role}">
                                    <label class="btn btn-outline-success h-100 w-100 user-type-card" for="roleFacility">
                                        <div class="d-flex flex-column align-items-center justify-content-center h-100 p-3">
                                            <i class="fas fa-building fa-2x mb-2 text-success"></i>
                                            <h6 class="mb-1 fw-bold">시설회원</h6>
                                            <small class="text-muted text-center">요양원, 병원 운영자<br>인력을 채용하는 시설</small>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="userId" class="form-label">
                                <i class="fas fa-user me-1"></i>아이디 <span class="text-danger">*</span>
                            </label>
                            <input type="text"
                                   class="form-control"
                                   id="userId"
                                   th:field="*{userId}" placeholder="아이디를 입력하세요 (4-20자 영문, 숫자)"
                                   required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('userId')}" th:text="${#fields.errors('userId')[0]}"></div>
                            <div id="userIdFeedback" class="mt-1"></div> </div>

                        <div class="mb-3">
                            <label for="password" class="form-label">
                                <i class="fas fa-lock me-1"></i>비밀번호 <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <input type="password"
                                       class="form-control"
                                       id="password"
                                       th:field="*{password}" placeholder="비밀번호를 입력하세요"
                                       required>
                                <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <small class="form-text text-muted">8-20자의 영문, 숫자, 특수문자를 1개 이상 포함해야 합니다.</small>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('password')}" th:text="${#fields.errors('password')[0]}"></div>
                        </div>

                        <div class="mb-3">
                            <label for="passwordConfirm" class="form-label">
                                <i class="fas fa-lock me-1"></i>비밀번호 확인 <span class="text-danger">*</span>
                            </label>
                            <input type="password"
                                   class="form-control"
                                   id="passwordConfirm"
                                   th:field="*{passwordConfirm}" placeholder="비밀번호를 다시 입력하세요"
                                   required>
                            <div id="passwordMismatchFeedback" class="text-danger mt-1" style="display:none;">
                                비밀번호가 일치하지 않습니다.
                            </div>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('passwordConfirm')}" th:text="${#fields.errors('passwordConfirm')[0]}"></div>
                        </div>

                        <div class="mb-3">
                            <label for="name" class="form-label">
                                <i class="fas fa-signature me-1"></i>이름 <span class="text-danger">*</span>
                            </label>
                            <input type="text"
                                   class="form-control"
                                   id="name"
                                   th:field="*{name}" placeholder="이름을 입력하세요"
                                   required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('name')}" th:text="${#fields.errors('name')[0]}"></div>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label">
                                <i class="fas fa-envelope me-1"></i>이메일 <span class="text-danger">*</span>
                            </label>
                            <input type="email"
                                   class="form-control"
                                   id="email"
                                   th:field="*{email}" placeholder="이메일을 입력하세요">
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('email')}" th:text="${#fields.errors('email')[0]}"></div>
                        </div>

                        <div class="mb-3">
                            <label for="phone" class="form-label">
                                <i class="fas fa-phone me-1"></i>휴대폰 번호
                            </label>
                            <input type="tel"
                                   class="form-control"
                                   id="phone"
                                   th:field="*{phone}" placeholder="숫자만 입력하세요 (자동으로 하이픈 추가됨)"
                                   pattern="^01(?:0|1|[6-9])-(?:\d{3}|\d{4})-\d{4}$">
                            <small class="form-text text-muted">숫자만 입력하면 자동으로 010-1234-5678 형태로 변환됩니다</small>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('phone')}" th:text="${#fields.errors('phone')[0]}"></div>
                        </div>

                        <div class="mb-3">
                            <label for="address" class="form-label">
                                <i class="fas fa-map-marker-alt me-1"></i>주소
                                <span id="address-required-asterisk" class="text-danger" style="display: none;">*</span>
                            </label>
                            <div class="input-group mb-2">
                                <input type="text"
                                       class="form-control"
                                       id="address"
                                       th:field="*{address}" 
                                       placeholder="주소 검색 버튼을 클릭하세요"
                                       readonly>
                                <button type="button" class="btn btn-outline-primary" onclick="openAddressSearch('address')">
                                    <i class="fas fa-search me-1"></i>주소 검색
                                </button>
                            </div>
                            <input type="text" 
                                   class="form-control" 
                                   id="detailAddress" 
                                   th:field="*{detailAddress}"
                                   placeholder="상세 주소를 입력하세요 (예: 101동 201호, 2층)">
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('address')}" th:text="${#fields.errors('address')[0]}"></div>
                        </div>

                        <!-- 시설회원 추가 정보 -->
                        <div id="facilityFields" style="display: none;">
                            <hr class="my-4">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-building me-2"></i>시설 정보
                            </h5>
                            
                            <div class="mb-3">
                                <label for="facilityName" class="form-label">
                                    <i class="fas fa-home me-1"></i>시설명 <span class="text-danger">*</span>
                                </label>
                                <input type="text" class="form-control" id="facilityName" th:field="*{facilityName}" 
                                       placeholder="시설명을 입력하세요">
                            </div>

                            <div class="mb-3">
                                <label for="facilityType" class="form-label">
                                    <i class="fas fa-list me-1"></i>시설 유형 <span class="text-danger">*</span>
                                </label>
                                <select class="form-select" id="facilityType" th:field="*{facilityType}">
                                    <option value="">시설 유형을 선택하세요</option>
                                    <option value="NURSING_HOME">요양원</option>
                                    <option value="HOSPITAL">요양병원</option>
                                    <option value="DAY_CARE">주간보호센터</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="facilityAddress" class="form-label">
                                    <i class="fas fa-map-marker-alt me-1"></i>시설 주소 <span class="text-danger">*</span>
                                </label>
                                <div class="input-group mb-2">
                                    <input type="text" class="form-control" id="facilityAddress" th:field="*{facilityAddress}"
                                           placeholder="주소 검색 버튼을 클릭하세요" readonly required>
                                    <button type="button" class="btn btn-outline-primary" onclick="searchFacilityAddress()">
                                        <i class="fas fa-search me-1"></i>주소 검색
                                    </button>
                                </div>
                                <input type="text" class="form-control" id="detailAddress" th:field="*{detailAddress}"
                                       placeholder="상세 주소를 입력하세요 (예: 101호, 2층)">
                                <!-- 위도/경도 히든 필드 -->
                                <input type="hidden" id="latitude" th:field="*{latitude}">
                                <input type="hidden" id="longitude" th:field="*{longitude}">
                            </div>
                            
                            <!-- 위치 미리보기 지도 -->
                            <div class="mb-3" id="mapPreviewContainer" style="display: none;">
                                <label class="form-label">
                                    <i class="fas fa-map me-1"></i>위치 미리보기
                                </label>
                                <div id="previewMap" style="width:100%; height:200px; border-radius: 8px; border: 1px solid #dee2e6;"></div>
                                <small class="form-text text-muted">선택된 주소의 위치가 지도에 표시됩니다.</small>
                            </div>

                            <div class="mb-3">
                                <label for="facilityPhone" class="form-label">
                                    <i class="fas fa-phone me-1"></i>시설 전화번호 <span class="text-danger">*</span>
                                </label>
                                <input type="tel" class="form-control" id="facilityPhone" th:field="*{facilityPhone}"
                                       placeholder="숫자만 입력하세요 (자동으로 하이픈 추가됨)"
                                       pattern="^(02-\d{3,4}-\d{4}|0(3[1-3]|4[1-3]|5[1-5]|6[1-4]|70)-\d{3,4}-\d{4}|01[016-9]-\d{3,4}-\d{4})$">
                                <small class="form-text text-muted">일반 전화번호(02-1234-5678) 또는 휴대폰 번호 모두 가능합니다</small>
                            </div>

                            <div class="mb-3">
                                <label for="facilityImage" class="form-label">
                                    <i class="fas fa-image me-1"></i>시설 대표 사진
                                </label>
                                <input type="file" class="form-control" id="facilityImage" name="facilityImageFile"
                                       accept="image/*" data-image-compressor='{"quality": 0.8, "maxWidth": 1920, "maxHeight": 1080}'>
                                <small class="form-text text-muted">JPG, PNG 파일만 업로드 가능 (SEO 최적화를 위해 자동 압축됩니다)</small>
                            </div>

                            <div class="mb-3">
                                <label for="capacity" class="form-label">
                                    <i class="fas fa-users me-1"></i>수용 인원
                                </label>
                                <input type="number" class="form-control" id="capacity" th:field="*{capacity}"
                                       placeholder="수용 가능 인원을 입력하세요" min="1">
                            </div>

                            <div class="mb-3">
                                <label for="operatingHours" class="form-label">
                                    <i class="fas fa-clock me-1"></i>운영 시간
                                </label>
                                <div class="row g-2">
                                    <div class="col-12">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="operatingType" id="operating24" value="24시간" checked>
                                            <label class="form-check-label fw-bold text-success" for="operating24">
                                                <i class="fas fa-clock me-1"></i>24시간 운영
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="operatingType" id="operatingCustom" value="custom">
                                            <label class="form-check-label" for="operatingCustom">
                                                <i class="fas fa-clock me-1"></i>시간 선택
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div id="customTimeSection" class="mt-3" style="display: none;">
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <label for="startTime" class="form-label">시작 시간</label>
                                            <select class="form-select" id="startTime">
                                                <option value="00:00">00:00</option>
                                                <option value="01:00">01:00</option>
                                                <option value="02:00">02:00</option>
                                                <option value="03:00">03:00</option>
                                                <option value="04:00">04:00</option>
                                                <option value="05:00">05:00</option>
                                                <option value="06:00">06:00</option>
                                                <option value="07:00">07:00</option>
                                                <option value="08:00">08:00</option>
                                                <option value="09:00" selected>09:00</option>
                                                <option value="10:00">10:00</option>
                                                <option value="11:00">11:00</option>
                                                <option value="12:00">12:00</option>
                                                <option value="13:00">13:00</option>
                                                <option value="14:00">14:00</option>
                                                <option value="15:00">15:00</option>
                                                <option value="16:00">16:00</option>
                                                <option value="17:00">17:00</option>
                                                <option value="18:00">18:00</option>
                                                <option value="19:00">19:00</option>
                                                <option value="20:00">20:00</option>
                                                <option value="21:00">21:00</option>
                                                <option value="22:00">22:00</option>
                                                <option value="23:00">23:00</option>
                                            </select>
                                        </div>
                                        <div class="col-6">
                                            <label for="endTime" class="form-label">종료 시간</label>
                                            <select class="form-select" id="endTime">
                                                <option value="00:00">00:00</option>
                                                <option value="01:00">01:00</option>
                                                <option value="02:00">02:00</option>
                                                <option value="03:00">03:00</option>
                                                <option value="04:00">04:00</option>
                                                <option value="05:00">05:00</option>
                                                <option value="06:00">06:00</option>
                                                <option value="07:00">07:00</option>
                                                <option value="08:00">08:00</option>
                                                <option value="09:00">09:00</option>
                                                <option value="10:00">10:00</option>
                                                <option value="11:00">11:00</option>
                                                <option value="12:00">12:00</option>
                                                <option value="13:00">13:00</option>
                                                <option value="14:00">14:00</option>
                                                <option value="15:00">15:00</option>
                                                <option value="16:00">16:00</option>
                                                <option value="17:00">17:00</option>
                                                <option value="18:00" selected>18:00</option>
                                                <option value="19:00">19:00</option>
                                                <option value="20:00">20:00</option>
                                                <option value="21:00">21:00</option>
                                                <option value="22:00">22:00</option>
                                                <option value="23:00">23:00</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="operatingHours" th:field="*{operatingHours}" value="24시간 운영">
                            </div>

                            <div class="mb-3">
                                <label for="description" class="form-label">
                                    <i class="fas fa-file-text me-1"></i>시설 소개
                                </label>
                                <textarea class="form-control" id="description" th:field="*{description}" rows="4"
                                          placeholder="예시: 저희 행복요양원은 어르신들이 편안하고 안전하게 지낼 수 있도록 최선을 다하는 전문 요양시설입니다. 숙련된 요양보호사와 간호사가 24시간 상주하며, 개인별 맞춤 케어를 제공합니다. 깨끗하고 쾌적한 환경에서 어르신들의 건강하고 행복한 노후를 지원합니다."></textarea>
                                <small class="form-text text-muted">
                                    <i class="fas fa-lightbulb me-1"></i>
                                    <strong>작성 팁:</strong> 시설의 운영 철학, 서비스 특징, 어르신들에 대한 배려 등을 포함하여 작성해주세요.
                                </small>
                            </div>

                            <div class="mb-3">
                                <label for="features" class="form-label">
                                    <i class="fas fa-star me-1"></i>시설 특징
                                </label>
                                <textarea class="form-control" id="features" th:field="*{features}" rows="3"
                                          placeholder="예시: 24시간 간병서비스, 물리치료실 완비, 인지치료 프로그램 운영, 영양사가 직접 관리하는 식사 제공, 실내 정원 및 휴게공간, 가족 면회실 별도 운영, 응급의료 시스템 구축, 개인별 맞춤 케어 프로그램"></textarea>
                                <small class="form-text text-muted">
                                    <i class="fas fa-lightbulb me-1"></i>
                                    <strong>작성 팁:</strong> 콤마(,)로 구분하여 시설의 주요 특징, 서비스, 시설 등을 나열해주세요.
                                </small>
                            </div>

                            <div class="mb-3">
                                <label for="homepage" class="form-label">
                                    <i class="fas fa-globe me-1"></i>홈페이지 URL
                                </label>
                                <input type="url" class="form-control" id="homepage" th:field="*{homepage}"
                                       placeholder="https://www.example.com">
                            </div>
                        </div>

                        <div class="d-grid mb-3">
                            <button type="submit" class="btn btn-primary btn-lg" id="joinSubmitButton">
                                <i class="fas fa-user-plus me-2"></i>
                                회원가입
                            </button>
                        </div>
                    </form>

                    <div class="row text-center mt-3">
                        <div class="col">
                            <p class="text-muted mb-0">이미 계정이 있으신가요?</p>
                            <a th:href="@{/member/login}" class="btn btn-link">
                                <i class="fas fa-sign-in-alt me-1"></i>
                                로그인 페이지로 이동
                            </a>
                        </div>
                    </div>

                </div>
            </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>

<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 카카오 주소 검색 API -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<!-- 카카오맵 API (좌표 변환용) -->
<script type="text/javascript" th:src="@{//dapi.kakao.com/v2/maps/sdk.js(appkey=${KAKAO_APP_KEY}, libraries='services')}"></script>
<!-- 카카오맵 유틸리티 -->
<script src="/js/kakaomap.js"></script>
<!-- 이미지 압축 라이브러리 -->
<link rel="stylesheet" href="/css/image-compressor.css">
<script src="/js/image-compressor.js"></script>

<style>
.user-type-card {
    min-height: 120px;
    transition: all 0.3s ease;
    border-width: 2px !important;
    background-color: #fff;
}

.user-type-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.btn-check:checked + .user-type-card.btn-outline-primary {
    background-color: #0d6efd;
    border-color: #0d6efd;
    color: white;
}

.btn-check:checked + .user-type-card.btn-outline-primary .text-primary {
    color: white !important;
}

.btn-check:checked + .user-type-card.btn-outline-primary .text-muted {
    color: rgba(255,255,255,0.8) !important;
}

.btn-check:checked + .user-type-card.btn-outline-success {
    background-color: #198754;
    border-color: #198754;
    color: white;
}

.btn-check:checked + .user-type-card.btn-outline-success .text-success {
    color: white !important;
}

.btn-check:checked + .user-type-card.btn-outline-success .text-muted {
    color: rgba(255,255,255,0.8) !important;
}

.user-type-card i {
    transition: all 0.3s ease;
}

.user-type-card:hover i {
    transform: scale(1.1);
}

.btn-check:focus + .user-type-card {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}
</style>

<script th:inline="javascript">
    $(document).ready(function() {
        // Thymeleaf에서 전달된 에러 메시지 처리
        /*[CDATA[*/
        const memberDTOErrors = /*[[${#fields.hasErrors('memberDTO')} ? ${#fields.errors('memberDTO')} : null]]*/ null;
        if (memberDTOErrors) {
            memberDTOErrors.forEach(error => {
                if (error.field === 'userId') {
                    $('#userId').addClass('is-invalid');
                    $('#userIdFeedback').addClass('text-danger').text(error.defaultMessage);
                } else if (error.field === 'password') {
                    $('#password').addClass('is-invalid');
                } else if (error.field === 'passwordConfirm') {
                    $('#passwordConfirm').addClass('is-invalid');
                    $('#passwordMismatchFeedback').text(error.defaultMessage).show();
                } else if (error.field === 'name') {
                    $('#name').addClass('is-invalid');
                } else if (error.field === 'email') {
                    $('#email').addClass('is-invalid');
                } else if (error.field === 'phone') {
                    $('#phone').addClass('is-invalid');
                } else if (error.field === 'address') {
                    $('#address').addClass('is-invalid');
                }
            });
        }
        /*]]>*/


        // 비밀번호 표시/숨김 토글
        $('#togglePassword').click(function() {
            const passwordField = $('#password');
            const icon = $(this).find('i');

            if (passwordField.attr('type') === 'password') {
                passwordField.attr('type', 'text');
                icon.removeClass('fa-eye').addClass('fa-eye-slash');
            } else {
                passwordField.attr('type', 'password');
                icon.removeClass('fa-eye-slash').addClass('fa-eye');
            }
        });

        // 비밀번호 유효성 검사 및 일치 여부 실시간 확인
        const passwordInput = $('#password');
        const passwordConfirmInput = $('#passwordConfirm');
        const passwordMismatchFeedback = $('#passwordMismatchFeedback');
        
        // 비밀번호 유효성 검사 정규식 (8-20자의 영문, 숫자, 특수문자 1개 이상)
        const passwordPattern = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,20}$/;
        
        function validatePassword() {
            const password = passwordInput.val();
            
            if (password === '') {
                passwordInput.removeClass('is-invalid').removeClass('is-valid');
                return false;
            }
            
            if (passwordPattern.test(password)) {
                passwordInput.removeClass('is-invalid').addClass('is-valid');
                return true;
            } else {
                passwordInput.removeClass('is-valid').addClass('is-invalid');
                return false;
            }
        }

        function checkPasswordMatch() {
            const isPasswordValid = validatePassword();
            
            if (passwordConfirmInput.val() === '') { // 확인란이 비어있으면 오류 메시지 숨김
                passwordMismatchFeedback.hide();
                passwordConfirmInput.removeClass('is-invalid').removeClass('is-valid');
                return;
            }
            
            if (passwordInput.val() !== passwordConfirmInput.val()) {
                passwordMismatchFeedback.text('비밀번호가 일치하지 않습니다.').show();
                passwordConfirmInput.addClass('is-invalid').removeClass('is-valid');
            } else if (isPasswordValid) {
                passwordMismatchFeedback.hide();
                passwordConfirmInput.removeClass('is-invalid').addClass('is-valid');
            } else {
                passwordMismatchFeedback.hide();
                passwordConfirmInput.removeClass('is-invalid').removeClass('is-valid');
            }
        }

        passwordInput.on('keyup blur', function() {
            validatePassword();
            checkPasswordMatch();
        });
        passwordConfirmInput.on('keyup blur', checkPasswordMatch);

        // 회원 유형에 따른 시설 정보 필드 표시/숨김
        $('input[name="role"]').change(function() {
            if ($(this).val() === 'FACILITY') {
                $('#facilityFields').show();
                // 시설회원 필수 필드 required 속성 추가
                $('#facilityName, #facilityType, #facilityPhone, #facilityAddress').attr('required', true);
            } else {
                $('#facilityFields').hide();
                // 일반회원일 때 시설 필드 required 속성 제거
                $('#facilityName, #facilityType, #facilityPhone, #facilityAddress').removeAttr('required');
                // 지도 미리보기 숨기기
                $('#mapPreviewContainer').hide();
            }
            updateSubmitButtonState();
        });

        // 아이디 중복 체크 (Ajax)
        const userIdInput = $('#userId');
        const userIdFeedback = $('#userIdFeedback');
        const joinSubmitButton = $('#joinSubmitButton');
        let isUserIdAvailable = false; // 아이디 사용 가능 여부 플래그

        userIdInput.on('keyup blur', function() { // 키를 누르거나 포커스를 잃었을 때 체크
            const userId = $(this).val();
            if (userId.length >= 4) { // 최소 길이 이상일 때만 체크
                $.ajax({
                    url: '/member/checkUserId',
                    type: 'POST',
                    data: { userId: userId },
                    success: function(response) {
                        if (response.isDuplicate) {
                            userIdFeedback.removeClass('text-success').addClass('text-danger').text(response.message);
                            userIdInput.addClass('is-invalid').removeClass('is-valid');
                            isUserIdAvailable = false;
                        } else {
                            userIdFeedback.removeClass('text-danger').addClass('text-success').text(response.message);
                            userIdInput.addClass('is-valid').removeClass('is-invalid');
                            isUserIdAvailable = true;
                        }
                        updateSubmitButtonState();
                    },
                    error: function() {
                        userIdFeedback.removeClass('text-success').addClass('text-danger').text('아이디 중복 확인 중 오류가 발생했습니다.');
                        userIdInput.addClass('is-invalid').removeClass('is-valid');
                        isUserIdAvailable = false;
                        updateSubmitButtonState();
                    }
                });
            } else if (userId.length === 0) {
                userIdFeedback.text('');
                userIdInput.removeClass('is-invalid').removeClass('is-valid');
                isUserIdAvailable = false;
                updateSubmitButtonState();
            } else {
                userIdFeedback.removeClass('text-success').addClass('text-danger').text('아이디는 4자 이상이어야 합니다.');
                userIdInput.addClass('is-invalid').removeClass('is-valid');
                isUserIdAvailable = false;
                updateSubmitButtonState();
            }
        });

        // 폼 제출 버튼 활성화/비활성화 함수
        function updateSubmitButtonState() {
            const password = passwordInput.val();
            const isPasswordValid = passwordPattern.test(password);
            const isPasswordMatch = (password === passwordConfirmInput.val() && password !== '');
            const isNameValid = ($('#name').val() !== '');
            
            // 시설회원인 경우 추가 필드 체크
            let isFacilityFieldsValid = true;
            if ($('input[name="role"]:checked').val() === 'FACILITY') {
                const facilityName = $('#facilityName').val();
                const facilityType = $('#facilityType').val();
                const facilityPhone = $('#facilityPhone').val();
                const facilityAddress = $('#facilityAddress').val();
                const latitude = $('#latitude').val();
                const longitude = $('#longitude').val();
                isFacilityFieldsValid = facilityName !== '' && facilityType !== '' && facilityPhone !== '' && 
                                       facilityAddress !== '' && latitude !== '' && longitude !== '';
            }

            // 모든 필수 필드가 채워지고, 아이디 사용 가능하며, 비밀번호가 유효하고 일치하는지 확인
            if (isUserIdAvailable && isPasswordValid && isPasswordMatch && isNameValid && isFacilityFieldsValid) {
                joinSubmitButton.prop('disabled', false);
            } else {
                joinSubmitButton.prop('disabled', true);
            }
        }

        // 휴대폰 번호 자동 포맷팅 함수 (010-1234-5678)
        function formatMobileNumber(phoneNumber) {
            // 숫자만 추출
            const numbers = phoneNumber.replace(/[^\d]/g, '');
            
            // 길이에 따라 포맷팅
            if (numbers.length <= 3) {
                return numbers;
            } else if (numbers.length <= 7) {
                return numbers.slice(0, 3) + '-' + numbers.slice(3);
            } else {
                return numbers.slice(0, 3) + '-' + numbers.slice(3, 7) + '-' + numbers.slice(7, 11);
            }
        }

        // 시설 전화번호 자동 포맷팅 함수 (일반전화 + 휴대폰 지원)
        function formatFacilityPhone(phoneNumber) {
            // 숫자만 추출
            const numbers = phoneNumber.replace(/[^\d]/g, '');
            
            // 휴대폰 번호인 경우 (01로 시작)
            if (numbers.startsWith('01')) {
                if (numbers.length <= 3) {
                    return numbers;
                } else if (numbers.length <= 7) {
                    return numbers.slice(0, 3) + '-' + numbers.slice(3);
                } else {
                    return numbers.slice(0, 3) + '-' + numbers.slice(3, 7) + '-' + numbers.slice(7, 11);
                }
            }
            // 일반 전화번호인 경우
            else {
                // 서울 (02)
                if (numbers.startsWith('02')) {
                    if (numbers.length <= 2) {
                        return numbers;
                    } else if (numbers.length <= 5) {
                        return numbers.slice(0, 2) + '-' + numbers.slice(2);
                    } else if (numbers.length <= 6) {
                        return numbers.slice(0, 2) + '-' + numbers.slice(2, 5) + '-' + numbers.slice(5);
                    } else {
                        return numbers.slice(0, 2) + '-' + numbers.slice(2, 6) + '-' + numbers.slice(6, 10);
                    }
                }
                // 3자리 국번 지역 (031, 032, 033, 041, 042, 043, 051, 052, 053, 054, 055, 061, 062, 063, 064)
                else if (numbers.length >= 3 && /^(03[1-3]|04[1-3]|05[1-5]|06[1-4]|070)/.test(numbers)) {
                    if (numbers.length <= 3) {
                        return numbers;
                    } else if (numbers.length <= 6) {
                        return numbers.slice(0, 3) + '-' + numbers.slice(3);
                    } else if (numbers.length <= 7) {
                        return numbers.slice(0, 3) + '-' + numbers.slice(3, 6) + '-' + numbers.slice(6);
                    } else {
                        // 3-3-4 형식: 031-234-5678
                        return numbers.slice(0, 3) + '-' + numbers.slice(3, 6) + '-' + numbers.slice(6, 10);
                    }
                }
                // 기타 경우 (일반적인 3-3-4 또는 3-4-4 패턴으로 처리)
                else {
                    if (numbers.length <= 3) {
                        return numbers;
                    } else if (numbers.length <= 6) {
                        return numbers.slice(0, 3) + '-' + numbers.slice(3);
                    } else if (numbers.length <= 7) {
                        return numbers.slice(0, 3) + '-' + numbers.slice(3, 6) + '-' + numbers.slice(6);
                    } else {
                        // 3-3-4 형식으로 처리 (지역번호 기본값)
                        return numbers.slice(0, 3) + '-' + numbers.slice(3, 6) + '-' + numbers.slice(6, 10);
                    }
                }
            }
        }

        // 휴대폰 번호 입력 시 자동 포맷팅 적용
        $('#phone').on('input', function() {
            const formattedPhone = formatMobileNumber($(this).val());
            $(this).val(formattedPhone);
        });

        // 시설 전화번호 입력 시 자동 포맷팅 적용
        $('#facilityPhone').on('input', function() {
            const formattedPhone = formatFacilityPhone($(this).val());
            $(this).val(formattedPhone);
        });

        // 운영시간 선택 처리
        $('input[name="operatingType"]').change(function() {
            const operatingHours = $('#operatingHours');
            if ($(this).val() === '24시간') {
                $('#customTimeSection').hide();
                operatingHours.val('24시간 운영');
            } else {
                $('#customTimeSection').show();
                updateOperatingHours();
            }
        });

        // 시작/종료 시간 변경 시 운영시간 업데이트
        $('#startTime, #endTime').change(function() {
            if ($('#operatingCustom').is(':checked')) {
                updateOperatingHours();
            }
        });

        function updateOperatingHours() {
            const startTime = $('#startTime').val();
            const endTime = $('#endTime').val();
            $('#operatingHours').val(startTime + '-' + endTime);
        }

        // 초기 로드 시 및 모든 입력 필드 변경 시 버튼 상태 업데이트
        $('input, select, textarea').on('keyup blur change', updateSubmitButtonState);
        updateSubmitButtonState(); // 페이지 로드 시 초기 상태 설정

        // 폼 제출 전 최종 유효성 검사
        $('#joinForm').submit(function(event) {
            // 비밀번호 유효성 검사
            const password = passwordInput.val();
            if (!passwordPattern.test(password)) {
                passwordInput.addClass('is-invalid');
                event.preventDefault();
                return false;
            }

            // 비밀번호 불일치 시 제출 방지
            if (password !== passwordConfirmInput.val()) {
                passwordMismatchFeedback.text('비밀번호 확인이 일치하지 않습니다.').show();
                passwordConfirmInput.addClass('is-invalid');
                event.preventDefault();
                return false;
            }

            // 아이디 중복 확인이 완료되지 않았거나 중복인 경우 제출 방지
            if (!isUserIdAvailable) {
                userIdInput.addClass('is-invalid');
                userIdFeedback.removeClass('text-success').addClass('text-danger').text('아이디 중복 확인이 필요하거나, 이미 사용중인 아이디입니다.');
                event.preventDefault();
                return false;
            }

            // 이름이 비어있는 경우 제출 방지
            if ($('#name').val().trim() === '') {
                $('#name').addClass('is-invalid');
                event.preventDefault();
                return false;
            }

            // 모든 유효성 검사 통과 시 폼 제출 허용
            return true;
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
        const userRoleRadio = document.getElementById('roleUser');
        const facilityRoleRadio = document.getElementById('roleFacility');
        const addressAsterisk = document.getElementById('address-required-asterisk');
        const addressInput = document.getElementById('address');

        function updateAddressField() {
            if (facilityRoleRadio.checked) {
                addressAsterisk.style.display = 'inline';
                addressInput.placeholder = '시설의 정확한 주소를 검색하세요 (필수)';
            } else {
                addressAsterisk.style.display = 'none';
                addressInput.placeholder = '주소 검색 버튼을 클릭하세요 (선택사항)';
            }
        }

        userRoleRadio.addEventListener('change', updateAddressField);
        facilityRoleRadio.addEventListener('change', updateAddressField);

        updateAddressField();
    });

</script>
</body>
</html>
````

## File: src/main/resources/application.yml
````yaml
# 서버 설정
server:
  port: 8080
  servlet:
    context-path: /
    encoding:
      charset: UTF-8
      enabled: true
      force: true

# 데이터베이스 설정
spring:
  jackson:
    serialization:
      write-dates-as-timestamps: false
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: ${DB_URL:jdbc:mysql://localhost:3306/carelink?useSSL=false&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=UTF-8}
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:mysql}
    hikari:
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      maximum-pool-size: 10
      minimum-idle: 5
      pool-name: CareLink-HikariCP
      auto-commit: false
      transaction-isolation: TRANSACTION_READ_COMMITTED

  # Thymeleaf 설정
  thymeleaf:
    prefix: classpath:/templates/
    suffix: .html
    mode: HTML
    encoding: UTF-8
    cache: false  # 개발 단계에서는 캐시 비활성화
    
  # 파일 업로드 설정
  servlet:
    multipart:
      max-file-size: 50MB
      max-request-size: 50MB

# MyBatis 설정
mybatis:
  type-aliases-package: com.example.carelink.dto
  mapper-locations: classpath:mapper/*.xml
  configuration:
    map-underscore-to-camel-case: true
    jdbc-type-for-null: varchar
    default-fetch-size: 100
    default-statement-timeout: 30

# 로깅 설정
logging:
  level:
    root: INFO # 기본 루트 로그 레벨 (필요시 DEBUG로 변경)
    com.example.carelink: DEBUG # 본인의 애플리케이션 패키지 로그 레벨을 DEBUG로 높입니다.
    com.example.carelink.dao: DEBUG
    org.springframework.web: DEBUG # 웹 관련 로그를 자세히 봅니다.
    org.springframework.jdbc: DEBUG
    org.mybatis: DEBUG # MyBatis 관련 로그를 자세히 봅니다.
    org.apache.ibatis: DEBUG
    org.springframework.transaction: DEBUG
    java.sql: DEBUG # SQL 쿼리를 직접적으로 봅니다. (MyBatis가 SQL을 콘솔에 출력하도록 설정했다면)
    jdbc.sqltiming: INFO # 실제 쿼리 실행 시간 등을 보려면 INFO (혹은 DEBUG)
    com.zaxxer.hikari: DEBUG # DB 커넥션 풀 관련

# 파일 업로드 경로 설정 (로컬 디렉토리 - 프로젝트와 분리)
file:
  upload-dir:
    facility: C:/carelink-uploads/facility/
    profile: C:/carelink-uploads/profile/
    temp: C:/carelink-uploads/temp/

# SpringDoc OpenAPI 설정
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: method
  show-actuator: true
  default-consumes-media-type: application/json
  default-produces-media-type: application/json
  paths-to-match:
    - /api/**
  packages-to-scan:
    - com.lightcare.controller

# 외부 API 키 설정
api:
  kakao:
    app-key: ${KAKAO_APP_KEY:b97b58672807a40c122a5deed8a98ea4}
````

## File: src/main/resources/mapper/facilityMapper.xml
````xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.FacilityMapper">

    <resultMap id="facilityResultMap" type="com.example.carelink.dto.FacilityDTO">
        <id property="facilityId" column="facility_id"/>
        <result property="facilityName" column="facility_name"/>
        <result property="facilityType" column="facility_type"/>
        <result property="address" column="address"/>
        <result property="detailAddress" column="detail_address"/>
        <result property="phone" column="phone"/>
        <result property="latitude" column="latitude"/>
        <result property="longitude" column="longitude"/>
        <result property="description" column="description"/>
        <result property="facilityImage" column="facility_image"/>
        <result property="facilityImageAltText" column="facility_image_alt_text"/>
        <result property="homepage" column="homepage"/>
        <result property="capacity" column="capacity"/>
        <result property="currentOccupancy" column="current_occupancy"/>
        <result property="operatingHours" column="operating_hours"/>
        <result property="features" column="features"/>
        <result property="averageRating" column="average_rating"/>
        <result property="reviewCount" column="review_count"/>
        <result property="gradeRating" column="grade_rating"/>
        <result property="registeredMemberId" column="registered_member_id"/>
        <result property="registeredMemberName" column="registered_member_name"/>

        <result property="isApproved" column="is_approved"/>
        <result property="approvalStatus" column="approval_status"/>
    </resultMap>

    <select id="searchFacilities" resultMap="facilityResultMap">
        SELECT f.*, m.name as registered_member_name
        FROM facility f
        LEFT JOIN member m ON f.registered_member_id = m.member_id
        <where>
            f.is_deleted = false
            AND f.is_approved = true
            <if test="facilityName != null and facilityName != ''">
                AND f.facility_name LIKE CONCAT('%', #{facilityName}, '%')
            </if>
            <if test="facilityType != null and facilityType != ''">
                AND f.facility_type = #{facilityType}
            </if>
            <if test="address != null and address != ''">
                AND f.address LIKE CONCAT(#{address}, '%')
            </if>

            <if test="swLat != null and swLng != null and neLat != null and neLng != null">
                AND (f.latitude BETWEEN #{swLat} AND #{neLat})
                AND (f.longitude BETWEEN #{swLng} AND #{neLng})
            </if>
        </where>
        ORDER BY f.created_at DESC
    </select>

    <select id="getFacilityById" resultType="com.example.carelink.dto.FacilityDTO">
        SELECT 
            f.facility_id,
            f.facility_name,
            f.facility_type,
            f.address,
            f.phone,
            f.latitude,
            f.longitude,
            f.description,
            f.facility_image,
            f.homepage,
            f.capacity,
            f.current_occupancy,
            f.operating_hours,
            f.features,
            f.average_rating,
            f.review_count,
            f.grade_rating,
            f.registered_member_id,
            m.name as registered_member_name,
            f.is_deleted,
            f.is_approved,
            CASE 
                WHEN f.is_deleted = true THEN '삭제됨'
                WHEN f.is_approved = false THEN '승인대기'
                ELSE '정상'
            END as status
        FROM facility f
        LEFT JOIN member m ON f.registered_member_id = m.member_id
        WHERE f.facility_id = #{facilityId}
    </select>

    <select id="getAllFacilities" resultMap="facilityResultMap">
        SELECT f.*, m.name as registered_member_name
        FROM facility f
        LEFT JOIN member m ON f.registered_member_id = m.member_id
        WHERE f.is_deleted = false
        AND f.is_approved = true
        ORDER BY f.created_at DESC
    </select>

    <insert id="insertFacility" parameterType="com.example.carelink.dto.FacilityDTO" useGeneratedKeys="true" keyProperty="facilityId">
        INSERT INTO facility (
            facility_name, facility_type, address, detail_address, phone,
            latitude, longitude, description, facility_image, facility_image_alt_text, homepage,
            capacity, current_occupancy, operating_hours, features,
            average_rating, review_count, registered_member_id,
            is_approved, approval_status
        ) VALUES (
                     #{facilityName}, #{facilityType}, #{address}, #{detailAddress}, #{phone},
                     #{latitude}, #{longitude}, #{description}, #{facilityImage}, #{facilityImageAltText}, #{homepage},
                     #{capacity}, #{currentOccupancy}, #{operatingHours}, #{features},
                     #{averageRating}, #{reviewCount}, #{registeredMemberId},
                     #{isApproved}, #{approvalStatus}
                 )
    </insert>

    <update id="updateFacility" parameterType="com.example.carelink.dto.FacilityDTO">
        UPDATE facility
        SET
            facility_name = #{facilityName},
            facility_type = #{facilityType},
            address = #{address},
            detail_address = #{detailAddress},
            phone = #{phone},
            latitude = #{latitude},
            longitude = #{longitude},
            description = #{description},
            facility_image = #{facilityImage},
            facility_image_alt_text = #{facilityImageAltText},
            homepage = #{homepage},
            capacity = #{capacity},
            current_occupancy = #{currentOccupancy},
            operating_hours = #{operatingHours},
            features = #{features},
            average_rating = #{averageRating},
            review_count = #{reviewCount},
            registered_member_id = #{registeredMemberId},
            is_approved = #{isApproved},
            approval_status = #{approvalStatus},
            updated_at = NOW()
        WHERE facility_id = #{facilityId}
    </update>

    <delete id="deleteFacility">
        DELETE FROM facility WHERE facility_id = #{facilityId}
    </delete>

    <select id="countFacilitiesByRegion" resultType="int">
        SELECT COUNT(*)
        FROM facility
        WHERE address LIKE CONCAT(#{region}, '%')
    </select>

    <!-- 전체 시설 수 조회 (통계용) -->
    <select id="getFacilityCount" resultType="int">
        SELECT COUNT(*) 
        FROM facility 
        WHERE is_deleted = false
        AND is_approved = true
    </select>

    <!-- 활성화된 모든 시설 목록 조회 (리뷰 작성용) -->
    <select id="getAllActiveFacilities" resultType="com.example.carelink.dto.FacilityDTO">
        SELECT 
            f.facility_id,
            f.facility_name,
            f.facility_type,
            f.address,
            f.phone,
            f.average_rating,
            f.review_count,
            f.registered_member_id,
            m.name as registered_member_name,
            f.is_deleted,
            f.is_approved,
            CASE 
                WHEN f.is_deleted = true THEN '삭제됨'
                WHEN f.is_approved = false THEN '승인대기'
                ELSE '정상'
            END as status
        FROM facility f
        LEFT JOIN member m ON f.registered_member_id = m.member_id
        WHERE f.is_deleted = false 
        AND f.is_approved = true
        ORDER BY f.facility_name ASC
    </select>

    <!-- 회원 ID로 시설 삭제 (회원 탈퇴 시 사용) -->
    <delete id="deleteByMemberId" parameterType="long">
        DELETE FROM facility WHERE registered_member_id = #{memberId}
    </delete>

    <!-- 회원 ID로 시설 목록 조회 -->
    <select id="getFacilitiesByMemberId" parameterType="long" resultType="FacilityDTO">
        SELECT 
            facility_id as facilityId,
            facility_name as facilityName,
            facility_type as facilityType,
            address,
            detail_address as detailAddress,
            phone,
            latitude,
            longitude,
            description,
            facility_image as facilityImage,
            homepage,
            capacity,
            current_occupancy as currentOccupancy,
            operating_hours as operatingHours,
            features,
            average_rating as averageRating,
            review_count as reviewCount,
            grade_rating as gradeRating,
            registered_member_id as registeredMemberId,
            is_approved as isApproved,
            approval_status as approvalStatus,
            created_at as createdAt,
            updated_at as updatedAt,
            is_deleted as isDeleted
        FROM facility
        WHERE registered_member_id = #{memberId} AND is_deleted = false
        ORDER BY created_at DESC
    </select>

    <!-- 회원 ID로 시설 조회 (첫 번째 시설만) -->
    <select id="getFacilityByMemberId" parameterType="long" resultType="FacilityDTO">
        SELECT 
            facility_id as facilityId,
            facility_name as facilityName,
            facility_type as facilityType,
            address,
            detail_address as detailAddress,
            phone,
            latitude,
            longitude,
            description,
            facility_image as facilityImage,
            homepage,
            capacity,
            current_occupancy as currentOccupancy,
            operating_hours as operatingHours,
            features,
            average_rating as averageRating,
            review_count as reviewCount,
            grade_rating as gradeRating,
            registered_member_id as registeredMemberId,
            is_approved as isApproved,
            approval_status as approvalStatus,
            created_at as createdAt,
            updated_at as updatedAt,
            is_deleted as isDeleted
        FROM facility
        WHERE registered_member_id = #{memberId} AND is_deleted = false
        ORDER BY created_at DESC
        LIMIT 1
    </select>

    <!-- ================== 관리자용 쿼리들 ================== -->
    
    <!-- 승인 상태별 시설 목록 조회 (관리자용) -->
    <select id="getFacilitiesByApprovalStatus" parameterType="string" resultType="FacilityDTO">
        SELECT 
            f.facility_id,
            f.facility_name,
            f.facility_type,
            f.address,
            f.detail_address,
            f.phone,
            f.description,
            f.homepage,
            f.capacity,
            f.operating_hours,
            f.features,
            f.facility_image,
            f.latitude,
            f.longitude,
            f.approval_status,
            f.registered_member_id,
            f.created_at,
            f.updated_at,
            m.user_id as registeredUserName,
            m.name as registeredMemberName
        FROM facility f
        LEFT JOIN member m ON f.registered_member_id = m.member_id
        WHERE f.is_deleted = false
        <if test="approvalStatus != null and approvalStatus != ''">
            AND f.approval_status = #{approvalStatus}
        </if>
        ORDER BY f.created_at DESC
    </select>

    <!-- 시설 승인 상태 업데이트 (관리자용) -->
    <update id="updateFacilityApprovalStatus">
        UPDATE facility 
        SET 
            approval_status = #{approvalStatus},
            is_approved = (#{approvalStatus} = 'APPROVED'),
            <if test="rejectionReason != null">
            description = CONCAT(COALESCE(description, ''), CHAR(10), '거부사유: ', #{rejectionReason}),
            </if>
            updated_at = NOW()
        WHERE facility_id = #{facilityId}
    </update>

    <!-- 승인 상태별 시설 수 조회 (관리자용) -->
    <select id="countFacilitiesByStatus" parameterType="string" resultType="int">
        SELECT COUNT(*) 
        FROM facility 
        WHERE is_deleted = false 
        AND approval_status = #{approvalStatus}
    </select>
    
    <!-- 시설 메인 이미지 정보 업데이트 -->
    <update id="updateFacilityMainImage">
        UPDATE facility 
        SET 
            facility_image = #{mainImagePath},
            image_count = #{imageCount},
            updated_at = NOW()
        WHERE facility_id = #{facilityId}
    </update>

</mapper>
````

## File: src/main/java/com/example/carelink/controller/FacilityController.java
````java
package com.example.carelink.controller;

import com.example.carelink.dto.FacilityDTO;
import com.example.carelink.dto.FacilityImageDTO;
import com.example.carelink.dto.ReviewDTO;
import com.example.carelink.service.FacilityService;
import com.example.carelink.service.ReviewService;
import com.example.carelink.service.FacilityImageService;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.context.annotation.Bean;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.common.Constants;
import org.springframework.beans.factory.annotation.Value;
import javax.servlet.http.HttpSession;

import java.util.List;
import java.util.ArrayList; // ArrayList를 사용하기 위해 추가된 import 문
import java.util.Map;
import java.util.HashMap;

@Controller
@RequestMapping("/facility")
@RequiredArgsConstructor
@Slf4j
public class FacilityController {

    private final FacilityService facilityService;
    private final ReviewService reviewService;
    private final FacilityImageService facilityImageService;
    
    @Value("${api.kakao.app-key}")
    private String kakaoAppKey;

    /**
     * Jackson ObjectMapper에 Java 8 날짜/시간 모듈을 등록합니다.
     * 이 메서드는 Spring 컨텍스트에 ObjectMapper 빈을 등록하여
     * LocalDateTime 직렬화 문제를 해결합니다.
     */
    @Bean
    public ObjectMapper objectMapper() {
        ObjectMapper mapper = new ObjectMapper();
        mapper.registerModule(new JavaTimeModule());
        return mapper;
    }

    /**
     * 시설 상세 정보 API (내 시설 관리용)
     */
    @GetMapping("/facility-info/{facilityId}")
    @ResponseBody
    public Map<String, Object> getFacilityInfo(@PathVariable Long facilityId, HttpSession session) {
        Map<String, Object> result = new HashMap<>();
        
        try {
            MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (member == null) {
                result.put("success", false);
                result.put("message", "로그인이 필요합니다.");
                return result;
            }
            
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                result.put("success", false);
                result.put("message", "시설을 찾을 수 없습니다.");
                return result;
            }
            
            // 권한 확인 (시설 소유자 또는 관리자만)
            if (!facility.getRegisteredMemberId().equals(member.getMemberId()) 
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                result.put("success", false);
                result.put("message", "해당 시설 정보를 조회할 권한이 없습니다.");
                return result;
            }
            
            result.put("success", true);
            result.put("facility", facility);
            
            log.info("시설 상세 정보 API 조회 완료: facilityId={}, memberId={}", facilityId, member.getMemberId());
            
        } catch (Exception e) {
            log.error("시설 상세 정보 API 조회 중 오류: facilityId={}", facilityId, e);
            result.put("success", false);
            result.put("message", "시설 정보 조회 중 오류가 발생했습니다.");
        }
        
        return result;
    }


    /**
     * 내 시설에서 시설 수정 페이지로 이동
     */
    @GetMapping("/manage/{facilityId}/edit")
    public String redirectToEdit(@PathVariable Long facilityId) {
        log.info("내 시설에서 시설 수정으로 리다이렉트: facilityId={}", facilityId);
        return "redirect:/facility/edit/" + facilityId;
    }

    /**
     * 시설 검색 페이지 및 검색 결과 조회
     */
    @GetMapping("/search")
    public String searchFacilities(
            @RequestParam(value = "facilityName", required = false) String facilityName,
            @RequestParam(value = "region", required = false) String region,
            @RequestParam(value = "facilityType", required = false) String facilityType,
            @RequestParam(value = "gradeRating", required = false) String gradeRating,
            Model model
    ) {
        log.info("시설 검색 페이지 접속 - facilityName: {}, region: {}, facilityType: {}, gradeRating: {}",
                facilityName, region, facilityType, gradeRating);

        List<FacilityDTO> facilityList = new ArrayList<>();
        
        try {
            // 빈 문자열을 null로 변환
            facilityName = (facilityName != null && facilityName.trim().isEmpty()) ? null : facilityName;
            region = (region != null && region.trim().isEmpty()) ? null : region;
            facilityType = (facilityType != null && facilityType.trim().isEmpty()) ? null : facilityType;

            FacilityDTO searchCondition = new FacilityDTO();
            searchCondition.setFacilityName(facilityName != null ? facilityName.trim() : null);
            searchCondition.setFacilityType(facilityType);
            searchCondition.setAddress(region); // 지역 검색용

            // DTO 객체를 서비스 메서드로 전달하여 검색을 수행합니다.
            facilityList = facilityService.searchFacilities(searchCondition);

            // 검색 결과가 null일 경우 빈 리스트로 초기화하여 Thymeleaf 오류를 방지합니다.
            if (facilityList == null) {
                facilityList = new ArrayList<>();
            }
            
        } catch (Exception e) {
            log.error("시설 검색 중 오류 발생", e);
            facilityList = new ArrayList<>();
        }

        // 검색 결과를 모델에 추가합니다.
        model.addAttribute("facilityList", facilityList);
        model.addAttribute("facilityName", facilityName);
        model.addAttribute("region", region);
        model.addAttribute("facilityType", facilityType);
        model.addAttribute("gradeRating", gradeRating);
        
        // 카카오맵 API 키를 모델에 추가
        model.addAttribute("KAKAO_APP_KEY", kakaoAppKey);

        log.info("검색된 시설 수: {}", facilityList.size());

        // 'search.html' 템플릿을 반환합니다.
        return "facility/search";
    }

    /**
     * 시설 상세 정보 페이지
     */
    @GetMapping("/detail/{facilityId}")
    public String getFacilityDetail(@PathVariable Long facilityId, Model model, HttpSession session) {
        log.info("시설 상세 정보 페이지 접속 - facilityId: {}", facilityId);
        
        try {
            // 시설 정보 조회
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                model.addAttribute("error", "해당 시설을 찾을 수 없습니다.");
                return "redirect:/facility/search";
            }
            
            // 해당 시설의 리뷰 목록 조회 (최근 5개)
            List<ReviewDTO> recentReviews = reviewService.getReviewsByFacilityId(facilityId);
            if (recentReviews.size() > 5) {
                recentReviews = recentReviews.subList(0, 5);
            }
            
            // 시설의 평균 평점 조회
            Double averageRating = reviewService.getAverageRating(facilityId);
            
            // 세션에서 사용자 정보 조회 (관리자 권한 체크용)
            MemberDTO sessionMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            boolean isAdmin = sessionMember != null && "ADMIN".equals(sessionMember.getRole());
            boolean isOwner = sessionMember != null && facility.getRegisteredMemberId() != null && 
                             facility.getRegisteredMemberId().equals(sessionMember.getMemberId());
            
            model.addAttribute("facility", facility);
            model.addAttribute("recentReviews", recentReviews);
            model.addAttribute("averageRating", averageRating);
            model.addAttribute("reviewCount", recentReviews.size());
            model.addAttribute("pageTitle", facility.getFacilityName() + " 상세정보");
            model.addAttribute("sessionMember", sessionMember);
            model.addAttribute("isAdmin", isAdmin);
            model.addAttribute("isOwner", isOwner);
            
            log.info("시설 상세 정보 조회 완료 - facilityId: {}, 리뷰 수: {}, 관리자: {}, 소유자: {}", 
                    facilityId, recentReviews.size(), isAdmin, isOwner);
            
            return "facility/detail";
        } catch (Exception e) {
            log.error("시설 상세 정보 조회 중 오류 발생 - facilityId: {}", facilityId, e);
            model.addAttribute("error", "시설 정보를 불러오는 중 오류가 발생했습니다.");
            return "redirect:/facility/search";
        }
    }

    /**
     * 시설 관리 페이지
     */
    @GetMapping("/manage")
    public String manageFacility(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        
        if (member == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        
        if (!Constants.MEMBER_ROLE_FACILITY.equals(member.getRole())) {
            redirectAttributes.addFlashAttribute("error", "시설 회원만 접근할 수 있습니다.");
            return "redirect:/";
        }
        
        try {
            // 회원의 모든 시설 정보 조회
            List<FacilityDTO> facilities = facilityService.getFacilitiesByMemberId(member.getMemberId());
            
            // 각 시설별 구인공고 수 조회 (TODO: 향후 JobService에서 조회)
            // for (FacilityDTO facility : facilities) {
            //     int jobCount = jobService.getJobCountByFacilityId(facility.getFacilityId());
            //     facility.setJobCount(jobCount);
            // }
            
            model.addAttribute("facilities", facilities);
            model.addAttribute("facilityCount", facilities.size());
            log.info("시설 관리 페이지 접근: memberId={}, 시설 수={}", 
                    member.getMemberId(), facilities.size());
            
            return "facility/manage";
        } catch (Exception e) {
            log.error("시설 관리 페이지 조회 중 오류 발생: memberId={}", member.getMemberId(), e);
            redirectAttributes.addFlashAttribute("error", "시설 정보를 불러오는 중 오류가 발생했습니다.");
            return "redirect:/";
        }
    }

    /**
     * 시설 수정 페이지
     */
    @GetMapping("/edit/{facilityId}")
    public String editFacilityForm(@PathVariable Long facilityId, HttpSession session, 
                                   Model model, RedirectAttributes redirectAttributes) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        
        if (member == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        
        try {
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            
            if (facility == null) {
                redirectAttributes.addFlashAttribute("error", "시설을 찾을 수 없습니다.");
                return "redirect:/facility/manage";
            }
            
            // 권한 확인 (시설 소유자 또는 관리자만 수정 가능)
            if (!facility.getRegisteredMemberId().equals(member.getMemberId()) 
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                redirectAttributes.addFlashAttribute("error", "해당 시설을 수정할 권한이 없습니다.");
                return "redirect:/facility/manage";
            }
            
            model.addAttribute("facility", facility);
            log.info("시설 수정 페이지 접근: facilityId={}, memberId={}", facilityId, member.getMemberId());
            
            return "facility/edit";
        } catch (Exception e) {
            log.error("시설 수정 페이지 조회 중 오류 발생: facilityId={}", facilityId, e);
            redirectAttributes.addFlashAttribute("error", "시설 정보를 불러오는 중 오류가 발생했습니다.");
            return "redirect:/facility/manage";
        }
    }

    /**
     * 시설 수정 처리
     */
    @PostMapping("/edit/{facilityId}")
    public String updateFacility(@PathVariable Long facilityId,
                                @ModelAttribute FacilityDTO facilityDTO,
                                @RequestParam(value = "facilityImageFile", required = false) MultipartFile facilityImageFile,
                                HttpSession session,
                                RedirectAttributes redirectAttributes) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        
        if (member == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        
        try {
            FacilityDTO existingFacility = facilityService.getFacilityById(facilityId);
            
            if (existingFacility == null) {
                redirectAttributes.addFlashAttribute("error", "시설을 찾을 수 없습니다.");
                return "redirect:/facility/manage";
            }
            
            // 권한 확인
            if (!existingFacility.getRegisteredMemberId().equals(member.getMemberId()) 
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                redirectAttributes.addFlashAttribute("error", "해당 시설을 수정할 권한이 없습니다.");
                return "redirect:/facility/manage";
            }
            
            // 기본 정보 유지
            facilityDTO.setFacilityId(facilityId);
            facilityDTO.setRegisteredMemberId(existingFacility.getRegisteredMemberId());
            facilityDTO.setIsApproved(existingFacility.getIsApproved());
            
            // approval_status가 null인 경우 기본값 설정
            String approvalStatus = existingFacility.getApprovalStatus();
            if (approvalStatus == null || approvalStatus.trim().isEmpty()) {
                // 기존 시설의 is_approved 상태를 기반으로 적절한 값 설정
                if (existingFacility.getIsApproved() != null && existingFacility.getIsApproved()) {
                    approvalStatus = "APPROVED";
                    log.info("🔧 approval_status NULL 방지 - 승인된 시설: APPROVED");
                } else {
                    approvalStatus = "PENDING";
                    log.info("🔧 approval_status NULL 방지 - 미승인 시설: PENDING");
                }
            }
            facilityDTO.setApprovalStatus(approvalStatus);
            
            facilityDTO.setAverageRating(existingFacility.getAverageRating());
            facilityDTO.setReviewCount(existingFacility.getReviewCount());
            facilityDTO.setCurrentOccupancy(existingFacility.getCurrentOccupancy());
            facilityDTO.setGradeRating(existingFacility.getGradeRating());
            
            // 시설 정보 수정 (이미지 파일 포함)
            facilityService.updateFacility(facilityDTO, facilityImageFile);
            
            log.info("시설 정보 수정 완료: facilityId={}, memberId={}", facilityId, member.getMemberId());
            redirectAttributes.addFlashAttribute("message", "시설 정보가 성공적으로 수정되었습니다.");
            
            return "redirect:/facility/manage";
        } catch (Exception e) {
            log.error("시설 정보 수정 중 오류 발생: facilityId={}", facilityId, e);
            redirectAttributes.addFlashAttribute("error", "시설 정보 수정 중 오류가 발생했습니다.");
            return "redirect:/facility/edit/" + facilityId;
        }
    }

    /**
     * 시설 삭제
     */
    @PostMapping("/delete/{facilityId}")
    public String deleteFacility(@PathVariable Long facilityId,
                                HttpSession session,
                                RedirectAttributes redirectAttributes) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        
        if (member == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        
        try {
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            
            if (facility == null) {
                redirectAttributes.addFlashAttribute("error", "시설을 찾을 수 없습니다.");
                return "redirect:/facility/manage";
            }
            
            // 권한 확인
            if (!facility.getRegisteredMemberId().equals(member.getMemberId()) 
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                redirectAttributes.addFlashAttribute("error", "해당 시설을 삭제할 권한이 없습니다.");
                return "redirect:/facility/manage";
            }
            
            // 시설 삭제
            facilityService.deleteFacility(facilityId);
            
            log.info("시설 삭제 완료: facilityId={}, memberId={}", facilityId, member.getMemberId());
            redirectAttributes.addFlashAttribute("message", "시설이 성공적으로 삭제되었습니다.");
            
            return "redirect:/facility/manage";
        } catch (Exception e) {
            log.error("시설 삭제 중 오류 발생: facilityId={}", facilityId, e);
            redirectAttributes.addFlashAttribute("error", "시설 삭제 중 오류가 발생했습니다.");
            return "redirect:/facility/manage";
        }
    }

    /**
     * 시설 API - AJAX용
     */
    @GetMapping("/api/{facilityId}")
    @ResponseBody
    public FacilityDTO getFacilityApi(@PathVariable Long facilityId, HttpSession session) {
        MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        
        if (member == null) {
            throw new RuntimeException("로그인이 필요합니다.");
        }
        
        FacilityDTO facility = facilityService.getFacilityById(facilityId);
        
        if (facility == null) {
            throw new RuntimeException("시설을 찾을 수 없습니다.");
        }
        
        // 권한 확인 (시설 소유자 또는 관리자만 조회 가능)
        if (!facility.getRegisteredMemberId().equals(member.getMemberId()) 
            && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
            throw new RuntimeException("해당 시설을 조회할 권한이 없습니다.");
        }
        
        return facility;
    }

    /**
     * 시설 이미지 크롭 페이지
     */
    @GetMapping("/crop-images/{facilityId}")
    public String cropImagePage(@PathVariable Long facilityId, 
                                HttpSession session, 
                                Model model, 
                                RedirectAttributes redirectAttributes) {
        try {
            MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            
            if (member == null) {
                redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
                return "redirect:/member/login";
            }
            
            // 시설 정보 조회
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                redirectAttributes.addFlashAttribute("error", "시설을 찾을 수 없습니다.");
                return "redirect:/facility/manage";
            }
            
            // 권한 확인 (시설 소유자 또는 관리자만 접근 가능)
            if (!facility.getRegisteredMemberId().equals(member.getMemberId()) 
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                redirectAttributes.addFlashAttribute("error", "해당 시설의 이미지를 관리할 권한이 없습니다.");
                return "redirect:/facility/manage";
            }
            
            model.addAttribute("facility", facility);
            log.info("시설 이미지 크롭 페이지 접속: facilityId={}, memberId={}", facilityId, member.getMemberId());
            
            return "facility/crop-images";
            
        } catch (Exception e) {
            log.error("시설 이미지 크롭 페이지 오류: facilityId={}", facilityId, e);
            redirectAttributes.addFlashAttribute("error", "페이지 로드 중 오류가 발생했습니다.");
            return "redirect:/facility/manage";
        }
    }

    /**
     * 시설 이미지 저장 처리 (다중 이미지 지원)
     */
    @PostMapping("/crop-images/save/{facilityId}")
    @ResponseBody
    public Map<String, Object> saveFacilityImage(@PathVariable Long facilityId,
                                                @RequestParam("facilityImage") MultipartFile facilityImageFile,
                                                @RequestParam(value = "altText", required = false) String altText,
                                                @RequestParam(value = "format", required = false) String format,
                                                @RequestParam(value = "imageIndex", required = false) String imageIndex,
                                                @RequestParam(value = "customFileName", required = false) String customFileName,
                                                HttpSession session) {
        Map<String, Object> result = new HashMap<>();
        
        try {
            log.info("🔥 시설 이미지 저장 시작 - facilityId: {}, 받은 파라미터들 확인", facilityId);
            log.info("📋 altText: '{}', format: '{}', imageIndex: '{}', customFileName: '{}'", altText, format, imageIndex, customFileName);
            log.info("📁 파일 정보 - 이름: '{}', 크기: {}bytes, 타입: '{}'", 
                    facilityImageFile.getOriginalFilename(), facilityImageFile.getSize(), facilityImageFile.getContentType());
            
            MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (member == null) {
                log.error("❌ 로그인된 사용자가 없음");
                result.put("success", false);
                result.put("message", "로그인이 필요합니다.");
                return result;
            }
            
            log.info("👤 로그인 사용자: {} (role: {})", member.getUserId(), member.getRole());
            
            // 시설 정보 조회 및 권한 확인
            FacilityDTO facility = facilityService.getFacilityById(facilityId);
            if (facility == null) {
                result.put("success", false);
                result.put("message", "시설을 찾을 수 없습니다.");
                return result;
            }
            
            if (!facility.getRegisteredMemberId().equals(member.getMemberId()) 
                && !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
                result.put("success", false);
                result.put("message", "해당 시설의 이미지를 관리할 권한이 없습니다.");
                return result;
            }
            
            log.info("🖼️ 시설 이미지 저장 요청 - facilityId: {}, 형식: {}, 인덱스: {}, 크기: {} bytes", 
                    facilityId, format, imageIndex, facilityImageFile.getSize());
            
            // 업로드된 파일이 유효한지 확인
            if (facilityImageFile.isEmpty()) {
                result.put("success", false);
                result.put("message", "업로드된 이미지 파일이 비어있습니다.");
                return result;
            }
            
            // Alt 텍스트 설정
            String finalAltText;
            if (altText != null && !altText.trim().isEmpty()) {
                finalAltText = altText.trim();
                log.info("🏷️ 시설 이미지 Alt 텍스트 설정: {}", finalAltText);
            } else {
                // 기본값 설정
                finalAltText = facility.getFacilityName() + " 시설 이미지";
                if (imageIndex != null && !imageIndex.isEmpty()) {
                    finalAltText += " " + (Integer.parseInt(imageIndex) + 1);
                }
                log.info("🏷️ 시설 이미지 Alt 텍스트 기본값 설정: {}", finalAltText);
            }
            
            // 이미지 형식 정보 로깅
            String contentType = facilityImageFile.getContentType();
            if (contentType != null) {
                log.info("📷 업로드된 이미지 형식: {}", contentType);
                if (contentType.contains("avif")) {
                    log.info("✨ AVIF 형식 감지 - 최적 압축 적용됨");
                } else if (contentType.contains("webp")) {
                    log.info("🚀 WebP 형식 감지 - 효율적 압축 적용됨");
                } else if (contentType.contains("jpeg")) {
                    log.info("📸 JPEG 형식 감지 - 호환성 우선 적용됨");
                }
            }
            
            // 다중 이미지 시스템으로 저장 (사용자 지정 파일명 지원)
            Integer orderIndex = imageIndex != null ? Integer.parseInt(imageIndex) : null;
            log.info("🔧 서비스 호출 전 - facilityId: {}, orderIndex: {}, altText: '{}', customFileName: '{}'", 
                facilityId, orderIndex, finalAltText, customFileName);
            
            FacilityImageDTO savedImage = facilityImageService.saveSingleFacilityImage(
                facilityId, facilityImageFile, finalAltText, orderIndex, customFileName);
            
            log.info("✅ 서비스 호출 완료 - 저장된 이미지ID: {}, 경로: {}", savedImage.getImageId(), savedImage.getImagePath());
            
            result.put("success", true);
            result.put("message", "시설 이미지가 성공적으로 저장되었습니다.");
            result.put("facilityId", facilityId);
            result.put("imageIndex", imageIndex);
            result.put("imageId", savedImage.getImageId());
            result.put("imagePath", savedImage.getImagePath());
            
            log.info("✅ 시설 이미지 저장 성공: facilityId={}, imageId={}", facilityId, savedImage.getImageId());
            
        } catch (Exception e) {
            log.error("❌ 시설 이미지 저장 중 오류 발생: facilityId={}", facilityId, e);
            result.put("success", false);
            result.put("message", "이미지 저장 중 오류가 발생했습니다: " + e.getMessage());
        }
        
        return result;
    }
    
    // 이미지 목록 조회 API는 FacilityImageApiController로 이동됨 (/api/facility/{facilityId}/images)
    // 중복 API 제거로 데이터 정합성 및 일관성 확보
    
    // 이미지 관리 API들은 FacilityImageApiController로 이동됨
    // Thymeleaf 인라인 자바스크립트 충돌 방지를 위해 별도 컨트롤러 사용
}
````

## File: src/main/java/com/example/carelink/controller/MemberController.java
````java
package com.example.carelink.controller;

import com.example.carelink.dto.LoginDTO;
import com.example.carelink.dto.MemberDTO;
import com.example.carelink.service.MemberService;
import com.example.carelink.common.Constants;
import com.example.carelink.validation.groups.OnFacilityJoin;
import com.example.carelink.common.CustomMultipartFile;
import org.springframework.web.multipart.MultipartFile;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile; // MultipartFile 유지
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import javax.servlet.http.HttpSession; // 세션 관리를 위해 필요
import javax.validation.ConstraintViolation;
import javax.validation.Valid; // @Valid 어노테이션을 위해 필요
// import java.security.Principal; // Principal 제거
import javax.validation.Validator;

import java.util.HashMap;
import java.util.List; // List 유지
import java.util.Map;
import java.util.Set;

/**
 * 회원 관리 컨트롤러
 * 팀원 A 담당: 로그인, 회원가입, 회원정보 관리
 */
@Slf4j
@Controller
@RequestMapping("/member")
@RequiredArgsConstructor
public class MemberController {

    private final MemberService memberService;

    @Autowired
    private Validator validator;

    /**
     * 로그인 페이지 표시
     */
    @GetMapping("/login")
    public String loginForm(Model model) {
        model.addAttribute("loginDTO", new LoginDTO());
        return "member/login";
    }

    /**
     * 로그인 처리
     */
    @PostMapping("/login")
    public String login(@Valid @ModelAttribute LoginDTO loginDTO,
                        BindingResult bindingResult,
                        HttpSession session,
                        RedirectAttributes redirectAttributes) {

        // DTO 유효성 검증 실패 시
        if (bindingResult.hasErrors()) {
            log.warn("로그인 폼 유효성 검사 실패: {}", bindingResult.getAllErrors());
            return "member/login"; // 에러가 있으면 로그인 폼으로 다시 이동
        }

        log.info("로그인 시도: userId={}, 비밀번호 길이={}", loginDTO.getUserId(), loginDTO.getPassword().length());

        try {
            // MemberService를 통해 로그인 시도
            MemberDTO loginMember = memberService.login(loginDTO);

            if (loginMember != null) {
                // 로그인 성공 시 세션에 회원 정보 저장
                session.setAttribute(Constants.SESSION_MEMBER, loginMember);
                session.setAttribute("memberId", loginMember.getMemberId());
                log.info("컨트롤러 로그인 성공: userId={}, role={}", loginMember.getUserId(), loginMember.getRole());

                redirectAttributes.addFlashAttribute("message", "로그인되었습니다.");
                return "redirect:/"; // 홈 페이지로 리다이렉트
            } else {
                // 로그인 실패 시 에러 메시지 추가
                log.warn("컨트롤러 로그인 실패: userId={}", loginDTO.getUserId());
                redirectAttributes.addFlashAttribute("error", "아이디 또는 비밀번호가 잘못되었습니다.");
                return "redirect:/member/login"; // 로그인 페이지로 리다이렉트
            }

        } catch (Exception e) {
            log.error("로그인 처리 중 오류 발생: userId={}", loginDTO.getUserId(), e);
            redirectAttributes.addFlashAttribute("error", "로그인 처리 중 오류가 발생했습니다.");
            return "redirect:/member/login";
        }
    }

    /**
     * 로그아웃 처리
     */
    @GetMapping("/logout")
    public String logout(HttpSession session, RedirectAttributes redirectAttributes) {
        if (session != null) {
            session.invalidate(); // 현재 세션 무효화
        }
        redirectAttributes.addFlashAttribute("message", "로그아웃되었습니다.");
        return "redirect:/"; // 홈 페이지로 리다이렉트
    }

    /**
     * 회원가입 페이지 표시
     */
    @GetMapping("/join")
    public String joinForm(Model model) {
        model.addAttribute("memberDTO", new MemberDTO());
        return "member/join";
    }

    @PostMapping("/join")
    public String join(
            // @Validated에서 OnFacilityJoin 그룹을 제거합니다.
            // 이제 Default 그룹에 속한 유효성만 자동 검사됩니다 (ex: email, role 등)
            @Validated(value = {javax.validation.groups.Default.class})
            @ModelAttribute MemberDTO memberDTO,
            BindingResult bindingResult,
            @RequestParam(value = "facilityImageFile", required = false) MultipartFile facilityImageFile,
            HttpSession session,
            RedirectAttributes redirectAttributes,
            Model model) {

        // 1. 비밀번호 확인 검사 (기존과 동일)
        if (!memberDTO.getPassword().equals(memberDTO.getPasswordConfirm())) {
            bindingResult.rejectValue("passwordConfirm", "password.mismatch", "비밀번호 확인이 일치하지 않습니다.");
            log.warn("회원가입 실패: 비밀번호 확인 불일치");
            model.addAttribute("memberDTO", memberDTO);
            return "member/join";
        }

        // 2. 시설 회원일 경우에만 address 필드에 대한 추가 유효성 검사 수행
        // 일반 회원('USER')일 때는 이 블록이 실행되지 않으므로 address 검사가 일어나지 않습니다.
        if ("FACILITY".equalsIgnoreCase(memberDTO.getRole())) {
            // Validator를 사용하여 MemberDTO에 대해 OnFacilityJoin 그룹에 속하는 제약 조건만 수동으로 검사
            Set<ConstraintViolation<MemberDTO>> violations = validator.validate(memberDTO, OnFacilityJoin.class);
            for (ConstraintViolation<MemberDTO> violation : violations) {
                // 발생한 위반 사항을 bindingResult에 추가
                bindingResult.rejectValue(violation.getPropertyPath().toString(), "", violation.getMessage());
            }
        }

        // 3. 최종 유효성 검사 결과 확인 (기본 유효성 + 수동 추가된 유효성)
        if (bindingResult.hasErrors()) {
            log.warn("회원가입 유효성 검사 실패: {}", bindingResult.getAllErrors());
            model.addAttribute("memberDTO", memberDTO);
            return "member/join";
        }

        try {
            // MemberService를 통해 회원가입 처리 (시설 이미지 파일 포함)
            memberService.join(memberDTO, facilityImageFile);
            log.info("회원가입 성공: {}", memberDTO.getUserId());

            // 회원가입 후 자동 로그인 처리
            LoginDTO loginDTO = new LoginDTO();
            loginDTO.setUserId(memberDTO.getUserId());
            loginDTO.setPassword(memberDTO.getPassword());
            
            MemberDTO loginMember = memberService.login(loginDTO);
            if (loginMember != null) {
                // 자동 로그인 성공 시 세션에 회원 정보 저장
                session.setAttribute(Constants.SESSION_MEMBER, loginMember);
                session.setAttribute("memberId", loginMember.getMemberId());
                log.info("회원가입 후 자동 로그인 성공: userId={}", loginMember.getUserId());
                
                redirectAttributes.addFlashAttribute("message", "회원가입이 완료되었습니다. 환영합니다!");
                return "redirect:/"; // 홈 페이지로 리다이렉트
            } else {
                // 자동 로그인 실패 시 로그인 페이지로
                log.warn("회원가입은 성공했으나 자동 로그인 실패: {}", memberDTO.getUserId());
                redirectAttributes.addFlashAttribute("message", "회원가입이 완료되었습니다. 로그인해주세요.");
                return "redirect:/member/login";
            }

        } catch (IllegalArgumentException e) {
            // 서비스 계층에서 발생한 아이디 중복 등의 비즈니스 로직 예외 처리
            log.warn("회원가입 실패: {}", e.getMessage());
            bindingResult.rejectValue("userId", "duplicate.userId", e.getMessage()); // userId 필드에 에러 추가
            return "member/join";
        } catch (Exception e) {
            log.error("회원가입 처리 중 알 수 없는 오류 발생", e);
            redirectAttributes.addFlashAttribute("error", "회원가입 처리 중 오류가 발생했습니다.");
            return "member/join";
        }

    }

    /**
     * 아이디 중복 체크 (Ajax 요청 처리)
     */
    @PostMapping("/checkUserId")
    @ResponseBody // JSON 응답을 위해 사용
    public Map<String, Object> checkUserId(@RequestParam String userId) {
        Map<String, Object> result = new HashMap<>();

        try {
            // boolean isDuplicate = memberService.isUserIdDuplicate(userId);
            boolean isDuplicate = memberService.isUserIdDuplicate(userId);
            result.put("isDuplicate", isDuplicate);
            result.put("message", isDuplicate ? "이미 사용중인 아이디입니다." : "사용 가능한 아이디입니다.");

        } catch (Exception e) {
            log.error("아이디 중복 체크 중 오류 발생", e);
            result.put("error", "중복 체크 중 오류가 발생했습니다.");
        }

        return result;
    }

    /**
     * 디버깅용 비밀번호 테스트 엔드포인트
     */
    @GetMapping("/debug/password-test")
    @ResponseBody
    public Map<String, Object> debugPasswordTest(@RequestParam(defaultValue = "admin") String userId,
                                                 @RequestParam(defaultValue = "admin123") String password) {
        Map<String, Object> result = new HashMap<>();
        
        try {
            // 1. 사용자 정보 조회
            MemberDTO member = memberService.getMemberByUserId(userId);
            if (member == null) {
                result.put("error", "사용자를 찾을 수 없습니다: " + userId);
                return result;
            }
            
            // 2. 기본 정보 표시
            result.put("userId", member.getUserId());
            result.put("dbPasswordHash", member.getPassword());
            result.put("dbPasswordLength", member.getPassword().length());
            result.put("inputPassword", password);
            result.put("inputPasswordLength", password.length());
            
            // 3. BCrypt 해시 형식 검증
            boolean isValidBcryptFormat = member.getPassword().startsWith("$2a$") || 
                                        member.getPassword().startsWith("$2b$") || 
                                        member.getPassword().startsWith("$2y$");
            result.put("isValidBcryptFormat", isValidBcryptFormat);
            
            // 4. 직접 비밀번호 매칭 테스트
            LoginDTO loginDTO = new LoginDTO();
            loginDTO.setUserId(userId);
            loginDTO.setPassword(password);
            
            MemberDTO loginResult = memberService.login(loginDTO);
            result.put("loginSuccess", loginResult != null);
            
            // 5. 회원 상태 정보
            result.put("isActive", member.getIsActive());
            result.put("isDeleted", member.getIsDeleted());
            result.put("loginFailCount", member.getLoginFailCount());
            result.put("role", member.getRole());
            
            log.info("디버깅 테스트 결과: {}", result);
            
        } catch (Exception e) {
            log.error("디버깅 테스트 중 오류 발생", e);
            result.put("error", "테스트 중 오류 발생: " + e.getMessage());
        }
        
        return result;
    }

    /**
     * 비밀번호 확인 페이지 (내 정보 수정 전)
     */
    @GetMapping("/myinfo")
    public String verifyPasswordForm(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);

        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }

        return "member/verifyPassword";
    }
    
    /**
     * 비밀번호 확인 처리
     */
    @PostMapping("/myinfo/verify")
    public String verifyPassword(@RequestParam("password") String password,
                                HttpSession session,
                                RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);

        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }

        try {
            // 비밀번호 확인
            if (!password.equals(loginMember.getPassword())) {
                redirectAttributes.addFlashAttribute("error", "비밀번호가 일치하지 않습니다.");
                return "redirect:/member/myinfo";
            }
            
            // 비밀번호 확인 성공 시 실제 내정보 페이지로 이동
            return "redirect:/member/myinfo/edit";
            
        } catch (Exception e) {
            log.error("비밀번호 확인 중 오류 발생: {}", loginMember.getUserId(), e);
            redirectAttributes.addFlashAttribute("error", "비밀번호 확인 중 오류가 발생했습니다.");
            return "redirect:/member/myinfo";
        }
    }

    /**
     * 내 정보 수정 페이지 표시 (비밀번호 확인 후)
     */
    @GetMapping("/myinfo/edit")
    public String myInfoEdit(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);

        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }

        try {
            // memberId로 회원 정보 조회
            MemberDTO memberInfo = memberService.findById(loginMember.getMemberId());

            if (memberInfo == null) {
                redirectAttributes.addFlashAttribute("error", "사용자 정보를 찾을 수 없습니다.");
                // 세션 정보가 유효하지 않을 수 있으므로, 로그인 페이지로 리다이렉트하거나 세션을 무효화할 수 있음
                session.invalidate();
                return "redirect:/member/login";
            }

            // 크롭 페이지 접근 권한 플래그 설정 (보안용)
            session.setAttribute("myinfo_verified", true);
            
            model.addAttribute("memberDTO", memberInfo);
            return "member/myinfo";

        } catch (Exception e) {
            log.error("마이페이지 정보 조회 중 오류 발생: {}", loginMember.getUserId(), e);
            redirectAttributes.addFlashAttribute("error", "회원 정보를 불러오는 중 오류가 발생했습니다.");
            return "redirect:/"; // 오류 발생 시 홈으로 리다이렉트
        }
    }

    /**
     * 프로필 이미지 크롭 페이지
     */
    @GetMapping("/myinfo/crop-image")
    public String cropImagePage(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        
        // 마이페이지에서 온 사용자인지 확인 (보안)
        Boolean myinfoVerified = (Boolean) session.getAttribute("myinfo_verified");
        if (myinfoVerified == null || !myinfoVerified) {
            redirectAttributes.addFlashAttribute("error", "올바른 경로로 접근해주세요.");
            return "redirect:/member/myinfo";
        }
        
        model.addAttribute("memberDTO", loginMember);
        return "member/crop-image";
    }

    /**
     * 프로필 이미지 크롭 처리 (임시 저장)
     */
    @PostMapping("/myinfo/crop-image/upload")
    @ResponseBody
    public Map<String, Object> uploadTempImage(@RequestParam("imageFile") MultipartFile imageFile,
                                               HttpSession session) {
        Map<String, Object> result = new HashMap<>();
        
        try {
            MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (loginMember == null) {
                result.put("success", false);
                result.put("message", "로그인이 필요합니다.");
                return result;
            }
            
            if (imageFile.isEmpty()) {
                result.put("success", false);
                result.put("message", "이미지 파일이 없습니다.");
                return result;
            }
            
            // 파일 크기 검증 (5MB)
            if (imageFile.getSize() > 5 * 1024 * 1024) {
                result.put("success", false);
                result.put("message", "파일 크기는 5MB 이하여야 합니다.");
                return result;
            }
            
            // 파일 타입 검증
            String contentType = imageFile.getContentType();
            if (contentType == null || !contentType.startsWith("image/")) {
                result.put("success", false);
                result.put("message", "이미지 파일만 업로드 가능합니다.");
                return result;
            }
            
            // Base64로 인코딩하여 임시 저장
            byte[] imageBytes = imageFile.getBytes();
            String base64Image = "data:" + contentType + ";base64," + 
                                java.util.Base64.getEncoder().encodeToString(imageBytes);
            
            // 세션에 임시 저장
            session.setAttribute("tempImageData", base64Image);
            session.setAttribute("tempImageName", imageFile.getOriginalFilename());
            
            result.put("success", true);
            result.put("imageData", base64Image);
            result.put("message", "이미지가 업로드되었습니다.");
            
        } catch (Exception e) {
            log.error("임시 이미지 업로드 중 오류 발생", e);
            result.put("success", false);
            result.put("message", "이미지 업로드 중 오류가 발생했습니다.");
        }
        
        return result;
    }

    /**
     * 크롭된 이미지 저장 처리
     */
    @PostMapping("/myinfo/crop-image/save")
    @ResponseBody
    public Map<String, Object> saveCroppedImage(@RequestParam("croppedImage") MultipartFile croppedImageFile,
                                                @RequestParam(value = "altText", required = false) String altText,
                                                @RequestParam(value = "format", required = false) String format,
                                                @RequestParam(value = "quality", required = false) String quality,
                                                HttpSession session) {
        Map<String, Object> result = new HashMap<>();
        
        try {
            MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
            if (loginMember == null) {
                result.put("success", false);
                result.put("message", "로그인이 필요합니다.");
                return result;
            }
            
            log.info("🖼️ 크롭된 이미지 저장 요청 - 형식: {}, 품질: {}, 크기: {} bytes", 
                    format, quality, croppedImageFile.getSize());
            log.info("📁 파일 정보 - 이름: {}, 컨텐츠 타입: {}", 
                    croppedImageFile.getOriginalFilename(), croppedImageFile.getContentType());
            
            // 업로드된 파일이 유효한지 확인
            if (croppedImageFile.isEmpty()) {
                result.put("success", false);
                result.put("message", "업로드된 이미지 파일이 비어있습니다.");
                return result;
            }
            
            // 기존 회원정보 조회
            MemberDTO memberDTO = memberService.findById(loginMember.getMemberId());
            if (memberDTO == null) {
                result.put("success", false);
                result.put("message", "회원 정보를 찾을 수 없습니다.");
                return result;
            }
            
            // Alt 텍스트 설정 (SEO 최적화용)
            log.info("📋 받은 파라미터 - altText: '{}', format: '{}', quality: '{}'", altText, format, quality);
            if (altText != null && !altText.trim().isEmpty()) {
                memberDTO.setProfileImageAltText(altText.trim());
                log.info("🏷️ 프로필 이미지 Alt 텍스트 설정: {}", altText.trim());
            } else {
                // 기본값 설정
                memberDTO.setProfileImageAltText("사용자 프로필 사진");
                log.info("🏷️ 프로필 이미지 Alt 텍스트 기본값 설정: 사용자 프로필 사진");
            }
            
            // 이미지 형식 정보 로깅
            String contentType = croppedImageFile.getContentType();
            if (contentType != null) {
                log.info("📷 업로드된 이미지 형식: {}", contentType);
                if (contentType.contains("avif")) {
                    log.info("✨ AVIF 형식 감지 - 최적 압축 적용됨");
                } else if (contentType.contains("webp")) {
                    log.info("🚀 WebP 형식 감지 - 효율적 압축 적용됨");
                } else if (contentType.contains("jpeg")) {
                    log.info("📸 JPEG 형식 감지 - 호환성 우선 적용됨");
                }
            }
            
            // 프로필 이미지 업데이트 (원본 형식 유지)
            memberService.updateMember(memberDTO, croppedImageFile);
            
            // 세션 정보 업데이트
            MemberDTO updatedMember = memberService.findById(loginMember.getMemberId());
            if (updatedMember != null) {
                session.setAttribute(Constants.SESSION_MEMBER, updatedMember);
            }
            
            // 임시 데이터 삭제
            session.removeAttribute("tempImageData");
            session.removeAttribute("tempImageName");
            
            result.put("success", true);
            result.put("message", "프로필 이미지가 성공적으로 저장되었습니다.");
            result.put("profileImageUrl", updatedMember.getProfileImage());
            
        } catch (Exception e) {
            log.error("크롭된 이미지 저장 중 오류 발생", e);
            result.put("success", false);
            result.put("message", "이미지 저장 중 오류가 발생했습니다.");
        }
        
        return result;
    }

    /**
     * 회원정보 수정 처리 (HttpSession 사용으로 복원)
     */
    @PostMapping("/myinfo/update")
    public String updateMember(@ModelAttribute MemberDTO memberDTO,
                               BindingResult bindingResult,
                               @RequestParam(value = "profileImageFile", required = false) MultipartFile profileImageFile,
                               HttpSession session,
                               Model model,
                               RedirectAttributes redirectAttributes) {

        log.info("회원정보 수정 요청: memberId={}, name={}, email={}", 
                memberDTO.getMemberId(), memberDTO.getName(), memberDTO.getEmail());
        
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        log.info("세션 로그인 멤버: {}", loginMember != null ? loginMember.getMemberId() : "null");
        
        if (loginMember == null) {
            log.warn("세션에 로그인 정보가 없음");
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        
        if (!loginMember.getMemberId().equals(memberDTO.getMemberId())) {
            log.warn("권한 없음: 세션 memberId={}, 요청 memberId={}", 
                    loginMember.getMemberId(), memberDTO.getMemberId());
            redirectAttributes.addFlashAttribute("error", "권한이 없거나 로그인 정보가 유효하지 않습니다.");
            return "redirect:/member/myinfo";
        }

        // 수동 유효성 검사 (정보수정에 필요한 필드만)
        if (memberDTO.getName() == null || memberDTO.getName().trim().isEmpty()) {
            bindingResult.rejectValue("name", "NotBlank", "이름은 필수입니다.");
        }
        if (memberDTO.getEmail() != null && !memberDTO.getEmail().trim().isEmpty()) {
            if (!memberDTO.getEmail().matches("^[A-Za-z0-9+_.-]+@(.+)$")) {
                bindingResult.rejectValue("email", "Email", "올바른 이메일 형식이 아닙니다.");
            }
        }
        if (memberDTO.getPhone() != null && !memberDTO.getPhone().trim().isEmpty()) {
            if (!memberDTO.getPhone().matches("^01(?:0|1|[6-9])-(?:\\d{3}|\\d{4})-\\d{4}$")) {
                bindingResult.rejectValue("phone", "Pattern", "올바른 휴대폰 번호 형식이 아닙니다.");
            }
        }
        
        if (bindingResult.hasErrors()) {
            log.warn("회원정보 수정 유효성 검사 실패: {}", bindingResult.getAllErrors());
            model.addAttribute("memberDTO", memberDTO);
            return "member/myinfo";
        }

        try {
            log.info("회원정보 수정 서비스 호출 시작");
            memberService.updateMember(memberDTO, profileImageFile);
            log.info("회원정보 수정 서비스 호출 완료");

            // 세션 정보 업데이트 (수정된 최신 정보로 갱신)
            MemberDTO updatedMember = memberService.findById(memberDTO.getMemberId());
            if (updatedMember != null) {
                session.setAttribute(Constants.SESSION_MEMBER, updatedMember);
                log.info("세션 정보 업데이트 완료: {}", updatedMember.getName());
            } else {
                log.warn("업데이트된 회원 정보 조회 실패");
            }

            redirectAttributes.addFlashAttribute("message", "회원정보가 성공적으로 수정되었습니다.");
            return "redirect:/member/myinfo/edit";

        } catch (Exception e) {
            log.error("회원정보 수정 중 오류 발생: memberId={}, userId={}", 
                    memberDTO.getMemberId(), memberDTO.getUserId(), e);
            redirectAttributes.addFlashAttribute("error", "회원정보 수정 중 오류가 발생했습니다: " + e.getMessage());
            return "redirect:/member/myinfo/edit";
        }
    }

    /**
     * 비밀번호 변경 페이지 표시 (HttpSession 사용으로 복원)
     */
    @GetMapping("/mypage/change-password")
    public String changePasswordForm(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        return "member/changePassword";
    }

    /**
     * 비밀번호 변경 처리 (HttpSession 사용으로 복원)
     */
    @PostMapping("/mypage/change-password")
    public String changePassword(@RequestParam("currentPassword") String currentPassword,
                                 @RequestParam("newPassword") String newPassword,
                                 @RequestParam("confirmPassword") String confirmNewPassword,
                                 HttpSession session,
                                 RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }

        String userId = loginMember.getUserId(); // 세션에서 userId 가져오기
        try {
            memberService.changePassword(userId, currentPassword, newPassword, confirmNewPassword);
            redirectAttributes.addFlashAttribute("message", "비밀번호가 성공적으로 변경되었습니다.");
            return "redirect:/member/myinfo/edit"; // 비밀번호 변경 후 내 정보 페이지로
        } catch (IllegalArgumentException e) {
            redirectAttributes.addFlashAttribute("error", e.getMessage());
            return "redirect:/member/mypage/change-password";
        } catch (Exception e) {
            log.error("비밀번호 변경 중 오류 발생: {}", userId, e);
            redirectAttributes.addFlashAttribute("error", "비밀번호 변경 중 오류가 발생했습니다.");
            return "redirect:/member/mypage/change-password";
        }
    }

    /**
     * 회원 탈퇴 페이지 표시
     */
    @GetMapping("/mypage/delete")
    public String deleteMemberForm(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }

        try {
            // 작성한 콘텐츠 개수 조회
            Map<String, Integer> contentCounts = memberService.getUserContentCounts(loginMember.getMemberId());
            
            model.addAttribute("member", loginMember);
            model.addAttribute("contentCounts", contentCounts);
            
            log.info("회원탈퇴 페이지 접근: userId={}, 작성 콘텐츠={}", 
                    loginMember.getUserId(), contentCounts);
                    
            return "member/deleteMember";
            
        } catch (Exception e) {
            log.error("회원탈퇴 페이지 로드 중 오류: {}", loginMember.getUserId(), e);
            model.addAttribute("member", loginMember);
            model.addAttribute("contentCounts", Map.of("board", 0, "review", 0, "job", 0));
            return "member/deleteMember";
        }
    }

    /**
     * 회원 탈퇴 처리 (논리 삭제)
     */
    @PostMapping("/mypage/delete")
    public String deleteMember(@RequestParam("password") String password,
                              @RequestParam("confirmName") String confirmName,
                              @RequestParam("deleteOption") String deleteOption,
                              HttpSession session, 
                              RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }

        String userId = loginMember.getUserId();
        log.info("회원탈퇴 요청: userId={}, 입력된 비밀번호 길이={}, 입력된 이름={}, 삭제옵션={}", 
                userId, password.length(), confirmName, deleteOption);
        
        try {
            // DB에서 최신 비밀번호 정보 조회
            MemberDTO currentMember = memberService.findById(loginMember.getMemberId());
            if (currentMember == null) {
                log.warn("회원탈퇴: 회원 정보를 찾을 수 없음: memberId={}", loginMember.getMemberId());
                redirectAttributes.addFlashAttribute("error", "회원 정보를 찾을 수 없습니다.");
                return "redirect:/member/mypage/delete";
            }
            
            // 현재 비밀번호 확인 (개발용: 평문 비교)
            log.info("비밀번호 비교: DB 비밀번호={}, 입력 비밀번호={}", 
                    currentMember.getPassword(), password);
            
            if (!password.equals(currentMember.getPassword())) {
                log.warn("회원탈퇴: 비밀번호 불일치: userId={}", userId);
                redirectAttributes.addFlashAttribute("error", "현재 비밀번호가 일치하지 않습니다.");
                return "redirect:/member/mypage/delete";
            }
            
            log.info("비밀번호 확인 성공: userId={}", userId);
            
            // 이름 확인 검증
            if (!confirmName.trim().equals(currentMember.getName().trim())) {
                log.warn("회원탈퇴: 이름 불일치: userId={}, 입력된 이름={}, 등록된 이름={}", 
                        userId, confirmName, currentMember.getName());
                redirectAttributes.addFlashAttribute("error", 
                        String.format("이름이 일치하지 않습니다. 등록된 이름 '%s'를 정확히 입력해주세요.", currentMember.getName()));
                return "redirect:/member/mypage/delete";
            }
            
            log.info("이름 확인 성공: userId={}, 이름={}", userId, confirmName);
            
            // 회원 탈퇴 처리 (옵션에 따라 처리 방식 결정)
            String resultMessage = memberService.deleteMemberWithOption(userId, deleteOption);
            log.info("회원탈퇴 완료: userId={}, 옵션={}", userId, deleteOption);
            
            // 세션 무효화
            session.invalidate();
            
            redirectAttributes.addFlashAttribute("message", resultMessage + " 그동안 이용해 주셔서 감사합니다.");
            return "redirect:/";
        } catch (Exception e) {
            log.error("회원 탈퇴 처리 중 오류 발생: {}", userId, e);
            redirectAttributes.addFlashAttribute("error", "회원 탈퇴 처리 중 오류가 발생했습니다.");
            return "redirect:/member/mypage/delete";
        }
    }

    /**
     * 관리자: 회원 목록 조회 (페이징, 역할 필터링 등)
     */
    @GetMapping("/admin/members")
    public String listMembers(@RequestParam(defaultValue = "1") int page,
                              @RequestParam(defaultValue = "10") int pageSize,
                              @RequestParam(required = false) String role,
                              Model model, HttpSession session, RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);

        // 관리자 권한 확인 (역할이 ADMIN이 아니면 접근 불허)
        if (loginMember == null || !Constants.MEMBER_ROLE_ADMIN.equals(loginMember.getRole())) {
            redirectAttributes.addFlashAttribute("error", "관리자 권한이 필요합니다.");
            return "redirect:/"; // 홈으로 리다이렉트 또는 다른 에러 페이지
        }

        try {
            MemberDTO searchDTO = new MemberDTO();
            searchDTO.setPageSize(pageSize);
            searchDTO.setOffset((page - 1) * pageSize);
            searchDTO.setRole(role); // 역할 필터링을 위해 DTO에 role 설정

            List<MemberDTO> members = memberService.getMembersWithPaging(searchDTO);
            int totalMembers = memberService.getTotalMembersCount(); // 전체 회원 수

            int totalPages = (int) Math.ceil((double) totalMembers / pageSize);

            model.addAttribute("members", members);
            model.addAttribute("currentPage", page);
            model.addAttribute("totalPages", totalPages);
            model.addAttribute("pageSize", pageSize);
            model.addAttribute("currentRole", role); // 현재 필터링된 역할

            return "member/memberList"; // 관리자 회원 목록을 보여주는 Thymeleaf 템플릿
        } catch (Exception e) {
            log.error("관리자 회원 목록 조회 중 오류 발생", e);
            redirectAttributes.addFlashAttribute("error", "회원 목록 조회 중 오류가 발생했습니다.");
            return "redirect:/";
        }
    }

    /**
     * 관리자: 회원 상태 변경 (활성화/비활성화)
     */
    @PostMapping("/admin/members/status")
    public String updateMemberStatus(@RequestParam Long memberId,
                                     @RequestParam boolean isActive,
                                     HttpSession session, RedirectAttributes redirectAttributes) {
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);

        // 관리자 권한 확인
        if (loginMember == null || !Constants.MEMBER_ROLE_ADMIN.equals(loginMember.getRole())) {
            redirectAttributes.addFlashAttribute("error", "관리자 권한이 없습니다.");
            return "redirect:/member/admin/members";
        }

        try {
            memberService.updateMemberStatus(memberId, isActive);
            redirectAttributes.addFlashAttribute("message", "회원 상태가 성공적으로 변경되었습니다.");
        } catch (Exception e) {
            log.error("회원 상태 변경 중 오류 발생: memberId={}", memberId, e);
            redirectAttributes.addFlashAttribute("error", "회원 상태 변경 중 오류가 발생했습니다.");
        }
        return "redirect:/member/admin/members"; // 변경 후 회원 목록 페이지로 리다이렉트
    }
    
    /**
     * 내가 쓴 글 페이지 표시
     */
    @GetMapping("/mypost")
    public String myPosts(@RequestParam(defaultValue = "all") String type,
                         @RequestParam(defaultValue = "1") int page,
                         @RequestParam(defaultValue = "10") int pageSize,
                         HttpSession session, Model model, RedirectAttributes redirectAttributes) {
        
        MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
        if (loginMember == null) {
            redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
            return "redirect:/member/login";
        }
        
        try {
            Long memberId = loginMember.getMemberId();
            log.info("내가 쓴 글 페이지 요청: memberId={}, type={}, page={}", memberId, type, page);
            
            // 페이징 설정
            int offset = (page - 1) * pageSize;
            
            // 작성한 콘텐츠 조회
            Map<String, Object> result = memberService.getMyPosts(memberId, type, page, pageSize, offset);
            
            // 모델에 데이터 추가
            model.addAttribute("member", loginMember);
            model.addAttribute("posts", result.get("posts"));
            model.addAttribute("totalCount", result.get("totalCount"));
            model.addAttribute("currentType", type);
            model.addAttribute("currentPage", page);
            model.addAttribute("pageSize", pageSize);
            model.addAttribute("totalPages", (int) Math.ceil((double) (Integer) result.get("totalCount") / pageSize));
            
            // 콘텐츠 타입별 개수
            Map<String, Integer> contentCounts = (Map<String, Integer>) result.get("contentCounts");
            model.addAttribute("contentCounts", contentCounts);
            
            log.info("내가 쓴 글 조회 완료: 총 {}개", result.get("totalCount"));
            
            return "member/myPosts";
            
        } catch (Exception e) {
            log.error("내가 쓴 글 페이지 로드 중 오류: memberId={}", loginMember.getMemberId(), e);
            redirectAttributes.addFlashAttribute("error", "내가 쓴 글을 불러오는 중 오류가 발생했습니다.");
            return "redirect:/member/myinfo/edit";
        }
    }
}
````

## File: src/main/resources/templates/facility/detail.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>시설 상세보기</title>
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<div class="container mt-4">
    <!-- 브레드크럼 -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">홈</a></li>
            <li class="breadcrumb-item"><a href="/facility/search">시설 찾기</a></li>
            <li class="breadcrumb-item active" aria-current="page">시설 상세</li>
        </ol>
    </nav>
    <!-- 4:6 비율로 배치 -->
    <div class="row">
        <!-- 왼쪽 40%: 시설 기본정보 + 시설정보, 시설현황, 연락처정보, 관련서비스 -->
        <div class="col-md-5">
            <!-- 시설 기본정보 -->
            <div class="card mb-3 shadow-sm" style="min-height: 500px;">
                <div class="card-header bg-light">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-building text-primary me-2"></i>
                        <h5 class="mb-0">시설 기본정보</h5>
                    </div>
                </div>
                <div class="card-body d-flex flex-column">
                    <!-- 세로 배치: 이미지 → 내용 → 버튼 -->
                    
                    <!-- 1. 시설 이미지 -->
                    <div class="text-center mb-4 flex-grow-1" id="facilityImageContainer">
                        <div th:if="${facility.facilityImage != null and !#strings.isEmpty(facility.facilityImage)}">
                            <img th:src="${facility.facilityImage}"
                                 class="img-fluid rounded shadow-sm facility-detail-image"
                                 style="height: 250px; width: 100%; object-fit: cover;"
                                 alt="시설 이미지"
                                 onerror="handleFacilityImageError(this)">
                        </div>
                        <div th:unless="${facility.facilityImage != null and !#strings.isEmpty(facility.facilityImage)}"
                             class="bg-light rounded d-flex align-items-center justify-content-center"
                             style="height: 250px; background-color: #f8f9fa;">
                            <div class="text-center text-muted">
                                <i class="fas fa-image fa-3x mb-2"></i>
                                <br>
                                <small>시설 이미지 준비 중</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 2. 시설명, 등급, 별점 -->
                    <div class="text-center mb-4">
                        <h4 class="mb-3" th:text="${facility.facilityName}">시설명</h4>
                        <div class="d-flex flex-wrap gap-2 justify-content-center mb-3">
                            <span class="badge bg-primary fs-6" th:text="${facility.facilityType}">시설유형</span>
                            <span th:if="${facility.gradeRating != null and facility.gradeRating > 0}" 
                                  class="badge fs-6 grade-badge"
                                  th:data-grade="${facility.gradeRating}"
                                  th:text="${facility.gradeRating} + '등급'">1등급</span>
                            <span th:unless="${facility.gradeRating != null and facility.gradeRating > 0}" 
                                  class="badge bg-secondary fs-6">등급 정보 없음</span>
                        </div>
                        <div th:if="${facility.averageRating != null and facility.averageRating > 0}">
                            <span class="badge bg-warning text-dark fs-6">
                                <i class="fas fa-star"></i> <span th:text="${#numbers.formatDecimal(facility.averageRating, 1, 1)}">0.0</span>
                            </span>
                        </div>
                    </div>
                    
                    <!-- 3. 버튼 -->
                    <div class="mt-auto">
                        <!-- 관리자 또는 시설 소유자인 경우 관리 버튼 표시 -->
                        <div th:if="${isAdmin or isOwner}" class="mb-3">
                            <div class="row g-2">
                                <div class="col-6">
                                    <a th:href="@{/facility/edit/{id}(id=${facility.facilityId})}" 
                                       class="btn btn-warning w-100 btn-sm">
                                        <i class="fas fa-edit"></i><br><small>시설수정</small>
                                    </a>
                                </div>
                                <div class="col-6">
                                    <button class="btn btn-danger w-100 btn-sm" 
                                            th:onclick="'deleteFacility(' + ${facility.facilityId} + ')'">
                                        <i class="fas fa-trash"></i><br><small>시설삭제</small>
                                    </button>
                                </div>
                            </div>
                            <hr class="my-3">
                        </div>
                        
                        <!-- 일반 사용자 버튼 -->
                        <div class="row g-2">
                            <div class="col-6">
                                <button class="btn btn-primary w-100 btn-sm" th:data-phone="${facility.phone}" onclick="callFacilityPhone(this)">
                                    <i class="fas fa-phone"></i><br><small>전화상담</small>
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-success w-100 btn-sm" onclick="writeReview()">
                                    <i class="fas fa-star"></i><br><small>리뷰작성</small>
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-secondary w-100 btn-sm" onclick="shareToKakao()">
                                    <i class="fas fa-share"></i><br><small>공유</small>
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-primary w-100 btn-sm" onclick="searchNearbyJobs()">
                                    <i class="fas fa-briefcase"></i><br><small>주변채용</small>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 시설정보 -->
            <div class="card mb-3 shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-info-circle text-primary me-2"></i>시설정보</h6>
                </div>
                <div class="card-body">
                    <div class="row small">
                        <div class="col-12">
                            <div class="info-item mb-2">
                                <i class="fas fa-map-marker-alt text-danger me-2"></i>
                                <span th:text="${facility.address}">주소</span>
                            </div>
                            <div class="info-item mb-2">
                                <i class="fas fa-phone text-success me-2"></i>
                                <span th:text="${facility.phone}">전화번호</span>
                            </div>
                            <div class="info-item mb-2">
                                <i class="fas fa-user-tie text-primary me-2"></i>
                                원장: <span th:text="${facility.registeredMemberName}">원장명</span>
                            </div>
                            <div class="info-item mb-2">
                                <i class="fas fa-bed text-warning me-2"></i>
                                정원: <span th:text="${facility.capacity}">정원</span>명
                                <span th:if="${facility.currentOccupancy != null}" class="text-muted">
                                    (현재: <span th:text="${facility.currentOccupancy}">0</span>명)
                                </span>
                            </div>
                            <div class="info-item mb-2" th:if="${facility.homepage}">
                                <i class="fas fa-globe text-info me-2"></i>
                                <a th:href="${facility.homepage}" target="_blank" class="text-decoration-none">홈페이지</a>
                            </div>
                        </div>
                    </div>
                    <div th:if="${facility.description}" class="mt-3 pt-2 border-top">
                        <div class="small mb-0 rich-text-content" style="line-height: 1.4;" th:utext="${facility.description}">시설 소개</div>
                    </div>
                    <div th:if="${facility.features}" class="mt-2">
                        <div class="features-list">
                            <span th:each="feature : ${#strings.arraySplit(facility.features, ',')}" 
                                  class="badge bg-light text-dark me-1 mb-1" th:text="${feature}">특징</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 시설현황 -->
            <div class="card mb-3 shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-chart-bar text-primary me-2"></i>시설현황</h6>
                </div>
                <div class="card-body">
                    <div class="row text-center g-2">
                        <div class="col-6">
                            <div class="p-2 bg-light rounded">
                                <h5 th:if="${facility.gradeRating != null and facility.gradeRating > 0}"
                                    th:text="${facility.gradeRating} + '등급'"
                                    class="grade-rating mb-1"
                                    th:data-grade="${facility.gradeRating}">1등급</h5>
                                <h5 th:unless="${facility.gradeRating != null and facility.gradeRating > 0}" class="text-muted mb-1">-</h5>
                                <small class="text-muted">시설등급</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-2 bg-light rounded">
                                <h5 class="mb-1" th:text="${facility.capacity ?: '-'}">-</h5>
                                <small class="text-muted">정원</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-2 bg-light rounded">
                                <h5 class="mb-1" th:text="${facility.currentOccupancy ?: '0'}">0</h5>
                                <small class="text-muted">현재입소</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-2 bg-light rounded">
                                <h5 th:if="${facility.averageRating != null and facility.averageRating > 0}"
                                    th:text="${#numbers.formatDecimal(facility.averageRating, 1, 1)}"
                                    class="text-warning mb-1">4.5</h5>
                                <h5 th:unless="${facility.averageRating != null and facility.averageRating > 0}" class="text-muted mb-1">0.0</h5>
                                <small class="text-muted">평균평점</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <!-- 오른쪽 60%: 지도와 리뷰 -->
        <div class="col-md-7">
            <!-- 위치 및 교통정보 -->
            <div class="card mb-3 shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-map-marker-alt text-danger me-2"></i>위치 및 교통정보</h5>
                </div>
                <div class="card-body p-0">
                    <div id="facilityMap" style="width:100%; height:400px;">
                        <div class="d-flex align-items-center justify-content-center h-100 text-muted">
                            <div class="text-center">
                                <i class="fas fa-map fa-3x mb-3 text-primary"></i>
                                <p class="fs-6">지도를 불러오는 중...</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-3 bg-light border-top">
                        <div class="d-flex align-items-center mb-1">
                            <i class="fas fa-map-marker-alt text-danger me-2"></i>
                            <strong th:text="${facility.address}">주소가 여기에 표시됩니다</strong>
                        </div>
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            지도를 클릭하거나 확대/축소하여 더 자세한 위치를 확인할 수 있습니다
                        </small>
                    </div>
                </div>
            </div>

            <!-- 시설리뷰 -->
            <div class="card shadow-sm">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-comments text-primary me-2"></i>시설리뷰 
                        <span class="badge bg-primary ms-2" th:text="${reviewCount}">0</span>
                    </h5>
                    <button class="btn btn-sm btn-primary" onclick="writeReview()">
                        <i class="fas fa-plus me-1"></i>리뷰 작성
                    </button>
                </div>
                <div class="card-body">
                    <div id="reviewList">
                        <!-- 리뷰가 있는 경우 -->
                        <div th:if="${not #lists.isEmpty(recentReviews)}">
                            <div th:each="review : ${recentReviews}" class="review-item border-bottom pb-3 mb-3">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1" th:text="${review.title}">리뷰 제목</h6>
                                        <div class="mb-2">
                                            <span class="text-warning">
                                                <i th:each="i : ${#numbers.sequence(1, 5)}" 
                                                   th:class="${i <= review.rating} ? 'fas fa-star' : 'far fa-star'"></i>
                                            </span>
                                            <span class="ms-2 fw-bold" th:text="${review.rating} + '.0'">5.0</span>
                                        </div>
                                        <p class="text-muted small mb-2 rich-text-content" th:utext="${#strings.abbreviate(review.content, 100)}">리뷰 내용 미리보기</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">
                                                <i class="fas fa-user me-1"></i>
                                                <span th:text="${review.memberName}">작성자</span>
                                                <span class="mx-2">|</span>
                                                <i class="fas fa-calendar me-1"></i>
                                                <span th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd')}">작성일</span>
                                            </small>
                                            <a th:href="@{/review/detail/{id}(id=${review.reviewId})}" class="btn btn-sm btn-outline-secondary">
                                                <i class="fas fa-eye me-1"></i>상세보기
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center mt-3">
                                <a th:href="@{/review(facilityId=${facility.facilityId})}" class="btn btn-outline-primary me-2">
                                    <i class="fas fa-list me-1"></i>전체 리뷰 보기
                                </a>
                                <!-- 시설 소유자만 관리 버튼 표시 -->
                                <a th:if="${session.loginMember != null and session.loginMember.memberId == facility.registeredMemberId}" 
                                   th:href="@{/facility/manage}" class="btn btn-success">
                                    <i class="fas fa-cogs me-1"></i>시설 관리
                                </a>
                            </div>
                        </div>
                        
                        <!-- 리뷰가 없는 경우 -->
                        <div th:if="${#lists.isEmpty(recentReviews)}" class="text-center text-muted py-4">
                            <i class="fas fa-comments fa-2x mb-2"></i>
                            <p>아직 리뷰가 없습니다.</p>
                            <p class="small">첫 번째 리뷰를 작성해보세요!</p>
                            <!-- 시설 소유자만 관리 버튼 표시 -->
                            <div th:if="${session.loginMember != null and session.loginMember.memberId == facility.registeredMemberId}" class="mt-3">
                                <a th:href="@{/facility/manage}" class="btn btn-success">
                                    <i class="fas fa-cogs me-1"></i>시설 관리
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{layout/footer :: footer}"></div>
<div th:replace="~{layout/footer :: scripts}"></div>

<!-- 카카오맵 JavaScript 파일 -->
<script src="/js/kakaomap.js"></script>

<!-- 카카오맵 API -->
<script type="text/javascript" th:src="@{//dapi.kakao.com/v2/maps/sdk.js(appkey=${KAKAO_APP_KEY}, libraries='services,clusterer,drawing')}"></script>

<script th:inline="javascript">
    /*<![CDATA[*/
    // 시설 정보를 JavaScript 변수로 선언
    const facilityData = {
        name: /*[[${facility.facilityName}]]*/ '',
        latitude: /*[[${facility.latitude}]]*/ 0,
        longitude: /*[[${facility.longitude}]]*/ 0,
        address: /*[[${facility.address}]]*/ '',
        phone: /*[[${facility.phone}]]*/ ''
    };

    $(document).ready(function() {
        // 시설 등급 색상 적용
        $('.grade-badge').each(function() {
            const grade = parseInt($(this).data('grade'));
            switch(grade) {
                case 1:
                    $(this).addClass('bg-success');
                    break;
                case 2:
                    $(this).addClass('bg-info');
                    break;
                case 3:
                    $(this).addClass('bg-warning');
                    break;
                case 4:
                    $(this).addClass('bg-secondary');
                    break;
                case 5:
                    $(this).addClass('bg-danger');
                    break;
                default:
                    $(this).addClass('bg-secondary');
            }
        });
        
        $('.grade-rating').each(function() {
            const grade = parseInt($(this).data('grade'));
            switch(grade) {
                case 1:
                    $(this).addClass('text-success');
                    break;
                case 2:
                    $(this).addClass('text-info');
                    break;
                case 3:
                    $(this).addClass('text-warning');
                    break;
                case 4:
                    $(this).addClass('text-secondary');
                    break;
                case 5:
                    $(this).addClass('text-danger');
                    break;
                default:
                    $(this).addClass('text-muted');
            }
        });
        
        // 카카오맵 초기화 대기
        setTimeout(function() {
            if (typeof kakao !== 'undefined') {
                initKakaoMap('facilityMap');
                
                // 시설 위치에 마커 추가
                if (facilityData.latitude && facilityData.longitude) {
                    const infoContent = `
                        <div class="p-2" style="width:250px;">
                            <h6 class="mb-1">${facilityData.name}</h6>
                            <p class="mb-1 small">${facilityData.address}</p>
                            <p class="mb-0 small">
                                <i class="fas fa-phone me-1"></i>${facilityData.phone}
                            </p>
                        </div>
                    `;
                    
                    addMarker(
                        facilityData.latitude,
                        facilityData.longitude,
                        facilityData.name,
                        infoContent
                    );
                }
            } else {
                console.error('카카오맵 SDK 로드 실패');
            }
        }, 100); // 100ms 후 실행
    });

    // 시설 이미지 에러 처리 함수
    function handleFacilityImageError(imgElement) {
        console.warn('⚠️ 시설 이미지 로드 실패:', imgElement.src);
        
        // 이미 에러 처리되었는지 확인
        if (imgElement.classList.contains('error-handled')) {
            console.log('이미 에러 처리된 이미지입니다.');
            return;
        }
        
        // 에러 처리 완료 표시
        imgElement.classList.add('error-handled');
        
        // 플레이스홀더로 교체
        imgElement.style.display = 'none';
        
        const placeholder = document.createElement('div');
        placeholder.className = 'bg-light rounded d-flex align-items-center justify-content-center';
        placeholder.style.cssText = 'height: 250px; background-color: #f8f9fa;';
        placeholder.innerHTML = `
            <div class="text-center text-muted">
                <i class="fas fa-image fa-3x mb-2"></i>
                <br>
                <small>시설 이미지 준비 중</small>
            </div>
        `;
        
        imgElement.parentNode.insertBefore(placeholder, imgElement);
        console.log('✅ 시설 이미지 플레이스홀더 처리 완료');
    }

    // 전화하기 버튼 클릭 이벤트 핸들러
    function callFacilityPhone(button) {
        const phone = button.getAttribute('data-phone');
        if (phone) {
            window.location.href = `tel:${phone}`;
        }
    }

    // 리뷰 작성 페이지로 이동
    function writeReview() {
        window.location.href = `/review/write?facilityId=[[${facility.facilityId}]]`;
    }


    // 주변 구인정보 검색
    function searchNearbyJobs() {
        const latitude = /*[[${facility.latitude}]]*/ 0;
        const longitude = /*[[${facility.longitude}]]*/ 0;
        window.location.href = `/job/list?lat=${latitude}&lng=${longitude}&radius=5`;
    }

    // 카카오톡 공유하기
    function shareToKakao() {
        const facilityId = /*[[${facility.facilityId}]]*/ 0;
        const facilityName = /*[[${facility.facilityName}]]*/ '시설명';
        const address = /*[[${facility.address}]]*/ '주소';
        const logoImageUrl = /*[[${facility.facilityImage ?: 'https://via.placeholder.com/300x200?text=시설이미지'}]]*/ 'https://via.placeholder.com/300x200?text=시설이미지';

        if (window.Kakao) {
            Kakao.Link.sendDefault({
                objectType: 'location',
                address: address,
                addressTitle: facilityName,
                content: {
                    title: facilityName,
                    description: `${address}\n상세 정보 보기`,
                    imageUrl: logoImageUrl,
                    link: {
                        mobileWebUrl: window.location.href,
                        webUrl: window.location.href
                    }
                },
                buttons: [
                    {
                        title: '상세 정보 보기',
                        link: {
                            mobileWebUrl: window.location.href,
                            webUrl: window.location.href
                        }
                    }
                ]
            });
        } else {
            alert('카카오톡 공유하기를 사용할 수 없습니다.');
        }
    }

    // 시설 삭제 함수
    function deleteFacility(facilityId) {
        if (confirm('정말로 이 시설을 삭제하시겠습니까?\n삭제된 시설은 복구할 수 없습니다.')) {
            // AJAX로 삭제 요청
            fetch('/facility/delete/' + facilityId, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => {
                if (response.ok) {
                    alert('시설이 삭제되었습니다.');
                    window.location.href = '/facility/search';
                } else {
                    alert('시설 삭제 중 오류가 발생했습니다.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('시설 삭제 중 오류가 발생했습니다.');
            });
        }
    }
    /*]]>*/
</script>

<script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>
<script>
    // 새로운 App Key로 카카오톡 SDK 초기화
    Kakao.init(/*[[${KAKAO_APP_KEY}]]*/);
</script>
</body>
</html>
````

## File: src/main/resources/schema.sql
````sql
-- ================================================
-- 요양원 구인구직 사이트 데이터베이스 스키마
-- 4인 팀 프로젝트 전용 (개선 반영 버전)
-- ================================================

-- 데이터베이스 생성 (필요 시)
CREATE DATABASE carelink DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE carelink;

-- ================================================
-- 1. 회원 테이블 (팀원 A 담당)
-- ================================================
CREATE TABLE member (
    member_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '회원 ID',
    user_id VARCHAR(20) NOT NULL UNIQUE COMMENT '사용자 ID (로그인용)',
    password VARCHAR(255) NOT NULL COMMENT '비밀번호',
    name VARCHAR(50) NOT NULL COMMENT '이름',
    email VARCHAR(100) NOT NULL UNIQUE COMMENT '이메일',
    phone VARCHAR(20) COMMENT '휴대폰 번호',
    role VARCHAR(20) NOT NULL DEFAULT 'USER' COMMENT '역할 (USER, FACILITY, ADMIN)',
    address TEXT COMMENT '주소',
    detail_address TEXT COMMENT '상세 주소',
    profile_image VARCHAR(255) COMMENT '프로필 이미지 경로',
    profile_image_alt_text VARCHAR(255) COMMENT '프로필 이미지 alt 텍스트 (SEO 최적화용)',
    is_active BOOLEAN NOT NULL DEFAULT TRUE COMMENT '계정 활성화 여부',
    login_fail_count INT NOT NULL DEFAULT 0 COMMENT '로그인 실패 횟수',
    last_login_at DATETIME COMMENT '마지막 로그인 시간',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성일시',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일시',
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE COMMENT '삭제 여부'
) COMMENT='회원 정보';

-- ================================================
-- 2. 시설 테이블 (팀원 B 담당)
-- ================================================
CREATE TABLE facility (
    facility_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '시설 ID',
    facility_name VARCHAR(100) NOT NULL COMMENT '시설명',
    facility_type VARCHAR(20) NOT NULL COMMENT '시설 유형 (NURSING_HOME, HOSPITAL, DAY_CARE)',
    address TEXT NOT NULL COMMENT '주소',
    detail_address TEXT COMMENT '상세 주소',
    phone VARCHAR(20) NOT NULL COMMENT '전화번호',
    latitude DECIMAL(10, 8) COMMENT '위도',
    longitude DECIMAL(11, 8) COMMENT '경도',
    description TEXT COMMENT '시설 설명',
    facility_image VARCHAR(255) COMMENT '시설 메인 이미지 경로 (레거시 호환성용)',
    facility_image_alt_text VARCHAR(255) COMMENT '시설 이미지 alt 텍스트 (SEO 최적화용)',
    homepage VARCHAR(255) COMMENT '홈페이지 URL',
    capacity INT COMMENT '수용 인원',
    current_occupancy INT COMMENT '현재 입소자 수',
    operating_hours VARCHAR(100) COMMENT '운영 시간',
    features TEXT COMMENT '시설 특징',
    average_rating FLOAT DEFAULT 0 COMMENT '평균 평점',
    review_count INT DEFAULT 0 COMMENT '리뷰 수',
    grade_rating INT COMMENT '시설 등급 (1-5등급, 1등급이 최고)',
    image_count INT DEFAULT 0 COMMENT '시설 이미지 개수 (facility_images 테이블 기준)',
    main_image_path VARCHAR(500) COMMENT '메인 이미지 경로 (다중 이미지 시스템)',
    registered_member_id BIGINT NOT NULL COMMENT '등록한 회원 ID',
    is_approved BOOLEAN NOT NULL DEFAULT FALSE COMMENT '승인 여부',
    approval_status VARCHAR(20) NOT NULL DEFAULT 'PENDING' COMMENT '승인 상태 (PENDING, APPROVED, REJECTED)',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성일시',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일시',
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE COMMENT '삭제 여부',
    FOREIGN KEY (registered_member_id) REFERENCES member(member_id)
) COMMENT='시설 정보';

-- ================================================
-- 3. 시설 이미지 테이블 (다중 이미지 지원 - 최대 5장)
-- ================================================
CREATE TABLE facility_images (
    image_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '이미지 ID',
    facility_id BIGINT NOT NULL COMMENT '시설 ID',
    image_path VARCHAR(500) NOT NULL COMMENT '이미지 경로',
    image_alt_text VARCHAR(200) COMMENT '이미지 alt 텍스트 (SEO 최적화용)',
    image_order INT DEFAULT 0 COMMENT '이미지 순서 (0부터 시작)',
    is_main_image BOOLEAN DEFAULT FALSE COMMENT '메인 이미지 여부',
    upload_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '업로드일시',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일시',
    FOREIGN KEY (facility_id) REFERENCES facility(facility_id) ON DELETE CASCADE,
    INDEX idx_facility_images_facility_id (facility_id),
    INDEX idx_facility_images_main (facility_id, is_main_image),
    INDEX idx_facility_images_order (facility_id, image_order)
) COMMENT='시설 이미지 (최대 5장 지원)';

-- ================================================
-- 4. 구인구직 게시글 테이블 (팀원 C 담당)
-- ================================================
CREATE TABLE job_posting (
    job_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '구인구직 ID',
    title VARCHAR(200) NOT NULL COMMENT '제목',
    content TEXT NOT NULL COMMENT '내용',
    job_type VARCHAR(20) NOT NULL COMMENT '구인구직 유형 (RECRUIT: 구인, SEARCH: 구직)',
    work_type VARCHAR(20) NOT NULL COMMENT '근무 형태 (FULL_TIME, PART_TIME, TEMPORARY)',
    position VARCHAR(50) COMMENT '모집 직종',
    recruit_count INT COMMENT '모집 인원',
    salary_type VARCHAR(20) COMMENT '급여 유형 (HOURLY, MONTHLY, ANNUAL)',
    salary_min DECIMAL(10, 0) COMMENT '최소 급여',
    salary_max DECIMAL(10, 0) COMMENT '최대 급여',
    salary_description TEXT COMMENT '급여 설명',
    work_location VARCHAR(100) COMMENT '근무 지역',
    work_hours VARCHAR(100) COMMENT '근무 시간',
    experience VARCHAR(50) COMMENT '경력 조건',
    education VARCHAR(50) COMMENT '학력 조건',
    qualifications TEXT COMMENT '자격 요건',
    benefits TEXT COMMENT '복리후생',
    start_date DATE COMMENT '모집 시작일',
    end_date DATE COMMENT '모집 마감일',
    contact_name VARCHAR(50) COMMENT '담당자 이름',
    contact_phone VARCHAR(20) COMMENT '담당자 연락처',
    contact_email VARCHAR(100) COMMENT '담당자 이메일',
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE' COMMENT '게시글 상태 (ACTIVE, CLOSED, DRAFT)',
    view_count INT NOT NULL DEFAULT 0 COMMENT '조회수',
    apply_count INT NOT NULL DEFAULT 0 COMMENT '지원자 수',
    member_id BIGINT NOT NULL COMMENT '작성자 ID',
    facility_id BIGINT COMMENT '관련 시설 ID',
    attachment_path VARCHAR(255) COMMENT '첨부파일 경로',
    attachment_name VARCHAR(255) COMMENT '첨부파일 원본명',
    priority INT NOT NULL DEFAULT 0 COMMENT '우선순위',
    is_highlight BOOLEAN NOT NULL DEFAULT FALSE COMMENT '강조 표시 여부',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성일시',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일시',
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE COMMENT '삭제 여부',
    FOREIGN KEY (member_id) REFERENCES member(member_id),
    FOREIGN KEY (facility_id) REFERENCES facility(facility_id)
) COMMENT='구인구직 게시글';

-- ================================================
-- 5. 시설 리뷰 테이블 (팀원 D 담당)
-- ================================================
CREATE TABLE review (
    review_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '리뷰 ID',
    facility_id BIGINT NOT NULL COMMENT '시설 ID',
    member_id BIGINT NOT NULL COMMENT '작성자 ID',
    title VARCHAR(200) NOT NULL COMMENT '리뷰 제목',
    content TEXT NOT NULL COMMENT '리뷰 내용',
    rating INT NOT NULL COMMENT '평점 (1-5점)',
    service_rating INT COMMENT '서비스 평점',
    facility_rating INT COMMENT '시설 평점',
    staff_rating INT COMMENT '직원 평점',
    price_rating INT COMMENT '가격 평점',
    review_image1 VARCHAR(255) COMMENT '리뷰 이미지 1',
    review_image2 VARCHAR(255) COMMENT '리뷰 이미지 2',
    review_image3 VARCHAR(255) COMMENT '리뷰 이미지 3',
    like_count INT NOT NULL DEFAULT 0 COMMENT '추천 수',
    dislike_count INT NOT NULL DEFAULT 0 COMMENT '비추천 수',
    view_count INT NOT NULL DEFAULT 0 COMMENT '조회수',
    is_visible BOOLEAN NOT NULL DEFAULT TRUE COMMENT '표시 여부',
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE' COMMENT '상태 (ACTIVE, HIDDEN, REPORTED)',
    parent_review_id BIGINT COMMENT '부모 리뷰 ID (답글인 경우)',
    reply_count INT NOT NULL DEFAULT 0 COMMENT '답글 수',
    reply_depth INT NOT NULL DEFAULT 0 COMMENT '답글 깊이',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성일시',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일시',
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE COMMENT '삭제 여부',
    FOREIGN KEY (facility_id) REFERENCES facility(facility_id),
    FOREIGN KEY (member_id) REFERENCES member(member_id),
    FOREIGN KEY (parent_review_id) REFERENCES review(review_id)
) COMMENT='시설 리뷰';

-- ================================================
-- 6. 정보 게시판 테이블 (팀원 D 담당)
-- ================================================
CREATE TABLE board (
    board_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '게시글 ID',
    board_type VARCHAR(20) NOT NULL COMMENT '게시판 유형 (NOTICE, INFO, QNA, FAQ)',
    title VARCHAR(200) NOT NULL COMMENT '제목',
    content TEXT NOT NULL COMMENT '내용',
    member_id BIGINT NOT NULL COMMENT '작성자 ID',
    view_count INT NOT NULL DEFAULT 0 COMMENT '조회수',
    like_count INT NOT NULL DEFAULT 0 COMMENT '추천수',
    comment_count INT NOT NULL DEFAULT 0 COMMENT '댓글수',
    attachment_path VARCHAR(255) COMMENT '첨부파일 경로',
    attachment_name VARCHAR(255) COMMENT '첨부파일 원본명',
    attachment_size BIGINT COMMENT '첨부파일 크기',
    is_notice BOOLEAN NOT NULL DEFAULT FALSE COMMENT '공지사항 여부',
    is_secret BOOLEAN NOT NULL DEFAULT FALSE COMMENT '비밀글 여부',
    is_active BOOLEAN NOT NULL DEFAULT TRUE COMMENT '활성 상태',
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE' COMMENT '상태 (ACTIVE, HIDDEN, DELETED)',
    category VARCHAR(50) COMMENT '카테고리',
    sub_category VARCHAR(50) COMMENT '서브 카테고리',
    priority INT NOT NULL DEFAULT 0 COMMENT '우선순위',
    is_pinned BOOLEAN NOT NULL DEFAULT FALSE COMMENT '상단 고정 여부',
    parent_board_id BIGINT COMMENT '부모 게시글 ID (답글인 경우)',
    reply_depth INT NOT NULL DEFAULT 0 COMMENT '답글 깊이',
    reply_order INT NOT NULL DEFAULT 0 COMMENT '답글 순서',
    tags VARCHAR(500) COMMENT '태그 (콤마로 구분)',
    meta_description TEXT COMMENT '메타 설명',
    meta_keywords VARCHAR(500) COMMENT '메타 키워드',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성일시',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일시',
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE COMMENT '삭제 여부',
    FOREIGN KEY (member_id) REFERENCES member(member_id),
    FOREIGN KEY (parent_board_id) REFERENCES board(board_id)
) COMMENT='정보 게시판';

-- ================================================
-- 인덱스 생성 (성능 최적화)
-- ================================================

-- 회원 테이블 인덱스
CREATE INDEX idx_member_user_id ON member(user_id);
CREATE INDEX idx_member_email ON member(email);
CREATE INDEX idx_member_role ON member(role);
CREATE INDEX idx_member_created_at ON member(created_at);
CREATE INDEX idx_member_is_deleted ON member(is_deleted);

-- 시설 테이블 인덱스
CREATE INDEX idx_facility_type ON facility(facility_type);
CREATE INDEX idx_facility_location ON facility(latitude, longitude);
CREATE INDEX idx_facility_member_id ON facility(registered_member_id);
CREATE INDEX idx_facility_created_at ON facility(created_at);
CREATE INDEX idx_facility_approval ON facility(is_approved, approval_status);
CREATE INDEX idx_facility_rating ON facility(average_rating);
CREATE INDEX idx_facility_is_deleted ON facility(is_deleted);

-- 시설 이미지 테이블 인덱스 (다중 이미지 지원 강화)
-- 주의: facility_images 테이블 생성 시 이미 정의된 인덱스는 제외
CREATE INDEX idx_facility_images_upload_date ON facility_images(upload_date);
CREATE INDEX idx_facility_images_alt_text ON facility_images(image_alt_text);

-- 구인구직 테이블 인덱스
CREATE INDEX idx_job_type ON job_posting(job_type);
CREATE INDEX idx_job_work_type ON job_posting(work_type);
CREATE INDEX idx_job_member_id ON job_posting(member_id);
CREATE INDEX idx_job_facility_id ON job_posting(facility_id);
CREATE INDEX idx_job_created_at ON job_posting(created_at);
CREATE INDEX idx_job_status ON job_posting(status);
CREATE INDEX idx_job_location ON job_posting(work_location);
CREATE INDEX idx_job_is_deleted ON job_posting(is_deleted);

-- 리뷰 테이블 인덱스
CREATE INDEX idx_review_facility_id ON review(facility_id);
CREATE INDEX idx_review_member_id ON review(member_id);
CREATE INDEX idx_review_created_at ON review(created_at);
CREATE INDEX idx_review_rating ON review(rating);
CREATE INDEX idx_review_status ON review(status);
CREATE INDEX idx_review_is_deleted ON review(is_deleted);

-- 게시판 테이블 인덱스
CREATE INDEX idx_board_type ON board(board_type);
CREATE INDEX idx_board_member_id ON board(member_id);
CREATE INDEX idx_board_created_at ON board(created_at);
CREATE INDEX idx_board_category ON board(category);
CREATE INDEX idx_board_status ON board(status);
CREATE INDEX idx_board_priority ON board(priority);
CREATE INDEX idx_board_is_deleted ON board(is_deleted);

-- ================================================
-- 기본 데이터 삽입 (테스트용) - 개선 반영
-- ================================================
INSERT INTO member (user_id, password, name, email, phone, role, address, is_active, login_fail_count, created_at, updated_at, is_deleted) VALUES
    ('admin', 'admin123', '관리자', 'admin@carelink.com', '02-1234-5678', 'ADMIN', '서울시 종로구 세종대로 1', TRUE, 0, NOW(), NOW(), FALSE),
    ('user01', 'user123', '김철수', 'kim.cs@example.com', '010-1111-2222', 'USER', '서울시 강남구 테헤란로 123', TRUE, 0, NOW(), NOW(), FALSE),
    ('user02', 'user123', '이영희', 'lee.yh@example.com', '010-2222-3333', 'USER', '부산시 해운대구 센텀중앙로 79', TRUE, 0, NOW(), NOW(), FALSE),
    ('user03', 'user123', '박민수', 'park.ms@example.com', '010-3333-4444', 'USER', '대구시 중구 동성로 1', TRUE, 0, NOW(), NOW(), FALSE),
    ('user04', 'user123', '최지은', 'choi.je@example.com', '010-4444-5555', 'USER', '인천시 남동구 구월동 1234', TRUE, 0, NOW(), NOW(), FALSE),
    ('facility01', 'facility123', '서울요양원장', 'seoul.admin@example.com', '02-5555-6666', 'FACILITY', '서울시 서초구 서초대로 123', TRUE, 0, NOW(), NOW(), FALSE),
    ('facility02', 'facility123', '부산실버타운장', 'busan.admin@example.com', '051-7777-8888', 'FACILITY', '부산시 부산진구 서면로 456', TRUE, 0, NOW(), NOW(), FALSE);

-- 시설 데이터 (다중 이미지 지원 반영)
INSERT INTO facility (facility_name, facility_type, address, detail_address, phone, latitude, longitude, description, capacity, current_occupancy, operating_hours, features, average_rating, review_count, grade_rating, image_count, main_image_path, registered_member_id, is_approved, approval_status, created_at, updated_at, is_deleted) VALUES
    ('서울 행복요양원', 'NURSING_HOME', '서울시 강남구 테헤란로 123', '2층 201호', '02-1111-2222', 37.500913, 127.037149, '24시간 전문 간병 서비스를 제공하는 프리미엄 요양원입니다.', 50, 35, '24시간 운영', '24시간 간병서비스, 물리치료실, 인지치료 프로그램', 4.5, 8, 1, 0, NULL, 6, TRUE, 'APPROVED', NOW(), NOW(), FALSE),
    ('부산 바다뷰 실버타운', 'NURSING_HOME', '부산시 해운대구 센텀중앙로 79', '1층', '051-3333-4444', 35.169188, 129.132800, '바다가 보이는 아름다운 환경의 실버타운입니다.', 80, 60, '08:00-22:00', '바다뷰, 실버카페, 도서관, 수영장', 4.2, 12, 2, 0, NULL, 7, TRUE, 'APPROVED', NOW(), NOW(), FALSE),
    ('대전 건강 데이케어센터', 'DAY_CARE', '대전시 유성구 과학로 123', 'B1층', '042-5555-6666', 36.350411, 127.384548, '주간보호 전문 센터로 다양한 프로그램을 운영합니다.', 30, 20, '09:00-18:00', '송영버스, 급식서비스, 건강관리 프로그램', 4.0, 6, 3, 0, NULL, 6, TRUE, 'APPROVED', NOW(), NOW(), FALSE),
    ('인천 평안 요양병원', 'HOSPITAL', '인천시 남동구 구월동 1234', '3-5층', '032-7777-8888', 37.456256, 126.731536, '의료진이 상주하는 전문 요양병원입니다.', 100, 75, '24시간 운영', '의료진 상주, 응급실, 재활치료실, 검사실', 4.3, 15, 1, 0, NULL, 6, TRUE, 'APPROVED', NOW(), NOW(), FALSE),
    ('경기 사랑 재가센터', 'DAY_CARE', '경기도 수원시 팔달구 중부대로 123', '1층', '031-9999-0000', 37.283897, 127.009121, '재가 요양 서비스 전문 센터입니다.', 25, 18, '08:00-20:00', '재가방문, 목욕서비스, 간병서비스', 3.8, 4, 4, 0, NULL, 6, TRUE, 'APPROVED', NOW(), NOW(), FALSE);

-- 구인구직 데이터
INSERT INTO job_posting (title, content, job_type, work_type, position, recruit_count, salary_type, salary_min, salary_max, salary_description, work_location, work_hours, experience, education, qualifications, benefits, start_date, end_date, contact_name, contact_phone, contact_email, status, member_id, facility_id, priority, is_highlight, created_at, updated_at, is_deleted) VALUES
    ('[서울 행복요양원] 요양보호사 정규직 모집', '경력 3년 이상 요양보호사를 모집합니다. 성실하고 책임감 있는 분을 찾습니다.', 'RECRUIT', 'FULL_TIME', '요양보호사', 3, 'MONTHLY', 2800000, 3200000, '경력에 따라 차등 지급', '서울시 강남구', '3교대 (08:00-16:00, 16:00-24:00, 24:00-08:00)', '3년 이상', '고등학교 졸업 이상', '요양보호사 자격증 필수', '4대보험, 퇴직금, 명절상여금, 교육비 지원', '2024-01-15', '2024-02-15', '김과장', '02-1111-2222', 'recruit@seoul-happy.com', 'ACTIVE', 6, 1, 5, FALSE, NOW(), NOW(), FALSE),
    ('[부산 바다뷰 실버타운] 간호사 모집', '실버타운에서 근무할 간호사를 모집합니다. 노인 간호 경험자 우대', 'RECRUIT', 'FULL_TIME', '간호사', 2, 'MONTHLY', 3500000, 4000000, '야간근무수당 별도', '부산시 해운대구', '2교대 (09:00-21:00, 21:00-09:00)', '1년 이상', '간호대학 졸업', '간호사 면허증 필수', '4대보험, 퇴직금, 야간수당, 주말수당', '2024-01-20', '2024-02-20', '이팀장', '051-3333-4444', 'hr@busan-silver.com', 'ACTIVE', 7, 2, 3, TRUE, NOW(), NOW(), FALSE),
    ('[경력직 요양보호사] 좋은 근무환경 찾습니다', '10년 경력의 요양보호사입니다. 야간근무 가능하며 성실히 근무하겠습니다.', 'SEARCH', 'FULL_TIME', '요양보호사', 1, 'MONTHLY', 2500000, 3000000, '야간수당 포함 희망', '서울/경기 지역', '3교대 가능', '10년', '고등학교 졸업', '요양보호사 1급 자격증', '4대보험, 퇴직금', '2024-01-10', '2024-03-10', '홍길동', '010-1234-5678', 'hong@example.com', 'ACTIVE', 2, NULL, 0, FALSE, NOW(), NOW(), FALSE),
    ('대전 데이케어센터 사회복지사 모집', '데이케어센터에서 근무할 사회복지사를 모집합니다.', 'RECRUIT', 'FULL_TIME', '사회복지사', 1, 'MONTHLY', 2600000, 2800000, '기본급 + 수당', '대전시 유성구', '09:00-18:00 (월-토)', '신입 가능', '사회복지학과 졸업', '사회복지사 2급 이상', '4대보험, 퇴직금, 교육비 지원', '2024-01-25', '2024-02-25', '박실장', '042-5555-6666', 'welfare@daejeon.com', 'ACTIVE', 6, 3, 2, FALSE, NOW(), NOW(), FALSE),
    ('물리치료사 파트타임 구직합니다', '물리치료 경력 5년으로 파트타임으로 근무하고 싶습니다.', 'SEARCH', 'PART_TIME', '물리치료사', 1, 'HOURLY', 25000, 30000, '시간당 희망', '수도권 지역', '주 3일 이내', '5년', '물리치료학과 졸업', '물리치료사 면허증', '4대보험', '2024-01-12', '2024-02-12', '김물리', '010-9999-8888', 'pt.kim@example.com', 'ACTIVE', 3, NULL, 0, FALSE, NOW(), NOW(), FALSE);

-- 리뷰 데이터
INSERT INTO review (facility_id, member_id, title, content, rating, service_rating, facility_rating, staff_rating, price_rating, like_count, dislike_count, view_count, is_visible, status, parent_review_id, reply_count, reply_depth, created_at, updated_at, is_deleted) VALUES
    (1, 2, '서울 행복요양원 이용 후기', '어머니를 모시고 있는데 시설도 깨끗하고 직원분들이 정말 친절합니다. 특히 간병서비스가 24시간 제공되어 안심이 됩니다. 추천합니다!', 5, 5, 4, 5, 4, 8, 0, 45, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (1, 3, '만족스러운 요양원', '아버지가 편안하게 지내고 계세요. 물리치료 프로그램도 잘 되어 있고 식사도 맛있다고 하십니다.', 4, 4, 4, 4, 4, 5, 0, 32, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (1, 4, '좋은 선택이었습니다', '처음엔 망설였는데 가족 모두 만족하고 있습니다. 인지치료 프로그램이 특히 좋네요.', 4, 4, 4, 5, 3, 3, 0, 28, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (2, 2, '부산 바다뷰 실버타운 추천', '바다가 보이는 뷰가 정말 좋아요. 할머니가 매일 바다를 보며 산책하신다고 하니 마음이 놓입니다.', 5, 4, 5, 4, 4, 12, 1, 67, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (2, 3, '시설이 현대적이에요', '최신 시설로 잘 갖춰져 있고 수영장도 있어서 좋습니다. 다만 비용이 좀 있는 편이에요.', 4, 4, 5, 4, 3, 6, 0, 39, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (2, 4, '실버카페가 인상적', '실버카페에서 다른 어르신들과 대화하며 시간을 보내신다고 하네요. 사회활동에 도움이 됩니다.', 4, 4, 4, 4, 4, 4, 0, 25, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (3, 2, '대전 데이케어센터 이용기', '주간보호로 이용하고 있는데 프로그램이 다양해서 좋습니다. 송영버스도 편리하고요.', 4, 4, 4, 4, 4, 7, 0, 41, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (3, 5, '건강관리 프로그램 만족', '건강관리 프로그램이 체계적으로 잘 되어 있어요. 혈압, 혈당 관리도 꼼꼼히 해주십니다.', 4, 5, 3, 4, 4, 5, 0, 33, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (4, 3, '인천 평안 요양병원 후기', '의료진이 상주해서 안심이 됩니다. 응급상황에도 빠르게 대응해주셔서 감사했습니다.', 5, 5, 4, 5, 4, 9, 0, 52, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (4, 4, '전문적인 의료서비스', '재활치료실 시설이 좋고 물리치료 선생님들이 전문적으로 치료해주십니다.', 4, 4, 4, 4, 4, 6, 0, 37, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (5, 2, '경기 사랑 재가센터 이용 후기', '재가 서비스로 이용하고 있는데 방문 시간도 정확하고 서비스 품질이 좋습니다.', 4, 4, 4, 4, 4, 4, 0, 29, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (1, 5, '감사합니다', '직원 분들의 세심한 배려에 감사드립니다. 어머니가 많이 좋아지셨어요.', 5, 5, 4, 5, 4, 2, 0, 18, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE);

-- 게시판 데이터
INSERT INTO board (board_type, title, content, member_id, view_count, like_count, comment_count, is_notice, is_secret, is_active, status, category, sub_category, priority, is_pinned, parent_board_id, reply_depth, reply_order, tags, meta_description, meta_keywords, created_at, updated_at, is_deleted) VALUES
    ('NOTICE', '라이트케어 서비스 오픈 안내', '안녕하세요. 라이트케어 요양원 구인구직 플랫폼이 정식 오픈되었습니다. 많은 이용 부탁드립니다.', 1, 125, 15, 3, TRUE, FALSE, TRUE, 'ACTIVE', 'NOTICE', '서비스', 10, TRUE, NULL, 0, 0, '오픈,안내,서비스', '라이트케어 서비스 오픈 안내', '라이트케어,오픈,서비스,요양원', NOW(), NOW(), FALSE),
    ('INFO', '요양원 선택 시 고려사항', '좋은 요양원을 선택하기 위해 고려해야 할 중요한 사항들을 정리해드립니다. 1. 시설 환경 2. 직원의 전문성 3. 의료 서비스 4. 프로그램 다양성 5. 비용 투명성', 1, 89, 12, 5, FALSE, FALSE, TRUE, 'ACTIVE', 'INFO', '가이드', 5, FALSE, NULL, 0, 0, '요양원,선택,가이드', '요양원 선택 가이드', '요양원,선택,가이드,시설', NOW(), NOW(), FALSE),
    ('QNA', '요양보험 적용 관련 문의', '국민건강보험공단에서 시행하는 요양보험이 어떤 시설에 적용되는지 궁금합니다.', 2, 67, 3, 2, FALSE, FALSE, TRUE, 'ACTIVE', 'QNA', '보험', 0, FALSE, NULL, 0, 0, '요양보험,문의', '요양보험 적용 관련 문의', '요양보험,건강보험,적용', NOW(), NOW(), FALSE),
    ('FAQ', '자주 묻는 질문 모음', 'Q1. 입소 절차는 어떻게 되나요? A1. 상담 → 견학 → 서류 제출 → 입소 계약 순으로 진행됩니다. Q2. 면회 시간은 언제인가요? A2. 평일 오후 2시~6시, 주말 오전 10시~오후 6시입니다.', 1, 156, 8, 1, FALSE, FALSE, TRUE, 'ACTIVE', 'FAQ', '일반', 3, FALSE, NULL, 0, 0, 'FAQ,자주묻는질문', '자주 묻는 질문 모음', 'FAQ,질문,답변,입소', NOW(), NOW(), FALSE),
    ('INFO', '노인장기요양보험 제도 안내', '노인장기요양보험 제도에 대해 자세히 설명드립니다. 신청 방법, 등급 판정, 급여 내용 등을 포함합니다.', 1, 98, 7, 4, FALSE, FALSE, TRUE, 'ACTIVE', 'INFO', '제도', 2, FALSE, NULL, 0, 0, '장기요양보험,제도,안내', '노인장기요양보험 제도 안내', '장기요양보험,노인,제도,신청', NOW(), NOW(), FALSE),
    ('QNA', '월 이용료는 얼마인가요?', '부모님 모실 요양원을 찾고 있는데 일반적인 월 이용료가 궁금합니다.', 3, 134, 2, 6, FALSE, FALSE, TRUE, 'ACTIVE', 'QNA', '비용', 0, FALSE, NULL, 0, 0, '이용료,비용,문의', '월 이용료 문의', '이용료,비용,요양원,월비용', NOW(), NOW(), FALSE),
    ('INFO', '어르신 건강관리 팁', '어르신들의 건강한 생활을 위한 일상 관리 팁을 공유합니다. 식사, 운동, 수면, 정신건강 관리 방법을 포함합니다.', 1, 76, 11, 3, FALSE, FALSE, TRUE, 'ACTIVE', 'INFO', '건강', 1, FALSE, NULL, 0, 0, '건강관리,어르신,팁', '어르신 건강관리 팁', '건강관리,어르신,노인,건강,팁', NOW(), NOW(), FALSE),
    ('QNA', '면회 시간과 규정이 궁금해요', '코로나19 이후 면회 시간이나 규정이 어떻게 바뀌었는지 알고 싶습니다.', 4, 45, 1, 1, FALSE, FALSE, TRUE, 'ACTIVE', 'QNA', '면회', 0, FALSE, NULL, 0, 0, '면회,시간,규정', '면회 시간 규정 문의', '면회,시간,규정,코로나', NOW(), NOW(), FALSE),
    ('INFO', '재활 프로그램 종류와 효과', '요양원에서 제공하는 다양한 재활 프로그램들과 그 효과에 대해 알아봅시다.', 1, 63, 9, 2, FALSE, FALSE, TRUE, 'ACTIVE', 'INFO', '재활', 1, FALSE, NULL, 0, 0, '재활,프로그램,효과', '재활 프로그램 안내', '재활,프로그램,물리치료,작업치료', NOW(), NOW(), FALSE),
    ('QNA', '식사 메뉴는 어떻게 제공되나요?', '요양원의 식사 메뉴 구성과 특별식 제공 여부가 궁금합니다.', 5, 58, 4, 3, FALSE, FALSE, TRUE, 'ACTIVE', 'QNA', '식사', 0, FALSE, NULL, 0, 0, '식사,메뉴,급식', '식사 메뉴 문의', '식사,메뉴,급식,요양원', NOW(), NOW(), FALSE);

-- ================================================
-- 완료 메시지
-- ================================================
SELECT '라이트케어 데이터베이스 초기화가 완료되었습니다!' as message;
select * from member;
select * from job_posting;
select * from facility;
select * from facility_images;
use carelink;
````

## File: src/main/resources/templates/facility/crop-images.html
````html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: header}">
    <title>시설 이미지 관리 - CareLink</title>
    <!-- 시설명 메타 태그 (JavaScript에서 사용) -->
    <meta name="facility-name" th:content="${facility?.facilityName ?: '시설'}" />
    <meta name="facility-id" th:content="${facility?.facilityId ?: ''}" />
</head>
<body class="d-flex flex-column min-vh-100 pt-5">
<nav th:replace="~{layout/header :: navbar}"></nav>

<div th:replace="~{layout/header :: messages}"></div>

<main class="flex-grow-1">
    <div class="container mt-4">
        <!-- 브레드크럼 -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">홈</a></li>
                <li class="breadcrumb-item"><a href="/facility/manage">시설 관리</a></li>
                <li class="breadcrumb-item active" aria-current="page">시설 이미지 관리</li>
            </ol>
        </nav>
        
        <div class="row justify-content-center">
            <div class="col-12 col-lg-11">
                <div class="card shadow">
                    <div class="card-body p-4">
                        <div class="text-center mb-4">
                            <h3 class="card-title fw-bold text-primary">
                                <i class="fas fa-images me-2"></i>
                                시설 이미지 관리
                            </h3>
                            <p class="text-muted">시설 사진을 16:9 비율로 조정하여 등록하세요 (최대 5장)</p>
                        </div>

                        <!-- 단계 표시기 (2단계로 간소화) -->
                        <div class="steps-indicator mb-4">
                            <div class="step-item completed" id="step1">
                                <div class="step-circle">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div class="step-label">이미지 선택 완료</div>
                            </div>
                            <div class="step-connector"></div>
                            <div class="step-item active" id="step2">
                                <div class="step-circle">
                                    <i class="fas fa-crop-alt"></i>
                                </div>
                                <div class="step-label">편집 & 최적화</div>
                            </div>
                        </div>

                        <!-- 1단계: 파일 업로드 (숨김 - 이미 1단계에서 완료됨) -->
                        <div id="uploadSection" class="upload-section" style="display: none;">
                            <div class="upload-area" id="uploadArea">
                                <div class="upload-content">
                                    <div class="upload-icon">
                                        <i class="fas fa-cloud-upload-alt fa-3x text-primary"></i>
                                    </div>
                                    <h5 class="upload-title">시설 이미지 업로드</h5>
                                    <p class="upload-description text-muted">
                                        이미지를 드래그하여 업로드하거나 클릭하여 선택하세요
                                    </p>
                                    <div class="upload-format-info">
                                        <small class="text-muted">
                                            <i class="fas fa-info-circle me-1"></i>
                                            JPG, PNG, WebP 파일 지원 (큰 파일도 자동 압축)
                                        </small>
                                        <br>
                                        <small class="text-info">
                                            <i class="fas fa-crop-alt me-1"></i>
                                            시설 사진 비율 (16:9) 자동 조정
                                        </small>
                                        <br>
                                        <small class="text-success">
                                            <i class="fas fa-images me-1"></i>
                                            최대 5장까지 등록 가능
                                        </small>
                                    </div>
                                    <div class="d-flex flex-column gap-3 mt-3 align-items-center">
                                        <!-- 통합된 이미지 불러오기 버튼 -->
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-primary btn-lg" id="imageLoadBtn">
                                                <i class="fas fa-images me-2"></i>이미지 불러오기
                                            </button>
                                            <button type="button" class="btn btn-primary btn-lg dropdown-toggle dropdown-toggle-split" 
                                                    data-bs-toggle="dropdown" aria-expanded="false">
                                                <span class="visually-hidden">옵션 토글</span>
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li>
                                                    <a class="dropdown-item" href="#" id="fileSelectOption">
                                                        <i class="fas fa-file me-2"></i>파일에서 선택
                                                        <small class="text-muted d-block">개별 이미지 파일들을 선택</small>
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="#" id="folderSelectOption">
                                                        <i class="fas fa-folder-open me-2"></i>폴더에서 선택
                                                        <small class="text-muted d-block">폴더 내 이미지들을 선택</small>
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                        
                                        <!-- 선택된 이미지 미리보기 및 오더 설정 영역 -->
                                        <div id="selectedImagesPreview" class="selected-images-preview w-100" style="display: none;">
                                            <div class="card border-primary">
                                                <div class="card-header bg-primary text-white">
                                                    <h6 class="mb-0">
                                                        <i class="fas fa-list me-2"></i>선택된 이미지 (최대 5장)
                                                        <span class="badge bg-light text-dark ms-2" id="selectedCount">0</span>
                                                    </h6>
                                                </div>
                                                <div class="card-body">
                                                    <div id="imageOrderList" class="row g-3"></div>
                                                    <div class="mt-3">
                                                        <!-- 메인 이미지 선택 -->
                                                        <div class="alert alert-info" id="mainImageInfo" style="display: none;">
                                                            <div class="d-flex align-items-center">
                                                                <i class="fas fa-star text-warning me-2"></i>
                                                                <span id="mainImageText">메인 이미지: 없음</span>
                                                                <small class="text-muted ms-2">(이미지를 클릭하여 메인 이미지로 설정)</small>
                                                            </div>
                                                        </div>
                                                        <!-- 버튼 그룹 -->
                                                        <div class="text-center">
                                                            <div class="btn-group">
                                                                <button type="button" class="btn btn-outline-primary" id="addMoreImagesBtn" style="display: none;">
                                                                    <i class="fas fa-plus me-2"></i>이미지 더 추가
                                                                </button>
                                                                <button type="button" class="btn btn-success" id="proceedToCropBtn" style="display: none;">
                                                                    <i class="fas fa-crop-alt me-2"></i>크롭 시작
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
                            <input type="file" id="folderInput" webkitdirectory directory multiple style="display: none;">
                        </div>


                        <!-- 2단계: 크롭 및 조정 (2줄 레이아웃) - 기본 표시 -->
                        <div id="cropSection" class="crop-section" style="display: block;">
                            <!-- 첫째줄: 이미지 크롭과 미리보기 좌우 배치 (6:4 비율) -->
                            <div class="row mb-4">
                                <div class="col-lg-7 col-md-6">
                                    <div class="crop-container">
                                        <h6 class="mb-3">
                                            <i class="fas fa-crop-alt me-2"></i>
                                            이미지 비율 조정
                                            <span class="badge bg-info ms-2" id="currentImageNumber">1/1</span>
                                        </h6>
                                        <div class="crop-image-container">
                                            <img id="cropImage" style="max-width: 100%; display: none;">
                                        </div>
                                        <div class="crop-controls mt-3 text-center">
                                            <div class="btn-group me-3" role="group">
                                                <button type="button" class="btn btn-outline-primary btn-sm" id="zoomInBtn" onclick="zoomIn()">
                                                    <i class="fas fa-search-plus"></i> 확대
                                                </button>
                                                <button type="button" class="btn btn-outline-primary btn-sm" id="zoomOutBtn" onclick="zoomOut()">
                                                    <i class="fas fa-search-minus"></i> 축소
                                                </button>
                                            </div>
                                            <div class="btn-group me-3" role="group">
                                                <button type="button" class="btn btn-outline-secondary btn-sm" id="rotateLeftBtn">
                                                    <i class="fas fa-undo"></i> 좌회전
                                                </button>
                                                <button type="button" class="btn btn-outline-secondary btn-sm" id="rotateRightBtn">
                                                    <i class="fas fa-redo"></i> 우회전
                                                </button>
                                            </div>
                                            <button type="button" class="btn btn-outline-danger btn-sm" id="resetZoomBtn" onclick="resetCrop()">
                                                <i class="fas fa-sync-alt"></i> 리셋
                                            </button>
                                        </div>
                                        
                                        <!-- 줌 상태 표시기 -->
                                        <div id="zoomIndicator" class="zoom-indicator mt-2 text-center" style="display: none;">
                                            <span class="badge bg-info">
                                                <i class="fas fa-search me-1"></i>
                                                <span id="zoomLevel">100%</span>
                                                <span id="zoomStatus" class="ms-2"></span>
                                            </span>
                                        </div>
                                        
                                        <!-- 키보드 단축키 가이드 -->
                                        <div class="mt-3">
                                            <small class="text-muted d-block text-center mb-2">
                                                <i class="fas fa-keyboard me-1"></i>키보드 단축키
                                            </small>
                                            <div class="small text-muted text-center">
                                                <div class="d-flex justify-content-center gap-3 flex-wrap">
                                                    <span><kbd>+/-</kbd> 확대/축소</span>
                                                    <span><kbd>R/L</kbd> 회전</span>
                                                    <span><kbd>Enter</kbd> 완료</span>
                                                    <span><kbd>Esc</kbd> 리셋</span>
                                                    <span><kbd>← →</kbd> 이미지 전환</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-5 col-md-6">
                                    <div class="crop-preview-panel h-100 d-flex flex-column">
                                        <h6 class="mb-3">
                                            <i class="fas fa-eye me-2"></i>미리보기 & 정보
                                        </h6>
                                        
                                        <!-- 미리보기 카드 -->
                                        <div class="facility-preview text-center mb-3 flex-grow-1 d-flex align-items-center justify-content-center">
                                            <div class="facility-card-preview">
                                                <div class="card" style="max-width: 280px; margin: 0 auto;">
                                                    <div class="card-img-container">
                                                        <canvas id="previewCanvas" width="192" height="108" 
                                                                style="width: 100%; height: auto; border-radius: 8px;"></canvas>
                                                        <img id="cropPreviewImage" style="width: 100%; height: auto; border-radius: 8px; display: none;" />
                                                    </div>
                                                    <div class="card-body p-3">
                                                        <h6 class="card-title text-truncate mb-1">시설명</h6>
                                                        <small class="text-muted">시설 카드 미리보기</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- 이미지 정보 패널 -->
                                        <div class="image-info-panel mt-auto">
                                            <div class="card">
                                                <div class="card-body p-3">
                                                    <h6 class="card-title mb-3">
                                                        <i class="fas fa-info-circle me-2"></i>이미지 정보
                                                    </h6>
                                                    <div class="small">
                                                        <div class="d-flex justify-content-between mb-2">
                                                            <span><i class="fas fa-expand-arrows-alt me-1 text-muted"></i>비율:</span>
                                                            <span class="text-primary fw-bold">16:9</span>
                                                        </div>
                                                        <div class="d-flex justify-content-between mb-2">
                                                            <span><i class="fas fa-rulers me-1 text-muted"></i>크기:</span>
                                                            <span id="imageDimensions" class="fw-medium">-</span>
                                                        </div>
                                                        <div class="d-flex justify-content-between">
                                                            <span><i class="fas fa-file me-1 text-muted"></i>파일명:</span>
                                                            <span id="imageFileName" class="text-truncate fw-medium" style="max-width: 150px;">-</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 둘째줄: 3개 카드로 재구성 -->
                            <div class="row">
                                <!-- 1번 카드: 압축 설정 (그대로 유지) -->
                                <div class="col-lg-4 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body p-3">
                                            <h6 class="card-title text-center">
                                                <i class="fas fa-compress-alt me-2"></i>포맷 & 압축
                                            </h6>
                                            <div class="btn-group w-100 mb-3" role="group">
                                                <input type="radio" class="btn-check" name="imageFormat" id="formatAVIF" value="avif">
                                                <label class="btn btn-outline-success btn-sm" for="formatAVIF">AVIF</label>
                                                
                                                <input type="radio" class="btn-check" name="imageFormat" id="formatWebP" value="webp" checked>
                                                <label class="btn btn-outline-info btn-sm" for="formatWebP">WebP</label>
                                                
                                                <input type="radio" class="btn-check" name="imageFormat" id="formatJPEG" value="jpeg">
                                                <label class="btn btn-outline-secondary btn-sm" for="formatJPEG">JPEG</label>
                                            </div>
                                            <div id="compressionSettings">
                                                <label class="form-label small text-center d-block">
                                                    품질: <span id="qualityValue">85%</span>
                                                </label>
                                                <input type="range" class="form-range" id="compressionQuality" 
                                                       min="30" max="100" step="5" value="85">
                                                <div class="d-flex justify-content-between small text-muted">
                                                    <span>압축</span>
                                                    <span>품질</span>
                                                </div>
                                                <button type="button" class="btn btn-outline-primary btn-sm mt-2 w-100" onclick="applyCompression()">
                                                    <i class="fas fa-compress me-1"></i>압축 적용
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 2번 카드: Alt 텍스트 + 파일명 (세로 정렬) -->
                                <div class="col-lg-4 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body p-3">
                                            <h6 class="card-title text-center mb-3">
                                                <i class="fas fa-search me-2"></i>SEO 최적화
                                            </h6>
                                            
                                            <div id="seoSettings">
                                                <!-- Alt 텍스트 -->
                                                <div class="mb-3">
                                                    <label for="altText" class="form-label small">
                                                        <i class="fas fa-font me-1"></i>Alt 텍스트
                                                    </label>
                                                    <input type="text" class="form-control form-control-sm" id="altText" 
                                                           placeholder="이미지 설명을 입력하세요">
                                                    <small class="text-muted">검색엔진 최적화용</small>
                                                </div>
                                                
                                                <!-- 파일명 -->
                                                <div class="mb-2">
                                                    <label for="englishFilename" class="form-label small">
                                                        <i class="fas fa-file-signature me-1"></i>파일명
                                                    </label>
                                                    <input type="text" class="form-control form-control-sm" id="englishFilename" 
                                                           placeholder="예: facility-lobby">
                                                    <small class="text-muted">한글→영문 자동변환</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 3번 카드: 확장된 키워드 선택 (3줄 최대) -->
                                <div class="col-lg-4 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body p-3">
                                            <h6 class="card-title text-center mb-3">
                                                <i class="fas fa-tags me-2"></i>키워드 선택
                                            </h6>
                                            
                                            <div id="keywordList">
                                                <!-- 기본 키워드 (1줄) -->
                                                <div class="mb-2">
                                                    <small class="text-muted d-block mb-1">기본</small>
                                                    <div class="keyword-row">
                                                        <button type="button" class="btn btn-outline-primary btn-sm keyword-btn me-1 mb-1" data-keyword="외관" onclick="handleKeywordClick('외관')">외관</button>
                                                        <button type="button" class="btn btn-outline-primary btn-sm keyword-btn me-1 mb-1" data-keyword="내부" onclick="handleKeywordClick('내부')">내부</button>
                                                        <button type="button" class="btn btn-outline-primary btn-sm keyword-btn me-1 mb-1" data-keyword="로비" onclick="handleKeywordClick('로비')">로비</button>
                                                        <button type="button" class="btn btn-outline-primary btn-sm keyword-btn me-1 mb-1" data-keyword="복도" onclick="handleKeywordClick('복도')">복도</button>
                                                        <button type="button" class="btn btn-outline-primary btn-sm keyword-btn me-1 mb-1" data-keyword="입구" onclick="handleKeywordClick('입구')">입구</button>
                                                    </div>
                                                </div>
                                            
                                            <!-- 공간 키워드 (2줄) -->
                                            <div class="mb-2">
                                                <small class="text-muted d-block mb-1">공간</small>
                                                <div class="keyword-row">
                                                    <button type="button" class="btn btn-outline-info btn-sm keyword-btn me-1 mb-1" data-keyword="거실" onclick="handleKeywordClick('거실')">거실</button>
                                                    <button type="button" class="btn btn-outline-info btn-sm keyword-btn me-1 mb-1" data-keyword="침실" onclick="handleKeywordClick('침실')">침실</button>
                                                    <button type="button" class="btn btn-outline-info btn-sm keyword-btn me-1 mb-1" data-keyword="식당" onclick="handleKeywordClick('식당')">식당</button>
                                                    <button type="button" class="btn btn-outline-info btn-sm keyword-btn me-1 mb-1" data-keyword="화장실" onclick="handleKeywordClick('화장실')">화장실</button>
                                                    <button type="button" class="btn btn-outline-info btn-sm keyword-btn me-1 mb-1" data-keyword="의무실" onclick="handleKeywordClick('의무실')">의무실</button>
                                                </div>
                                            </div>
                                            
                                            <!-- 시설 키워드 (3줄) -->
                                            <div class="mb-2">
                                                <small class="text-muted d-block mb-1">시설</small>
                                                <div class="keyword-row">
                                                    <button type="button" class="btn btn-outline-success btn-sm keyword-btn me-1 mb-1" data-keyword="재활실" onclick="handleKeywordClick('재활실')">재활실</button>
                                                    <button type="button" class="btn btn-outline-success btn-sm keyword-btn me-1 mb-1" data-keyword="휴게실" onclick="handleKeywordClick('휴게실')">휴게실</button>
                                                    <button type="button" class="btn btn-outline-success btn-sm keyword-btn me-1 mb-1" data-keyword="진료실" onclick="handleKeywordClick('진료실')">진료실</button>
                                                    <button type="button" class="btn btn-outline-success btn-sm keyword-btn me-1 mb-1" data-keyword="프로그램실" onclick="handleKeywordClick('프로그램실')">프로그램실</button>
                                                    <button type="button" class="btn btn-outline-success btn-sm keyword-btn me-1 mb-1" data-keyword="정원" onclick="handleKeywordClick('정원')">정원</button>
                                                </div>
                                            </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="crop-actions mt-4 text-center">
                                <div class="d-flex justify-content-between align-items-center">
                                    <button type="button" class="btn btn-outline-secondary" id="backToEditBtn" onclick="goBackToEdit()">
                                        <i class="fas fa-arrow-left me-2"></i>수정 페이지로 돌아가기
                                    </button>
                                    
                                    <!-- 이미지 번호 표시 -->
                                    <div class="image-counter text-muted">
                                        <small class="crop-navigation-info">1 / 1</small>
                                    </div>
                                    
                                    <div class="crop-navigation d-flex gap-2">
                                        <button type="button" class="btn btn-outline-primary" id="prevImageBtn" onclick="proceedToPrevImage()">
                                            <i class="fas fa-chevron-left me-1"></i>이전
                                        </button>
                                        <button type="button" class="btn btn-primary" id="nextImageBtn" onclick="proceedToNextImage()">
                                            다음<i class="fas fa-chevron-right ms-1"></i>
                                        </button>
                                        <button type="button" class="btn btn-success" id="saveCurrentAndGoNext" onclick="saveCropAndNext()">
                                            <i class="fas fa-save me-2"></i>저장 후 수정페이지로
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 3단계: 이미지 관리 (숨김 - 2단계에 통합) -->
                        <div id="manageSection" class="manage-section" style="display: none;">
                            <div class="text-center mb-4">
                                <h4 class="text-primary mb-3">
                                    <i class="fas fa-cogs me-2"></i>이미지 관리
                                </h4>
                                <p class="text-muted">메인 이미지를 설정하고, 불필요한 이미지를 삭제하세요.</p>
                            </div>
                            
                            <div class="manage-images-grid mb-4" id="manageImagesGrid">
                                <div class="text-center">
                                    <i class="fas fa-spinner fa-spin"></i> 크롭된 이미지를 서버에 저장하는 중...
                                </div>
                            </div>
                            
                            <div class="manage-actions text-center">
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-outline-secondary" id="backToCropBtn">
                                        <i class="fas fa-arrow-left me-2"></i>크롭으로 돌아가기
                                    </button>
                                    <button type="button" class="btn btn-success" id="finalCompleteBtn">
                                        <i class="fas fa-check me-2"></i>최종 완료
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 4단계: 최종 완료 -->
                        <div id="completeSection" class="complete-section text-center" style="display: none;">
                            <div class="completion-icon mb-3">
                                <i class="fas fa-check-circle fa-5x text-success"></i>
                            </div>
                            <h4 class="text-success mb-3">시설 이미지 등록 완료!</h4>
                            <p class="text-muted mb-4">시설 이미지가 성공적으로 등록되었습니다.</p>
                            
                            <div class="final-summary mb-4" id="finalSummary">
                                <!-- 최종 요약 정보가 여기에 표시됩니다 -->
                            </div>
                            
                            <div class="final-actions">
                                <a href="/facility/manage" class="btn btn-primary me-2">
                                    <i class="fas fa-building me-2"></i>시설 관리로 돌아가기
                                </a>
                                <button type="button" class="btn btn-outline-primary" id="addMoreImagesBtn">
                                    <i class="fas fa-plus me-2"></i>이미지 더 추가
                                </button>
                            </div>
                        </div>

                        <!-- 줌 표시기 -->
                            <i class="fas fa-search-plus me-2"></i>
                            <span id="zoomLevel">100%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- 이미지 선택 모달 (폴더에서 선택 시 사용) -->
<div class="modal fade" id="imageSelectionModal" tabindex="-1" aria-labelledby="imageSelectionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imageSelectionModalLabel">
                    <i class="fas fa-images me-2"></i>이미지 선택 (최대 5장)
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-md-8">
                        <p class="text-muted mb-0">
                            <i class="fas fa-info-circle me-1"></i>
                            선택한 폴더에서 이미지 파일을 골라주세요. 이미지를 클릭하면 선택됩니다.
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <span class="badge bg-primary fs-6" id="selectedImageCount">0/5 선택됨</span>
                    </div>
                </div>
                
                <!-- 로딩 상태 -->
                <div id="modalLoadingState" class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">로딩 중...</span>
                    </div>
                    <p class="text-muted mt-3">폴더의 이미지를 불러오는 중...</p>
                </div>
                
                <!-- 이미지 그리드 -->
                <div id="modalImageGrid" class="row g-3" style="display: none;">
                    <!-- 동적으로 생성되는 이미지 카드들 -->
                </div>
                
                <!-- 이미지가 없는 경우 -->
                <div id="modalEmptyState" class="text-center py-5" style="display: none;">
                    <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">선택한 폴더에 이미지가 없습니다</h5>
                    <p class="text-muted">JPG, PNG, WebP 형식의 이미지 파일이 있는 폴더를 선택해주세요.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>취소
                </button>
                <button type="button" class="btn btn-primary" id="confirmImageSelection" disabled>
                    <i class="fas fa-check me-2"></i>선택 완료
                </button>
            </div>
        </div>
    </div>
</div>

<footer th:replace="~{layout/footer :: footer}"></footer>

<!-- 필수 JavaScript 라이브러리들 (Bootstrap 포함) -->
<div th:replace="~{layout/footer :: scripts}"></div>

<!-- Cropper.js CDN (추가) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">

<!-- 고급 이미지 크롭퍼 CSS -->
<link th:href="@{/css/advanced-image-cropper.css}" rel="stylesheet">

<!-- 기존 스크립트들은 모듈화된 시스템으로 대체됨 -->

<style>
/* 시설 이미지 크롭퍼 전용 스타일 */
.facility-preview .card {
    transition: transform 0.3s ease;
    border: none;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.facility-preview .card:hover {
    transform: translateY(-2px);
}

.image-item {
    cursor: pointer;
    transition: transform 0.2s ease;
}

.image-item:hover {
    transform: scale(1.02);
}

.image-item.active {
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
}

.crop-navigation .btn {
    min-width: 80px;
}

.final-images-grid {
    max-height: 300px;
    overflow-y: auto;
}

.completion-icon {
    animation: bounceIn 0.8s ease;
}

@keyframes bounceIn {
    0% {
        opacity: 0;
        transform: scale(0.3);
    }
    50% {
        opacity: 1;
        transform: scale(1.05);
    }
    70% {
        transform: scale(0.9);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

/* SEO 최적화 기능 스타일 */
.keyword-suggestions {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
}

.keyword-group {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 5px;
}

.keyword-btn {
    font-size: 0.875rem;
    padding: 5px 10px;
    border-radius: 15px;
    transition: all 0.2s ease;
    cursor: pointer;
}

.keyword-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.keyword-btn.btn-success {
    animation: keywordClick 0.5s ease;
}

@keyframes keywordClick {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.seo-optimization-section {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 10px;
    padding: 20px;
    border: 1px solid #dee2e6;
}

.seo-tips {
    border-left: 4px solid #17a2b8;
    background: rgba(23, 162, 184, 0.1);
}

#imageNameInput {
    border-radius: 8px;
}

#previewFileName {
    color: #17a2b8;
    background: rgba(23, 162, 184, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
}

/* 이미지 선택 모달 스타일 */
.image-selection-card {
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.image-selection-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.image-selection-card.selected {
    border-color: #007bff;
    box-shadow: 0 4px 20px rgba(0,123,255,0.3);
}

.image-selection-card .selection-overlay {
    border-radius: 0.375rem 0.375rem 0 0;
}

#imageSelectionModal .modal-body {
    max-height: 70vh;
    overflow-y: auto;
}

#modalImageGrid {
    max-height: 60vh;
    overflow-y: auto;
}

.input-group .btn {
    border-radius: 0 8px 8px 0;
}

.form-label {
    font-weight: 600;
    color: #495057;
}

/* 이미지 순서 지정 애니메이션 */
.image-order-item .card {
    transition: all 0.3s ease;
}

.image-order-item .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.image-order-item .card.order-added {
    animation: orderAdded 0.5s ease;
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
}

.image-order-item .card.order-removed {
    animation: orderRemoved 0.5s ease;
    transform: scale(0.95);
    box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
}

@keyframes orderAdded {
    0% { 
        transform: scale(1);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    50% { 
        transform: scale(1.1);
        box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
    }
    100% { 
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
    }
}

@keyframes orderRemoved {
    0% { 
        transform: scale(1);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    50% { 
        transform: scale(0.9);
        box-shadow: 0 8px 25px rgba(220, 53, 69, 0.4);
    }
    100% { 
        transform: scale(0.95);
        box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
    }
}

/* 순서 배지 애니메이션 */
.order-badge {
    transition: all 0.3s ease;
}

.order-badge.bg-success {
    animation: badgeSuccess 0.5s ease;
}

.order-badge.bg-secondary {
    animation: badgeSecondary 0.3s ease;
}

@keyframes badgeSuccess {
    0% { 
        transform: scale(1);
        background-color: #6c757d;
    }
    50% { 
        transform: scale(1.2);
        background-color: #28a745;
    }
    100% { 
        transform: scale(1);
        background-color: #28a745;
    }
}

@keyframes badgeSecondary {
    0% { 
        transform: scale(1);
        background-color: #28a745;
    }
    50% { 
        transform: scale(0.8);
        background-color: #6c757d;
    }
    100% { 
        transform: scale(1);
        background-color: #6c757d;
    }
}
</style>

<!-- 외부 라이브러리 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">

<!-- 모듈화된 시설 이미지 시스템 CSS -->
<link rel="stylesheet" href="/css/facility-image-uploader.css">
<link rel="stylesheet" href="/css/advanced-image-cropper.css">
<link rel="stylesheet" href="/css/image-compressor.css">

<!-- 모듈화된 시설 이미지 시스템 JavaScript -->
<!-- 1. Core Module (반드시 첫 번째로 로드) -->
<script th:src="@{/js/facility-image-core.js}"></script>

<!-- 2. 기능별 모듈들 (Core 모듈 이후에 로드) -->
<script th:src="@{/js/facility-image-utils-module.js}"></script>
<script th:src="@{/js/facility-image-ui-module.js}"></script>
<script th:src="@{/js/facility-image-upload-module.js}"></script>
<script th:src="@{/js/facility-image-cropper-module.js}"></script>
<script th:src="@{/js/facility-image-data-module.js}"></script>
<script th:src="@{/js/facility-image-seo-module.js}"></script>

<!-- 3. Main Controller (모든 모듈 이후에 로드) -->
<script th:src="@{/js/facility-image-main-controller.js}"></script>

<!-- 4. 지원 유틸리티 -->
<script th:src="@{/js/smart-scroll-utility.js}"></script>

<script>
    // 시설 정보 전역 변수
    window.facilityInfo = {
        facilityId: /*[[${facility?.facilityId}]]*/ 0,
        facilityName: /*[[${facility?.facilityName}]]*/ '시설명'
    };
    
    // 기존 이미지 정보 (서버에서 전달)
    window.existingImages = /*[[${existingImages}]]*/ [];
    
    // 🔥 새로운 방식: 전역 변수와 메타데이터에서 파일 불러오기
    function loadSelectedFilesFromSession() {
        // 1. 먼저 전역 변수에서 파일 확인 (페이지 간 이동 시)
        if (window.transferSelectedFiles && window.transferSelectedFiles.length > 0) {
            console.log('📂 전역 변수에서 파일 불러오기:', window.transferSelectedFiles.length + '개');
            
            // 전역 변수에 저장
            window.selectedImageFiles = window.transferSelectedFiles;
            
            // 메인 컨트롤러에 파일 전달
            if (window.FacilityImageMainController && window.FacilityImageMainController.processFiles) {
                window.FacilityImageMainController.processFiles(window.transferSelectedFiles);
            }
            
            console.log('✅ 전역 변수에서 파일 불러오기 완료');
            return;
        }
        
        // 2. 압축 통계 불러오기
        const storedStats = sessionStorage.getItem('compressionStats');
        if (storedStats) {
            try {
                const stats = JSON.parse(storedStats);
                console.log('📊 압축 통계 불러오기:');
                console.log(`   원본: ${(stats.originalSize / 1024 / 1024).toFixed(2)}MB`);
                console.log(`   압축: ${(stats.compressedSize / 1024 / 1024).toFixed(2)}MB`);
                console.log(`   절약: ${(stats.savedSize / 1024 / 1024).toFixed(2)}MB (${stats.compressionRatio}%)`);
                
                // 전역 변수에 저장하여 UI에서 표시
                window.compressionStats = stats;
                
                // 세션 스토리지 정리
                sessionStorage.removeItem('compressionStats');
                
            } catch (error) {
                console.error('❌ 압축 통계 불러오기 실패:', error);
            }
        }
        
        // 3. 기존 방식 (Base64 데이터) - 호환성 유지
        const storedFiles = sessionStorage.getItem('selectedImageFiles');
        if (storedFiles) {
            try {
                const fileDataArray = JSON.parse(storedFiles);
                console.log('📂 세션에서 파일 불러오기 (기존 방식):', fileDataArray.length + '개');
                
                // File 객체로 변환
                const fileObjects = fileDataArray.map(fileData => {
                    // Base64를 Blob으로 변환
                    const byteCharacters = atob(fileData.data.split(',')[1]);
                    const byteNumbers = new Array(byteCharacters.length);
                    for (let i = 0; i < byteCharacters.length; i++) {
                        byteNumbers[i] = byteCharacters.charCodeAt(i);
                    }
                    const byteArray = new Uint8Array(byteNumbers);
                    const blob = new Blob([byteArray], {type: fileData.type});
                    
                    // File 객체 생성
                    return new File([blob], fileData.name, {
                        type: fileData.type,
                        lastModified: Date.now()
                    });
                });
                
                // 전역 변수에 저장
                window.selectedImageFiles = fileObjects;
                
                // 메인 컨트롤러에 파일 전달
                if (window.FacilityImageMainController && window.FacilityImageMainController.processFiles) {
                    window.FacilityImageMainController.processFiles(fileObjects);
                }
                
                console.log('✅ 세션에서 파일 불러오기 완료');
                
                // 세션 스토리지 정리
                sessionStorage.removeItem('selectedImageFiles');
                
            } catch (error) {
                console.error('❌ 세션에서 파일 불러오기 실패:', error);
            }
        }
    }
    
    // 메타데이터 표시 함수
    function displayFileMetadata(metadata) {
        console.log('📋 파일 메타데이터:');
        metadata.forEach((file, index) => {
            console.log(`${index + 1}. ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB, ${file.type})`);
        });
    }
    
    // 페이지 로드 시 세션 파일 불러오기
    document.addEventListener('DOMContentLoaded', function() {
        // 약간의 지연을 두어 모든 모듈이 로드된 후 실행
        setTimeout(loadSelectedFilesFromSession, 1000);
    });
    
    // 메인 컨트롤러가 자동으로 초기화를 수행하므로 별도의 초기화 코드 불필요
    // DOMContentLoaded 이벤트에서 자동으로 초기화됨
    
    // 디버깅을 위한 전역 참조
    window.FacilityImageDebug = {
        facilityInfo: window.facilityInfo,
        existingImages: window.existingImages,
        getSystemState: function() {
            return window.FacilityImageMainController ? 
                window.FacilityImageMainController.getCurrentState() : 
                'System not initialized';
        },
        getModuleInfo: function() {
            if (!window.FacilityImageSystem) return 'System not loaded';
            
            return {
                Core: window.FacilityImageCore?.getInfo(),
                Cropper: window.FacilityImageCropper?.getInfo(),
                Upload: window.FacilityImageUpload?.getInfo(),
                UI: window.FacilityImageUI?.getInfo(),
                Data: window.FacilityImageData?.getInfo(),
                SEO: window.FacilityImageSEO?.getInfo(),
                Utils: window.FacilityImageUtils?.getInfo(),
                Main: window.FacilityImageMainController?.getInfo()
            };
        }
    };
    
    // 2단계 워크플로우 네비게이션 함수들
    
    // 수정 페이지로 돌아가기 (저장하지 않고)
    function goBackToEdit() {
        const facilityId = window.facilityInfo?.facilityId || '';
        if (!facilityId) {
            console.error('❌ 시설 ID가 없습니다');
            alert('시설 정보를 찾을 수 없습니다.');
            return;
        }
        
        console.log('🔙 수정 페이지로 돌아가기 (저장하지 않음)');
        
        // 세션 스토리지 정리
        sessionStorage.removeItem('selectedImageFiles');
        sessionStorage.removeItem('compressionStats');
        
        // 수정 페이지로 이동
        window.location.href = `/facility/edit/${facilityId}`;
    }
    
    // 크롭된 이미지 저장하고 수정 페이지로 돌아가기
    async function saveCropAndNext() {
        try {
            const facilityId = window.facilityInfo?.facilityId || '';
            if (!facilityId) {
                console.error('❌ 시설 ID가 없습니다');
                alert('시설 정보를 찾을 수 없습니다.');
                return;
            }
            
            console.log('💾 이미지 저장 시작...');
            
            // 로딩 상태 표시
            const saveBtn = document.getElementById('saveCurrentAndGoNext');
            const originalText = saveBtn.innerHTML;
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>저장 중...';
            
            // 메인 컨트롤러에서 현재 크롭된 이미지들 가져오기
            let croppedImages = [];
            if (window.FacilityImageMainController && window.FacilityImageMainController.getCroppedImages) {
                croppedImages = window.FacilityImageMainController.getCroppedImages();
            }
            
            if (croppedImages.length === 0) {
                // 크롭된 이미지가 없으면 원본 파일들로 대체
                console.log('⚠️ 크롭된 이미지가 없음, 원본 파일 사용');
                if (window.selectedImageFiles && window.selectedImageFiles.length > 0) {
                    croppedImages = window.selectedImageFiles;
                }
            }
            
            if (croppedImages.length === 0) {
                console.error('❌ 저장할 이미지가 없습니다');
                alert('저장할 이미지가 없습니다. 이미지를 선택하고 크롭해주세요.');
                saveBtn.disabled = false;
                saveBtn.innerHTML = originalText;
                return;
            }
            
            console.log(`📁 저장할 이미지 ${croppedImages.length}개`);
            
            // FormData 생성
            const formData = new FormData();
            formData.append('facilityId', facilityId);
            
            // 이미지 파일들 추가
            croppedImages.forEach((imageData, index) => {
                if (imageData instanceof File) {
                    formData.append('images', imageData);
                } else if (imageData.file) {
                    formData.append('images', imageData.file);
                } else if (imageData.blob) {
                    // Blob을 File로 변환
                    const file = new File([imageData.blob], `image_${index + 1}.webp`, { type: 'image/webp' });
                    formData.append('images', file);
                }
                
                // SEO 정보 추가
                if (imageData.seoData) {
                    formData.append(`seoData[${index}]`, JSON.stringify(imageData.seoData));
                }
            });
            
            // 서버로 이미지 저장 요청
            const response = await fetch(`/api/facility/${facilityId}/images`, {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                const result = await response.json();
                console.log('✅ 이미지 저장 성공:', result);
                
                // 성공 메시지 표시
                if (result.message) {
                    alert(result.message);
                }
                
                // 세션 스토리지 정리
                sessionStorage.removeItem('selectedImageFiles');
                sessionStorage.removeItem('compressionStats');
                
                // 저장된 이미지 정보를 세션에 저장 (수정 페이지에서 표시용)
                if (result.savedImages) {
                    sessionStorage.setItem('savedImages', JSON.stringify(result.savedImages));
                }
                
                // 수정 페이지로 이동
                window.location.href = `/facility/edit/${facilityId}`;
                
            } else {
                const errorData = await response.json();
                console.error('❌ 이미지 저장 실패:', errorData);
                alert(errorData.message || '이미지 저장에 실패했습니다.');
                
                saveBtn.disabled = false;
                saveBtn.innerHTML = originalText;
            }
            
        } catch (error) {
            console.error('❌ 저장 중 오류 발생:', error);
            alert('저장 중 오류가 발생했습니다. 다시 시도해주세요.');
            
            const saveBtn = document.getElementById('saveCurrentAndGoNext');
            saveBtn.disabled = false;
            saveBtn.innerHTML = '<i class="fas fa-save me-2"></i>저장 후 수정페이지로';
        }
    }
    
    // 전역 함수로 등록
    window.goBackToEdit = goBackToEdit;
    window.saveCropAndNext = saveCropAndNext;
    
    // 개발 모드에서만 디버깅 정보 출력
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        console.log('🚀 시설 이미지 모듈화 시스템 v1.0.0');
        console.log('📋 시설 정보:', window.facilityInfo);
        console.log('🖼️ 기존 이미지:', window.existingImages);
        console.log('🔧 디버깅 도구: window.FacilityImageDebug');
        console.log('💡 사용법: FacilityImageDebug.getSystemState(), FacilityImageDebug.getModuleInfo()');
    }
</script>

</body>
</html>
````
`````

## File: schema-postgresql.sql
`````sql
CREATE TABLE IF NOT EXISTS member (
    member_id SERIAL PRIMARY KEY,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    name VARCHAR(50) NOT NULL,
    phone VARCHAR(15),
    role VARCHAR(20) DEFAULT 'USER',
    is_approved BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE IF NOT EXISTS facility (
    facility_id SERIAL PRIMARY KEY,
    facility_name VARCHAR(100) NOT NULL,
    address VARCHAR(200) NOT NULL,
    detail_address VARCHAR(100),
    phone VARCHAR(15),
    facility_type VARCHAR(50),
    description TEXT,
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    is_approved BOOLEAN DEFAULT false,
    registered_member_id INTEGER REFERENCES member(member_id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE IF NOT EXISTS facility_image (
    image_id SERIAL PRIMARY KEY,
    facility_id INTEGER REFERENCES facility(facility_id) ON DELETE CASCADE,
    image_path VARCHAR(500) NOT NULL,
    is_main BOOLEAN DEFAULT false,
    display_order INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE IF NOT EXISTS review (
    review_id SERIAL PRIMARY KEY,
    facility_id INTEGER REFERENCES facility(facility_id) ON DELETE CASCADE,
    member_id INTEGER REFERENCES member(member_id) ON DELETE CASCADE,
    rating INTEGER CHECK (rating >= 1 AND rating <= 5),
    content TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE IF NOT EXISTS board (
    board_id SERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    content TEXT,
    board_type VARCHAR(50) DEFAULT 'info',
    member_id INTEGER REFERENCES member(member_id) ON DELETE CASCADE,
    view_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE IF NOT EXISTS job_posting (
    job_id SERIAL PRIMARY KEY,
    facility_id INTEGER REFERENCES facility(facility_id) ON DELETE CASCADE,
    title VARCHAR(200) NOT NULL,
    content TEXT,
    job_type VARCHAR(50),
    salary VARCHAR(100),
    working_hours VARCHAR(100),
    requirements TEXT,
    benefits TEXT,
    is_active BOOLEAN DEFAULT true,
    deadline TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE IF NOT EXISTS job_application (
    application_id SERIAL PRIMARY KEY,
    job_id INTEGER REFERENCES job_posting(job_id) ON DELETE CASCADE,
    member_id INTEGER REFERENCES member(member_id) ON DELETE CASCADE,
    cover_letter TEXT,
    resume_path VARCHAR(500),
    status VARCHAR(20) DEFAULT 'PENDING',
    applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE INDEX IF NOT EXISTS idx_facility_location ON facility(latitude, longitude);
CREATE INDEX IF NOT EXISTS idx_facility_type ON facility(facility_type);
CREATE INDEX IF NOT EXISTS idx_review_facility ON review(facility_id);
CREATE INDEX IF NOT EXISTS idx_board_type ON board(board_type);
CREATE INDEX IF NOT EXISTS idx_job_active ON job_posting(is_active);
`````

## File: SECURITY_NOTICE.md
`````markdown
# 🚨 중요 보안 공지

## ⚠️ 팀원 필독 사항

### 📋 실제 API 키 정보
- **실제 새로운 카카오 API 키**: 
- **이 키는 팀원들만 사용하고 외부에 노출하지 마세요!**

### 🔐 보안 주의사항

#### 1. 문서 파일 보안
- 모든 MD 파일에서는 실제 API 키를 `새로_발급받은_키`로 표시
- 실제 키는 이 문서와 .env 파일에서만 관리
- **이 파일(SECURITY_NOTICE.md)은 절대 Git에 커밋하지 마세요!**

#### 2. 환경변수 설정시 주의
```env
# .env 파일에 실제 키 입력
KAKAO_APP_KEY=
KAKAO_REST_API_KEY=
```

#### 3. 팀 내부 공유 방법
- 슬랙/디스코드 DM으로만 공유
- 공개 채널에 키 정보 절대 금지
- 스크린샷 시 키 정보 모자이크 처리

### 🚫 절대 하지 말아야 할 것
- 실제 API 키를 MD 파일에 작성
- 공개 채널에 키 정보 공유
- 소스코드에 키 하드코딩
- 이 파일을 Git에 커밋

### ✅ 올바른 작업 방법
1. 이 문서에서 실제 키 확인
2. 개인 .env 파일에만 실제 키 입력
3. 문서 작성시 `새로_발급받은_키` 플레이스홀더 사용
4. 팀원 문의시 DM으로 키 정보 공유

---

**🔒 이 파일은 로컬에서만 보관하고 Git에 커밋하지 마세요!**
`````

## File: SETUP_GUIDE.md
`````markdown
# 🚀 LightCare 개발 환경 설정 가이드

## 📌 현재 상황
이미지 첨부 기능이 완전히 구현되었으나, WSL 환경에 Java와 MySQL이 설치되어 있지 않아 테스트를 진행할 수 없는 상황입니다.

## 🔧 해결 방법 (권장 순서)

### **방법 1: Windows 환경에서 실행 (가장 빠름)**

1. **Windows PowerShell 또는 CMD 열기**
   ```cmd
   cd C:\Users\human-07\LightCare
   ```

2. **MySQL 서비스 실행 확인**
   - Windows 서비스에서 MySQL80 실행 상태 확인
   - 또는 XAMPP 제어판에서 MySQL 시작

3. **애플리케이션 실행**
   ```cmd
   .\gradlew.bat bootRun
   ```

4. **브라우저에서 테스트**
   - http://localhost:8080 접속
   - http://localhost:8080/board/write (게시글 이미지 업로드)
   - http://localhost:8080/review/write (리뷰 이미지 업로드)

### **방법 2: WSL에 개발 환경 구축**

1. **Java 11 설치**
   ```bash
   sudo apt update
   sudo apt install openjdk-11-jdk
   export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
   export PATH=$PATH:$JAVA_HOME/bin
   ```

2. **MySQL 클라이언트 설치**
   ```bash
   sudo apt install mysql-client-core-8.0
   ```

3. **환경변수 영구 설정**
   ```bash
   echo 'export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64' >> ~/.bashrc
   echo 'export PATH=$PATH:$JAVA_HOME/bin' >> ~/.bashrc
   source ~/.bashrc
   ```

## 🗄️ 데이터베이스 스키마 적용

### **MySQL Workbench 또는 phpMyAdmin 사용**

1. **스키마 파일 위치**
   ```
   src/main/resources/schema-image-attachments.sql
   ```

2. **실행해야 할 SQL**
   - 게시판 이미지 테이블: `board_images`
   - 리뷰 이미지 테이블: `review_images`
   - 기존 테이블 컬럼 추가: `image_count`, `has_images`
   - 자동 카운트 업데이트 트리거

### **명령줄에서 직접 실행**
```bash
mysql -u root -p carelink < src/main/resources/schema-image-attachments.sql
```

## 🎯 테스트해야 할 기능들

### **1. 게시글 이미지 업로드**
- 드래그 앤 드롭으로 이미지 업로드
- 최대 10개 이미지 제한 확인
- 파일 크기 검증 (5MB 제한)
- 실시간 미리보기
- alt text 입력
- 개별 이미지 삭제

### **2. 리뷰 이미지 업로드**
- 드래그 앤 드롭으로 이미지 업로드
- 최대 5개 이미지 제한 확인
- WebP 자동 변환 확인
- 썸네일 생성 확인

### **3. 백엔드 API 테스트**
- POST `/board/api/upload-images/{boardId}`
- DELETE `/board/api/delete-image/{imageId}`
- POST `/review/api/upload-images/{reviewId}`
- DELETE `/review/api/delete-image/{imageId}`

## 🐛 문제 해결

### **Java 관련 오류**
- `JAVA_HOME is not set`: Java 환경변수 설정 필요
- `java: command not found`: Java 설치 또는 PATH 설정 필요

### **MySQL 관련 오류**
- `Access denied`: MySQL 사용자 권한 확인
- `Unknown database`: carelink 데이터베이스 생성 확인
- `Table doesn't exist`: schema-image-attachments.sql 실행 필요

### **이미지 업로드 오류**
- `업로드 디렉토리 없음`: C:/carelink-uploads/ 디렉토리 생성
- `WebP 변환 실패`: thumbnailator, imageio-webp 라이브러리 확인
- `파일 크기 초과`: 5MB 제한 확인

## 📞 추가 지원이 필요한 경우

1. **환경 설정 관련**: SETUP_GUIDE.md 참조
2. **데이터베이스 설정**: schema-image-attachments.sql 실행
3. **기능 테스트**: 위 테스트 항목들 순차적 확인

## 🎉 성공적으로 실행되면 확인할 수 있는 것들

- ✅ 드래그 앤 드롭 이미지 업로드 UI
- ✅ 실시간 이미지 미리보기
- ✅ WebP 자동 변환 및 용량 절약
- ✅ 다중 썸네일 생성
- ✅ SEO 최적화를 위한 alt text
- ✅ 반응형 업로드 인터페이스

---

**💡 팁**: Windows 환경에서 먼저 테스트한 후, 필요시 WSL 환경 구축을 진행하는 것을 권장합니다.
`````

## File: system.properties
`````
java.runtime.version=11
`````

## File: tomorrow-checklist.md
`````markdown
# 📋 내일 Oracle Cloud 배포 체크리스트

## 1. Oracle Cloud 가입 재시도
- [ ] 24시간 후 재시도
- [ ] 시크릿 모드 브라우저 사용
- [ ] 다른 카드 준비 (필요시)

## 2. 가입 성공 후 순서

### Step 1: VM 인스턴스 생성
```
이름: lightcare-server
Shape: VM.Standard.E2.1.Micro (Always Free)
OS: Ubuntu 20.04
Region: Korea Central (춘천)
```

### Step 2: SSH 키 다운로드
- Private Key 안전한 곳에 저장
- 권한 설정: chmod 400 ssh-key.key

### Step 3: Security List 설정
```
포트 22, 80, 443, 8080 오픈
```

### Step 4: 서버 접속 후 실행
```bash
# 1. 서버 접속
ssh -i ssh-key.key ubuntu@<public-ip>

# 2. 기본 패키지 업데이트
sudo apt update && sudo apt upgrade -y

# 3. Java 11 설치
sudo apt install openjdk-11-jdk -y

# 4. MySQL 설치
sudo apt install mysql-server -y

# 5. 프로젝트 디렉토리 생성
mkdir /home/ubuntu/lightcare
```

## 3. 로컬에서 준비할 것

### JAR 파일 빌드
```bash
# Windows 환경
./gradlew.bat clean build -x test

# 빌드된 파일 위치
build/libs/carelink-0.0.1-SNAPSHOT.jar
```

### 환경변수 준비
```
DB_PASSWORD=설정할비밀번호
KAKAO_APP_KEY=b97b58672807a40c122a5deed8a98ea4
```

## 4. 배포 명령어

### JAR 파일 업로드
```bash
scp -i ssh-key.key build/libs/*.jar ubuntu@<ip>:/home/ubuntu/lightcare/
```

### 애플리케이션 실행
```bash
# 테스트 실행
java -jar carelink-0.0.1-SNAPSHOT.jar

# 백그라운드 실행
nohup java -jar carelink-0.0.1-SNAPSHOT.jar &
```

## 5. 확인사항
- [ ] http://<public-ip>:8080 접속 테스트
- [ ] 데이터베이스 연결 확인
- [ ] 로그 파일 확인

## 💡 Tips
- Oracle Cloud는 한번 설정하면 영구 무료
- 주기적으로 접속해서 계정 활성 유지
- 문제 발생시 다시 연락주세요!
`````

## File: src/main/java/com/example/carelink/common/CustomMultipartFile.java
`````java
public class CustomMultipartFile implements MultipartFile {
⋮----
public String getName() {
⋮----
public String getOriginalFilename() {
⋮----
public String getContentType() {
⋮----
public boolean isEmpty() {
⋮----
public long getSize() {
⋮----
public byte[] getBytes() throws IOException {
⋮----
public InputStream getInputStream() throws IOException {
return new ByteArrayInputStream(content);
⋮----
public void transferTo(File dest) throws IOException, IllegalStateException {
try (FileOutputStream fos = new FileOutputStream(dest)) {
fos.write(content);
`````

## File: src/main/java/com/example/carelink/common/PageInfo.java
`````java
public class PageInfo<T> {
⋮----
this.totalPages = (int) Math.ceil((double) totalCount / pageSize);
this.startPage = Math.max(1, currentPage - 4);
this.endPage = Math.min(totalPages, currentPage + 4);
⋮----
public int getOffset() {
⋮----
public boolean isFirstPage() {
⋮----
public boolean isLastPage() {
`````

## File: src/main/java/com/example/carelink/config/DevSecurityConfig.java
`````java
public class DevSecurityConfig {
⋮----
public SecurityFilterChain devFilterChain(HttpSecurity http) throws Exception {
⋮----
.csrf(csrf -> csrf.disable())
.authorizeHttpRequests(auth -> auth
.anyRequest().permitAll()
⋮----
.formLogin(formLogin -> formLogin.disable())
.httpBasic(httpBasic -> httpBasic.disable());
return http.build();
`````

## File: src/main/java/com/example/carelink/config/ProdSecurityConfig.java
`````java
public class ProdSecurityConfig {
⋮----
public SecurityFilterChain prodFilterChain(HttpSecurity http) throws Exception {
⋮----
.csrf(csrf -> csrf
.csrfTokenRepository(org.springframework.security.web.csrf.CookieCsrfTokenRepository.withHttpOnlyFalse())
⋮----
.authorizeHttpRequests(auth -> auth
.requestMatchers(
new AntPathRequestMatcher("/css/**"),
new AntPathRequestMatcher("/js/**"),
new AntPathRequestMatcher("/images/**"),
new AntPathRequestMatcher("/favicon.ico")
).permitAll()
⋮----
new AntPathRequestMatcher("/"),
new AntPathRequestMatcher("/member/login"),
new AntPathRequestMatcher("/member/join"),
new AntPathRequestMatcher("/member/checkUserId"),
new AntPathRequestMatcher("/facility/**"),
new AntPathRequestMatcher("/board/**"),
new AntPathRequestMatcher("/review/**"),
new AntPathRequestMatcher("/job/**"),
new AntPathRequestMatcher("/api/**"),
new AntPathRequestMatcher("/error")
⋮----
.requestMatchers(new AntPathRequestMatcher("/admin/**")).hasRole("ADMIN")
.anyRequest().authenticated()
⋮----
.formLogin(formLogin -> formLogin
.loginPage("/member/login")
.defaultSuccessUrl("/")
.failureUrl("/member/login?error=true")
.permitAll()
⋮----
.logout(logout -> logout
.logoutRequestMatcher(new AntPathRequestMatcher("/member/logout"))
.logoutSuccessUrl("/")
.invalidateHttpSession(true)
.deleteCookies("JSESSIONID")
⋮----
.sessionManagement(session -> session
.maximumSessions(1)
.maxSessionsPreventsLogin(false)
⋮----
return http.build();
`````

## File: src/main/java/com/example/carelink/controller/HomeController.java
`````java
public class HomeController {
⋮----
public String home(Model model) {
model.addAttribute("pageTitle", "메인");
⋮----
int facilityCount = facilityService.getFacilityCount();
int jobCount = jobService.getJobCount();
int reviewCount = reviewService.getReviewCount();
int memberCount = memberService.getMemberCount();
int boardCount = boardService.getBoardCount();
model.addAttribute("facilityCount", facilityCount);
model.addAttribute("jobCount", jobCount);
model.addAttribute("reviewCount", reviewCount);
model.addAttribute("memberCount", memberCount);
model.addAttribute("boardCount", boardCount);
log.info("통계 데이터 - 시설: {}, 구인구직: {}, 리뷰: {}, 회원: {}, 게시글: {}",
⋮----
log.error("통계 데이터 조회 실패", e);
model.addAttribute("facilityCount", 0);
model.addAttribute("jobCount", 0);
model.addAttribute("reviewCount", 0);
model.addAttribute("memberCount", 0);
model.addAttribute("boardCount", 0);
⋮----
log.info("메인 페이지 접속");
⋮----
public String about(Model model) {
model.addAttribute("pageTitle", "소개");
⋮----
public String error() {
`````

## File: src/main/java/com/example/carelink/dao/JobApplicationMapper.java
`````java
public interface JobApplicationMapper {
int insertJobApplication(JobApplicationDTO jobApplication);
int countByJobIdAndApplicantMemberId(@Param("jobId") Long jobId, @Param("applicantMemberId") Long applicantMemberId);
`````

## File: src/main/java/com/example/carelink/dto/FacilityImageDTO.java
`````java
public class FacilityImageDTO {
`````

## File: src/main/java/com/example/carelink/dto/JobApplicationDTO.java
`````java
public class JobApplicationDTO {
`````

## File: src/main/java/com/example/carelink/service/ImageOptimizationService.java
`````java
public class ImageOptimizationService {
private static final Logger log = LoggerFactory.getLogger(ImageOptimizationService.class);
⋮----
THUMBNAIL_SIZES.put("small", new int[]{300, 200});
THUMBNAIL_SIZES.put("medium", new int[]{600, 400});
THUMBNAIL_SIZES.put("large", new int[]{1200, 800});
⋮----
public ImageConversionResult processImage(MultipartFile originalFile, String baseFileName, String uploadDir) {
ImageConversionResult result = new ImageConversionResult();
⋮----
if (!isValidImageMimeType(originalFile.getContentType())) {
log.error("지원하지 않는 MIME 타입: {}", originalFile.getContentType());
throw new IllegalArgumentException("지원하지 않는 이미지 형식입니다. (JPG, PNG, GIF, WebP만 가능)");
⋮----
if (originalFile.getSize() > maxSize) {
throw new IllegalArgumentException("파일 크기가 너무 큽니다. (최대 10MB)");
⋮----
ensureDirectoryExists(uploadDir);
⋮----
originalImage = ImageIO.read(originalFile.getInputStream());
⋮----
log.error("이미지 읽기 실패: {}", originalFile.getOriginalFilename(), e);
throw new IllegalArgumentException("손상된 이미지 파일이거나 읽을 수 없는 형식입니다.");
⋮----
throw new IllegalArgumentException("이미지를 처리할 수 없습니다. 다른 파일을 선택해주세요.");
⋮----
log.info("이미지 처리 시작 (원본 저장 X): {} ({}x{})", baseFileName,
originalImage.getWidth(), originalImage.getHeight());
String optimizedPath = processImageByFormat(originalFile, originalImage, uploadDir, baseFileName + "_optimized");
result.setOriginalWebPPath(optimizedPath);
String thumbnailFormat = "image/webp".equals(originalFile.getContentType()) ? "webp" : "jpg";
Map<String, String> thumbnails = generateThumbnails(originalImage, uploadDir, baseFileName, thumbnailFormat);
result.setThumbnails(thumbnails);
result.setOriginalWidth(originalImage.getWidth());
result.setOriginalHeight(originalImage.getHeight());
result.setOriginalSize(originalFile.getSize());
⋮----
result.setWebpSize(getFileSize(fullPath));
result.setFallbackJpgPath(optimizedPath);
log.info("이미지 처리 완료 - 원본 크기: {}KB, 변환 크기: {}KB ({}% 절감)",
originalFile.getSize() / 1024,
result.getWebpSize() / 1024,
(int)((1 - (double)result.getWebpSize() / originalFile.getSize()) * 100));
⋮----
log.error("이미지 처리 중 오류 발생: {}", baseFileName, e);
throw new RuntimeException("이미지 처리 실패", e);
⋮----
private String processImageByFormat(MultipartFile originalFile, BufferedImage image,
⋮----
String contentType = originalFile.getContentType();
String originalFileName = originalFile.getOriginalFilename();
if ("image/webp".equals(contentType)) {
return saveWebPDirectly(originalFile, uploadDir, fileName);
} else if ("image/jpeg".equals(contentType) || "image/jpg".equals(contentType)) {
return optimizeJPG(originalFile, image, uploadDir, fileName);
⋮----
log.info("PNG/GIF/BMP/TIFF를 JPG로 변환: {}", originalFileName);
return convertToJPG(resizeImage(image, MAX_WIDTH, MAX_HEIGHT), uploadDir, fileName);
⋮----
private String saveWebPDirectly(MultipartFile originalFile, String uploadDir, String fileName) throws IOException {
⋮----
BufferedImage image = ImageIO.read(originalFile.getInputStream());
BufferedImage resizedImage = resizeImage(image, MAX_WIDTH, MAX_HEIGHT);
⋮----
if (ImageIO.write(resizedImage, "webp", new File(fullPath))) {
log.info("WebP 직접 저장 성공: {} ({}KB)", webpFileName,
getFileSize(fullPath) / 1024);
⋮----
log.warn("WebP 저장 실패, JPG로 변환: {}", fileName);
return convertToJPG(resizedImage, uploadDir, fileName);
⋮----
log.error("WebP 처리 실패, JPG로 변환: {}", fileName, e);
⋮----
private String optimizeJPG(MultipartFile originalFile, BufferedImage image,
⋮----
long originalSize = originalFile.getSize();
⋮----
Thumbnails.of(resizedImage)
.size(resizedImage.getWidth(), resizedImage.getHeight())
.outputQuality(1.0f)
.outputFormat("jpg")
.toFile(fullPath);
log.info("JPG 원본 품질 유지: {} ({}KB)", jpgFileName, getFileSize(fullPath) / 1024);
⋮----
log.info("JPG 재압축 수행: {} (원본: {}KB)", fileName, originalSize / 1024);
⋮----
private String convertToJPG(BufferedImage image, String uploadDir, String fileName) throws IOException {
⋮----
Thumbnails.of(image)
.size(image.getWidth(), image.getHeight())
.outputQuality(0.9f)
⋮----
log.info("JPG 변환 완료: {} ({}KB)", jpgFileName, getFileSize(fullPath) / 1024);
⋮----
private Map<String, String> generateThumbnails(BufferedImage originalImage, String uploadDir,
⋮----
for (Map.Entry<String, int[]> entry : THUMBNAIL_SIZES.entrySet()) {
String sizeName = entry.getKey();
int[] dimensions = entry.getValue();
⋮----
if ("webp".equals(format)) {
if (ImageIO.write(
Thumbnails.of(originalImage)
.size(dimensions[0], dimensions[1])
.asBufferedImage(),
⋮----
new File(fullPath))) {
thumbnails.put(sizeName, thumbnailFileName);
log.info("WebP 썸네일 생성 완료: {} ({}x{})", thumbnailFileName, dimensions[0], dimensions[1]);
⋮----
log.info("JPG 썸네일 생성 완료: {} ({}x{})", thumbnailFileName, dimensions[0], dimensions[1]);
⋮----
log.error("썸네일 생성 실패: {} - {}", sizeName, e.getMessage());
⋮----
private BufferedImage resizeImage(BufferedImage originalImage, int maxWidth, int maxHeight) throws IOException {
int originalWidth = originalImage.getWidth();
int originalHeight = originalImage.getHeight();
⋮----
double ratio = Math.min(widthRatio, heightRatio);
⋮----
return Thumbnails.of(originalImage)
.size(newWidth, newHeight)
.asBufferedImage();
⋮----
private void ensureDirectoryExists(String dirPath) throws IOException {
Path path = Paths.get(dirPath);
if (!Files.exists(path)) {
Files.createDirectories(path);
log.info("디렉토리 생성: {}", dirPath);
⋮----
private long getFileSize(String filePath) {
⋮----
return Files.size(Paths.get(filePath));
⋮----
public boolean isSupportedImageFormat(String filename) {
⋮----
String extension = getFileExtension(filename).toLowerCase();
return extension.equals("jpg") || extension.equals("jpeg") ||
extension.equals("png") || extension.equals("gif") ||
extension.equals("webp") || extension.equals("bmp") ||
extension.equals("tiff") || extension.equals("tif");
⋮----
public boolean isValidImageMimeType(String mimeType) {
⋮----
return mimeType.startsWith("image/") && (
mimeType.equals("image/jpeg") ||
mimeType.equals("image/jpg") ||
mimeType.equals("image/png") ||
mimeType.equals("image/gif") ||
mimeType.equals("image/webp") ||
mimeType.equals("image/bmp") ||
mimeType.equals("image/tiff")
⋮----
private String getFileExtension(String filename) {
int lastDot = filename.lastIndexOf('.');
return lastDot > 0 ? filename.substring(lastDot + 1) : "";
⋮----
public static class ImageConversionResult {
⋮----
public String getOriginalWebPPath() { return originalWebPPath; }
public void setOriginalWebPPath(String originalWebPPath) { this.originalWebPPath = originalWebPPath; }
public String getFallbackJpgPath() { return fallbackJpgPath; }
public void setFallbackJpgPath(String fallbackJpgPath) { this.fallbackJpgPath = fallbackJpgPath; }
public Map<String, String> getThumbnails() { return thumbnails; }
public void setThumbnails(Map<String, String> thumbnails) { this.thumbnails = thumbnails; }
public int getOriginalWidth() { return originalWidth; }
public void setOriginalWidth(int originalWidth) { this.originalWidth = originalWidth; }
public int getOriginalHeight() { return originalHeight; }
public void setOriginalHeight(int originalHeight) { this.originalHeight = originalHeight; }
public long getOriginalSize() { return originalSize; }
public void setOriginalSize(long originalSize) { this.originalSize = originalSize; }
public long getWebpSize() { return webpSize; }
public void setWebpSize(long webpSize) { this.webpSize = webpSize; }
`````

## File: src/main/java/com/example/carelink/validation/groups/OnFacilityJoin.java
`````java
public interface OnFacilityJoin {
`````

## File: src/main/resources/mapper/JobApplicationMapper.xml
`````xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.JobApplicationMapper">
    <insert id="insertJobApplication" parameterType="com.example.carelink.dto.JobApplicationDTO"
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO job_application (
            job_id,
            applicant_member_id,
            application_date,
            status
        ) VALUES (
            #{jobId},
            #{applicantMemberId},
            #{applicationDate},
            #{status}
        )
    </insert>
    <select id="countByJobIdAndApplicantMemberId" resultType="int">
        SELECT COUNT(*)
        FROM job_application
        WHERE job_id = #{jobId} AND applicant_member_id = #{applicantMemberId}
    </select>
    </mapper>
`````

## File: src/main/resources/static/css/facility-image-uploader.css
`````css
.facility-image-uploader {
.upload-area {
.upload-area::before {
.upload-area:hover {
.upload-area:hover::before {
.upload-area.drag-over {
.upload-content {
.upload-icon {
.upload-icon i {
⋮----
.upload-title {
.upload-description {
.upload-format-info {
/* 미리보기 영역 */
.preview-area {
.preview-header {
.preview-header h6 {
.preview-image-container {
.preview-image {
.image-overlay {
.preview-image-container:hover .image-overlay {
.image-info {
.image-size, .image-dimensions {
/* 압축 설정 */
.compression-settings {
.compression-savings {
⋮----
.form-range {
.form-range::-webkit-slider-track {
.form-range::-webkit-slider-thumb {
.form-range::-moz-range-track {
.form-range::-moz-range-thumb {
/* Alt 텍스트 섹션 */
.alt-text-section {
.alt-text-section .form-label {
/* 진행률 영역 */
.progress-area {
.progress {
.progress-bar {
.progress-text {
/* 버튼 스타일 */
.btn {
.btn::before {
.btn:hover::before {
.btn-lg {
.btn-primary {
.btn-primary:hover {
.btn-outline-danger {
.btn-outline-danger:hover {
.btn-outline-secondary {
.btn-outline-secondary:hover {
/* 에러 메시지 */
.error-message {
⋮----
/* 반응형 디자인 */
⋮----
.compression-settings .row {
.compression-settings .col-md-6 {
⋮----
/* 다크 모드 지원 */
⋮----
.upload-title, .upload-description {
⋮----
/* 애니메이션 향상 */
.facility-image-uploader * {
/* 포커스 상태 */
.btn:focus,
/* 로딩 상태 */
.loading {
.loading::after {
`````

## File: src/main/resources/static/css/image-compressor.css
`````css
.image-compressor-wrapper {
.image-upload-area {
.image-upload-area:hover {
.image-upload-area.drag-over {
.upload-icon svg {
.image-upload-area:hover .upload-icon svg {
.compression-settings {
.compression-settings h4 {
.quality-slider {
.max-width-input {
.compress-btn {
.compress-btn:hover {
.file-preview {
.preview-item {
.preview-item:hover {
.preview-item img {
.compression-result {
.compression-result .text-green-600 {
.compression-progress {
.progress-bar {
.progress-fill {
.progress-fill::after {
⋮----
.compression-summary {
⋮----
.compression-summary h4 {
.compression-summary .text-green-700 {
/* 반응형 디자인 */
⋮----
.compression-settings .grid-cols-2 {
⋮----
.preview-item .flex {
⋮----
/* 드래그 앤 드롭 상태 */
.image-upload-area.border-blue-400 {
.image-upload-area.bg-blue-50 {
/* 로딩 애니메이션 */
.loading-spinner {
⋮----
/* 압축 품질 표시 */
.quality-indicator {
.quality-indicator::before {
.quality-indicator[data-quality="0.1"]::before { width: 10%; }
.quality-indicator[data-quality="0.2"]::before { width: 20%; }
.quality-indicator[data-quality="0.3"]::before { width: 30%; }
.quality-indicator[data-quality="0.4"]::before { width: 40%; }
.quality-indicator[data-quality="0.5"]::before { width: 50%; }
.quality-indicator[data-quality="0.6"]::before { width: 60%; }
.quality-indicator[data-quality="0.7"]::before { width: 70%; }
.quality-indicator[data-quality="0.8"]::before { width: 80%; }
.quality-indicator[data-quality="0.9"]::before { width: 90%; }
.quality-indicator[data-quality="1"]::before { width: 100%; }
/* 툴팁 스타일 */
.tooltip-text {
.tooltip-text::after {
.tooltip-text:hover::after {
/* 성공 메시지 */
.success-message {
⋮----
/* 파일 크기 표시 */
.file-size {
.file-size.original {
.file-size.compressed {
.compression-badge {
.compression-badge.high {
.compression-badge.medium {
.compression-badge.low {
.alt-tags-section {
.alt-tags-section h4 {
.alt-tag-item {
.alt-tag-item:hover {
.file-icon {
.alt-text-input {
.alt-text-input:focus {
.char-count {
.auto-suggestion {
.auto-suggestion .auto-alt-text {
.use-suggestion {
.use-suggestion:hover {
.use-suggestion:disabled {
.seo-help {
.seo-help::before {
.seo-help::after {
.seo-help:hover::before,
.form-check-input:checked {
.form-check-label {
⋮----
.alt-tag-item .d-flex {
⋮----
.alt-input-success {
.alt-input-success:focus {
.alt-input-warning {
.alt-input-warning:focus {
`````

## File: src/main/resources/static/js/board-detail.js
`````javascript
console.log('board-detail.js 로드됨');
function deleteBoard(event) {
console.log('삭제 함수 실행');
⋮----
event.preventDefault();
event.stopPropagation();
⋮----
var button = event ? event.target.closest('button') : document.querySelector('button[data-board-id]');
console.log('버튼:', button);
⋮----
alert('삭제 버튼을 찾을 수 없습니다.');
⋮----
var boardId = parseInt(button.getAttribute('data-board-id'));
var type = button.getAttribute('data-type') || 'all';
console.log('boardId:', boardId, 'type:', type);
if (!boardId || isNaN(boardId)) {
alert('게시글 ID가 올바르지 않습니다.');
⋮----
if (!confirm('정말로 삭제하시겠습니까?')) {
⋮----
var formData = new FormData();
formData.append('type', type);
fetch('/board/delete/' + boardId, {
⋮----
.then(function(response) {
console.log('응답 상태:', response.status);
⋮----
alert('삭제에 실패했습니다.');
⋮----
.catch(function(error) {
console.error('에러:', error);
alert('오류가 발생했습니다.');
⋮----
function likeBoard() {
var deleteButton = document.querySelector('button[data-board-id]');
var boardId = deleteButton ? parseInt(deleteButton.getAttribute('data-board-id')) : 0;
⋮----
alert('게시글 ID를 찾을 수 없습니다.');
⋮----
fetch('/board/like/' + boardId, {
⋮----
.then(function(response) { return response.json(); })
.then(function(data) {
⋮----
var likeCount = document.getElementById('likeCount');
⋮----
likeCount.textContent = parseInt(likeCount.textContent) + 1;
⋮----
alert(data.message || '추천되었습니다.');
⋮----
alert(data.message || '추천에 실패했습니다.');
⋮----
function shareBoard() {
var title = document.title.replace(' - CareLink', '') || '게시글';
⋮----
navigator.clipboard.writeText(url).then(function() {
alert('링크가 복사되었습니다.');
}).catch(function() {
prompt('링크를 복사하세요:', url);
⋮----
function reportBoard() {
if (confirm('이 게시글을 신고하시겠습니까?')) {
alert('신고가 접수되었습니다.');
⋮----
console.log('board-detail.js 로드 완료');
`````

## File: src/main/resources/static/js/board-navigation.js
`````javascript
$(document).ready(function() {
console.log('게시판 네비게이션 스크립트 로드됨');
$('.board-type-link, .btn-group a[href*="/board"]').on('click', function(e) {
const url = $(this).attr('href');
if (url && window.location.pathname.includes('/board')) {
e.preventDefault();
⋮----
history.replaceState(null, null, url);
console.log('히스토리 교체됨:', url);
⋮----
$(document).on('click', '.pagination .page-link', function(e) {
⋮----
if (url && url !== '#' && url !== 'javascript:void(0)' && window.location.pathname.includes('/board')) {
⋮----
$(document).on('submit', 'form[action*="/board"]', function(e) {
if (window.location.pathname.includes('/board')) {
⋮----
const form = $(this);
const url = form.attr('action') || '/board';
const formData = form.serialize();
⋮----
history.replaceState(null, null, fullUrl);
`````

## File: src/main/resources/static/js/change-password.js
`````javascript
document.addEventListener('DOMContentLoaded', function() {
⋮----
form: document.getElementById('changePasswordForm'),
currentPassword: document.getElementById('currentPassword'),
newPassword: document.getElementById('newPassword'),
confirmPassword: document.getElementById('confirmPassword'),
submitButton: document.getElementById('submitButton'),
⋮----
current: document.getElementById('toggleCurrentPassword'),
new: document.getElementById('toggleNewPassword'),
confirm: document.getElementById('toggleConfirmPassword')
⋮----
current: document.getElementById('currentPasswordFeedback'),
new: document.getElementById('newPasswordFeedback'),
confirm: document.getElementById('confirmPasswordFeedback')
⋮----
console.log('비밀번호 변경 페이지 DOM 요소:', elements);
function setupPasswordToggle(inputElement, toggleButton) {
⋮----
console.warn('비밀번호 토글 요소가 없습니다.');
⋮----
toggleButton.addEventListener('click', function() {
const icon = this.querySelector('i');
⋮----
icon.classList.remove('fa-eye');
icon.classList.add('fa-eye-slash');
⋮----
icon.classList.remove('fa-eye-slash');
icon.classList.add('fa-eye');
⋮----
setupPasswordToggle(elements.currentPassword, elements.toggleButtons.current);
setupPasswordToggle(elements.newPassword, elements.toggleButtons.new);
setupPasswordToggle(elements.confirmPassword, elements.toggleButtons.confirm);
function clearValidationState(inputElement) {
⋮----
inputElement.classList.remove('is-valid', 'is-invalid');
⋮----
function setFeedback(feedbackElement, message, isValid) {
⋮----
feedbackElement.classList.remove('invalid-feedback');
feedbackElement.classList.add('valid-feedback');
⋮----
feedbackElement.classList.remove('valid-feedback');
feedbackElement.classList.add('invalid-feedback');
⋮----
function setValidationState(inputElement, isValid) {
⋮----
inputElement.classList.remove('is-invalid');
inputElement.classList.add('is-valid');
⋮----
inputElement.classList.remove('is-valid');
inputElement.classList.add('is-invalid');
⋮----
function validateCurrentPassword() {
const value = elements.currentPassword.value.trim();
⋮----
clearValidationState(elements.currentPassword);
setFeedback(elements.feedbacks.current, '', true);
⋮----
setValidationState(elements.currentPassword, isValid);
⋮----
setFeedback(elements.feedbacks.current, '현재 비밀번호를 정확히 입력해주세요.', false);
⋮----
// 새 비밀번호 검증
function validateNewPassword() {
⋮----
const isValid = PASSWORD_PATTERN.test(value);
⋮----
clearValidationState(elements.newPassword);
setFeedback(elements.feedbacks.new, '', true);
⋮----
setValidationState(elements.newPassword, isValid);
⋮----
setFeedback(elements.feedbacks.new, '8-20자의 영문, 숫자, 특수문자를 1개 이상 포함해주세요.', false);
⋮----
// 현재 비밀번호와 같은지 확인
⋮----
setValidationState(elements.newPassword, false);
setFeedback(elements.feedbacks.new, '현재 비밀번호와 다른 비밀번호를 입력해주세요.', false);
⋮----
setFeedback(elements.feedbacks.new, '사용 가능한 비밀번호입니다.', true);
⋮----
// 비밀번호 확인 검증
function validateConfirmPassword() {
⋮----
clearValidationState(elements.confirmPassword);
setFeedback(elements.feedbacks.confirm, '', true);
⋮----
setValidationState(elements.confirmPassword, isValid);
⋮----
setFeedback(elements.feedbacks.confirm, '새 비밀번호와 일치하지 않습니다.', false);
⋮----
setFeedback(elements.feedbacks.confirm, '비밀번호가 일치합니다.', true);
⋮----
// 폼 제출 버튼 활성화/비활성화
function updateSubmitButton() {
const isCurrentValid = validateCurrentPassword();
const isNewValid = validateNewPassword();
const isConfirmValid = validateConfirmPassword();
⋮----
// 이벤트 리스너 등록
⋮----
elements.currentPassword.addEventListener('input', function() {
validateCurrentPassword();
⋮----
validateNewPassword();
⋮----
updateSubmitButton();
⋮----
elements.currentPassword.addEventListener('blur', function() {
⋮----
elements.newPassword.addEventListener('input', function() {
⋮----
validateConfirmPassword();
⋮----
elements.newPassword.addEventListener('blur', function() {
⋮----
elements.confirmPassword.addEventListener('input', function() {
⋮----
elements.confirmPassword.addEventListener('blur', function() {
⋮----
elements.form.addEventListener('submit', function(event) {
const isFormValid = updateSubmitButton();
⋮----
event.preventDefault();
console.log('폼 유효성 검사 실패');
if (!validateCurrentPassword() && elements.currentPassword) {
elements.currentPassword.focus();
} else if (!validateNewPassword() && elements.newPassword) {
elements.newPassword.focus();
} else if (!validateConfirmPassword() && elements.confirmPassword) {
elements.confirmPassword.focus();
⋮----
console.log('비밀번호 변경 폼 제출');
⋮----
console.log('비밀번호 변경 페이지 JavaScript 초기화 완료');
`````

## File: src/main/resources/static/js/facility-edit.js
`````javascript
function searchFacilityAddress() {
new daum.Postcode({
⋮----
document.getElementById('facilityAddress').value = fullAddr;
updateMapAndCoordinates(fullAddr);
⋮----
}).open();
⋮----
function updateMapAndCoordinates(address) {
const geocoder = new kakao.maps.services.Geocoder();
geocoder.addressSearch(address, function(result, status) {
⋮----
const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
document.getElementById('latitude').value = result[0].y;
document.getElementById('longitude').value = result[0].x;
const mapContainer = document.getElementById('mapPreviewContainer');
⋮----
const map = new kakao.maps.Map(document.getElementById('previewMap'), mapOption);
const marker = new kakao.maps.Marker({
⋮----
marker.setMap(map);
const infowindow = new kakao.maps.InfoWindow({
⋮----
infowindow.open(map, marker);
⋮----
function handleOperatingHours() {
const radio24 = document.getElementById('operating24');
const radioCustom = document.getElementById('operatingCustom');
const customInput = document.getElementById('customOperatingHours');
const hiddenInput = document.getElementById('operatingHours');
function updateOperatingHours() {
⋮----
radio24.addEventListener('change', updateOperatingHours);
radioCustom.addEventListener('change', updateOperatingHours);
customInput.addEventListener('input', function() {
⋮----
updateOperatingHours();
⋮----
function formatPhoneNumber(input) {
let value = input.value.replace(/\D/g, '');
⋮----
if (value.startsWith('02')) {
⋮----
formattedValue = value.slice(0, 2) + '-' + value.slice(2);
⋮----
formattedValue = value.slice(0, 2) + '-' + value.slice(2, 6) + '-' + value.slice(6);
⋮----
formattedValue = value.slice(0, 2) + '-' + value.slice(2, 6) + '-' + value.slice(6, 10);
⋮----
} else if (value.startsWith('01')) {
⋮----
formattedValue = value.slice(0, 3) + '-' + value.slice(3);
⋮----
formattedValue = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7);
⋮----
formattedValue = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
⋮----
function validateForm() {
⋮----
const element = document.getElementById(field.id);
if (!element.value.trim()) {
alert(`${field.name}을(를) 입력해주세요.`);
element.focus();
⋮----
const phone = document.getElementById('phone').value;
if (!phonePattern.test(phone)) {
alert('올바른 전화번호 형식이 아닙니다.');
document.getElementById('phone').focus();
⋮----
document.addEventListener('DOMContentLoaded', function() {
handleOperatingHours();
const phoneInput = document.getElementById('phone');
⋮----
phoneInput.addEventListener('input', function() {
formatPhoneNumber(this);
⋮----
const existingAddress = document.getElementById('facilityAddress').value;
⋮----
updateMapAndCoordinates(existingAddress);
⋮----
const form = document.getElementById('facilityEditForm');
⋮----
form.addEventListener('submit', function(e) {
if (!validateForm()) {
e.preventDefault();
`````

## File: src/main/resources/static/js/image-compressor.js
`````javascript
class ImageCompressor {
⋮----
async compressFile(file, customOptions = {}) {
⋮----
if (!this.isValidImageFile(file)) {
throw new Error('지원되지 않는 이미지 파일입니다.');
⋮----
const compressedFile = await this.compress(file, options);
⋮----
const compressionRatio = Math.round((1 - compressedSize / originalSize) * 100);
⋮----
console.error('이미지 압축 중 오류 발생:', error);
⋮----
async compressFiles(files, customOptions = {}) {
const fileArray = Array.from(files);
⋮----
const result = await this.compressFile(file, customOptions);
results.push(result);
⋮----
this.onProgress(i + 1, fileArray.length, result);
⋮----
console.error(`파일 ${file.name} 압축 실패:`, error);
results.push({ error: error.message, file });
⋮----
async compress(file, options) {
return new Promise((resolve, reject) => {
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');
const img = new Image();
img.onload = () => {
⋮----
const { width, height } = this.calculateDimensions(
⋮----
ctx.drawImage(img, 0, 0, width, height);
canvas.toBlob((blob) => {
⋮----
const compressedFile = new File([blob], file.name, {
⋮----
lastModified: Date.now()
⋮----
resolve(compressedFile);
⋮----
reject(new Error('압축 실패'));
⋮----
reject(error);
⋮----
img.onerror = () => reject(new Error('이미지 로드 실패'));
img.src = URL.createObjectURL(file);
⋮----
calculateDimensions(originalWidth, originalHeight, maxWidth, maxHeight, enableResize) {
⋮----
return { width: Math.round(width), height: Math.round(height) };
⋮----
isValidImageFile(file) {
⋮----
return validTypes.includes(file.type);
⋮----
static formatFileSize(bytes) {
⋮----
const i = Math.floor(Math.log(bytes) / Math.log(k));
return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
⋮----
setProgressCallback(callback) {
⋮----
class ImageCompressorUI {
⋮----
this.input = document.querySelector(inputSelector);
this.compressor = new ImageCompressor(options);
⋮----
this.init();
⋮----
init() {
⋮----
console.error('이미지 입력 요소를 찾을 수 없습니다.');
⋮----
this.createUI();
this.bindEvents();
⋮----
createUI() {
⋮----
const wrapper = document.createElement('div');
⋮----
<label class="block text-xs text-gray-700 mb-1">품질 (${Math.round(this.compressor.options.quality * 100)}%)</label>
⋮----
this.input.parentNode.insertBefore(wrapper, this.input);
⋮----
this.fileInput = wrapper.querySelector('input[type="file"]');
this.uploadArea = wrapper.querySelector('.image-upload-area');
this.settingsArea = wrapper.querySelector('.compression-settings');
this.previewArea = wrapper.querySelector('.file-preview');
this.altTagsSection = wrapper.querySelector('.alt-tags-section');
this.progressArea = wrapper.querySelector('.compression-progress');
⋮----
bindEvents() {
this.fileInput.addEventListener('change', (e) => {
this.handleFiles(e.target.files);
⋮----
this.uploadArea.addEventListener('click', () => {
this.fileInput.click();
⋮----
this.uploadArea.addEventListener('dragover', (e) => {
e.preventDefault();
this.uploadArea.classList.add('border-blue-400', 'bg-blue-50');
⋮----
this.uploadArea.addEventListener('dragleave', (e) => {
⋮----
this.uploadArea.classList.remove('border-blue-400', 'bg-blue-50');
⋮----
this.uploadArea.addEventListener('drop', (e) => {
⋮----
this.handleFiles(e.dataTransfer.files);
⋮----
this.wrapper.querySelector('.quality-slider').addEventListener('input', (e) => {
const quality = parseFloat(e.target.value);
⋮----
e.target.previousElementSibling.textContent = `품질 (${Math.round(quality * 100)}%)`;
⋮----
this.wrapper.querySelector('.max-width-input').addEventListener('input', (e) => {
this.compressor.options.maxWidth = parseInt(e.target.value);
⋮----
this.wrapper.querySelector('.compress-btn').addEventListener('click', () => {
this.compressImages();
⋮----
handleFiles(files) {
⋮----
this.originalFiles = Array.from(files);
this.showPreview(files);
this.showAltTagInputs(files);
this.settingsArea.classList.remove('hidden');
this.previewArea.classList.remove('hidden');
this.altTagsSection.classList.remove('hidden');
⋮----
showPreview(files) {
const previewList = this.wrapper.querySelector('.preview-list');
⋮----
Array.from(files).forEach((file, index) => {
const previewItem = document.createElement('div');
⋮----
const reader = new FileReader();
reader.onload = (e) => {
⋮----
<p class="text-xs text-gray-500">원본: ${ImageCompressor.formatFileSize(file.size)}</p>
⋮----
reader.readAsDataURL(file);
previewList.appendChild(previewItem);
⋮----
async compressImages() {
⋮----
this.progressArea.classList.remove('hidden');
const progressFill = this.wrapper.querySelector('.progress-fill');
const progressText = this.wrapper.querySelector('.compression-progress p');
this.compressor.setProgressCallback((current, total, result) => {
const percentage = Math.round((current / total) * 100);
⋮----
this.updatePreviewResult(current - 1, result);
⋮----
const results = await this.compressor.compressFiles(this.originalFiles);
this.compressedFiles = results.map(result => result.file).filter(file => file);
this.updateOriginalInput();
⋮----
this.showCompressionSummary(results);
⋮----
console.error('압축 중 오류 발생:', error);
⋮----
updatePreviewResult(index, result) {
const previewItems = this.wrapper.querySelectorAll('.preview-item');
⋮----
const resultDiv = previewItems[index].querySelector('.compression-result');
⋮----
resultDiv.querySelector('.compressed-size').textContent = ImageCompressor.formatFileSize(result.compressedSize);
resultDiv.querySelector('.compression-ratio').textContent = result.compressionRatio;
resultDiv.classList.remove('hidden');
⋮----
updateOriginalInput() {
const dt = new DataTransfer();
this.compressedFiles.forEach(file => {
dt.items.add(file);
⋮----
this.input.dispatchEvent(new Event('change', { bubbles: true }));
⋮----
showCompressionSummary(results) {
const totalOriginal = results.reduce((sum, result) => sum + (result.originalSize || 0), 0);
const totalCompressed = results.reduce((sum, result) => sum + (result.compressedSize || 0), 0);
const totalRatio = Math.round((1 - totalCompressed / totalOriginal) * 100);
const summary = document.createElement('div');
⋮----
<p>원본 용량: ${ImageCompressor.formatFileSize(totalOriginal)}</p>
<p>압축 후 용량: ${ImageCompressor.formatFileSize(totalCompressed)}</p>
⋮----
<p class="mt-1 font-medium">SEO 최적화를 위해 용량이 ${ImageCompressor.formatFileSize(totalOriginal - totalCompressed)} 줄어들었습니다!</p>
⋮----
this.wrapper.appendChild(summary);
⋮----
showAltTagInputs(files) {
const altTagsList = this.wrapper.querySelector('.alt-tags-list');
⋮----
const altTagItem = document.createElement('div');
⋮----
const autoGeneratedAlt = this.generateAutoAltText(fileName);
⋮----
altTagsList.appendChild(altTagItem);
⋮----
this.bindAltTagEvents();
⋮----
bindAltTagEvents() {
this.wrapper.querySelectorAll('.alt-text-input').forEach(input => {
const charCount = input.closest('.alt-tag-item').querySelector('.char-count');
input.addEventListener('input', () => {
⋮----
this.wrapper.querySelectorAll('.use-suggestion').forEach(button => {
button.addEventListener('click', () => {
⋮----
const altInput = this.wrapper.querySelector(`.alt-text-input[data-file-index="${fileIndex}"]`);
const suggestedText = button.closest('.auto-suggestion').querySelector('.auto-alt-text').textContent;
⋮----
altInput.dispatchEvent(new Event('input'));
⋮----
generateAutoAltText(fileName) {
⋮----
.replace(/\.[^/.]+$/, '') // 확장자 제거
.replace(/[_-]/g, ' ')    // 언더스코어, 하이픈을 공백으로
.replace(/\d+/g, '')      // 숫자 제거
.trim();
⋮----
// 한글인지 확인
const isKorean = /[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(cleanName);
⋮----
// 한글 파일명 처리
if (cleanName.includes('시설') || cleanName.includes('요양원')) {
⋮----
} else if (cleanName.includes('프로필') || cleanName.includes('증명')) {
⋮----
// 영문 파일명 처리
const words = cleanName.toLowerCase().split(/\s+/).filter(word => word.length > 0);
⋮----
// 시설 관련 키워드
if (words.some(word => ['facility', 'nursing', 'care', 'hospital'].includes(word))) {
return `${this.capitalizeWords(cleanName)} facility image`;
⋮----
else if (words.some(word => ['profile', 'avatar', 'user', 'member'].includes(word))) {
return `${this.capitalizeWords(cleanName)} profile picture`;
⋮----
return `${this.capitalizeWords(cleanName)} image`;
⋮----
capitalizeWords(str) {
return str.replace(/\b\w/g, l => l.toUpperCase());
⋮----
getAltTexts() {
⋮----
const inputs = this.wrapper.querySelectorAll('.alt-text-input');
const autoGenerate = this.wrapper.querySelector('#autoGenerateAlt').checked;
inputs.forEach((input, index) => {
let altText = input.value.trim();
⋮----
altText = this.generateAutoAltText(this.originalFiles[index].name);
⋮----
altTexts.push(altText);
⋮----
const altTexts = this.getAltTexts();
⋮----
this.compressedFiles.forEach((file, index) => {
⋮----
this.updateAltTextHiddenFields(altTexts);
⋮----
updateAltTextHiddenFields(altTexts) {
this.wrapper.querySelectorAll('input[name*="altText"]').forEach(input => input.remove());
altTexts.forEach((altText, index) => {
⋮----
const hiddenInput = document.createElement('input');
⋮----
this.wrapper.appendChild(hiddenInput);
⋮----
hiddenInput.name = `${this.input.name.replace('File', 'AltText')}`;
⋮----
document.addEventListener('DOMContentLoaded', () => {
const inputs = document.querySelectorAll('input[type="file"][data-image-compressor]');
inputs.forEach(input => {
const options = input.dataset.imageCompressor ? JSON.parse(input.dataset.imageCompressor) : {};
new ImageCompressorUI(`#${input.id}`, options);
`````

## File: src/main/resources/static/js/job-detail.js
`````javascript
document.addEventListener('DOMContentLoaded', function() {
console.log('구인구직 상세보기 페이지 JavaScript 로드됨');
currentJobId = extractJobIdFromUrl();
⋮----
currentJobId = document.getElementById('jobId')?.value;
⋮----
console.log('현재 구인구직 ID:', currentJobId);
initializeEventListeners();
⋮----
function extractJobIdFromUrl() {
⋮----
const segments = path.split('/');
const detailIndex = segments.findIndex(segment => segment === 'detail');
⋮----
console.warn('URL에서 구인구직 ID를 찾을 수 없습니다:', path);
⋮----
function initializeEventListeners() {
const applyBtn = document.querySelector('[onclick="applyJob()"]');
⋮----
applyBtn.removeAttribute('onclick');
applyBtn.addEventListener('click', applyJob);
⋮----
const contactBtn = document.querySelector('[onclick="contactJob()"]');
⋮----
contactBtn.removeAttribute('onclick');
contactBtn.addEventListener('click', contactJob);
⋮----
const bookmarkBtn = document.querySelector('[onclick="bookmarkJob()"]');
⋮----
bookmarkBtn.removeAttribute('onclick');
bookmarkBtn.addEventListener('click', bookmarkJob);
⋮----
const shareBtn = document.querySelector('[onclick="shareJob()"]');
⋮----
shareBtn.removeAttribute('onclick');
shareBtn.addEventListener('click', shareJob);
⋮----
const deleteBtn = document.querySelector('[onclick="deleteJob()"]');
⋮----
deleteBtn.removeAttribute('onclick');
deleteBtn.addEventListener('click', deleteJob);
⋮----
const messageBtn = document.querySelector('[onclick="sendMessage()"]');
⋮----
messageBtn.removeAttribute('onclick');
messageBtn.addEventListener('click', sendMessage);
⋮----
const reportBtn = document.querySelector('[onclick="reportJob()"]');
⋮----
reportBtn.removeAttribute('onclick');
reportBtn.addEventListener('click', reportJob);
⋮----
function applyJob() {
⋮----
alert('오류: 구인구직 정보를 찾을 수 없습니다.');
⋮----
if (confirm('이 구인에 지원하시겠습니까?')) {
fetch(`/job/${currentJobId}/apply`, {
⋮----
body: JSON.stringify({
⋮----
.then(response => {
⋮----
alert('지원이 완료되었습니다. 담당자가 연락드릴 예정입니다.');
location.reload();
⋮----
throw new Error('지원 처리 중 오류가 발생했습니다.');
⋮----
.catch(error => {
console.error('지원 오류:', error);
alert('지원 처리 중 오류가 발생했습니다. 다시 시도해주세요.');
⋮----
function contactJob() {
const contactPhone = document.querySelector('#contactPhone')?.value;
const contactEmail = document.querySelector('#contactEmail')?.value;
⋮----
if (confirm('담당자에게 연락하시겠습니까?\n연락처: ' + contactPhone)) {
⋮----
if (confirm('담당자에게 이메일을 보내시겠습니까?\n이메일: ' + contactEmail)) {
⋮----
alert('연락처 정보가 없습니다.');
⋮----
function bookmarkJob() {
⋮----
alert('관심등록 기능은 추후 구현 예정입니다.');
⋮----
function shareJob() {
⋮----
const title = document.querySelector('h3')?.textContent || '구인구직';
⋮----
navigator.share({
⋮----
}).catch(error => {
console.log('공유 실패:', error);
fallbackShare(url);
⋮----
function fallbackShare(url) {
⋮----
navigator.clipboard.writeText(url).then(() => {
alert('링크가 클립보드에 복사되었습니다.');
}).catch(() => {
promptShare(url);
⋮----
function promptShare(url) {
const textArea = document.createElement('textarea');
⋮----
document.body.appendChild(textArea);
textArea.select();
⋮----
document.execCommand('copy');
⋮----
alert('링크 복사에 실패했습니다. 수동으로 복사해주세요:\n' + url);
⋮----
document.body.removeChild(textArea);
⋮----
function deleteJob() {
⋮----
if (confirm('정말로 이 구인구직을 삭제하시겠습니까?\n삭제된 데이터는 복구할 수 없습니다.')) {
const form = document.createElement('form');
⋮----
const csrfToken = document.querySelector('meta[name="_csrf"]');
⋮----
const csrfInput = document.createElement('input');
⋮----
csrfInput.value = csrfToken.getAttribute('content');
form.appendChild(csrfInput);
⋮----
document.body.appendChild(form);
form.submit();
⋮----
function sendMessage() {
alert('쪽지 기능은 추후 구현 예정입니다.');
⋮----
function reportJob() {
⋮----
const reason = prompt('신고 사유를 입력해주세요:');
if (reason && reason.trim()) {
if (confirm('이 구인구직을 신고하시겠습니까?\n사유: ' + reason)) {
fetch(`/job/${currentJobId}/report`, {
⋮----
reason: reason.trim()
⋮----
alert('신고가 접수되었습니다. 검토 후 조치하겠습니다.');
⋮----
throw new Error('신고 처리 중 오류가 발생했습니다.');
⋮----
console.error('신고 오류:', error);
alert('신고 처리 중 오류가 발생했습니다. 다시 시도해주세요.');
`````

## File: src/main/resources/static/js/my-posts.js
`````javascript
document.addEventListener('DOMContentLoaded', function() {
⋮----
filterButtons: document.querySelectorAll('.filter-btn'),
sortSelect: document.getElementById('sortSelect'),
postsContainer: document.getElementById('postsContainer'),
postItems: document.querySelectorAll('.post-item'),
tableBody: document.querySelector('#postsContainer tbody')
⋮----
console.log('내가 쓴 글 페이지 DOM 요소:', {
⋮----
const urlParams = new URLSearchParams(window.location.search);
const currentType = urlParams.get('type') || 'all';
const currentPage = parseInt(urlParams.get('page')) || 1;
const currentPageSize = parseInt(urlParams.get('pageSize')) || 10;
function setupFilterButtons() {
elements.filterButtons.forEach(button => {
button.addEventListener('click', function() {
const selectedType = this.getAttribute('data-type');
⋮----
const newUrl = new URL(window.location.href);
newUrl.searchParams.set('type', selectedType);
newUrl.searchParams.set('page', '1');
console.log('필터 변경:', selectedType);
window.location.href = newUrl.toString();
⋮----
function setupSorting() {
⋮----
elements.sortSelect.addEventListener('change', function() {
⋮----
console.log('정렬 변경:', sortType);
const rows = Array.from(elements.tableBody.querySelectorAll('.post-item'));
rows.sort((a, b) => {
⋮----
const dateA = new Date(a.getAttribute('data-created'));
const dateB = new Date(b.getAttribute('data-created'));
⋮----
const oldDateA = new Date(a.getAttribute('data-created'));
const oldDateB = new Date(b.getAttribute('data-created'));
⋮----
const viewsA = parseInt(a.getAttribute('data-views')) || 0;
const viewsB = parseInt(b.getAttribute('data-views')) || 0;
⋮----
const likesA = parseInt(a.getAttribute('data-likes')) || 0;
const likesB = parseInt(b.getAttribute('data-likes')) || 0;
⋮----
rows.forEach(row => {
elements.tableBody.appendChild(row);
⋮----
rows.forEach((row, index) => {
⋮----
setTimeout(() => {
⋮----
function setupRowEffects() {
const postRows = document.querySelectorAll('.post-item');
postRows.forEach(row => {
row.addEventListener('mouseenter', function() {
⋮----
row.addEventListener('mouseleave', function() {
⋮----
// 페이지 로드 완료 메시지
function showLoadedMessage() {
⋮----
console.log(`내가 쓴 글 페이지 로드 완료: ${totalPosts}개 게시글`);
⋮----
// 초기화 함수
function init() {
setupFilterButtons();
setupSorting();
setupRowEffects();
showLoadedMessage();
console.log('내가 쓴 글 페이지 JavaScript 초기화 완료');
⋮----
init();
`````

## File: src/main/resources/static/js/phone-formatter.js
`````javascript
class PhoneFormatter {
⋮----
format(phone) {
⋮----
// 숫자만 추출
const cleaned = phone.replace(/\D/g, '');
// 빈 문자열이거나 너무 짧으면 그대로 반환
⋮----
// 각 패턴에 대해 매칭 시도
for (const [areaCodePattern, formatRules] of Object.entries(this.patterns)) {
const areaRegex = new RegExp(areaCodePattern);
if (areaRegex.test(cleaned)) {
// 해당 지역번호의 포맷 규칙들을 시도
⋮----
if (rule.pattern.test(cleaned)) {
return cleaned.replace(rule.pattern, rule.format);
⋮----
// 매칭되지 않는 경우 기본 포맷 적용
return this.applyDefaultFormat(cleaned);
⋮----
/**
     * 기본 포맷 적용 (매칭되지 않는 번호용)
     * @param {string} cleaned - 숫자만 있는 전화번호
     * @returns {string} 기본 포맷팅된 전화번호
     */
applyDefaultFormat(cleaned) {
⋮----
// 10자리: 3-3-4
return cleaned.replace(/^(\d{3})(\d{3})(\d{4})$/, '$1-$2-$3');
⋮----
if (cleaned.startsWith('010') || cleaned.startsWith('070')) {
return cleaned.replace(/^(\d{3})(\d{4})(\d{4})$/, '$1-$2-$3');
⋮----
return cleaned.replace(/^(\d{4})(\d{3})(\d{4})$/, '$1-$2-$3');
⋮----
return cleaned.replace(/^(\d{2})(\d{3})(\d{4})$/, '$1-$2-$3');
⋮----
validate(phone) {
⋮----
// 휴대폰 번호 검사
if (/^(010|011|016|017|018|019)\d{8}$/.test(cleaned)) {
⋮----
result.formatted = this.format(cleaned);
⋮----
// 인터넷 전화 검사
if (/^070\d{8}$/.test(cleaned)) {
⋮----
// 일반 전화 검사
⋮----
/**
     * 실시간 포맷팅을 위한 입력 핸들러
     * @param {HTMLElement} input - 입력 필드
     */
attachToInput(input) {
⋮----
// 입력 이벤트 핸들러
input.addEventListener('input', function(e) {
⋮----
const formatted = self.format(currentValue);
⋮----
e.target.setSelectionRange(cursorPosition + diff, cursorPosition + diff);
⋮----
input.addEventListener('blur', function(e) {
const validation = self.validate(e.target.value);
const feedbackElement = input.parentNode.querySelector('.phone-feedback');
⋮----
feedbackElement.remove();
⋮----
if (e.target.value.trim() !== '') {
const feedback = document.createElement('div');
⋮----
input.parentNode.appendChild(feedback);
⋮----
input.classList.remove('is-invalid');
input.classList.add('is-valid');
⋮----
input.classList.remove('is-valid');
input.classList.add('is-invalid');
⋮----
input.classList.remove('is-valid', 'is-invalid');
⋮----
input.addEventListener('keypress', function(e) {
⋮----
if (!allowedKeys.includes(e.key) && !e.ctrlKey && !e.metaKey) {
e.preventDefault();
⋮----
window.phoneFormatter = new PhoneFormatter();
document.addEventListener('DOMContentLoaded', function() {
const phoneInputs = document.querySelectorAll('input[type="tel"], input[name*="phone"], input[id*="phone"]');
phoneInputs.forEach(input => {
window.phoneFormatter.attachToInput(input);
`````

## File: src/main/resources/static/js/rich-text-editor.js
`````javascript
class RichTextEditor {
⋮----
this.element = document.querySelector(selector);
⋮----
console.error('RichTextEditor: Element not found:', selector);
⋮----
this.init();
⋮----
init() {
this.createEditor();
this.bindEvents();
this.initializeContent();
⋮----
createEditor() {
⋮----
this.container = document.createElement('div');
⋮----
${this.generateToolbar()}
⋮----
this.element.parentNode.insertBefore(this.container, this.element.nextSibling);
this.toolbar = this.container.querySelector('.rte-toolbar');
this.content = this.container.querySelector('.rte-content');
this.statusbar = this.container.querySelector('.rte-statusbar');
this.fileInput = document.createElement('input');
⋮----
this.fileInput.accept = this.options.allowedImageTypes.join(',');
⋮----
this.container.appendChild(this.fileInput);
⋮----
generateToolbar() {
⋮----
this.options.toolbar.forEach(tool => {
⋮----
toolbarGroups.push(currentGroup);
⋮----
currentGroup.push(tool);
⋮----
return toolbarGroups.map(group =>
⋮----
${group.map(tool => this.generateToolButton(tool)).join('')}
⋮----
).join('');
⋮----
generateToolButton(tool) {
⋮----
bindEvents() {
// 툴바 버튼 클릭 이벤트
this.toolbar.addEventListener('click', (e) => {
const button = e.target.closest('.rte-btn');
⋮----
e.preventDefault();
this.executeCommand(button.dataset.command);
⋮----
this.toolbar.addEventListener('change', (e) => {
if (e.target.classList.contains('rte-select')) {
this.executeCommand(e.target.dataset.command, e.target.value);
⋮----
this.toolbar.addEventListener('input', (e) => {
if (e.target.classList.contains('rte-color')) {
⋮----
this.content.addEventListener('input', () => {
this.updateOriginalTextarea();
this.updateStatusBar();
this.handlePlaceholder();
⋮----
this.content.addEventListener('focus', () => {
⋮----
this.content.addEventListener('blur', () => {
⋮----
this.content.addEventListener('keydown', (e) => {
this.handleKeyboardShortcuts(e);
⋮----
this.fileInput.addEventListener('change', (e) => {
this.handleImageUpload(e.target.files[0]);
⋮----
this.content.addEventListener('dragover', (e) => {
⋮----
this.content.classList.add('rte-dragover');
⋮----
this.content.addEventListener('dragleave', (e) => {
⋮----
this.content.classList.remove('rte-dragover');
⋮----
this.content.addEventListener('drop', (e) => {
⋮----
const files = Array.from(e.dataTransfer.files);
const imageFile = files.find(file => this.options.allowedImageTypes.includes(file.type));
⋮----
this.handleImageUpload(imageFile);
⋮----
executeCommand(command, value = null) {
this.content.focus();
⋮----
this.insertLink();
⋮----
this.insertImage();
⋮----
this.insertTable();
⋮----
this.insertBlockquote();
⋮----
this.insertCodeBlock();
⋮----
this.toggleFullscreen();
⋮----
this.toggleSourceCode();
⋮----
document.execCommand('fontSize', false, value);
⋮----
document.execCommand(command, false, value);
⋮----
insertLink() {
const selection = window.getSelection();
const selectedText = selection.toString();
const url = prompt('링크 URL을 입력하세요:', 'https://');
⋮----
const linkText = selectedText || prompt('링크 텍스트를 입력하세요:', url);
⋮----
this.insertHTML(link);
⋮----
insertImage() {
this.fileInput.click();
⋮----
async handleImageUpload(file) {
⋮----
if (!this.options.allowedImageTypes.includes(file.type)) {
alert('지원되지 않는 이미지 형식입니다.');
⋮----
alert(`이미지 크기는 ${this.formatFileSize(this.options.maxImageSize)} 이하여야 합니다.`);
⋮----
this.insertHTML(loadingImg);
⋮----
const compressor = new ImageCompressor({
⋮----
const result = await compressor.compressFile(file);
⋮----
const reader = new FileReader();
reader.onload = (e) => {
⋮----
const loadingSpan = this.content.querySelector('.rte-loading');
⋮----
this.insertHTML(img);
⋮----
reader.readAsDataURL(file);
⋮----
console.error('이미지 업로드 실패:', error);
alert('이미지 업로드에 실패했습니다.');
⋮----
loadingSpan.remove();
⋮----
insertTable() {
const rows = prompt('행 수를 입력하세요:', '3');
const cols = prompt('열 수를 입력하세요:', '3');
if (rows && cols && !isNaN(rows) && !isNaN(cols)) {
⋮----
for (let i = 0; i < parseInt(rows); i++) {
⋮----
for (let j = 0; j < parseInt(cols); j++) {
⋮----
this.insertHTML(table);
⋮----
insertBlockquote() {
⋮----
this.insertHTML(blockquote);
⋮----
insertCodeBlock() {
⋮----
this.insertHTML(code);
⋮----
insertHTML(html) {
if (document.queryCommandSupported('insertHTML')) {
document.execCommand('insertHTML', false, html);
⋮----
const range = selection.getRangeAt(0);
range.deleteContents();
const div = document.createElement('div');
⋮----
const fragment = document.createDocumentFragment();
⋮----
fragment.appendChild(div.firstChild);
⋮----
range.insertNode(fragment);
⋮----
toggleFullscreen() {
this.container.classList.toggle('rte-fullscreen');
const btn = this.toolbar.querySelector('[data-command="fullscreen"] i');
btn.className = this.container.classList.contains('rte-fullscreen')
⋮----
toggleSourceCode() {
const isSourceMode = this.container.classList.contains('rte-source-mode');
⋮----
const sourceTextarea = this.container.querySelector('.rte-source-textarea');
⋮----
sourceTextarea.remove();
this.container.classList.remove('rte-source-mode');
⋮----
const sourceTextarea = document.createElement('textarea');
⋮----
this.content.parentNode.appendChild(sourceTextarea);
this.container.classList.add('rte-source-mode');
⋮----
handleKeyboardShortcuts(e) {
⋮----
switch (e.key.toLowerCase()) {
⋮----
this.executeCommand('bold');
⋮----
this.executeCommand('italic');
⋮----
this.executeCommand('underline');
⋮----
this.executeCommand('undo');
⋮----
this.executeCommand('redo');
⋮----
handlePlaceholder() {
const placeholder = this.content.querySelector('.rte-placeholder');
const isEmpty = this.content.textContent.trim() === '' ||
(this.content.innerHTML.trim() === '<p class="rte-placeholder">' + this.options.placeholder + '</p>');
⋮----
placeholder.remove();
⋮----
updateOriginalTextarea() {
⋮----
// placeholder 제거
if (content.includes('rte-placeholder')) {
⋮----
// 변경 이벤트 발생
this.element.dispatchEvent(new Event('input', { bubbles: true }));
this.element.dispatchEvent(new Event('change', { bubbles: true }));
⋮----
updateStatusBar() {
⋮----
const words = text.trim() ? text.trim().split(/\s+/).length : 0;
⋮----
this.statusbar.querySelector('.rte-word-count').textContent = `단어 수: ${words}`;
this.statusbar.querySelector('.rte-char-count').textContent = `글자 수: ${chars}`;
⋮----
initializeContent() {
⋮----
formatFileSize(bytes) {
⋮----
const i = Math.floor(Math.log(bytes) / Math.log(k));
return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
⋮----
getContent() {
⋮----
setContent(html) {
⋮----
focus() {
⋮----
destroy() {
⋮----
this.container.remove();
⋮----
// 전역 사용을 위한 함수
⋮----
// 자동 초기화 (data-rich-editor 속성이 있는 textarea들에 대해)
document.addEventListener('DOMContentLoaded', () => {
const textareas = document.querySelectorAll('textarea[data-rich-editor]');
textareas.forEach(textarea => {
const options = textarea.dataset.richEditor ? JSON.parse(textarea.dataset.richEditor) : {};
new RichTextEditor(`#${textarea.id}`, options);
`````

## File: src/main/resources/db_performance_indexes.sql
`````sql
CREATE INDEX IF NOT EXISTS idx_reviews_title ON reviews(title);
CREATE INDEX IF NOT EXISTS idx_reviews_created_at ON reviews(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_reviews_rating ON reviews(rating);
CREATE INDEX IF NOT EXISTS idx_reviews_facility_id ON reviews(facility_id);
CREATE INDEX IF NOT EXISTS idx_boards_category ON boards(category);
CREATE INDEX IF NOT EXISTS idx_boards_created_at ON boards(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_boards_title ON boards(title);
CREATE INDEX IF NOT EXISTS idx_boards_status ON boards(is_active, is_deleted);
CREATE INDEX IF NOT EXISTS idx_jobs_type ON job_postings(job_type);
CREATE INDEX IF NOT EXISTS idx_jobs_status ON job_postings(status);
CREATE INDEX IF NOT EXISTS idx_jobs_created_at ON job_postings(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_jobs_salary ON job_postings(salary);
CREATE INDEX IF NOT EXISTS idx_facilities_name ON facilities(facility_name);
CREATE INDEX IF NOT EXISTS idx_facilities_location ON facilities(latitude, longitude);
CREATE INDEX IF NOT EXISTS idx_facilities_type ON facilities(facility_type);
CREATE INDEX IF NOT EXISTS idx_members_email ON members(email);
CREATE INDEX IF NOT EXISTS idx_members_role ON members(role);
CREATE INDEX IF NOT EXISTS idx_reviews_facility_rating ON reviews(facility_id, rating);
CREATE INDEX IF NOT EXISTS idx_boards_category_active ON boards(category, is_active, is_deleted);
CREATE INDEX IF NOT EXISTS idx_jobs_type_status ON job_postings(job_type, status);
`````

## File: README.md
`````markdown
# LightCare (라이트케어) - 요양원 구인구직 플랫폼

![Spring Boot](https://img.shields.io/badge/Spring%20Boot-2.7.18-brightgreen.svg)
![Java](https://img.shields.io/badge/Java-11-orange.svg)
![MySQL](https://img.shields.io/badge/MySQL-8.0-blue.svg)
![MyBatis](https://img.shields.io/badge/MyBatis-2.3.1-red.svg)
![Build Status](https://img.shields.io/badge/Build-Passing-success.svg)

## 📖 프로젝트 개요

LightCare는 한국의 요양원 및 노인요양시설과 구직자를 연결하는 전문 구인구직 플랫폼입니다. 고령화 사회에 필요한 요양 서비스 인력을 효율적으로 매칭하고, 시설과 근로자 모두에게 최적화된 환경을 제공합니다.

### 🎯 주요 기능

- **👥 회원 관리**: 구직자 및 시설 관리자 회원가입/로그인
- **🏥 시설 검색**: 카카오맵 연동 시설 위치 검색 및 상세 정보
- **💼 구인구직**: 채용공고 등록/검색, 지원 시스템
- **⭐ 리뷰 시스템**: 시설 평가 및 후기 공유
- **📋 정보 게시판**: 업계 정보 및 공지사항

## 🛠 기술 스택

### Backend
- **Framework**: Spring Boot 2.7.18
- **Language**: Java 11
- **Database**: MySQL 8.0
- **ORM**: MyBatis 2.3.1
- **Build Tool**: Gradle
- **Template Engine**: Thymeleaf

### Frontend
- **Template**: Thymeleaf
- **Styling**: Bootstrap 5, CSS3
- **JavaScript**: Vanilla JS
- **Maps**: Kakao Maps API

### Development Tools
- **IDE**: IntelliJ IDEA
- **Version Control**: Git/GitHub
- **Database Tool**: MySQL Workbench

## 🚀 빠른 시작

### 사전 요구사항

- Java 11 이상
- MySQL 8.0 이상
- Git

### 설치 및 실행

1. **레포지토리 클론**
   ```bash
   git clone https://github.com/dooseob/lightcare.git
   cd lightcare
   ```

2. **데이터베이스 설정**
   ```sql
   CREATE DATABASE carelink CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

3. **데이터베이스 연결 설정** (`src/main/resources/application.yml`)
   ```yaml
   spring:
     datasource:
       url: jdbc:mysql://localhost:3306/carelink
       username: root
       password: mysql
   ```

4. **스키마 초기화**
   ```bash
   # MySQL에서 schema.sql 실행
   mysql -u root -p carelink < src/main/resources/schema.sql
   ```

5. **애플리케이션 실행**
   ```bash
   ./gradlew bootRun
   ```

6. **브라우저에서 접속**
   ```
   http://localhost:8080
   ```

## 📁 프로젝트 구조

```
src/
├── main/
│   ├── java/com/example/carelink/
│   │   ├── controller/          # 웹 요청 처리
│   │   │   ├── HomeController.java
│   │   │   ├── MemberController.java
│   │   │   ├── FacilityController.java
│   │   │   ├── JobController.java
│   │   │   ├── ReviewController.java
│   │   │   └── BoardController.java
│   │   ├── service/             # 비즈니스 로직
│   │   │   ├── MemberService.java
│   │   │   ├── FacilityService.java
│   │   │   ├── JobService.java
│   │   │   ├── ReviewService.java
│   │   │   └── BoardService.java
│   │   ├── dao/                 # 데이터 접근 계층
│   │   │   ├── MemberMapper.java
│   │   │   ├── FacilityMapper.java
│   │   │   ├── JobMapper.java
│   │   │   ├── ReviewMapper.java
│   │   │   └── BoardMapper.java
│   │   ├── dto/                 # 데이터 전송 객체
│   │   │   ├── MemberDTO.java
│   │   │   ├── FacilityDTO.java
│   │   │   ├── JobDTO.java
│   │   │   ├── ReviewDTO.java
│   │   │   └── BoardDTO.java
│   │   └── common/              # 공통 유틸리티
│   │       ├── BaseDTO.java
│   │       ├── PageInfo.java
│   │       └── Constants.java
│   └── resources/
│       ├── static/              # 정적 리소스
│       │   ├── css/
│       │   └── js/
│       ├── templates/           # Thymeleaf 템플릿
│       │   ├── layout/
│       │   ├── member/
│       │   ├── facility/
│       │   ├── job/
│       │   ├── review/
│       │   └── board/
│       ├── mapper/              # MyBatis SQL 매퍼
│       │   ├── memberMapper.xml
│       │   ├── facilityMapper.xml
│       │   ├── jobMapper.xml
│       │   ├── reviewMapper.xml
│       │   └── boardMapper.xml
│       ├── application.yml      # 애플리케이션 설정
│       ├── mybatis-config.xml   # MyBatis 설정
│       └── schema.sql          # 데이터베이스 스키마
```

## 👥 팀 구성 및 역할

| 팀원 | 담당 기능 | 주요 구현 사항 |
|------|----------|---------------|
| **팀원 A** | 회원 관리 | 로그인, 회원가입, 프로필 관리, 세션 관리 |
| **팀원 B** | 시설 검색 | 카카오맵 연동, 시설 정보 관리, 위치 기반 검색 |
| **팀원 C** | 구인구직 | 채용공고 게시판, 지원 시스템, 채용 관리 |
| **팀원 D** | 리뷰 & 게시판 | 시설 리뷰, 평점 시스템, 정보 게시판 |

## 🗄 데이터베이스 설계

### 주요 테이블

- **member**: 회원 정보 (구직자, 시설 관리자)
- **facility**: 요양시설 정보 및 위치 데이터
- **job_posting**: 채용공고 정보
- **review**: 시설 리뷰 및 평점
- **board**: 정보 게시판

### ERD
```sql
-- 주요 테이블 관계
-- member (1) ←→ (N) job_posting
-- member (1) ←→ (N) review
-- facility (1) ←→ (N) job_posting
-- facility (1) ←→ (N) review
```

## 🔧 개발 가이드

### 코딩 컨벤션

- **클래스명**: PascalCase (`MemberController`)
- **메서드명**: camelCase (`getMemberInfo`)
- **상수**: UPPER_SNAKE_CASE (`DEFAULT_PAGE_SIZE`)
- **패키지명**: 소문자 (`com.example.carelink`)

### Git 브랜치 전략

```
main                 # 메인 브랜치
├── feature/member   # 팀원 A - 회원 관리
├── feature/facility # 팀원 B - 시설 검색
├── feature/job      # 팀원 C - 구인구직
└── feature/review   # 팀원 D - 리뷰 시스템
```

### 커밋 메시지 형식

```
[feat] 새로운 기능 추가
[fix] 버그 수정
[docs] 문서 수정
[style] 코드 스타일 수정
[refactor] 코드 리팩토링
[test] 테스트 코드 추가
```

## 🧪 테스트

```bash
# 전체 테스트 실행
./gradlew test

# 빌드 및 테스트
./gradlew build

# 코드 품질 검사
./gradlew check
```

## 📝 API 문서

### 주요 엔드포인트

| Method | URL | 설명 |
|--------|-----|------|
| GET | `/` | 메인 페이지 |
| GET/POST | `/member/login` | 로그인 |
| GET/POST | `/member/join` | 회원가입 |
| GET | `/facility/search` | 시설 검색 |
| GET | `/job/list` | 채용공고 목록 |
| GET | `/review/list` | 리뷰 목록 |
| GET | `/board/list` | 게시판 목록 |

## 🐛 트러블슈팅

### 자주 발생하는 문제

1. **데이터베이스 연결 오류**
   ```
   해결: application.yml의 데이터베이스 설정 확인
   ```

2. **MyBatis 매퍼 오류**
   ```
   해결: mapper XML의 namespace와 인터페이스 경로 일치 확인
   ```

3. **Thymeleaf 템플릿 오류**
   ```
   해결: templates 폴더 경로와 컨트롤러 반환값 일치 확인
   ```

## 🔄 최근 업데이트

### v1.0.0 (2025-06-22)
- ✅ 프로젝트 기본 구조 완성
- ✅ 전체 파일 에러 디버깅 완료
- ✅ 페이징 로직 오류 수정
- ✅ Gradle 빌드 설정 개선
- ✅ 코드 품질 개선 (NPE 방지, 중복 코드 제거)

## 🚀 향후 개발 계획

- [ ] **v1.1**: 보안 강화 (비밀번호 암호화, CSRF 보호)
- [ ] **v1.2**: 카카오맵 API 연동 완성
- [ ] **v1.3**: 실시간 알림 시스템
- [ ] **v1.4**: 모바일 반응형 UI 개선
- [ ] **v2.0**: AI 기반 매칭 시스템

## 🤝 기여 방법

1. Fork 프로젝트
2. Feature 브랜치 생성 (`git checkout -b feature/새기능`)
3. 변경사항 커밋 (`git commit -m '[feat] 새기능 추가'`)
4. 브랜치에 Push (`git push origin feature/새기능`)
5. Pull Request 생성

## 📞 지원

- **팀 이메일**: lightcare-team@gmail.com
- **이슈 트래킹**: [GitHub Issues](https://github.com/dooseob/lightcare/issues)
- **위키**: [프로젝트 위키](https://github.com/dooseob/lightcare/wiki)

## 📄 라이센스

이 프로젝트는 MIT 라이센스 하에 있습니다. 자세한 내용은 [LICENSE](LICENSE) 파일을 참조하세요.

---

**LightCare 팀** - 요양 서비스의 미래를 밝히는 플랫폼 💡

### 🟢 팀원 D (리뷰/게시판) - 진행률: 100%

#### ✅ **완료된 작업**
**백엔드 완전 구현**:
- ✅ `ReviewService.java` (238줄) - **완전 구현**
  - 리뷰 CRUD 로직
  - 트랜잭션 처리
  - 로깅 추가
  - 유효성 검증
  - 평점 시스템
  - 추천/비추천 기능

- ✅ `BoardService.java` (253줄) - **완전 구현**
  - 게시글 CRUD 로직
  - 페이징 처리
  - 검색 및 카테고리 필터링
  - 인기 게시글 기능
  - 조회수 증가 로직

- ✅ `ReviewMapper.java` & `reviewMapper.xml` - **완전 구현**
  - 모든 필요 메서드 정의
  - XML 쿼리 매핑 완료

- ✅ `BoardMapper.java` & `boardMapper.xml` - **완전 구현**
  - 모든 필요 메서드 정의
  - XML 쿼리 매핑 완료

**프론트엔드 완성**:
- ✅ `templates/review/list.html` (108줄) - **완전 구현**
- ✅ `templates/review/write.html` (122줄) - **완전 구현**
- ✅ `templates/board/list.html` - **완전 구현**
- ✅ `templates/board/write.html` - **완전 구현**
- ✅ `templates/board/detail.html` - **완전 구현**

#### 📊 **실제 Story Point 달성률**
- **완료**: LC-010 (리뷰 작성) - 13/13 SP ✅
- **완료**: LC-011 (리뷰 목록 관리) - 13/13 SP ✅
- **완료**: LC-012 (정보 게시판) - 13/13 SP ✅

**총 달성**: 39/39 SP (100%)

#### 🚀 **다음 단계**
1. **단위 테스트 작성**
   - ReviewService 테스트
   - BoardService 테스트
   - 통합 테스트

2. **성능 최적화**
   - 쿼리 최적화
   - 캐싱 적용
   - N+1 문제 해결

3. **추가 기능 개발**
   - 댓글 시스템 고도화
   - 파일 첨부 기능
   - 에디터 기능 강화
`````

## File: src/main/java/com/example/carelink/common/Constants.java
`````java
public class Constants {
`````

## File: src/main/java/com/example/carelink/config/KakaoApiConfig.java
`````java
public class KakaoApiConfig implements WebMvcConfigurer {
⋮----
private String getKakaoAppKey() {
⋮----
if (key == null || key.isEmpty()) {
key = System.getenv("KAKAO_APP_KEY");
System.out.println("환경변수에서 직접 읽은 API 키: " + (key != null ? "존재함" : "없음"));
⋮----
public void addInterceptors(InterceptorRegistry registry) {
registry.addInterceptor(new KakaoApiInterceptor());
⋮----
public class KakaoApiInterceptor implements HandlerInterceptor {
⋮----
public void postHandle(HttpServletRequest request, HttpServletResponse response,
⋮----
if (modelAndView != null && !modelAndView.getViewName().startsWith("redirect:")) {
String apiKey = getKakaoAppKey();
System.out.println("뷰에 전달할 API 키: " + (apiKey != null && !apiKey.isEmpty() ? "존재함" : "없음"));
modelAndView.addObject("KAKAO_APP_KEY", apiKey);
`````

## File: src/main/java/com/example/carelink/controller/AdminController.java
`````java
public class AdminController {
⋮----
private boolean isAdmin(HttpSession session) {
MemberDTO sessionMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
return sessionMember != null && "ADMIN".equals(sessionMember.getRole());
⋮----
public String adminDashboard(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
if (!isAdmin(session)) {
redirectAttributes.addFlashAttribute("errorMessage", "관리자 권한이 필요합니다.");
⋮----
int pendingFacilities = facilityService.countPendingFacilities();
int totalMembers = memberService.getTotalMemberCount();
int facilityMembers = memberService.getFacilityMemberCount();
⋮----
model.addAttribute("pendingFacilities", pendingFacilities);
model.addAttribute("totalMembers", totalMembers);
model.addAttribute("facilityMembers", facilityMembers);
model.addAttribute("userMembers", userMembers);
log.info("관리자 대시보드 접근 - 승인대기: {}, 전체회원: {}", pendingFacilities, totalMembers);
⋮----
log.error("관리자 대시보드 로딩 중 오류 발생", e);
redirectAttributes.addFlashAttribute("errorMessage", "대시보드 정보를 불러오는 중 오류가 발생했습니다.");
⋮----
public String facilityManagement(@RequestParam(defaultValue = "PENDING") String status,
⋮----
log.info("시설 승인 관리 페이지 접근 시도 - 상태: {}", status);
List<FacilityDTO> facilities = facilityService.getFacilitiesByApprovalStatus(status);
log.info("시설 목록 조회 완료 - 상태: {}, 개수: {}", status, facilities != null ? facilities.size() : "null");
⋮----
log.warn("시설 목록이 null이어서 빈 리스트로 초기화했습니다.");
⋮----
model.addAttribute("facilities", facilities);
model.addAttribute("currentStatus", status);
⋮----
log.error("시설 목록 조회 중 오류 발생 - 상태: {}", status, e);
model.addAttribute("facilities", new ArrayList<>());
⋮----
redirectAttributes.addFlashAttribute("errorMessage", "시설 목록을 불러오는 중 오류가 발생했습니다: " + e.getMessage());
⋮----
public String approveFacility(@PathVariable Long facilityId,
⋮----
if ("approve".equals(action)) {
⋮----
facilityService.updateFacilityApprovalStatus(facilityId, newStatus, null);
log.info("시설 승인 완료 - ID: {}", facilityId);
} else if ("reject".equals(action)) {
⋮----
facilityService.updateFacilityApprovalStatus(facilityId, newStatus, reason);
log.info("시설 승인 거부 - ID: {}, 사유: {}", facilityId, reason);
⋮----
log.error("시설 승인 처리 중 오류 발생 - ID: {}", facilityId, e);
⋮----
public String memberManagement(@RequestParam(defaultValue = "ALL") String role,
⋮----
List<MemberDTO> members = memberService.getMembersByRole(role, page, 20);
int totalCount = memberService.getMemberCountByRole(role);
int totalPages = (int) Math.ceil((double) totalCount / 20);
model.addAttribute("members", members);
model.addAttribute("currentRole", role);
model.addAttribute("currentPage", page);
model.addAttribute("totalPages", totalPages);
model.addAttribute("totalCount", totalCount);
log.info("회원 관리 페이지 접근 - 역할: {}, 페이지: {}, 총 개수: {}", role, page, totalCount);
⋮----
log.error("회원 목록 조회 중 오류 발생", e);
redirectAttributes.addFlashAttribute("errorMessage", "회원 목록을 불러오는 중 오류가 발생했습니다.");
⋮----
public String toggleMemberActive(@PathVariable Long memberId, HttpSession session) {
⋮----
boolean result = memberService.toggleMemberActive(memberId);
log.info("회원 활성화 상태 변경 - ID: {}, 결과: {}", memberId, result);
⋮----
log.error("회원 활성화 상태 변경 중 오류 발생 - ID: {}", memberId, e);
⋮----
public FacilityDTO getFacilityDetail(@PathVariable Long facilityId, HttpSession session) {
⋮----
return facilityService.getFacilityById(facilityId);
⋮----
log.error("시설 상세 정보 조회 중 오류 발생 - ID: {}", facilityId, e);
⋮----
public String statistics(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
⋮----
model.addAttribute("totalMembers", memberService.getTotalMemberCount());
model.addAttribute("facilityMembers", memberService.getFacilityMemberCount());
model.addAttribute("approvedFacilities", facilityService.countApprovedFacilities());
model.addAttribute("pendingFacilities", facilityService.countPendingFacilities());
model.addAttribute("rejectedFacilities", facilityService.countRejectedFacilities());
log.info("관리자 통계 페이지 접근");
⋮----
log.error("통계 데이터 조회 중 오류 발생", e);
redirectAttributes.addFlashAttribute("errorMessage", "통계 데이터를 불러오는 중 오류가 발생했습니다.");
`````

## File: src/main/java/com/example/carelink/dto/JobDTO.java
`````java
public class JobDTO extends BaseDTO {
`````

## File: src/main/java/com/example/carelink/dto/ReviewDTO.java
`````java
public class ReviewDTO extends BaseDTO {
`````

## File: src/main/java/com/example/carelink/CarelinkApplication.java
`````java
public class CarelinkApplication {
public static void main(String[] args) {
SpringApplication.run(CarelinkApplication.class, args);
System.out.println("========================================");
System.out.println("    요양원 구인구직 사이트 시작됨!        ");
System.out.println("    포트: http://localhost:8080         ");
`````

## File: src/main/resources/mapper/jobMapper.xml
`````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.JobMapper">
    <resultMap id="jobResultMap" type="com.example.carelink.dto.JobDTO">
        <id property="jobId" column="job_id"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="jobType" column="job_type"/>
        <result property="workType" column="work_type"/>
        <result property="position" column="position"/>
        <result property="recruitCount" column="recruit_count"/>
        <result property="salaryType" column="salary_type"/>
        <result property="salaryMin" column="salary_min"/>
        <result property="salaryMax" column="salary_max"/>
        <result property="salaryDescription" column="salary_description"/>
        <result property="workLocation" column="work_location"/>
        <result property="workHours" column="work_hours"/>
        <result property="experience" column="experience"/>
        <result property="education" column="education"/>
        <result property="qualifications" column="qualifications"/>
        <result property="benefits" column="benefits"/>
        <result property="startDate" column="start_date"/>
        <result property="endDate" column="end_date"/>
        <result property="contactName" column="contact_name"/>
        <result property="contactPhone" column="contact_phone"/>
        <result property="contactEmail" column="contact_email"/>
        <result property="status" column="status"/>
        <result property="viewCount" column="view_count"/>
        <result property="applyCount" column="apply_count"/>
        <result property="memberId" column="member_id"/>
        <result property="memberName" column="member_name"/>
        <result property="facilityId" column="facility_id"/>
        <result property="facilityName" column="facility_name"/>
        <result property="attachmentPath" column="attachment_path"/>
        <result property="attachmentName" column="attachment_name"/>
        <result property="priority" column="priority"/>
        <result property="isHighlight" column="is_highlight"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="isDeleted" column="is_deleted"/>
    </resultMap>
    <select id="findJobsWithSearch" parameterType="com.example.carelink.dto.JobDTO" resultMap="jobResultMap">
        SELECT
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.is_deleted = false
        <if test="searchKeyword != null and searchKeyword != ''">
            AND (j.title LIKE CONCAT('%', #{searchKeyword}, '%')
                 OR j.content LIKE CONCAT('%', #{searchKeyword}, '%')
                 OR j.position LIKE CONCAT('%', #{searchKeyword}, '%'))
        </if>
        <if test="searchJobType != null and searchJobType != ''">
            AND j.job_type = #{searchJobType}
        </if>
        <if test="searchWorkType != null and searchWorkType != ''">
            AND j.work_type = #{searchWorkType}
        </if>
        <if test="searchLocation != null and searchLocation != ''">
            AND j.work_location LIKE CONCAT('%', #{searchLocation}, '%')
        </if>
        <if test="searchPosition != null and searchPosition != ''">
            AND j.position LIKE CONCAT('%', #{searchPosition}, '%')
        </if>
        ORDER BY j.priority DESC, j.created_at DESC
        <if test="size != null and size > 0">
            LIMIT #{size}
        </if>
        <if test="offset != null and offset >= 0">
            OFFSET #{offset}
        </if>
    </select>
    <select id="countJobsWithSearch" parameterType="com.example.carelink.dto.JobDTO" resultType="int">
        SELECT COUNT(*)
        FROM job_posting j
        WHERE j.is_deleted = false
        <if test="searchKeyword != null and searchKeyword != ''">
            AND (j.title LIKE CONCAT('%', #{searchKeyword}, '%')
                 OR j.content LIKE CONCAT('%', #{searchKeyword}, '%')
                 OR j.position LIKE CONCAT('%', #{searchKeyword}, '%'))
        </if>
        <if test="searchJobType != null and searchJobType != ''">
            AND j.job_type = #{searchJobType}
        </if>
        <if test="searchWorkType != null and searchWorkType != ''">
            AND j.work_type = #{searchWorkType}
        </if>
        <if test="searchLocation != null and searchLocation != ''">
            AND j.work_location LIKE CONCAT('%', #{searchLocation}, '%')
        </if>
        <if test="searchPosition != null and searchPosition != ''">
            AND j.position LIKE CONCAT('%', #{searchPosition}, '%')
        </if>
    </select>
    <select id="findJobById" parameterType="long" resultMap="jobResultMap">
        SELECT
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.job_id = #{jobId} AND j.is_deleted = false
    </select>
    <insert id="insertJob" parameterType="com.example.carelink.dto.JobDTO" useGeneratedKeys="true" keyProperty="jobId">
        INSERT INTO job_posting (
            title, content, job_type, work_type, position, recruit_count,
            salary_type, salary_min, salary_max, salary_description,
            work_location, work_hours, experience, education, qualifications, benefits,
            start_date, end_date, contact_name, contact_phone, contact_email,
            status, member_id, facility_id, attachment_path, attachment_name,
            priority, is_highlight, created_at
        ) VALUES (
            #{title}, #{content}, #{jobType}, #{workType}, #{position}, #{recruitCount},
            #{salaryType}, #{salaryMin}, #{salaryMax}, #{salaryDescription},
            #{workLocation}, #{workHours}, #{experience}, #{education}, #{qualifications}, #{benefits},
            #{startDate}, #{endDate}, #{contactName}, #{contactPhone}, #{contactEmail},
            #{status}, #{memberId}, #{facilityId}, #{attachmentPath}, #{attachmentName},
            #{priority}, #{isHighlight}, NOW()
        )
    </insert>
    <update id="updateJob" parameterType="com.example.carelink.dto.JobDTO">
        UPDATE job_posting SET
            title = #{title},
            content = #{content},
            job_type = #{jobType},
            work_type = #{workType},
            position = #{position},
            recruit_count = #{recruitCount},
            salary_type = #{salaryType},
            salary_min = #{salaryMin},
            salary_max = #{salaryMax},
            salary_description = #{salaryDescription},
            work_location = #{workLocation},
            work_hours = #{workHours},
            experience = #{experience},
            education = #{education},
            qualifications = #{qualifications},
            benefits = #{benefits},
            start_date = #{startDate},
            end_date = #{endDate},
            contact_name = #{contactName},
            contact_phone = #{contactPhone},
            contact_email = #{contactEmail},
            status = #{status},
            facility_id = #{facilityId},
            attachment_path = #{attachmentPath},
            attachment_name = #{attachmentName},
            priority = #{priority},
            is_highlight = #{isHighlight},
            updated_at = NOW()
        WHERE job_id = #{jobId}
    </update>
    <update id="deleteJob" parameterType="long">
        UPDATE job_posting SET
            is_deleted = true,
            updated_at = NOW()
        WHERE job_id = #{jobId}
    </update>
    <update id="incrementViewCount" parameterType="long">
        UPDATE job_posting SET
            view_count = view_count + 1,
            updated_at = NOW()
        WHERE job_id = #{jobId}
    </update>
    <update id="incrementApplyCount" parameterType="long">
        UPDATE job_posting SET
            apply_count = apply_count + 1,
            updated_at = NOW()
        WHERE job_id = #{jobId}
    </update>
    <select id="findJobsByMemberId" parameterType="long" resultMap="jobResultMap">
        SELECT
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.member_id = #{memberId} AND j.is_deleted = false
        ORDER BY j.created_at DESC
    </select>
    <select id="findJobsByFacilityId" parameterType="long" resultMap="jobResultMap">
        SELECT
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.facility_id = #{facilityId} AND j.is_deleted = false
        ORDER BY j.created_at DESC
    </select>
    <select id="getJobList" parameterType="com.example.carelink.dto.JobDTO" resultMap="jobResultMap">
        SELECT
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.is_deleted = false
        ORDER BY j.priority DESC, j.created_at DESC
        <if test="size != null and size > 0">
            LIMIT #{size}
        </if>
        <if test="page != null and page >= 0">
            OFFSET #{page}
        </if>
    </select>
    <select id="getJobById" parameterType="long" resultMap="jobResultMap">
        SELECT
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.job_id = #{jobId} AND j.is_deleted = false
    </select>
    <select id="getPopularJobs" resultMap="jobResultMap">
        SELECT
            j.*,
            m.name as member_name,
            f.facility_name
        FROM job_posting j
        LEFT JOIN member m ON j.member_id = m.member_id
        LEFT JOIN facility f ON j.facility_id = f.facility_id
        WHERE j.is_deleted = false AND j.status = 'ACTIVE'
        ORDER BY j.view_count DESC, j.apply_count DESC
        LIMIT 10
    </select>
    <select id="getJobCount" resultType="int">
        SELECT COUNT(*)
        FROM job_posting
        WHERE is_deleted = false AND status = 'ACTIVE'
    </select>
    <delete id="deleteByMemberId" parameterType="long">
        DELETE FROM job_posting WHERE member_id = #{memberId}
    </delete>
    <delete id="deleteByFacilityMemberId" parameterType="long">
        DELETE FROM job_posting
        WHERE facility_id IN (
            SELECT facility_id FROM facility WHERE registered_member_id = #{memberId}
        )
    </delete>
</mapper>
`````

## File: src/main/resources/static/css/advanced-image-cropper.css
`````css
.advanced-image-cropper {
.steps-indicator {
.step-item {
.step-circle {
.step-item.active .step-circle {
.step-item.completed .step-circle {
.step-label {
.step-item.active .step-label {
.step-item.completed .step-label {
.step-connector {
.step-item.completed + .step-connector {
.cropper-center {
.cropper-center:before,
.cropper-line {
.cropper-dashed {
.cropper-point {
.cropper-point.point-se {
.upload-area {
.upload-area::before {
.upload-area:hover {
.upload-area:hover::before {
.upload-area.drag-over {
.upload-content {
.upload-icon {
.upload-icon i {
⋮----
.upload-title {
.upload-description {
.upload-format-info {
/* 크롭 영역 */
.crop-container {
.crop-image-container {
.crop-controls {
.crop-preview-panel {
/* 프로필 미리보기 */
.profile-preview {
.profile-card {
.profile-card:hover {
/* 시설 카드 미리보기 */
.facility-card-preview .card {
.facility-card-preview .card:hover {
.card-img-container {
/* 줌 표시기 */
.zoom-indicator {
⋮----
/* 이미지 정보 패널 */
.image-info-panel {
/* 최종 미리보기 */
.final-preview {
.final-image-container {
.final-image {
/* 압축 설정 */
.compression-settings {
.compression-info {
.compression-savings {
⋮----
/* Alt 텍스트 섹션 */
.alt-text-section {
.alt-text-section .form-label {
/* 슬라이더 스타일 */
.form-range {
.form-range::-webkit-slider-track {
.form-range::-webkit-slider-thumb {
.form-range::-webkit-slider-thumb:hover {
.form-range::-moz-range-track {
.form-range::-moz-range-thumb {
/* 진행률 영역 */
.progress-area {
.progress {
.progress-bar {
.progress-text {
/* 버튼 스타일 */
.btn {
.btn::before {
.btn:hover::before {
.btn-lg {
.btn-primary {
.btn-primary:hover {
.btn-success {
.btn-success:hover {
.btn-outline-secondary:hover {
.btn-outline-danger:hover {
/* 액션 버튼 그룹 */
.crop-actions, .final-actions {
/* 에러 메시지 */
.error-message {
⋮----
/* 반응형 디자인 */
⋮----
.crop-container, .crop-preview-panel, .compression-settings {
.crop-actions .d-flex, .final-actions .d-flex {
⋮----
.crop-controls .btn-group {
.crop-controls .btn {
⋮----
/* 다크 모드 지원 */
⋮----
.crop-container, .crop-preview-panel, .compression-settings, .final-preview {
.image-info-panel, .compression-info {
⋮----
/* 포커스 상태 */
.btn:focus,
/* 로딩 상태 */
.loading {
.loading::after {
⋮----
.cropper-container {
.cropper-container img {
.cropper-wrap-box,
.cropper-view-box {
`````

## File: src/main/resources/static/js/common.js
`````javascript
$(document).ready(function() {
initCommonFeatures();
autoHideAlerts();
initFormValidation();
initFileUpload();
initLoadingState();
refreshBoardList();
⋮----
function initCommonFeatures() {
var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
return new bootstrap.Tooltip(tooltipTriggerEl);
⋮----
var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
return new bootstrap.Popover(popoverTriggerEl);
⋮----
function autoHideAlerts() {
$('.alert').each(function() {
var alert = $(this);
if (!alert.hasClass('alert-permanent')) {
setTimeout(function() {
alert.fadeOut('slow');
⋮----
function initFormValidation() {
$('form').each(function() {
$(this).addClass('needs-validation');
⋮----
$('.form-control').on('blur', function() {
validateField($(this));
⋮----
$('form').on('submit', function(e) {
var form = $(this);
⋮----
form.find('.form-control[required]').each(function() {
if (!validateField($(this))) {
⋮----
e.preventDefault();
e.stopPropagation();
⋮----
form.addClass('was-validated');
⋮----
function validateField(field) {
var value = field.val().trim();
⋮----
// 필수 입력 검사
if (field.prop('required') && value === '') {
⋮----
// 이메일 형식 검사
if (field.attr('type') === 'email' && value !== '') {
⋮----
if (!emailRegex.test(value)) {
⋮----
// 전화번호 형식 검사
if (field.hasClass('phone-field') && value !== '') {
⋮----
if (!phoneRegex.test(value)) {
⋮----
// 결과 표시
⋮----
field.removeClass('is-invalid').addClass('is-valid');
field.siblings('.invalid-feedback').hide();
⋮----
field.removeClass('is-valid').addClass('is-invalid');
field.siblings('.invalid-feedback').text(errorMessage).show();
⋮----
function initFileUpload() {
$('.file-upload-area').on('dragover', function(e) {
⋮----
$(this).addClass('dragover');
⋮----
$('.file-upload-area').on('dragleave', function(e) {
⋮----
$(this).removeClass('dragover');
⋮----
$('.file-upload-area').on('drop', function(e) {
⋮----
handleFileSelect(files, $(this));
⋮----
$('.file-upload-area input[type="file"]').on('change', function() {
⋮----
handleFileSelect(files, $(this).closest('.file-upload-area'));
⋮----
function handleFileSelect(files, uploadArea) {
⋮----
showAlert('파일 크기는 10MB를 초과할 수 없습니다.', 'warning');
⋮----
if (file.type.startsWith('image/')) {
var reader = new FileReader();
⋮----
var preview = $('<img>').attr('src', e.target.result)
.css({'max-width': '200px', 'max-height': '200px', 'margin': '10px'});
uploadArea.find('.file-preview').html(preview);
⋮----
reader.readAsDataURL(file);
⋮----
var fileInfo = $('<div class="file-info mt-2"></div>')
.html('<i class="fas fa-file me-2"></i>' + file.name + ' (' + formatFileSize(file.size) + ')');
uploadArea.find('.file-list').append(fileInfo);
⋮----
function initLoadingState() {
$('form').on('submit', function() {
var submitBtn = $(this).find('button[type="submit"]');
var originalText = submitBtn.html();
submitBtn.prop('disabled', true)
.html('<span class="loading-spinner me-2"></span>처리중...');
⋮----
submitBtn.prop('disabled', false).html(originalText);
⋮----
$(document).ajaxStart(function() {
showLoading();
}).ajaxStop(function() {
hideLoading();
⋮----
function showLoading() {
if ($('#loadingOverlay').length === 0) {
var overlay = $('<div id="loadingOverlay" class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center" style="background-color: rgba(0,0,0,0.5); z-index: 9999;"></div>');
var spinner = $('<div class="text-center text-white"></div>')
.html('<div class="spinner-border mb-3" role="status"></div><br>로딩중...');
overlay.append(spinner);
$('body').append(overlay);
⋮----
function hideLoading() {
$('#loadingOverlay').remove();
⋮----
function showAlert(message, type = 'info', autoHide = true) {
⋮----
var alert = $('<div class="alert alert-dismissible fade show" role="alert"></div>')
.addClass(alertClass)
.html('<i class="fas ' + iconClass + ' me-2"></i>' + message +
⋮----
$('.container').first().prepend(alert);
⋮----
alert.fadeOut('slow', function() {
$(this).remove();
⋮----
function showConfirm(message, callback) {
if (confirm(message)) {
⋮----
callback();
⋮----
function ajaxRequest(url, method, data, successCallback, errorCallback) {
$.ajax({
⋮----
successCallback(response);
⋮----
console.error('AJAX 요청 실패:', error);
showAlert('요청 처리 중 오류가 발생했습니다.', 'danger');
⋮----
errorCallback(xhr, status, error);
⋮----
function handlePagination(currentPage, totalPages, baseUrl) {
var pagination = $('.pagination');
pagination.empty();
⋮----
pagination.append('<li class="page-item"><a class="page-link" href="' + baseUrl + '?page=' + (currentPage - 1) + '">&laquo;</a></li>');
⋮----
var startPage = Math.max(1, currentPage - 2);
var endPage = Math.min(totalPages, currentPage + 2);
⋮----
pagination.append('<li class="page-item' + activeClass + '"><a class="page-link" href="' + baseUrl + '?page=' + i + '">' + i + '</a></li>');
⋮----
// 다음 버튼
⋮----
pagination.append('<li class="page-item"><a class="page-link" href="' + baseUrl + '?page=' + (currentPage + 1) + '">&raquo;</a></li>');
⋮----
/**
 * 파일 크기 포맷팅
 */
function formatFileSize(bytes) {
⋮----
var i = Math.floor(Math.log(bytes) / Math.log(k));
return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
⋮----
function formatDate(date, format = 'YYYY-MM-DD') {
⋮----
var d = new Date(date);
var year = d.getFullYear();
var month = String(d.getMonth() + 1).padStart(2, '0');
var day = String(d.getDate()).padStart(2, '0');
var hour = String(d.getHours()).padStart(2, '0');
var minute = String(d.getMinutes()).padStart(2, '0');
⋮----
.replace('YYYY', year)
.replace('MM', month)
.replace('DD', day)
.replace('HH', hour)
.replace('mm', minute);
⋮----
function truncateString(str, length) {
⋮----
return str.length > length ? str.substring(0, length) + '...' : str;
⋮----
/**
 * 숫자 포맷팅 (콤마 추가)
 */
function formatNumber(num) {
return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
⋮----
/**
 * URL 파라미터 가져오기
 */
function getUrlParameter(name) {
var url = new URL(window.location.href);
return url.searchParams.get(name);
⋮----
/**
 * 페이지 새로고침 강제 (캐시 무효화)
 */
function forceRefresh() {
// 브라우저 캐시를 무시하고 강제 새로고침
window.location.reload(true);
⋮----
/**
 * 게시글 삭제 후 목록 새로고침
 */
function refreshBoardList() {
// refresh 파라미터가 있으면 캐시 무효화 후 URL에서 제거
var refreshParam = getUrlParameter('refresh');
⋮----
url.searchParams.delete('refresh');
window.history.replaceState({}, document.title, url.pathname + url.search);
⋮----
forceRefresh();
⋮----
localStorage.setItem(key, JSON.stringify(value));
⋮----
var item = localStorage.getItem(key);
return item ? JSON.parse(item) : null;
⋮----
localStorage.removeItem(key);
⋮----
localStorage.clear();
`````

## File: src/main/resources/static/js/facility-manage.js
`````javascript
function deleteFacility() {
⋮----
alert('시설 정보를 찾을 수 없습니다.');
⋮----
if (confirm('정말로 시설을 삭제하시겠습니까?\n삭제된 시설 정보는 복구할 수 없습니다.')) {
const form = document.createElement('form');
⋮----
const csrfToken = document.querySelector('meta[name="_csrf"]');
const csrfHeader = document.querySelector('meta[name="_csrf_header"]');
⋮----
const hiddenField = document.createElement('input');
⋮----
hiddenField.name = csrfToken.getAttribute('content');
hiddenField.value = csrfHeader.getAttribute('content');
form.appendChild(hiddenField);
⋮----
document.body.appendChild(form);
form.submit();
⋮----
document.addEventListener('DOMContentLoaded', function() {
const facilityImages = document.querySelectorAll('img[alt="시설 사진"], .facility-detail-image');
facilityImages.forEach(function(facilityImage) {
if (facilityImage && !facilityImage.classList.contains('error-handler-attached')) {
facilityImage.classList.add('error-handler-attached');
⋮----
if (this.classList.contains('error-handled')) {
⋮----
this.classList.add('error-handled');
⋮----
const placeholder = document.createElement('div');
⋮----
this.parentNode.replaceChild(placeholder, this);
console.log('✅ 시설 이미지 에러 처리 완료 (무한 요청 방지)');
⋮----
const externalLinks = document.querySelectorAll('a[target="_blank"]');
externalLinks.forEach(link => {
`````

## File: src/main/resources/static/js/job-edit.js
`````javascript
document.addEventListener('DOMContentLoaded', function() {
console.log('구인구직 수정 페이지 JavaScript 로드됨');
⋮----
console.log('이미 초기화됨 - 중복 초기화 방지');
⋮----
initFormValidation();
initCancelButton();
initInputFieldHandlers();
initSafeRichTextEditor();
⋮----
console.log('폼 초기화 완료');
⋮----
function initFormValidation() {
const form = document.querySelector('form');
⋮----
const newForm = form.cloneNode(true);
form.parentNode.replaceChild(newForm, form);
newForm.addEventListener('submit', function(e) {
console.log('폼 제출 시작 - 검증 중...');
⋮----
console.log('이미 제출 중 - 중복 제출 방지');
e.preventDefault();
⋮----
cleanFormValues();
if (!validateForm()) {
console.log('폼 검증 실패 - 제출 중단');
⋮----
const submitBtn = newForm.querySelector('button[type="submit"]');
⋮----
console.log('폼 검증 성공 - 제출 계속');
⋮----
function cleanFormValues() {
console.log('폼 값 정리 시작');
const salaryDescription = document.querySelector('[name="salaryDescription"]');
⋮----
const cleanValue = salaryDescription.value.trim();
const uniqueValues = [...new Set(cleanValue.split(',').map(v => v.trim()).filter(v => v))];
salaryDescription.value = uniqueValues.join(', ');
console.log('급여 설명 정리됨:', salaryDescription.value);
⋮----
const workHours = document.querySelector('[name="workHours"]');
⋮----
const cleanValue = workHours.value.trim();
⋮----
workHours.value = uniqueValues.join(', ');
console.log('근무시간 정리됨:', workHours.value);
⋮----
textFields.forEach(fieldName => {
const field = document.querySelector(`[name="${fieldName}"]`);
⋮----
field.value = field.value.trim();
⋮----
console.log('폼 값 정리 완료');
⋮----
function validateForm() {
const jobTypeInput = document.querySelector('[name="jobType"]');
⋮----
console.log('검증 시작 - jobType:', jobType);
// 공통 필수 필드 검사
const title = document.querySelector('[name="title"]')?.value?.trim() || '';
const content = document.querySelector('[name="content"]')?.value?.trim() || '';
const workType = document.querySelector('[name="workType"]')?.value || '';
const status = document.querySelector('[name="status"]')?.value || '';
⋮----
alert('제목을 입력해주세요.');
document.querySelector('[name="title"]')?.focus();
⋮----
alert('내용을 입력해주세요.');
document.querySelector('[name="content"]')?.focus();
⋮----
alert('고용형태를 선택해주세요.');
document.querySelector('[name="workType"]')?.focus();
⋮----
alert('게시글 상태를 선택해주세요.');
document.querySelector('[name="status"]')?.focus();
⋮----
// 구인글 전용 필수 필드 검사
⋮----
console.log('구인글 검증 중...');
const facilityName = document.querySelector('[name="facilityName"]')?.value?.trim() || '';
const position = document.querySelector('[name="position"]')?.value || '';
⋮----
alert('회사명을 입력해주세요.');
document.querySelector('[name="facilityName"]')?.focus();
⋮----
alert('직종을 선택해주세요.');
document.querySelector('[name="position"]')?.focus();
⋮----
// 구직글 전용 필수 필드 검사
⋮----
console.log('구직글 검증 중...');
const workLocation = document.querySelector('[name="workLocation"]')?.value?.trim() || '';
const contactPhone = document.querySelector('[name="contactPhone"]')?.value?.trim() || '';
⋮----
alert('희망 근무지를 입력해주세요.');
document.querySelector('[name="workLocation"]')?.focus();
⋮----
alert('연락처를 입력해주세요.');
document.querySelector('[name="contactPhone"]')?.focus();
⋮----
// 제목 길이 검사
⋮----
alert('제목은 100자 이하로 입력해주세요.');
⋮----
// 내용 길이 검사
⋮----
alert('내용은 2000자 이하로 입력해주세요.');
⋮----
console.log('모든 검증 통과');
⋮----
/**
 * 입력 필드 이벤트 핸들러 초기화
 */
function initInputFieldHandlers() {
// 급여 입력 필드 핸들러
const salaryInputs = document.querySelectorAll('[name="salaryMin"], [name="salaryMax"]');
salaryInputs.forEach(input => {
⋮----
input.removeEventListener('blur', handleSalaryFormat);
input.addEventListener('blur', handleSalaryFormat);
⋮----
const textInputs = document.querySelectorAll('[name="salaryDescription"], [name="workHours"]');
textInputs.forEach(input => {
⋮----
input.removeEventListener('blur', handleTextFieldClean);
input.addEventListener('blur', handleTextFieldClean);
⋮----
function handleSalaryFormat(event) {
⋮----
let value = input.value.replace(/,/g, '');
if (value && !isNaN(value)) {
input.value = Number(value).toLocaleString();
⋮----
/**
 * 텍스트 필드 정리 핸들러 (중복 제거)
 */
function handleTextFieldClean(event) {
⋮----
const cleanValue = input.value.trim();
// 중복된 값 제거 (콤마로 분리된 경우)
⋮----
input.value = uniqueValues.join(', ');
⋮----
/**
 * 리치 텍스트 에디터 안전 초기화
 */
function initSafeRichTextEditor() {
const contentTextarea = document.getElementById('contentTextarea');
if (contentTextarea && contentTextarea.hasAttribute('data-rich-editor')) {
⋮----
window.richTextEditorInstance.destroy();
console.log('기존 리치 텍스트 에디터 제거됨');
⋮----
console.log('에디터 제거 중 오류 (무시):', e.message);
⋮----
setTimeout(() => {
⋮----
window.richTextEditorInstance = new window.RichTextEditorV2(contentTextarea);
console.log('리치 텍스트 에디터 안전 초기화 완료');
⋮----
console.log('에디터 초기화 오류:', e.message);
⋮----
function initCancelButton() {
const cancelBtn = document.querySelector('.btn-secondary');
⋮----
cancelBtn.addEventListener('click', function(e) {
if (confirm('수정을 취소하시겠습니까?\n변경사항이 저장되지 않습니다.')) {
`````

## File: src/main/resources/static/js/myinfo.js
`````javascript
document.addEventListener('DOMContentLoaded', function() {
⋮----
form: document.getElementById('mypageForm'),
phone: document.getElementById('phone'),
name: document.getElementById('name'),
email: document.getElementById('email')
⋮----
setupPhoneFormatting();
setupFormValidation();
console.log('내정보수정 페이지 JavaScript 초기화 완료 (단순화)');
function setupPhoneFormatting() {
⋮----
elements.phone.addEventListener('input', function(event) {
autoFormatPhone(event.target);
⋮----
elements.phone.addEventListener('paste', function(event) {
setTimeout(() => autoFormatPhone(event.target), 10);
⋮----
function autoFormatPhone(input) {
⋮----
const numbersBeforeCursor = oldValue.substring(0, cursorPos).replace(/[^\d]/g, '').length;
// 숫자만 추출
const numbers = input.value.replace(/[^\d]/g, '');
// 최대 11자리 제한
const limitedNumbers = numbers.substring(0, 11);
// 포맷팅 적용
let formatted = formatPhoneNumber(limitedNumbers);
// 값 업데이트
⋮----
// 새로운 커서 위치 계산
⋮----
if (/\d/.test(formatted[i])) {
⋮----
// 숫자가 추가된 경우 마지막 숫자 뒤로 커서 이동
⋮----
// 커서가 하이픈 위에 있으면 다음 위치로 이동
⋮----
// 커서 위치 설정 (비동기적으로 처리)
setTimeout(() => {
input.setSelectionRange(newCursorPos, newCursorPos);
⋮----
// 휴대폰 번호 포맷팅 (010으로 시작하는 번호만)
function formatPhoneNumber(numbers) {
⋮----
// 휴대폰 번호만 허용 (010, 011, 016, 017, 018, 019)
if (numbers.startsWith('01')) {
⋮----
return numbers.substring(0, 3) + '-' + numbers.substring(3);
⋮----
return numbers.substring(0, 3) + '-' + numbers.substring(3, 7) + '-' + numbers.substring(7);
⋮----
return numbers.startsWith('0') ? numbers.substring(0, 1) : numbers;
⋮----
function setupFormValidation() {
⋮----
elements.form.addEventListener('submit', function(event) {
⋮----
if (elements.name && elements.name.value.trim().length < 2) {
⋮----
errors.push('이름은 2자 이상 입력해주세요.');
elements.name.classList.add('is-invalid');
⋮----
if (elements.email && elements.email.value.trim()) {
⋮----
if (!emailPattern.test(elements.email.value.trim())) {
⋮----
errors.push('올바른 이메일 형식이 아닙니다.');
elements.email.classList.add('is-invalid');
⋮----
if (elements.phone && elements.phone.value.trim()) {
⋮----
if (!phonePattern.test(elements.phone.value.trim())) {
⋮----
errors.push('올바른 휴대폰 번호 형식이 아닙니다.');
elements.phone.classList.add('is-invalid');
⋮----
event.preventDefault();
alert('입력 오류:\n' + errors.join('\n'));
⋮----
const submitButton = elements.form.querySelector('button[type="submit"]');
⋮----
[elements.name, elements.email, elements.phone].forEach(field => {
⋮----
field.addEventListener('focus', function() {
this.classList.remove('is-invalid');
`````

## File: src/main/resources/static/js/review-detail.js
`````javascript
document.addEventListener('DOMContentLoaded', function() {
console.log('리뷰 상세보기 페이지 JavaScript 로드됨');
currentReviewId = extractReviewIdFromUrl();
console.log('현재 리뷰 ID:', currentReviewId);
initializeEventListeners();
initializeImageModal();
⋮----
function extractReviewIdFromUrl() {
⋮----
const segments = path.split('/');
const detailIndex = segments.findIndex(segment => segment === 'detail');
⋮----
console.warn('URL에서 리뷰 ID를 찾을 수 없습니다:', path);
⋮----
function initializeEventListeners() {
const actionButtons = document.querySelectorAll('[data-action]');
actionButtons.forEach(button => {
const action = button.getAttribute('data-action');
console.log('이벤트 리스너 등록:', action);
⋮----
button.addEventListener('click', handleLikeReview);
⋮----
button.addEventListener('click', handleDeleteReview);
⋮----
button.addEventListener('click', handleShareReview);
⋮----
button.addEventListener('click', handleReportReview);
⋮----
console.warn('알 수 없는 액션:', action);
⋮----
console.log('이벤트 리스너 초기화 완료, 등록된 버튼 수:', actionButtons.length);
⋮----
function initializeImageModal() {
const modal = document.getElementById('imageModal');
const modalImage = document.getElementById('modalImage');
const reviewImages = document.querySelectorAll('.review-image');
const closeBtn = document.querySelector('.close-modal');
⋮----
console.log('이미지 모달 요소를 찾을 수 없음');
⋮----
reviewImages.forEach(img => {
⋮----
img.addEventListener('click', function() {
⋮----
closeBtn.addEventListener('click', function() {
⋮----
modal.addEventListener('click', function(e) {
⋮----
document.addEventListener('keydown', function(e) {
⋮----
console.log('이미지 모달 초기화 완료, 이미지 수:', reviewImages.length);
⋮----
function handleLikeReview(event) {
event.preventDefault();
event.stopPropagation();
⋮----
showAlert('error', '리뷰 정보를 찾을 수 없습니다.');
⋮----
console.log('추천 요청 시작:', currentReviewId);
const button = event.target.closest('button');
⋮----
fetch(`/review/like/${currentReviewId}`, {
⋮----
.then(response => {
console.log('추천 응답:', response.status);
return response.json();
⋮----
.then(data => {
console.log('추천 응답 데이터:', data);
⋮----
const likeCountElement = document.getElementById('likeCount');
⋮----
showAlert('success', data.message || '추천하였습니다.');
⋮----
showAlert('error', data.message || '추천 처리 중 오류가 발생했습니다.');
⋮----
.catch(error => {
console.error('추천 처리 오류:', error);
showAlert('error', '추천 처리 중 오류가 발생했습니다.');
⋮----
.finally(() => {
⋮----
function handleDeleteReview(event) {
⋮----
if (!confirm('정말 이 리뷰를 삭제하시겠습니까?\n삭제된 리뷰는 복구할 수 없습니다.')) {
⋮----
console.log('삭제 요청 시작:', currentReviewId);
⋮----
fetch(`/review/delete/${currentReviewId}`, {
⋮----
console.log('삭제 응답:', response.status);
⋮----
showAlert('success', '리뷰가 성공적으로 삭제되었습니다.');
setTimeout(() => {
⋮----
throw new Error('삭제 요청이 실패했습니다.');
⋮----
console.error('삭제 처리 오류:', error);
showAlert('error', '리뷰 삭제 중 오류가 발생했습니다.');
⋮----
function handleShareReview(event) {
⋮----
const reviewTitle = document.querySelector('h1, .card-title')?.textContent || '리뷰';
console.log('공유 요청:', { url: currentUrl, title: reviewTitle });
⋮----
navigator.share({
⋮----
}).then(() => {
console.log('공유 성공');
showAlert('success', '공유가 완료되었습니다.');
}).catch(error => {
console.log('공유 취소 또는 실패:', error);
⋮----
navigator.clipboard.writeText(currentUrl).then(() => {
showAlert('success', '링크가 클립보드에 복사되었습니다.');
⋮----
console.error('클립보드 복사 실패:', error);
fallbackCopyToClipboard(currentUrl);
⋮----
function fallbackCopyToClipboard(text) {
const textArea = document.createElement('textarea');
⋮----
document.body.appendChild(textArea);
textArea.focus();
textArea.select();
⋮----
const successful = document.execCommand('copy');
⋮----
showAlert('success', '링크가 복사되었습니다.');
⋮----
showAlert('error', '링크 복사에 실패했습니다.');
⋮----
console.error('클립보드 복사 실패:', err);
⋮----
document.body.removeChild(textArea);
⋮----
function handleReportReview(event) {
⋮----
const reportReason = prompt(
⋮----
if (!reportReason || reportReason.trim() === '') {
return; // 사용자가 취소하거나 빈 내용
⋮----
if (!confirm('이 리뷰를 신고하시겠습니까?')) {
⋮----
console.log('신고 요청:', { reviewId: currentReviewId, reason: reportReason });
// 버튼 비활성화
⋮----
fetch(`/review/report/${currentReviewId}`, {
⋮----
body: JSON.stringify({
reason: reportReason.trim()
⋮----
.then(response => response.json())
⋮----
console.log('신고 응답:', data);
⋮----
showAlert('success', data.message || '신고가 접수되었습니다. 검토 후 적절한 조치를 취하겠습니다.');
⋮----
showAlert('error', data.message || '신고 처리 중 오류가 발생했습니다.');
⋮----
console.error('신고 처리 오류:', error);
showAlert('error', '신고 처리 중 오류가 발생했습니다.');
⋮----
function showAlert(type, message) {
const existingAlert = document.querySelector('.dynamic-alert');
⋮----
existingAlert.remove();
⋮----
const alertDiv = document.createElement('div');
⋮----
document.body.appendChild(alertDiv);
⋮----
alertDiv.remove();
⋮----
console.log('알림 표시:', type, message);
`````

## File: src/main/resources/static/js/review-write.js
`````javascript
document.addEventListener('DOMContentLoaded', function() {
⋮----
// DOM 요소 선택
⋮----
form: document.getElementById('reviewForm'),
facilitySelect: document.getElementById('facilitySelect'),
facilityId: document.getElementById('facilityId'),
title: document.getElementById('title'),
content: document.getElementById('content'),
contentLength: document.getElementById('contentLength'),
overallRating: document.getElementById('overallRating'),
ratingValue: document.getElementById('ratingValue'),
ratingText: document.getElementById('ratingText'),
submitButton: document.getElementById('submitButton'),
detailedRatings: document.querySelectorAll('.detailed-rating')
⋮----
console.log('별점 관련 DOM 요소:', {
⋮----
elements.detailedRatings.forEach((container, index) => {
console.log(`세부 평점 컨테이너 ${index + 1}:`, {
⋮----
stars: container.querySelectorAll('.star').length,
ratingGroup: container.closest('.rating-group'),
inputElement: container.closest('.rating-group')?.querySelector('.detailed-rating-input')
⋮----
function updateStars(container, rating) {
⋮----
console.warn('별점 컨테이너가 없습니다.');
⋮----
console.log('별점 업데이트:', { container, rating });
const stars = container.querySelectorAll('.star');
stars.forEach((star, index) => {
⋮----
star.classList.add('active');
⋮----
star.classList.remove('active');
⋮----
elements.facilitySelect.addEventListener('change', function() {
⋮----
console.log('시설 선택:', { facilityId, status });
⋮----
alert('선택할 수 없는 시설입니다: ' + status);
⋮----
// 내용 길이 체크 및 표시
⋮----
elements.content.addEventListener('input', function() {
const length = this.value.trim().length;
⋮----
elements.contentLength.classList.remove('text-success');
elements.contentLength.classList.add('text-danger');
⋮----
elements.contentLength.classList.remove('text-danger');
elements.contentLength.classList.add('text-success');
⋮----
elements.content.dispatchEvent(new Event('input'));
⋮----
const stars = elements.overallRating.querySelectorAll('.star');
stars.forEach(star => {
star.addEventListener('click', function() {
const rating = parseInt(this.dataset.rating);
console.log('전체 평점 클릭:', { rating, target: this });
⋮----
updateStars(elements.overallRating, rating);
⋮----
console.log('전체 평점 업데이트 완료:', {
⋮----
star.addEventListener('mouseover', function() {
⋮----
star.addEventListener('mouseout', function() {
const rating = parseInt(elements.ratingValue.value) || 0;
⋮----
const initialRating = parseInt(elements.ratingValue.value);
if (!isNaN(initialRating) && initialRating >= 1 && initialRating <= 5) {
console.log('초기 평점 설정:', initialRating);
updateStars(elements.overallRating, initialRating);
⋮----
elements.detailedRatings.forEach(container => {
⋮----
const ratingGroup = container.closest('.rating-group');
const input = ratingGroup ? ratingGroup.querySelector('.detailed-rating-input') : null;
console.log('세부 평점 초기화:', {
⋮----
star.addEventListener('click', function(e) {
e.preventDefault();
e.stopPropagation();
⋮----
console.log('세부 평점 클릭:', {
⋮----
console.log('세부 평점 입력값 업데이트:', {
⋮----
console.error('세부 평점 input을 찾을 수 없습니다:', container.dataset.field);
⋮----
updateStars(container, rating);
⋮----
const rating = parseInt(input?.value) || 0;
⋮----
const initialRating = parseInt(input.value);
⋮----
console.log('초기 세부 평점 설정:', {
⋮----
updateStars(container, initialRating);
⋮----
elements.form.addEventListener('submit', function(e) {
⋮----
alert('시설을 선택해주세요.');
⋮----
elements.facilitySelect.focus();
⋮----
if (!elements.title.value.trim()) {
alert('제목을 입력해주세요.');
elements.title.focus();
⋮----
alert('전체 평점을 선택해주세요.');
elements.overallRating.scrollIntoView({ behavior: 'smooth' });
⋮----
const contentLength = elements.content.value.trim().length;
⋮----
alert(`내용을 ${MIN_CONTENT_LENGTH}자 이상 입력해주세요.`);
elements.content.focus();
⋮----
alert(`내용은 ${MAX_CONTENT_LENGTH}자를 초과할 수 없습니다.`);
⋮----
this.submit();
`````

## File: src/main/resources/static/js/rich-text-editor-v2.js
`````javascript
class RichTextEditorV2 {
⋮----
this.element = document.querySelector(selector);
⋮----
console.error('RichTextEditorV2: Element not found:', selector);
⋮----
this.init();
⋮----
init() {
this.createEditor();
this.bindEvents();
this.initializeContent();
this.setupAccessibility();
⋮----
createEditor() {
⋮----
this.container = document.createElement('div');
⋮----
this.container.setAttribute('role', 'textbox');
this.container.setAttribute('aria-label', '리치 텍스트 에디터');
⋮----
${this.generateToolbar()}
⋮----
this.element.parentNode.insertBefore(this.container, this.element.nextSibling);
this.toolbar = this.container.querySelector('.rte-toolbar');
this.content = this.container.querySelector('.rte-content');
this.statusbar = this.container.querySelector('.rte-statusbar');
⋮----
generateToolbar() {
⋮----
this.options.toolbar.forEach(tool => {
⋮----
toolbarGroups.push(currentGroup);
⋮----
currentGroup.push(tool);
⋮----
return toolbarGroups.map(group =>
⋮----
${group.map(tool => this.generateToolButton(tool)).join('')}
⋮----
).join('');
⋮----
generateToolButton(tool) {
⋮----
bindEvents() {
// 툴바 버튼 클릭 이벤트
this.toolbar.addEventListener('click', (e) => {
const button = e.target.closest('.rte-btn');
⋮----
e.preventDefault();
this.executeCommand(button.dataset.command);
⋮----
this.toolbar.addEventListener('change', (e) => {
if (e.target.classList.contains('rte-select')) {
this.executeCommand(e.target.dataset.command, e.target.value);
⋮----
this.toolbar.addEventListener('input', (e) => {
if (e.target.classList.contains('rte-color')) {
⋮----
this.content.addEventListener('input', () => {
this.updateOriginalTextarea();
this.updateStatusBar();
this.handlePlaceholder();
this.validateLength();
⋮----
this.content.addEventListener('focus', () => {
⋮----
this.content.addEventListener('blur', () => {
⋮----
this.content.addEventListener('keydown', (e) => {
this.handleKeyboardShortcuts(e);
⋮----
this.content.addEventListener('paste', (e) => {
this.handlePaste(e);
⋮----
executeCommand(command, value = null) {
this.content.focus();
⋮----
this.insertLink();
⋮----
this.insertTable();
⋮----
this.insertBlockquote();
⋮----
document.execCommand('fontSize', false, value);
⋮----
document.execCommand(command, false, value);
⋮----
insertLink() {
const selection = window.getSelection();
const selectedText = selection.toString().trim();
const url = prompt('링크 URL을 입력하세요:', 'https://');
⋮----
if (!this.isValidUrl(url)) {
alert('올바른 URL 형식이 아닙니다.');
⋮----
const linkText = selectedText || prompt('링크 텍스트를 입력하세요:', url);
⋮----
const cleanUrl = url.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
const cleanText = linkText.replace(/</g, '&lt;').replace(/>/g, '&gt;');
⋮----
this.insertHTML(link);
⋮----
insertTable() {
const rows = prompt('행 수를 입력하세요:', '3');
const cols = prompt('열 수를 입력하세요:', '3');
if (rows && cols && !isNaN(rows) && !isNaN(cols)) {
const numRows = Math.min(parseInt(rows), 20); // 최대 20행으로 제한
const numCols = Math.min(parseInt(cols), 10); // 최대 10열로 제한
⋮----
this.insertHTML(table);
⋮----
insertBlockquote() {
⋮----
const safeText = this.escapeHtml(selectedText);
⋮----
this.insertHTML(blockquote);
⋮----
insertHTML(html) {
if (document.queryCommandSupported('insertHTML')) {
document.execCommand('insertHTML', false, html);
⋮----
// IE 호환성을 위한 대안
⋮----
const range = selection.getRangeAt(0);
range.deleteContents();
const div = document.createElement('div');
⋮----
const frag = document.createDocumentFragment();
⋮----
frag.appendChild(div.firstChild);
⋮----
range.insertNode(frag);
⋮----
handleKeyboardShortcuts(e) {
⋮----
switch (e.key.toLowerCase()) {
⋮----
this.executeCommand('bold');
⋮----
this.executeCommand('italic');
⋮----
this.executeCommand('underline');
⋮----
this.executeCommand('redo');
⋮----
this.executeCommand('undo');
⋮----
handlePaste(e) {
⋮----
const pastedData = clipboardData.getData('text/plain');
// 텍스트만 허용하고 HTML 태그 제거 (보안 강화)
const cleanText = this.stripHtml(pastedData);
const safeText = this.escapeHtml(cleanText);
this.insertHTML(safeText);
⋮----
updateOriginalTextarea() {
// HTML 내용을 원본 textarea에 업데이트
⋮----
// 플레이스홀더 제거
⋮----
// change 이벤트 발생
const event = new Event('change', { bubbles: true });
this.element.dispatchEvent(event);
⋮----
updateStatusBar() {
⋮----
const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
const charCountElement = this.statusbar.querySelector('.rte-char-count');
const wordCountElement = this.statusbar.querySelector('.rte-word-count');
⋮----
// 글자 수 초과 시 경고 표시
⋮----
charCountElement.classList.add('text-danger');
⋮----
charCountElement.classList.remove('text-danger');
⋮----
handlePlaceholder() {
⋮----
const hasPlaceholder = this.content.querySelector('.rte-placeholder');
if (text.trim() === '' && !hasPlaceholder) {
⋮----
} else if (text.trim() !== '' && hasPlaceholder) {
hasPlaceholder.remove();
⋮----
validateLength() {
⋮----
// 글자 수 초과 시 내용 자르기
const truncatedText = text.substring(0, this.options.maxLength);
⋮----
// 커서를 마지막으로 이동
const range = document.createRange();
⋮----
range.selectNodeContents(this.content);
range.collapse(false);
selection.removeAllRanges();
selection.addRange(range);
// 경고 메시지 표시
this.showWarning(`최대 ${this.options.maxLength}자까지 입력 가능합니다.`);
⋮----
setupAccessibility() {
// 에디터에 ARIA 속성 추가
this.content.setAttribute('aria-label', '리치 텍스트 에디터 내용 영역');
this.content.setAttribute('aria-describedby', 'rte-help-text');
// 도움말 텍스트 추가
const helpText = document.createElement('div');
⋮----
this.container.appendChild(helpText);
⋮----
initializeContent() {
⋮----
// 기존 값이 있으면 에디터에 설정
const safeContent = this.sanitizeContent(this.element.value);
⋮----
// 보안 관련 유틸리티 메서드들
isValidUrl(url) {
⋮----
const urlObject = new URL(url);
return ['http:', 'https:', 'mailto:'].includes(urlObject.protocol);
⋮----
escapeHtml(text) {
⋮----
stripHtml(html) {
⋮----
sanitizeContent(content) {
// 허용된 태그만 남기고 나머지 제거
⋮----
// 허용되지 않은 태그 제거
const allElements = div.querySelectorAll('*');
allElements.forEach(el => {
if (!allowedTags.includes(el.tagName.toLowerCase())) {
el.remove();
} else if (el.tagName.toLowerCase() === 'a') {
// 링크 태그의 보안 속성 확인
const href = el.getAttribute('href');
if (href && !this.isValidUrl(href)) {
⋮----
// 안전한 링크 속성 설정
el.setAttribute('target', '_blank');
el.setAttribute('rel', 'noopener noreferrer');
⋮----
showWarning(message) {
// 간단한 경고 메시지 표시
const warning = document.createElement('div');
⋮----
document.body.appendChild(warning);
// 3초 후 자동 제거
setTimeout(() => {
⋮----
warning.remove();
⋮----
// 공개 API 메서드들
getContent() {
⋮----
setContent(html) {
const safeContent = this.sanitizeContent(html);
⋮----
getTextContent() {
⋮----
focus() {
⋮----
destroy() {
⋮----
this.container.remove();
⋮----
// 전역 사용을 위한 함수
⋮----
// 자동 초기화 (data-rich-editor 속성이 있는 textarea들에 대해)
document.addEventListener('DOMContentLoaded', () => {
const textareas = document.querySelectorAll('textarea[data-rich-editor]');
textareas.forEach(textarea => {
⋮----
const options = textarea.dataset.richEditor ? JSON.parse(textarea.dataset.richEditor) : {};
// 이미지 업로드 기능 강제 비활성화
⋮----
// 최대 길이 설정
⋮----
new RichTextEditorV2(`#${textarea.id}`, options);
⋮----
console.error('RichTextEditorV2 초기화 실패:', error);
⋮----
console.log('✅ RichTextEditorV2 로드 완료 - 보안 강화 버전');
`````

## File: src/main/resources/static/js/smart-scroll-utility.js
`````javascript
class SmartScrollUtility {
⋮----
this.init();
⋮----
init() {
⋮----
console.error('❌ SmartScrollUtility: cropper 객체가 필요합니다.');
⋮----
this.findContainer();
this.findZoomElements();
this.setupEventListener();
console.log('🖱️ SmartScrollUtility 초기화 완료');
console.log('📊 설정:', this.options);
⋮----
findContainer() {
⋮----
const element = document.querySelector(selector);
⋮----
this.container = element.closest('.crop-image-container') ||
⋮----
console.warn('⚠️ SmartScrollUtility: 크롭 컨테이너를 찾을 수 없습니다.');
⋮----
findZoomElements() {
this.elements.zoomIndicator = document.getElementById('zoomIndicator');
this.elements.zoomLevel = document.getElementById('zoomLevel');
this.elements.zoomStatus = document.getElementById('zoomStatus');
⋮----
console.log('💡 SmartScrollUtility: 줌 표시기가 없어 동적으로 생성합니다.');
this.createZoomIndicator();
⋮----
createZoomIndicator() {
const indicator = document.createElement('div');
⋮----
document.body.appendChild(indicator);
⋮----
console.log('✅ 줌 표시기 동적 생성 완료');
⋮----
setupEventListener() {
⋮----
console.error('❌ SmartScrollUtility: 컨테이너가 없어 이벤트를 등록할 수 없습니다.');
⋮----
this.container.removeEventListener('wheel', this.handleWheel.bind(this));
this.container.addEventListener('wheel', this.handleWheel.bind(this), {
⋮----
console.log('🔧 휠 이벤트 리스너 등록 완료:', this.container);
⋮----
handleWheel(event) {
⋮----
const canvasData = this.cropper.getCanvasData();
⋮----
console.log(`🔍 줌 상태: ${currentZoom.toFixed(2)} (${isZoomingIn ? '확대' : '축소'})`);
⋮----
this.updateZoomIndicator(currentZoom, '최대 확대');
this.scrollPage(event.deltaY * this.options.scrollMultiplier);
console.log('📈 최대 확대 -> 페이지 스크롤');
⋮----
this.updateZoomIndicator(currentZoom, '최소 축소');
⋮----
console.log('📉 최소 축소 -> 페이지 스크롤');
⋮----
event.preventDefault();
event.stopPropagation();
⋮----
this.cropper.zoom(zoomDelta);
const newZoom = Math.max(
⋮----
Math.min(this.options.maxZoom, currentZoom + zoomDelta)
⋮----
this.updateZoomIndicator(newZoom, isZoomingIn ? '확대' : '축소');
⋮----
scrollPage(scrollAmount) {
window.scrollBy({
⋮----
updateZoomIndicator(zoomLevel, status) {
⋮----
const zoomPercent = Math.round(zoomLevel * 100);
⋮----
clearTimeout(this.zoomIndicatorTimeout);
this.zoomIndicatorTimeout = setTimeout(() => {
⋮----
updateOptions(newOptions) {
⋮----
console.log('🔧 SmartScrollUtility 설정 업데이트:', this.options);
⋮----
updateCropper(newCropper) {
⋮----
console.log('🔄 SmartScrollUtility 크롭퍼 업데이트');
⋮----
destroy() {
⋮----
const dynamicIndicator = document.getElementById('zoomIndicator');
⋮----
dynamicIndicator.remove();
⋮----
console.log('🧹 SmartScrollUtility 정리 완료');
⋮----
return new SmartScrollUtility(cropper, options);
⋮----
console.log('📦 SmartScrollUtility 모듈 로드 완료');
`````

## File: CLAUDE.md
`````markdown
# CLAUDE.md

이 문서는 이 저장소에서 Claude Code (claude.ai/code)가 코드를 다룰 때 참고할 가이드입니다.

---

## 📌 프로젝트 개요

이 프로젝트는 한국 팀원 4명이 개발하는 \*\*요양원 구인구직 웹사이트 "라이트케어(LightCare)"\*\*입니다. 이 플랫폼은 요양 시설과 요양업계 구직자를 연결해주는 서비스입니다.

---

## 🛠 기술 스택

* **백엔드**: Spring Boot 2.7.18, MyBatis, MySQL
* **프론트엔드**: Thymeleaf 템플릿, Bootstrap 5, JavaScript
* **빌드 도구**: Gradle (Java 11 사용)
* **데이터베이스**: MySQL (문자 인코딩 utf8mb4)

---

## ⚙️ 공통 개발 명령어

### 빌드 및 실행

```bash
# 프로젝트 빌드
./gradlew build

# 애플리케이션 실행
./gradlew bootRun

# 빌드 결과물 정리
./gradlew clean

# 테스트 실행
./gradlew test

# 코드 품질 검사
./gradlew check
```

### 데이터베이스 설정

```bash
# MySQL 접속 및 DB 생성
mysql -u root -p
CREATE DATABASE carelink CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 스키마 초기화
# src/main/resources/schema.sql 파일을 MySQL에서 실행
```

### 개발 서버 정보

* 실행 주소: `http://localhost:8080`
* DB 연결 주소: `jdbc:mysql://localhost:3306/carelink`
* DevTools를 통한 핫 리로드(Hot Reload) 적용됨

---

## 🧱 아키텍처 개요

### 팀 구조 (4인 협업)

기능 중심의 분업 구조로 운영됩니다:

* **팀원 A**: 회원 관리 (로그인, 회원가입, 내 정보)
* **팀원 B**: 시설 검색 및 지도 연동 (카카오맵)
* **팀원 C**: 구인구직 게시판 (공고 작성, 지원)
* **팀원 D**: 리뷰 시스템 및 정보 게시판

### 패키지 구조

```
com.example.carelink/
├── controller/          # 컨트롤러 계층
├── service/            # 서비스 계층 (비즈니스 로직)
├── dao/               # DAO 계층 (MyBatis 매퍼)
├── dto/               # DTO 객체
└── common/            # 공통 유틸 및 상수
```

### 데이터베이스 설계

관계형 테이블 기반으로 외래키(FK)를 적절히 사용:

* **member**: 사용자 계정 및 인증 정보
* **facility**: 요양시설 정보 (위치 좌표 포함)
* **job\_posting**: 구인공고 정보
* **review**: 시설 리뷰 및 평점
* **board**: 커뮤니티/정보 게시판

### MyBatis 구성

* 설정 파일: `src/main/resources/mybatis-config.xml`
* 매퍼 XML: `src/main/resources/mapper/*.xml`
* camelCase → underscore 자동 매핑 설정
* DTO용 typeAlias 사용

---

## 🎨 프론트엔드 구조

* **Thymeleaf**: Spring Boot 연동 서버사이드 템플릿
* **레이아웃 시스템**: `templates/layout/` 폴더에 header/footer 분리
* **정적 리소스**: `src/main/resources/static/` 폴더에 CSS/JS 저장
* **Bootstrap 5**: 반응형 UI 프레임워크 적용

---

## 🧾 주요 설정 파일

### application.yml

* 서버 포트: 8080
* 데이터베이스 연결 정보
* 개발 시 Thymeleaf 캐시 비활성화
* 파일 업로드 최대 용량 10MB
* MyBatis 매퍼 위치 지정

### 기타 설정 사항

* UTF-8 한글 지원 활성화
* MyBatis 및 Spring Web 로그 출력 설정
* DB 타임존: Asia/Seoul

---

## 🔄 개발 패턴

### 컨트롤러 패턴

Spring MVC 구조를 따름:

* `@Controller` 사용
* Model로 View 데이터 전달
* HTTP Method (@GetMapping, @PostMapping 등) 명확히 구분
* `@Slf4j`로 로깅

### 서비스 계층

컨트롤러와 로직 분리:

* 트랜잭션 처리
* 입력 검증
* 횡단 관심사 관리

### MyBatis 매퍼

XML 기반 SQL 정의:

* `#{}` 사용한 파라미터 바인딩
* DTO 매핑 설정
* JOIN 활용한 복합 조회 처리

---

## ✅ 테스트

### 테스트 구조

* 단위 테스트: JUnit 5
* 통합 테스트: Spring Boot Test
* 테스트 설정은 운영과 별도 구성

### 테스트 명령어

```bash
# 전체 테스트 실행
./gradlew test

# 특정 클래스만 실행
./gradlew test --tests "ClassName"
```

---

## 🤝 팀 협업 규칙

### Git 워크플로우

* 기능 브랜치 명: `feature/member-기능명`
* 커밋 메시지: `[feat] 기능 설명`
* PR을 통한 코드 리뷰 진행

### 코드 컨벤션

* 클래스명: PascalCase
* 메서드명: camelCase
* 상수명: UPPER\_SNAKE\_CASE
* 패키지명: 모두 소문자

---

## ⚠️ 특이 사항

### 한글 지원

* 모든 텍스트 콘텐츠는 한글로 작성
* UTF-8 인코딩 유지
* 주석/문서도 한글 기반

### 지도 연동

* 카카오맵 API 연동 예정
* 위도/경도 기반 시설 검색 기능 포함

### 사용자 역할

* `USER`: 일반 구직자
* `FACILITY`: 요양시설 관리자
* `ADMIN`: 시스템 관리자

---

## 🌐 환경 변수

환경 설정 시 아래 항목 필요:

* `spring.datasource.password`: MySQL 비밀번호
* DB 주소가 다를 경우 `spring.datasource.url` 수정
* 추후 지도 API 키 등록 필요 (예정)

### 🟢 팀원 D (리뷰/게시판) - 진행률: 100%

#### ✅ **완료된 작업**
**백엔드 완전 구현**:
- ✅ `ReviewService.java` (238줄) - **완전 구현**
  - 리뷰 CRUD 로직
  - 트랜잭션 처리
  - 로깅 추가
  - 유효성 검증
  - 평점 시스템
  - 추천/비추천 기능

- ✅ `BoardService.java` (253줄) - **완전 구현**
  - 게시글 CRUD 로직
  - 페이징 처리
  - 검색 및 카테고리 필터링
  - 인기 게시글 기능
  - 조회수 증가 로직

- ✅ `ReviewMapper.java` & `reviewMapper.xml` - **완전 구현**
  - 모든 필요 메서드 정의
  - XML 쿼리 매핑 완료

- ✅ `BoardMapper.java` & `boardMapper.xml` - **완전 구현**
  - 모든 필요 메서드 정의
  - XML 쿼리 매핑 완료

**프론트엔드 완성**:
- ✅ `templates/review/list.html` (108줄) - **완전 구현**
- ✅ `templates/review/write.html` (122줄) - **완전 구현**
- ✅ `templates/board/list.html` - **완전 구현**
- ✅ `templates/board/write.html` - **완전 구현**
- ✅ `templates/board/detail.html` - **완전 구현**

#### 📊 **실제 Story Point 달성률**
- **완료**: LC-010 (리뷰 작성) - 13/13 SP ✅
- **완료**: LC-011 (리뷰 목록 관리) - 13/13 SP ✅
- **완료**: LC-012 (정보 게시판) - 13/13 SP ✅

**총 달성**: 39/39 SP (100%)

#### 🚀 **다음 단계**
1. **단위 테스트 작성**
   - ReviewService 테스트
   - BoardService 테스트
   - 통합 테스트

2. **성능 최적화**
   - 쿼리 최적화
   - 캐싱 적용
   - N+1 문제 해결

3. **추가 기능 개발**
   - 댓글 시스템 고도화
   - 파일 첨부 기능
   - 에디터 기능 강화
`````

## File: docker-compose.yml
`````yaml
version: '3.8'
services:
  app:
    build: .
    container_name: carelink-app
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - DB_URL=${DB_URL:-jdbc:mysql://db:3306/carelink?useSSL=false&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=UTF-8}
      - DB_USERNAME=${DB_USERNAME:-root}
      - DB_PASSWORD=${DB_PASSWORD:-mysql}
      - KAKAO_APP_KEY=${KAKAO_APP_KEY:-0948e3e4faa457fb6083f68e1ce10458}
      - KAKAO_REST_API_KEY=${KAKAO_REST_API_KEY:-0948e3e4faa457fb6083f68e1ce10458}
      - UPLOAD_BASE_PATH=${UPLOAD_BASE_PATH:-/carelink-uploads/}
    volumes:
      - carelink-uploads:/carelink-uploads
    depends_on:
      - db
    restart: unless-stopped
    networks:
      - carelink-network
  db:
    image: mysql:8.0
    container_name: carelink-db
    ports:
      - "3306:3306"
    environment:
      - MYSQL_DATABASE=${MYSQL_DATABASE:-carelink}
      - MYSQL_ROOT_PASSWORD=${DB_PASSWORD:-mysql}
      - TZ=Asia/Seoul
    volumes:
      - carelink-db-data:/var/lib/mysql
      - ./src/main/resources/schema.sql:/docker-entrypoint-initdb.d/1.schema.sql
    command:
      - --character-set-server=utf8mb4
      - --collation-server=utf8mb4_unicode_ci
      - --skip-character-set-client-handshake
      - --default-authentication-plugin=mysql_native_password
    restart: unless-stopped
    networks:
      - carelink-network
volumes:
  carelink-uploads:
    name: carelink-uploads
  carelink-db-data:
    name: carelink-db-data
networks:
  carelink-network:
    name: carelink-network
`````

## File: reset_all_data.sql
`````sql
USE carelink;
SET FOREIGN_KEY_CHECKS = 0;
DELETE FROM facility_images;
DELETE FROM review;
DELETE FROM board;
DELETE FROM job_posting;
DELETE FROM facility;
DELETE FROM member WHERE user_id != 'admin';
ALTER TABLE facility_images AUTO_INCREMENT = 1;
ALTER TABLE review AUTO_INCREMENT = 1;
ALTER TABLE board AUTO_INCREMENT = 1;
ALTER TABLE job_posting AUTO_INCREMENT = 1;
ALTER TABLE facility AUTO_INCREMENT = 1;
SET FOREIGN_KEY_CHECKS = 1;
SELECT 'Database reset completed' AS status;
SELECT TABLE_NAME, TABLE_ROWS
FROM information_schema.TABLES
WHERE TABLE_SCHEMA = 'carelink'
  AND TABLE_TYPE = 'BASE TABLE';
COMMIT;
`````

## File: reset_facility_images.sql
`````sql
USE carelink;
DELETE FROM facility_images;
ALTER TABLE facility_images AUTO_INCREMENT = 1;
UPDATE facility
SET facility_image = NULL,
    facility_image_alt_text = NULL,
    image_count = 0;
SELECT 'facility_images 테이블 초기화 완료' AS status;
SELECT COUNT(*) AS remaining_images FROM facility_images;
SELECT facility_id, facility_name, facility_image, image_count FROM facility;
COMMIT;
`````

## File: src/main/java/com/example/carelink/common/BaseDTO.java
`````java
public class BaseDTO {
`````

## File: src/main/java/com/example/carelink/config/SecurityConfig.java
`````java
public class SecurityConfig {
⋮----
public PasswordEncoder passwordEncoder() {
return new BCryptPasswordEncoder();
⋮----
public HttpFirewall httpFirewall() {
StrictHttpFirewall firewall = new StrictHttpFirewall();
firewall.setAllowUrlEncodedDoubleSlash(true);
⋮----
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
⋮----
.csrf(csrf -> csrf.disable())
.authorizeHttpRequests(authorize -> authorize
.requestMatchers(
new AntPathRequestMatcher("/css/**"),
new AntPathRequestMatcher("/js/**"),
new AntPathRequestMatcher("/images/**"),
new AntPathRequestMatcher("/favicon.ico")
).permitAll()
⋮----
new AntPathRequestMatcher("/"),
new AntPathRequestMatcher("/member/login"),
new AntPathRequestMatcher("/member/join"),
new AntPathRequestMatcher("/member/checkUserId"),
new AntPathRequestMatcher("/facility/**"),
new AntPathRequestMatcher("/board/**"),
new AntPathRequestMatcher("/review/**"),
new AntPathRequestMatcher("/job/**"),
new AntPathRequestMatcher("/api/**"),
new AntPathRequestMatcher("/error")
⋮----
.anyRequest().permitAll()
⋮----
.formLogin(formLogin -> formLogin.disable())
.logout(logout -> logout
.logoutRequestMatcher(new AntPathRequestMatcher("/member/logout"))
.logoutSuccessUrl("/")
.invalidateHttpSession(true)
.deleteCookies("JSESSIONID")
.permitAll()
⋮----
return http.build();
`````

## File: src/main/java/com/example/carelink/config/WebConfig.java
`````java
public class WebConfig implements WebMvcConfigurer {
⋮----
public void addResourceHandlers(ResourceHandlerRegistry registry) {
registry.addResourceHandler("/uploads/facility/**")
.addResourceLocations("file:" + facilityUploadDir);
registry.addResourceHandler("/uploads/profile/**")
.addResourceLocations("file:" + profileUploadDir);
registry.addResourceHandler("/uploads/board/**")
.addResourceLocations("file:" + boardUploadDir);
String projectRoot = System.getProperty("user.dir");
registry.addResourceHandler("/test-images/facilities/**")
.addResourceLocations("file:" + projectRoot + "/images/facilities/");
registry.addResourceHandler("/test-images/profiles/**")
.addResourceLocations("file:" + projectRoot + "/images/profiles/");
`````

## File: src/main/java/com/example/carelink/controller/FacilityImageApiController.java
`````java
public class FacilityImageApiController {
⋮----
public ResponseEntity<Map<String, Object>> reorderImages(
⋮----
log.info("🔄 시설 이미지 순서 재정렬 API 요청 - facilityId: {}, imageIds: {}", facilityId, imageIds);
boolean success = facilityImageService.updateImageOrdersBatch(facilityId, imageIds);
⋮----
response.put("success", true);
response.put("message", "이미지 순서가 성공적으로 업데이트되었습니다.");
List<FacilityImageDTO> updatedImages = facilityImageService.getImagesByFacilityId(facilityId);
response.put("images", updatedImages);
log.info("✅ 시설 이미지 순서 재정렬 API 성공 - facilityId: {}", facilityId);
return ResponseEntity.ok(response);
⋮----
response.put("success", false);
response.put("message", "이미지 순서 업데이트에 실패했습니다.");
log.warn("⚠️ 시설 이미지 순서 재정렬 API 실패 - facilityId: {}", facilityId);
return ResponseEntity.badRequest().body(response);
⋮----
log.error("❌ 시설 이미지 순서 재정렬 API 오류 - facilityId: {}", facilityId, e);
⋮----
response.put("message", "서버 오류가 발생했습니다: " + e.getMessage());
return ResponseEntity.internalServerError().body(response);
⋮----
public ResponseEntity<Map<String, Object>> autoReorderImages(@PathVariable Long facilityId) {
⋮----
log.info("🔄 시설 이미지 자동 순서 재정렬 API 요청 - facilityId: {}", facilityId);
boolean success = facilityImageService.reorderAllFacilityImages(facilityId);
⋮----
response.put("message", "이미지 순서가 자동으로 재정렬되었습니다.");
List<FacilityImageDTO> reorderedImages = facilityImageService.getImagesByFacilityId(facilityId);
response.put("images", reorderedImages);
response.put("imageCount", reorderedImages.size());
log.info("✅ 시설 이미지 자동 순서 재정렬 API 성공 - facilityId: {}, 총 {}장", facilityId, reorderedImages.size());
⋮----
response.put("message", "이미지 순서 재정렬에 실패했습니다.");
log.warn("⚠️ 시설 이미지 자동 순서 재정렬 API 실패 - facilityId: {}", facilityId);
⋮----
log.error("❌ 시설 이미지 자동 순서 재정렬 API 오류 - facilityId: {}", facilityId, e);
⋮----
public ResponseEntity<Map<String, Object>> getFacilityImages(@PathVariable Long facilityId, HttpSession session) {
⋮----
log.info("📋 시설 이미지 목록 조회 API 요청 - facilityId: {}", facilityId);
MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
⋮----
response.put("message", "로그인이 필요합니다.");
return ResponseEntity.status(401).body(response);
⋮----
FacilityDTO facility = facilityService.getFacilityById(facilityId);
⋮----
response.put("message", "시설을 찾을 수 없습니다.");
⋮----
if (!facility.getRegisteredMemberId().equals(member.getMemberId())
&& !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
⋮----
response.put("message", "해당 시설 이미지를 조회할 권한이 없습니다.");
return ResponseEntity.status(403).body(response);
⋮----
List<FacilityImageDTO> images = facilityImageService.getImagesByFacilityId(facilityId);
FacilityImageDTO mainImage = facilityImageService.getMainImageByFacilityId(facilityId);
⋮----
response.put("images", images);
response.put("mainImage", mainImage);
response.put("imageCount", images.size());
response.put("maxImages", 5);
log.info("✅ 시설 이미지 목록 조회 API 성공 - facilityId: {}, 총 {}장, memberId: {}", facilityId, images.size(), member.getMemberId());
⋮----
log.error("❌ 시설 이미지 목록 조회 API 오류 - facilityId: {}", facilityId, e);
⋮----
public ResponseEntity<Map<String, Object>> updateImageOrder(
⋮----
log.info("🔢 개별 이미지 순서 업데이트 API 요청 - imageId: {}, order: {}", imageId, order);
boolean success = facilityImageService.updateImageOrder(imageId, order);
⋮----
response.put("message", "이미지 순서가 업데이트되었습니다.");
log.info("✅ 개별 이미지 순서 업데이트 API 성공 - imageId: {}, order: {}", imageId, order);
⋮----
log.warn("⚠️ 개별 이미지 순서 업데이트 API 실패 - imageId: {}, order: {}", imageId, order);
⋮----
log.error("❌ 개별 이미지 순서 업데이트 API 오류 - imageId: {}, order: {}", imageId, order, e);
⋮----
public ResponseEntity<Map<String, Object>> deleteImage(@PathVariable Long imageId) {
⋮----
log.info("🗑️ 이미지 삭제 API 요청 - imageId: {}", imageId);
boolean success = facilityImageService.deleteFacilityImage(imageId);
⋮----
response.put("message", "이미지가 삭제되었습니다.");
log.info("✅ 이미지 삭제 API 성공 - imageId: {}", imageId);
⋮----
response.put("message", "이미지 삭제에 실패했습니다.");
⋮----
log.error("❌ 이미지 삭제 API 오류 - imageId: {}", imageId, e);
⋮----
public ResponseEntity<Map<String, Object>> setMainImage(@PathVariable Long imageId) {
⋮----
log.info("⭐ 메인 이미지 설정 API 요청 - imageId: {}", imageId);
FacilityImageDTO imageInfo = facilityImageService.getImageById(imageId);
⋮----
response.put("message", "이미지를 찾을 수 없습니다.");
⋮----
boolean success = facilityImageService.setMainImage(imageInfo.getFacilityId(), imageId);
⋮----
response.put("message", "메인 이미지가 설정되었습니다.");
log.info("✅ 메인 이미지 설정 API 성공 - imageId: {}", imageId);
⋮----
response.put("message", "메인 이미지 설정에 실패했습니다.");
⋮----
log.error("❌ 메인 이미지 설정 API 오류 - imageId: {}", imageId, e);
⋮----
public ResponseEntity<Map<String, Object>> uploadImages(
⋮----
log.info("📤 시설 이미지 업로드 API 요청 - facilityId: {}, 이미지 수: {}", facilityId, images.size());
⋮----
response.put("message", "해당 시설 이미지를 업로드할 권한이 없습니다.");
⋮----
if (images == null || images.isEmpty()) {
⋮----
response.put("message", "업로드할 이미지가 없습니다.");
⋮----
if (images.size() > MAX_FILES) {
⋮----
response.put("message", "최대 " + MAX_FILES + "장까지만 업로드할 수 있습니다.");
⋮----
if (image.getSize() > MAX_FILE_SIZE) {
⋮----
response.put("message", "파일 크기가 10MB를 초과할 수 없습니다: " + image.getOriginalFilename());
⋮----
String contentType = image.getContentType();
if (contentType == null || !contentType.startsWith("image/")) {
⋮----
response.put("message", "이미지 파일만 업로드할 수 있습니다: " + image.getOriginalFilename());
⋮----
List<FacilityImageDTO> uploadedImages = facilityImageService.uploadMultipleImages(facilityId, images);
⋮----
response.put("message", images.size() + "개의 이미지가 성공적으로 업로드되었습니다.");
response.put("uploadedImages", uploadedImages);
response.put("uploadCount", uploadedImages.size());
log.info("✅ 시설 이미지 업로드 API 성공 - facilityId: {}, 업로드 수: {}, memberId: {}",
facilityId, uploadedImages.size(), member.getMemberId());
⋮----
log.error("❌ 시설 이미지 업로드 API 오류 - facilityId: {}", facilityId, e);
`````

## File: src/main/java/com/example/carelink/dao/FacilityImageMapper.java
`````java
public interface FacilityImageMapper {
List<FacilityImageDTO> getImagesByFacilityId(@Param("facilityId") Long facilityId);
FacilityImageDTO getMainImageByFacilityId(@Param("facilityId") Long facilityId);
int insertFacilityImage(FacilityImageDTO facilityImageDTO);
int updateFacilityImage(FacilityImageDTO facilityImageDTO);
int deleteFacilityImage(@Param("imageId") Long imageId);
int deleteAllImagesByFacilityId(@Param("facilityId") Long facilityId);
int countImagesByFacilityId(@Param("facilityId") Long facilityId);
int updateMainImage(@Param("facilityId") Long facilityId, @Param("imageId") Long imageId);
int clearMainImages(@Param("facilityId") Long facilityId);
FacilityImageDTO getImageById(@Param("imageId") Long imageId);
int updateImageOrder(@Param("imageId") Long imageId, @Param("imageOrder") Integer imageOrder);
`````

## File: src/main/java/com/example/carelink/dao/ReviewMapper.java
`````java
public interface ReviewMapper {
List<ReviewDTO> getReviewList(ReviewDTO searchDTO);
List<ReviewDTO> findReviewsWithSearch(ReviewDTO searchDTO);
int countReviewsWithSearch(ReviewDTO searchDTO);
ReviewDTO getReviewById(@Param("reviewId") Long reviewId);
ReviewDTO findReviewById(@Param("reviewId") Long reviewId);
int insertReview(ReviewDTO reviewDTO);
int updateReview(ReviewDTO reviewDTO);
int deleteReview(@Param("reviewId") Long reviewId);
int incrementViewCount(@Param("reviewId") Long reviewId);
int incrementLikeCount(@Param("reviewId") Long reviewId);
int incrementDislikeCount(@Param("reviewId") Long reviewId);
List<ReviewDTO> getReviewsByFacilityId(@Param("facilityId") Long facilityId);
List<ReviewDTO> findReviewsByFacilityId(@Param("facilityId") Long facilityId);
List<ReviewDTO> findReviewsByMemberId(@Param("memberId") Long memberId);
Double getAverageRating(@Param("facilityId") Long facilityId);
List<ReviewDTO> getRecentReviews();
int getReviewCount(ReviewDTO searchDTO);
int getReviewCount();
int deleteByMemberId(@Param("memberId") Long memberId);
int deleteByFacilityMemberId(@Param("memberId") Long memberId);
`````

## File: src/main/java/Crolling.java
`````java
public class Crolling {
public static void main(String[] args) {
⋮----
try (BufferedWriter writer = new BufferedWriter(new FileWriter(outputFilePath))) {
List<File> files = getAllFilesWithExtensions(rootDirectory, Arrays.asList(".java", ".jsp", ".xml", ".js", ".html", ".css"));
⋮----
System.out.println("파일 읽기: " + file.getAbsolutePath());
writeFileContentToFile(file, writer);
⋮----
System.out.println("모든 파일을 크롤링하여 " + outputFilePath + "에 저장했습니다.");
⋮----
e.printStackTrace();
⋮----
public static List<File> getAllFilesWithExtensions(String directoryPath, List<String> extensions) {
⋮----
File rootDirectory = new File(directoryPath);
File[] files = rootDirectory.listFiles();
⋮----
if (file.isDirectory()) {
matchedFiles.addAll(getAllFilesWithExtensions(file.getAbsolutePath(), extensions));
⋮----
if (file.getName().toLowerCase().endsWith(ext)) {
matchedFiles.add(file);
⋮----
public static void writeFileContentToFile(File file, BufferedWriter writer) throws IOException {
try (BufferedReader reader = new BufferedReader(new FileReader(file))) {
writer.write("파일명: " + file.getName() + "\n");
writer.write("경로: " + file.getAbsolutePath() + "\n");
writer.write("----------------------------------------------------\n");
⋮----
while ((line = reader.readLine()) != null) {
writer.write(line + "\n");
⋮----
writer.write("\n\n");
`````

## File: src/main/resources/mapper/facilityImageMapper.xml
`````xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.FacilityImageMapper">
    <resultMap id="FacilityImageResultMap" type="com.example.carelink.dto.FacilityImageDTO">
        <id property="imageId" column="image_id"/>
        <result property="facilityId" column="facility_id"/>
        <result property="imagePath" column="image_path"/>
        <result property="imageAltText" column="image_alt_text"/>
        <result property="imageOrder" column="image_order"/>
        <result property="isMainImage" column="is_main_image"/>
        <result property="uploadDate" column="upload_date"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>
    <select id="getImagesByFacilityId" resultMap="FacilityImageResultMap">
        SELECT
            image_id,
            facility_id,
            image_path,
            image_alt_text,
            image_order,
            is_main_image,
            upload_date,
            updated_at
        FROM facility_images
        WHERE facility_id = #{facilityId}
        ORDER BY image_order ASC, upload_date ASC
    </select>
    <select id="getMainImageByFacilityId" resultMap="FacilityImageResultMap">
        SELECT
            image_id,
            facility_id,
            image_path,
            image_alt_text,
            image_order,
            is_main_image,
            upload_date,
            updated_at
        FROM facility_images
        WHERE facility_id = #{facilityId}
        AND is_main_image = TRUE
        LIMIT 1
    </select>
    <insert id="insertFacilityImage" useGeneratedKeys="true" keyProperty="imageId">
        INSERT INTO facility_images (
            facility_id,
            image_path,
            image_alt_text,
            image_order,
            is_main_image,
            upload_date
        ) VALUES (
            #{facilityId},
            #{imagePath},
            #{imageAltText},
            #{imageOrder},
            #{isMainImage},
            NOW()
        )
    </insert>
    <update id="updateFacilityImage">
        UPDATE facility_images
        SET
            image_path = #{imagePath},
            image_alt_text = #{imageAltText},
            image_order = #{imageOrder},
            is_main_image = #{isMainImage},
            updated_at = NOW()
        WHERE image_id = #{imageId}
    </update>
    <delete id="deleteFacilityImage">
        DELETE FROM facility_images
        WHERE image_id = #{imageId}
    </delete>
    <delete id="deleteAllImagesByFacilityId">
        DELETE FROM facility_images
        WHERE facility_id = #{facilityId}
    </delete>
    <select id="countImagesByFacilityId" resultType="int">
        SELECT COUNT(*)
        FROM facility_images
        WHERE facility_id = #{facilityId}
    </select>
    <update id="clearMainImages">
        UPDATE facility_images
        SET is_main_image = FALSE, updated_at = NOW()
        WHERE facility_id = #{facilityId}
    </update>
    <update id="updateMainImage">
        UPDATE facility_images
        SET is_main_image = TRUE, updated_at = NOW()
        WHERE facility_id = #{facilityId} AND image_id = #{imageId}
    </update>
    <select id="getImageById" resultMap="FacilityImageResultMap">
        SELECT
            image_id,
            facility_id,
            image_path,
            image_alt_text,
            image_order,
            is_main_image,
            upload_date,
            updated_at
        FROM facility_images
        WHERE image_id = #{imageId}
    </select>
    <update id="updateImageOrder">
        UPDATE facility_images
        SET image_order = #{imageOrder}, updated_at = NOW()
        WHERE image_id = #{imageId}
    </update>
</mapper>
`````

## File: src/main/resources/mapper/reviewMapper.xml
`````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.ReviewMapper">
    <resultMap id="reviewResultMap" type="com.example.carelink.dto.ReviewDTO">
        <id property="reviewId" column="review_id"/>
        <result property="facilityId" column="facility_id"/>
        <result property="facilityName" column="facility_name"/>
        <result property="memberId" column="member_id"/>
        <result property="memberName" column="member_name"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="rating" column="rating"/>
        <result property="serviceRating" column="service_rating"/>
        <result property="facilityRating" column="facility_rating"/>
        <result property="staffRating" column="staff_rating"/>
        <result property="priceRating" column="price_rating"/>
        <result property="reviewImage1" column="review_image1"/>
        <result property="reviewImage2" column="review_image2"/>
        <result property="reviewImage3" column="review_image3"/>
        <result property="likeCount" column="like_count"/>
        <result property="dislikeCount" column="dislike_count"/>
        <result property="viewCount" column="view_count"/>
        <result property="isVisible" column="is_visible"/>
        <result property="status" column="status"/>
        <result property="parentReviewId" column="parent_review_id"/>
        <result property="replyCount" column="reply_count"/>
        <result property="replyDepth" column="reply_depth"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="isDeleted" column="is_deleted"/>
    </resultMap>
    <select id="findReviewsWithSearch" parameterType="com.example.carelink.dto.ReviewDTO" resultMap="reviewResultMap">
        SELECT
            r.*,
            m.name as member_name,
            f.facility_name
        FROM review r
        LEFT JOIN member m ON r.member_id = m.member_id
        LEFT JOIN facility f ON r.facility_id = f.facility_id
        WHERE r.is_deleted = false AND r.is_visible = true
        <if test="facilityId != null">
            AND r.facility_id = #{facilityId}
        </if>
        <if test="searchKeyword != null and searchKeyword != ''">
            AND (r.title LIKE CONCAT('%', #{searchKeyword}, '%')
                 OR r.content LIKE CONCAT('%', #{searchKeyword}, '%'))
        </if>
        <if test="minRating != null">
            AND r.rating >= #{minRating}
        </if>
        <if test="maxRating != null">
            AND r.rating &lt;= #{maxRating}
        </if>
        <choose>
            <when test="sortBy != null and sortBy == 'RATING_HIGH'">
                ORDER BY r.rating DESC, r.created_at DESC
            </when>
            <when test="sortBy != null and sortBy == 'RATING_LOW'">
                ORDER BY r.rating ASC, r.created_at DESC
            </when>
            <when test="sortBy != null and sortBy == 'LIKE_COUNT'">
                ORDER BY r.like_count DESC, r.created_at DESC
            </when>
            <otherwise>
                ORDER BY r.created_at DESC
            </otherwise>
        </choose>
        <if test="size != null and size > 0 and offset != null and offset >= 0">
            LIMIT #{size} OFFSET #{offset}
        </if>
    </select>
    <select id="countReviewsWithSearch" parameterType="com.example.carelink.dto.ReviewDTO" resultType="int">
        SELECT COUNT(*)
        FROM review r
        WHERE r.is_deleted = false AND r.is_visible = true
        <if test="facilityId != null">
            AND r.facility_id = #{facilityId}
        </if>
        <if test="searchKeyword != null and searchKeyword != ''">
            AND (r.title LIKE CONCAT('%', #{searchKeyword}, '%')
                 OR r.content LIKE CONCAT('%', #{searchKeyword}, '%'))
        </if>
        <if test="minRating != null">
            AND r.rating >= #{minRating}
        </if>
        <if test="maxRating != null">
            AND r.rating &lt;= #{maxRating}
        </if>
    </select>
    <select id="findReviewById" parameterType="long" resultMap="reviewResultMap">
        SELECT
            r.*,
            m.name as member_name,
            f.facility_name
        FROM review r
        LEFT JOIN member m ON r.member_id = m.member_id
        LEFT JOIN facility f ON r.facility_id = f.facility_id
        WHERE r.review_id = #{reviewId} AND r.is_deleted = false
    </select>
    <insert id="insertReview" parameterType="com.example.carelink.dto.ReviewDTO" useGeneratedKeys="true" keyProperty="reviewId">
        INSERT INTO review (
            facility_id, member_id, title, content, rating,
            service_rating, facility_rating, staff_rating, price_rating,
            review_image1, review_image2, review_image3,
            is_visible, status, parent_review_id, reply_depth,
            is_deleted, created_at
        ) VALUES (
            #{facilityId}, #{memberId}, #{title}, #{content}, #{rating},
            #{serviceRating}, #{facilityRating}, #{staffRating}, #{priceRating},
            #{reviewImage1}, #{reviewImage2}, #{reviewImage3},
            #{isVisible}, #{status}, #{parentReviewId}, #{replyDepth},
            #{isDeleted}, NOW()
        )
    </insert>
    <update id="updateReview" parameterType="com.example.carelink.dto.ReviewDTO">
        UPDATE review SET
            title = #{title},
            content = #{content},
            rating = #{rating},
            service_rating = #{serviceRating},
            facility_rating = #{facilityRating},
            staff_rating = #{staffRating},
            price_rating = #{priceRating},
            review_image1 = #{reviewImage1},
            review_image2 = #{reviewImage2},
            review_image3 = #{reviewImage3},
            is_visible = #{isVisible},
            status = #{status},
            updated_at = NOW()
        WHERE review_id = #{reviewId}
    </update>
    <update id="deleteReview" parameterType="long">
        UPDATE review SET
            is_deleted = true,
            updated_at = NOW()
        WHERE review_id = #{reviewId}
    </update>
    <update id="incrementViewCount" parameterType="long">
        UPDATE review SET
            view_count = view_count + 1,
            updated_at = NOW()
        WHERE review_id = #{reviewId}
    </update>
    <update id="incrementLikeCount" parameterType="long">
        UPDATE review SET
            like_count = like_count + 1,
            updated_at = NOW()
        WHERE review_id = #{reviewId}
    </update>
    <update id="incrementDislikeCount" parameterType="long">
        UPDATE review SET
            dislike_count = dislike_count + 1,
            updated_at = NOW()
        WHERE review_id = #{reviewId}
    </update>
    <select id="findReviewsByMemberId" parameterType="long" resultMap="reviewResultMap">
        SELECT
            r.*,
            m.name as member_name,
            f.facility_name
        FROM review r
        LEFT JOIN member m ON r.member_id = m.member_id
        LEFT JOIN facility f ON r.facility_id = f.facility_id
        WHERE r.member_id = #{memberId} AND r.is_deleted = false
        ORDER BY r.created_at DESC
    </select>
    <select id="findReviewsByFacilityId" parameterType="long" resultMap="reviewResultMap">
        SELECT
            r.*,
            m.name as member_name,
            f.facility_name
        FROM review r
        LEFT JOIN member m ON r.member_id = m.member_id
        LEFT JOIN facility f ON r.facility_id = f.facility_id
        WHERE r.facility_id = #{facilityId} AND r.is_deleted = false AND r.is_visible = true
        ORDER BY r.created_at DESC
    </select>
    <select id="getAverageRatingByFacilityId" parameterType="long" resultType="float">
        SELECT ROUND(AVG(rating), 1)
        FROM review
        WHERE facility_id = #{facilityId} AND is_deleted = false AND is_visible = true
    </select>
    <select id="getReviewCountByFacilityId" parameterType="long" resultType="int">
        SELECT COUNT(*)
        FROM review
        WHERE facility_id = #{facilityId} AND is_deleted = false AND is_visible = true
    </select>
    <select id="getReviewCount" resultType="int">
        SELECT COUNT(*)
        FROM review
        WHERE is_deleted = false AND is_visible = true
    </select>
    <select id="getAverageRating" parameterType="long" resultType="double">
        SELECT AVG(rating)
        FROM review
        WHERE facility_id = #{facilityId}
          AND is_deleted = false
          AND is_visible = true
    </select>
    <delete id="deleteByMemberId" parameterType="long">
        DELETE FROM review WHERE member_id = #{memberId}
    </delete>
    <delete id="deleteByFacilityMemberId" parameterType="long">
        DELETE FROM review
        WHERE facility_id IN (
            SELECT facility_id FROM facility WHERE registered_member_id = #{memberId}
        )
    </delete>
</mapper>
`````

## File: src/main/resources/static/css/rich-text-editor.css
`````css
.rich-text-editor-v2 {
.rich-text-editor-v2:focus-within {
.rte-toolbar {
.rte-toolbar-group {
.rte-toolbar-group:not(:last-child)::after {
.rte-btn {
.rte-btn:hover {
.rte-btn:active,
.rte-btn:focus {
.rte-btn:disabled {
.rte-select {
.rte-select:focus {
.rte-color {
.rte-color:focus {
.rte-content {
.rte-content:focus {
.rte-content a {
.rte-content a:hover {
.rte-content a:visited {
.rich-text-content a {
.rich-text-content a:hover {
.rich-text-content a:visited {
.rte-placeholder {
.rte-statusbar {
.rte-char-count.text-danger {
.rte-content p {
.rte-content ul,
.rte-content li {
.rte-content blockquote {
⋮----
.rte-table {
.rte-table th,
.rte-table th {
.rte-table tr:nth-child(even) {
.rte-warning {
⋮----
.sr-only {
`````

## File: src/main/resources/static/js/delete-member.js
`````javascript
document.addEventListener('DOMContentLoaded', function() {
⋮----
form: document.getElementById('deleteMemberForm'),
password: document.getElementById('password'),
confirmName: document.getElementById('confirmName'),
confirmDelete: document.getElementById('confirmDelete'),
submitButton: document.getElementById('submitButton'),
togglePassword: document.getElementById('togglePassword'),
passwordFeedback: document.getElementById('passwordFeedback'),
nameValidationFeedback: document.getElementById('nameValidationFeedback')
⋮----
const memberName = document.querySelector('.form-text strong').textContent.trim();
console.log('회원탈퇴 페이지 DOM 요소:', elements);
function setupPasswordToggle() {
⋮----
console.warn('비밀번호 토글 요소가 없습니다.');
⋮----
elements.togglePassword.addEventListener('click', function() {
const icon = this.querySelector('i');
⋮----
icon.classList.remove('fa-eye');
icon.classList.add('fa-eye-slash');
⋮----
icon.classList.remove('fa-eye-slash');
icon.classList.add('fa-eye');
⋮----
function clearValidationState(inputElement) {
⋮----
inputElement.classList.remove('is-valid', 'is-invalid');
⋮----
function setFeedback(feedbackElement, message, isValid) {
⋮----
function setValidationState(inputElement, isValid) {
⋮----
inputElement.classList.remove('is-invalid');
inputElement.classList.add('is-valid');
⋮----
inputElement.classList.remove('is-valid');
inputElement.classList.add('is-invalid');
⋮----
function validatePassword() {
const value = elements.password.value.trim();
⋮----
clearValidationState(elements.password);
setFeedback(elements.passwordFeedback, '', true);
⋮----
setValidationState(elements.password, isValid);
⋮----
setFeedback(elements.passwordFeedback, '비밀번호는 최소 8자 이상 입력해주세요.', false);
⋮----
setFeedback(elements.passwordFeedback, '비밀번호 형식이 유효합니다. (실제 일치 여부는 제출 시 확인)', true);
⋮----
// 이름 검증
function validateName() {
const value = elements.confirmName.value.trim();
⋮----
clearValidationState(elements.confirmName);
setFeedback(elements.nameValidationFeedback, '', true);
⋮----
setValidationState(elements.confirmName, isValid);
⋮----
setFeedback(elements.nameValidationFeedback, `이름이 일치하지 않습니다. '입력값: ${value}' ≠ '등록된 이름: ${memberName}'`, false);
⋮----
setFeedback(elements.nameValidationFeedback, '이름이 확인되었습니다.', true);
⋮----
// 동의 체크박스 검증
function validateConfirmDelete() {
⋮----
// 제출 버튼 활성화/비활성화
function updateSubmitButton() {
const isPasswordValid = validatePassword();
const isNameValid = validateName();
const isConfirmChecked = validateConfirmDelete();
⋮----
// 탈퇴 확인 다이얼로그
function showConfirmDialog() {
⋮----
return confirm(confirmMessage);
⋮----
// 이벤트 리스너 등록
function setupEventListeners() {
// 비밀번호 입력 이벤트
⋮----
elements.password.addEventListener('input', function() {
updateSubmitButton();
⋮----
elements.password.addEventListener('blur', function() {
validatePassword();
⋮----
elements.password.addEventListener('focus', function() {
clearValidationState(this);
⋮----
// 이름 입력 이벤트
⋮----
elements.confirmName.addEventListener('input', function() {
⋮----
elements.confirmName.addEventListener('blur', function() {
validateName();
⋮----
elements.confirmName.addEventListener('focus', function() {
⋮----
// 동의 체크박스 이벤트
⋮----
elements.confirmDelete.addEventListener('change', function() {
⋮----
this.classList.remove('is-invalid');
this.classList.add('is-valid');
⋮----
this.classList.remove('is-valid');
this.classList.add('is-invalid');
⋮----
elements.form.addEventListener('submit', function(event) {
event.preventDefault();
const isFormValid = updateSubmitButton();
⋮----
console.log('폼 유효성 검사 실패');
if (!validatePassword() && elements.password) {
elements.password.focus();
alert('비밀번호를 올바르게 입력해주세요.');
} else if (!validateName() && elements.confirmName) {
elements.confirmName.focus();
alert(`이름을 정확히 입력해주세요. 등록된 이름: '${memberName}'`);
} else if (!validateConfirmDelete() && elements.confirmDelete) {
elements.confirmDelete.focus();
elements.confirmDelete.classList.add('is-invalid');
alert('탈퇴 동의 체크박스를 선택해주세요.');
⋮----
if (!showConfirmDialog()) {
console.log('사용자가 탈퇴를 취소했습니다.');
⋮----
elements.submitButton.classList.remove('btn-danger');
elements.submitButton.classList.add('btn-warning');
⋮----
console.log('회원탈퇴 폼 제출');
this.submit();
⋮----
function showInitialWarning() {
if (!sessionStorage.getItem('deletePageWarningShown')) {
setTimeout(() => {
alert('⚠️ 회원탈퇴 페이지입니다.\n신중히 결정해주세요.');
sessionStorage.setItem('deletePageWarningShown', 'true');
⋮----
function setupBeforeUnloadWarning() {
⋮----
elements.password.addEventListener('input', () => {
⋮----
elements.confirmName.addEventListener('input', () => {
⋮----
elements.confirmDelete.addEventListener('change', () => {
⋮----
elements.form.addEventListener('submit', function() {
⋮----
window.addEventListener('beforeunload', function(event) {
⋮----
function init() {
setupPasswordToggle();
setupEventListeners();
⋮----
showInitialWarning();
console.log('회원탈퇴 페이지 JavaScript 초기화 완료');
⋮----
init();
`````

## File: src/main/resources/static/js/kakaomap.js
`````javascript
function previewFacilityImage(input) {
const preview = document.getElementById('facilityImagePreview');
const previewImg = document.getElementById('facilityImagePreviewImg');
⋮----
alert('파일 크기가 5MB를 초과합니다. 더 작은 파일을 선택해주세요.');
⋮----
if (!file.type.match('image.*')) {
alert('이미지 파일만 업로드 가능합니다.');
⋮----
const reader = new FileReader();
⋮----
reader.readAsDataURL(file);
⋮----
function initKakaoMap(mapId) {
const mapContainer = document.getElementById(mapId);
⋮----
console.error("Error: Map container not found with ID:", mapId);
⋮----
center: new kakao.maps.LatLng(37.566826, 126.9786567),
⋮----
map = new kakao.maps.Map(mapContainer, mapOption);
infoWindow = new kakao.maps.InfoWindow({zIndex:1});
const zoomControl = new kakao.maps.ZoomControl();
map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
console.log("Kakao Map initialized successfully on element:", mapId);
⋮----
function addMarker(lat, lng, title, content) {
⋮----
console.error("Error: Map object is not initialized. Cannot add marker for:", title);
⋮----
const position = new kakao.maps.LatLng(lat, lng);
const marker = new kakao.maps.Marker({
⋮----
markers.push(marker);
kakao.maps.event.addListener(marker, 'click', function() {
infoWindow.setContent('<div style="padding:5px;font-size:12px;">' + content + '</div>');
infoWindow.open(map, marker);
map.panTo(position);
⋮----
function clearMarkers() {
⋮----
markers[i].setMap(null);
⋮----
infoWindow.close();
⋮----
console.log("All markers cleared.");
⋮----
function searchFacilitiesInBounds() {
⋮----
console.error("Error: Map object is not initialized. Cannot search facilities in bounds.");
⋮----
const bounds = map.getBounds();
const swLat = bounds.getSouthWest().getLat();
const swLng = bounds.getSouthWest().getLng();
const neLat = bounds.getNorthEast().getLat();
const neLng = bounds.getNorthEast().getLng();
const facilityName = document.getElementById('facilityName')?.value || '';
const region = document.getElementById('region')?.value || '';
const facilityType = document.getElementById('facilityType')?.value || '';
const gradeRating = document.getElementById('gradeRating')?.value || '';
// 서버의 /facility/api/list API를 호출하여 해당 영역 내 시설 데이터를 가져옵니다.
⋮----
`&facilityName=${encodeURIComponent(facilityName)}` +
`&region=${encodeURIComponent(region)}` +
`&facilityType=${encodeURIComponent(facilityType)}` +
`&gradeRating=${encodeURIComponent(gradeRating)}`;
console.log("Fetching facilities for map bounds and filters:", url);
fetch(url)
.then(response => {
⋮----
throw new Error(`HTTP error! status: ${response.status}`);
⋮----
return response.json();
⋮----
.then(data => {
clearMarkers(); // 기존 마커 지우기
⋮----
data.forEach(facility => {
addMarker(
parseFloat(facility.latitude),
parseFloat(facility.longitude),
⋮----
console.log(`Updated map with ${data.length} facilities from AJAX.`);
⋮----
console.log("No facilities found in current map bounds with applied filters.");
⋮----
.catch(error => {
console.error("Error fetching facilities for map API:", error);
⋮----
// searchWithFilters 함수는 더 이상 HTML 폼 제출에서 직접 호출되지 않으므로,
// 만약 이 함수가 다른 목적으로 (예: 특정 필터 버튼 클릭 시 지도 업데이트) 사용된다면
// 그에 맞는 로직으로 변경해야 합니다. 현재는 필요 없으므로 제거하거나 주석 처리합니다.
/*
function searchWithFilters(filters) {
    console.warn("searchWithFilters is called. This function is likely deprecated for main form submission.");
    // 만약 AJAX 방식으로 필터링된 검색 결과를 가져와 지도나 목록을 업데이트하려면 이곳에 로직 구현
    // 예: const queryString = new URLSearchParams(filters).toString();
    // fetch(`/facility/api/list?${queryString}`)
    // ...
}
*/
// ===============================
// 주소 검색 관련 함수들
⋮----
/**
 * 카카오 우편번호 서비스를 이용한 주소 검색 팝업을 띄우는 함수
 * @param {string} addressInputId - 주소를 입력받을 input 요소의 ID
 * @param {string} detailAddressInputId - 상세주소를 입력받을 input 요소의 ID (선택사항)
 * @param {function} callback - 주소 선택 완료 후 실행될 콜백 함수 (선택사항)
 */
function openAddressSearch(addressInputId, detailAddressInputId = null, callback = null) {
new daum.Postcode({
⋮----
// 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.
// 각 주소의 노출 규칙에 따라 주소를 조합한다.
let addr = ''; // 주소 변수
let extraAddr = ''; // 참고항목 변수
// 사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
⋮----
if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
⋮----
// 건물명이 있고, 공동주택일 경우 추가한다.
⋮----
// 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
⋮----
// 우편번호와 주소 정보를 해당 필드에 넣는다.
const addressInput = document.getElementById(addressInputId);
⋮----
// 상세주소 입력란이 있으면 포커스를 이동한다.
⋮----
const detailAddressInput = document.getElementById(detailAddressInputId);
⋮----
detailAddressInput.focus();
⋮----
// 주소로부터 위도/경도를 가져와서 콜백 함수 실행
⋮----
getCoordinatesFromAddress(addr, callback);
⋮----
console.log('주소 검색 완료:', {
⋮----
}).open();
⋮----
function getCoordinatesFromAddress(address, callback) {
const geocoder = new kakao.maps.services.Geocoder();
geocoder.addressSearch(address, function(result, status) {
⋮----
const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
console.log('주소로부터 좌표 변환 성공:', {
⋮----
callback(parseFloat(result[0].y), parseFloat(result[0].x));
⋮----
console.error('주소로부터 좌표 변환 실패:', status);
alert('주소로부터 좌표를 가져올 수 없습니다.');
⋮----
function searchFacilityAddress() {
console.log('searchFacilityAddress 함수 호출됨');
const currentAddress = document.getElementById('facilityAddress').value;
if (currentAddress && currentAddress.trim() !== '') {
const confirmChange = confirm('기존 주소가 있습니다. 새로운 주소로 변경하시겠습니까?\n\n현재 주소: ' + currentAddress);
⋮----
console.log('주소 변경 취소됨');
⋮----
// Daum 우편번호 서비스 직접 사용
⋮----
console.log('주소 선택 완료:', data);
// 주소 조합
⋮----
// 주소 필드에 설정
const addressInput = document.getElementById('facilityAddress');
⋮----
addressInput.removeAttribute('readonly');
⋮----
addressInput.setAttribute('readonly', 'readonly');
console.log('주소 설정 완료:', finalAddress);
⋮----
setTimeout(function() {
⋮----
console.error('facilityAddress 필드를 찾을 수 없음');
⋮----
// 상세주소 입력란에 포커스
const detailAddressInput = document.getElementById('detailAddress');
⋮----
getCoordinatesFromAddress(addr, function(latitude, longitude) {
const latitudeInput = document.getElementById('latitude');
const longitudeInput = document.getElementById('longitude');
⋮----
console.log('위도 설정:', latitude);
⋮----
console.error('latitude 필드를 찾을 수 없음');
⋮----
console.log('경도 설정:', longitude);
⋮----
console.error('longitude 필드를 찾을 수 없음');
⋮----
const notification = document.createElement('div');
⋮----
document.body.appendChild(notification);
⋮----
notification.parentNode.removeChild(notification);
⋮----
console.log('시설 위치 좌표 설정 완료:', { latitude, longitude });
const mapPreviewContainer = document.getElementById('mapPreviewContainer');
⋮----
updatePreviewMap(latitude, longitude);
⋮----
console.log('주소 검색 창 닫힘. 상태:', state);
⋮----
function updatePreviewMap(latitude, longitude) {
const previewMapContainer = document.getElementById('previewMap');
⋮----
const coords = new kakao.maps.LatLng(latitude, longitude);
⋮----
window.previewMap = new kakao.maps.Map(previewMapContainer, mapOption);
⋮----
window.previewMap.setCenter(coords);
⋮----
window.previewMarker.setMap(null);
⋮----
window.previewMarker = new kakao.maps.Marker({
⋮----
console.log('미리보기 지도 업데이트 완료');
`````

## File: src/main/java/com/example/carelink/dao/JobMapper.java
`````java
public interface JobMapper {
List<JobDTO> findJobsWithSearch(JobDTO searchDTO);
List<JobDTO> getJobList(JobDTO searchDTO);
JobDTO findJobById(@Param("jobId") Long jobId);
int insertJob(JobDTO jobDTO);
int updateJob(JobDTO jobDTO);
int deleteJob(@Param("jobId") Long jobId);
List<JobDTO> getPopularJobs();
List<JobDTO> searchJobs(JobDTO searchDTO);
int countJobsWithSearch(JobDTO searchDTO);
int getJobCount();
void incrementApplyCount(@Param("jobId") Long jobId);
List<JobDTO> findJobsByMemberId(@Param("memberId") Long memberId);
int deleteByMemberId(@Param("memberId") Long memberId);
int deleteByFacilityMemberId(@Param("memberId") Long memberId);
`````

## File: src/main/java/com/example/carelink/dao/MemberMapper.java
`````java
public interface MemberMapper {
MemberDTO findByUserId(@Param("userId") String userId);
MemberDTO findById(@Param("memberId") Long memberId);
MemberDTO findByEmail(@Param("email") String email);
int insertMember(MemberDTO memberDTO);
int updateMember(MemberDTO memberDTO);
int softDeleteMember(@Param("userId") String userId);
int updatePassword(MemberDTO memberDTO);
int updateLoginSuccess(@Param("memberId") Long memberId);
int updateLoginFail(@Param("memberId") Long memberId);
int getTotalCount();
List<MemberDTO> findMembersWithPaging(MemberDTO searchDTO);
List<MemberDTO> findMembersByRole(@Param("role") String role);
void updateMemberStatus(@Param("memberId") Long memberId, @Param("isActive") boolean isActive);
int getMemberCount();
boolean existsByUserId(@Param("userId") String userId);
boolean existsByEmail(@Param("email") String email);
int anonymizeMember(@Param("userId") String userId);
int hardDeleteMember(@Param("userId") String userId);
int getFacilityMemberCount();
int getUserMemberCount();
int getMemberCountByRole(@Param("role") String role);
`````

## File: src/main/java/com/example/carelink/service/BoardService.java
`````java
public class BoardService {
⋮----
public PageInfo<BoardDTO> getBoardList(int page, String keyword, String category) {
log.info("게시글 목록 조회 시작 - page: {}, keyword: {}, category: {}", page, keyword, category);
⋮----
BoardDTO searchDTO = new BoardDTO();
searchDTO.setPage(page);
searchDTO.setSize(DEFAULT_PAGE_SIZE);
searchDTO.setOffset((page - 1) * DEFAULT_PAGE_SIZE);
if (keyword != null && !keyword.trim().isEmpty()) {
searchDTO.setSearchKeyword(keyword.trim());
⋮----
if (category != null && !category.trim().isEmpty() && !"all".equals(category)) {
searchDTO.setCategory(category.trim());
⋮----
log.info("검색 조건 - searchDTO: page={}, size={}, offset={}, keyword={}, category={}",
searchDTO.getPage(), searchDTO.getSize(), searchDTO.getOffset(),
searchDTO.getSearchKeyword(), searchDTO.getCategory());
int totalCount = boardMapper.getBoardCount(searchDTO);
log.info("전체 게시글 수: {}", totalCount);
List<BoardDTO> boardList = boardMapper.getBoardList(searchDTO);
log.info("조회된 게시글 수: {}", boardList != null ? boardList.size() : 0);
if (boardList != null && !boardList.isEmpty()) {
log.info("첫 번째 게시글 정보 - ID: {}, 제목: {}, 작성자: {}, is_active: {}, is_deleted: {}",
boardList.get(0).getBoardId(),
boardList.get(0).getTitle(),
boardList.get(0).getMemberName(),
boardList.get(0).getIsActive(),
boardList.get(0).getIsDeleted());
⋮----
log.warn("조회된 게시글이 없습니다.");
⋮----
log.info("페이징 정보 - 현재페이지: {}, 전체페이지: {}, 전체건수: {}",
pageInfo.getCurrentPage(), pageInfo.getTotalPages(), pageInfo.getTotalCount());
⋮----
log.error("게시글 목록 조회 중 오류 발생", e);
throw new RuntimeException("게시글 목록을 불러오는 중 오류가 발생했습니다.", e);
⋮----
public BoardDTO getBoardById(Long id) {
log.info("게시글 상세 조회 시작 - boardId: {}", id);
⋮----
BoardDTO board = boardMapper.getBoardById(id);
⋮----
throw new RuntimeException("해당 게시글을 찾을 수 없습니다. ID: " + id);
⋮----
log.info("게시글 상세 조회 완료 - boardId: {}, title: {}", id, board.getTitle());
⋮----
log.error("게시글 상세 조회 중 오류 발생 - boardId: {}", id, e);
throw new RuntimeException("게시글 상세 정보를 불러오는 중 오류가 발생했습니다.", e);
⋮----
public BoardDTO getBoardByIdIncludeDeleted(Long id) {
log.info("게시글 상세 조회 (삭제 포함) 시작 - boardId: {}", id);
⋮----
BoardDTO board = boardMapper.getBoardByIdIncludeDeleted(id);
⋮----
log.info("📄 게시글 조회 성공 (삭제 포함) - boardId: {}, title: {}", id, board.getTitle());
log.info("   🔍 DB에서 조회된 isDeleted 원본값: {}", board.getIsDeleted());
log.info("   🔍 isDeleted null 체크: {}", board.getIsDeleted() == null ? "NULL" : "NOT NULL");
if (board.getIsDeleted() != null) {
log.info("   🔍 isDeleted boolean 값: {} ({})", board.getIsDeleted(),
board.getIsDeleted() ? "삭제됨" : "정상");
⋮----
log.warn("존재하지 않는 게시글 조회 시도 (삭제 포함) - boardId: {}", id);
⋮----
log.error("게시글 상세 조회 (삭제 포함) 중 오류 발생 - boardId: {}", id, e);
throw new RuntimeException("게시글을 불러오는 중 오류가 발생했습니다.", e);
⋮----
public int insertBoard(BoardDTO boardDTO) {
log.info("게시글 등록 시작 - title: {}, memberId: {}", boardDTO.getTitle(), boardDTO.getMemberId());
⋮----
validateBoardData(boardDTO);
if (boardDTO.getStatus() == null) {
boardDTO.setStatus("ACTIVE");
⋮----
if (boardDTO.getPriority() == null) {
boardDTO.setPriority(0);
⋮----
if (boardDTO.getReplyDepth() == null) {
boardDTO.setReplyDepth(0);
⋮----
if (boardDTO.getReplyOrder() == null) {
boardDTO.setReplyOrder(0);
⋮----
if (boardDTO.getIsNotice() == null) {
boardDTO.setIsNotice(false);
⋮----
if (boardDTO.getIsSecret() == null) {
boardDTO.setIsSecret(false);
⋮----
if (boardDTO.getIsActive() == null) {
boardDTO.setIsActive(true);
⋮----
if (boardDTO.getIsDeleted() == null) {
boardDTO.setIsDeleted(false);
⋮----
if (boardDTO.getIsPinned() == null) {
boardDTO.setIsPinned(false);
⋮----
if (boardDTO.getCategory() != null && "NOTICE".equals(boardDTO.getCategory())) {
boardDTO.setIsNotice(true);
⋮----
if (boardDTO.getBoardType() == null) {
String category = boardDTO.getCategory();
if ("NOTICE".equals(category)) {
boardDTO.setBoardType("NOTICE");
} else if ("INFO".equals(category)) {
boardDTO.setBoardType("INFO");
} else if ("QNA".equals(category)) {
boardDTO.setBoardType("QNA");
} else if ("FAQ".equals(category)) {
boardDTO.setBoardType("FAQ");
⋮----
boardDTO.setBoardType("GENERAL");
⋮----
log.info("📝 등록 전 상태 확인 - isDeleted: {}, isActive: {}",
boardDTO.getIsDeleted(), boardDTO.getIsActive());
int result = boardMapper.insertBoard(boardDTO);
log.info("✅ 게시글 등록 완료 - boardId: {}", boardDTO.getBoardId());
if (boardDTO.getBoardId() != null) {
BoardDTO savedBoard = boardMapper.getBoardByIdIncludeDeleted(boardDTO.getBoardId());
⋮----
log.info("🔍 등록 직후 DB 상태 확인 - boardId: {}, isDeleted: {}, isActive: {}",
savedBoard.getBoardId(), savedBoard.getIsDeleted(), savedBoard.getIsActive());
⋮----
log.warn("⚠️ 등록 직후 게시글을 찾을 수 없습니다. boardId: {}", boardDTO.getBoardId());
⋮----
log.error("게시글 등록 중 오류 발생", e);
throw new RuntimeException("게시글 등록 중 오류가 발생했습니다.", e);
⋮----
public int updateBoard(BoardDTO boardDTO) {
log.info("게시글 수정 시작 - boardId: {}, title: {}", boardDTO.getBoardId(), boardDTO.getTitle());
⋮----
BoardDTO existingBoard = boardMapper.getBoardByIdIncludeDeleted(boardDTO.getBoardId());
⋮----
throw new RuntimeException("수정할 게시글을 찾을 수 없습니다. ID: " + boardDTO.getBoardId());
⋮----
boardDTO.setPriority(1);
⋮----
int result = boardMapper.updateBoard(boardDTO);
log.info("게시글 수정 완료 - boardId: {}", boardDTO.getBoardId());
⋮----
log.error("게시글 수정 중 오류 발생 - boardId: {}", boardDTO.getBoardId(), e);
throw new RuntimeException("게시글 수정 중 오류가 발생했습니다.", e);
⋮----
public Map<String, Object> deleteBoard(Long id) {
log.info("게시글 삭제 시작 - boardId: {}", id);
⋮----
BoardDTO existingBoard = boardMapper.getBoardByIdIncludeDeleted(id);
⋮----
log.warn("삭제 요청된 게시글을 찾을 수 없습니다. ID: {}", id);
result.put("success", false);
result.put("code", "NOT_FOUND");
result.put("message", "게시글을 찾을 수 없습니다.");
⋮----
log.info("🔍 게시글 상태 확인 - boardId: {}", id);
log.info("   - title: {}", existingBoard.getTitle());
log.info("   - isDeleted 값: {}", existingBoard.getIsDeleted());
log.info("   - isDeleted 타입: {}", existingBoard.getIsDeleted() != null ? existingBoard.getIsDeleted().getClass().getSimpleName() : "null");
log.info("🔍 삭제 상태 상세 분석:");
log.info("   - isDeleted 원본값: {}", existingBoard.getIsDeleted());
log.info("   - isDeleted == null: {}", existingBoard.getIsDeleted() == null);
log.info("   - isDeleted != null: {}", existingBoard.getIsDeleted() != null);
if (existingBoard.getIsDeleted() != null) {
log.info("   - isDeleted.booleanValue(): {}", existingBoard.getIsDeleted().booleanValue());
log.info("   - Boolean.TRUE.equals(isDeleted): {}", Boolean.TRUE.equals(existingBoard.getIsDeleted()));
⋮----
boolean isAlreadyDeleted = existingBoard.getIsDeleted() != null && existingBoard.getIsDeleted();
log.info("🔍 최종 삭제 판정: {}", isAlreadyDeleted);
⋮----
log.info("❌ 이미 삭제된 게시글입니다. boardId: {}, isDeleted: {}", id, existingBoard.getIsDeleted());
⋮----
result.put("code", "ALREADY_DELETED");
result.put("message", "이미 삭제된 게시글입니다.");
⋮----
log.info("✅ 삭제 가능한 게시글입니다. boardId: {}, isDeleted: {}", id, existingBoard.getIsDeleted());
int deleteResult = boardMapper.deleteBoard(id);
⋮----
log.info("게시글 삭제 완료 - boardId: {}, 영향받은 행: {}", id, deleteResult);
result.put("success", true);
result.put("code", "DELETED");
result.put("message", "게시글이 삭제되었습니다.");
⋮----
log.warn("게시글 삭제 실패 - boardId: {}, 영향받은 행: {}", id, deleteResult);
⋮----
result.put("code", "DELETE_FAILED");
result.put("message", "게시글 삭제에 실패했습니다.");
⋮----
log.error("게시글 삭제 중 오류 발생 - boardId: {}", id, e);
⋮----
result.put("code", "ERROR");
result.put("message", "게시글 삭제 중 오류가 발생했습니다: " + e.getMessage());
⋮----
public void incrementViewCount(Long id) {
log.info("조회수 증가 시작 - boardId: {}", id);
⋮----
boardMapper.incrementViewCount(id);
log.info("조회수 증가 완료 - boardId: {}", id);
⋮----
log.warn("조회수 증가 중 오류 발생 - boardId: {} (무시하고 진행)", id, e);
⋮----
public List<BoardDTO> getPopularBoards() {
log.info("인기 게시글 목록 조회 시작");
⋮----
List<BoardDTO> popularBoards = boardMapper.getPopularBoards();
log.info("인기 게시글 목록 조회 완료 - 조회된 건수: {}", popularBoards.size());
⋮----
log.error("인기 게시글 목록 조회 중 오류 발생", e);
throw new RuntimeException("인기 게시글을 불러오는 중 오류가 발생했습니다.", e);
⋮----
public List<BoardDTO> getBoardsByCategory(String category) {
log.info("카테고리별 게시글 목록 조회 시작 - category: {}", category);
⋮----
List<BoardDTO> boards = boardMapper.getBoardsByCategory(category);
log.info("카테고리별 게시글 목록 조회 완료 - category: {}, 조회된 건수: {}", category, boards.size());
⋮----
log.error("카테고리별 게시글 목록 조회 중 오류 발생 - category: {}", category, e);
throw new RuntimeException("카테고리별 게시글을 불러오는 중 오류가 발생했습니다.", e);
⋮----
public List<BoardDTO> getNoticeBoards() {
log.info("공지사항 목록 조회 시작");
⋮----
searchDTO.setCategory("NOTICE");
searchDTO.setSize(5);
searchDTO.setPage(1);
List<BoardDTO> notices = boardMapper.getBoardList(searchDTO);
log.info("공지사항 목록 조회 완료 - 조회된 건수: {}", notices.size());
⋮----
log.error("공지사항 목록 조회 중 오류 발생", e);
throw new RuntimeException("공지사항을 불러오는 중 오류가 발생했습니다.", e);
⋮----
private void validateBoardData(BoardDTO boardDTO) {
if (boardDTO.getMemberId() == null) {
throw new IllegalArgumentException("작성자 ID는 필수입니다.");
⋮----
if (boardDTO.getTitle() == null || boardDTO.getTitle().trim().isEmpty()) {
throw new IllegalArgumentException("게시글 제목은 필수입니다.");
⋮----
if (boardDTO.getContent() == null || boardDTO.getContent().trim().isEmpty()) {
throw new IllegalArgumentException("게시글 내용은 필수입니다.");
⋮----
if (boardDTO.getTitle().length() > 200) {
throw new IllegalArgumentException("게시글 제목은 200자를 초과할 수 없습니다.");
⋮----
public List<BoardDTO> getPopularBoardsByCategory(String category) {
log.info("카테고리별 인기 게시글 목록 조회 시작 - category: {}", category);
⋮----
if (category == null || category.trim().isEmpty()) {
popularBoards = boardMapper.getPopularBoards();
⋮----
popularBoards = boardMapper.getPopularBoardsByCategory(category);
⋮----
log.info("카테고리별 인기 게시글 목록 조회 완료 - 조회된 건수: {}", popularBoards.size());
⋮----
log.error("카테고리별 인기 게시글 목록 조회 중 오류 발생", e);
⋮----
public BoardDTO getPreviousBoard(Long currentId) {
log.info("이전 게시글 조회 시작 - currentId: {}", currentId);
⋮----
BoardDTO prevBoard = boardMapper.getPreviousBoard(currentId);
log.info("이전 게시글 조회 완료 - prevBoardId: {}", prevBoard != null ? prevBoard.getBoardId() : "없음");
⋮----
log.error("이전 게시글 조회 중 오류 발생", e);
⋮----
public BoardDTO getNextBoard(Long currentId) {
log.info("다음 게시글 조회 시작 - currentId: {}", currentId);
⋮----
BoardDTO nextBoard = boardMapper.getNextBoard(currentId);
log.info("다음 게시글 조회 완료 - nextBoardId: {}", nextBoard != null ? nextBoard.getBoardId() : "없음");
⋮----
log.error("다음 게시글 조회 중 오류 발생", e);
⋮----
public void incrementLikeCount(Long id) {
log.info("게시글 추천수 증가 시작 - boardId: {}", id);
⋮----
boardMapper.incrementLikeCount(id);
log.info("게시글 추천수 증가 완료 - boardId: {}", id);
⋮----
log.error("게시글 추천수 증가 중 오류 발생 - boardId: {}", id, e);
throw new RuntimeException("추천 처리 중 오류가 발생했습니다.", e);
⋮----
public void decrementLikeCount(Long id) {
log.info("게시글 추천수 감소 시작 - boardId: {}", id);
⋮----
boardMapper.decrementLikeCount(id);
log.info("게시글 추천수 감소 완료 - boardId: {}", id);
⋮----
log.error("게시글 추천수 감소 중 오류 발생 - boardId: {}", id, e);
throw new RuntimeException("추천 취소 처리 중 오류가 발생했습니다.", e);
⋮----
public int getBoardCount() {
log.info("전체 게시글 수 조회 시작");
⋮----
int count = boardMapper.getBoardCount(searchDTO);
log.info("전체 게시글 수 조회 완료 - 총 {}건", count);
⋮----
log.error("전체 게시글 수 조회 중 오류 발생", e);
`````

## File: src/main/resources/mapper/MemberMapper.xml
`````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.MemberMapper">
    <resultMap id="memberResultMap" type="com.example.carelink.dto.MemberDTO">
        <id property="memberId" column="member_id"/>
        <result property="userId" column="user_id"/>
        <result property="password" column="password"/>
        <result property="name" column="name"/>
        <result property="email" column="email"/>
        <result property="phone" column="phone"/>
        <result property="role" column="role"/>
        <result property="address" column="address"/>
        <result property="detailAddress" column="detail_address"/>
        <result property="profileImage" column="profile_image"/>
        <result property="profileImageAltText" column="profile_image_alt_text"/>
        <result property="isActive" column="is_active"/>
        <result property="loginFailCount" column="login_fail_count"/>
        <result property="lastLoginAt" column="last_login_at"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="isDeleted" column="is_deleted"/>
    </resultMap>
    <select id="findByUserId" resultMap="memberResultMap">
        SELECT *
        FROM member
        WHERE user_id = #{userId}
          AND is_deleted = false
    </select>
    <select id="findById" resultMap="memberResultMap">
        SELECT *
        FROM member
        WHERE member_id = #{memberId}
          AND is_deleted = false
    </select>
    <select id="findByEmail" resultMap="memberResultMap">
        SELECT *
        FROM member
        WHERE email = #{email}
          AND is_deleted = false
    </select>
    <insert id="insertMember" parameterType="com.example.carelink.dto.MemberDTO" useGeneratedKeys="true" keyProperty="memberId">
        INSERT INTO member (
        member_id,
        user_id,
        password,
        name,
        email,
        phone,
        role,
        address,
        detail_address,
        profile_image,
        is_active,
        login_fail_count,
        last_login_at,
        is_deleted
        ) VALUES (
        #{memberId},
        #{userId, jdbcType=VARCHAR},
        #{password, jdbcType=VARCHAR},
        #{name, jdbcType=VARCHAR},
        #{email, jdbcType=VARCHAR},
        #{phone, jdbcType=VARCHAR},
        #{role, jdbcType=VARCHAR},
        #{address, jdbcType=VARCHAR},
        #{detailAddress, jdbcType=VARCHAR},
        #{profileImage, jdbcType=VARCHAR},
        #{isActive, jdbcType=BOOLEAN},
        #{loginFailCount, jdbcType=INTEGER},
        #{lastLoginAt, jdbcType=TIMESTAMP},
        #{isDeleted, jdbcType=BOOLEAN}
        )
    </insert>
    <select id="existsByUserId" resultType="boolean">
        SELECT COUNT(*) > 0 FROM member WHERE user_id = #{userId}
    </select>
    <select id="existsByEmail" resultType="boolean">
        SELECT COUNT(*) > 0 FROM member WHERE email = #{email}
    </select>
    <update id="updateMember" parameterType="MemberDTO">
        UPDATE member
        SET
            name = #{name},
            email = #{email},
            phone = #{phone},
            address = #{address},
            detail_address = #{detailAddress},
            profile_image = #{profileImage},
            profile_image_alt_text = #{profileImageAltText},
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>
    <update id="softDeleteMember">
        UPDATE member
        SET
            is_deleted = TRUE,
            is_active = FALSE,
            updated_at = NOW()
        WHERE user_id = #{userId}
    </update>
    <update id="anonymizeMember">
        UPDATE member
        SET
            name = '탈퇴회원',
            email = NULL,
            phone = NULL,
            address = NULL,
            profile_image = NULL,
            password = 'DELETED',
            is_deleted = TRUE,
            is_active = FALSE,
            updated_at = NOW()
        WHERE user_id = #{userId}
    </update>
    <delete id="hardDeleteMember">
        DELETE FROM member WHERE user_id = #{userId}
    </delete>
    <update id="updatePassword" parameterType="MemberDTO">
        UPDATE member
        SET
            password = #{password},
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>
    <update id="updateLoginSuccess">
        UPDATE member
        SET login_fail_count = 0,
            last_login_at = NOW(),
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>
    <update id="updateLoginFail">
        UPDATE member
        SET login_fail_count = login_fail_count + 1,
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>
    <select id="getTotalCount" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE is_deleted = FALSE
    </select>
    <select id="findMembersWithPaging" resultMap="memberResultMap">
        SELECT *
        FROM member
        WHERE is_deleted = FALSE
        <if test="role != null and !role.isEmpty()">
            AND role = #{role}
        </if>
        ORDER BY created_at DESC
        LIMIT #{pageSize} OFFSET #{offset}
    </select>
    <select id="findMembersByRole" resultMap="memberResultMap">
        SELECT *
        FROM member
        WHERE is_deleted = FALSE
        <if test="role != null and role != ''">
            AND role = #{role}
        </if>
        ORDER BY created_at DESC
    </select>
    <update id="updateMemberStatus">
        UPDATE member
        SET is_active = #{isActive},
            updated_at = NOW()
        WHERE member_id = #{memberId}
    </update>
    <select id="getMemberCount" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE is_deleted = false AND is_active = true
    </select>
    <select id="getFacilityMemberCount" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE is_deleted = false
        AND role = 'FACILITY'
    </select>
    <select id="getUserMemberCount" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE is_deleted = false
        AND role = 'USER'
    </select>
    <select id="getMemberCountByRole" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE is_deleted = false
        <if test="role != null and role != ''">
            AND role = #{role}
        </if>
    </select>
</mapper>
`````

## File: src/main/resources/static/css/common.css
`````css
:root {
body {
body.pt-5 {
.navbar.fixed-top {
.min-vh-100 {
.card {
.card:hover {
.card-header {
.card-header.bg-primary {
.btn {
.btn:hover {
.form-control {
.form-control:focus {
.navbar-brand {
.navbar-nav .nav-link {
.navbar-nav .nav-link:hover {
.dropdown-menu {
.dropdown-item {
.dropdown-item:hover {
footer {
footer a {
footer a:hover {
.alert {
.alert-success {
.alert-danger {
.alert-warning {
.alert-info {
.table {
.table thead th {
.table-primary th {
.table tbody tr {
.table tbody tr:hover {
.list-group-item {
.list-group-item:hover {
.list-group-item-action:hover {
.pagination .page-link {
.pagination .page-item.active .page-link {
.pagination .page-link:hover {
.badge {
.badge.bg-danger {
.badge.bg-secondary {
.search-filters {
.stats-card {
.stats-card:hover {
.stats-card h3 {
.stats-card p {
.rating .fa-star {
.rating .fa-star.text-warning {
.rating .fa-star.text-muted {
.loading-spinner {
⋮----
.input-group-text {
.file-upload-area {
.file-upload-area:hover {
.file-upload-area.dragover {
.tag {
.tag-secondary {
.tag-success {
.tag-warning {
⋮----
.card-body {
⋮----
.text-hover:hover {
.bg-gradient-primary {
.border-primary-soft {
.shadow-soft {
.fade-in {
⋮----
#map {
.info-window {
.info-window h5 {
.info-window p {
.facility-item {
.facility-item:hover {
.facility-item.active {
.custom-control {
.custom-control:hover {
.rating-stars {
.rating-stars .star {
.rating-stars .star:hover,
.rating-group {
.rating-group label {
.detailed-rating .star {
#ratingText {
.rating-input-group {
⋮----
.rating-stars .star:hover ~ .star {
.rating-stars:hover .star {
⋮----
.rating-stars .star.active {
.modal {
.modal-content {
.close-modal {
.close-modal:hover,
.review-image {
.review-image:hover {
.rating-detail {
.rating-detail .fas.fa-star {
.rating-detail .far.fa-star {
.content-area {
⋮----
.list-group-item-action .rating-stars {
`````

## File: src/main/java/com/example/carelink/dao/BoardMapper.java
`````java
public interface BoardMapper {
List<BoardDTO> getBoardList(BoardDTO searchDTO);
BoardDTO getBoardById(@Param("boardId") Long boardId);
BoardDTO getBoardByIdIncludeDeleted(@Param("boardId") Long boardId);
int insertBoard(BoardDTO boardDTO);
int updateBoard(BoardDTO boardDTO);
int deleteBoard(@Param("boardId") Long boardId);
void increaseViewCount(@Param("boardId") Long boardId);
void incrementViewCount(@Param("boardId") Long boardId);
List<BoardDTO> getPopularBoards();
List<BoardDTO> getBoardsByCategory(@Param("category") String category);
int getBoardCount(BoardDTO searchDTO);
List<BoardDTO> getPopularBoardsByCategory(@Param("category") String category);
void incrementLikeCount(@Param("boardId") Long boardId);
void decrementLikeCount(@Param("boardId") Long boardId);
BoardDTO getPreviousBoard(@Param("boardId") Long boardId);
BoardDTO getNextBoard(@Param("boardId") Long boardId);
List<BoardDTO> findBoardsByMemberId(@Param("memberId") Long memberId);
int deleteByMemberId(@Param("memberId") Long memberId);
`````

## File: src/main/java/com/example/carelink/dao/FacilityMapper.java
`````java
public interface FacilityMapper {
List<FacilityDTO> searchFacilities(FacilityDTO searchDTO);
FacilityDTO getFacilityById(@Param("facilityId") Long facilityId);
List<FacilityDTO> getAllFacilities();
List<FacilityDTO> getAllActiveFacilities();
int insertFacility(FacilityDTO facilityDTO);
int updateFacility(FacilityDTO facilityDTO);
int deleteFacility(@Param("facilityId") Long facilityId);
int countFacilitiesByRegion(@Param("region") String region);
int getFacilityCount();
int deleteByMemberId(@Param("memberId") Long memberId);
List<FacilityDTO> getFacilitiesByMemberId(@Param("memberId") Long memberId);
FacilityDTO getFacilityByMemberId(@Param("memberId") Long memberId);
int updateFacilityMainImage(@Param("facilityId") Long facilityId,
⋮----
List<FacilityDTO> getFacilitiesByApprovalStatus(@Param("approvalStatus") String approvalStatus);
int updateFacilityApprovalStatus(@Param("facilityId") Long facilityId,
⋮----
int countFacilitiesByStatus(@Param("approvalStatus") String approvalStatus);
`````

## File: src/main/java/com/example/carelink/dto/BoardDTO.java
`````java
public class BoardDTO extends BaseDTO {
⋮----
public void setAuthor(String author) {
this.author = (this.memberName != null && !this.memberName.isEmpty()) ? this.memberName : author;
⋮----
public String getAuthor() {
return (this.memberName != null && !this.memberName.isEmpty()) ? this.memberName : this.author;
⋮----
public boolean getIsNew() {
if (this.getCreatedAt() == null) return false;
return this.getCreatedAt().isAfter(java.time.LocalDateTime.now().minusDays(1));
⋮----
public boolean getIsHot() {
⋮----
public boolean getHasComments() {
`````

## File: src/main/java/com/example/carelink/service/ReviewService.java
`````java
public class ReviewService {
⋮----
public PageInfo<ReviewDTO> getReviewList(int page, String keyword) {
return getReviewList(page, keyword, null, null);
⋮----
public PageInfo<ReviewDTO> getReviewList(int page, String keyword, Integer minRating) {
return getReviewList(page, keyword, minRating, null);
⋮----
public PageInfo<ReviewDTO> getReviewList(int page, String keyword, Integer minRating, Long facilityId) {
log.info("리뷰 목록 조회 시작 - page: {}, keyword: {}, minRating: {}, facilityId: {}", page, keyword, minRating, facilityId);
⋮----
ReviewDTO searchDTO = new ReviewDTO();
searchDTO.setPage(page);
searchDTO.setSize(DEFAULT_PAGE_SIZE);
if (keyword != null && !keyword.trim().isEmpty()) {
searchDTO.setSearchKeyword(keyword.trim());
⋮----
searchDTO.setMinRating(minRating);
⋮----
searchDTO.setFacilityId(facilityId);
⋮----
int totalCount = reviewMapper.countReviewsWithSearch(searchDTO);
List<ReviewDTO> reviewList = reviewMapper.findReviewsWithSearch(searchDTO);
log.info("리뷰 목록 조회 완료 - 조회된 건수: {}, 전체: {}", reviewList.size(), totalCount);
⋮----
log.error("리뷰 목록 조회 중 오류 발생", e);
throw new RuntimeException("리뷰 목록을 불러오는 중 오류가 발생했습니다.", e);
⋮----
public ReviewDTO getReviewById(Long id) {
log.info("리뷰 상세 조회 시작 - reviewId: {}", id);
⋮----
ReviewDTO review = reviewMapper.findReviewById(id);
⋮----
throw new RuntimeException("해당 리뷰를 찾을 수 없습니다. ID: " + id);
⋮----
reviewMapper.incrementViewCount(id);
log.info("리뷰 상세 조회 완료 - reviewId: {}, title: {}", id, review.getTitle());
⋮----
log.error("리뷰 상세 조회 중 오류 발생 - reviewId: {}", id, e);
throw new RuntimeException("리뷰 상세 정보를 불러오는 중 오류가 발생했습니다.", e);
⋮----
public int insertReview(ReviewDTO reviewDTO) {
log.info("리뷰 등록 시작 - title: {}, facilityId: {}", reviewDTO.getTitle(), reviewDTO.getFacilityId());
⋮----
validateReviewData(reviewDTO);
if (reviewDTO.getStatus() == null) {
reviewDTO.setStatus("ACTIVE");
⋮----
if (reviewDTO.getReplyDepth() == null) {
reviewDTO.setReplyDepth(0);
⋮----
reviewDTO.setVisible(true);
reviewDTO.setDeleted(false);
int result = reviewMapper.insertReview(reviewDTO);
log.info("리뷰 등록 완료 - reviewId: {}", reviewDTO.getReviewId());
⋮----
log.error("리뷰 등록 중 오류 발생", e);
throw new RuntimeException("리뷰 등록 중 오류가 발생했습니다.", e);
⋮----
public List<ReviewDTO> getReviewsByFacilityId(Long facilityId) {
log.info("시설별 리뷰 조회 시작 - facilityId: {}", facilityId);
⋮----
List<ReviewDTO> reviews = reviewMapper.findReviewsByFacilityId(facilityId);
log.info("시설별 리뷰 조회 완료 - facilityId: {}, 조회된 건수: {}", facilityId, reviews.size());
⋮----
log.error("시설별 리뷰 조회 중 오류 발생 - facilityId: {}", facilityId, e);
throw new RuntimeException("시설별 리뷰를 불러오는 중 오류가 발생했습니다.", e);
⋮----
public int deleteReview(Long id) {
log.info("리뷰 삭제 시작 - reviewId: {}", id);
⋮----
ReviewDTO existingReview = reviewMapper.findReviewById(id);
⋮----
throw new RuntimeException("삭제할 리뷰를 찾을 수 없습니다. ID: " + id);
⋮----
int result = reviewMapper.deleteReview(id);
log.info("리뷰 삭제 완료 - reviewId: {}", id);
⋮----
log.error("리뷰 삭제 중 오류 발생 - reviewId: {}", id, e);
throw new RuntimeException("리뷰 삭제 중 오류가 발생했습니다.", e);
⋮----
public Double getAverageRating(Long facilityId) {
log.info("평균 평점 조회 시작 - facilityId: {}", facilityId);
⋮----
Double averageRating = reviewMapper.getAverageRating(facilityId);
⋮----
log.info("평균 평점 조회 완료 - facilityId: {}, 평균 평점: {}", facilityId, averageRating);
⋮----
log.error("평균 평점 조회 중 오류 발생 - facilityId: {}", facilityId, e);
⋮----
public int likeReview(Long reviewId) {
log.info("리뷰 추천 시작 - reviewId: {}", reviewId);
⋮----
int result = reviewMapper.incrementLikeCount(reviewId);
log.info("리뷰 추천 완료 - reviewId: {}", reviewId);
⋮----
log.error("리뷰 추천 중 오류 발생 - reviewId: {}", reviewId, e);
throw new RuntimeException("리뷰 추천 중 오류가 발생했습니다.", e);
⋮----
public int dislikeReview(Long reviewId) {
log.info("리뷰 비추천 시작 - reviewId: {}", reviewId);
⋮----
int result = reviewMapper.incrementDislikeCount(reviewId);
log.info("리뷰 비추천 완료 - reviewId: {}", reviewId);
⋮----
log.error("리뷰 비추천 중 오류 발생 - reviewId: {}", reviewId, e);
throw new RuntimeException("리뷰 비추천 중 오류가 발생했습니다.", e);
⋮----
public List<ReviewDTO> getReviewsByMemberId(Long memberId) {
log.info("회원별 리뷰 조회 시작 - memberId: {}", memberId);
⋮----
List<ReviewDTO> reviews = reviewMapper.findReviewsByMemberId(memberId);
log.info("회원별 리뷰 조회 완료 - memberId: {}, 조회된 건수: {}", memberId, reviews.size());
⋮----
log.error("회원별 리뷰 조회 중 오류 발생 - memberId: {}", memberId, e);
throw new RuntimeException("회원별 리뷰를 불러오는 중 오류가 발생했습니다.", e);
⋮----
private void validateReviewData(ReviewDTO reviewDTO) {
if (reviewDTO.getFacilityId() == null) {
throw new IllegalArgumentException("시설 ID는 필수입니다.");
⋮----
if (reviewDTO.getMemberId() == null) {
throw new IllegalArgumentException("회원 ID는 필수입니다.");
⋮----
if (reviewDTO.getTitle() == null || reviewDTO.getTitle().trim().isEmpty()) {
throw new IllegalArgumentException("리뷰 제목은 필수입니다.");
⋮----
if (reviewDTO.getContent() == null || reviewDTO.getContent().trim().isEmpty()) {
throw new IllegalArgumentException("리뷰 내용은 필수입니다.");
⋮----
if (reviewDTO.getRating() == null || reviewDTO.getRating() < 1 || reviewDTO.getRating() > 5) {
throw new IllegalArgumentException("평점은 1~5 사이의 값이어야 합니다.");
⋮----
public int getReviewCount() {
⋮----
return reviewMapper.getReviewCount();
⋮----
log.error("리뷰 수 조회 중 오류 발생", e);
⋮----
public int updateReview(ReviewDTO reviewDTO) {
log.info("리뷰 수정 시작 - reviewId: {}, title: {}", reviewDTO.getReviewId(), reviewDTO.getTitle());
⋮----
ReviewDTO existingReview = reviewMapper.findReviewById(reviewDTO.getReviewId());
⋮----
throw new RuntimeException("수정할 리뷰를 찾을 수 없습니다. ID: " + reviewDTO.getReviewId());
⋮----
if (reviewDTO.getStatus() == null || reviewDTO.getStatus().isEmpty()) {
⋮----
int result = reviewMapper.updateReview(reviewDTO);
log.info("리뷰 수정 완료 - reviewId: {}", reviewDTO.getReviewId());
⋮----
log.error("리뷰 수정 중 오류 발생 - reviewId: {}", reviewDTO.getReviewId(), e);
throw new RuntimeException("리뷰 수정 중 오류가 발생했습니다.", e);
⋮----
public int incrementViewCount(Long id) {
log.info("조회수 증가 시작 - reviewId: {}", id);
⋮----
int result = reviewMapper.incrementViewCount(id);
log.info("조회수 증가 완료 - reviewId: {}", id);
⋮----
log.error("조회수 증가 중 오류 발생 - reviewId: {}", id, e);
`````

## File: src/main/resources/mapper/boardMapper.xml
`````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.BoardMapper">
    <resultMap id="boardResultMap" type="com.example.carelink.dto.BoardDTO">
        <id property="boardId" column="board_id"/>
        <result property="boardType" column="board_type"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="memberId" column="member_id"/>
        <result property="memberName" column="member_name"/>
        <result property="viewCount" column="view_count"/>
        <result property="likeCount" column="like_count"/>
        <result property="commentCount" column="comment_count"/>
        <result property="attachmentPath" column="attachment_path"/>
        <result property="attachmentName" column="attachment_name"/>
        <result property="attachmentSize" column="attachment_size"/>
        <result property="isNotice" column="is_notice"/>
        <result property="isSecret" column="is_secret"/>
        <result property="isDeleted" column="is_deleted"/>
        <result property="status" column="status"/>
        <result property="category" column="category"/>
        <result property="subCategory" column="sub_category"/>
        <result property="priority" column="priority"/>
        <result property="isPinned" column="is_pinned"/>
        <result property="parentBoardId" column="parent_board_id"/>
        <result property="replyDepth" column="reply_depth"/>
        <result property="replyOrder" column="reply_order"/>
        <result property="tags" column="tags"/>
        <result property="metaDescription" column="meta_description"/>
        <result property="metaKeywords" column="meta_keywords"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>
    <select id="getBoardList" parameterType="com.example.carelink.dto.BoardDTO" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.board_type,
            b.title,
            b.content,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.is_notice,
            b.is_secret,
            COALESCE(b.is_active, true) as is_active,
            COALESCE(b.is_deleted, false) as is_deleted,
            b.status,
            b.category,
            b.sub_category,
            b.priority,
            b.is_pinned,
            b.tags,
            b.created_at,
            b.updated_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            <if test="searchKeyword != null and searchKeyword != ''">
                AND (b.title LIKE CONCAT('%', #{searchKeyword}, '%') OR b.content LIKE CONCAT('%', #{searchKeyword}, '%'))
            </if>
            <if test="category != null and category != ''">
                AND b.category = #{category}
            </if>
        ORDER BY
            b.is_notice DESC,
            b.created_at DESC
        LIMIT #{size} OFFSET #{offset}
    </select>
    <select id="getBoardCount" parameterType="com.example.carelink.dto.BoardDTO" resultType="int">
        SELECT COUNT(*)
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            <if test="searchKeyword != null and searchKeyword != ''">
                AND (b.title LIKE CONCAT('%', #{searchKeyword}, '%') OR b.content LIKE CONCAT('%', #{searchKeyword}, '%'))
            </if>
            <if test="category != null and category != ''">
                AND b.category = #{category}
            </if>
    </select>
    <select id="getBoardById" parameterType="long" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.board_type,
            b.title,
            b.content,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.attachment_path,
            b.attachment_name,
            b.attachment_size,
            b.is_notice,
            b.is_secret,
            COALESCE(b.is_active, true) as is_active,
            COALESCE(b.is_deleted, false) as is_deleted,
            b.status,
            b.category,
            b.sub_category,
            b.priority,
            b.is_pinned,
            b.parent_board_id,
            b.reply_depth,
            b.reply_order,
            b.tags,
            b.meta_description,
            b.meta_keywords,
            b.created_at,
            b.updated_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            b.board_id = #{boardId}
            AND COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
    </select>
    <select id="getBoardByIdIncludeDeleted" parameterType="long" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.board_type,
            b.title,
            b.content,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.attachment_path,
            b.attachment_name,
            b.attachment_size,
            b.is_notice,
            b.is_secret,
            COALESCE(b.is_active, true) as is_active,
            COALESCE(b.is_deleted, false) as is_deleted,
            b.status,
            b.category,
            b.sub_category,
            b.priority,
            b.is_pinned,
            b.parent_board_id,
            b.reply_depth,
            b.reply_order,
            b.tags,
            b.meta_description,
            b.meta_keywords,
            b.created_at,
            b.updated_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            b.board_id = #{boardId}
    </select>
    <insert id="insertBoard" parameterType="com.example.carelink.dto.BoardDTO" useGeneratedKeys="true" keyProperty="boardId">
        INSERT INTO board (
            board_type,
            title,
            content,
            member_id,
            attachment_path,
            attachment_name,
            attachment_size,
            is_notice,
            is_secret,
            is_active,
            is_deleted,
            category,
            sub_category,
            priority,
            is_pinned,
            parent_board_id,
            reply_depth,
            reply_order,
            tags,
            meta_description,
            meta_keywords,
            created_at,
            updated_at
        ) VALUES (
            #{boardType},
            #{title},
            #{content},
            #{memberId},
            #{attachmentPath},
            #{attachmentName},
            #{attachmentSize},
            #{isNotice},
            #{isSecret},
            #{isActive},
            #{isDeleted},
            #{category},
            #{subCategory},
            COALESCE(#{priority}, 1),
            #{isPinned},
            #{parentBoardId},
            #{replyDepth},
            #{replyOrder},
            #{tags},
            #{metaDescription},
            #{metaKeywords},
            NOW(),
            NOW()
        )
    </insert>
    <update id="updateBoard" parameterType="com.example.carelink.dto.BoardDTO">
        UPDATE board
        SET
            board_type = #{boardType},
            title = #{title},
            content = #{content},
            attachment_path = #{attachmentPath},
            attachment_name = #{attachmentName},
            attachment_size = #{attachmentSize},
            is_notice = #{isNotice},
            is_secret = #{isSecret},
            category = #{category},
            sub_category = #{subCategory},
            priority = COALESCE(#{priority}, 1),
            is_pinned = #{isPinned},
            tags = #{tags},
            meta_description = #{metaDescription},
            meta_keywords = #{metaKeywords},
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
    </update>
    <update id="deleteBoard" parameterType="long">
        UPDATE board
        SET
            is_deleted = true,
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
            AND COALESCE(is_deleted, false) = false
    </update>
    <update id="incrementViewCount" parameterType="long">
        UPDATE board
        SET
            view_count = view_count + 1,
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
            AND COALESCE(is_active, true) = true
            AND COALESCE(is_deleted, false) = false
    </update>
    <update id="increaseViewCount" parameterType="long">
        UPDATE board
        SET
            view_count = view_count + 1,
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
            AND COALESCE(is_active, true) = true
            AND COALESCE(is_deleted, false) = false
    </update>
    <select id="getPopularBoards" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.title,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.category,
            b.is_notice,
            b.is_pinned,
            b.created_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            AND b.created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)
        ORDER BY
            (b.view_count * 0.4 + b.like_count * 0.4 + b.comment_count * 0.2) DESC
        LIMIT 5
    </select>
    <select id="getBoardsByCategory" parameterType="string" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.title,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.category,
            b.is_notice,
            b.is_pinned,
            b.created_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            AND b.category = #{category}
        ORDER BY
            b.created_at DESC
        LIMIT 10
    </select>
    <select id="getPopularBoardsByCategory" parameterType="string" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.title,
            b.member_id,
            m.name as member_name,
            b.view_count,
            b.like_count,
            b.comment_count,
            b.category,
            b.is_notice,
            b.is_pinned,
            b.created_at
        FROM
            board b
            LEFT JOIN member m ON b.member_id = m.member_id
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            AND b.created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)
            <if test="category != null and category != ''">
                AND b.category = #{category}
            </if>
        ORDER BY
            (b.view_count * 0.4 + b.like_count * 0.4 + b.comment_count * 0.2) DESC
        LIMIT 5
    </select>
    <select id="getPreviousBoard" parameterType="long" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.title
        FROM
            board b
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            AND b.board_id &lt; #{boardId}
        ORDER BY
            b.board_id DESC
        LIMIT 1
    </select>
    <select id="getNextBoard" parameterType="long" resultType="com.example.carelink.dto.BoardDTO">
        SELECT
            b.board_id,
            b.title
        FROM
            board b
        WHERE
            COALESCE(b.is_active, true) = true
            AND COALESCE(b.is_deleted, false) = false
            AND b.board_id &gt; #{boardId}
        ORDER BY
            b.board_id ASC
        LIMIT 1
    </select>
    <update id="incrementLikeCount" parameterType="long">
        UPDATE board
        SET
            like_count = like_count + 1,
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
            AND COALESCE(is_active, true) = true
            AND COALESCE(is_deleted, false) = false
    </update>
    <update id="decrementLikeCount" parameterType="long">
        UPDATE board
        SET
            like_count = GREATEST(0, like_count - 1),
            updated_at = NOW()
        WHERE
            board_id = #{boardId}
            AND COALESCE(is_active, true) = true
            AND COALESCE(is_deleted, false) = false
    </update>
    <select id="findBoardsByMemberId" resultMap="boardResultMap">
        SELECT b.*, m.name as author_name
        FROM board b
        LEFT JOIN member m ON b.member_id = m.member_id
        WHERE b.member_id = #{memberId}
          AND b.is_deleted = false
        ORDER BY b.created_at DESC
    </select>
    <delete id="deleteByMemberId" parameterType="long">
        DELETE FROM board WHERE member_id = #{memberId}
    </delete>
</mapper>
`````

## File: src/main/java/com/example/carelink/dto/FacilityDTO.java
`````java
public class FacilityDTO extends BaseDTO {
⋮----
public boolean isNormalStatus() {
return "정상".equals(status);
⋮----
public boolean isDeletedStatus() {
return "삭제됨".equals(status);
⋮----
public boolean isPendingStatus() {
return "승인대기".equals(status);
⋮----
public String getStatusMessage() {
if (isDeletedStatus()) {
⋮----
} else if (isPendingStatus()) {
`````

## File: src/main/java/com/example/carelink/dto/MemberDTO.java
`````java
public class MemberDTO extends BaseDTO {
`````

## File: src/main/java/com/example/carelink/service/JobService.java
`````java
public class JobService {
⋮----
public List<JobDTO> getJobList(int currentPage, String keyword, String jobType) {
log.info("구인구직 목록 조회 시작 - page: {}, keyword: {}, jobType: {}", currentPage, keyword, jobType);
⋮----
JobDTO searchDTO = new JobDTO();
⋮----
searchDTO.setSize(pageSize);
searchDTO.setPage((currentPage - 1) * pageSize);
if (keyword != null && !keyword.trim().isEmpty()) {
searchDTO.setSearchKeyword(keyword.trim());
⋮----
if (jobType != null && !jobType.trim().isEmpty()) {
searchDTO.setJobType(jobType.trim());
⋮----
List<JobDTO> jobList = jobMapper.getJobList(searchDTO);
log.info("구인구직 목록 조회 완료 - 조회된 건수: {}", jobList.size());
⋮----
log.error("구인구직 목록 조회 중 오류 발생", e);
⋮----
public JobDTO getJobById(Long id) {
log.info("구인구직 상세 조회 시작 - jobId: {}", id);
⋮----
JobDTO job = jobMapper.findJobById(id);
⋮----
log.warn("구인구직 정보를 찾을 수 없습니다 - jobId: {}", id);
throw new RuntimeException("해당 구인구직 정보를 찾을 수 없습니다. ID: " + id);
⋮----
log.info("구인구직 상세 조회 완료 - jobId: {}, title: {}", id, job.getTitle());
⋮----
log.error("구인구직 상세 조회 중 오류 발생 - jobId: {}", id, e);
JobDTO job = new JobDTO();
job.setJobId(id);
job.setTitle("구인구직 정보를 불러오는 중 오류가 발생했습니다");
job.setContent("시스템 오류로 인해 상세 정보를 불러올 수 없습니다. 잠시 후 다시 시도해주세요.");
job.setJobType("RECRUIT");
job.setWorkType("FULL_TIME");
job.setPosition("미정");
job.setSalaryMin(java.math.BigDecimal.ZERO);
job.setSalaryMax(java.math.BigDecimal.ZERO);
job.setWorkLocation("미정");
job.setStatus("ACTIVE");
job.setMemberId(1L);
job.setViewCount(0);
⋮----
public int insertJob(JobDTO jobDTO) {
log.info("구인구직 등록 시작 - title: {}, jobType: {}", jobDTO.getTitle(), jobDTO.getJobType());
⋮----
validateJobData(jobDTO);
cleanAndValidateJobData(jobDTO);
if (jobDTO.getStatus() == null) {
jobDTO.setStatus("ACTIVE");
⋮----
if (jobDTO.getPriority() == null) {
jobDTO.setPriority(0);
⋮----
int result = jobMapper.insertJob(jobDTO);
log.info("구인구직 등록 완료 - jobId: {}", jobDTO.getJobId());
⋮----
log.error("구인구직 등록 중 오류 발생", e);
throw new RuntimeException("구인구직 등록 중 오류가 발생했습니다.", e);
⋮----
public int updateJob(JobDTO jobDTO) {
log.info("구인구직 수정 시작 - jobId: {}, title: {}", jobDTO.getJobId(), jobDTO.getTitle());
⋮----
JobDTO existingJob = jobMapper.findJobById(jobDTO.getJobId());
⋮----
throw new RuntimeException("수정할 구인구직을 찾을 수 없습니다. ID: " + jobDTO.getJobId());
⋮----
log.warn("priority 값이 null이어서 0으로 자동 설정되었습니다. jobId: {}", jobDTO.getJobId());
⋮----
int result = jobMapper.updateJob(jobDTO);
log.info("구인구직 수정 완료 - jobId: {}", jobDTO.getJobId());
⋮----
log.error("구인구직 수정 중 오류 발생 - jobId: {}", jobDTO.getJobId(), e);
throw new RuntimeException("구인구직 수정 중 오류가 발생했습니다.", e);
⋮----
public int deleteJob(Long id) {
log.info("구인구직 삭제 시작 - jobId: {}", id);
⋮----
int result = jobMapper.deleteJob(id);
log.info("구인구직 삭제 완료 - jobId: {}", id);
⋮----
log.error("구인구직 삭제 중 오류 발생 - jobId: {}", id, e);
throw new RuntimeException("구인구직 삭제 중 오류가 발생했습니다.", e);
⋮----
public List<JobDTO> getPopularJobs() {
⋮----
return jobMapper.getPopularJobs();
⋮----
log.error("인기 구인구직 조회 중 오류 발생", e);
⋮----
public int getJobCount() {
⋮----
return jobMapper.getJobCount();
⋮----
log.error("구인구직 수 조회 중 오류 발생", e);
⋮----
private void validateJobData(JobDTO jobDTO) {
if (jobDTO.getTitle() == null || jobDTO.getTitle().trim().isEmpty()) {
throw new IllegalArgumentException("제목은 필수 입력값입니다.");
⋮----
if (jobDTO.getContent() == null || jobDTO.getContent().trim().isEmpty()) {
throw new IllegalArgumentException("내용은 필수 입력값입니다.");
⋮----
if (jobDTO.getJobType() == null || jobDTO.getJobType().trim().isEmpty()) {
throw new IllegalArgumentException("구인구직 유형은 필수 입력값입니다.");
⋮----
if (jobDTO.getMemberId() == null) {
throw new IllegalArgumentException("작성자 정보가 필요합니다.");
⋮----
private void cleanAndValidateJobData(JobDTO jobDTO) {
log.info("데이터 정리 시작 - jobId: {}", jobDTO.getJobId());
if (jobDTO.getTitle() != null) {
jobDTO.setTitle(jobDTO.getTitle().trim());
⋮----
if (jobDTO.getContent() != null) {
jobDTO.setContent(jobDTO.getContent().trim());
⋮----
if (jobDTO.getSalaryDescription() != null && !jobDTO.getSalaryDescription().trim().isEmpty()) {
String cleanSalaryDesc = cleanDuplicateValues(jobDTO.getSalaryDescription());
jobDTO.setSalaryDescription(cleanSalaryDesc);
log.debug("급여 설명 정리됨: {} -> {}", jobDTO.getSalaryDescription(), cleanSalaryDesc);
⋮----
if (jobDTO.getWorkHours() != null && !jobDTO.getWorkHours().trim().isEmpty()) {
String cleanWorkHours = cleanDuplicateValues(jobDTO.getWorkHours());
jobDTO.setWorkHours(cleanWorkHours);
log.debug("근무시간 정리됨: {} -> {}", jobDTO.getWorkHours(), cleanWorkHours);
⋮----
if (jobDTO.getFacilityName() != null) {
jobDTO.setFacilityName(jobDTO.getFacilityName().trim());
⋮----
if (jobDTO.getWorkLocation() != null) {
jobDTO.setWorkLocation(jobDTO.getWorkLocation().trim());
⋮----
if (jobDTO.getContactPhone() != null) {
jobDTO.setContactPhone(jobDTO.getContactPhone().trim());
⋮----
if (jobDTO.getQualifications() != null && !jobDTO.getQualifications().trim().isEmpty()) {
String cleanQualifications = cleanDuplicateValues(jobDTO.getQualifications());
jobDTO.setQualifications(cleanQualifications);
⋮----
log.info("데이터 정리 완료 - jobId: {}", jobDTO.getJobId());
⋮----
private String cleanDuplicateValues(String input) {
if (input == null || input.trim().isEmpty()) {
⋮----
String[] values = input.split(",");
return java.util.Arrays.stream(values)
.map(String::trim)
.filter(s -> !s.isEmpty())
.distinct()
.collect(java.util.stream.Collectors.joining(", "));
⋮----
log.warn("값 정리 중 오류 발생, 원본 값 반환: {}", input, e);
return input.trim();
⋮----
public void applyForJob(Long jobId, Long applicantMemberId) {
log.info("구인공고 지원 로직 시작 - jobId: {}, applicantMemberId: {}", jobId, applicantMemberId);
JobDTO jobDTO = jobMapper.findJobById(jobId);
⋮----
log.warn("지원할 구인공고를 찾을 수 없습니다 - jobId: {}", jobId);
throw new IllegalArgumentException("지원할 구인공고를 찾을 수 없습니다.");
⋮----
int existingApplications = jobApplicationMapper.countByJobIdAndApplicantMemberId(jobId, applicantMemberId);
⋮----
log.warn("이미 지원한 구인공고입니다 - jobId: {}, applicantMemberId: {}", jobId, applicantMemberId);
throw new IllegalArgumentException("이미 지원한 구인공고입니다.");
⋮----
JobApplicationDTO jobApplication = new JobApplicationDTO();
jobApplication.setJobId(jobId);
jobApplication.setApplicantMemberId(applicantMemberId);
jobApplication.setApplicationDate(LocalDateTime.now());
jobApplication.setStatus("PENDING");
jobApplicationMapper.insertJobApplication(jobApplication);
jobMapper.incrementApplyCount(jobId);
log.info("구인공고 지원 로직 완료 - jobId: {}, applicantMemberId: {}, 생성된 지원 ID: {}",
jobId, applicantMemberId, jobApplication.getId());
`````

## File: src/main/java/com/example/carelink/controller/BoardController.java
`````java
public class BoardController {
⋮----
private final Map<String, Map<String, String>> boardTypeInfo = Map.of(
"notice", Map.of("title", "공지사항", "description", "중요한 공지사항을 확인하세요", "category", "NOTICE"),
"info", Map.of("title", "정보공유", "description", "유용한 정보를 공유하고 함께 나누세요", "category", "INFO"),
"qna", Map.of("title", "Q&A", "description", "궁금한 점을 질문하고 답변을 받아보세요", "category", "QNA"),
"faq", Map.of("title", "자주묻는질문", "description", "자주 묻는 질문과 답변을 확인하세요", "category", "FAQ"),
"all", Map.of("title", "전체 게시판", "description", "모든 게시판의 글을 한번에 확인하세요", "category", "")
⋮----
/**
     * 게시판 목록 페이지 (타입별 구분 지원)
     */
⋮----
public String listPage(Model model,
⋮----
response.setHeader("Cache-Control", "no-cache, no-store, must-revalidate");
response.setHeader("Pragma", "no-cache");
response.setDateHeader("Expires", 0);
Map<String, String> currentBoardInfo = boardTypeInfo.getOrDefault(type, boardTypeInfo.get("all"));
String actualCategory = currentBoardInfo.get("category");
if (category.isEmpty() && !actualCategory.isEmpty()) {
⋮----
PageInfo<BoardDTO> pageInfo = boardService.getBoardList(page, keyword, category);
List<BoardDTO> popularBoards = boardService.getPopularBoardsByCategory(category);
model.addAttribute("pageInfo", pageInfo);
model.addAttribute("boardList", pageInfo.getList());
model.addAttribute("popularBoards", popularBoards != null ? popularBoards : List.of());
model.addAttribute("keyword", keyword != null ? keyword : "");
model.addAttribute("category", category != null ? category : "");
model.addAttribute("type", type);
model.addAttribute("currentPage", page);
⋮----
model.addAttribute("pageInfo", new PageInfo<>(List.of(), page, 10, 0));
model.addAttribute("boardList", List.of());
model.addAttribute("popularBoards", List.of());
⋮----
model.addAttribute("error", "게시글을 불러오는 중 오류가 발생했습니다: " + e.getMessage());
⋮----
model.addAttribute("boardTitle", currentBoardInfo.get("title"));
model.addAttribute("boardDescription", currentBoardInfo.get("description"));
model.addAttribute("pageTitle", currentBoardInfo.get("title"));
if ("faq".equals(type)) {
⋮----
} else if ("notice".equals(type)) {
⋮----
} else if ("qna".equals(type)) {
⋮----
public String writePage(Model model,
⋮----
Long memberId = (Long) session.getAttribute("memberId");
⋮----
redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
⋮----
MemberDTO loginMember = (MemberDTO) session.getAttribute("loginMember");
if (("notice".equals(type) || "faq".equals(type)) &&
(loginMember == null || !"ADMIN".equals(loginMember.getRole()))) {
redirectAttributes.addFlashAttribute("error", "해당 게시판에 글을 작성할 권한이 없습니다.");
⋮----
if ("qna".equals(type) && "ANSWER".equals(qaType) &&
⋮----
redirectAttributes.addFlashAttribute("error", "답변하기는 관리자만 가능합니다.");
⋮----
BoardDTO boardDTO = new BoardDTO();
boardDTO.setMemberId(memberId);
⋮----
String defaultCategory = currentBoardInfo.get("category");
if (!defaultCategory.isEmpty()) {
boardDTO.setCategory(defaultCategory);
⋮----
if ("qna".equals(type) && qaType != null) {
boardDTO.setQaType(qaType);
if ("QUESTION".equals(qaType)) {
boardDTO.setIsAnswered(false);
boardDTO.setAnswerCount(0);
⋮----
model.addAttribute("boardDTO", boardDTO);
⋮----
model.addAttribute("qaType", qaType);
⋮----
String pageTitle = currentBoardInfo.get("title");
⋮----
pageTitle += ("QUESTION".equals(qaType) ? " - 질문하기" : " - 답변하기");
⋮----
model.addAttribute("pageTitle", pageTitle);
⋮----
} else if ("info".equals(type)) {
⋮----
public String writeBoard(@ModelAttribute BoardDTO boardDTO,
⋮----
} else if ("ANSWER".equals(qaType)) {
boardDTO.setIsAnswered(null);
boardDTO.setAnswerCount(null);
⋮----
if (boardDTO.getIsNotice() == null) {
boardDTO.setIsNotice(false);
⋮----
if (boardDTO.getIsSecret() == null) {
boardDTO.setIsSecret(false);
⋮----
if (boardDTO.getIsActive() == null) {
boardDTO.setIsActive(true);
⋮----
if (boardDTO.getIsDeleted() == null) {
boardDTO.setIsDeleted(false);
⋮----
boardService.insertBoard(boardDTO);
if (imageFiles != null && !imageFiles.isEmpty()) {
imageFiles.removeIf(file -> file.isEmpty());
if (!imageFiles.isEmpty()) {
⋮----
List<BoardImageDTO> uploadedImages = boardImageService.uploadImages(
boardDTO.getBoardId(), imageFiles, imageAltTexts);
log.info("게시글 이미지 업로드 성공: boardId={}, imageCount={}",
boardDTO.getBoardId(), uploadedImages.size());
⋮----
log.error("게시글 이미지 업로드 실패: boardId={}", boardDTO.getBoardId(), e);
⋮----
successMessage = "QUESTION".equals(qaType) ? "질문이 성공적으로 등록되었습니다." : "답변이 성공적으로 등록되었습니다.";
⋮----
redirectAttributes.addFlashAttribute("message", successMessage);
if ("all".equals(type)) {
⋮----
redirectAttributes.addFlashAttribute("error", "게시글 등록 중 오류가 발생했습니다: " + e.getMessage());
⋮----
public String detailPage(@PathVariable Long id,
⋮----
BoardDTO board = boardService.getBoardById(id);
boardService.incrementViewCount(id);
BoardDTO prevBoard = boardService.getPreviousBoard(id);
BoardDTO nextBoard = boardService.getNextBoard(id);
List<BoardImageDTO> boardImages = boardImageService.getImagesByBoardId(id);
model.addAttribute("board", board);
model.addAttribute("boardImages", boardImages);
model.addAttribute("prevBoard", prevBoard);
model.addAttribute("nextBoard", nextBoard);
⋮----
model.addAttribute("page", page);
model.addAttribute("pageTitle", board.getTitle());
⋮----
log.error("게시글 상세보기 오류 - boardId: {}", id, e);
redirectAttributes.addFlashAttribute("error", "게시글을 불러올 수 없습니다: " + e.getMessage());
⋮----
public String editPage(@PathVariable Long id,
⋮----
BoardDTO board = boardService.getBoardByIdIncludeDeleted(id);
⋮----
redirectAttributes.addFlashAttribute("error", "수정할 게시글을 찾을 수 없습니다.");
⋮----
if (board.getIsDeleted() != null && board.getIsDeleted()) {
redirectAttributes.addFlashAttribute("error", "삭제된 게시글은 수정할 수 없습니다.");
⋮----
log.info("수정 페이지 접근 - 게시글 ID: {}, 작성자 ID: {}, 요청자 ID: {}", id, board.getMemberId(), memberId);
⋮----
boolean isAdmin = loginMember != null && "ADMIN".equals(loginMember.getRole());
boolean isAuthor = board.getMemberId().equals(memberId);
if (("NOTICE".equals(board.getCategory()) || "FAQ".equals(board.getCategory())) && !isAdmin) {
log.warn("권한 없는 수정 시도 - 공지사항/FAQ 수정 권한 없음. 요청자: {}", memberId);
redirectAttributes.addFlashAttribute("error", "해당 게시글을 수정할 권한이 없습니다.");
⋮----
log.warn("권한 없는 수정 시도 - 게시글 작성자: {}, 요청자: {}", board.getMemberId(), memberId);
redirectAttributes.addFlashAttribute("error", "작성자만 수정할 수 있습니다.");
⋮----
Map<String, String> currentBoardInfo = boardTypeInfo.getOrDefault(type != null ? type : "all", boardTypeInfo.get("all"));
model.addAttribute("boardDTO", board);
model.addAttribute("type", type != null ? type : "all");
⋮----
model.addAttribute("pageTitle", currentBoardInfo.get("title") + " 수정");
⋮----
log.error("수정 페이지 로드 중 오류 발생 - boardId: {}", id, e);
redirectAttributes.addFlashAttribute("error", "수정 페이지를 불러오는 중 오류가 발생했습니다: " + e.getMessage());
⋮----
public String editBoard(@PathVariable Long id,
⋮----
BoardDTO existingBoard = boardService.getBoardByIdIncludeDeleted(id);
⋮----
return getRedirectUrl(type);
⋮----
if (existingBoard.getIsDeleted() != null && existingBoard.getIsDeleted()) {
⋮----
log.info("수정 요청 - 게시글 ID: {}, 작성자 ID: {}, 요청자 ID: {}", id, existingBoard.getMemberId(), memberId);
⋮----
boolean isAuthor = existingBoard.getMemberId().equals(memberId);
if (("NOTICE".equals(existingBoard.getCategory()) || "FAQ".equals(existingBoard.getCategory())) && !isAdmin) {
⋮----
log.warn("권한 없는 수정 시도 - 게시글 작성자: {}, 요청자: {}", existingBoard.getMemberId(), memberId);
⋮----
boardDTO.setBoardId(id);
⋮----
boardService.updateBoard(boardDTO);
log.info("수정 완료 - 게시글 ID: {}", id);
redirectAttributes.addFlashAttribute("message", "✅ 게시글이 성공적으로 수정되었습니다.");
⋮----
log.error("수정 처리 중 오류 발생 - boardId: {}", id, e);
redirectAttributes.addFlashAttribute("error", "❌ 게시글 수정 중 오류가 발생했습니다: " + e.getMessage());
⋮----
public String deleteBoard(@PathVariable Long id,
⋮----
log.info("🚀 삭제 요청 시작 - 게시글 ID: {}", id);
⋮----
log.info("🔍 세션 확인 - memberId: {}", memberId);
⋮----
log.warn("❌ 로그인 안됨 - 삭제 실패");
⋮----
log.info("🔍 게시글 조회 결과 - board: {}", board != null ? "존재함" : "없음");
⋮----
log.warn("❌ 게시글 없음 - 삭제 실패");
redirectAttributes.addFlashAttribute("error", "게시글을 찾을 수 없습니다.");
⋮----
log.info("🔍 권한 체크 - 게시글 작성자: {}, 요청자: {}", board.getMemberId(), memberId);
log.info("삭제 요청 - 게시글 ID: {}, 작성자 ID: {}, 요청자 ID: {}", id, board.getMemberId(), memberId);
⋮----
log.warn("❌ 권한 없는 삭제 시도 - 공지사항/FAQ 삭제 권한 없음. 요청자: {}", memberId);
redirectAttributes.addFlashAttribute("error", "해당 게시글을 삭제할 권한이 없습니다.");
⋮----
log.warn("❌ 권한 없는 삭제 시도 - 게시글 작성자: {}, 요청자: {}", board.getMemberId(), memberId);
redirectAttributes.addFlashAttribute("error", "작성자만 삭제할 수 있습니다.");
⋮----
log.info("✅ 권한 체크 통과 - 삭제 진행");
Map<String, Object> deleteResult = boardService.deleteBoard(id);
Boolean success = (Boolean) deleteResult.get("success");
String message = (String) deleteResult.get("message");
log.info("삭제 결과 - 성공: {}, 메시지: {}", success, message);
⋮----
redirectAttributes.addFlashAttribute("message", "✅ " + message);
⋮----
redirectAttributes.addFlashAttribute("error", "❌ " + message);
⋮----
log.error("게시글 삭제 처리 중 오류 발생 - boardId: {}", id, e);
redirectAttributes.addFlashAttribute("error", "❌ 게시글 삭제 중 오류가 발생했습니다: " + e.getMessage());
⋮----
private String getRedirectUrl(String type) {
⋮----
public Map<String, Object> toggleLike(@PathVariable Long id,
⋮----
if ("like".equals(action)) {
boardService.incrementLikeCount(id);
result.put("success", true);
result.put("message", "추천되었습니다.");
} else if ("dislike".equals(action)) {
boardService.decrementLikeCount(id);
⋮----
result.put("message", "추천이 취소되었습니다.");
⋮----
result.put("success", false);
result.put("message", "처리 중 오류가 발생했습니다.");
⋮----
public Map<String, Object> debugBoardStatus(@PathVariable Long id) {
⋮----
log.info("🔧 디버그 API 호출 - boardId: {}", id);
⋮----
result.put("error", "게시글을 찾을 수 없습니다");
log.warn("🔧 디버그 - 게시글을 찾을 수 없음: {}", id);
⋮----
result.put("boardId", board.getBoardId());
result.put("title", board.getTitle());
result.put("isDeleted", board.getIsDeleted());
result.put("isDeletedType", board.getIsDeleted() != null ? board.getIsDeleted().getClass().getSimpleName() : "null");
result.put("isDeletedValue", board.getIsDeleted() != null ? board.getIsDeleted().toString() : "null");
result.put("isActive", board.getIsActive());
result.put("isActiveType", board.getIsActive() != null ? board.getIsActive().getClass().getSimpleName() : "null");
result.put("createdAt", board.getCreatedAt());
boolean wouldBeDeleted = board.getIsDeleted() != null && board.getIsDeleted();
result.put("wouldBeConsideredDeleted", wouldBeDeleted);
log.info("🔧 디버그 결과 - boardId: {}, isDeleted: {}, wouldBeDeleted: {}",
id, board.getIsDeleted(), wouldBeDeleted);
⋮----
log.error("🔧 디버그 API 오류 - boardId: {}", id, e);
result.put("error", "오류 발생: " + e.getMessage());
⋮----
private MemberDTO getCurrentMember(HttpSession session) {
return (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
⋮----
private Long getCurrentMemberId(HttpSession session) {
return (Long) session.getAttribute("memberId");
⋮----
private boolean isAdmin(HttpSession session) {
MemberDTO loginMember = getCurrentMember(session);
return loginMember != null && "ADMIN".equals(loginMember.getRole());
⋮----
private boolean hasEditPermission(HttpSession session, Long authorMemberId) {
Long currentMemberId = getCurrentMemberId(session);
return (currentMemberId != null && currentMemberId.equals(authorMemberId)) || isAdmin(session);
⋮----
public ResponseEntity<?> uploadImages(@PathVariable Long boardId,
⋮----
Long memberId = getCurrentMemberId(session);
⋮----
return ResponseEntity.status(HttpStatus.UNAUTHORIZED)
.body(Map.of("error", "로그인이 필요합니다."));
⋮----
BoardDTO board = boardService.getBoardById(boardId);
⋮----
return ResponseEntity.status(HttpStatus.NOT_FOUND)
.body(Map.of("error", "게시글을 찾을 수 없습니다."));
⋮----
if (!hasEditPermission(session, board.getMemberId())) {
return ResponseEntity.status(HttpStatus.FORBIDDEN)
.body(Map.of("error", "해당 게시글의 이미지를 업로드할 권한이 없습니다."));
⋮----
imageFiles.removeIf(MultipartFile::isEmpty);
if (imageFiles.isEmpty()) {
return ResponseEntity.badRequest()
.body(Map.of("error", "업로드할 이미지가 없습니다."));
⋮----
data.put("imageId", image.getImageId());
data.put("webpPath", image.getWebpPath());
data.put("fallbackPath", image.getFallbackJpgPath());
data.put("thumbnailSmall", image.getThumbnailSmall());
data.put("thumbnailMedium", image.getThumbnailMedium());
data.put("altText", image.getAltText());
data.put("fileSize", image.getReadableFileSize());
data.put("compressionRate", String.format("%.1f%%", image.getCompressionRate()));
imageData.add(data);
⋮----
return ResponseEntity.ok(Map.of(
⋮----
"message", uploadedImages.size() + "개 이미지가 업로드되었습니다.",
⋮----
.body(Map.of("error", e.getMessage()));
⋮----
log.error("이미지 업로드 API 오류: boardId={}", boardId, e);
return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
.body(Map.of("error", "이미지 업로드 중 오류가 발생했습니다."));
⋮----
public ResponseEntity<?> deleteImage(@PathVariable Long imageId,
⋮----
BoardImageDTO image = boardImageService.getImagesByBoardId(null).stream()
.filter(img -> img.getImageId().equals(imageId))
.findFirst()
.orElse(null);
⋮----
.body(Map.of("error", "이미지를 찾을 수 없습니다."));
⋮----
BoardDTO board = boardService.getBoardById(image.getBoardId());
⋮----
.body(Map.of("error", "해당 이미지를 삭제할 권한이 없습니다."));
⋮----
boardImageService.deleteImage(imageId);
⋮----
log.error("이미지 삭제 API 오류: imageId={}", imageId, e);
⋮----
.body(Map.of("error", "이미지 삭제 중 오류가 발생했습니다."));
`````

## File: src/main/java/com/example/carelink/controller/JobController.java
`````java
public class JobController {
⋮----
public String listPage(Model model,
⋮----
List<JobDTO> jobList = jobService.getJobList(page, keyword, jobType);
model.addAttribute("jobList", jobList);
model.addAttribute("keyword", keyword);
model.addAttribute("jobType", jobType);
model.addAttribute("currentPage", page);
⋮----
public String writePage(@RequestParam(defaultValue = "RECRUIT") String type, Model model, HttpSession session) {
MemberDTO loggedInMember = getCurrentMember(session);
⋮----
session.setAttribute("errorMessage", "로그인 후 이용해주세요.");
⋮----
if ("FACILITY".equals(loggedInMember.getRole())) {
⋮----
} else if ("USER".equals(loggedInMember.getRole())) {
⋮----
JobDTO jobDTO = new JobDTO();
jobDTO.setJobType(defaultType);
model.addAttribute("jobDTO", jobDTO);
model.addAttribute("selectedType", defaultType);
model.addAttribute("currentMember", loggedInMember);
⋮----
public String writeJob(@ModelAttribute JobDTO jobDTO, HttpSession session) {
⋮----
String jobType = jobDTO.getJobType();
String userRole = loggedInMember.getRole();
if ("FACILITY".equals(userRole) && "SEARCH".equals(jobType)) {
session.setAttribute("errorMessage", "시설회원은 구인공고만 작성할 수 있습니다.");
⋮----
if ("USER".equals(userRole) && "RECRUIT".equals(jobType)) {
session.setAttribute("errorMessage", "일반회원은 구직공고만 작성할 수 있습니다.");
⋮----
if (jobDTO.getStatus() == null || jobDTO.getStatus().isEmpty()) {
jobDTO.setStatus("ACTIVE");
⋮----
jobDTO.setMemberId(loggedInMember.getMemberId());
if (jobDTO.getPriority() == null) {
jobDTO.setPriority(0);
⋮----
jobService.insertJob(jobDTO);
session.setAttribute("successMessage", "공고가 성공적으로 등록되었습니다.");
⋮----
session.setAttribute("errorMessage", "공고 등록 중 오류가 발생했습니다. 다시 시도해주세요.");
⋮----
public String detailPage(@PathVariable Long id, Model model, HttpSession session) {
⋮----
JobDTO job = jobService.getJobById(id);
⋮----
session.setAttribute("errorMessage", "해당 구인공고를 찾을 수 없습니다.");
⋮----
if (job.getContent() != null) {
formattedContent = job.getContent().replace(System.lineSeparator(), "<br>");
formattedContent = formattedContent.replace("\n", "<br>");
⋮----
model.addAttribute("formattedJobContent", formattedContent);
MemberDTO loggedInMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
if (loggedInMember == null || !job.getMemberId().equals(loggedInMember.getMemberId())) {
⋮----
model.addAttribute("job", job);
⋮----
e.printStackTrace();
session.setAttribute("errorMessage", "구인공고 조회 중 오류가 발생했습니다.");
⋮----
public String editPage(@PathVariable Long id, Model model, HttpSession session) {
⋮----
if (!canEditJob(loggedInMember, job.getMemberId())) {
session.setAttribute("errorMessage", "수정 권한이 없습니다. 작성자 또는 관리자만 수정할 수 있습니다.");
⋮----
model.addAttribute("jobDTO", job);
⋮----
public String editJob(@PathVariable Long id, @ModelAttribute JobDTO jobDTO, HttpSession session) {
⋮----
JobDTO existingJob = jobService.getJobById(id);
⋮----
if (!canEditJob(loggedInMember, existingJob.getMemberId())) {
⋮----
jobDTO.setJobId(id);
⋮----
jobService.updateJob(jobDTO);
⋮----
public String deleteJob(@PathVariable Long id, HttpSession session) {
⋮----
boolean isOwner = existingJob.getMemberId().equals(loggedInMember.getMemberId());
boolean isAdmin = "ADMIN".equals(loggedInMember.getRole());
⋮----
session.setAttribute("errorMessage", "삭제 권한이 없습니다. 작성자만 삭제할 수 있습니다.");
⋮----
jobService.deleteJob(id);
session.setAttribute("successMessage", "구인공고가 삭제되었습니다.");
⋮----
public String applyForJob(@PathVariable Long id, HttpSession session, RedirectAttributes redirectAttributes) {
⋮----
redirectAttributes.addFlashAttribute("errorMessage", "로그인 후 이용해주세요.");
⋮----
if (!"USER".equals(loggedInMember.getRole())) {
redirectAttributes.addFlashAttribute("errorMessage", "개인 회원만 구인공고에 지원할 수 있습니다.");
⋮----
jobService.applyForJob(id, loggedInMember.getMemberId());
redirectAttributes.addFlashAttribute("successMessage", "구인공고 지원이 완료되었습니다!");
⋮----
redirectAttributes.addFlashAttribute("errorMessage", e.getMessage());
⋮----
redirectAttributes.addFlashAttribute("errorMessage", "구인공고 지원 중 오류가 발생했습니다. 다시 시도해주세요.");
⋮----
private MemberDTO getCurrentMember(HttpSession session) {
return (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
⋮----
private boolean canWriteRecruit(MemberDTO member) {
return member != null && ("FACILITY".equals(member.getRole()) || "ADMIN".equals(member.getRole()));
⋮----
private boolean canWriteSearch(MemberDTO member) {
return member != null && ("USER".equals(member.getRole()) || "ADMIN".equals(member.getRole()));
⋮----
private boolean canEditJob(MemberDTO member, Long authorId) {
return member != null && (member.getMemberId().equals(authorId) || "ADMIN".equals(member.getRole()));
⋮----
private boolean canApplyOrContact(MemberDTO member, Long authorId) {
return member != null && !member.getMemberId().equals(authorId);
⋮----
private boolean isAdmin(MemberDTO member) {
return member != null && "ADMIN".equals(member.getRole());
`````

## File: src/main/java/com/example/carelink/controller/ReviewController.java
`````java
public class ReviewController {
⋮----
public String listPage(Model model,
⋮----
log.info("리뷰 목록 페이지 접속 - page: {}, keyword: {}, minRating: {}, facilityId: {}",
⋮----
PageInfo<ReviewDTO> pageInfo = reviewService.getReviewList(page, keyword, minRating, facilityId);
model.addAttribute("pageInfo", pageInfo);
model.addAttribute("reviewList", pageInfo.getList());
model.addAttribute("keyword", keyword != null ? keyword : "");
model.addAttribute("minRating", minRating);
model.addAttribute("facilityId", facilityId);
model.addAttribute("currentPage", page);
model.addAttribute("pageTitle", "시설 리뷰");
⋮----
FacilityDTO facility = facilityService.getFacilityById(facilityId);
model.addAttribute("selectedFacility", facility);
model.addAttribute("pageTitle", facility.getFacilityName() + " 리뷰");
⋮----
log.warn("시설 정보 조회 실패 - facilityId: {}", facilityId, e);
⋮----
log.error("리뷰 목록 조회 중 오류 발생", e);
model.addAttribute("pageInfo", new PageInfo<>(List.of(), page, 10, 0));
model.addAttribute("reviewList", List.of());
⋮----
model.addAttribute("error", "리뷰를 불러오는 중 오류가 발생했습니다: " + e.getMessage());
⋮----
public String writePage(Model model,
⋮----
MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
⋮----
log.warn("로그인하지 않은 사용자의 리뷰 작성 페이지 접속 시도");
redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
⋮----
log.info("리뷰 작성 페이지 접속 - facilityId: {}", facilityId);
ReviewDTO reviewDTO = new ReviewDTO();
List<FacilityDTO> facilityList = facilityService.getAllActiveFacilities();
log.info("활성화된 시설 목록 조회 완료 - 조회된 건수: {}", facilityList.size());
⋮----
FacilityDTO selectedFacility = facilityService.getFacilityById(facilityId);
⋮----
log.info("선택된 시설 정보 조회 성공 - facilityId: {}, facilityName: {}, status: {}",
facilityId, selectedFacility.getFacilityName(), selectedFacility.getStatus());
if ("삭제됨".equals(selectedFacility.getStatus())) {
model.addAttribute("error", "선택하신 시설은 삭제되어 리뷰를 작성할 수 없습니다.");
} else if ("승인대기".equals(selectedFacility.getStatus())) {
model.addAttribute("error", "선택하신 시설은 아직 승인되지 않아 리뷰를 작성할 수 없습니다.");
⋮----
reviewDTO.setFacilityId(facilityId);
model.addAttribute("selectedFacility", selectedFacility);
⋮----
log.warn("선택된 시설을 찾을 수 없음 - facilityId: {}", facilityId);
model.addAttribute("error", "선택하신 시설을 찾을 수 없습니다.");
⋮----
model.addAttribute("reviewDTO", reviewDTO);
model.addAttribute("facilityList", facilityList);
model.addAttribute("pageTitle", "리뷰 작성");
⋮----
log.error("리뷰 작성 페이지 로딩 중 오류 발생", e);
model.addAttribute("error", "리뷰 작성 페이지를 불러오는 중 오류가 발생했습니다: " + e.getMessage());
⋮----
public String writeReview(@ModelAttribute ReviewDTO reviewDTO,
⋮----
log.info("리뷰 등록 요청 - title: {}, facilityId: {}", reviewDTO.getTitle(), reviewDTO.getFacilityId());
⋮----
log.warn("로그인하지 않은 사용자의 리뷰 작성 시도");
⋮----
reviewDTO.setMemberId(loginMember.getMemberId());
log.info("리뷰 작성자 설정 - memberId: {}, userId: {}", loginMember.getMemberId(), loginMember.getUserId());
if (reviewDTO.getFacilityId() == null) {
log.warn("시설이 선택되지 않음");
redirectAttributes.addFlashAttribute("error", "시설을 선택해주세요.");
redirectAttributes.addFlashAttribute("reviewDTO", reviewDTO);
⋮----
FacilityDTO facility = facilityService.getFacilityById(reviewDTO.getFacilityId());
⋮----
log.warn("선택된 시설을 찾을 수 없음 - facilityId: {}", reviewDTO.getFacilityId());
redirectAttributes.addFlashAttribute("error", "선택한 시설을 찾을 수 없습니다.");
⋮----
if (!facilityService.validateFacilityStatus(facility)) {
log.warn("유효하지 않은 시설 상태 - facilityId: {}, status: {}",
facility.getFacilityId(), facility.getStatus());
redirectAttributes.addFlashAttribute("error", facility.getStatusMessage());
⋮----
log.info("시설 정보 확인 완료 - facilityId: {}, facilityName: {}, status: {}",
facility.getFacilityId(), facility.getFacilityName(), facility.getStatus());
if (reviewDTO.getTitle() == null || reviewDTO.getTitle().trim().isEmpty()) {
log.warn("제목이 입력되지 않음");
redirectAttributes.addFlashAttribute("error", "제목을 입력해주세요.");
⋮----
return "redirect:/review/write?facilityId=" + reviewDTO.getFacilityId();
⋮----
if (reviewDTO.getContent() == null || reviewDTO.getContent().trim().length() < 10) {
log.warn("내용이 10자 미만임");
redirectAttributes.addFlashAttribute("error", "내용을 10자 이상 입력해주세요.");
⋮----
if (reviewDTO.getRating() == null || reviewDTO.getRating() < 1 || reviewDTO.getRating() > 5) {
log.warn("평점이 유효하지 않음 - rating: {}", reviewDTO.getRating());
redirectAttributes.addFlashAttribute("error", "평점을 선택해주세요.");
⋮----
reviewService.insertReview(reviewDTO);
log.info("리뷰 등록 성공 - reviewId: {}", reviewDTO.getReviewId());
if (imageFiles != null && !imageFiles.isEmpty()) {
imageFiles.removeIf(file -> file.isEmpty());
if (!imageFiles.isEmpty()) {
⋮----
List<ReviewImageDTO> uploadedImages = reviewImageService.uploadImages(
reviewDTO.getReviewId(), imageFiles, imageAltTexts);
log.info("리뷰 이미지 업로드 성공: reviewId={}, imageCount={}",
reviewDTO.getReviewId(), uploadedImages.size());
⋮----
log.error("리뷰 이미지 업로드 실패: reviewId={}", reviewDTO.getReviewId(), e);
⋮----
redirectAttributes.addFlashAttribute("message", "리뷰가 성공적으로 등록되었습니다.");
⋮----
log.error("리뷰 등록 중 오류 발생", e);
redirectAttributes.addFlashAttribute("error", "리뷰 등록 중 오류가 발생했습니다: " + e.getMessage());
⋮----
public String detailPage(@PathVariable Long id, Model model, HttpSession session) {
⋮----
ReviewDTO review = reviewService.getReviewById(id);
⋮----
model.addAttribute("error", "리뷰를 찾을 수 없습니다.");
⋮----
reviewService.incrementViewCount(id);
List<ReviewDTO> otherReviews = reviewService.getReviewsByFacilityId(review.getFacilityId())
.stream()
.filter(r -> !r.getReviewId().equals(id))
.limit(5)
.collect(java.util.stream.Collectors.toList());
model.addAttribute("review", review);
model.addAttribute("otherReviews", otherReviews);
model.addAttribute("pageTitle", review.getTitle());
model.addAttribute("currentMemberId", getCurrentMemberId(session));
⋮----
log.error("리뷰 상세보기 중 오류 발생 - reviewId: {}", id, e);
model.addAttribute("error", "리뷰를 불러올 수 없습니다: " + e.getMessage());
⋮----
public String editPage(@PathVariable Long id, Model model, HttpSession session, RedirectAttributes redirectAttributes) {
⋮----
redirectAttributes.addFlashAttribute("error", "수정할 리뷰를 찾을 수 없습니다.");
⋮----
if (!hasEditPermission(session, review.getMemberId())) {
redirectAttributes.addFlashAttribute("error", "작성자 또는 관리자만 수정할 수 있습니다.");
⋮----
model.addAttribute("reviewDTO", review);
model.addAttribute("pageTitle", "리뷰 수정");
⋮----
log.error("리뷰 수정 페이지 로딩 중 오류 발생 - reviewId: {}", id, e);
redirectAttributes.addFlashAttribute("error", "수정 페이지를 불러오는 중 오류가 발생했습니다: " + e.getMessage());
⋮----
public String updateReview(@ModelAttribute ReviewDTO reviewDTO, HttpSession session, RedirectAttributes redirectAttributes) {
⋮----
log.info("리뷰 수정 요청 - reviewId: {}, title: {}", reviewDTO.getReviewId(), reviewDTO.getTitle());
ReviewDTO existingReview = reviewService.getReviewById(reviewDTO.getReviewId());
⋮----
if (!hasEditPermission(session, existingReview.getMemberId())) {
⋮----
return "redirect:/review/detail/" + reviewDTO.getReviewId();
⋮----
return "redirect:/review/edit/" + reviewDTO.getReviewId();
⋮----
reviewDTO.setFacilityId(existingReview.getFacilityId());
reviewDTO.setMemberId(existingReview.getMemberId());
reviewDTO.setViewCount(existingReview.getViewCount());
reviewDTO.setLikeCount(existingReview.getLikeCount());
reviewDTO.setDislikeCount(existingReview.getDislikeCount());
reviewDTO.setCreatedAt(existingReview.getCreatedAt());
reviewService.updateReview(reviewDTO);
log.info("리뷰 수정 성공 - reviewId: {}", reviewDTO.getReviewId());
redirectAttributes.addFlashAttribute("message", "리뷰가 성공적으로 수정되었습니다.");
⋮----
log.error("리뷰 수정 중 오류 발생 - reviewId: {}", reviewDTO.getReviewId(), e);
redirectAttributes.addFlashAttribute("error", "리뷰 수정 중 오류가 발생했습니다: " + e.getMessage());
⋮----
public String deleteReview(@PathVariable Long id, HttpSession session, RedirectAttributes redirectAttributes) {
⋮----
ReviewDTO existingReview = reviewService.getReviewById(id);
⋮----
redirectAttributes.addFlashAttribute("error", "삭제할 리뷰를 찾을 수 없습니다.");
⋮----
redirectAttributes.addFlashAttribute("error", "작성자 또는 관리자만 삭제할 수 있습니다.");
⋮----
reviewService.deleteReview(id);
redirectAttributes.addFlashAttribute("message", "리뷰가 성공적으로 삭제되었습니다.");
⋮----
log.error("리뷰 삭제 중 오류 발생 - reviewId: {}", id, e);
redirectAttributes.addFlashAttribute("error", "리뷰 삭제 중 오류가 발생했습니다: " + e.getMessage());
⋮----
public Map<String, Object> reportReview(@PathVariable Long id, @RequestBody Map<String, String> request, HttpSession session) {
⋮----
String reason = request.get("reason");
if (reason == null || reason.trim().isEmpty()) {
result.put("success", false);
result.put("message", "신고 사유를 입력해주세요.");
⋮----
result.put("message", "신고할 리뷰를 찾을 수 없습니다.");
⋮----
Long currentMemberId = getCurrentMemberId(session);
if (review.getMemberId().equals(currentMemberId)) {
⋮----
result.put("message", "본인이 작성한 리뷰는 신고할 수 없습니다.");
⋮----
log.info("리뷰 신고 접수 - reviewId: {}, reason: {}, reporter: {}", id, reason, currentMemberId);
result.put("success", true);
result.put("message", "신고가 접수되었습니다. 검토 후 적절한 조치를 취하겠습니다.");
⋮----
log.error("리뷰 신고 처리 중 오류 발생 - reviewId: {}", id, e);
⋮----
result.put("message", "신고 처리 중 오류가 발생했습니다.");
⋮----
public Map<String, Object> incrementViewCount(@PathVariable Long id) {
⋮----
log.error("조회수 증가 중 오류 발생 - reviewId: {}", id, e);
⋮----
result.put("message", "조회수 업데이트 중 오류가 발생했습니다.");
⋮----
public Map<String, Object> getReviewsByFacility(@PathVariable Long facilityId,
⋮----
List<ReviewDTO> reviews = reviewService.getReviewsByFacilityId(facilityId);
Double averageRating = reviewService.getAverageRating(facilityId);
⋮----
result.put("reviews", reviews);
result.put("averageRating", averageRating);
result.put("reviewCount", reviews.size());
⋮----
result.put("message", "리뷰를 불러오는 중 오류가 발생했습니다.");
⋮----
public Map<String, Object> likeReview(@PathVariable Long id) {
⋮----
reviewService.likeReview(id);
⋮----
result.put("likeCount", review.getLikeCount());
result.put("message", "추천하였습니다.");
⋮----
result.put("message", "추천 처리 중 오류가 발생했습니다.");
⋮----
public Map<String, Object> dislikeReview(@PathVariable Long id) {
⋮----
reviewService.dislikeReview(id);
⋮----
result.put("dislikeCount", review.getDislikeCount());
result.put("message", "비추천하였습니다.");
⋮----
result.put("message", "비추천 처리 중 오류가 발생했습니다.");
⋮----
private Long getCurrentMemberId(HttpSession session) {
return (Long) session.getAttribute("memberId");
⋮----
private boolean isAdmin(HttpSession session) {
⋮----
return loginMember != null && "ADMIN".equals(loginMember.getRole());
⋮----
private boolean hasEditPermission(HttpSession session, Long authorMemberId) {
⋮----
return (currentMemberId != null && currentMemberId.equals(authorMemberId)) || isAdmin(session);
⋮----
public ResponseEntity<?> uploadReviewImages(@PathVariable Long reviewId,
⋮----
Long memberId = getCurrentMemberId(session);
⋮----
return ResponseEntity.status(HttpStatus.UNAUTHORIZED)
.body(Map.of("error", "로그인이 필요합니다."));
⋮----
ReviewDTO review = reviewService.getReviewById(reviewId);
⋮----
return ResponseEntity.status(HttpStatus.NOT_FOUND)
.body(Map.of("error", "리뷰를 찾을 수 없습니다."));
⋮----
return ResponseEntity.status(HttpStatus.FORBIDDEN)
.body(Map.of("error", "해당 리뷰의 이미지를 업로드할 권한이 없습니다."));
⋮----
imageFiles.removeIf(MultipartFile::isEmpty);
if (imageFiles.isEmpty()) {
return ResponseEntity.badRequest()
.body(Map.of("error", "업로드할 이미지가 없습니다."));
⋮----
data.put("imageId", image.getImageId());
data.put("webpPath", image.getWebpPath());
data.put("fallbackPath", image.getFallbackJpgPath());
data.put("thumbnailSmall", image.getThumbnailSmall());
data.put("thumbnailMedium", image.getThumbnailMedium());
data.put("altText", image.getAltText());
data.put("fileSize", image.getReadableFileSize());
data.put("compressionRate", String.format("%.1f%%", image.getCompressionRate()));
imageData.add(data);
⋮----
return ResponseEntity.ok(Map.of(
⋮----
"message", uploadedImages.size() + "개 이미지가 업로드되었습니다.",
⋮----
.body(Map.of("error", e.getMessage()));
⋮----
log.error("리뷰 이미지 업로드 API 오류: reviewId={}", reviewId, e);
return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
.body(Map.of("error", "이미지 업로드 중 오류가 발생했습니다."));
⋮----
public ResponseEntity<?> deleteReviewImage(@PathVariable Long imageId,
⋮----
List<ReviewImageDTO> images = reviewImageService.getImagesByReviewId(null);
ReviewImageDTO image = images.stream()
.filter(img -> img.getImageId().equals(imageId))
.findFirst()
.orElse(null);
⋮----
.body(Map.of("error", "이미지를 찾을 수 없습니다."));
⋮----
ReviewDTO review = reviewService.getReviewById(image.getReviewId());
⋮----
.body(Map.of("error", "해당 이미지를 삭제할 권한이 없습니다."));
⋮----
reviewImageService.deleteImage(imageId);
⋮----
log.error("리뷰 이미지 삭제 API 오류: imageId={}", imageId, e);
⋮----
.body(Map.of("error", "이미지 삭제 중 오류가 발생했습니다."));
⋮----
public ResponseEntity<?> getFacilityReviewImages(@PathVariable Long facilityId) {
⋮----
List<ReviewImageDTO> images = reviewImageService.getImagesByFacilityId(facilityId);
⋮----
data.put("reviewId", image.getReviewId());
⋮----
"count", images.size()
⋮----
log.error("시설 리뷰 이미지 조회 API 오류: facilityId={}", facilityId, e);
⋮----
.body(Map.of("error", "이미지 조회 중 오류가 발생했습니다."));
`````

## File: src/main/java/com/example/carelink/service/FacilityImageService.java
`````java
public class FacilityImageService {
⋮----
private static final Logger log = LoggerFactory.getLogger(FacilityImageService.class);
⋮----
public List<FacilityImageDTO> getImagesByFacilityId(Long facilityId) {
log.info("시설 이미지 목록 조회 시작 - facilityId: {}", facilityId);
List<FacilityImageDTO> images = facilityImageMapper.getImagesByFacilityId(facilityId);
log.info("시설 이미지 목록 조회 완료 - facilityId: {}, 이미지 수: {}", facilityId, images.size());
⋮----
public FacilityImageDTO getMainImageByFacilityId(Long facilityId) {
log.info("시설 메인 이미지 조회 - facilityId: {}", facilityId);
return facilityImageMapper.getMainImageByFacilityId(facilityId);
⋮----
public void saveFacilityImages(Long facilityId, List<MultipartFile> imageFiles, List<String> altTexts) {
⋮----
log.info("📸 다중 시설 이미지 저장 시작 - facilityId: {}, 요청 이미지 수: {}", facilityId, imageFiles.size());
int existingImageCount = facilityImageMapper.countImagesByFacilityId(facilityId);
⋮----
if (!file.isEmpty() && validFiles.size() + existingImageCount < Constants.MAX_FACILITY_IMAGES) {
validateImageFile(file);
validFiles.add(file);
⋮----
if (validFiles.isEmpty()) {
throw new IllegalArgumentException("저장할 유효한 이미지 파일이 없습니다.");
⋮----
if (existingImageCount + validFiles.size() > Constants.MAX_FACILITY_IMAGES) {
log.warn("⚠️ 일부 이미지는 5장 제한으로 인해 저장되지 않습니다. 기존: {}장, 요청: {}장, 저장 가능: {}장",
existingImageCount, imageFiles.size(), validFiles.size());
⋮----
log.info("📊 이미지 저장 계획 - 기존: {}장, 새로 저장: {}장, 총: {}장",
existingImageCount, validFiles.size(), existingImageCount + validFiles.size());
for (int i = 0; i < validFiles.size(); i++) {
MultipartFile file = validFiles.get(i);
String altText = (altTexts != null && i < altTexts.size()) ? altTexts.get(i) : null;
String imagePath = saveImageFile(file, facilityId.toString(), existingImageCount + i);
FacilityImageDTO imageDTO = new FacilityImageDTO();
imageDTO.setFacilityId(facilityId);
imageDTO.setImagePath(imagePath);
imageDTO.setImageAltText(altText);
imageDTO.setImageOrder(existingImageCount + i);
imageDTO.setIsMainImage(existingImageCount == 0 && i == 0);
facilityImageMapper.insertFacilityImage(imageDTO);
log.info("✅ 시설 이미지 저장 완료 - order: {}, path: {}", existingImageCount + i, imagePath);
⋮----
updateFacilityMainImageInfo(facilityId);
log.info("🎉 다중 시설 이미지 저장 완료 - facilityId: {}, 총 {}장 저장", facilityId, validFiles.size());
⋮----
log.error("❌ 시설 이미지 저장 중 오류 발생 - facilityId: {}", facilityId, e);
throw new RuntimeException("시설 이미지 저장에 실패했습니다.", e);
⋮----
public FacilityImageDTO saveSingleFacilityImage(Long facilityId, MultipartFile imageFile, String altText, Integer imageOrder) {
return saveSingleFacilityImage(facilityId, imageFile, altText, imageOrder, null);
⋮----
public FacilityImageDTO saveSingleFacilityImage(Long facilityId, MultipartFile imageFile, String altText, Integer imageOrder, String customFileName) {
⋮----
log.info("📸 단일 시설 이미지 저장 시작 - facilityId: {}, order: {}, customFileName: '{}'", facilityId, imageOrder, customFileName);
if (imageFile.isEmpty()) {
throw new IllegalArgumentException("업로드된 이미지 파일이 비어있습니다.");
⋮----
throw new IllegalArgumentException(String.format("시설 이미지는 최대 %d장까지만 등록할 수 있습니다. 현재 %d장 등록됨",
⋮----
validateImageFile(imageFile);
String imagePath = saveImageFileWithCustomName(imageFile, facilityId.toString(),
⋮----
imageDTO.setImageOrder(imageOrder != null ? imageOrder : existingImageCount);
imageDTO.setIsMainImage(existingImageCount == 0);
⋮----
log.info("✅ facility_images 테이블에 저장 완료 - imageId: {}, path: {}, 현재 총 {}장",
imageDTO.getImageId(), imagePath, existingImageCount + 1);
⋮----
log.error("❌ 단일 시설 이미지 저장 중 오류 발생 - facilityId: {}", facilityId, e);
⋮----
private void updateFacilityMainImageInfo(Long facilityId) {
⋮----
int imageCount = facilityImageMapper.countImagesByFacilityId(facilityId);
FacilityImageDTO mainImage = facilityImageMapper.getMainImageByFacilityId(facilityId);
String mainImagePath = mainImage != null ? mainImage.getImagePath() : null;
log.info("🔄 시설 테이블 메인 이미지 정보 업데이트 시작 - facilityId: {}, imageCount: {}, mainImagePath: {}",
⋮----
int updateResult = facilityMapper.updateFacilityMainImage(facilityId, mainImagePath, imageCount);
⋮----
log.info("✅ 시설 테이블 업데이트 성공 - facilityId: {}, 업데이트된 행: {}", facilityId, updateResult);
⋮----
log.warn("⚠️ 시설 테이블 업데이트 실패 - facilityId: {}, 업데이트된 행: {}", facilityId, updateResult);
⋮----
log.error("❌ 시설 테이블 메인 이미지 정보 업데이트 중 오류 - facilityId: {}", facilityId, e);
throw new RuntimeException("시설 메인 이미지 정보 업데이트에 실패했습니다.", e);
⋮----
private String saveImageFileWithCustomName(MultipartFile file, String facilityId, int index, String customFileName) {
⋮----
File uploadDirFile = new File(uploadDir);
if (!uploadDirFile.exists()) {
boolean created = uploadDirFile.mkdirs();
log.info("업로드 디렉토리 생성: {} - {}", uploadDir, created ? "성공" : "실패");
⋮----
String originalFilename = file.getOriginalFilename();
⋮----
if (originalFilename != null && originalFilename.contains(".")) {
extension = originalFilename.substring(originalFilename.lastIndexOf("."));
baseName = originalFilename.substring(0, originalFilename.lastIndexOf("."));
⋮----
if (customFileName != null && !customFileName.trim().isEmpty()) {
String userFileName = customFileName.trim();
⋮----
if (userFileName.contains(".")) {
userBaseName = userFileName.substring(0, userFileName.lastIndexOf("."));
userExtension = userFileName.substring(userFileName.lastIndexOf("."));
⋮----
String englishBaseName = convertKoreanToEnglish(userBaseName);
String cleanBaseName = sanitizeFilename(englishBaseName);
finalFileName = String.format("facility_%s_%d_%s_%s%s",
⋮----
UUID.randomUUID().toString().substring(0, 8), userExtension);
log.info("📝 사용자 지정 파일명 적용: '{}' → '{}'", customFileName, finalFileName);
⋮----
return saveImageFile(file, facilityId, index);
⋮----
File savedFile = new File(uploadDir + finalFileName);
file.transferTo(savedFile);
log.info("시설 이미지 파일 저장 완료: {}", savedFile.getAbsolutePath());
⋮----
log.error("시설 이미지 파일 저장 중 오류 발생: facilityId={}, index={}, customFileName={}", facilityId, index, customFileName, e);
throw new RuntimeException("이미지 파일 저장에 실패했습니다.", e);
⋮----
private String saveImageFile(MultipartFile file, String facilityId, int index) {
⋮----
// 한글 파일명을 영문으로 변환
String englishBaseName = convertKoreanToEnglish(baseName);
⋮----
// 최종 파일명 생성
⋮----
if (!cleanBaseName.isEmpty() && !cleanBaseName.equals("facility_image")) {
savedFilename = String.format("facility_%s_%d_%s_%s%s",
facilityId, index, cleanBaseName, UUID.randomUUID().toString().substring(0, 8), extension);
⋮----
savedFilename = String.format("facility_%s_%d_%s%s",
facilityId, index, UUID.randomUUID().toString(), extension);
⋮----
log.info("📝 파일명 변환: '{}' → '{}'", originalFilename, savedFilename);
File savedFile = new File(uploadDir + savedFilename);
⋮----
log.error("시설 이미지 파일 저장 중 오류 발생: facilityId={}, index={}", facilityId, index, e);
⋮----
public void updateMainImage(Long facilityId, Long imageId) {
⋮----
log.info("메인 이미지 변경 시작 - facilityId: {}, imageId: {}", facilityId, imageId);
facilityImageMapper.clearMainImages(facilityId);
int result = facilityImageMapper.updateMainImage(facilityId, imageId);
⋮----
throw new RuntimeException("메인 이미지 설정에 실패했습니다.");
⋮----
log.info("메인 이미지 변경 완료 - facilityId: {}, imageId: {}", facilityId, imageId);
⋮----
log.error("메인 이미지 변경 중 오류 발생 - facilityId: {}, imageId: {}", facilityId, imageId, e);
throw new RuntimeException("메인 이미지 변경에 실패했습니다.", e);
⋮----
public boolean deleteFacilityImage(Long imageId) {
⋮----
log.info("🗑️ 시설 이미지 완전 삭제 시작 - imageId: {}", imageId);
FacilityImageDTO imageToDelete = facilityImageMapper.getImageById(imageId);
⋮----
log.warn("⚠️ 삭제할 이미지를 찾을 수 없음 - imageId: {}", imageId);
⋮----
String imagePath = imageToDelete.getImagePath();
log.info("📁 삭제 대상 파일: {}", imagePath);
int result = facilityImageMapper.deleteFacilityImage(imageId);
⋮----
log.info("✅ DB에서 이미지 삭제 완료 - imageId: {}", imageId);
boolean fileDeleteSuccess = deleteImageFile(imagePath);
⋮----
log.info("✅ 파일 시스템에서 이미지 삭제 완료 - path: {}", imagePath);
⋮----
log.warn("⚠️ 파일 삭제 실패하였지만 DB 삭제는 성공 - path: {}", imagePath);
⋮----
log.warn("❌ DB에서 이미지 삭제 실패 - imageId: {} (결과: {})", imageId, result);
⋮----
log.error("❌ 시설 이미지 삭제 중 오류 발생 - imageId: {}", imageId, e);
⋮----
private boolean deleteImageFile(String imagePath) {
⋮----
if (imagePath == null || imagePath.trim().isEmpty()) {
log.warn("⚠️ 삭제할 파일 경로가 비어있음");
⋮----
if (imagePath.startsWith("/uploads/facility/")) {
String filename = imagePath.substring("/uploads/facility/".length());
⋮----
log.warn("⚠️ 예상치 못한 파일 경로 형식: {}", imagePath);
⋮----
log.info("🔍 실제 파일 경로: {}", actualFilePath);
File fileToDelete = new File(actualFilePath);
if (fileToDelete.exists()) {
boolean deleted = fileToDelete.delete();
⋮----
log.info("✅ 파일 삭제 성공: {}", actualFilePath);
⋮----
log.error("❌ 파일 삭제 실패: {}", actualFilePath);
⋮----
log.warn("⚠️ 삭제할 파일이 존재하지 않음: {}", actualFilePath);
⋮----
log.error("❌ 파일 삭제 중 오류 발생 - imagePath: {}", imagePath, e);
⋮----
public int getImageCountByFacilityId(Long facilityId) {
return facilityImageMapper.countImagesByFacilityId(facilityId);
⋮----
public boolean setMainImage(Long facilityId, Long imageId) {
⋮----
log.info("메인 이미지 설정 시작 - facilityId: {}, imageId: {}", facilityId, imageId);
⋮----
log.info("메인 이미지 설정 완료 - facilityId: {}, imageId: {}", facilityId, imageId);
⋮----
log.warn("메인 이미지 설정 실패 - facilityId: {}, imageId: {} (결과: {})", facilityId, imageId, result);
⋮----
log.error("메인 이미지 설정 중 오류 발생 - facilityId: {}, imageId: {}", facilityId, imageId, e);
⋮----
public FacilityImageDTO getImageById(Long imageId) {
log.info("시설 이미지 조회 - imageId: {}", imageId);
return facilityImageMapper.getImageById(imageId);
⋮----
public List<FacilityImageDTO> getAllImages() {
log.info("모든 시설 이미지 목록 조회 (임시)");
return java.util.Collections.emptyList();
⋮----
private String convertKoreanToEnglish(String korean) {
if (korean == null || korean.trim().isEmpty()) {
⋮----
String input = korean.toLowerCase().trim();
⋮----
java.util.Map<String, String> koreanToEnglish = java.util.Map.ofEntries(
java.util.Map.entry("시설", "facility"),
java.util.Map.entry("요양원", "nursing_home"),
java.util.Map.entry("요양병원", "nursing_hospital"),
java.util.Map.entry("병원", "hospital"),
java.util.Map.entry("의원", "clinic"),
java.util.Map.entry("데이케어", "daycare"),
java.util.Map.entry("센터", "center"),
java.util.Map.entry("홈", "home"),
java.util.Map.entry("케어", "care"),
java.util.Map.entry("외관", "exterior"),
java.util.Map.entry("외부", "exterior"),
java.util.Map.entry("건물", "building"),
java.util.Map.entry("입구", "entrance"),
java.util.Map.entry("현관", "entrance"),
java.util.Map.entry("내부", "interior"),
java.util.Map.entry("로비", "lobby"),
java.util.Map.entry("복도", "corridor"),
java.util.Map.entry("홀", "hall"),
java.util.Map.entry("방", "room"),
java.util.Map.entry("객실", "room"),
java.util.Map.entry("침실", "bedroom"),
java.util.Map.entry("생활실", "living_room"),
java.util.Map.entry("휴게실", "rest_room"),
java.util.Map.entry("식당", "dining_room"),
java.util.Map.entry("주방", "kitchen"),
java.util.Map.entry("카페", "cafe"),
java.util.Map.entry("화장실", "restroom"),
java.util.Map.entry("욕실", "bathroom"),
java.util.Map.entry("세탁실", "laundry"),
java.util.Map.entry("치료실", "treatment_room"),
java.util.Map.entry("의무실", "medical_room"),
java.util.Map.entry("상담실", "consultation_room"),
java.util.Map.entry("간호사실", "nurses_station"),
java.util.Map.entry("재활실", "rehabilitation_room"),
java.util.Map.entry("물리치료실", "physical_therapy_room"),
java.util.Map.entry("운동실", "exercise_room"),
java.util.Map.entry("헬스장", "gym"),
java.util.Map.entry("프로그램실", "program_room"),
java.util.Map.entry("강당", "auditorium"),
java.util.Map.entry("도서실", "library"),
java.util.Map.entry("오락실", "recreation_room"),
java.util.Map.entry("정원", "garden"),
java.util.Map.entry("마당", "yard"),
java.util.Map.entry("테라스", "terrace"),
java.util.Map.entry("발코니", "balcony"),
java.util.Map.entry("주차장", "parking_lot"),
java.util.Map.entry("산책로", "walking_path"),
java.util.Map.entry("엘리베이터", "elevator"),
java.util.Map.entry("계단", "stairs"),
java.util.Map.entry("사무실", "office"),
java.util.Map.entry("접수처", "reception"),
java.util.Map.entry("간호", "nursing"),
java.util.Map.entry("간병", "care"),
java.util.Map.entry("치료", "treatment"),
java.util.Map.entry("재활", "rehabilitation"),
java.util.Map.entry("물리치료", "physical_therapy"),
java.util.Map.entry("건강관리", "health_care"),
java.util.Map.entry("깨끗한", "clean"),
java.util.Map.entry("밝은", "bright"),
java.util.Map.entry("넓은", "spacious"),
java.util.Map.entry("안전한", "safe"),
java.util.Map.entry("편안한", "comfortable"),
java.util.Map.entry("현대적", "modern"),
java.util.Map.entry("고급", "premium"),
java.util.Map.entry("아침", "morning"),
java.util.Map.entry("점심", "lunch"),
java.util.Map.entry("저녁", "evening"),
java.util.Map.entry("앞", "front"),
java.util.Map.entry("뒤", "back"),
java.util.Map.entry("층", "floor"),
java.util.Map.entry("1층", "first_floor"),
java.util.Map.entry("2층", "second_floor"),
java.util.Map.entry("1", "one"),
java.util.Map.entry("2", "two"),
java.util.Map.entry("3", "three"),
java.util.Map.entry("4", "four"),
java.util.Map.entry("5", "five"),
java.util.Map.entry("첫번째", "first"),
java.util.Map.entry("두번째", "second"),
java.util.Map.entry("세번째", "third")
⋮----
for (java.util.Map.Entry<String, String> entry : koreanToEnglish.entrySet()) {
result = result.replace(entry.getKey(), entry.getValue());
⋮----
if (containsKorean(result)) {
result = convertKoreanToRomanization(result);
⋮----
private String convertKoreanToRomanization(String korean) {
⋮----
java.util.Map<String, String> koreanRomanization = java.util.Map.ofEntries(
java.util.Map.entry("ㄱ", "g"), java.util.Map.entry("ㄴ", "n"), java.util.Map.entry("ㄷ", "d"),
java.util.Map.entry("ㄹ", "r"), java.util.Map.entry("ㅁ", "m"), java.util.Map.entry("ㅂ", "b"),
java.util.Map.entry("ㅅ", "s"), java.util.Map.entry("ㅇ", ""), java.util.Map.entry("ㅈ", "j"),
java.util.Map.entry("ㅊ", "ch"), java.util.Map.entry("ㅋ", "k"), java.util.Map.entry("ㅌ", "t"),
java.util.Map.entry("ㅍ", "p"), java.util.Map.entry("ㅎ", "h"),
java.util.Map.entry("ㅏ", "a"), java.util.Map.entry("ㅑ", "ya"), java.util.Map.entry("ㅓ", "eo"),
java.util.Map.entry("ㅕ", "yeo"), java.util.Map.entry("ㅗ", "o"), java.util.Map.entry("ㅛ", "yo"),
java.util.Map.entry("ㅜ", "u"), java.util.Map.entry("ㅠ", "yu"), java.util.Map.entry("ㅡ", "eu"),
java.util.Map.entry("ㅣ", "i"), java.util.Map.entry("ㅐ", "ae"), java.util.Map.entry("ㅔ", "e"),
java.util.Map.entry("가", "ga"), java.util.Map.entry("나", "na"), java.util.Map.entry("다", "da"),
java.util.Map.entry("라", "ra"), java.util.Map.entry("마", "ma"), java.util.Map.entry("바", "ba"),
java.util.Map.entry("사", "sa"), java.util.Map.entry("자", "ja"), java.util.Map.entry("차", "cha"),
java.util.Map.entry("카", "ka"), java.util.Map.entry("타", "ta"), java.util.Map.entry("파", "pa"),
java.util.Map.entry("하", "ha"),
java.util.Map.entry("김", "kim"), java.util.Map.entry("이", "lee"), java.util.Map.entry("박", "park"),
java.util.Map.entry("최", "choi"), java.util.Map.entry("정", "jung"), java.util.Map.entry("강", "kang"),
java.util.Map.entry("조", "cho"), java.util.Map.entry("윤", "yoon"), java.util.Map.entry("장", "jang"),
java.util.Map.entry("임", "lim"), java.util.Map.entry("한", "han"), java.util.Map.entry("오", "oh"),
java.util.Map.entry("서", "seo"), java.util.Map.entry("신", "shin"), java.util.Map.entry("권", "kwon"),
java.util.Map.entry("황", "hwang"), java.util.Map.entry("안", "ahn"), java.util.Map.entry("송", "song"),
java.util.Map.entry("류", "ryu"), java.util.Map.entry("전", "jeon"), java.util.Map.entry("홍", "hong")
⋮----
for (java.util.Map.Entry<String, String> entry : koreanRomanization.entrySet()) {
⋮----
result = "korean_" + System.currentTimeMillis() % 10000;
⋮----
private String sanitizeFilename(String filename) {
if (filename == null || filename.trim().isEmpty()) {
⋮----
String sanitized = filename.replaceAll("[^a-zA-Z0-9_-]", "_")
.replaceAll("_{2,}", "_")
.replaceAll("^_+|_+$", ""); // 앞뒤 언더스코어 제거
// 너무 길면 자르기 (최대 30자)
if (sanitized.length() > 30) {
sanitized = sanitized.substring(0, 30);
⋮----
// 비어있으면 기본값
if (sanitized.isEmpty()) {
⋮----
private boolean containsKorean(String text) {
⋮----
return text.matches(".*[ㄱ-ㅎㅏ-ㅣ가-힣]+.*");
⋮----
private void validateImageFile(MultipartFile file) {
if (file == null || file.isEmpty()) {
throw new IllegalArgumentException("이미지 파일이 비어있습니다.");
⋮----
if (file.getSize() > Constants.MAX_FILE_SIZE) {
throw new IllegalArgumentException(String.format("파일 크기가 너무 큽니다. 최대 %dMB까지 업로드 가능합니다.",
⋮----
if (originalFilename == null || !originalFilename.contains(".")) {
throw new IllegalArgumentException("유효하지 않은 파일입니다.");
⋮----
String extension = originalFilename.substring(originalFilename.lastIndexOf(".") + 1).toLowerCase();
⋮----
if (allowedExt.equals(extension)) {
⋮----
throw new IllegalArgumentException(String.format("지원하지 않는 파일 형식입니다. 지원 형식: %s",
String.join(", ", Constants.ALLOWED_IMAGE_EXTENSIONS)));
⋮----
String contentType = file.getContentType();
if (contentType == null || !contentType.startsWith("image/")) {
throw new IllegalArgumentException("이미지 파일만 업로드 가능합니다.");
⋮----
log.debug("✅ 이미지 파일 검증 통과 - 파일명: {}, 크기: {}KB, 타입: {}",
originalFilename, file.getSize() / 1024, contentType);
⋮----
public boolean updateImageOrder(Long imageId, Integer imageOrder) {
⋮----
log.info("🔢 이미지 순서 업데이트 - imageId: {}, newOrder: {}", imageId, imageOrder);
int result = facilityImageMapper.updateImageOrder(imageId, imageOrder);
⋮----
log.info("✅ 이미지 순서 업데이트 성공 - imageId: {}, newOrder: {}", imageId, imageOrder);
⋮----
log.warn("⚠️ 이미지 순서 업데이트 실패 - imageId: {}, newOrder: {}", imageId, imageOrder);
⋮----
log.error("❌ 이미지 순서 업데이트 중 오류 발생 - imageId: {}, newOrder: {}", imageId, imageOrder, e);
⋮----
public boolean reorderAllFacilityImages(Long facilityId) {
⋮----
log.info("🔄 시설 이미지 순서 재정렬 시작 - facilityId: {}", facilityId);
⋮----
if (images.isEmpty()) {
log.info("ℹ️ 재정렬할 이미지가 없음 - facilityId: {}", facilityId);
⋮----
log.info("📊 재정렬할 이미지 수: {} - facilityId: {}", images.size(), facilityId);
for (int i = 0; i < images.size(); i++) {
FacilityImageDTO image = images.get(i);
⋮----
if (image.getImageOrder() == null || !image.getImageOrder().equals(newOrder)) {
int updateResult = facilityImageMapper.updateImageOrder(image.getImageId(), newOrder);
⋮----
log.debug("✅ 이미지 순서 재정렬 - imageId: {}, 기존: {} → 새로운: {}",
image.getImageId(), image.getImageOrder(), newOrder);
⋮----
log.warn("⚠️ 이미지 순서 재정렬 실패 - imageId: {}, 새로운 순서: {}",
image.getImageId(), newOrder);
⋮----
log.info("✅ 시설 이미지 순서 재정렬 완료 - facilityId: {}", facilityId);
⋮----
log.error("❌ 시설 이미지 순서 재정렬 중 오류 발생 - facilityId: {}", facilityId, e);
⋮----
public boolean updateImageOrdersBatch(Long facilityId, List<Long> imageIds) {
⋮----
log.info("🔢 배치 이미지 순서 업데이트 시작 - facilityId: {}, imageIds: {}", facilityId, imageIds);
if (imageIds == null || imageIds.isEmpty()) {
log.warn("⚠️ 업데이트할 이미지 ID 목록이 비어있음 - facilityId: {}", facilityId);
⋮----
if (imageIds.size() > existingImageCount) {
log.warn("⚠️ 전달받은 이미지 ID 수가 기존 이미지 수보다 많음 - facilityId: {}, 전달받은: {}, 기존: {}",
facilityId, imageIds.size(), existingImageCount);
⋮----
for (int i = 0; i < imageIds.size(); i++) {
Long imageId = imageIds.get(i);
⋮----
FacilityImageDTO existingImage = facilityImageMapper.getImageById(imageId);
if (existingImage == null || !existingImage.getFacilityId().equals(facilityId)) {
log.warn("⚠️ 잘못된 이미지 ID 또는 시설 불일치 - imageId: {}, facilityId: {}",
⋮----
int updateResult = facilityImageMapper.updateImageOrder(imageId, newOrder);
⋮----
log.debug("✅ 이미지 순서 업데이트 - imageId: {}, 새로운 순서: {}", imageId, newOrder);
⋮----
log.warn("⚠️ 이미지 순서 업데이트 실패 - imageId: {}, 새로운 순서: {}", imageId, newOrder);
⋮----
boolean success = successCount == imageIds.size();
⋮----
log.info("✅ 배치 이미지 순서 업데이트 완료 - facilityId: {}, 성공: {}/{}",
facilityId, successCount, imageIds.size());
⋮----
log.warn("⚠️ 배치 이미지 순서 업데이트 부분 실패 - facilityId: {}, 성공: {}/{}",
⋮----
log.error("❌ 배치 이미지 순서 업데이트 중 오류 발생 - facilityId: {}", facilityId, e);
⋮----
public boolean deleteAllFacilityImages(Long facilityId) {
⋮----
log.info("🗑️ 시설의 모든 이미지 완전 삭제 시작 - facilityId: {}", facilityId);
List<FacilityImageDTO> imagesToDelete = facilityImageMapper.getImagesByFacilityId(facilityId);
if (imagesToDelete.isEmpty()) {
log.info("ℹ️ 삭제할 이미지가 없음 - facilityId: {}", facilityId);
⋮----
log.info("📊 삭제할 이미지 수: {}", imagesToDelete.size());
⋮----
if (image.getImagePath() != null && !image.getImagePath().trim().isEmpty()) {
imagePaths.add(image.getImagePath());
⋮----
int deletedCount = facilityImageMapper.deleteAllImagesByFacilityId(facilityId);
log.info("✅ DB에서 {} 개 이미지 삭제 완료 - facilityId: {}", deletedCount, facilityId);
⋮----
if (deleteImageFile(imagePath)) {
⋮----
log.info("✅ 파일 시스템에서 {}/{} 개 파일 삭제 완료", fileDeletedCount, imagePaths.size());
⋮----
log.error("❌ 시설의 모든 이미지 삭제 중 오류 발생 - facilityId: {}", facilityId, e);
⋮----
public List<FacilityImageDTO> uploadMultipleImages(Long facilityId, List<MultipartFile> images) {
⋮----
log.info("📤 다중 이미지 업로드 시작 - facilityId: {}, 이미지 수: {}", facilityId, images.size());
List<FacilityImageDTO> existingImages = facilityImageMapper.getImagesByFacilityId(facilityId);
int currentCount = existingImages.size();
⋮----
log.info("기존 이미지 수: {}, 시작 순서 번호: {}", currentCount, nextOrderNum);
⋮----
File directory = new File(uploadDir);
if (!directory.exists()) {
boolean created = directory.mkdirs();
log.info("업로드 디렉토리 생성: {} (성공: {})", uploadDir, created);
⋮----
MultipartFile image = images.get(i);
⋮----
String originalFilename = image.getOriginalFilename();
⋮----
String uniqueFilename = UUID.randomUUID().toString() + extension;
⋮----
// 파일 저장
File destinationFile = new File(filePath);
image.transferTo(destinationFile);
log.info("파일 저장 완료: {} -> {}", originalFilename, uniqueFilename);
// DTO 생성
⋮----
imageDTO.setImagePath("/uploads/facility/" + uniqueFilename);
imageDTO.setImageAltText(originalFilename); // ALT 텍스트에 원본 파일명 저장
imageDTO.setImageOrder(nextOrderNum + i);
imageDTO.setIsMainImage(currentCount == 0 && i == 0); // 첫 번째 이미지가 메인
// DB 저장
int result = facilityImageMapper.insertFacilityImage(imageDTO);
⋮----
uploadedImages.add(imageDTO);
log.info("이미지 DB 저장 완료: {} (순서: {})", uniqueFilename, imageDTO.getImageOrder());
⋮----
log.warn("이미지 DB 저장 실패: {}", uniqueFilename);
// 실패한 파일 삭제
destinationFile.delete();
⋮----
log.error("이미지 파일 저장 실패: {}", image.getOriginalFilename(), e);
⋮----
log.error("이미지 처리 중 오류: {}", image.getOriginalFilename(), e);
⋮----
log.info("✅ 다중 이미지 업로드 완료 - facilityId: {}, 성공: {}/{}",
facilityId, uploadedImages.size(), images.size());
⋮----
log.error("❌ 다중 이미지 업로드 중 오류 발생 - facilityId: {}", facilityId, e);
// 실패 시 업로드된 파일들 롤백
⋮----
if (uploadedImage.getImageId() != null) {
facilityImageMapper.deleteFacilityImage(uploadedImage.getImageId());
⋮----
deleteImageFile(uploadedImage.getImagePath());
⋮----
log.error("롤백 중 오류:", rollbackException);
⋮----
throw new RuntimeException("이미지 업로드 중 오류가 발생했습니다.", e);
`````

## File: src/main/java/com/example/carelink/service/FacilityService.java
`````java
public class FacilityService {
⋮----
private static final Logger log = LoggerFactory.getLogger(FacilityService.class);
⋮----
public List<FacilityDTO> searchFacilities(FacilityDTO searchDTO) {
log.info("시설 검색 서비스 호출 - facilityName: {}, address: {}, facilityType: {}",
searchDTO.getFacilityName(), searchDTO.getAddress(), searchDTO.getFacilityType());
List<FacilityDTO> results = facilityMapper.searchFacilities(searchDTO);
log.info("시설 검색 결과 - 총 {}개 시설 발견", results.size());
⋮----
FacilityImageDTO mainImage = facilityImageService.getMainImageByFacilityId(facility.getFacilityId());
if (mainImage != null && mainImage.getImagePath() != null) {
facility.setFacilityImage(mainImage.getImagePath());
⋮----
log.warn("시설 검색 중 메인 이미지 조회 실패 - facilityId: {}", facility.getFacilityId(), e);
facility.setFacilityImage(null);
⋮----
public FacilityDTO getFacilityById(Long facilityId) {
⋮----
log.warn("시설 ID가 null입니다.");
⋮----
log.info("시설 상세 정보 조회 시작 - facilityId: {}", facilityId);
FacilityDTO facility = facilityMapper.getFacilityById(facilityId);
⋮----
log.warn("시설을 찾을 수 없음 - facilityId: {}", facilityId);
⋮----
FacilityImageDTO mainImage = facilityImageService.getMainImageByFacilityId(facilityId);
⋮----
log.info("✅ 시설 메인 이미지 설정 완료 - imagePath: {}", mainImage.getImagePath());
⋮----
log.info("⚠️ 시설 메인 이미지 없음 - facilityId: {}", facilityId);
⋮----
log.error("❌ 시설 메인 이미지 조회 중 오류 발생 - facilityId: {}", facilityId, e);
⋮----
log.info("시설 상세 정보 조회 완료 - facilityName: {}, status: {}, mainImage: {}",
facility.getFacilityName(), facility.getStatus(), facility.getFacilityImage());
⋮----
public List<FacilityDTO> getAllFacilities() {
⋮----
log.info("전체 시설 목록 조회 시작");
List<FacilityDTO> facilities = facilityMapper.getAllFacilities();
log.info("전체 시설 목록 조회 완료 - 조회된 건수: {}", facilities.size());
⋮----
log.error("전체 시설 목록 조회 중 오류 발생", e);
throw new RuntimeException("시설 목록을 불러오는 중 오류가 발생했습니다.", e);
⋮----
public int insertFacility(FacilityDTO facilityDTO) {
return facilityMapper.insertFacility(facilityDTO);
⋮----
public int updateFacility(FacilityDTO facilityDTO) {
return facilityMapper.updateFacility(facilityDTO);
⋮----
public int deleteFacility(Long facilityId) {
return facilityMapper.deleteFacility(facilityId);
⋮----
public int countFacilitiesByRegion(String region) {
return facilityMapper.countFacilitiesByRegion(region);
⋮----
public int getFacilityCount() {
⋮----
return facilityMapper.getFacilityCount();
⋮----
public List<FacilityDTO> getAllActiveFacilities() {
log.info("활성화된 시설 목록 조회 시작");
List<FacilityDTO> facilities = facilityMapper.getAllActiveFacilities();
if (!facilities.isEmpty()) {
FacilityDTO firstFacility = facilities.get(0);
log.info("첫 번째 시설 정보 - ID: {}, 이름: {}, 승인상태: {}",
firstFacility.getFacilityId(),
firstFacility.getFacilityName(),
firstFacility.getStatus());
⋮----
log.info("활성화된 시설 목록 조회 완료 - 조회된 건수: {}", facilities.size());
⋮----
public boolean validateFacilityStatus(FacilityDTO facility) {
⋮----
log.warn("시설 정보가 null입니다.");
⋮----
if (facility.isDeletedStatus()) {
log.warn("삭제된 시설입니다 - facilityId: {}", facility.getFacilityId());
⋮----
if (facility.isPendingStatus()) {
log.warn("승인되지 않은 시설입니다 - facilityId: {}", facility.getFacilityId());
⋮----
public List<FacilityDTO> getFacilitiesByMemberId(Long memberId) {
⋮----
log.info("회원의 시설 목록 조회 시작 - memberId: {}", memberId);
List<FacilityDTO> facilities = facilityMapper.getFacilitiesByMemberId(memberId);
⋮----
log.info("회원의 시설 목록 조회 완료 - memberId: {}, 시설 수: {}",
memberId, facilities.size());
⋮----
log.info("회원의 시설 정보 없음 - memberId: {}", memberId);
⋮----
log.error("회원의 시설 목록 조회 중 오류 발생 - memberId: {}", memberId, e);
throw new RuntimeException("시설 정보 조회에 실패했습니다.", e);
⋮----
public FacilityDTO getFacilityByMemberId(Long memberId) {
⋮----
log.info("회원의 첫 번째 시설 정보 조회 시작 - memberId: {}", memberId);
⋮----
FacilityDTO facility = facilities.get(0);
log.info("회원의 첫 번째 시설 정보 조회 완료 - memberId: {}, facilityId: {}, facilityName: {}",
memberId, facility.getFacilityId(), facility.getFacilityName());
⋮----
log.error("회원의 시설 정보 조회 중 오류 발생 - memberId: {}", memberId, e);
⋮----
public void updateFacility(FacilityDTO facilityDTO, MultipartFile facilityImageFile) {
⋮----
log.info("시설 정보 수정 시작 - facilityId: {}, facilityName: {}",
facilityDTO.getFacilityId(), facilityDTO.getFacilityName());
if (facilityImageFile != null && !facilityImageFile.isEmpty()) {
String imagePath = saveFacilityImage(facilityImageFile, facilityDTO.getFacilityId().toString());
facilityDTO.setFacilityImage(imagePath);
log.info("시설 이미지 업데이트 - facilityId: {}, imagePath: {}",
facilityDTO.getFacilityId(), imagePath);
⋮----
int result = facilityMapper.updateFacility(facilityDTO);
⋮----
throw new RuntimeException("시설 정보 수정에 실패했습니다.");
⋮----
log.info("시설 정보 수정 완료 - facilityId: {}", facilityDTO.getFacilityId());
⋮----
log.error("시설 정보 수정 중 오류 발생 - facilityId: {}", facilityDTO.getFacilityId(), e);
throw new RuntimeException("시설 정보 수정에 실패했습니다.", e);
⋮----
private String saveFacilityImage(MultipartFile file, String facilityId) {
⋮----
File uploadDirFile = new File(uploadDir);
if (!uploadDirFile.exists()) {
boolean created = uploadDirFile.mkdirs();
log.info("업로드 디렉토리 생성: {} - {}", uploadDir, created ? "성공" : "실패");
⋮----
String originalFilename = file.getOriginalFilename();
⋮----
if (originalFilename != null && originalFilename.contains(".")) {
extension = originalFilename.substring(originalFilename.lastIndexOf("."));
⋮----
String savedFilename = "facility_" + facilityId + "_" + UUID.randomUUID().toString() + extension;
File savedFile = new File(uploadDir + savedFilename);
file.transferTo(savedFile);
log.info("시설 이미지 저장 완료: {}", savedFile.getAbsolutePath());
⋮----
log.error("시설 이미지 저장 중 오류 발생: facilityId={}", facilityId, e);
throw new RuntimeException("이미지 파일 저장에 실패했습니다.", e);
⋮----
public List<FacilityDTO> getFacilitiesByApprovalStatus(String status) {
⋮----
log.info("승인 상태별 시설 목록 조회 - status: {}", status);
List<FacilityDTO> facilities = facilityMapper.getFacilitiesByApprovalStatus(status);
log.info("승인 상태별 시설 목록 조회 완료 - status: {}, count: {}", status, facilities.size());
⋮----
log.error("승인 상태별 시설 목록 조회 중 오류 발생 - status: {}", status, e);
throw new RuntimeException("시설 목록 조회에 실패했습니다.", e);
⋮----
public void updateFacilityApprovalStatus(Long facilityId, String newStatus, String reason) {
⋮----
log.info("시설 승인 상태 업데이트 - facilityId: {}, newStatus: {}, reason: {}",
⋮----
int result = facilityMapper.updateFacilityApprovalStatus(facilityId, newStatus, reason);
⋮----
throw new RuntimeException("시설 승인 상태 업데이트에 실패했습니다.");
⋮----
log.info("시설 승인 상태 업데이트 완료 - facilityId: {}, newStatus: {}", facilityId, newStatus);
⋮----
log.error("시설 승인 상태 업데이트 중 오류 발생 - facilityId: {}", facilityId, e);
throw new RuntimeException("시설 승인 상태 업데이트에 실패했습니다.", e);
⋮----
public int countPendingFacilities() {
⋮----
int count = facilityMapper.countFacilitiesByStatus("PENDING");
log.info("승인 대기 시설 수 조회 완료 - count: {}", count);
⋮----
log.error("승인 대기 시설 수 조회 중 오류 발생", e);
⋮----
public int countApprovedFacilities() {
⋮----
int count = facilityMapper.countFacilitiesByStatus("APPROVED");
log.info("승인된 시설 수 조회 완료 - count: {}", count);
⋮----
log.error("승인된 시설 수 조회 중 오류 발생", e);
⋮----
public int countRejectedFacilities() {
⋮----
int count = facilityMapper.countFacilitiesByStatus("REJECTED");
log.info("거부된 시설 수 조회 완료 - count: {}", count);
⋮----
log.error("거부된 시설 수 조회 중 오류 발생", e);
`````

## File: build.gradle
`````
plugins {
    id 'org.springframework.boot' version '2.7.18'
    id 'io.spring.dependency-management' version '1.0.15.RELEASE'
    id 'java'
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'

java {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}

repositories {
    mavenCentral()
    maven { url 'https://jitpack.io' }
}

dependencies {
    // Spring Boot 기본 의존성
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-actuator'
    developmentOnly 'org.springframework.boot:spring-boot-devtools'

    // Thymeleaf 템플릿 엔진
    implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'

    // MySQL 데이터베이스 연결 (로컬 개발용)
    runtimeOnly 'com.mysql:mysql-connector-j'
    
    // PostgreSQL 데이터베이스 연결 (Heroku용)
    runtimeOnly 'org.postgresql:postgresql'

    // MyBatis 연동
    implementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter:2.3.1'

    // Lombok (코드 자동 생성)
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'

    // 유효성 검증
    implementation 'org.springframework.boot:spring-boot-starter-validation'

    // JSON 처리
    implementation 'com.fasterxml.jackson.core:jackson-databind'
    implementation 'com.fasterxml.jackson.datatype:jackson-datatype-jsr310'

    // 테스트 의존성
    testImplementation 'org.springframework.boot:spring-boot-starter-test'

    // Spring Security
    implementation 'org.springframework.boot:spring-boot-starter-security'

    // Thymeleaf와 Spring Security 연동을 위한 확장 라이브러리
    implementation 'org.thymeleaf.extras:thymeleaf-extras-springsecurity5'

    // SpringDoc OpenAPI 의존성 추가 (임시 비활성화 - 기능 구현 완료 후 활성화 예정)
    // implementation 'org.springdoc:springdoc-openapi-ui:1.7.0'
    // implementation 'org.springdoc:springdoc-openapi-security:1.7.0'

    // 이미지 처리
    implementation 'net.coobird:thumbnailator:0.4.19'
    // WebP 지원을 위한 ImageIO 확장 (임시 비활성화 - 라이브러리 의존성 문제)
    // implementation 'com.github.gotson:webp-imageio:0.2.2'

}

tasks.named('test') {
    useJUnitPlatform()
}
`````

## File: src/main/java/com/example/carelink/service/MemberService.java
`````java
public class MemberService {
⋮----
public MemberDTO login(LoginDTO loginDTO) {
⋮----
MemberDTO member = memberMapper.findByUserId(loginDTO.getUserId());
⋮----
log.warn("로그인 실패: 존재하지 않는 사용자 ID: {}", loginDTO.getUserId());
⋮----
if (member.getIsDeleted() != null && member.getIsDeleted()) {
log.warn("로그인 실패: 삭제 처리된 계정입니다. ID: {}", loginDTO.getUserId());
⋮----
if (member.getIsActive() != null && !member.getIsActive()) {
log.warn("로그인 실패: 비활성화된 계정: {}", loginDTO.getUserId());
⋮----
if (member.getLoginFailCount() >= Constants.MAX_LOGIN_ATTEMPTS) {
log.warn("로그인 실패: 로그인 시도 횟수 초과. ID: {}", loginDTO.getUserId());
⋮----
log.info("=== 비밀번호 검증 디버그 ===");
log.info("DB 저장된 비밀번호: {}", member.getPassword());
log.info("입력된 비밀번호: {}", loginDTO.getPassword());
boolean passwordMatches = loginDTO.getPassword().equals(member.getPassword());
log.info("비밀번호 매칭 결과: {}", passwordMatches);
⋮----
memberMapper.updateLoginSuccess(member.getMemberId());
log.info("로그인 성공: {}", loginDTO.getUserId());
⋮----
memberMapper.updateLoginFail(member.getMemberId());
log.warn("로그인 실패: 비밀번호 불일치. ID: {}, DB 비밀번호 시작: {}",
loginDTO.getUserId(), member.getPassword().substring(0, Math.min(10, member.getPassword().length())));
⋮----
log.error("로그인 처리 중 오류 발생: {}", loginDTO.getUserId(), e);
throw new RuntimeException("로그인 처리 중 오류가 발생했습니다.", e);
⋮----
public void join(MemberDTO memberDTO) {
join(memberDTO, null);
⋮----
public void join(MemberDTO memberDTO, MultipartFile facilityImageFile) {
⋮----
log.info("회원가입 처리 시작 - userId: {}, address: {}, detailAddress: {}",
memberDTO.getUserId(), memberDTO.getAddress(), memberDTO.getDetailAddress());
if (isUserIdDuplicate(memberDTO.getUserId())) {
throw new IllegalArgumentException("이미 사용중인 아이디입니다.");
⋮----
if (memberDTO.getEmail() != null && !memberDTO.getEmail().trim().isEmpty()) {
if (memberMapper.existsByEmail(memberDTO.getEmail())) {
throw new IllegalArgumentException("이미 사용중인 이메일입니다.");
⋮----
memberDTO.setMemberId(null);
if (memberDTO.getRole() == null || memberDTO.getRole().isEmpty()) {
memberDTO.setRole(Constants.MEMBER_ROLE_USER);
⋮----
memberDTO.setIsActive(true);
memberDTO.setLoginFailCount(0);
memberDTO.setIsDeleted(false);
if (memberDTO.getPhone() != null && memberDTO.getPhone().isEmpty()) {
memberDTO.setPhone(null);
⋮----
if (memberDTO.getAddress() != null && memberDTO.getAddress().isEmpty()) {
memberDTO.setAddress(null);
⋮----
if (memberDTO.getDetailAddress() != null && memberDTO.getDetailAddress().isEmpty()) {
memberDTO.setDetailAddress(null);
⋮----
memberDTO.setProfileImage(null);
memberDTO.setLastLoginAt(null);
log.info("DB 저장 전 memberDTO - address: {}, detailAddress: {}",
memberDTO.getAddress(), memberDTO.getDetailAddress());
int result = memberMapper.insertMember(memberDTO);
⋮----
throw new RuntimeException("회원가입 데이터 저장에 실패했습니다. (영향받은 행 없음)");
⋮----
log.info("회원가입 DB 저장 성공 - memberId: {}", memberDTO.getMemberId());
if (Constants.MEMBER_ROLE_FACILITY.equals(memberDTO.getRole()) && memberDTO.getFacilityName() != null) {
FacilityDTO facilityDTO = new FacilityDTO();
facilityDTO.setFacilityName(memberDTO.getFacilityName());
facilityDTO.setFacilityType(memberDTO.getFacilityType());
facilityDTO.setAddress(memberDTO.getAddress());
facilityDTO.setDetailAddress(memberDTO.getDetailAddress());
facilityDTO.setPhone(memberDTO.getFacilityPhone());
facilityDTO.setDescription(memberDTO.getDescription());
facilityDTO.setHomepage(memberDTO.getHomepage());
facilityDTO.setCapacity(memberDTO.getCapacity());
facilityDTO.setOperatingHours(memberDTO.getOperatingHours());
facilityDTO.setFeatures(memberDTO.getFeatures());
facilityDTO.setLatitude(memberDTO.getLatitude());
facilityDTO.setLongitude(memberDTO.getLongitude());
facilityDTO.setRegisteredMemberId(memberDTO.getMemberId());
facilityDTO.setIsApproved(false);
facilityDTO.setApprovalStatus("PENDING");
if (facilityImageFile != null && !facilityImageFile.isEmpty()) {
String imagePath = saveFacilityImage(facilityImageFile, memberDTO.getUserId());
facilityDTO.setFacilityImage(imagePath);
⋮----
int facilityResult = facilityMapper.insertFacility(facilityDTO);
⋮----
throw new RuntimeException("시설 정보 저장에 실패했습니다.");
⋮----
log.info("시설 정보 저장 성공: {}", facilityDTO.getFacilityName());
⋮----
log.info("회원가입 성공: {}", memberDTO.getUserId());
⋮----
log.warn("회원가입 실패 (비즈니스 로직): {}", e.getMessage());
⋮----
log.error("회원가입 처리 중 알 수 없는 오류 발생: {}", memberDTO.getUserId(), e);
throw new RuntimeException("회원가입 처리 중 알 수 없는 오류가 발생했습니다. 잠시 후 다시 시도해주세요.", e);
⋮----
public boolean isUserIdDuplicate(String userId) {
⋮----
return memberMapper.existsByUserId(userId);
⋮----
log.error("사용자 ID 중복 체크 중 오류 발생: {}", userId, e);
throw new RuntimeException("중복 체크 중 오류가 발생했습니다.", e);
⋮----
public MemberDTO findById(Long memberId) {
⋮----
return memberMapper.findById(memberId);
⋮----
log.error("회원 정보 조회 중 오류 발생: {}", memberId, e);
throw new RuntimeException("회원 정보 조회 중 오류가 발생했습니다.", e);
⋮----
public MemberDTO getMemberByUserId(String userId) {
⋮----
return memberMapper.findByUserId(userId);
⋮----
log.error("사용자 ID로 회원 정보 조회 중 오류 발생: {}", userId, e);
⋮----
public void updateMember(MemberDTO memberDTO, MultipartFile profileImageFile) throws Exception {
log.info("회원정보 수정 요청: memberId={}, name={}, email={}",
memberDTO.getMemberId(), memberDTO.getName(), memberDTO.getEmail());
MemberDTO existingMember = memberMapper.findById(memberDTO.getMemberId());
⋮----
throw new IllegalArgumentException("존재하지 않는 회원입니다.");
⋮----
log.info("기존 회원 정보: memberId={}, name={}, email={}",
existingMember.getMemberId(), existingMember.getName(), existingMember.getEmail());
memberDTO.setPassword(existingMember.getPassword());
memberDTO.setRole(existingMember.getRole());
memberDTO.setIsActive(existingMember.getIsActive());
memberDTO.setIsDeleted(existingMember.getIsDeleted());
memberDTO.setLoginFailCount(existingMember.getLoginFailCount());
memberDTO.setLastLoginAt(existingMember.getLastLoginAt());
memberDTO.setCreatedAt(existingMember.getCreatedAt());
if (profileImageFile != null && !profileImageFile.isEmpty()) {
String profileImagePath = saveProfileImage(profileImageFile, existingMember.getUserId());
memberDTO.setProfileImage(profileImagePath);
if (existingMember.getProfileImage() != null && !existingMember.getProfileImage().isEmpty()) {
⋮----
String projectRoot = System.getProperty("user.dir");
String oldImagePath = existingMember.getProfileImage();
if (oldImagePath.startsWith("/uploads/profile/")) {
String oldFileName = oldImagePath.substring("/uploads/profile/".length());
File oldFile = new File(projectRoot + "/src/main/resources/static" + oldImagePath);
if (oldFile.exists() && oldFile.delete()) {
log.info("기존 프로필 이미지 삭제 성공: {}", oldFile.getAbsolutePath());
⋮----
log.warn("기존 프로필 이미지 삭제 실패: {}", e.getMessage());
⋮----
memberDTO.setProfileImage(existingMember.getProfileImage());
log.debug("새로운 프로필 이미지가 없어 기존 이미지 유지: {}", existingMember.getProfileImage());
⋮----
log.info("업데이트할 회원 정보: memberId={}, name={}, email={}, phone={}, address={}",
memberDTO.getMemberId(), memberDTO.getName(), memberDTO.getEmail(),
memberDTO.getPhone(), memberDTO.getAddress());
int result = memberMapper.updateMember(memberDTO);
log.info("회원정보 업데이트 쿼리 실행 결과: {} 행이 영향받음", result);
⋮----
throw new RuntimeException("회원 정보 수정에 실패했습니다. 영향받은 행: 0");
⋮----
log.info("회원정보 수정 완료: userId={}, memberId={}", memberDTO.getUserId(), memberDTO.getMemberId());
⋮----
public void changePassword(String userId, String currentPassword, String newPassword, String confirmNewPassword) {
MemberDTO member = memberMapper.findByUserId(userId);
⋮----
throw new IllegalArgumentException("사용자를 찾을 수 없습니다.");
⋮----
if (!currentPassword.equals(member.getPassword())) {
throw new IllegalArgumentException("현재 비밀번호가 일치하지 않습니다.");
⋮----
if (!newPassword.equals(confirmNewPassword)) {
throw new IllegalArgumentException("새 비밀번호와 확인 비밀번호가 일치하지 않습니다.");
⋮----
if (newPassword.length() < 8) {
throw new IllegalArgumentException("새 비밀번호는 최소 8자 이상이어야 합니다.");
⋮----
member.setPassword(newPassword);
int result = memberMapper.updatePassword(member);
⋮----
throw new RuntimeException("비밀번호 변경에 실패했습니다.");
⋮----
log.info("비밀번호 변경 서비스: {} 사용자의 비밀번호가 성공적으로 변경됨.", userId);
⋮----
public Map<String, Integer> getUserContentCounts(Long memberId) {
⋮----
List<BoardDTO> boards = boardMapper.findBoardsByMemberId(memberId);
List<ReviewDTO> reviews = reviewMapper.findReviewsByMemberId(memberId);
List<JobDTO> jobs = jobMapper.findJobsByMemberId(memberId);
int boardCount = boards != null ? boards.size() : 0;
int reviewCount = reviews != null ? reviews.size() : 0;
int jobCount = jobs != null ? jobs.size() : 0;
counts.put("board", boardCount);
counts.put("review", reviewCount);
counts.put("job", jobCount);
counts.put("total", boardCount + reviewCount + jobCount);
log.info("사용자 콘텐츠 개수 조회: memberId={}, 결과={}", memberId, counts);
⋮----
log.error("콘텐츠 개수 조회 중 오류: memberId={}", memberId, e);
counts.put("board", 0);
counts.put("review", 0);
counts.put("job", 0);
counts.put("total", 0);
⋮----
public Map<String, Object> getMyPosts(Long memberId, String type, int page, int pageSize, int offset) {
⋮----
Map<String, Integer> contentCounts = getUserContentCounts(memberId);
result.put("contentCounts", contentCounts);
if ("board".equals(type)) {
⋮----
post.put("id", board.getBoardId());
post.put("title", board.getTitle());
post.put("content", board.getContent());
post.put("createdAt", board.getCreatedAt());
post.put("viewCount", board.getViewCount() != null ? board.getViewCount() : 0);
post.put("likeCount", board.getLikeCount() != null ? board.getLikeCount() : 0);
post.put("rating", null);
post.put("salary", null);
post.put("type", "board");
post.put("category", board.getBoardType());
post.put("url", "/board/detail/" + board.getBoardId());
posts.add(post);
⋮----
} else if ("review".equals(type)) {
⋮----
post.put("id", review.getReviewId());
post.put("title", review.getTitle());
post.put("content", review.getContent());
post.put("createdAt", review.getCreatedAt());
post.put("viewCount", null);
post.put("likeCount", review.getLikeCount() != null ? review.getLikeCount() : 0);
post.put("rating", review.getRating());
⋮----
post.put("type", "review");
post.put("category", "리뷰");
post.put("url", "/review/detail/" + review.getReviewId());
⋮----
} else if ("job".equals(type)) {
⋮----
post.put("id", job.getJobId());
post.put("title", job.getTitle());
post.put("content", job.getContent());
post.put("createdAt", job.getCreatedAt());
post.put("viewCount", job.getViewCount() != null ? job.getViewCount() : 0);
post.put("likeCount", null);
⋮----
post.put("salary", job.getSalaryDescription());
post.put("type", "job");
post.put("category", job.getJobType());
post.put("url", "/job/detail/" + job.getJobId());
⋮----
posts.sort((a, b) -> ((java.time.LocalDateTime) b.get("createdAt")).compareTo((java.time.LocalDateTime) a.get("createdAt")));
int totalCount = posts.size();
int startIndex = Math.min(offset, totalCount);
int endIndex = Math.min(offset + pageSize, totalCount);
List<Map<String, Object>> pagedPosts = posts.subList(startIndex, endIndex);
result.put("posts", pagedPosts);
result.put("totalCount", totalCount);
log.info("내가 쓴 글 조회 완료: memberId={}, type={}, 총{}\uac1c, 현재페이지 {}\uac1c",
memberId, type, totalCount, pagedPosts.size());
⋮----
log.error("내가 쓴 글 조회 중 오류: memberId={}, type={}", memberId, type, e);
result.put("posts", new ArrayList<>());
result.put("totalCount", 0);
result.put("contentCounts", Map.of("board", 0, "review", 0, "job", 0, "total", 0));
⋮----
public String deleteMemberWithOption(String userId, String deleteOption) {
⋮----
if ("anonymous".equals(deleteOption)) {
int result = memberMapper.anonymizeMember(userId);
⋮----
throw new RuntimeException("회원 익명화 처리 중 오류가 발생했습니다.");
⋮----
log.info("회원 익명화 처리 완료: {}", userId);
⋮----
} else if ("complete".equals(deleteOption)) {
deleteAllUserContent(userId);
int result = memberMapper.hardDeleteMember(userId);
⋮----
throw new RuntimeException("회원 완전삭제 처리 중 오류가 발생했습니다.");
⋮----
log.info("회원 완전삭제 처리 완료: {}", userId);
⋮----
int result = memberMapper.softDeleteMember(userId);
⋮----
throw new RuntimeException("회원 탈퇴 처리 중 오류가 발생했습니다.");
⋮----
log.info("회원 논리삭제 처리 완료: {}", userId);
⋮----
log.error("회원 탈퇴 처리 중 오류 발생: userId={}, option={}", userId, deleteOption, e);
throw new RuntimeException("회원 탈퇴 처리 중 오류가 발생했습니다.", e);
⋮----
public void deleteAllUserContent(String userId) {
⋮----
throw new RuntimeException("회원 정보를 찾을 수 없습니다.");
⋮----
Long memberId = member.getMemberId();
if (Constants.MEMBER_ROLE_FACILITY.equals(member.getRole())) {
jobMapper.deleteByFacilityMemberId(memberId);
log.info("시설 구인공고 삭제 완료: memberId={}", memberId);
reviewMapper.deleteByFacilityMemberId(memberId);
log.info("시설 리뷰 삭제 완료: memberId={}", memberId);
facilityMapper.deleteByMemberId(memberId);
log.info("시설 정보 삭제 완료: memberId={}", memberId);
⋮----
boardMapper.deleteByMemberId(memberId);
reviewMapper.deleteByMemberId(memberId);
jobMapper.deleteByMemberId(memberId);
log.info("사용자 콘텐츠 삭제 완료: userId={}, memberId={}", userId, memberId);
⋮----
log.error("사용자 콘텐츠 삭제 중 오류: userId={}", userId, e);
⋮----
public void deleteMember(String userId) {
⋮----
log.info("회원 탈퇴 처리 완료: {}", userId);
⋮----
private String saveProfileImage(MultipartFile file, String userId) {
⋮----
if (!imageOptimizationService.isSupportedImageFormat(file.getOriginalFilename())) {
throw new IllegalArgumentException("지원하지 않는 이미지 형식입니다. JPG, PNG, GIF만 지원됩니다.");
⋮----
String baseFileName = "profile_" + userId + "_" + UUID.randomUUID().toString();
log.info("프로필 이미지 WebP 변환 시작: userId={}, originalFile={}",
userId, file.getOriginalFilename());
⋮----
imageOptimizationService.processImage(file, baseFileName, uploadDir);
log.info("프로필 이미지 WebP 변환 완료: userId={}, webpPath={}",
userId, result.getOriginalWebPPath());
return "/uploads/profile/" + result.getOriginalWebPPath();
⋮----
log.error("프로필 이미지 저장 중 오류 발생: userId={}", userId, e);
throw new RuntimeException("프로필 이미지 저장에 실패했습니다.", e);
⋮----
private String saveFacilityImage(MultipartFile file, String userId) {
⋮----
String baseFileName = "facility_" + userId + "_" + UUID.randomUUID().toString();
log.info("시설 이미지 WebP 변환 시작: userId={}, originalFile={}",
⋮----
log.info("시설 이미지 WebP 변환 완료: userId={}, webpPath={}",
⋮----
return "/uploads/facility/" + result.getOriginalWebPPath();
⋮----
log.error("시설 이미지 저장 중 오류 발생: userId={}", userId, e);
throw new RuntimeException("시설 이미지 저장에 실패했습니다.", e);
⋮----
public int getTotalMembersCount() {
⋮----
return memberMapper.getTotalCount();
⋮----
log.error("전체 회원 수 조회 중 오류 발생", e);
throw new RuntimeException("회원 수 조회 중 오류가 발생했습니다.", e);
⋮----
public int getMemberCount() {
⋮----
return memberMapper.getMemberCount();
⋮----
log.error("회원 수 조회 중 오류 발생", e);
⋮----
public List<MemberDTO> getMembersWithPaging(MemberDTO searchDTO) {
⋮----
return memberMapper.findMembersWithPaging(searchDTO);
⋮----
log.error("페이징된 회원 목록 조회 중 오류 발생", e);
throw new RuntimeException("회원 목록 조회 중 오류가 발생했습니다.", e);
⋮----
public List<MemberDTO> getMembersByRole(String role) {
⋮----
return memberMapper.findMembersByRole(role);
⋮----
log.error("역할별 회원 목록 조회 중 오류 발생: {}", role, e);
throw new RuntimeException("역할별 회원 목록 조회 중 오류가 발생했습니다.", e);
⋮----
public void updateMemberStatus(Long memberId, boolean isActive) {
⋮----
memberMapper.updateMemberStatus(memberId, isActive);
log.info("회원 상태 변경 완료: memberId={}, isActive={}", memberId, isActive);
⋮----
log.error("회원 상태 변경 중 오류 발생: memberId={}", memberId, e);
throw new RuntimeException("회원 상태 변경 중 오류가 발생했습니다.", e);
⋮----
public int getTotalMemberCount() {
⋮----
public int getFacilityMemberCount() {
⋮----
return memberMapper.getFacilityMemberCount();
⋮----
log.error("시설 회원 수 조회 중 오류 발생", e);
⋮----
public List<MemberDTO> getMembersByRole(String role, int page, int pageSize) {
⋮----
log.info("역할별 회원 목록 조회 시작: role={}, page={}, pageSize={}", role, page, pageSize);
String searchRole = "ALL".equals(role) ? null : role;
List<MemberDTO> members = memberMapper.findMembersByRole(searchRole);
log.info("역할별 회원 조회 완료: role={}, count={} 명", role, members.size());
⋮----
log.error("역할별 회원 목록 조회 중 오류 발생: role={}, page={}", role, page, e);
⋮----
public int getMemberCountByRole(String role) {
⋮----
if ("ALL".equals(role)) {
⋮----
} else if ("FACILITY".equals(role)) {
⋮----
} else if ("USER".equals(role)) {
return memberMapper.getUserMemberCount();
⋮----
return memberMapper.getMemberCountByRole(role);
⋮----
log.error("역할별 회원 수 조회 중 오류 발생: role={}", role, e);
⋮----
public boolean toggleMemberActive(Long memberId) {
⋮----
MemberDTO member = memberMapper.findById(memberId);
⋮----
throw new RuntimeException("회원을 찾을 수 없습니다.");
⋮----
boolean newStatus = !Boolean.TRUE.equals(member.getIsActive());
memberMapper.updateMemberStatus(memberId, newStatus);
log.info("회원 활성화 상태 토글 완료: memberId={}, newStatus={}", memberId, newStatus);
⋮----
log.error("회원 활성화 상태 토글 중 오류 발생: memberId={}", memberId, e);
`````

## File: src/main/resources/application.yml
`````yaml
server:
  port: 8080
  servlet:
    context-path: /
    encoding:
      charset: UTF-8
      enabled: true
      force: true
spring:
  jackson:
    serialization:
      write-dates-as-timestamps: false
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: ${DB_URL:jdbc:mysql://localhost:3306/carelink?useSSL=false&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=UTF-8}
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:mysql}
    hikari:
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      maximum-pool-size: 10
      minimum-idle: 5
      pool-name: CareLink-HikariCP
      auto-commit: false
      transaction-isolation: TRANSACTION_READ_COMMITTED
  thymeleaf:
    prefix: classpath:/templates/
    suffix: .html
    mode: HTML
    encoding: UTF-8
    cache: false
  servlet:
    multipart:
      max-file-size: 50MB
      max-request-size: 50MB
mybatis:
  type-aliases-package: com.example.carelink.dto
  mapper-locations: classpath:mapper/*.xml
  configuration:
    map-underscore-to-camel-case: true
    jdbc-type-for-null: varchar
    default-fetch-size: 100
    default-statement-timeout: 30
logging:
  level:
    root: INFO
    com.example.carelink: DEBUG
    com.example.carelink.dao: DEBUG
    org.springframework.web: DEBUG
    org.springframework.jdbc: DEBUG
    org.mybatis: DEBUG
    org.apache.ibatis: DEBUG
    org.springframework.transaction: DEBUG
    java.sql: DEBUG
    jdbc.sqltiming: INFO
    com.zaxxer.hikari: DEBUG
file:
  upload-dir:
    facility: C:/carelink-uploads/facility/
    profile: C:/carelink-uploads/profile/
    board: C:/carelink-uploads/board/
    temp: C:/carelink-uploads/temp/
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: method
  show-actuator: true
  default-consumes-media-type: application/json
  default-produces-media-type: application/json
  paths-to-match:
    - /api/**
  packages-to-scan:
    - com.lightcare.controller
api:
  kakao:
    app-key: ${KAKAO_APP_KEY:b97b58672807a40c122a5deed8a98ea4}
`````

## File: src/main/resources/mapper/facilityMapper.xml
`````xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.carelink.dao.FacilityMapper">
    <resultMap id="facilityResultMap" type="com.example.carelink.dto.FacilityDTO">
        <id property="facilityId" column="facility_id"/>
        <result property="facilityName" column="facility_name"/>
        <result property="facilityType" column="facility_type"/>
        <result property="address" column="address"/>
        <result property="detailAddress" column="detail_address"/>
        <result property="phone" column="phone"/>
        <result property="latitude" column="latitude"/>
        <result property="longitude" column="longitude"/>
        <result property="description" column="description"/>
        <result property="facilityImage" column="facility_image"/>
        <result property="facilityImageAltText" column="facility_image_alt_text"/>
        <result property="homepage" column="homepage"/>
        <result property="capacity" column="capacity"/>
        <result property="currentOccupancy" column="current_occupancy"/>
        <result property="operatingHours" column="operating_hours"/>
        <result property="features" column="features"/>
        <result property="averageRating" column="average_rating"/>
        <result property="reviewCount" column="review_count"/>
        <result property="gradeRating" column="grade_rating"/>
        <result property="registeredMemberId" column="registered_member_id"/>
        <result property="registeredMemberName" column="registered_member_name"/>
        <result property="isApproved" column="is_approved"/>
        <result property="approvalStatus" column="approval_status"/>
    </resultMap>
    <select id="searchFacilities" resultMap="facilityResultMap">
        SELECT f.*, m.name as registered_member_name
        FROM facility f
        LEFT JOIN member m ON f.registered_member_id = m.member_id
        <where>
            f.is_deleted = false
            AND f.is_approved = true
            <if test="facilityName != null and facilityName != ''">
                AND f.facility_name LIKE CONCAT('%', #{facilityName}, '%')
            </if>
            <if test="facilityType != null and facilityType != ''">
                AND f.facility_type = #{facilityType}
            </if>
            <if test="address != null and address != ''">
                AND f.address LIKE CONCAT(#{address}, '%')
            </if>
            <if test="swLat != null and swLng != null and neLat != null and neLng != null">
                AND (f.latitude BETWEEN #{swLat} AND #{neLat})
                AND (f.longitude BETWEEN #{swLng} AND #{neLng})
            </if>
        </where>
        ORDER BY f.created_at DESC
    </select>
    <select id="getFacilityById" resultType="com.example.carelink.dto.FacilityDTO">
        SELECT
            f.facility_id,
            f.facility_name,
            f.facility_type,
            f.address,
            f.phone,
            f.latitude,
            f.longitude,
            f.description,
            f.facility_image,
            f.homepage,
            f.capacity,
            f.current_occupancy,
            f.operating_hours,
            f.features,
            f.average_rating,
            f.review_count,
            f.grade_rating,
            f.registered_member_id,
            m.name as registered_member_name,
            f.is_deleted,
            f.is_approved,
            CASE
                WHEN f.is_deleted = true THEN '삭제됨'
                WHEN f.is_approved = false THEN '승인대기'
                ELSE '정상'
            END as status
        FROM facility f
        LEFT JOIN member m ON f.registered_member_id = m.member_id
        WHERE f.facility_id = #{facilityId}
    </select>
    <select id="getAllFacilities" resultMap="facilityResultMap">
        SELECT f.*, m.name as registered_member_name
        FROM facility f
        LEFT JOIN member m ON f.registered_member_id = m.member_id
        WHERE f.is_deleted = false
        AND f.is_approved = true
        ORDER BY f.created_at DESC
    </select>
    <insert id="insertFacility" parameterType="com.example.carelink.dto.FacilityDTO" useGeneratedKeys="true" keyProperty="facilityId">
        INSERT INTO facility (
            facility_name, facility_type, address, detail_address, phone,
            latitude, longitude, description, facility_image, facility_image_alt_text, homepage,
            capacity, current_occupancy, operating_hours, features,
            average_rating, review_count, registered_member_id,
            is_approved, approval_status
        ) VALUES (
                     #{facilityName}, #{facilityType}, #{address}, #{detailAddress}, #{phone},
                     #{latitude}, #{longitude}, #{description}, #{facilityImage}, #{facilityImageAltText}, #{homepage},
                     #{capacity}, #{currentOccupancy}, #{operatingHours}, #{features},
                     #{averageRating}, #{reviewCount}, #{registeredMemberId},
                     #{isApproved}, #{approvalStatus}
                 )
    </insert>
    <update id="updateFacility" parameterType="com.example.carelink.dto.FacilityDTO">
        UPDATE facility
        SET
            facility_name = #{facilityName},
            facility_type = #{facilityType},
            address = #{address},
            detail_address = #{detailAddress},
            phone = #{phone},
            latitude = #{latitude},
            longitude = #{longitude},
            description = #{description},
            facility_image = #{facilityImage},
            facility_image_alt_text = #{facilityImageAltText},
            homepage = #{homepage},
            capacity = #{capacity},
            current_occupancy = #{currentOccupancy},
            operating_hours = #{operatingHours},
            features = #{features},
            average_rating = #{averageRating},
            review_count = #{reviewCount},
            registered_member_id = #{registeredMemberId},
            is_approved = #{isApproved},
            approval_status = #{approvalStatus},
            updated_at = NOW()
        WHERE facility_id = #{facilityId}
    </update>
    <delete id="deleteFacility">
        DELETE FROM facility WHERE facility_id = #{facilityId}
    </delete>
    <select id="countFacilitiesByRegion" resultType="int">
        SELECT COUNT(*)
        FROM facility
        WHERE address LIKE CONCAT(#{region}, '%')
    </select>
    <select id="getFacilityCount" resultType="int">
        SELECT COUNT(*)
        FROM facility
        WHERE is_deleted = false
        AND is_approved = true
    </select>
    <select id="getAllActiveFacilities" resultType="com.example.carelink.dto.FacilityDTO">
        SELECT
            f.facility_id,
            f.facility_name,
            f.facility_type,
            f.address,
            f.phone,
            f.average_rating,
            f.review_count,
            f.registered_member_id,
            m.name as registered_member_name,
            f.is_deleted,
            f.is_approved,
            CASE
                WHEN f.is_deleted = true THEN '삭제됨'
                WHEN f.is_approved = false THEN '승인대기'
                ELSE '정상'
            END as status
        FROM facility f
        LEFT JOIN member m ON f.registered_member_id = m.member_id
        WHERE f.is_deleted = false
        AND f.is_approved = true
        ORDER BY f.facility_name ASC
    </select>
    <delete id="deleteByMemberId" parameterType="long">
        DELETE FROM facility WHERE registered_member_id = #{memberId}
    </delete>
    <select id="getFacilitiesByMemberId" parameterType="long" resultType="FacilityDTO">
        SELECT
            facility_id as facilityId,
            facility_name as facilityName,
            facility_type as facilityType,
            address,
            detail_address as detailAddress,
            phone,
            latitude,
            longitude,
            description,
            facility_image as facilityImage,
            homepage,
            capacity,
            current_occupancy as currentOccupancy,
            operating_hours as operatingHours,
            features,
            average_rating as averageRating,
            review_count as reviewCount,
            grade_rating as gradeRating,
            registered_member_id as registeredMemberId,
            is_approved as isApproved,
            approval_status as approvalStatus,
            created_at as createdAt,
            updated_at as updatedAt,
            is_deleted as isDeleted
        FROM facility
        WHERE registered_member_id = #{memberId} AND is_deleted = false
        ORDER BY created_at DESC
    </select>
    <select id="getFacilityByMemberId" parameterType="long" resultType="FacilityDTO">
        SELECT
            facility_id as facilityId,
            facility_name as facilityName,
            facility_type as facilityType,
            address,
            detail_address as detailAddress,
            phone,
            latitude,
            longitude,
            description,
            facility_image as facilityImage,
            homepage,
            capacity,
            current_occupancy as currentOccupancy,
            operating_hours as operatingHours,
            features,
            average_rating as averageRating,
            review_count as reviewCount,
            grade_rating as gradeRating,
            registered_member_id as registeredMemberId,
            is_approved as isApproved,
            approval_status as approvalStatus,
            created_at as createdAt,
            updated_at as updatedAt,
            is_deleted as isDeleted
        FROM facility
        WHERE registered_member_id = #{memberId} AND is_deleted = false
        ORDER BY created_at DESC
        LIMIT 1
    </select>
    <select id="getFacilitiesByApprovalStatus" parameterType="string" resultType="FacilityDTO">
        SELECT
            f.facility_id,
            f.facility_name,
            f.facility_type,
            f.address,
            f.detail_address,
            f.phone,
            f.description,
            f.homepage,
            f.capacity,
            f.operating_hours,
            f.features,
            f.facility_image,
            f.latitude,
            f.longitude,
            f.approval_status,
            f.registered_member_id,
            f.created_at,
            f.updated_at,
            m.user_id as registeredUserName,
            m.name as registeredMemberName
        FROM facility f
        LEFT JOIN member m ON f.registered_member_id = m.member_id
        WHERE f.is_deleted = false
        <if test="approvalStatus != null and approvalStatus != ''">
            AND f.approval_status = #{approvalStatus}
        </if>
        ORDER BY f.created_at DESC
    </select>
    <update id="updateFacilityApprovalStatus">
        UPDATE facility
        SET
            approval_status = #{approvalStatus},
            is_approved = (#{approvalStatus} = 'APPROVED'),
            <if test="rejectionReason != null">
            description = CONCAT(COALESCE(description, ''), CHAR(10), '거부사유: ', #{rejectionReason}),
            </if>
            updated_at = NOW()
        WHERE facility_id = #{facilityId}
    </update>
    <select id="countFacilitiesByStatus" parameterType="string" resultType="int">
        SELECT COUNT(*)
        FROM facility
        WHERE is_deleted = false
        AND approval_status = #{approvalStatus}
    </select>
    <update id="updateFacilityMainImage">
        UPDATE facility
        SET
            facility_image = #{mainImagePath},
            image_count = #{imageCount},
            updated_at = NOW()
        WHERE facility_id = #{facilityId}
    </update>
</mapper>
`````

## File: src/main/java/com/example/carelink/controller/MemberController.java
`````java
public class MemberController {
⋮----
public String loginForm(Model model) {
model.addAttribute("loginDTO", new LoginDTO());
⋮----
public String login(@Valid @ModelAttribute LoginDTO loginDTO,
⋮----
if (bindingResult.hasErrors()) {
log.warn("로그인 폼 유효성 검사 실패: {}", bindingResult.getAllErrors());
⋮----
log.info("로그인 시도: userId={}, 비밀번호 길이={}", loginDTO.getUserId(), loginDTO.getPassword().length());
⋮----
MemberDTO loginMember = memberService.login(loginDTO);
⋮----
session.setAttribute(Constants.SESSION_MEMBER, loginMember);
session.setAttribute("memberId", loginMember.getMemberId());
log.info("컨트롤러 로그인 성공: userId={}, role={}", loginMember.getUserId(), loginMember.getRole());
redirectAttributes.addFlashAttribute("message", "로그인되었습니다.");
⋮----
log.warn("컨트롤러 로그인 실패: userId={}", loginDTO.getUserId());
redirectAttributes.addFlashAttribute("error", "아이디 또는 비밀번호가 잘못되었습니다.");
⋮----
log.error("로그인 처리 중 오류 발생: userId={}", loginDTO.getUserId(), e);
redirectAttributes.addFlashAttribute("error", "로그인 처리 중 오류가 발생했습니다.");
⋮----
public String logout(HttpSession session, RedirectAttributes redirectAttributes) {
⋮----
session.invalidate();
⋮----
redirectAttributes.addFlashAttribute("message", "로그아웃되었습니다.");
⋮----
public String joinForm(Model model) {
model.addAttribute("memberDTO", new MemberDTO());
⋮----
public String join(
⋮----
if (!memberDTO.getPassword().equals(memberDTO.getPasswordConfirm())) {
bindingResult.rejectValue("passwordConfirm", "password.mismatch", "비밀번호 확인이 일치하지 않습니다.");
log.warn("회원가입 실패: 비밀번호 확인 불일치");
model.addAttribute("memberDTO", memberDTO);
⋮----
if ("FACILITY".equalsIgnoreCase(memberDTO.getRole())) {
Set<ConstraintViolation<MemberDTO>> violations = validator.validate(memberDTO, OnFacilityJoin.class);
⋮----
bindingResult.rejectValue(violation.getPropertyPath().toString(), "", violation.getMessage());
⋮----
// 3. 최종 유효성 검사 결과 확인 (기본 유효성 + 수동 추가된 유효성)
⋮----
log.warn("회원가입 유효성 검사 실패: {}", bindingResult.getAllErrors());
⋮----
memberService.join(memberDTO, facilityImageFile);
log.info("회원가입 성공: {}", memberDTO.getUserId());
LoginDTO loginDTO = new LoginDTO();
loginDTO.setUserId(memberDTO.getUserId());
loginDTO.setPassword(memberDTO.getPassword());
⋮----
log.info("회원가입 후 자동 로그인 성공: userId={}", loginMember.getUserId());
redirectAttributes.addFlashAttribute("message", "회원가입이 완료되었습니다. 환영합니다!");
⋮----
log.warn("회원가입은 성공했으나 자동 로그인 실패: {}", memberDTO.getUserId());
redirectAttributes.addFlashAttribute("message", "회원가입이 완료되었습니다. 로그인해주세요.");
⋮----
log.warn("회원가입 실패: {}", e.getMessage());
bindingResult.rejectValue("userId", "duplicate.userId", e.getMessage());
⋮----
log.error("회원가입 처리 중 알 수 없는 오류 발생", e);
redirectAttributes.addFlashAttribute("error", "회원가입 처리 중 오류가 발생했습니다.");
⋮----
public Map<String, Object> checkUserId(@RequestParam String userId) {
⋮----
boolean isDuplicate = memberService.isUserIdDuplicate(userId);
result.put("isDuplicate", isDuplicate);
result.put("message", isDuplicate ? "이미 사용중인 아이디입니다." : "사용 가능한 아이디입니다.");
⋮----
log.error("아이디 중복 체크 중 오류 발생", e);
result.put("error", "중복 체크 중 오류가 발생했습니다.");
⋮----
public Map<String, Object> debugPasswordTest(@RequestParam(defaultValue = "admin") String userId,
⋮----
MemberDTO member = memberService.getMemberByUserId(userId);
⋮----
result.put("error", "사용자를 찾을 수 없습니다: " + userId);
⋮----
result.put("userId", member.getUserId());
result.put("dbPasswordHash", member.getPassword());
result.put("dbPasswordLength", member.getPassword().length());
result.put("inputPassword", password);
result.put("inputPasswordLength", password.length());
boolean isValidBcryptFormat = member.getPassword().startsWith("$2a$") ||
member.getPassword().startsWith("$2b$") ||
member.getPassword().startsWith("$2y$");
result.put("isValidBcryptFormat", isValidBcryptFormat);
⋮----
loginDTO.setUserId(userId);
loginDTO.setPassword(password);
MemberDTO loginResult = memberService.login(loginDTO);
result.put("loginSuccess", loginResult != null);
result.put("isActive", member.getIsActive());
result.put("isDeleted", member.getIsDeleted());
result.put("loginFailCount", member.getLoginFailCount());
result.put("role", member.getRole());
log.info("디버깅 테스트 결과: {}", result);
⋮----
log.error("디버깅 테스트 중 오류 발생", e);
result.put("error", "테스트 중 오류 발생: " + e.getMessage());
⋮----
public String verifyPasswordForm(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
MemberDTO loginMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
⋮----
redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
⋮----
public String verifyPassword(@RequestParam("password") String password,
⋮----
if (!password.equals(loginMember.getPassword())) {
redirectAttributes.addFlashAttribute("error", "비밀번호가 일치하지 않습니다.");
⋮----
log.error("비밀번호 확인 중 오류 발생: {}", loginMember.getUserId(), e);
redirectAttributes.addFlashAttribute("error", "비밀번호 확인 중 오류가 발생했습니다.");
⋮----
public String myInfoEdit(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
⋮----
MemberDTO memberInfo = memberService.findById(loginMember.getMemberId());
⋮----
redirectAttributes.addFlashAttribute("error", "사용자 정보를 찾을 수 없습니다.");
⋮----
session.setAttribute("myinfo_verified", true);
model.addAttribute("memberDTO", memberInfo);
⋮----
log.error("마이페이지 정보 조회 중 오류 발생: {}", loginMember.getUserId(), e);
redirectAttributes.addFlashAttribute("error", "회원 정보를 불러오는 중 오류가 발생했습니다.");
⋮----
public String cropImagePage(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
⋮----
Boolean myinfoVerified = (Boolean) session.getAttribute("myinfo_verified");
⋮----
redirectAttributes.addFlashAttribute("error", "올바른 경로로 접근해주세요.");
⋮----
model.addAttribute("memberDTO", loginMember);
⋮----
public Map<String, Object> uploadTempImage(@RequestParam("imageFile") MultipartFile imageFile,
⋮----
result.put("success", false);
result.put("message", "로그인이 필요합니다.");
⋮----
if (imageFile.isEmpty()) {
⋮----
result.put("message", "이미지 파일이 없습니다.");
⋮----
if (imageFile.getSize() > 5 * 1024 * 1024) {
⋮----
result.put("message", "파일 크기는 5MB 이하여야 합니다.");
⋮----
String contentType = imageFile.getContentType();
if (contentType == null || !contentType.startsWith("image/")) {
⋮----
result.put("message", "이미지 파일만 업로드 가능합니다.");
⋮----
byte[] imageBytes = imageFile.getBytes();
⋮----
java.util.Base64.getEncoder().encodeToString(imageBytes);
session.setAttribute("tempImageData", base64Image);
session.setAttribute("tempImageName", imageFile.getOriginalFilename());
result.put("success", true);
result.put("imageData", base64Image);
result.put("message", "이미지가 업로드되었습니다.");
⋮----
log.error("임시 이미지 업로드 중 오류 발생", e);
⋮----
result.put("message", "이미지 업로드 중 오류가 발생했습니다.");
⋮----
public Map<String, Object> saveCroppedImage(@RequestParam("croppedImage") MultipartFile croppedImageFile,
⋮----
log.info("🖼️ 크롭된 이미지 저장 요청 - 형식: {}, 품질: {}, 크기: {} bytes",
format, quality, croppedImageFile.getSize());
log.info("📁 파일 정보 - 이름: {}, 컨텐츠 타입: {}",
croppedImageFile.getOriginalFilename(), croppedImageFile.getContentType());
if (croppedImageFile.isEmpty()) {
⋮----
result.put("message", "업로드된 이미지 파일이 비어있습니다.");
⋮----
MemberDTO memberDTO = memberService.findById(loginMember.getMemberId());
⋮----
result.put("message", "회원 정보를 찾을 수 없습니다.");
⋮----
log.info("📋 받은 파라미터 - altText: '{}', format: '{}', quality: '{}'", altText, format, quality);
if (altText != null && !altText.trim().isEmpty()) {
memberDTO.setProfileImageAltText(altText.trim());
log.info("🏷️ 프로필 이미지 Alt 텍스트 설정: {}", altText.trim());
⋮----
memberDTO.setProfileImageAltText("사용자 프로필 사진");
log.info("🏷️ 프로필 이미지 Alt 텍스트 기본값 설정: 사용자 프로필 사진");
⋮----
String contentType = croppedImageFile.getContentType();
⋮----
log.info("📷 업로드된 이미지 형식: {}", contentType);
if (contentType.contains("avif")) {
log.info("✨ AVIF 형식 감지 - 최적 압축 적용됨");
} else if (contentType.contains("webp")) {
log.info("🚀 WebP 형식 감지 - 효율적 압축 적용됨");
} else if (contentType.contains("jpeg")) {
log.info("📸 JPEG 형식 감지 - 호환성 우선 적용됨");
⋮----
memberService.updateMember(memberDTO, croppedImageFile);
MemberDTO updatedMember = memberService.findById(loginMember.getMemberId());
⋮----
session.setAttribute(Constants.SESSION_MEMBER, updatedMember);
⋮----
session.removeAttribute("tempImageData");
session.removeAttribute("tempImageName");
⋮----
result.put("message", "프로필 이미지가 성공적으로 저장되었습니다.");
result.put("profileImageUrl", updatedMember.getProfileImage());
⋮----
log.error("크롭된 이미지 저장 중 오류 발생", e);
⋮----
result.put("message", "이미지 저장 중 오류가 발생했습니다.");
⋮----
public String updateMember(@ModelAttribute MemberDTO memberDTO,
⋮----
log.info("회원정보 수정 요청: memberId={}, name={}, email={}",
memberDTO.getMemberId(), memberDTO.getName(), memberDTO.getEmail());
⋮----
log.info("세션 로그인 멤버: {}", loginMember != null ? loginMember.getMemberId() : "null");
⋮----
log.warn("세션에 로그인 정보가 없음");
⋮----
if (!loginMember.getMemberId().equals(memberDTO.getMemberId())) {
log.warn("권한 없음: 세션 memberId={}, 요청 memberId={}",
loginMember.getMemberId(), memberDTO.getMemberId());
redirectAttributes.addFlashAttribute("error", "권한이 없거나 로그인 정보가 유효하지 않습니다.");
⋮----
if (memberDTO.getName() == null || memberDTO.getName().trim().isEmpty()) {
bindingResult.rejectValue("name", "NotBlank", "이름은 필수입니다.");
⋮----
if (memberDTO.getEmail() != null && !memberDTO.getEmail().trim().isEmpty()) {
if (!memberDTO.getEmail().matches("^[A-Za-z0-9+_.-]+@(.+)$")) {
bindingResult.rejectValue("email", "Email", "올바른 이메일 형식이 아닙니다.");
⋮----
if (memberDTO.getPhone() != null && !memberDTO.getPhone().trim().isEmpty()) {
if (!memberDTO.getPhone().matches("^01(?:0|1|[6-9])-(?:\\d{3}|\\d{4})-\\d{4}$")) {
bindingResult.rejectValue("phone", "Pattern", "올바른 휴대폰 번호 형식이 아닙니다.");
⋮----
log.warn("회원정보 수정 유효성 검사 실패: {}", bindingResult.getAllErrors());
⋮----
log.info("회원정보 수정 서비스 호출 시작");
memberService.updateMember(memberDTO, profileImageFile);
log.info("회원정보 수정 서비스 호출 완료");
MemberDTO updatedMember = memberService.findById(memberDTO.getMemberId());
⋮----
log.info("세션 정보 업데이트 완료: {}", updatedMember.getName());
⋮----
log.warn("업데이트된 회원 정보 조회 실패");
⋮----
redirectAttributes.addFlashAttribute("message", "회원정보가 성공적으로 수정되었습니다.");
⋮----
log.error("회원정보 수정 중 오류 발생: memberId={}, userId={}",
memberDTO.getMemberId(), memberDTO.getUserId(), e);
redirectAttributes.addFlashAttribute("error", "회원정보 수정 중 오류가 발생했습니다: " + e.getMessage());
⋮----
public String changePasswordForm(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
⋮----
public String changePassword(@RequestParam("currentPassword") String currentPassword,
⋮----
String userId = loginMember.getUserId();
⋮----
memberService.changePassword(userId, currentPassword, newPassword, confirmNewPassword);
redirectAttributes.addFlashAttribute("message", "비밀번호가 성공적으로 변경되었습니다.");
⋮----
redirectAttributes.addFlashAttribute("error", e.getMessage());
⋮----
log.error("비밀번호 변경 중 오류 발생: {}", userId, e);
redirectAttributes.addFlashAttribute("error", "비밀번호 변경 중 오류가 발생했습니다.");
⋮----
public String deleteMemberForm(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
⋮----
Map<String, Integer> contentCounts = memberService.getUserContentCounts(loginMember.getMemberId());
model.addAttribute("member", loginMember);
model.addAttribute("contentCounts", contentCounts);
log.info("회원탈퇴 페이지 접근: userId={}, 작성 콘텐츠={}",
loginMember.getUserId(), contentCounts);
⋮----
log.error("회원탈퇴 페이지 로드 중 오류: {}", loginMember.getUserId(), e);
⋮----
model.addAttribute("contentCounts", Map.of("board", 0, "review", 0, "job", 0));
⋮----
public String deleteMember(@RequestParam("password") String password,
⋮----
log.info("회원탈퇴 요청: userId={}, 입력된 비밀번호 길이={}, 입력된 이름={}, 삭제옵션={}",
userId, password.length(), confirmName, deleteOption);
⋮----
MemberDTO currentMember = memberService.findById(loginMember.getMemberId());
⋮----
log.warn("회원탈퇴: 회원 정보를 찾을 수 없음: memberId={}", loginMember.getMemberId());
redirectAttributes.addFlashAttribute("error", "회원 정보를 찾을 수 없습니다.");
⋮----
log.info("비밀번호 비교: DB 비밀번호={}, 입력 비밀번호={}",
currentMember.getPassword(), password);
if (!password.equals(currentMember.getPassword())) {
log.warn("회원탈퇴: 비밀번호 불일치: userId={}", userId);
redirectAttributes.addFlashAttribute("error", "현재 비밀번호가 일치하지 않습니다.");
⋮----
log.info("비밀번호 확인 성공: userId={}", userId);
if (!confirmName.trim().equals(currentMember.getName().trim())) {
log.warn("회원탈퇴: 이름 불일치: userId={}, 입력된 이름={}, 등록된 이름={}",
userId, confirmName, currentMember.getName());
redirectAttributes.addFlashAttribute("error",
String.format("이름이 일치하지 않습니다. 등록된 이름 '%s'를 정확히 입력해주세요.", currentMember.getName()));
⋮----
log.info("이름 확인 성공: userId={}, 이름={}", userId, confirmName);
String resultMessage = memberService.deleteMemberWithOption(userId, deleteOption);
log.info("회원탈퇴 완료: userId={}, 옵션={}", userId, deleteOption);
⋮----
redirectAttributes.addFlashAttribute("message", resultMessage + " 그동안 이용해 주셔서 감사합니다.");
⋮----
log.error("회원 탈퇴 처리 중 오류 발생: {}", userId, e);
redirectAttributes.addFlashAttribute("error", "회원 탈퇴 처리 중 오류가 발생했습니다.");
⋮----
public String listMembers(@RequestParam(defaultValue = "1") int page,
⋮----
if (loginMember == null || !Constants.MEMBER_ROLE_ADMIN.equals(loginMember.getRole())) {
redirectAttributes.addFlashAttribute("error", "관리자 권한이 필요합니다.");
⋮----
MemberDTO searchDTO = new MemberDTO();
searchDTO.setPageSize(pageSize);
searchDTO.setOffset((page - 1) * pageSize);
searchDTO.setRole(role);
List<MemberDTO> members = memberService.getMembersWithPaging(searchDTO);
int totalMembers = memberService.getTotalMembersCount();
int totalPages = (int) Math.ceil((double) totalMembers / pageSize);
model.addAttribute("members", members);
model.addAttribute("currentPage", page);
model.addAttribute("totalPages", totalPages);
model.addAttribute("pageSize", pageSize);
model.addAttribute("currentRole", role);
⋮----
log.error("관리자 회원 목록 조회 중 오류 발생", e);
redirectAttributes.addFlashAttribute("error", "회원 목록 조회 중 오류가 발생했습니다.");
⋮----
public String updateMemberStatus(@RequestParam Long memberId,
⋮----
redirectAttributes.addFlashAttribute("error", "관리자 권한이 없습니다.");
⋮----
memberService.updateMemberStatus(memberId, isActive);
redirectAttributes.addFlashAttribute("message", "회원 상태가 성공적으로 변경되었습니다.");
⋮----
log.error("회원 상태 변경 중 오류 발생: memberId={}", memberId, e);
redirectAttributes.addFlashAttribute("error", "회원 상태 변경 중 오류가 발생했습니다.");
⋮----
public String myPosts(@RequestParam(defaultValue = "all") String type,
⋮----
Long memberId = loginMember.getMemberId();
log.info("내가 쓴 글 페이지 요청: memberId={}, type={}, page={}", memberId, type, page);
⋮----
Map<String, Object> result = memberService.getMyPosts(memberId, type, page, pageSize, offset);
⋮----
model.addAttribute("posts", result.get("posts"));
model.addAttribute("totalCount", result.get("totalCount"));
model.addAttribute("currentType", type);
⋮----
model.addAttribute("totalPages", (int) Math.ceil((double) (Integer) result.get("totalCount") / pageSize));
Map<String, Integer> contentCounts = (Map<String, Integer>) result.get("contentCounts");
⋮----
log.info("내가 쓴 글 조회 완료: 총 {}개", result.get("totalCount"));
⋮----
log.error("내가 쓴 글 페이지 로드 중 오류: memberId={}", loginMember.getMemberId(), e);
redirectAttributes.addFlashAttribute("error", "내가 쓴 글을 불러오는 중 오류가 발생했습니다.");
`````

## File: src/main/java/com/example/carelink/controller/FacilityController.java
`````java
public class FacilityController {
⋮----
public ObjectMapper objectMapper() {
ObjectMapper mapper = new ObjectMapper();
mapper.registerModule(new JavaTimeModule());
⋮----
public Map<String, Object> getFacilityInfo(@PathVariable Long facilityId, HttpSession session) {
⋮----
MemberDTO member = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
⋮----
result.put("success", false);
result.put("message", "로그인이 필요합니다.");
⋮----
FacilityDTO facility = facilityService.getFacilityById(facilityId);
⋮----
result.put("message", "시설을 찾을 수 없습니다.");
⋮----
if (!facility.getRegisteredMemberId().equals(member.getMemberId())
&& !Constants.MEMBER_ROLE_ADMIN.equals(member.getRole())) {
⋮----
result.put("message", "해당 시설 정보를 조회할 권한이 없습니다.");
⋮----
result.put("success", true);
result.put("facility", facility);
log.info("시설 상세 정보 API 조회 완료: facilityId={}, memberId={}", facilityId, member.getMemberId());
⋮----
log.error("시설 상세 정보 API 조회 중 오류: facilityId={}", facilityId, e);
⋮----
result.put("message", "시설 정보 조회 중 오류가 발생했습니다.");
⋮----
public String redirectToEdit(@PathVariable Long facilityId) {
log.info("내 시설에서 시설 수정으로 리다이렉트: facilityId={}", facilityId);
⋮----
public String searchFacilities(
⋮----
log.info("시설 검색 페이지 접속 - facilityName: {}, region: {}, facilityType: {}, gradeRating: {}",
⋮----
facilityName = (facilityName != null && facilityName.trim().isEmpty()) ? null : facilityName;
region = (region != null && region.trim().isEmpty()) ? null : region;
facilityType = (facilityType != null && facilityType.trim().isEmpty()) ? null : facilityType;
FacilityDTO searchCondition = new FacilityDTO();
searchCondition.setFacilityName(facilityName != null ? facilityName.trim() : null);
searchCondition.setFacilityType(facilityType);
searchCondition.setAddress(region);
facilityList = facilityService.searchFacilities(searchCondition);
⋮----
log.error("시설 검색 중 오류 발생", e);
⋮----
model.addAttribute("facilityList", facilityList);
model.addAttribute("facilityName", facilityName);
model.addAttribute("region", region);
model.addAttribute("facilityType", facilityType);
model.addAttribute("gradeRating", gradeRating);
model.addAttribute("KAKAO_APP_KEY", kakaoAppKey);
log.info("검색된 시설 수: {}", facilityList.size());
⋮----
public String getFacilityDetail(@PathVariable Long facilityId, Model model, HttpSession session) {
log.info("시설 상세 정보 페이지 접속 - facilityId: {}", facilityId);
⋮----
model.addAttribute("error", "해당 시설을 찾을 수 없습니다.");
⋮----
List<ReviewDTO> recentReviews = reviewService.getReviewsByFacilityId(facilityId);
if (recentReviews.size() > 5) {
recentReviews = recentReviews.subList(0, 5);
⋮----
Double averageRating = reviewService.getAverageRating(facilityId);
MemberDTO sessionMember = (MemberDTO) session.getAttribute(Constants.SESSION_MEMBER);
boolean isAdmin = sessionMember != null && "ADMIN".equals(sessionMember.getRole());
boolean isOwner = sessionMember != null && facility.getRegisteredMemberId() != null &&
facility.getRegisteredMemberId().equals(sessionMember.getMemberId());
model.addAttribute("facility", facility);
model.addAttribute("recentReviews", recentReviews);
model.addAttribute("averageRating", averageRating);
model.addAttribute("reviewCount", recentReviews.size());
model.addAttribute("pageTitle", facility.getFacilityName() + " 상세정보");
model.addAttribute("sessionMember", sessionMember);
model.addAttribute("isAdmin", isAdmin);
model.addAttribute("isOwner", isOwner);
log.info("시설 상세 정보 조회 완료 - facilityId: {}, 리뷰 수: {}, 관리자: {}, 소유자: {}",
facilityId, recentReviews.size(), isAdmin, isOwner);
⋮----
log.error("시설 상세 정보 조회 중 오류 발생 - facilityId: {}", facilityId, e);
model.addAttribute("error", "시설 정보를 불러오는 중 오류가 발생했습니다.");
⋮----
public String manageFacility(HttpSession session, Model model, RedirectAttributes redirectAttributes) {
⋮----
redirectAttributes.addFlashAttribute("error", "로그인이 필요합니다.");
⋮----
if (!Constants.MEMBER_ROLE_FACILITY.equals(member.getRole())) {
redirectAttributes.addFlashAttribute("error", "시설 회원만 접근할 수 있습니다.");
⋮----
List<FacilityDTO> facilities = facilityService.getFacilitiesByMemberId(member.getMemberId());
model.addAttribute("facilities", facilities);
model.addAttribute("facilityCount", facilities.size());
log.info("시설 관리 페이지 접근: memberId={}, 시설 수={}",
member.getMemberId(), facilities.size());
⋮----
log.error("시설 관리 페이지 조회 중 오류 발생: memberId={}", member.getMemberId(), e);
redirectAttributes.addFlashAttribute("error", "시설 정보를 불러오는 중 오류가 발생했습니다.");
⋮----
public String editFacilityForm(@PathVariable Long facilityId, HttpSession session,
⋮----
redirectAttributes.addFlashAttribute("error", "시설을 찾을 수 없습니다.");
⋮----
redirectAttributes.addFlashAttribute("error", "해당 시설을 수정할 권한이 없습니다.");
⋮----
log.info("시설 수정 페이지 접근: facilityId={}, memberId={}", facilityId, member.getMemberId());
⋮----
log.error("시설 수정 페이지 조회 중 오류 발생: facilityId={}", facilityId, e);
⋮----
public String updateFacility(@PathVariable Long facilityId,
⋮----
FacilityDTO existingFacility = facilityService.getFacilityById(facilityId);
⋮----
if (!existingFacility.getRegisteredMemberId().equals(member.getMemberId())
⋮----
facilityDTO.setFacilityId(facilityId);
facilityDTO.setRegisteredMemberId(existingFacility.getRegisteredMemberId());
facilityDTO.setIsApproved(existingFacility.getIsApproved());
String approvalStatus = existingFacility.getApprovalStatus();
if (approvalStatus == null || approvalStatus.trim().isEmpty()) {
if (existingFacility.getIsApproved() != null && existingFacility.getIsApproved()) {
⋮----
log.info("🔧 approval_status NULL 방지 - 승인된 시설: APPROVED");
⋮----
log.info("🔧 approval_status NULL 방지 - 미승인 시설: PENDING");
⋮----
facilityDTO.setApprovalStatus(approvalStatus);
facilityDTO.setAverageRating(existingFacility.getAverageRating());
facilityDTO.setReviewCount(existingFacility.getReviewCount());
facilityDTO.setCurrentOccupancy(existingFacility.getCurrentOccupancy());
facilityDTO.setGradeRating(existingFacility.getGradeRating());
facilityService.updateFacility(facilityDTO, facilityImageFile);
log.info("시설 정보 수정 완료: facilityId={}, memberId={}", facilityId, member.getMemberId());
redirectAttributes.addFlashAttribute("message", "시설 정보가 성공적으로 수정되었습니다.");
⋮----
log.error("시설 정보 수정 중 오류 발생: facilityId={}", facilityId, e);
redirectAttributes.addFlashAttribute("error", "시설 정보 수정 중 오류가 발생했습니다.");
⋮----
public String deleteFacility(@PathVariable Long facilityId,
⋮----
redirectAttributes.addFlashAttribute("error", "해당 시설을 삭제할 권한이 없습니다.");
⋮----
facilityService.deleteFacility(facilityId);
log.info("시설 삭제 완료: facilityId={}, memberId={}", facilityId, member.getMemberId());
redirectAttributes.addFlashAttribute("message", "시설이 성공적으로 삭제되었습니다.");
⋮----
log.error("시설 삭제 중 오류 발생: facilityId={}", facilityId, e);
redirectAttributes.addFlashAttribute("error", "시설 삭제 중 오류가 발생했습니다.");
⋮----
public FacilityDTO getFacilityApi(@PathVariable Long facilityId, HttpSession session) {
⋮----
throw new RuntimeException("로그인이 필요합니다.");
⋮----
throw new RuntimeException("시설을 찾을 수 없습니다.");
⋮----
throw new RuntimeException("해당 시설을 조회할 권한이 없습니다.");
⋮----
public String cropImagePage(@PathVariable Long facilityId,
⋮----
redirectAttributes.addFlashAttribute("error", "해당 시설의 이미지를 관리할 권한이 없습니다.");
⋮----
log.info("시설 이미지 크롭 페이지 접속: facilityId={}, memberId={}", facilityId, member.getMemberId());
⋮----
log.error("시설 이미지 크롭 페이지 오류: facilityId={}", facilityId, e);
redirectAttributes.addFlashAttribute("error", "페이지 로드 중 오류가 발생했습니다.");
⋮----
public Map<String, Object> saveFacilityImage(@PathVariable Long facilityId,
⋮----
log.info("🔥 시설 이미지 저장 시작 - facilityId: {}, 받은 파라미터들 확인", facilityId);
log.info("📋 altText: '{}', format: '{}', imageIndex: '{}', customFileName: '{}'", altText, format, imageIndex, customFileName);
log.info("📁 파일 정보 - 이름: '{}', 크기: {}bytes, 타입: '{}'",
facilityImageFile.getOriginalFilename(), facilityImageFile.getSize(), facilityImageFile.getContentType());
⋮----
log.error("❌ 로그인된 사용자가 없음");
⋮----
log.info("👤 로그인 사용자: {} (role: {})", member.getUserId(), member.getRole());
⋮----
result.put("message", "해당 시설의 이미지를 관리할 권한이 없습니다.");
⋮----
log.info("🖼️ 시설 이미지 저장 요청 - facilityId: {}, 형식: {}, 인덱스: {}, 크기: {} bytes",
facilityId, format, imageIndex, facilityImageFile.getSize());
if (facilityImageFile.isEmpty()) {
⋮----
result.put("message", "업로드된 이미지 파일이 비어있습니다.");
⋮----
if (altText != null && !altText.trim().isEmpty()) {
finalAltText = altText.trim();
log.info("🏷️ 시설 이미지 Alt 텍스트 설정: {}", finalAltText);
⋮----
finalAltText = facility.getFacilityName() + " 시설 이미지";
if (imageIndex != null && !imageIndex.isEmpty()) {
finalAltText += " " + (Integer.parseInt(imageIndex) + 1);
⋮----
log.info("🏷️ 시설 이미지 Alt 텍스트 기본값 설정: {}", finalAltText);
⋮----
String contentType = facilityImageFile.getContentType();
⋮----
log.info("📷 업로드된 이미지 형식: {}", contentType);
if (contentType.contains("avif")) {
log.info("✨ AVIF 형식 감지 - 최적 압축 적용됨");
} else if (contentType.contains("webp")) {
log.info("🚀 WebP 형식 감지 - 효율적 압축 적용됨");
} else if (contentType.contains("jpeg")) {
log.info("📸 JPEG 형식 감지 - 호환성 우선 적용됨");
⋮----
Integer orderIndex = imageIndex != null ? Integer.parseInt(imageIndex) : null;
log.info("🔧 서비스 호출 전 - facilityId: {}, orderIndex: {}, altText: '{}', customFileName: '{}'",
⋮----
FacilityImageDTO savedImage = facilityImageService.saveSingleFacilityImage(
⋮----
log.info("✅ 서비스 호출 완료 - 저장된 이미지ID: {}, 경로: {}", savedImage.getImageId(), savedImage.getImagePath());
⋮----
result.put("message", "시설 이미지가 성공적으로 저장되었습니다.");
result.put("facilityId", facilityId);
result.put("imageIndex", imageIndex);
result.put("imageId", savedImage.getImageId());
result.put("imagePath", savedImage.getImagePath());
log.info("✅ 시설 이미지 저장 성공: facilityId={}, imageId={}", facilityId, savedImage.getImageId());
⋮----
log.error("❌ 시설 이미지 저장 중 오류 발생: facilityId={}", facilityId, e);
⋮----
result.put("message", "이미지 저장 중 오류가 발생했습니다: " + e.getMessage());
`````

## File: src/main/resources/schema.sql
`````sql
CREATE DATABASE carelink DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE carelink;
CREATE TABLE member (
    member_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '회원 ID',
    user_id VARCHAR(20) NOT NULL UNIQUE COMMENT '사용자 ID (로그인용)',
    password VARCHAR(255) NOT NULL COMMENT '비밀번호',
    name VARCHAR(50) NOT NULL COMMENT '이름',
    email VARCHAR(100) NOT NULL UNIQUE COMMENT '이메일',
    phone VARCHAR(20) COMMENT '휴대폰 번호',
    role VARCHAR(20) NOT NULL DEFAULT 'USER' COMMENT '역할 (USER, FACILITY, ADMIN)',
    address TEXT COMMENT '주소',
    detail_address TEXT COMMENT '상세 주소',
    profile_image VARCHAR(255) COMMENT '프로필 이미지 경로',
    profile_image_alt_text VARCHAR(255) COMMENT '프로필 이미지 alt 텍스트 (SEO 최적화용)',
    is_active BOOLEAN NOT NULL DEFAULT TRUE COMMENT '계정 활성화 여부',
    login_fail_count INT NOT NULL DEFAULT 0 COMMENT '로그인 실패 횟수',
    last_login_at DATETIME COMMENT '마지막 로그인 시간',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성일시',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일시',
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE COMMENT '삭제 여부'
) COMMENT='회원 정보';
CREATE TABLE facility (
    facility_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '시설 ID',
    facility_name VARCHAR(100) NOT NULL COMMENT '시설명',
    facility_type VARCHAR(20) NOT NULL COMMENT '시설 유형 (NURSING_HOME, HOSPITAL, DAY_CARE)',
    address TEXT NOT NULL COMMENT '주소',
    detail_address TEXT COMMENT '상세 주소',
    phone VARCHAR(20) NOT NULL COMMENT '전화번호',
    latitude DECIMAL(10, 8) COMMENT '위도',
    longitude DECIMAL(11, 8) COMMENT '경도',
    description TEXT COMMENT '시설 설명',
    facility_image VARCHAR(255) COMMENT '시설 메인 이미지 경로 (레거시 호환성용)',
    facility_image_alt_text VARCHAR(255) COMMENT '시설 이미지 alt 텍스트 (SEO 최적화용)',
    homepage VARCHAR(255) COMMENT '홈페이지 URL',
    capacity INT COMMENT '수용 인원',
    current_occupancy INT COMMENT '현재 입소자 수',
    operating_hours VARCHAR(100) COMMENT '운영 시간',
    features TEXT COMMENT '시설 특징',
    average_rating FLOAT DEFAULT 0 COMMENT '평균 평점',
    review_count INT DEFAULT 0 COMMENT '리뷰 수',
    grade_rating INT COMMENT '시설 등급 (1-5등급, 1등급이 최고)',
    image_count INT DEFAULT 0 COMMENT '시설 이미지 개수 (facility_images 테이블 기준)',
    main_image_path VARCHAR(500) COMMENT '메인 이미지 경로 (다중 이미지 시스템)',
    registered_member_id BIGINT NOT NULL COMMENT '등록한 회원 ID',
    is_approved BOOLEAN NOT NULL DEFAULT FALSE COMMENT '승인 여부',
    approval_status VARCHAR(20) NOT NULL DEFAULT 'PENDING' COMMENT '승인 상태 (PENDING, APPROVED, REJECTED)',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성일시',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일시',
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE COMMENT '삭제 여부',
    FOREIGN KEY (registered_member_id) REFERENCES member(member_id)
) COMMENT='시설 정보';
CREATE TABLE facility_images (
    image_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '이미지 ID',
    facility_id BIGINT NOT NULL COMMENT '시설 ID',
    image_path VARCHAR(500) NOT NULL COMMENT '이미지 경로',
    image_alt_text VARCHAR(200) COMMENT '이미지 alt 텍스트 (SEO 최적화용)',
    image_order INT DEFAULT 0 COMMENT '이미지 순서 (0부터 시작)',
    is_main_image BOOLEAN DEFAULT FALSE COMMENT '메인 이미지 여부',
    upload_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '업로드일시',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일시',
    FOREIGN KEY (facility_id) REFERENCES facility(facility_id) ON DELETE CASCADE,
    INDEX idx_facility_images_facility_id (facility_id),
    INDEX idx_facility_images_main (facility_id, is_main_image),
    INDEX idx_facility_images_order (facility_id, image_order)
) COMMENT='시설 이미지 (최대 5장 지원)';
CREATE TABLE job_posting (
    job_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '구인구직 ID',
    title VARCHAR(200) NOT NULL COMMENT '제목',
    content TEXT NOT NULL COMMENT '내용',
    job_type VARCHAR(20) NOT NULL COMMENT '구인구직 유형 (RECRUIT: 구인, SEARCH: 구직)',
    work_type VARCHAR(20) NOT NULL COMMENT '근무 형태 (FULL_TIME, PART_TIME, TEMPORARY)',
    position VARCHAR(50) COMMENT '모집 직종',
    recruit_count INT COMMENT '모집 인원',
    salary_type VARCHAR(20) COMMENT '급여 유형 (HOURLY, MONTHLY, ANNUAL)',
    salary_min DECIMAL(10, 0) COMMENT '최소 급여',
    salary_max DECIMAL(10, 0) COMMENT '최대 급여',
    salary_description TEXT COMMENT '급여 설명',
    work_location VARCHAR(100) COMMENT '근무 지역',
    work_hours VARCHAR(100) COMMENT '근무 시간',
    experience VARCHAR(50) COMMENT '경력 조건',
    education VARCHAR(50) COMMENT '학력 조건',
    qualifications TEXT COMMENT '자격 요건',
    benefits TEXT COMMENT '복리후생',
    start_date DATE COMMENT '모집 시작일',
    end_date DATE COMMENT '모집 마감일',
    contact_name VARCHAR(50) COMMENT '담당자 이름',
    contact_phone VARCHAR(20) COMMENT '담당자 연락처',
    contact_email VARCHAR(100) COMMENT '담당자 이메일',
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE' COMMENT '게시글 상태 (ACTIVE, CLOSED, DRAFT)',
    view_count INT NOT NULL DEFAULT 0 COMMENT '조회수',
    apply_count INT NOT NULL DEFAULT 0 COMMENT '지원자 수',
    member_id BIGINT NOT NULL COMMENT '작성자 ID',
    facility_id BIGINT COMMENT '관련 시설 ID',
    attachment_path VARCHAR(255) COMMENT '첨부파일 경로',
    attachment_name VARCHAR(255) COMMENT '첨부파일 원본명',
    priority INT NOT NULL DEFAULT 0 COMMENT '우선순위',
    is_highlight BOOLEAN NOT NULL DEFAULT FALSE COMMENT '강조 표시 여부',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성일시',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일시',
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE COMMENT '삭제 여부',
    FOREIGN KEY (member_id) REFERENCES member(member_id),
    FOREIGN KEY (facility_id) REFERENCES facility(facility_id)
) COMMENT='구인구직 게시글';
CREATE TABLE review (
    review_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '리뷰 ID',
    facility_id BIGINT NOT NULL COMMENT '시설 ID',
    member_id BIGINT NOT NULL COMMENT '작성자 ID',
    title VARCHAR(200) NOT NULL COMMENT '리뷰 제목',
    content TEXT NOT NULL COMMENT '리뷰 내용',
    rating INT NOT NULL COMMENT '평점 (1-5점)',
    service_rating INT COMMENT '서비스 평점',
    facility_rating INT COMMENT '시설 평점',
    staff_rating INT COMMENT '직원 평점',
    price_rating INT COMMENT '가격 평점',
    review_image1 VARCHAR(255) COMMENT '리뷰 이미지 1',
    review_image2 VARCHAR(255) COMMENT '리뷰 이미지 2',
    review_image3 VARCHAR(255) COMMENT '리뷰 이미지 3',
    like_count INT NOT NULL DEFAULT 0 COMMENT '추천 수',
    dislike_count INT NOT NULL DEFAULT 0 COMMENT '비추천 수',
    view_count INT NOT NULL DEFAULT 0 COMMENT '조회수',
    is_visible BOOLEAN NOT NULL DEFAULT TRUE COMMENT '표시 여부',
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE' COMMENT '상태 (ACTIVE, HIDDEN, REPORTED)',
    parent_review_id BIGINT COMMENT '부모 리뷰 ID (답글인 경우)',
    reply_count INT NOT NULL DEFAULT 0 COMMENT '답글 수',
    reply_depth INT NOT NULL DEFAULT 0 COMMENT '답글 깊이',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성일시',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일시',
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE COMMENT '삭제 여부',
    FOREIGN KEY (facility_id) REFERENCES facility(facility_id),
    FOREIGN KEY (member_id) REFERENCES member(member_id),
    FOREIGN KEY (parent_review_id) REFERENCES review(review_id)
) COMMENT='시설 리뷰';
CREATE TABLE board (
    board_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '게시글 ID',
    board_type VARCHAR(20) NOT NULL COMMENT '게시판 유형 (NOTICE, INFO, QNA, FAQ)',
    title VARCHAR(200) NOT NULL COMMENT '제목',
    content TEXT NOT NULL COMMENT '내용',
    member_id BIGINT NOT NULL COMMENT '작성자 ID',
    view_count INT NOT NULL DEFAULT 0 COMMENT '조회수',
    like_count INT NOT NULL DEFAULT 0 COMMENT '추천수',
    comment_count INT NOT NULL DEFAULT 0 COMMENT '댓글수',
    attachment_path VARCHAR(255) COMMENT '첨부파일 경로',
    attachment_name VARCHAR(255) COMMENT '첨부파일 원본명',
    attachment_size BIGINT COMMENT '첨부파일 크기',
    is_notice BOOLEAN NOT NULL DEFAULT FALSE COMMENT '공지사항 여부',
    is_secret BOOLEAN NOT NULL DEFAULT FALSE COMMENT '비밀글 여부',
    is_active BOOLEAN NOT NULL DEFAULT TRUE COMMENT '활성 상태',
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE' COMMENT '상태 (ACTIVE, HIDDEN, DELETED)',
    category VARCHAR(50) COMMENT '카테고리',
    sub_category VARCHAR(50) COMMENT '서브 카테고리',
    priority INT NOT NULL DEFAULT 0 COMMENT '우선순위',
    is_pinned BOOLEAN NOT NULL DEFAULT FALSE COMMENT '상단 고정 여부',
    parent_board_id BIGINT COMMENT '부모 게시글 ID (답글인 경우)',
    reply_depth INT NOT NULL DEFAULT 0 COMMENT '답글 깊이',
    reply_order INT NOT NULL DEFAULT 0 COMMENT '답글 순서',
    tags VARCHAR(500) COMMENT '태그 (콤마로 구분)',
    meta_description TEXT COMMENT '메타 설명',
    meta_keywords VARCHAR(500) COMMENT '메타 키워드',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성일시',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일시',
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE COMMENT '삭제 여부',
    FOREIGN KEY (member_id) REFERENCES member(member_id),
    FOREIGN KEY (parent_board_id) REFERENCES board(board_id)
) COMMENT='정보 게시판';
DROP TABLE IF EXISTS board_images;
CREATE TABLE board_images (
    image_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '이미지 ID',
    board_id BIGINT NOT NULL COMMENT '게시글 ID',
    image_path VARCHAR(500) NOT NULL COMMENT '원본 이미지 경로',
    webp_path VARCHAR(500) COMMENT 'WebP 변환 이미지 경로',
    thumbnail_small VARCHAR(500) COMMENT '작은 썸네일 경로 (300x200)',
    thumbnail_medium VARCHAR(500) COMMENT '중간 썸네일 경로 (600x400)',
    thumbnail_large VARCHAR(500) COMMENT '큰 썸네일 경로 (1200x800)',
    fallback_jpg_path VARCHAR(500) COMMENT 'JPG fallback 경로',
    original_filename VARCHAR(255) COMMENT '원본 파일명',
    file_size BIGINT COMMENT '파일 크기 (bytes)',
    file_size_webp BIGINT COMMENT 'WebP 파일 크기 (bytes)',
    width INT COMMENT '이미지 너비',
    height INT COMMENT '이미지 높이',
    alt_text VARCHAR(255) COMMENT '이미지 대체 텍스트 (SEO/접근성)',
    caption VARCHAR(500) COMMENT '이미지 설명',
    image_order INT DEFAULT 0 COMMENT '이미지 순서',
    is_active BOOLEAN DEFAULT TRUE COMMENT '활성 상태',
    upload_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '업로드 일시',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 일시',
    FOREIGN KEY (board_id) REFERENCES board(board_id) ON DELETE CASCADE,
    INDEX idx_board_images_board_id (board_id),
    INDEX idx_board_images_order (board_id, image_order)
) COMMENT='게시판 이미지 첨부파일 (WebP 지원)';
DROP TABLE IF EXISTS review_images;
CREATE TABLE review_images (
    image_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '이미지 ID',
    review_id BIGINT NOT NULL COMMENT '리뷰 ID',
    image_path VARCHAR(500) NOT NULL COMMENT '원본 이미지 경로',
    webp_path VARCHAR(500) COMMENT 'WebP 변환 이미지 경로',
    thumbnail_small VARCHAR(500) COMMENT '작은 썸네일 경로 (300x200)',
    thumbnail_medium VARCHAR(500) COMMENT '중간 썸네일 경로 (600x400)',
    thumbnail_large VARCHAR(500) COMMENT '큰 썸네일 경로 (1200x800)',
    fallback_jpg_path VARCHAR(500) COMMENT 'JPG fallback 경로',
    original_filename VARCHAR(255) COMMENT '원본 파일명',
    file_size BIGINT COMMENT '파일 크기 (bytes)',
    file_size_webp BIGINT COMMENT 'WebP 파일 크기 (bytes)',
    width INT COMMENT '이미지 너비',
    height INT COMMENT '이미지 높이',
    alt_text VARCHAR(255) COMMENT '이미지 대체 텍스트 (SEO/접근성)',
    caption VARCHAR(500) COMMENT '이미지 설명',
    image_order INT DEFAULT 0 COMMENT '이미지 순서',
    is_active BOOLEAN DEFAULT TRUE COMMENT '활성 상태',
    upload_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '업로드 일시',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 일시',
    FOREIGN KEY (review_id) REFERENCES review(review_id) ON DELETE CASCADE,
    INDEX idx_review_images_review_id (review_id),
    INDEX idx_review_images_order (review_id, image_order)
) COMMENT='리뷰 이미지 첨부파일 (WebP 지원)';
ALTER TABLE board
ADD COLUMN image_count INT DEFAULT 0 COMMENT '첨부 이미지 개수',
ADD COLUMN has_images BOOLEAN DEFAULT FALSE COMMENT '이미지 포함 여부';
ALTER TABLE review
ADD COLUMN image_count INT DEFAULT 0 COMMENT '첨부 이미지 개수',
ADD COLUMN has_images BOOLEAN DEFAULT FALSE COMMENT '이미지 포함 여부';
DROP TRIGGER IF EXISTS update_board_image_count_insert;
DROP TRIGGER IF EXISTS update_board_image_count_delete;
DROP TRIGGER IF EXISTS update_review_image_count_insert;
DROP TRIGGER IF EXISTS update_review_image_count_delete;
DELIMITER $$
CREATE TRIGGER update_board_image_count_insert
AFTER INSERT ON board_images
FOR EACH ROW
BEGIN
    UPDATE board
    SET image_count = (
        SELECT COUNT(*) FROM board_images
        WHERE board_id = NEW.board_id AND is_active = TRUE
    ),
    has_images = (
        SELECT COUNT(*) FROM board_images
        WHERE board_id = NEW.board_id AND is_active = TRUE
    ) > 0
    WHERE board_id = NEW.board_id;
END$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER update_board_image_count_delete
AFTER DELETE ON board_images
FOR EACH ROW
BEGIN
    UPDATE board
    SET image_count = (
        SELECT COUNT(*) FROM board_images
        WHERE board_id = OLD.board_id AND is_active = TRUE
    ),
    has_images = (
        SELECT COUNT(*) FROM board_images
        WHERE board_id = OLD.board_id AND is_active = TRUE
    ) > 0
    WHERE board_id = OLD.board_id;
END$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER update_review_image_count_insert
AFTER INSERT ON review_images
FOR EACH ROW
BEGIN
    UPDATE review
    SET image_count = (
        SELECT COUNT(*) FROM review_images
        WHERE review_id = NEW.review_id AND is_active = TRUE
    ),
    has_images = (
        SELECT COUNT(*) FROM review_images
        WHERE review_id = NEW.review_id AND is_active = TRUE
    ) > 0
    WHERE review_id = NEW.review_id;
END$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER update_review_image_count_delete
AFTER DELETE ON review_images
FOR EACH ROW
BEGIN
    UPDATE review
    SET image_count = (
        SELECT COUNT(*) FROM review_images
        WHERE review_id = OLD.review_id AND is_active = TRUE
    ),
    has_images = (
        SELECT COUNT(*) FROM review_images
        WHERE review_id = OLD.review_id AND is_active = TRUE
    ) > 0
    WHERE review_id = OLD.review_id;
END$$
DELIMITER ;
CREATE INDEX idx_member_user_id ON member(user_id);
CREATE INDEX idx_member_email ON member(email);
CREATE INDEX idx_member_role ON member(role);
CREATE INDEX idx_member_created_at ON member(created_at);
CREATE INDEX idx_member_is_deleted ON member(is_deleted);
CREATE INDEX idx_facility_type ON facility(facility_type);
CREATE INDEX idx_facility_location ON facility(latitude, longitude);
CREATE INDEX idx_facility_member_id ON facility(registered_member_id);
CREATE INDEX idx_facility_created_at ON facility(created_at);
CREATE INDEX idx_facility_approval ON facility(is_approved, approval_status);
CREATE INDEX idx_facility_rating ON facility(average_rating);
CREATE INDEX idx_facility_is_deleted ON facility(is_deleted);
CREATE INDEX idx_facility_images_upload_date ON facility_images(upload_date);
CREATE INDEX idx_facility_images_alt_text ON facility_images(image_alt_text);
CREATE INDEX idx_job_type ON job_posting(job_type);
CREATE INDEX idx_job_work_type ON job_posting(work_type);
CREATE INDEX idx_job_member_id ON job_posting(member_id);
CREATE INDEX idx_job_facility_id ON job_posting(facility_id);
CREATE INDEX idx_job_created_at ON job_posting(created_at);
CREATE INDEX idx_job_status ON job_posting(status);
CREATE INDEX idx_job_location ON job_posting(work_location);
CREATE INDEX idx_job_is_deleted ON job_posting(is_deleted);
CREATE INDEX idx_review_facility_id ON review(facility_id);
CREATE INDEX idx_review_member_id ON review(member_id);
CREATE INDEX idx_review_created_at ON review(created_at);
CREATE INDEX idx_review_rating ON review(rating);
CREATE INDEX idx_review_status ON review(status);
CREATE INDEX idx_review_is_deleted ON review(is_deleted);
CREATE INDEX idx_board_type ON board(board_type);
CREATE INDEX idx_board_member_id ON board(member_id);
CREATE INDEX idx_board_created_at ON board(created_at);
CREATE INDEX idx_board_category ON board(category);
CREATE INDEX idx_board_status ON board(status);
CREATE INDEX idx_board_priority ON board(priority);
CREATE INDEX idx_board_is_deleted ON board(is_deleted);
CREATE INDEX idx_board_images_upload_date ON board_images(upload_date);
CREATE INDEX idx_board_images_active ON board_images(is_active);
CREATE INDEX idx_board_images_filename ON board_images(original_filename);
CREATE INDEX idx_review_images_upload_date ON review_images(upload_date);
CREATE INDEX idx_review_images_active ON review_images(is_active);
CREATE INDEX idx_review_images_filename ON review_images(original_filename);
INSERT INTO member (user_id, password, name, email, phone, role, address, is_active, login_fail_count, created_at, updated_at, is_deleted) VALUES
    ('admin', 'admin123', '관리자', 'admin@carelink.com', '02-1234-5678', 'ADMIN', '서울시 종로구 세종대로 1', TRUE, 0, NOW(), NOW(), FALSE),
    ('user01', 'user123', '김철수', 'kim.cs@example.com', '010-1111-2222', 'USER', '서울시 강남구 테헤란로 123', TRUE, 0, NOW(), NOW(), FALSE),
    ('user02', 'user123', '이영희', 'lee.yh@example.com', '010-2222-3333', 'USER', '부산시 해운대구 센텀중앙로 79', TRUE, 0, NOW(), NOW(), FALSE),
    ('user03', 'user123', '박민수', 'park.ms@example.com', '010-3333-4444', 'USER', '대구시 중구 동성로 1', TRUE, 0, NOW(), NOW(), FALSE),
    ('user04', 'user123', '최지은', 'choi.je@example.com', '010-4444-5555', 'USER', '인천시 남동구 구월동 1234', TRUE, 0, NOW(), NOW(), FALSE),
    ('facility01', 'facility123', '서울요양원장', 'seoul.admin@example.com', '02-5555-6666', 'FACILITY', '서울시 서초구 서초대로 123', TRUE, 0, NOW(), NOW(), FALSE),
    ('facility02', 'facility123', '부산실버타운장', 'busan.admin@example.com', '051-7777-8888', 'FACILITY', '부산시 부산진구 서면로 456', TRUE, 0, NOW(), NOW(), FALSE);
INSERT INTO facility (facility_name, facility_type, address, detail_address, phone, latitude, longitude, description, capacity, current_occupancy, operating_hours, features, average_rating, review_count, grade_rating, image_count, main_image_path, registered_member_id, is_approved, approval_status, created_at, updated_at, is_deleted) VALUES
    ('서울 행복요양원', 'NURSING_HOME', '서울시 강남구 테헤란로 123', '2층 201호', '02-1111-2222', 37.500913, 127.037149, '24시간 전문 간병 서비스를 제공하는 프리미엄 요양원입니다.', 50, 35, '24시간 운영', '24시간 간병서비스, 물리치료실, 인지치료 프로그램', 4.5, 8, 1, 0, NULL, 6, TRUE, 'APPROVED', NOW(), NOW(), FALSE),
    ('부산 바다뷰 실버타운', 'NURSING_HOME', '부산시 해운대구 센텀중앙로 79', '1층', '051-3333-4444', 35.169188, 129.132800, '바다가 보이는 아름다운 환경의 실버타운입니다.', 80, 60, '08:00-22:00', '바다뷰, 실버카페, 도서관, 수영장', 4.2, 12, 2, 0, NULL, 7, TRUE, 'APPROVED', NOW(), NOW(), FALSE),
    ('대전 건강 데이케어센터', 'DAY_CARE', '대전시 유성구 과학로 123', 'B1층', '042-5555-6666', 36.350411, 127.384548, '주간보호 전문 센터로 다양한 프로그램을 운영합니다.', 30, 20, '09:00-18:00', '송영버스, 급식서비스, 건강관리 프로그램', 4.0, 6, 3, 0, NULL, 6, TRUE, 'APPROVED', NOW(), NOW(), FALSE),
    ('인천 평안 요양병원', 'HOSPITAL', '인천시 남동구 구월동 1234', '3-5층', '032-7777-8888', 37.456256, 126.731536, '의료진이 상주하는 전문 요양병원입니다.', 100, 75, '24시간 운영', '의료진 상주, 응급실, 재활치료실, 검사실', 4.3, 15, 1, 0, NULL, 6, TRUE, 'APPROVED', NOW(), NOW(), FALSE),
    ('경기 사랑 재가센터', 'DAY_CARE', '경기도 수원시 팔달구 중부대로 123', '1층', '031-9999-0000', 37.283897, 127.009121, '재가 요양 서비스 전문 센터입니다.', 25, 18, '08:00-20:00', '재가방문, 목욕서비스, 간병서비스', 3.8, 4, 4, 0, NULL, 6, TRUE, 'APPROVED', NOW(), NOW(), FALSE);
INSERT INTO job_posting (title, content, job_type, work_type, position, recruit_count, salary_type, salary_min, salary_max, salary_description, work_location, work_hours, experience, education, qualifications, benefits, start_date, end_date, contact_name, contact_phone, contact_email, status, member_id, facility_id, priority, is_highlight, created_at, updated_at, is_deleted) VALUES
    ('[서울 행복요양원] 요양보호사 정규직 모집', '경력 3년 이상 요양보호사를 모집합니다. 성실하고 책임감 있는 분을 찾습니다.', 'RECRUIT', 'FULL_TIME', '요양보호사', 3, 'MONTHLY', 2800000, 3200000, '경력에 따라 차등 지급', '서울시 강남구', '3교대 (08:00-16:00, 16:00-24:00, 24:00-08:00)', '3년 이상', '고등학교 졸업 이상', '요양보호사 자격증 필수', '4대보험, 퇴직금, 명절상여금, 교육비 지원', '2024-01-15', '2024-02-15', '김과장', '02-1111-2222', 'recruit@seoul-happy.com', 'ACTIVE', 6, 1, 5, FALSE, NOW(), NOW(), FALSE),
    ('[부산 바다뷰 실버타운] 간호사 모집', '실버타운에서 근무할 간호사를 모집합니다. 노인 간호 경험자 우대', 'RECRUIT', 'FULL_TIME', '간호사', 2, 'MONTHLY', 3500000, 4000000, '야간근무수당 별도', '부산시 해운대구', '2교대 (09:00-21:00, 21:00-09:00)', '1년 이상', '간호대학 졸업', '간호사 면허증 필수', '4대보험, 퇴직금, 야간수당, 주말수당', '2024-01-20', '2024-02-20', '이팀장', '051-3333-4444', 'hr@busan-silver.com', 'ACTIVE', 7, 2, 3, TRUE, NOW(), NOW(), FALSE),
    ('[경력직 요양보호사] 좋은 근무환경 찾습니다', '10년 경력의 요양보호사입니다. 야간근무 가능하며 성실히 근무하겠습니다.', 'SEARCH', 'FULL_TIME', '요양보호사', 1, 'MONTHLY', 2500000, 3000000, '야간수당 포함 희망', '서울/경기 지역', '3교대 가능', '10년', '고등학교 졸업', '요양보호사 1급 자격증', '4대보험, 퇴직금', '2024-01-10', '2024-03-10', '홍길동', '010-1234-5678', 'hong@example.com', 'ACTIVE', 2, NULL, 0, FALSE, NOW(), NOW(), FALSE),
    ('대전 데이케어센터 사회복지사 모집', '데이케어센터에서 근무할 사회복지사를 모집합니다.', 'RECRUIT', 'FULL_TIME', '사회복지사', 1, 'MONTHLY', 2600000, 2800000, '기본급 + 수당', '대전시 유성구', '09:00-18:00 (월-토)', '신입 가능', '사회복지학과 졸업', '사회복지사 2급 이상', '4대보험, 퇴직금, 교육비 지원', '2024-01-25', '2024-02-25', '박실장', '042-5555-6666', 'welfare@daejeon.com', 'ACTIVE', 6, 3, 2, FALSE, NOW(), NOW(), FALSE),
    ('물리치료사 파트타임 구직합니다', '물리치료 경력 5년으로 파트타임으로 근무하고 싶습니다.', 'SEARCH', 'PART_TIME', '물리치료사', 1, 'HOURLY', 25000, 30000, '시간당 희망', '수도권 지역', '주 3일 이내', '5년', '물리치료학과 졸업', '물리치료사 면허증', '4대보험', '2024-01-12', '2024-02-12', '김물리', '010-9999-8888', 'pt.kim@example.com', 'ACTIVE', 3, NULL, 0, FALSE, NOW(), NOW(), FALSE);
INSERT INTO review (facility_id, member_id, title, content, rating, service_rating, facility_rating, staff_rating, price_rating, like_count, dislike_count, view_count, is_visible, status, parent_review_id, reply_count, reply_depth, created_at, updated_at, is_deleted) VALUES
    (1, 2, '서울 행복요양원 이용 후기', '어머니를 모시고 있는데 시설도 깨끗하고 직원분들이 정말 친절합니다. 특히 간병서비스가 24시간 제공되어 안심이 됩니다. 추천합니다!', 5, 5, 4, 5, 4, 8, 0, 45, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (1, 3, '만족스러운 요양원', '아버지가 편안하게 지내고 계세요. 물리치료 프로그램도 잘 되어 있고 식사도 맛있다고 하십니다.', 4, 4, 4, 4, 4, 5, 0, 32, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (1, 4, '좋은 선택이었습니다', '처음엔 망설였는데 가족 모두 만족하고 있습니다. 인지치료 프로그램이 특히 좋네요.', 4, 4, 4, 5, 3, 3, 0, 28, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (2, 2, '부산 바다뷰 실버타운 추천', '바다가 보이는 뷰가 정말 좋아요. 할머니가 매일 바다를 보며 산책하신다고 하니 마음이 놓입니다.', 5, 4, 5, 4, 4, 12, 1, 67, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (2, 3, '시설이 현대적이에요', '최신 시설로 잘 갖춰져 있고 수영장도 있어서 좋습니다. 다만 비용이 좀 있는 편이에요.', 4, 4, 5, 4, 3, 6, 0, 39, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (2, 4, '실버카페가 인상적', '실버카페에서 다른 어르신들과 대화하며 시간을 보내신다고 하네요. 사회활동에 도움이 됩니다.', 4, 4, 4, 4, 4, 4, 0, 25, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (3, 2, '대전 데이케어센터 이용기', '주간보호로 이용하고 있는데 프로그램이 다양해서 좋습니다. 송영버스도 편리하고요.', 4, 4, 4, 4, 4, 7, 0, 41, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (3, 5, '건강관리 프로그램 만족', '건강관리 프로그램이 체계적으로 잘 되어 있어요. 혈압, 혈당 관리도 꼼꼼히 해주십니다.', 4, 5, 3, 4, 4, 5, 0, 33, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (4, 3, '인천 평안 요양병원 후기', '의료진이 상주해서 안심이 됩니다. 응급상황에도 빠르게 대응해주셔서 감사했습니다.', 5, 5, 4, 5, 4, 9, 0, 52, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (4, 4, '전문적인 의료서비스', '재활치료실 시설이 좋고 물리치료 선생님들이 전문적으로 치료해주십니다.', 4, 4, 4, 4, 4, 6, 0, 37, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (5, 2, '경기 사랑 재가센터 이용 후기', '재가 서비스로 이용하고 있는데 방문 시간도 정확하고 서비스 품질이 좋습니다.', 4, 4, 4, 4, 4, 4, 0, 29, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE),
    (1, 5, '감사합니다', '직원 분들의 세심한 배려에 감사드립니다. 어머니가 많이 좋아지셨어요.', 5, 5, 4, 5, 4, 2, 0, 18, TRUE, 'ACTIVE', NULL, 0, 0, NOW(), NOW(), FALSE);
INSERT INTO board (board_type, title, content, member_id, view_count, like_count, comment_count, is_notice, is_secret, is_active, status, category, sub_category, priority, is_pinned, parent_board_id, reply_depth, reply_order, tags, meta_description, meta_keywords, created_at, updated_at, is_deleted) VALUES
    ('NOTICE', '라이트케어 서비스 오픈 안내', '안녕하세요. 라이트케어 요양원 구인구직 플랫폼이 정식 오픈되었습니다. 많은 이용 부탁드립니다.', 1, 125, 15, 3, TRUE, FALSE, TRUE, 'ACTIVE', 'NOTICE', '서비스', 10, TRUE, NULL, 0, 0, '오픈,안내,서비스', '라이트케어 서비스 오픈 안내', '라이트케어,오픈,서비스,요양원', NOW(), NOW(), FALSE),
    ('INFO', '요양원 선택 시 고려사항', '좋은 요양원을 선택하기 위해 고려해야 할 중요한 사항들을 정리해드립니다. 1. 시설 환경 2. 직원의 전문성 3. 의료 서비스 4. 프로그램 다양성 5. 비용 투명성', 1, 89, 12, 5, FALSE, FALSE, TRUE, 'ACTIVE', 'INFO', '가이드', 5, FALSE, NULL, 0, 0, '요양원,선택,가이드', '요양원 선택 가이드', '요양원,선택,가이드,시설', NOW(), NOW(), FALSE),
    ('QNA', '요양보험 적용 관련 문의', '국민건강보험공단에서 시행하는 요양보험이 어떤 시설에 적용되는지 궁금합니다.', 2, 67, 3, 2, FALSE, FALSE, TRUE, 'ACTIVE', 'QNA', '보험', 0, FALSE, NULL, 0, 0, '요양보험,문의', '요양보험 적용 관련 문의', '요양보험,건강보험,적용', NOW(), NOW(), FALSE),
    ('FAQ', '자주 묻는 질문 모음', 'Q1. 입소 절차는 어떻게 되나요? A1. 상담 → 견학 → 서류 제출 → 입소 계약 순으로 진행됩니다. Q2. 면회 시간은 언제인가요? A2. 평일 오후 2시~6시, 주말 오전 10시~오후 6시입니다.', 1, 156, 8, 1, FALSE, FALSE, TRUE, 'ACTIVE', 'FAQ', '일반', 3, FALSE, NULL, 0, 0, 'FAQ,자주묻는질문', '자주 묻는 질문 모음', 'FAQ,질문,답변,입소', NOW(), NOW(), FALSE),
    ('INFO', '노인장기요양보험 제도 안내', '노인장기요양보험 제도에 대해 자세히 설명드립니다. 신청 방법, 등급 판정, 급여 내용 등을 포함합니다.', 1, 98, 7, 4, FALSE, FALSE, TRUE, 'ACTIVE', 'INFO', '제도', 2, FALSE, NULL, 0, 0, '장기요양보험,제도,안내', '노인장기요양보험 제도 안내', '장기요양보험,노인,제도,신청', NOW(), NOW(), FALSE),
    ('QNA', '월 이용료는 얼마인가요?', '부모님 모실 요양원을 찾고 있는데 일반적인 월 이용료가 궁금합니다.', 3, 134, 2, 6, FALSE, FALSE, TRUE, 'ACTIVE', 'QNA', '비용', 0, FALSE, NULL, 0, 0, '이용료,비용,문의', '월 이용료 문의', '이용료,비용,요양원,월비용', NOW(), NOW(), FALSE),
    ('INFO', '어르신 건강관리 팁', '어르신들의 건강한 생활을 위한 일상 관리 팁을 공유합니다. 식사, 운동, 수면, 정신건강 관리 방법을 포함합니다.', 1, 76, 11, 3, FALSE, FALSE, TRUE, 'ACTIVE', 'INFO', '건강', 1, FALSE, NULL, 0, 0, '건강관리,어르신,팁', '어르신 건강관리 팁', '건강관리,어르신,노인,건강,팁', NOW(), NOW(), FALSE),
    ('QNA', '면회 시간과 규정이 궁금해요', '코로나19 이후 면회 시간이나 규정이 어떻게 바뀌었는지 알고 싶습니다.', 4, 45, 1, 1, FALSE, FALSE, TRUE, 'ACTIVE', 'QNA', '면회', 0, FALSE, NULL, 0, 0, '면회,시간,규정', '면회 시간 규정 문의', '면회,시간,규정,코로나', NOW(), NOW(), FALSE),
    ('INFO', '재활 프로그램 종류와 효과', '요양원에서 제공하는 다양한 재활 프로그램들과 그 효과에 대해 알아봅시다.', 1, 63, 9, 2, FALSE, FALSE, TRUE, 'ACTIVE', 'INFO', '재활', 1, FALSE, NULL, 0, 0, '재활,프로그램,효과', '재활 프로그램 안내', '재활,프로그램,물리치료,작업치료', NOW(), NOW(), FALSE),
    ('QNA', '식사 메뉴는 어떻게 제공되나요?', '요양원의 식사 메뉴 구성과 특별식 제공 여부가 궁금합니다.', 5, 58, 4, 3, FALSE, FALSE, TRUE, 'ACTIVE', 'QNA', '식사', 0, FALSE, NULL, 0, 0, '식사,메뉴,급식', '식사 메뉴 문의', '식사,메뉴,급식,요양원', NOW(), NOW(), FALSE);
SELECT '라이트케어 데이터베이스 초기화가 완료되었습니다!' as message;
select * from member;
select * from job_posting;
select * from facility;
select * from facility_images;
use carelink;
`````
